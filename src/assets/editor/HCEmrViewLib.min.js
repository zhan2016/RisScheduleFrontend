this.THCEmrViewLib=function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=15)}([function(t,e){function i(e){return t.exports=i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},t.exports.__esModule=!0,t.exports.default=t.exports,i(e)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var n=i(16);function o(){return"undefined"!=typeof Reflect&&Reflect.get?(t.exports=o=Reflect.get.bind(),t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=o=function(t,e,i){var o=n(t,e);if(o){var s=Object.getOwnPropertyDescriptor(o,e);return s.get?s.get.call(arguments.length<3?t:i):s.value}},t.exports.__esModule=!0,t.exports.default=t.exports),o.apply(this,arguments)}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var n=i(12);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&n(t,e)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var n=i(6).default,o=i(7);t.exports=function(t,e){if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return o(t)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function i(e){return t.exports=i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,i(e)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var n=i(17)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},function(t,e,i){var n=i(20),o=i(21),s=i(22),r=i(23);t.exports=function(t){return n(t)||o(t)||s(t)||r()},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var n=i(0),o=i(12),s=i(18),r=i(13);function a(e){var i="function"==typeof Map?new Map:void 0;return t.exports=a=function(t){if(null===t||!s(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,e)}function e(){return r(t,arguments,n(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),o(e,t)},t.exports.__esModule=!0,t.exports.default=t.exports,a(e)}t.exports=a,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function i(t,e,i,n,o,s,r){try{var a=t[s](r),l=a.value}catch(t){return void i(t)}a.done?e(l):Promise.resolve(l).then(n,o)}t.exports=function(t){return function(){var e=this,n=arguments;return new Promise((function(o,s){var r=t.apply(e,n);function a(t){i(r,o,s,a,l,"next",t)}function l(t){i(r,o,s,a,l,"throw",t)}a(void 0)}))}},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function i(e,n){return t.exports=i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},t.exports.__esModule=!0,t.exports.default=t.exports,i(e,n)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var n=i(12),o=i(19);function s(e,i,r){return o()?(t.exports=s=Reflect.construct.bind(),t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=s=function(t,e,i){var o=[null];o.push.apply(o,e);var s=new(Function.bind.apply(t,o));return i&&n(s,i.prototype),s},t.exports.__esModule=!0,t.exports.default=t.exports),s.apply(null,arguments)}t.exports=s,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){t.exports=i(24)},function(t,e,i){var n=i(0);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var n=i(6).default;function o(){"use strict";
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */t.exports=o=function(){return e},t.exports.__esModule=!0,t.exports.default=t.exports;var e={},i=Object.prototype,s=i.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",l=r.asyncIterator||"@@asyncIterator",h=r.toStringTag||"@@toStringTag";function c(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,i){return t[e]=i}}function u(t,e,i,n){var o=e&&e.prototype instanceof m?e:m,s=Object.create(o.prototype),r=new P(n||[]);return s._invoke=function(t,e,i){var n="suspendedStart";return function(o,s){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw s;return x()}for(i.method=o,i.arg=s;;){var r=i.delegate;if(r){var a=w(r,i);if(a){if(a===d)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var l=f(t,e,i);if("normal"===l.type){if(n=i.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(n="completed",i.method="throw",i.arg=l.arg)}}}(t,i,r),s}function f(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var d={};function m(){}function S(){}function p(){}var y={};c(y,a,(function(){return this}));var F=Object.getPrototypeOf,v=F&&F(F(k([])));v&&v!==i&&s.call(v,a)&&(y=v);var I=p.prototype=m.prototype=Object.create(y);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){var i;this._invoke=function(o,r){function a(){return new e((function(i,a){!function i(o,r,a,l){var h=f(t[o],t,r);if("throw"!==h.type){var c=h.arg,u=c.value;return u&&"object"==n(u)&&s.call(u,"__await")?e.resolve(u.__await).then((function(t){i("next",t,a,l)}),(function(t){i("throw",t,a,l)})):e.resolve(u).then((function(t){c.value=t,a(c)}),(function(t){return i("throw",t,a,l)}))}l(h.arg)}(o,r,i,a)}))}return i=i?i.then(a,a):a()}}function w(t,e){var i=t.iterator[e.method];if(void 0===i){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=f(i,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,d;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function D(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function k(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(s.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:x}}function x(){return{value:void 0,done:!0}}return S.prototype=p,c(I,"constructor",p),c(p,"constructor",S),S.displayName=c(p,h,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===S||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,h,"GeneratorFunction")),t.prototype=Object.create(I),t},e.awrap=function(t){return{__await:t}},g(C.prototype),c(C.prototype,l,(function(){return this})),e.AsyncIterator=C,e.async=function(t,i,n,o,s){void 0===s&&(s=Promise);var r=new C(u(t,i,n,o),s);return e.isGeneratorFunction(i)?r:r.next().then((function(t){return t.done?t.value:r.next()}))},g(I),c(I,h,"Generator"),c(I,a,(function(){return this})),c(I,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var n=e.pop();if(n in t)return i.value=n,i.done=!1,i}return i.done=!0,i}},e.values=k,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(D),!t)for(var e in this)"t"===e.charAt(0)&&s.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(i,n){return r.type="throw",r.arg=t,e.next=i,n&&(e.method="next",e.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],r=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var a=s.call(o,"catchLoc"),l=s.call(o,"finallyLoc");if(a&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&s.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=t,r.arg=e,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(r)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),D(i),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var o=n.arg;D(i)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:k(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=void 0),d}},e}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var n=i(14);t.exports=function(t){if(Array.isArray(t))return n(t)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var n=i(14);t.exports=function(t,e){if(t){if("string"==typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(t,e):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){"use strict";i.r(e);var n=i(6),o=i.n(n),s=i(2),r=i.n(s),a=i(3),l=i.n(a),h=i(11),c=i.n(h),u=i(1),f=i.n(u),d=i(4),m=i.n(d),S=i(5),p=i.n(S),y=i(0),F=i.n(y),v=i(8),I=i.n(v),g=i(10),C=i.n(g),w=i(9),A=i.n(w);function D(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}function P(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return k(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return k(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){a=!0,s=t},f:function(){try{r||null==i.return||i.return()}finally{if(a)throw s}}}}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var R={Asni:0,Utf8:1,Utf16:2},T=0,b=1,B=2,N=3,O=4,_=l()((function t(){r()(this,t)}));_.XML="application/xml",_.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",_.PNG="image/png",_.BMP="application/x-bmp",_.JPEG="image/jpeg",_.IMAGE=_.PNG+","+_.JPEG+","+_.BMP,_.PDF="application/pdf",_.JSON="application/json",_.JS="application/javascript",_.ZIP="application/zip",_.HTML="text/html",_.TXT="text/plain";var E={Text:".text",Html:".html"},M=l()((function t(){r()(this,t)}));M.TibetanVowel="ེོིུ",M.TibetanOther="ྸཾ༷༵ྃཿྷྺྕྖཻླྲྟྱྭྀཽྥྩྪྫྰྶྡྦྔྨ྄ྒྒྮྯྴྐྑྤྣྠྗྙྼྻཱ༙༾༿྇྆ྲྀཷླྀཹཱིྚཱཱིུྜ࿆ྵྐྵྂྞྛ",M.UnPlaceholderChar=M.TibetanVowel+M.TibetanOther;var L=function(){function t(){r()(this,t),this.lineBreak="\r\n",this.os=this._detectOS(),this._dpi=null}return l()(t,[{key:"_detectOS",value:function(){navigator.userAgent;return"Win32"==navigator.platform||"Windows"==navigator.platform?b:"Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform?B:"X11"==navigator.platform?O:String(navigator.platform).indexOf("Linux")>-1?N:T}},{key:"_getDPI",value:function(){var t={};if(null!=window.screen.deviceXDPI)t.x=window.screen.deviceXDPI,t.y=window.screen.deviceYDPI;else{var e=document.createElement("div");e.style.cssText="width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden",document.body.appendChild(e),t.x=parseInt(e.offsetWidth),t.y=parseInt(e.offsetHeight),e.parentNode.removeChild(e)}if(0==t.x||0==t.y){var i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("width","25.4mm"),i.setAttribute("height","25.4mm"),document.body.appendChild(i),t.x=i.clientWidth,t.y=i.clientHeight,i.parentNode.removeChild(i)}return 0!=t.x&&0!=t.y||(t.x=96,t.y=96,console.error("dpi获取错误 x=0或y=0，使用默认值96。")),t}},{key:"assigned",value:function(t){return void 0!==t}},{key:"beep",value:function(){}},{key:"getUrlParam",value:function(t){for(var e,i=window.location.search.substring(1).split("&"),n=0;n<i.length;n++)if((e=i[n].split("="))[0]==t)return e[1];return""}},{key:"Timestamp",get:function(){return(new Date).getTime()}},{key:"dpi",get:function(){return this._dpi||(this._dpi=this._getDPI()),this._dpi}}],[{key:"openURL",value:function(t){window.open(t)}},{key:"pointInBound",value:function(t,e,i,n,o){return o.x>=t&&o.x<t+i&&o.y>e&&o.y<=e+n}},{key:"isOdd",value:function(t){return 1==(1&t)}},{key:"tryParseInt",value:function(t){var e=NaN,i=!1;return this.isNumber(t)&&(e=parseInt(t),i=!0),{value:e,ok:i}}},{key:"isNumber",value:function(t){return!(!/^\d+(\.\d+)?$/.test(t)&&!/^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/.test(t))}},{key:"isNumberStrict",value:function(e){return"0"!==e[0]&&t.isNumber(e)}},{key:"parseFloatDef",value:function(t,e){var i=parseFloat(t);return isNaN(i)?e:i}},{key:"parseIntDef",value:function(t,e){var i=parseInt(t);return isNaN(i)?e:i}},{key:"parseBooleanDef",value:function(t,e){if("false"===t||!1===t)return!1;if("true"===t||!0===t)return!0;var i=parseInt(t);return isNaN(i)?e:1==i}},{key:"Round",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e||0,n=Math.pow(10,i),o=+(i?t*n:t).toFixed(8),s=Math.floor(o),r=o-s,a=1e-8,l=r>.5-a&&r<.5+a?s%2==0?s:s+1:Math.round(o);return i?l/n:l}},{key:"stringFormatFloat",value:function(){var t=arguments;if(t.length>1){var e=t[0],i=t[1].toString(),n=i.indexOf(".");if(n>=0){var o=i.substr(0,n);""==o&&(o="0");var s=i.substr(n+1,e);return""==s.replace("0","")?o:o+"."+s}return i}}},{key:"stringFormat",value:function(){var t=arguments;if(t.length>0){if(t.length>1){var e=-1;return t[0].replace(/\{(\d+)\}/g,(function(i,n){return e=parseInt(n),t.length>e+1?t[e+1]:""}))}return t[0]}}},{key:"stringInsert",value:function(t,e,i){return t.slice(0,e)+i+t.slice(e)}},{key:"stringDelete",value:function(t,e,i){return t.substring(0,e)+t.substring(e+i,t.length)}},{key:"stringRemove",value:function(e,i,n){return t.stringDelete(e,i,n)}},{key:"setIntersection",value:function(t,e){return new Set(A()(t).filter((function(t){return e.has(t)})))}},{key:"setDifference",value:function(t,e){return new Set(A()(t).filter((function(t){return!e.has(t)})))}},{key:"setCompare",value:function(t,e){if(t.size!=e.size)return!1;var i,n=P(t);try{for(n.s();!(i=n.n()).done;){var o=i.value;if(!e.has(o))return!1}}catch(t){n.e(t)}finally{n.f()}return!0}},{key:"setUnion",value:function(t,e){return new Set([].concat(A()(t),A()(e)))}},{key:"setRemove",value:function(t,e){t.delete(e)}},{key:"setCount",value:function(t){return t.size}},{key:"crc32",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";null===e&&(e=0);var n=0;e^=-1;for(var o=0,s=t.length;o<s;o++)n=255&(e^t.charCodeAt(o)),e=e>>>8^"0x"+i.substr(9*n,8);return-1^e}}]),t}();L.DefaultFont="宋体",L.FontSupSubScale=.7;var G=function(t){m()(i,t);var e=D(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).fill(null),n}return l()(i)}(C()(Array)),H=function(t){m()(i,t);var e=D(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).fill(0),n}return l()(i)}(C()(Array)),V=function(t){m()(i,t);var e=D(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).fill(0),n}return l()(i)}(C()(Array)),U=function(t){m()(i,t);var e=D(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).fill(0),n}return l()(i,[{key:"push",value:function(t){this[this.length]=t}},{key:"toText",value:function(){for(var t="",e=0,i=this.length;e<i;e++)t+=String.fromCharCode(this[e]);return t}},{key:"toBase64",value:function(){var t=this.toText();return window.btoa(t)}}],[{key:"fromBase64",value:function(t){for(var e=window.atob(t.replace(/%0A|\s/g,"")),n=new i(e.length),o=0,s=e.length;o<s;++o)n[o]=e.charCodeAt(o);return n}},{key:"fromBuffer",value:function(t){for(var e=new i(t.length),n=0,o=t.length;n<o;++n)e[n]=t[n];return e}}]),i}(C()(Array)),W=l()((function t(){if(r()(this,t),this.constructor.prototype===t.prototype)throw"TEncoding类为抽象类，不可直接实例使用！";if("function"!=typeof this.getByteCount)throw this.prototype+" 没有实现getByteCount方法！";if("function"!=typeof this.getBytes)throw this.prototype+" 没有实现getBytes方法！";if("function"!=typeof this.getString)throw this.prototype+" 没有实现getString方法！"})),z=function(t){m()(i,t);var e=D(i);function i(){return r()(this,i),e.call(this)}return l()(i)}(W),K=function(t){m()(i,t);var e=D(i);function i(){return r()(this,i),e.call(this)}return l()(i,[{key:"getByteCount",value:function(t){for(var e,i=0,n=0,o=t.lenght;n<o;n++)(e=t.charCodeAt(n))>=0&&e<=127?i+=1:e>=128&&e<=2047?i+=2:e>=2048&&e<=65535?i+=3:e>65536&&e<=2097151?i+=4:e>2097152&&e<=67108863?i+=5:e>67108864&&e<=2147483647&&(i+=6);return i}}],[{key:"getBytes",value:function(t){for(var e,i=new U(0),n=0,o=t.length;n<o;n++)(e=t.charCodeAt(n))>=0&&e<=127?i.push(e):e>=128&&e<=2047?(i.push(192|e>>6&31),i.push(128|63&e)):e>=2048&&e<=65535&&(i.push(224|e>>12&15),i.push(128|e>>6&63),i.push(128|63&e));return i}},{key:"getString",value:function(t){var e=t instanceof Uint8Array?t:new Uint8Array(t),i=new Uint16Array(e.buffer);return String.fromCharCode.apply(null,i)}}]),i}(W),J=function(t){m()(i,t);var e=D(i);function i(){return r()(this,i),e.call(this)}return l()(i,null,[{key:"getBytes",value:function(t){for(var e,i=new U(0),n=0,o=t.length;n<o;n++)(e=t.charCodeAt(n))<=65535?(i.push(255&e),i.push(e>>8)):(i.push(255&e),i.push((65280&e)>>8),i.push((16711680&e)>>16),i.push((4278190080&e)>>24));return i}},{key:"getByteCount",value:function(t){for(var e=0,i=0,n=t.length;i<n;i++)e+=t.charCodeAt(i)<=65535?2:4;return e}},{key:"getString",value:function(t){var e=t instanceof Uint8Array?t:new Uint8Array(t),i=new Uint16Array(e.buffer);return String.fromCharCode.apply(null,i)}},{key:"toUtf8",value:function(t){for(var e,i=new U(0),n=0,o=t.lenght;n<o;n++)(e=t.charCodeAt(n))>=0&&e<=127?i.push(e):e>=128&&e<=2047?(i.push(192|31&e>>6),i.push(128|63&e)):e>=2048&&e<=65535?(i.push(224|15&e>>12),i.push(128|63&e>>6),i.push(128|63&e)):e>=65536&&e<=1114111?(i.push(240|7&e>>18),i.push(128|63&e>>12),i.push(128|63&e>>6),i.push(128|63&e)):e>2097152&&e<=67108863?(i.push(248|3&e>>24),i.push(128|63&e>>18),i.push(128|63&e>>12),i.push(128|63&e>>6),i.push(128|63&e)):e>67108864&&e<=2147483647&&(i.push(252|1&e>>30),i.push(128|63&e>>24),i.push(128|63&e>>18),i.push(128|63&e>>12),i.push(128|63&e>>6),i.push(128|63&e));return i}},{key:"textLength",value:function(t){return""==t?0:t.match(/(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g).length}},{key:"subStr",value:function(t,e,i){var n,o,s="",r=P(t);try{for(r.s();!(o=r.n()).done;)if(n=o.value,0<e);else{if(0>e+i)return;s+=n}}catch(t){r.e(t)}finally{r.f()}return s}}]),i}(W),j=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(r()(this,t),e<-32768||e>32767)throw L.stringFormat("值 {0} 不在 -32768..32767内！",e);this._val=new Int16Array(1),this._val[0]=e}return l()(t,[{key:"size",value:function(){return this._val.BYTES_PER_ELEMENT}},{key:"toString",value:function(){return this._val[0].toString()}},{key:"toInt8",value:function(){var t=new Int8Array(1);return t[0]=this._val[0],t[0]}},{key:"toUInt8",value:function(){var t=new Uint8Array(1);return t[0]=this._val[0],t[0]}},{key:"toUInt16",value:function(){return this._val[0]<0?this._val[0]+65536:this._val[0]}},{key:"value",get:function(){return this._val[0]},set:function(t){this._val[0]=t}}],[{key:"min",get:function(){return-32768}},{key:"max",get:function(){return 32767}},{key:"include",value:function(e){return e>=t.min&&e<=t.max}}]),t}(),Y=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(r()(this,t),e<0||e>65536)throw L.stringFormat("值 {0} 不在 0..65535内！",e);this._val=new Uint16Array(1),this._val[0]=e}return l()(t,[{key:"size",value:function(){return this._val.BYTES_PER_ELEMENT}},{key:"toString",value:function(){return this._val[0].toString()}},{key:"toInt8",value:function(){var t=new Int8Array(1);return t[0]=this._val[0],t[0]}},{key:"toUInt8",value:function(){var t=new Uint8Array(1);return t[0]=this._val[0],t[0]}},{key:"toInt16",value:function(){return this._val[0]<32768?this._val[0]:this._val[0]-65536}},{key:"value",get:function(){return this._val[0]},set:function(t){this._val[0]=t}}],[{key:"min",get:function(){return 0}},{key:"max",get:function(){return 65535}},{key:"include",value:function(e){return e>=t.min&&e<=t.max}}]),t}(),Q=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(r()(this,t),e<-2147483648||e>2147483647)throw L.stringFormat("值 {0} 不在 -2147483648..2147483647内！",e);this._val=new Int32Array(1),this._val[0]=e}return l()(t,[{key:"size",value:function(){return this._val.BYTES_PER_ELEMENT}},{key:"toString",value:function(){return this._val[0].toString()}},{key:"toInt8",value:function(){var t=new Int8Array(1);return t[0]=this._val[0],t[0]}},{key:"toUInt8",value:function(){var t=new Uint8Array(1);return t[0]=this._val[0],t[0]}},{key:"toInt16",value:function(){var t=new Int16Array(1);return t[0]=this._val[0],t[0]}},{key:"toUInt16",value:function(){var t=new Uint16Array(1);return t[0]=this._val[0],t[0]}},{key:"toUInt32",value:function(){return this._val[0]<0?this._val[0]+4294967296:this._val[0]}},{key:"value",get:function(){return this._val[0]},set:function(t){this._val[0]=t}}],[{key:"min",get:function(){return-2147483648}},{key:"max",get:function(){return 2147483647}},{key:"include",value:function(e){return e>=t.min&&e<=t.max}}]),t}(),X=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(r()(this,t),e<0||e>4294967295)throw L.stringFormat("值 {0} 不在 0..4294967295内！",e);this._val=new Uint32Array(1),this._val[0]=e}return l()(t,[{key:"size",value:function(){return this._val.BYTES_PER_ELEMENT}},{key:"toString",value:function(){return this._val[0].toString()}},{key:"toInt8",value:function(){var t=new Int8Array(1);return t[0]=this._val[0],t[0]}},{key:"toUInt8",value:function(){var t=new Uint8Array(1);return t[0]=this._val[0],t[0]}},{key:"toInt16",value:function(){var t=new Int16Array(1);return t[0]=this._val[0],t[0]}},{key:"toUInt16",value:function(){var t=new Uint16Array(1);return t[0]=this._val[0],t[0]}},{key:"toInt32",value:function(){return this._val[0]<2147483648?this._val[0]:this._val[0]-4294967296}},{key:"value",get:function(){return this._val[0]},set:function(t){this._val[0]=t}}],[{key:"min",get:function(){return 0}},{key:"max",get:function(){return 4294967295}},{key:"include",value:function(e){return e>=t.min&&e<=t.max}}]),t}(),Z=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(r()(this,t),e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER)throw L.stringFormat("值 {0} 不在 {1}..{2}内！",e,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER);if(e>X.max){var i=e.toString(2);this.hi32=parseInt(i.substr(0,i.length-32),2),this.lo32=parseInt(i.substr(i.length-32),2)}else this.hi32=0,this.lo32=e}return l()(t,[{key:"size",value:function(){return this._val.BYTES_PER_ELEMENT+this._val.BYTES_PER_ELEMENT}},{key:"toString",value:function(){return((this._val[1]<<32)+this.val[0]).toString()}},{key:"buffer",get:function(){var t=new Array(8),e=new Uint8Array(1);return e[0]=this.lo32,t[0]=e[0],e[0]=this.lo32>>8,t[1]=e[0],e[0]=this.lo32>>16,t[2]=e[0],e[0]=this.lo32>>24,t[3]=e[0],e[0]=this.hi32,t[4]=e[0],e[0]=this.hi32>>8,t[5]=e[0],e[0]=this.hi32>>16,t[6]=e[0],e[0]=this.hi32>>24,t[7]=e[0],t}}]),t}(),q=function(){function t(){r()(this,t),this.value=0}return l()(t,[{key:"has",value:function(t){return(this.value&t)==t}},{key:"add",value:function(t){this.value=this.value|t}},{key:"remove",value:function(t){this.value=this.value&~t}},{key:"clear",value:function(){this.value=0}}]),t}(),$=0,tt=function(){function t(e){r()(this,t),this._className=this.constructor.name,this.hcl=e,null==e&&console.error(this._className+"实例化时无效的hcl！"),this.id="",this.instanceID=++$,this.createBefor()}return l()(t,[{key:"createBefor",value:function(){}},{key:"dispose",value:function(){}},{key:"isClass",value:function(t){return this instanceof t}},{key:"isSubClass",value:function(e){return e===t||Object.getPrototypeOf(this).isClass(e)}},{key:"equal",value:function(t){return this.instanceID===t.instanceID}},{key:"newInstance",value:function(){return new this.constructor(this.hcl)}},{key:"className",get:function(){return this._className}}]),t}(),et=function(){function t(){r()(this,t),this.x=0,this.y=0}return l()(t,[{key:"reset",value:function(t,e){this.x=t,this.y=e}},{key:"resetByPoint",value:function(t){this.reset(t.x,t.y)}},{key:"equal",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"offset",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n)return t.Create(this.x+e,this.y+i);this.x+=e,this.y+=i}},{key:"offsetBy",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.offset(t.x,t.y,e)}}],[{key:"Create",value:function(e,i){var n=new t;return n.x=e,n.y=i,n}},{key:"CreateByPoint",value:function(e){return t.Create(e.x,e.y)}},{key:"inPoly",value:function(e,i){return t.inPolyAt(e.x,e.y,i)}},{key:"inPolyAt",value:function(t,e,i){for(var n,o,s,r,a=!1,l=0,h=i.length-1;l<i.length;h=l++)n=i[l].x,s=i[l].y,o=i[h].x,s>e!=(r=i[h].y)>e&&t<(o-n)*(e-s)/(r-s)+n&&(a=!a);return a}}]),t}(),it=function(){function t(){r()(this,t),this.width=0,this.height=0}return l()(t,[{key:"reset",value:function(t,e){this.width=t,this.height=e}}]),t}(),nt=function(){function t(){r()(this,t),this.left=0,this.top=0,this.right=0,this.bottom=0}return l()(t,[{key:"reset",value:function(t,e,i,n){return this.left=t,this.top=e,this.right=i,this.bottom=n,this}},{key:"resetRect",value:function(t){return this.reset(t.left,t.top,t.right,t.bottom)}},{key:"resetBounds",value:function(t,e,i,n){return this.reset(t,e,t+i,e+n)}},{key:"resetSize",value:function(t){return this.right=this.left+t.width,this.bottom=this.top+t.height,this}},{key:"offset",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?t.Create(this.left+e,this.top+i,this.right+e,this.bottom+i):(this.left=this.left+e,this.top=this.top+i,this.right=this.right+e,this.bottom=this.bottom+i,this)}},{key:"scale",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i?1!==e?t.Create(Math.ceil(this.left*e),Math.ceil(this.top*e),Math.floor(this.right*e),Math.floor(this.bottom*e)):t.Create(this.left,this.top,this.right,this.bottom):(1!==e&&(this.left=Math.ceil(this.left*e),this.top=Math.ceil(this.top*e),this.right=Math.floor(this.right*e),this.bottom=Math.floor(this.bottom*e)),this)}},{key:"intersection",value:function(e){var i=new t;return e.right<=this.left||e.top>=this.bottom||e.left>=this.right||e.bottom<=this.top||(e.left>this.left?i.left=e.left:i.left=this.left,e.top>this.top?i.top=e.top:i.top=this.top,e.right>this.right?i.right=this.right:i.right=e.right,e.bottom>this.bottom?i.bottom=this.bottom:i.bottom=e.bottom),i}},{key:"union",value:function(e){var i=new t;return e.left<this.left?i.left=e.left:i.left=this.left,e.top<this.top?i.top=e.top:i.top=this.top,e.right>this.right?i.right=e.right:i.right=this.right,e.bottom>this.bottom?i.bottom=e.bottom:i.bottom=this.bottom,i}},{key:"inFlate",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?t.Create(this.left-e,this.top-i,this.right+e,this.bottom+i):(this.left-=e,this.right+=e,this.top-=i,this.bottom+=i,this)}},{key:"pointInAt",value:function(t,e){return t>=this.left&&t<=this.right&&e>=this.top&&e<=this.bottom}},{key:"pointIn",value:function(t){return this.pointInAt(t.x,t.y)}},{key:"isIntersect",value:function(t){var e=this.left>t.left?this.left:t.left,i=this.top>t.top?this.top:t.top,n=this.right<t.right?this.right:t.right,o=this.bottom<t.bottom?this.bottom:t.bottom;return e<n&&i<o}},{key:"leftTop",get:function(){return et.Create(this.left,this.top)},set:function(t){this.left=t.x,this.top=t.y}},{key:"rightTop",get:function(){return et.Create(this.right,this.top)}},{key:"leftBottom",get:function(){return et.Create(this.left,this.bottom)}},{key:"rightBottom",get:function(){return et.Create(this.right,this.bottom)}},{key:"width",get:function(){return this.right-this.left},set:function(t){this.right=this.left+t}},{key:"height",get:function(){return this.bottom-this.top},set:function(t){this.bottom=this.top+t}}],[{key:"Create",value:function(e,i,n,o){var s=new t;return s.left=e,s.top=i,s.right=n,s.bottom=o,s}},{key:"CreateByRect",value:function(t){return this.Create(t.left,t.top,t.right,t.bottom)}},{key:"CreateByBounds",value:function(e,i,n,o){var s=new t;return s.left=e,s.top=i,s.right=e+n,s.bottom=i+o,s}}]),t}(),ot=function(t){m()(i,t);var e=D(i);function i(){var t,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return r()(this,i),(t=e.call(this))._onAdded=null,t._onRemoved=null,t.ownsObjects=null==n||n,t}return l()(i,[{key:"doAdded_",value:function(t){null!=this._onAdded&&this._onAdded(t)}},{key:"doRemoved_",value:function(t){(null!=this._onRemoved&&this._onRemoved(t),this.ownsObjects)&&(Object.getPrototypeOf(t)instanceof tt&&t.dispose())}},{key:"doClear_",value:function(){}},{key:"add",value:function(t){this[this.length]=t,this.doAdded_(t)}},{key:"swap",value:function(t,e){if(t!==e){var i=this[t];this[t]=this[e],this[e]=i}}},{key:"move",value:function(t,e){var i=this.indexOf(t);i>=0&&this.moveByIndex(i,e)}},{key:"moveByIndex",value:function(t,e){var i=this[t];this.splice(t,1),this.splice(e,0,i)}},{key:"removeAt",value:function(t){if(t>=0&&t<this.length){var e=this[t];return this.splice(t,1),this.doRemoved_(e),e=null,!0}return!1}},{key:"remove",value:function(t){return this.removeAt(this.indexOf(t))}},{key:"removeRange",value:function(t,e){if(t>=0){for(var i=null,n=t;n<t+e;n++)i=this[n],this.doRemoved_(i),i=null;return this.splice(t,e),!0}return!1}},{key:"removeRangeTo",value:function(t,e){if(t>=0&&e<this.length){for(var i=null,n=t;n<=e;n++)i=this[n],this.doRemoved_(i),i=null;return this.splice(t,e-t+1),!0}return!1}},{key:"delete",value:function(t){return this.removeAt(t)}},{key:"insert",value:function(t,e){return t>=0&&t<=this.length&&(this.splice(t,0,e),this.doAdded_(e),!0)}},{key:"clear",value:function(){for(var t=null,e=this.length-1;e>=0;e--)t=this[e],this.splice(e,1),this.doRemoved_(t),t=null;this.doClear_()}},{key:"contains",value:function(t){return this.indexOf(t)>=0}},{key:"first",get:function(){return this.length>0?this[0]:null}},{key:"last",get:function(){return this.length>0?this[this.length-1]:null}},{key:"count",get:function(){return this.length}},{key:"onAdded",get:function(){return this._onAdded},set:function(t){this._onAdded=t}},{key:"onRemoved",get:function(){return this._onRemoved},set:function(t){this._onRemoved=t}}]),i}(C()(Array)),st=function(t){m()(i,t);var e=D(i);function i(){return r()(this,i),e.call(this)}return l()(i,[{key:"peek",value:function(){return this[this.length-1]}},{key:"clear",value:function(){this.splice(0,this.length)}},{key:"count",get:function(){return this.length}}]),i}(C()(Array)),rt=function(t){m()(i,t);var e=D(i);function i(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return r()(this,i),e.call(this,t)}return l()(i,[{key:"add",value:function(t,e){var n={};n.key=t,n.val=e,f()(F()(i.prototype),"add",this).call(this,n)}},{key:"remove",value:function(t){var e=this.indexOfKey(t);e>=0&&f()(F()(i.prototype),"removeAt",this).call(this,e)}},{key:"indexOfKey",value:function(t){for(var e=0;e<this.count;e++)if(this[e].key==t)return e;return-1}},{key:"indexOfValue",value:function(t){for(var e=0;e<this.count-1;e++)if(this[e].val===t)return e;return-1}},{key:"valueByKey",value:function(t){var e=this.indexOfKey(t);return e<0?null:this[e].val}},{key:"keyByValue",value:function(t){var e=this.indexOfValue(t);return e<0?null:this[e].key}},{key:"setValue",value:function(t,e){var i=this.indexOfKey(t);i<0?this.add(t,e):this[i].val=e}},{key:"hasKey",value:function(t){return this.indexOfKey(t)>=0}},{key:"assign",value:function(t){this.clear();var e,i=P(t);try{for(i.s();!(e=i.n()).done;){var n=e.value;this.add(n.key,n.val)}}catch(t){i.e(t)}finally{i.f()}}}]),i}(ot),at=function(t){m()(i,t);var e=D(i);function i(){return r()(this,i),e.call(this)}return l()(i,[{key:"append",value:function(t){this.add(t)}},{key:"text",get:function(){var t="";if(this.length>0){t=this[0];for(var e=1,i=this.length;e<i;e++)t+="\r\n"+this[e]}return t}}]),i}(ot),lt=function(){function t(){r()(this,t),this._datetime=new Date}return l()(t,[{key:"initByDateTime",value:function(t){this.year=t.year,this.day=1,this.month=t.month,this.day=t.day,this.hour=t.hour,this.minute=t.minute,this.second=t.second,this.millisecond=t.millisecond}},{key:"format",value:function(t){var e={"M+":this.month,"d+":this.day,"h+":this.hour,"m+":this.minute,"s+":this.second,S:this.millisecond,z:this.millisecond};for(var i in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.year+"").substr(4-RegExp.$1.length))),e)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[i]:("00"+e[i]).substr((""+e[i]).length)));return t}},{key:"fromString",value:function(t){(t=(t=(t=t.replace(/[^a-zA-Z\d\u5e74\u6708\u65e5\u65f6\u5206\u79d2\u0020:-]/g,"")).replace(/-/g,"/").replace(/年/g,"/").replace(/月/g,"/").replace(/日/g,"/")).replace(/时/g,":").replace(/分/g,":").replace(/秒/g,"")).indexOf("/")<0&&(t=this.year+"/"+this.month+"/"+this.day+" "+t);var e=new Date(Date.parse(t));return!isNaN(e.getFullYear())&&(this._datetime=e,!0)}},{key:"toString",value:function(t){return t?this.format(t):this.format("yyyy-MM-dd hh:mm:ss")}},{key:"toOADate",value:function(){var t=6e4*this._datetime.getTimezoneOffset();return(parseFloat(this._datetime.getTime())-t)/24/3600/1e3+25569}},{key:"fromOAData",value:function(t){this._datetime=new Date;var e=6e4*this._datetime.getTimezoneOffset();this._datetime.setTime(24*(t-25569)*3600*1e3+e)}},{key:"year",get:function(){return this._datetime.getFullYear()},set:function(t){this._datetime.setFullYear(t)}},{key:"month",get:function(){return this._datetime.getMonth()+1},set:function(t){this._datetime.setMonth(t-1)}},{key:"day",get:function(){return this._datetime.getDate()},set:function(t){this._datetime.setDate(t)}},{key:"hour",get:function(){return this._datetime.getHours()},set:function(t){this._datetime.setHours(t)}},{key:"minute",get:function(){return this._datetime.getMinutes()},set:function(t){this._datetime.setMinutes(t)}},{key:"second",get:function(){return this._datetime.getSeconds()},set:function(t){this._datetime.setSeconds(t)}},{key:"millisecond",get:function(){return this._datetime.getMilliseconds()},set:function(t){this._datetime.setMilliseconds(t)}},{key:"datetime",get:function(){return this._datetime},set:function(t){this._datetime=t}}],[{key:"Create",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=new t;return l.year=e,l.day=1,l.month=i,l.day=n,l.hour=o,l.minute=s,l.second=r,l.millisecond=a,l}},{key:"CreateByDateTime",value:function(e){var i=new t;return i.year=e.year,i.day=1,i.month=e.month,i.day=e.day,i.hour=e.hour,i.minute=e.minute,i.second=e.second,i.millisecond=e.millisecond,i}},{key:"CreateWithDateTime",value:function(e){var i=new t;return i.datetime=e,i}},{key:"CreateByString",value:function(e){var i=new t;return i.fromString(e)?i:null}},{key:"Now",value:function(){return new t}},{key:"DaysInMonth",value:function(t,e){switch(e){case 1:case 3:case 5:case 7:case 8:case 10:case 12:return 31;case 4:case 6:case 9:case 11:return 30;case 2:return t%4==0&&t%100!=0||t%400==0?29:28;default:return 0}}}]),t}(),ht=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;r()(this,t),null!==e?(this._bytes=U.fromBuffer(e),this._size=e.length):(this._size=0,this._bytes=new U(0)),this._position=0,this.onLoadStart=null,this.onLoadProgress=null,this.onLoadFinish=null}return l()(t,[{key:"clear",value:function(){this._bytes.length=0,this._size=0,this._position=0}},{key:"copyFrom",value:function(t,e){0==e&&(t.position=0,e=t.size);var i=t.readBuffer(e);this.writeBuffer(i)}},{key:"loadFromFile",value:function(t){var e=this,i=new FileReader;i.onloadstart=function(){e._size=0,e._position=0,e._buffer=null,null!=e.onLoadStart&&e.onLoadStart()},i.onload=function(t){e._bytes=Array.prototype.slice.call(new Uint8Array(t.target.result)),e._size=t.total,e._position=0,null!=e.onLoadFinish&&e.onLoadFinish(!0)},i.onabort=function(){null!=e.onLoadFinish&&e.onLoadFinish(!1)},i.onprogress=function(t){null!=e.onLoadProgress&&e.onLoadProgress(t.loaded,t.total)},i.onerror=function(){null!=e.onLoadFinish&&e.onLoadFinish(!1)},i.readAsArrayBuffer(t)}},{key:"readBuffer",value:function(t){var e=this._bytes.slice(this._position,this._position+t);return this._position+=t,e}},{key:"writeBuffer",value:function(t){for(var e=0,i=t.length;e<i;e++)this._position<this._size?this._bytes.splice(this._position,1,t[e]):(this._bytes.push(t[e]),this._size++),this._position++}},{key:"readByte",value:function(){return this.readUInt8()}},{key:"writeByte",value:function(t){this.writeUInt8(t)}},{key:"readInt8",value:function(){return new Int8Array(this.readBuffer(1))[0]}},{key:"writeInt8",value:function(t){var e=new Uint8Array(1);e[0]=t,this.writeBuffer(e)}},{key:"readUInt8",value:function(){return this.readBuffer(1)[0]}},{key:"writeUInt8",value:function(t){var e=new Uint8Array(1);e[0]=t,this.writeBuffer(e),e=null}},{key:"readInt16",value:function(){var t=this.readBuffer(2);return new j((t[1]<<8)+t[0]).value}},{key:"writeInt16",value:function(t){var e=new Uint16Array(1);e[0]=t,e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.writeBuffer(e)}},{key:"readUInt16",value:function(){var t=this.readBuffer(2);return(t[1]<<8)+t[0]}},{key:"writeUInt16",value:function(t){var e=new Uint16Array(1);e[0]=t,e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.writeBuffer(e)}},{key:"readInt32",value:function(){var t=this.readBuffer(4);return new Q((t[3]<<24)+(t[2]<<16)+(t[1]<<8)+t[0]).value}},{key:"writeInt32",value:function(t){var e=new Uint32Array(1);e[0]=t,e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.writeBuffer(e)}},{key:"readUInt32",value:function(){var t=this.readBuffer(4);return(t[3]<<24)+(t[2]<<16)+(t[1]<<8)+t[0]}},{key:"writeUInt32",value:function(t){var e=new Uint32Array(1);e[0]=t,e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.writeBuffer(e)}},{key:"readInt64",value:function(){var t=this.readBuffer(8),e=new DataView(new Uint8Array(t).buffer);return e.getUint32(0,!0)+(e.getUint32(4,!0)<<32)}},{key:"writeInt64",value:function(){}},{key:"readUInt64",value:function(){var t=this.readBuffer(8);return(t[7]<<56)+(t[6]<<48)+(t[5]<<40)+(t[4]<<32)+(t[3]<<24)+(t[2]<<16)+(t[1]<<8)+t[0]}},{key:"writeUInt64",value:function(t){var e=new Z(t);this.writeBuffer(e.buffer)}},{key:"readSingle",value:function(){var t=this.readBuffer(4);return new Float32Array(new Uint8Array(t).buffer)[0]}},{key:"writeSingle",value:function(t){var e=new Float32Array(1);e[0]=t,e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.writeBuffer(e)}},{key:"readDouble",value:function(){var t=this.readBuffer(8);return new Float64Array(new Uint8Array(t).buffer)[0]}},{key:"writeDouble",value:function(t){var e=new Float64Array(1);e[0]=t,e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.writeBuffer(e)}},{key:"readBoolean",value:function(){return 0!==this.readByte()}},{key:"writeBoolean",value:function(t){this.writeByte(t?1:0)}},{key:"readDateTime",value:function(){var t=this.readDouble(),e=new lt;return e.fromOAData(t),e}},{key:"writeDateTime",value:function(t){var e=t.toOADate();this.writeDouble(e)}},{key:"toJSONString",value:function(){return'{"hcstream":['+this.toString()+"]}"}},{key:"fromJSONString",value:function(t){var e=JSON.parse(t);e.hcstream&&(this._bytes=Array.prototype.slice.call(new Uint8Array(e.hcstream)),this._size=e.hcstream.length,this._position=0)}},{key:"toString",value:function(){for(var t="",e=this._bytes.length,i=0;i<e-1;i++)t+=this._bytes[i]+",";return e>0&&(t+=this._bytes[e-1]),t}},{key:"fromString",value:function(t){this._position=0,this._size=0,this._bytes.length=0;for(var e="",i=t.length,n=0;n<i;n++)","===t[n]?(this._bytes[this._bytes.length]=parseInt(e),e=""):NaN!==parseInt(t[n])&&(e+=t[n]);""!==e&&(this._bytes[this._bytes.length]=parseInt(e)),this._size=this._bytes.length}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._bytes},set:function(t){this._bytes=t,this._size=t.length,this._position=0}},{key:"position",get:function(){return this._position},set:function(t){t<0?this._position=0:t>this._size?this._position=this._size:this._position=t}}],[{key:"loadFromFile",value:function(e,i){var n=new t;n.onLoadFinish=function(t){null!=i&&i(n,t)},n.loadFromFile(e)}}]),t}();var ct=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;r()(this,t),this.interval=e,this._handle=0,this._enable=!1,this._nextTime=0,this._deactivateEnable_=!1,this.onTimer=null}return l()(t,[{key:"_doTimer",value:function(){var t=this;if(this._enable){var e=Date.now()-this._nextTime;this._nextTime+=this.interval,null!==this.onTimer&&this.onTimer(),this._handle=setTimeout((function(){t._doTimer()}),Math.max(0,this.interval-e))}}},{key:"_reset",value:function(){var t=this;this._handle>0&&clearTimeout(this._handle),this._enable&&(this._nextTime=Date.now()+this.interval,this._handle=setTimeout((function(){t._doTimer()}),this.interval))}},{key:"enabled",get:function(){return this._enable},set:function(t){this._enable!=t&&(this._enable=t,this._reset())}}]),t}(),ut=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;r()(this,t),this._handle=0,this._lastExecTime=0,this._stoped=!0,this.loop=!1,this._interval=e,this.onExecute=null}return l()(t,[{key:"_execute",value:function(t){var e=this;if(0==this._lastExecTime)this._lastExecTime=t;else if(t-this._lastExecTime>=this._interval){if(this.doExecute_(),!this.loop)return void this.doStop_();this._lastExecTime=t}this._stoped||(this._handle=window.requestAnimationFrame((function(t){return e._execute(t)})))}},{key:"doStop_",value:function(){this._stoped=!0}},{key:"doExecute_",value:function(){null!=this.onExecute&&this.onExecute()}},{key:"start",value:function(){var t=this;0==this._handle&&(this._stoped=!1,this._lastExecTime=0,this._handle=window.requestAnimationFrame((function(e){return t._execute(e)})))}},{key:"stop",value:function(){this._handle>0&&(window.cancelAnimationFrame(this._handle),this.doStop_(),this._handle=0)}},{key:"enabled",get:function(){return!this._stoped},set:function(t){t?this._stoped&&this.start():this._stoped||this.stop()}}]),t}(),ft=function(){function t(){r()(this,t),this._handle=0,this._startTime=0,this._lastExecTime=0,this._stoped=!0,this.loop=!1,this.loopCount=-1,this.time=1e3,this.onStart=null,this.onExecute=null,this.onStop=null}return l()(t,[{key:"_execute",value:function(t){var e=this;if(0==this._startTime)this._startTime=t;else if(this.doExecute_(t-this._lastExecTime),t-this._startTime>=this.time){if(!this.loop)return void this.doStop_();if(this.loopCount<0)this._startTime=t;else{if(!(this.loopCount>0))return void this.doStop_();this._startTime=t,this.loopCount--}}this._stoped||(this._lastExecTime=t,this._handle=window.requestAnimationFrame((function(t){return e._execute(t)})))}},{key:"doStart_",value:function(){this._startTime=0,this._stoped=!1,null!=this.onStart&&this.onStart()}},{key:"doStop_",value:function(){this._stoped=!0,null!=this.onStop&&this.onStop()}},{key:"doExecute_",value:function(t){null!==this.onExecute&&this.onExecute()}},{key:"start",value:function(){var t=this;this.doStart_(),this._handle=window.requestAnimationFrame((function(e){return t._execute(e)}))}},{key:"stop",value:function(){this._handle>0&&(window.cancelAnimationFrame(this._handle),this.doStop_(),this._handle=0)}}],[{key:"Create",value:function(e){var i=new t;return i.time=e,i}}]),t}(),dt=l()((function t(){r()(this,t),this.rect=new nt,this.text="",this.visible=!1,this.control=null})),mt=(window.AudioContext||window.webkitAudioContext,function(){function t(){r()(this,t)}return l()(t,null,[{key:"request",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=null;if(window.XMLHttpRequest?r=new XMLHttpRequest:window.ActiveXObject&&(r=new ActiveXObject("Microsoft.XMLHTTP")),null!=r){var a=i.toUpperCase(),l=t,h=s,c=e||[],u=[];for(var f in c)u.push(f+"="+encodeURIComponent(c[f]));var d=u.join("&");r.onreadystatechange=function(){4===r.readyState&&(200==r.status?null!==n&&n(r.responseText):null!==o&&o(r))},r.onloadend=function(t){},"GET"==a?(r.open("GET",l+"?"+d,h),r.send(null)):"POST"==a&&(r.open("POST",l,h),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send(d))}else alert("你的浏览器不支持XMLHttp")}},{key:"get",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];t.request(e,i,"GET",n,o,s)}},{key:"post",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];t.request(e,i,"POST",n,o,s)}}]),t}()),St=i(13),pt=i.n(St);function yt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Ft=l()((function t(){r()(this,t)}));Ft.Transparent="rgba(255, 255, 255, 0)",Ft.Red="rgb(255, 0, 0)",Ft.Green="rgb(0, 128, 0)",Ft.Blue="#0000ff",Ft.Black="rgba(0, 0, 0, 255)",Ft.White="rgba(255, 255, 255, 255)",Ft.Yellow="rgb(255, 255, 0)",Ft.Gray="gray",Ft.Pink="rgb(255, 192, 203)",Ft.Crimson="rgb(220, 20, 60)",Ft.Violet="rgb(238, 130, 238)",Ft.Magenta="rgb(255, 0, 255)",Ft.Purple="rgb(128, 0, 128)",Ft.MediumBlue="rgb(0, 0, 205)",Ft.DarkBlue="rgb(0, 0, 139)",Ft.Navy="rgb(0, 0, 128)",Ft.Cyan="rgb(0, 255, 255)",Ft.Teal="rgb(0, 128, 128)",Ft.Lime="rgb(0, 255, 0)",Ft.DarkGreen="rgb(0, 100, 0)",Ft.Gold="rgb(255, 215, 0)",Ft.Orange="rgb(255, 165, 0)",Ft.DarkOrange="rgb(255, 140, 0)",Ft.OrangeRed="rgb(255, 69, 0)",Ft.Brown="rgb(165, 42, 42)",Ft.DarkRed="rgb(139, 0, 0)",Ft.DarkGray="rgb(169, 169, 169)",Ft.LightGray="rgb(211, 211, 211)",Ft.Silver="rgb(192, 192, 192)";var vt=function(){function t(){r()(this,t),this.FUpdateCount=0}return l()(t,[{key:"beginUpdate",value:function(){this.FUpdateCount++}},{key:"endUpdate",value:function(){this.FUpdateCount--,0===this.FUpdateCount&&this.doChange_()}},{key:"onChange",value:function(){}},{key:"doChange_",value:function(){this.onChange()}}]),t}(),It=0,gt=1,Ct=2,wt=4,At=8,Dt=16,Pt=32,kt=64,xt=[{c:"宋体",e:"SimSun",n:"宋体"},{c:"幼圆",e:"YouYuan",n:"幼圆"},{c:"楷体",e:"KaiTi",n:"楷体"},{c:"隶书",e:"LiSu",n:"隶书"},{c:"黑体",e:"SimHei",n:"黑体"},{c:"Arial",e:"Arial",n:"Arial"}],Rt=function(){function t(){for(var e in r()(this,t),this._baseFonts=["monospace","sans-serif","serif"],this._body=document.body,this._span=document.createElement("span"),this._span.style.fontSize="72px",this._span.innerHTML="mmmmmmmmmmlli",this.defaultWidth=[],this.defaultHeight=[],this._baseFonts)this._span.style.fontFamily=this._baseFonts[e],this._body.appendChild(this._span),this.defaultWidth[this._baseFonts[e]]=this._span.offsetWidth,this.defaultHeight[this._baseFonts[e]]=this._span.offsetHeight,this._body.removeChild(this._span)}return l()(t,[{key:"detect",value:function(t){var e,i=!1;for(var n in this._baseFonts)this._span.style.fontFamily=t+","+this._baseFonts[n],this._body.appendChild(this._span),e=this._span.offsetWidth!=this.defaultWidth[this._baseFonts[n]]||this._span.offsetHeight!=this.defaultHeight[this._baseFonts[n]],this._body.removeChild(this._span),i=i||e;return i}}],[{key:"getFontIndex",value:function(t){switch(t){case"宋体":return 1;case"幼圆":return 2;case"楷体":return 3;case"隶书":return 4;case"黑体":return 5;case"Arial":return 6;case"Microsoft Himalaya":return 9;default:return 0}}}]),t}(),Tt=function(){function t(){r()(this,t),this._value=0,this.onChange=null}return l()(t,[{key:"doChange_",value:function(){null!=this.onChange&&this.onChange()}},{key:"has",value:function(t){return(this._value&t)==t}},{key:"add",value:function(t){this._value=this._value|t,this.doChange_()}},{key:"remove",value:function(t){this._value=this._value&~t,this.doChange_()}},{key:"clear",value:function(){this._value=0,this.doChange_()}},{key:"bold",get:function(){return this.has(gt)}},{key:"italic",get:function(){return this.has(Ct)}},{key:"value",get:function(){return this._value},set:function(t){this._value!=t&&(this._value=t,this.doChange_())}}]),t}(),bt=l()((function t(){r()(this,t),this.name=L.DefaultFont,this.size=10,this.measured=!1,this.height=13,this.ascent=11,this.advCharWidth=7,this.color=Ft.Black,this.stylesv=0})),Bt=l()((function t(){r()(this,t),this.width=1,this.color=Ft.Black,this.style=_t.Solid,this.capType=Ot.Square,this.userStyleDash=new Array(0)})),Nt=function(t){m()(i,t);var e=yt(i);function i(t){var n;return r()(this,i),(n=e.call(this)).hcl=t,n._name=L.DefaultFont,n._size=10,n._measured=!1,n._height=13,n._ascent=11,n._otmMacAscent=0,n._otmMacDescent=0,n._externalLeading=2,n._color=Ft.Black,n._advCharWidth=7,n._CJK=!0,n._trueType=!0,n._styles=new Tt,n._styles.onChange=function(){n.doChange_()},n.meaChar=!1,n.onColorChange=null,n}return l()(i,[{key:"_getMeasure",value:function(){var t=i.fontSizeToPt(this._size);switch(this._measured=!1,this._height=0,this._name){case"宋体":case"幼圆":case"楷体":case"隶书":case"黑体":switch(this._trueType=!0,this._CJK=!0,this._advCharWidth=6,t){case 5:case 5.5:this._height=7,this._ascent=6;break;case 6.5:this._height=9,this._ascent=8;break;case 7.5:this._height=10,this._ascent=9;break;case 8:this._height=11,this._ascent=9;break;case 9:this._height=12,this._ascent=10;break;case 10:this._height=13,this._ascent=11;break;case 10.5:this._height=14,this._ascent=12;break;case 11:this._height=15,this._ascent=13;break;case 12:this._height=16,this._ascent=14;break;case 14:this._height=19,this._ascent=16;break;case 15:this._height=20,this._ascent=17;break;case 16:this._height=21,this._ascent=18;break;case 18:this._height=24,this._ascent=21;break;case 20:this._height=27,this._ascent=23;break;case 22:this._height=29,this._ascent=25;break;case 24:this._height=33,this._ascent=28;break;case 26:this._height=35,this._ascent=30;break;case 28:this._height=37,this._ascent=32;break;case 36:this._height=48,this._ascent=41;break;case 42:this._height=56,this._ascent=48;break;case 48:this._height=64,this._ascent=55;break;case 72:this._height=97,this._ascent=83}break;case"Arial":switch(this._trueType=!0,this._CJK=!1,this._advCharWidth=5,t){case 5:case 5.5:this._height=7,this._ascent=6;break;case 6.5:this._styles.bold?(this._height=11,this._ascent=9):(this._height=12,this._ascent=9);break;case 7.5:this._styles.bold&&this._styles.italic?(this._height=11,this._ascent=9):this._styles.bold?(this._height=12,this._ascent=10):(this._height=13,this._ascent=10);break;case 8:this._styles.bold&&this._styles.italic?(this._height=13,this._ascent=11):(this._height=14,this._ascent=11);break;case 9:this._height=15,this._ascent=12;break;case 10:case 10.5:this._height=16,this._ascent=13;break;case 11:this._styles.bold&&!this._styles.italic?(this._height=18,this._ascent=14):(this._height=17,this._ascent=14);break;case 12:this._styles.bold&&!this._styles.italic?(this._height=19,this._ascent=15):!this._styles.bold&&this._styles.italic?(this._height=19,this._ascent=16):(this._height=18,this._ascent=15);break;case 14:this._styles.italic?(this._height=23,this._ascent=18):(this._height=22,this._ascent=18);break;case 15:0==this._styles.value?(this._height=23,this._ascent=19):(this._height=24,this._ascent=19);break;case 16:this._height=24,this._ascent=19;break;case 18:this._styles.italic?(this._height=28,this._ascent=22):this._styles.bold?(this._height=29,this._ascent=23):(this._height=27,this._ascent=21);break;case 20:this._styles.bold&&!this._styles.italic?(this._height=32,this._ascent=25):!this._styles.bold&&this._styles.italic?(this._height=31,this._ascent=25):(this._height=32,this._ascent=26);break;case 22:this._styles.bold||this._styles.italic?(this._height=34,this._ascent=27):(this._height=33,this._ascent=27);break;case 24:this._styles.bold&&!this._styles.italic?(this._height=37,this._ascent=30):!this._styles.bold&&this._styles.italic?(this._height=37,this._ascent=29):(this._height=36,this._ascent=29);break;case 26:this._styles.bold&&!this._styles.italic?(this._height=41,this._ascent=32):(this._height=40,this._ascent=32);break;case 28:this._styles.bold&&!this._styles.italic?(this._height=44,this._ascent=35):!this._styles.bold&&this._styles.italic?(this._height=43,this._ascent=34):(this._height=42,this._ascent=34);break;case 36:this._styles.bold&&!this._styles.italic?(this._height=56,this._ascent=45):!this._styles.bold&&this._styles.italic?(this._height=55,this._ascent=44):(this._height=55,this._ascent=45);break;case 42:!this._styles.bold&&this._styles.italic?(this._height=64,this._ascent=51):(this._height=65,this._ascent=52);break;case 48:this._styles.italic?(this._height=74,this._ascent=59):this._styles.bold?(this._height=75,this._ascent=60):(this._height=72,this._ascent=58);break;case 72:this._styles.bold&&!this._styles.italic?(this._height=111,this._ascent=89):!this._styles.bold&&this._styles.italic?(this._height=109,this._ascent=87):this._styles.bold&&this._styles.italic?(this._height=110,this._ascent=88):(this._height=107,this._ascent=86)}break;default:var e=this.hcl.textMetricsIndexOf(this._name,t,this._styles.value);if(e>=0){var n=this.hcl.textMetrics[e];this._trueType=n.trueType,this._CJK=n.CJK,this._advCharWidth=n.advCharWidth,this._height=n.height,this._ascent=n.ascent}}this._measured=this._height>0}},{key:"_reSetSize",value:function(){if(!(this.FUpdateCount>0||(this._getMeasure(),this._measured))){var t=document.createElement("span");t.style.font=this.contextFont_(),t.innerText="M";var e=document.createElement("div");e.style.display="inline-block",e.style.width="1px",e.style.height="0px";var i=document.createElement("div");i.style.position="absolute",i.style.left="-100px",i.append(e,t),document.body.append(i);try{e.style.verticalAlign="baseline",this._ascent=this._styles.has(Dt)||this._styles.has(Pt)?Math.trunc((e.offsetTop-t.offsetTop)*L.FontSupSubScale):e.offsetTop-t.offsetTop,e.style.verticalAlign="bottom";var n=t.getBoundingClientRect();this._height=this._styles.has(Dt)||this._styles.has(Pt)?Math.trunc(n.height*L.FontSupSubScale):n.height,this._advCharWidth=this._styles.has(Dt)||this._styles.has(Pt)?Math.trunc(n.width*L.FontSupSubScale):n.width}finally{document.body.removeChild(i)}}}},{key:"endUpdate",value:function(){this.FUpdateCount--,0===this.FUpdateCount&&(this._reSetSize(),this.doChange_())}},{key:"assign",value:function(t){this._name=t.name,this._size=t.size,this._color=t.color,this._styles.value=t.styles.value,this._measured=t._measured,this._height=t.height,this._ascent=t.ascent,this._externalLeading=t.externalLeading,this._advCharWidth=t.advCharWidth,this._CJK=t.CJK,this._trueType=t.trueType,this.doChange_()}},{key:"saveInfo",value:function(t){t.name=this._name,t.size=this._size,t.measured=this._measured,t.height=this._height,t.ascent=this._ascent,t.advCharWidth=this._advCharWidth,t.color=this._color,t.stylesv=this._styles.value}},{key:"restoreInfo",value:function(t){this._name=t.name,this._size=t.size,this._measured=t.measured,this._height=t.height,this._ascent=t.ascent,this._advCharWidth=t.advCharWidth,this._color=t.color,this._styles.value=t.stylesv,this.doChange_()}},{key:"toContext",value:function(t){t.font=this.contextFont_(),null!=this._color?t.fillStyle=this._color:t.fillStyle=Ft.Black}},{key:"contextFont_",value:function(){return(this._styles.has(Ct)?"italic ":"")+(this._styles.has(gt)?"bold ":"")+this._size+'pt "'+this._name+'"'}},{key:"name",get:function(){return this._name},set:function(t){this._name!=t&&(this._name=t,this._CJK=/^[\u3220-\uFA29]+$/.test(t),this._reSetSize(),this.doChange_())}},{key:"size",get:function(){return this._size},set:function(t){var e=t;this._size!==e&&(this._size=e,this._reSetSize(),this.doChange_())}},{key:"color",get:function(){return this._color},set:function(t){this._color!=t&&(this._color=t,this.doChange_(),null!=this.onColorChange&&this.onColorChange())}},{key:"styles",get:function(){return this._styles},set:function(t){this._styles=t,this._reSetSize(),this.doChange_()}},{key:"height",get:function(){return this._height}},{key:"advCharWidth",get:function(){return this._advCharWidth}},{key:"CJK",get:function(){return this._CJK}},{key:"trueType",get:function(){return this._trueType}},{key:"ascent",get:function(){return this._ascent}},{key:"descent",get:function(){return this._height-this._ascent}},{key:"externalLeading",get:function(){return this._externalLeading}},{key:"measureName",get:function(){return i.getMeasureName(this.name,this.size,this.styles.value.toString())}}],[{key:"fontSizeToPt",value:function(t){return"初号"==t?42:"小初"==t?36:"一号"==t?26:"小一"==t?24:"二号"==t?22:"小二"==t?18:"三号"==t?16:"小三"==t?15:"四号"==t?14:"小四"==t?12:"五号"==t?10.5:"小五"==t?9:"六号"==t?7.5:"小六"==t?6.5:"七号"==t?5.5:"八号"==t?5:L.isNumber(t)?t:void console.error("无法识别的字号："+t)}},{key:"fontPtToSize",value:function(t){return 42==t?"初号":36==t?"小初":26==t?"一号":24==t?"小一":22==t?"二号":18==t?"小二":16==t?"三号":15==t?"小三":14==t?"四号":12==t?"小四":10.5==t?"五号":9==t?"小五":7.5==t?"六号":6.5==t?"小六":5.5==t?"七号":5==t?"八号":t.toString()}},{key:"fontPixToPt",value:function(t){return 56==t?42:48==t?36:45==t?34:42==t?32:40==t?30:38==t?29:37==t?28:36==t?27:35==t?26:34==t?25:32==t?24:29==t?22:26==t?20:24==t?18:23==t?17:22==t?16:21==t?15:20==t?14.5:19==t?14:18==t?13.5:17==t?13:16==t?12:15==t?11:14==t?10.5:13==t?10:12==t?9:11==t?8:10==t?7.5:9==t?7:8==t?6.5:7==t?5.5:6==t?5:L.Round(t/96*72).toString()}},{key:"getMeasureName",value:function(t,e,n){n&=~(wt|At|Pt|Dt|kt);var o=Rt.getFontIndex(t);return o>0?o+"_"+i.fontSizeToPt(e).toString().replace(".","")+"_"+n.toString():t+"_"+i.fontSizeToPt(e).toString().replace(".","")+"_"+n.toString()}}]),i}(vt),Ot={Square:0,Butt:1,Round:2},_t={Solid:0,Dash:1,Dot:2,DashDot:3,DashDotDot:4,Clear:5,InsideFrame:6,UserStyle:7,Alternate:8},Et=function(t){m()(i,t);var e=yt(i);function i(){var t;return r()(this,i),(t=e.call(this))._width=1,t._color=Ft.Black,t._style=_t.Solid,t._capType=Ot.Square,t._userStyleDash=new Array(0),t}return l()(i,[{key:"assign",value:function(t){this._width=t._width,this._color=t._color,this._style=t._style,this._capType=t._capType,this._userStyleDash=pt()(Array,A()(t._userStyleDash))}},{key:"saveInfo",value:function(t){t.width=this._width,t.color=this._color,t.style=this._style,t.capType=this._capType,t.userStyleDash=this._userStyleDash}},{key:"restoreInfo",value:function(t){this._width=t.width,this._color=t.color,this._style=t.style,this._capType=t.capType,this._userStyleDash=t.userStyleDash,this.doChange_()}},{key:"fromContext",value:function(t){switch(this._width=t.lineWidth,t.lineCap){case"butt":this._capType=Ot.Butt;break;case"round":this._capType=Ot.Round;break;default:this._capType=Ot.Square}t.getLineDash().length>0?this._style=_t.Dash:this._style=_t.Solid,this._color=t.strokeStyle,this.doChange_()}},{key:"toContext",value:function(t){switch(t.lineWidth=this._width,this._capType){case Ot.Butt:t.lineCap="butt";break;case Ot.Round:t.lineCap="round";break;default:t.lineCap="square"}switch(this._style){case _t.Dash:t.setLineDash([4,6]),t.lineDashOffset=0;break;case _t.Dot:t.setLineDash([2,4]),t.lineDashOffset=0;break;case _t.DashDot:t.setLineDash([5,2,2,2]),t.lineDashOffset=0;break;case _t.DashDotDot:t.setLineDash([5,2,2,2,2,2]),t.lineDashOffset=0;break;default:t.setLineDash([])}t.strokeStyle=this._color}},{key:"width",get:function(){return this._width},set:function(t){this._width!=t&&(this._width=t,this.doChange_())}},{key:"color",get:function(){return this._color},set:function(t){this._color!=t&&(this._color=t,this._style!=_t.Clear&&this.doChange_())}},{key:"style",get:function(){return this._style},set:function(t){this._style!=t&&(this._style=t,this.doChange_())}}],[{key:"Create",value:function(t){var e=new i;return e.fromContext(t),e}}]),i}(vt),Mt={Solid:0,Clear:1,Horizontal:2,Vertical:3,FDiagonal:4,BDiagonal:5,Cross:6,DiagCross:7,Gradient:8},Lt={Init:!1,Horizontal:null,Vertical:null,FDiagonal:null,BDiagonal:null,Cross:null,DiagCross:null},Gt=function(t){m()(i,t);var e=yt(i);function i(){var t;return r()(this,i),(t=e.call(this))._color="White",t._style=Mt.Solid,t.onColorChange=null,t}return l()(i,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t?(this._color=t,this._style=Mt.Solid,this.doChange_(),null!==this.onColorChange&&this.onColorChange()):this._style!==Mt.Solid&&(this._style=Mt.Solid,this.doChange_())}},{key:"style",get:function(){return this._style},set:function(t){this._style!=t&&(this._style=t,this.doChange_())}},{key:"fromContext",value:function(t){this.color=t.fillStyle}},{key:"toContext",value:function(t){switch(this._style){case Mt.Solid:t.fillStyle=this._color;break;case Mt.Horizontal:t.fillStyle=t.createPattern(Lt.Horizontal,"repeat");break;case Mt.Vertical:t.fillStyle=t.createPattern(Lt.Vertical,"repeat");break;case Mt.FDiagonal:t.fillStyle=t.createPattern(Lt.FDiagonal,"repeat");break;case Mt.BDiagonal:t.fillStyle=t.createPattern(Lt.BDiagonal,"repeat");break;case Mt.Cross:t.fillStyle=t.createPattern(Lt.Cross,"repeat");break;case Mt.DiagCross:t.fillStyle=t.createPattern(Lt.DiagCross,"repeat");break;default:t.fillStyle="rgba(255, 255, 255, 0)"}}}],[{key:"Create",value:function(t){var e=new i;return e.fromContext(t),e}}]),i}(vt),Ht=1,Vt=2,Ut=3,Wt=function(){function t(e,i){r()(this,t),this.x=e,this.y=i}return l()(t,[{key:"scale",value:function(t){this.x+=t,this.y*=t}},{key:"add",value:function(t){this.x+=t.x,this.y=t.y}},{key:"sub",value:function(t){this.x-=t.x,this.y-=t.y}},{key:"negate",value:function(){this.x=-this.x,this.y=-this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"legnthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"normalize",value:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);return t&&(this.x/=t,this.y/=t),t}},{key:"rotate",value:function(t){var e=this.x,i=this.y,n=Math.cos(t),o=Math.sin(t);this.x=e*n-i*o,this.y=e*o+i*n}}]),t}(),zt=function(t){m()(i,t);var e=yt(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t)).h5context=n,o._scale=1,o._dpr=!1,o._states=new Set([]),o._pfrist=!1,o._px1=-1,o._py1=-1,o._px2=-1,o._py2=-1,o._pywidth=0,o.pen=new Et,o.pen.onChange=function(){o._penChanged()},o._penStack=new st,o._fontStack=new st,o.gradientBrush=null,o.brush=new Gt,o.brush.onChange=function(){o._brushChanged()},o.brush.onColorChange=function(){o._fontChanged()},o.font=new Nt(t),o.font.onChange=function(){o._fontChanged()},o.font.onColorChange=function(){o._brushChanged()},o.scaleSize=et.Create(1,1),o.prepareConext(1),o}return l()(i,[{key:"_penChanged",value:function(){this._states.delete(Vt)}},{key:"_brushChanged",value:function(){this._states.delete(Ut)}},{key:"_fontChanged",value:function(){this._states.delete(Ht)}},{key:"_requiredState",value:function(t){var e=L.setDifference(t,this._states);e.size>0?(e.has(Vt)&&this.pen.toContext(this.h5context),e.has(Ut)&&(this.brush.toContext(this.h5context),this.brush.style==Mt.Gradient&&(this.h5context.fillStyle=this.gradientBrush)),e.has(Ht)&&this.font.toContext(this.h5context),this._states=L.setUnion(this._states,e)):(t.has(Ut)&&(this.brush.toContext(this.h5context),this.brush.style==Mt.Gradient&&(this.h5context.fillStyle=this.gradientBrush),this._states=L.setUnion(this._states,[Ut])),t.has(Ht)&&(this.font.toContext(this.h5context),this._states=L.setUnion(this._states,[Ht])))}},{key:"_pointConnect",value:function(t,e,i,n){if(this.pen.style>_t.Solid&&this.pen.style<_t.Clear)t==i?(this._pfrist?this.h5context.moveTo(t+.5,e):this.h5context.moveTo(this._px2+.5,this._py2),this.h5context.lineTo(i+.5,n)):e==n?(this._pfrist?this.h5context.moveTo(t,e+.5):this.h5context.moveTo(this._px2,this._py2+.5),this.h5context.lineTo(i,n+.5)):(this._pfrist?this.h5context.moveTo(t,e):this.h5context.moveTo(this._px2,this._py2),this.h5context.lineTo(i,n));else if(t==i){var o=this.h5context.fillStyle;this.h5context.fillStyle=this.h5context.strokeStyle,this._pfrist?this.h5context.fillRect(t,e,this.h5context.lineWidth,n-e):this._py1==this._py2&&t==Math.max(this._px1,this._px2)?this.h5context.fillRect(t-this.h5context.lineWidth,e,this.h5context.lineWidth,n-e):this.h5context.fillRect(t,e,this.h5context.lineWidth,n-e),this.h5context.fillStyle=o}else if(e==n){var s=this.h5context.fillStyle;this.h5context.fillStyle=this.h5context.strokeStyle,this._pfrist?this.h5context.fillRect(t,e,i-t,this.h5context.lineWidth):this._px1==this._px2?i<t?this.h5context.fillRect(t+this._pywidth,e,i-t-this._pywidth,this.h5context.lineWidth):this.h5context.fillRect(t-this._pywidth,e,i-t+this._pywidth,this.h5context.lineWidth):this.h5context.fillRect(t,e,i-t,this.h5context.lineWidth),this.h5context.fillStyle=s}else this._pfrist?this.h5context.moveTo(t,e):this.h5context.moveTo(this._px2,this._py2),this.h5context.lineTo(i,n);this._px1=t,this._py1=e,this._px2=i,this._py2=n,this._pywidth=this.h5context.lineWidth,this._pfrist=!1}},{key:"prepareConext",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._scale=t,this._dpr=e>1&&e<1.5,this.h5context.scale(e,e),this.h5context.shadowColor="black",this.h5context.textBaseline="top",this.h5context.textAlign="left",this.h5context.lineCap="square",this.h5context.setLineDash([]),this.h5context.lineDashOffset=0,this.h5context.font="10pt "+L.DefaultFont,this.font.name=L.DefaultFont,this.font.size=10,this.font.styles.clear(),this._states.clear()}},{key:"save",value:function(){this.h5context.save();var t=new bt;this.font.saveInfo(t),this._fontStack.push(t);var e=new Bt;this.pen.saveInfo(e),this._penStack.push(e)}},{key:"restore",value:function(){this.h5context.restore(),this.pen.fromContext(this.h5context),this.brush.fromContext(this.h5context),this.font.restoreInfo(this._fontStack.pop()),this.pen.restoreInfo(this._penStack.pop())}},{key:"translate",value:function(t,e){this.h5context.translate(t,e)}},{key:"clear",value:function(t,e,i,n){this.h5context.clearRect(t,e,i,n)}},{key:"clearRect",value:function(t){this.clear(t.left,t.top,t.width,t.height)}},{key:"clip",value:function(t,e,i,n){this.beginPath(),this.h5context.rect(t,e,i,n),this.closePath(),this.h5context.clip()}},{key:"clipRect",value:function(t){this.clip(t.left,t.top,t.width,t.height)}},{key:"bitBlt",value:function(t,e,i,n,o,s,r,a,l){var h=o.h5context.canvas;this.h5context.drawImage(h,s,r,a,l,t,e,i,n)}},{key:"bitBltRect",value:function(t,e,i){this.bitBlt(t.left,t.top,t.width,t.height,e,i.left,i.top,i.width,i.height)}},{key:"getImageData",value:function(t,e,i,n){return this.h5context.getImageData(t,e,i,n)}},{key:"setImageData",value:function(t,e,i){this.h5context.putImageData(t,e,i)}},{key:"setImageDataBounds",value:function(t,e,i,n,o,s,r){this.h5context.putImageData(t,e,i,n,o,s,r)}},{key:"drawImageData",value:function(t,e,i,n,o){this.hcl.contextTemp.putImageData(t,0,0),this.bitBlt(e,i,n,o,this.hcl.hclCanvasTemp,0,0,n,o)}},{key:"createLinearGradient",value:function(t,e,i,n){return this.h5context.createLinearGradient(t,e,i,n)}},{key:"beginPath",value:function(){this._requiredState(new Set([Vt])),this.h5context.beginPath()}},{key:"closePath",value:function(){this.h5context.closePath()}},{key:"paintPath",value:function(){this.h5context.stroke()}},{key:"fillPath",value:function(){this._requiredState(new Set([Ut])),this.h5context.fill()}},{key:"getTextRect",value:function(t,e){if(""!=t&&0!=e.width){for(var i=this.getTextExtentExPoint(t),n=i.length,o=e.width,s=0,r=0;r<n;)i[r]>o?(s+=this.font.height,r>0&&(o=i[r-1]+e.width)):r++;e.height=s+this.font.height}}},{key:"textOutRect",value:function(t,e){if(""!=t&&0!=e.width){for(var i=this.getTextExtentExPoint(t),n=i.length,o=e.width,s=e.top,r=0,a=0;r<n;)i[r]>o?(this.textOut(e.left,s,t.substr(a,r-a)),s+=this.font.height,a=r,r>0&&(o=i[r-1]+e.width)):r++;this.textOut(e.left,s,t.substr(a,r-a+1))}}},{key:"findUnPlace",value:function(t,e,i){for(var n=t;n<i-1&&M.UnPlaceholderChar.indexOf(e[n+1])>=0;)n++;return n}},{key:"textOut",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._requiredState(new Set([Ht]));var o=!1;this.font.styles.has(Dt)?(this.h5context.save(),this.h5context.scale(L.FontSupSubScale,L.FontSupSubScale),t=Math.trunc(t/L.FontSupSubScale),e=Math.trunc(e/L.FontSupSubScale),o=!0):this.font.styles.has(Pt)&&(this.h5context.save(),this.h5context.scale(L.FontSupSubScale,L.FontSupSubScale),t=Math.trunc(t/L.FontSupSubScale),e=Math.trunc(e/L.FontSupSubScale+this.font.height*L.FontSupSubScale),o=!0);var s=0;if(null!=n){var r=n.length,a=0,l=this.findUnPlace(0,i,r);if(this.h5context.fillText(i.substring(a,l+1),t,e),this._dpr&&this.h5context.fillText(i.substring(a,l+1),t,e),a=l+1,o)for(;a<r;)l=this.findUnPlace(a,i,r),this.h5context.fillText(i.substring(a,l+1),t+n[a-1]+n[a-1],e),this._dpr&&this.h5context.fillText(i.substring(a,l+1),t+n[a-1]+n[a-1],e),a=l+1;else for(;a<r;)l=this.findUnPlace(a,i,r),this.h5context.fillText(i.substring(a,l+1),t+n[a-1],e),this._dpr&&this.h5context.fillText(i.substring(a,l+1),t+n[a-1],e),a=l+1}else this.h5context.fillText(i,t,e),this._dpr&&this.h5context.fillText(i,t,e);if(this.font.styles.has(wt)&&(0===s&&(s=this.measureText(i).width),this.brush.style=Mt.Clear,this.pen.color=this.font.color,this.pen.width=1,this.pen.style=_t.Solid,this.drawLineDriect(t,e+this.font.height,t+s,e+this.font.height)),this.font.styles.has(At)){0===s&&(s=this.measureText(i).width,this.pen.color=this.font.color,this.pen.width=1,this.pen.style=_t.Solid,this.brush.style=Mt.Clear);var h=Math.trunc(this.font.height/2);this.drawLineDriect(t,e+h,t+s,e+h)}o&&this.h5context.restore()}},{key:"textRect",value:function(t,e,i,n){this.save();try{this.clipRect(t),this.textOut(e,i,n)}finally{this.restore()}}},{key:"textOutShadow",value:function(t,e,i,n){this.h5context.shadowBlur=n,this.textOut(t,e,i),this.h5context.shadowBlur=0}},{key:"measureText",value:function(t){if(this.font.meaChar&&null!=this.hcl.localStorage.hcf[this.font.measureName]){for(var e=this.hcl.localStorage.hcf[this.font.measureName],i=t.length,n=0,o=0;o<i;o++)n+=e[t.charCodeAt(o)];return{width:n}}return this.h5context.measureText(t)}},{key:"textWidth",value:function(t){return this._requiredState(new Set([Ht])),this.font.styles.has(Dt)||this.font.styles.has(Pt)?Math.trunc(this.measureText(t).width*L.FontSupSubScale):this.measureText(t).width}},{key:"textHeight",value:function(){return this.font.height}},{key:"getTextExtent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._requiredState(new Set([Ht]));var i=new Array,n=t.length;e>0&&e<n&&(n=e);var o=this.font.styles.has(Dt)||this.font.styles.has(Pt);if(o)if(this.font.meaChar&&null!=this.hcl.localStorage.hcf[this.font.measureName])for(var s=this.hcl.localStorage.hcf[this.font.measureName],r=0;r<n;r++)i[r]=L.Round(s[t.charCodeAt(r)]*L.FontSupSubScale);else for(var a=0;a<n;a++)i[a]=L.Round(this.h5context.measureText(t.charAt(a)).width*L.FontSupSubScale);else if(this.font.meaChar&&null!=this.hcl.localStorage.hcf[this.font.measureName])for(var l=this.hcl.localStorage.hcf[this.font.measureName],h=0;h<n;h++)i[h]=l[t.charCodeAt(h)];else for(var c=0;c<n;c++)i[c]=this.h5context.measureText(t.charAt(c)).width;return i}},{key:"getTextExtentExPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._requiredState(new Set([Ht]));var i=new Array,n=t.length;e>0&&e<n&&(n=e);var o=0,s=0,r=this.font.styles.has(Dt)||this.font.styles.has(Pt);if(r)if(this.font.meaChar&&null!=this.hcl.localStorage.hcf[this.font.measureName])for(var a=this.hcl.localStorage.hcf[this.font.measureName],l=0;l<n;l++)s=L.Round(a[t.charCodeAt(l)]*L.FontSupSubScale),i[l]=o+s,o+=s;else for(var h=0;h<n;h++)s=L.Round(this.h5context.measureText(t.charAt(h)).width*L.FontSupSubScale),i[h]=o+s,o+=s;else if(this.font.meaChar&&null!=this.hcl.localStorage.hcf[this.font.measureName]){for(var c=this.hcl.localStorage.hcf[this.font.measureName],u=0,f=0,d=new Array,m=0,S=!1;u<n-1;)if(S||(f=u),M.UnPlaceholderChar.indexOf(t[u+1])>=0)d.push(u),u++,S=!0;else{if(S=!1,s=c[t.charCodeAt(f)],i[u]=o+s,d.length>0){for(var p=s/((m=d.length)+1),y=o,F=0;F<m;F++)i[d[F]]=y+p,y+=p;d.splice(0,m)}o+=s,u++}if(s=S?c[t.charCodeAt(f)]:c[t.charCodeAt(n-1)],i[n-1]=o+s,d.length>0){for(var v=s/((m=d.length)+1),I=o,g=0;g<m;g++)i[d[g]]=I+v,I+=v;d.splice(0,m)}}else{for(var C="",w=0,A=new Array,D=0;w<n-1;)if(C+=t[w],M.UnPlaceholderChar.indexOf(t[w+1])>=0)A.push(w),w++;else{if(s=this.h5context.measureText(C).width,i[w]=o+s,A.length>0){for(var P=s/((D=A.length)+1),k=o,x=0;x<D;x++)i[A[x]]=k+P,k+=P;A.splice(0,D)}o+=s,C="",w++}if(C+=t[n-1],s=this.h5context.measureText(C).width,i[n-1]=o+s,A.length>0){for(var R=s/((D=A.length)+1),T=o,b=0;b<D;b++)i[A[b]]=T+R,T+=R;A.splice(0,D)}}return i}},{key:"textExtent",value:function(t){return this.textMetric(t)}},{key:"textMetric",value:function(t){var e=new it;return e.width=this.textWidth(t),e.height=this.font.height,e}},{key:"drawImage",value:function(t,e,i){this.h5context.drawImage(i,t,e)}},{key:"drawImageRect",value:function(t,e){this.h5context.drawImage(e,t.left,t.top,t.width,t.height)}},{key:"toImage",value:function(t){return this.h5context.canvas.toDataURL("png")}},{key:"moveTo",value:function(t,e){this._pfrist=!0,this._px1=t,this._py1=e,this._px2=-1e4,this._py2=-1e4}},{key:"moveToPoint",value:function(t){this.moveTo(t.x,t.y)}},{key:"lineTo",value:function(t,e){this._pfrist?this._pointConnect(this._px1,this._py1,t,e):this._pointConnect(this._px2,this._py2,t,e)}},{key:"arrow",value:function(t,e,i,n,o){var s=new Wt(i-t,n-e);s.normalize(),this.h5context.save(),this.h5context.translate(i-o*s.x,n-o*s.y),this.h5context.moveTo(-o*s.y,o*s.x),this.h5context.lineTo(o*s.x,o*s.y),this.h5context.lineTo(o*s.y,-o*s.x),this.h5context.stroke(),this.h5context.restore()}},{key:"arrowLine",value:function(t,e,i,n,o){this.h5context.moveTo(t,e),this.h5context.lineTo(i,n),this.arrow(t,e,i,n,o)}},{key:"bezierCurve",value:function(t,e,i,n,o,s,r,a){this.h5context.beginPath(),this.h5context.moveTo(t,e),this.h5context.bezierCurveTo(o,s,r,a,i,n),this.h5context.stroke()}},{key:"lineToPoint",value:function(t){this.lineTo(t.x,t.y)}},{key:"drawLine",value:function(t,e,i,n){this._pfrist=!0,this._pointConnect(t,e,i,n)}},{key:"drawLineByPoints",value:function(t){if(!(t.length<2)){this._pfrist=!0;for(var e=0;e<t.length-1;e++)this._pointConnect(t[e].x,t[e].y,t[e+1].x,t[e+1].y)}}},{key:"drawLineDriect",value:function(t,e,i,n){this.beginPath(),this.drawLine(t,e,i,n),this.paintPath()}},{key:"drawVerticalLineDriect",value:function(t,e,i){this.beginPath(),this.drawLine(t,e,t,i),this.paintPath()}},{key:"drawHorizontalLineDriect",value:function(t,e,i){this.beginPath(),this.drawLine(e,t,i,t),this.paintPath()}},{key:"ellipseBounds",value:function(t,e,i,n){this._requiredState(new Set([Vt,Ut]));var o=Math.trunc(i/2),s=Math.trunc(n/2);this.h5context.ellipse(t+o,e+s,o,s,0,0,2*Math.PI)}},{key:"ellipseRect",value:function(t){this.ellipseBounds(t.left,t.top,t.width,t.height)}},{key:"ellipseDriect",value:function(t,e,i,n){var o=Math.min(t,i),s=Math.min(e,n);this.ellipseBoundsDriect(o,s,Math.abs(i-t),Math.abs(n-e))}},{key:"ellipseBoundsDriect",value:function(t,e,i,n){this.beginPath(),this.ellipseBounds(t,e,i,n),this.paintPath(),this.brush.style!=Mt.Clear&&this.h5context.fill()}},{key:"ellipseRectDriect",value:function(t){this.ellipseBoundsDriect(t.left,t.top,t.width,t.height)}},{key:"drawLineByPointsDriect",value:function(t){this.beginPath(),this.drawLineByPoints(t),this.paintPath()}},{key:"rectangleBounds",value:function(t,e,i,n){this.beginPath(),this.drawLine(t,e,t+i-this.pen.width,e),this.drawLine(t+i-this.pen.width,e,t+i-this.pen.width,e+n-this.pen.width),this.drawLine(t+i,e+n-this.pen.width,t,e+n-this.pen.width),this.drawLine(t,e+n-this.pen.width,t,e),this.paintPath()}},{key:"rectangle",value:function(t,e,i,n){this.rectangleBounds(t,e,i-t,n-e)}},{key:"rectangleRect",value:function(t){this.rectangle(t.left,t.top,t.right,t.bottom)}},{key:"_roundRectPath",value:function(t,e,i,n,o){this.h5context.moveTo(t+o,e),this.h5context.arcTo(t+i,e,t+i,e+n,o),this.h5context.arcTo(t+i,e+n,t,e+n,o),this.h5context.arcTo(t,e+n,t,e,o),this.h5context.arcTo(t,e,t+i,e,o)}},{key:"roundBounds",value:function(t,e,i,n,o){this.beginPath(),this._roundRectPath(t,e,i,n,o),this.paintPath()}},{key:"roundRect",value:function(t,e){this.roundBounds(t.left,t.top,t.width,t.height,e)}},{key:"fillBounds",value:function(t,e,i,n){this.brush.style!==Mt.Clear&&(this._requiredState(new Set([Ut])),this.h5context.fillRect(t,e,i,n))}},{key:"fillRect",value:function(t){this.fillBounds(t.left,t.top,t.width,t.height)}},{key:"fillRoundBounds",value:function(t,e,i,n,o){this._requiredState(new Set([Ut])),this.beginPath(),this._roundRectPath(t,e,i,n,o),this.closePath(),this.h5context.fill(),this.pen.style!=_t.Clear&&this.paintPath()}},{key:"fillRoundRect",value:function(t,e){this.fillRoundBounds(t.left,t.top,t.width,t.height,e)}},{key:"fillBoundShadow",value:function(t,e,i,n,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;this.h5context.shadowBlur=o,this.h5context.shadowColor=this.hcl.theme.ShadowColor,this.h5context.shadowOffsetX=s,this.h5context.shadowOffsetY=r,this.fillBounds(t,e,i,n),this.h5context.shadowBlur=0,this.h5context.shadowOffsetX=0,this.h5context.shadowOffsetY=0}},{key:"fillRectShadow",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.fillBoundShadow(t.left,t.top,t.width,t.height,e,i,n)}},{key:"fillEllipseRect",value:function(t){this.fillEllipseBounds(t.left,t.top,t.width,t.height)}},{key:"fillEllipseBounds",value:function(t,e,i,n){this._requiredState(new Set([Vt,Ut]));var o=Math.trunc(i/2),s=Math.trunc(n/2);this.beginPath(),this.h5context.ellipse(t+o,e+s,o,s,0,0,2*Math.PI),this.closePath(),this.h5context.fill()}},{key:"fillRegion",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"repeat",n=t.length;if(!(n<3)){e&&(this.brush.style=this.h5context.createPattern(e,i)),this._requiredState(new Set([Vt,Ut])),this.h5context.beginPath(),this.h5context.moveTo(t[0].x,t[0].y);for(var o=1;o<n;o++)this.h5context.lineTo(t[o].x,t[o].y);this.h5context.closePath(),this.h5context.fill()}}},{key:"scale",value:function(t,e){this.scaleSize.reset(t,e),this.h5context.scale(t,e)}},{key:"alpha",get:function(){return this.h5context.globalAlpha},set:function(t){this.h5context.globalAlpha=t}}],[{key:"CreateTemp",value:function(t,e,n){var o=document.createElement("canvas");return o.width=e,o.height=n,new i(t,o.getContext("2d"))}},{key:"DestroyTemp",value:function(t){t.h5context.canvas.remove()}}]),i}(tt),Kt=i(7),Jt=i.n(Kt);function jt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Yt=0,Qt=1,Xt=2,Zt=3,qt=4,$t=5,te=0,ee=1,ie=1,ne=2,oe=1,se=2,re=3,ae=1,le=2,he=3,ce=1,ue=2,fe=4,de=8,me=function(t){m()(i,t);var e=jt(i);function i(){var t,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return r()(this,i),t=e.call(this),n&&(t.add(ce),t.add(ue),t.add(fe),t.add(de)),t}return l()(i)}(q),Se=0,pe=1,ye=2,Fe=3,ve=4,Ie=5,ge=6,Ce=7,we=8,Ae=10,De=11,Pe=12,ke=13,xe=14,Re=15,Te=0,be=1,Be=2,Ne=1,Oe=2,_e=0,Ee=8,Me=9,Le=13,Ge=16,He=17,Ve=18,Ue=27,We=32,ze=35,Ke=36,Je=37,je=38,Ye=39,Qe=40,Xe=46,Ze=65,qe=77,$e=82,ti=89,ei=90,ii=160,ni=161,oi=162,si=163,ri=164,ai=165,li=10,hi=1003,ci=function(t){m()(i,t);var e=jt(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).publishProperty=new ot,n}return l()(i,[{key:"addPublisProperty",value:function(t){this.publishProperty.add(t)}}]),i}(function(t){m()(i,t);var e=jt(i);function i(t){return r()(this,i),e.call(this,t)}return l()(i,[{key:"assign",value:function(t){}}]),i}(tt)),ui=function(){function t(){r()(this,t),this.reset()}return l()(t,[{key:"reset",value:function(){this.control=null,this.controlScreenRect=new nt,this.image=null,this.left=0,this.top=0,this.width=2,this.height=16,this.color=Ft.Black,this.shan=!0,this.visible=!1}},{key:"rect",get:function(){return nt.CreateByBounds(this.left,this.top,this.width,this.height)}}]),t}(),fi=function(){function t(){r()(this,t),this.shiftState=new Set([]),this.button=0,this.x=0,this.y=0,this.delta=0,this.clicks=0,this.drag=!1}return l()(t,[{key:"assign",value:function(t){this.shiftState=t.shiftState,this.button=t.button,this.x=t.x,this.y=t.y,this.delta=t.delta,this.clicks=t.clicks,this.drag=t.drag}}]),t}(),di=function(){function t(){r()(this,t),this.shiftState=new Set([]),this.key="",this.keyCode=0}return l()(t,[{key:"assign",value:function(t){this.shiftState=new Set(A()(t.shiftState)),this.key=t.key,this.keyCode=t.keyCode}}]),t}(),mi=function(t){m()(i,t);var e=jt(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).state_=new Set([Ri.Creating]),n.designState=!1,n._marginLeft=0,n._marginTop=0,n._marginRight=0,n._marginBottom=0,n._paddingLeft=0,n._paddingTop=0,n._paddingRight=0,n._paddingBottom=0,n.align_=Yt,n._parent=null,n.canFocus=!1,n._focused=!1,n.popupMenu_=null,n._rotate=0,n.transparent=!1,n.color_=null,n.alpha_=1,n.updateCount_=0,n.resWait_=0,n.left_=0,n.top_=0,n.width_=75,n.height_=25,n.enabled_=!0,n.visible_=!0,n.drawShadow=!1,n.hint_="",n.tab_=-1,n.cursor_=Se,n.handle_=0,n.mouseStates=new Set([]),n.tag=null,n.state_.delete(Ri.Creating),n.onGetParent=null,n.onKillFocus=null,n}return l()(i,[{key:"hclSelect",value:function(){this.hcl.application.hclSelectControl(this)}},{key:"_paintexec",value:function(t){this.transparent||this.doPaintBackground_(t),this.doPaint_(t)}},{key:"_setBounds",value:function(){this.doSetBounds_(),this.doResize_()}},{key:"doSetBounds_",value:function(){null!=this.parent&&this.parent.reAlign()}},{key:"doResize_",value:function(){this.onResize()}},{key:"doRequestFocus_",value:function(){return!(!this.visible_||!this.enabled_||this.state_.has(Ri.Creating))}},{key:"doSetFocus_",value:function(t){if(null!==this.parent){for(var e=!0,i=this;null!==i.parent;)if(!(i=i.parent).doRequestFocus_()){e=!1;break}e?(this._focused=t,this.parent.setFocusControl_(this,t)):this.killFocus()}}},{key:"doKillFocus_",value:function(){this._focused=!1,this.onKillFocus&&this.onKillFocus(),null!=this.parent&&this.parent.killFocusControl_(this),this.hcl.ime._control===this&&this.hcl.ime.killFocus()}},{key:"getHint_",value:function(){return this.hint_}},{key:"setHint_",value:function(t){this.hint_=t}},{key:"added_",value:function(t){this._parent=t}},{key:"removed_",value:function(){this.deactivate(),this._parent=null}},{key:"controlVisible_",value:function(t,e){}},{key:"doGetParent_",value:function(){return null!==this._parent?this._parent:null!==this.onGetParent?this.onGetParent():null}},{key:"doSetParent_",value:function(t){this._parent!=t&&(null!=this._parent&&this._parent.removeControl(this),null!=t?t.addControl(this):this.removed_())}},{key:"doEnableChange_",value:function(t){t||this.doMouseLeave_(),this.update()}},{key:"doVisibleChange_",value:function(t){this.state_.add(Ri.VisibleChange),this.update(),this.state_.delete(Ri.VisibleChange),null!==this._parent&&this._parent.controlVisible_(this,t),this.visible_&&this.onShow?this.onShow():!this.visible_&&this.onHide&&this.onHide()}},{key:"doSetMarginLeft_",value:function(t){this._marginLeft=t,this.reAlign()}},{key:"doSetMarginTop_",value:function(t){this._marginTop=t,this.reAlign()}},{key:"doSetMarginRight_",value:function(t){this._marginRight=t,this.reAlign()}},{key:"doSetMarginBottom_",value:function(t){this._marginBottom=t,this.reAlign()}},{key:"doSetPaddingLeft_",value:function(t){this._paddingLeft=t,this.reAlign()}},{key:"doSetPaddingTop_",value:function(t){this._paddingTop=t,this.reAlign()}},{key:"doSetPaddingRight_",value:function(t){this._paddingRight=t,this.reAlign()}},{key:"doSetPaddingBottom_",value:function(t){this._paddingBottom=t,this.reAlign()}},{key:"doMouseEnter_",value:function(){this.mouseStates.add(ie),this.hcl.application.setCursorBy(this),this.onMouseEnter()}},{key:"doMouseLeave_",value:function(){this.mouseStates.delete(ie),this.mouseStates.delete(ne),this.onMouseLeave()}},{key:"doMouseWheel_",value:function(t){this.onMouseWheel(t)}},{key:"doMouseDown_",value:function(t){this.mouseStates.add(ne),this.canFocus&&this.setFocus(),this.onMouseDown(t)}},{key:"doMouseMove_",value:function(t){this.onMouseMove(t)}},{key:"doMouseUp_",value:function(t){this.mouseStates.has(ne)&&(this.mouseStates.delete(ne),this.onMouseUp(t),t.button===ae&&this.clientRect().pointInAt(t.x,t.y)?this.doClick_():t.button===le&&(this.doContextMenu_(t.x,t.y),this.onContextmenu()))}},{key:"doDragenter_",value:function(t){}},{key:"doDragover_",value:function(t){}},{key:"doDragleave_",value:function(t){}},{key:"doDrop_",value:function(t){}},{key:"doClick_",value:function(){this.onClick(this)}},{key:"doDblClick_",value:function(t){this.onDblClick(t)}},{key:"doKeyDown_",value:function(t){this.onKeyDown(t)}},{key:"doKeyPress_",value:function(t){this.onKeyPress(t)}},{key:"doKeyUp_",value:function(t){this.onKeyUp(t)}},{key:"doCopy_",value:function(t){this.onCopy(t)}},{key:"doCut_",value:function(t){this.onCut(t)}},{key:"doPaste_",value:function(t){this.onPaste(t)}},{key:"doPaintBackground_",value:function(t){this.onPaintBackground(t)}},{key:"doPaint_",value:function(t){this.onPaint(t)}},{key:"doContextMenu_",value:function(t,e){if(null!=this.popupMenu_){var i=this.clientToScreen(new et(0,0));this.popupMenu_.popup(i.x+t,i.y+e)}}},{key:"doGetPopupMenu",value:function(){return this.popupMenu_}},{key:"doSetPopupMenu",value:function(t){this.popupMenu_=t}},{key:"setSize",value:function(t,e){this.width_=t,this.height_=e,this._setBounds()}},{key:"clientRect",value:function(){return nt.Create(0,0,this.width,this.height)}},{key:"bounds",value:function(){return nt.CreateByBounds(this.left,this.top,this.width,this.height)}},{key:"location",value:function(){return et.Create(this.left,this.top)}},{key:"mouseEnter",value:function(){this.enabled_&&this.doMouseEnter_()}},{key:"mouseLeave",value:function(){this.enabled_&&this.doMouseLeave_()}},{key:"mouseDown",value:function(t){this.enabled_&&this.doMouseDown_(t)}},{key:"mouseWheel",value:function(t){this.enabled_&&this.doMouseWheel_(t)}},{key:"mouseMove",value:function(t){this.enabled_&&this.doMouseMove_(t)}},{key:"mouseUp",value:function(t){this.enabled_&&this.doMouseUp_(t)}},{key:"dblClick",value:function(t){this.enabled_&&this.doDblClick_(t)}},{key:"keyDown",value:function(t){this.enabled_&&(this.state_.add(Ri.KeyDown),this.doKeyDown_(t))}},{key:"keyPress",value:function(t){this.enabled_&&this.state_.has(Ri.KeyDown)&&this.doKeyPress_(t)}},{key:"keyUp",value:function(t){this.enabled_&&(this.doKeyUp_(t),this.state_.delete(Ri.KeyDown))}},{key:"dragenter",value:function(t){this.enabled_&&this.doDragenter_(t)}},{key:"dragover",value:function(t){this.enabled_&&this.doDragover_(t)}},{key:"dragleave",value:function(t){this.enabled_&&this.doDragleave_(t)}},{key:"drop",value:function(t){this.enabled_&&this.doDrop_(t)}},{key:"copy",value:function(t){this.enabled_&&this.doCopy_(t)}},{key:"cut",value:function(t){this.enabled_&&this.doCut_(t)}},{key:"paste",value:function(t){this.enabled_&&this.doPaste_(t)}},{key:"dispose",value:function(){null!=this._parent&&this._parent.removeControl(this),f()(F()(i.prototype),"dispose",this).call(this)}},{key:"broadcast",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(t){case li:this.designState=e}}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){this.killFocus()}},{key:"reAlign",value:function(){this.update()}},{key:"offset",value:function(t,e){this.left_=this.left_+t,this.top_=this.top_+e,this._setBounds()}},{key:"setLocal",value:function(t,e){this.left_=t,this.top_=e,this._setBounds()}},{key:"clientToScreenAt",value:function(t,e){return this.clientToScreen(et.Create(t,e))}},{key:"clientToScreen",value:function(t){return t.x+=this.left_,t.y+=this.top_,null!==this.parent?this.parent.clientToScreen(t):t}},{key:"screenToClientAt",value:function(t,e){return this.screenToClient(et.Create(t,e))}},{key:"screenToClient",value:function(t){var e=null;return null!==this.parent?((e=et.CreateByPoint(this.parent.screenToClient(t))).x-=this.left_,e.y-=this.top_):e=et.Create(t.x-this.left_,t.y-this.top_),e}},{key:"isChildControl",value:function(t){for(var e=this;null!=e.parent;)if((e=e.parent)===t)return!0;return!1}},{key:"getHintRect",value:function(){return this.clientRect()}},{key:"paint",value:function(t){if(!(this.updateCount_>0))if(1!=this.alpha_){t.save();try{t.alpha=this.alpha_,this._paintexec(t)}finally{t.restore()}}else this._paintexec(t)}},{key:"paintTo",value:function(t,e,i){t.save();try{t.translate(e,i),this.paint(t)}finally{t.restore()}}},{key:"updateRect",value:function(t){this.resWait>0||this.updateCount_>0||this.state_.has(Ri.Creating)||this.state_.has(Ri.Aligning)||(this.visible_||this.state_.has(Ri.VisibleChange))&&(null!==this.parent?this.parent.updateRect(t.offset(this.left,this.top,!0)):this.onUpdate(t))}},{key:"update",value:function(){this.updateRect(this.clientRect())}},{key:"setFocus",value:function(){this._focused||(this.canFocus?(this.doSetFocus_(!0),this._focused&&this.update()):this.doSetFocus_(!1))}},{key:"tabSetFocus",value:function(){this.setFocus()}},{key:"killFocus",value:function(){this._focused&&(this.doKillFocus_(),this.mouseStates.clear(),this.update())}},{key:"beginUpdate",value:function(){this.updateCount_++}},{key:"endUpdate",value:function(){this.updateCount_>0&&(this.updateCount_--,0==this.updateCount_&&this.update())}},{key:"incResWait",value:function(){this.resWait_++}},{key:"decResWait",value:function(){this.resWait_>0&&(this.resWait_--,0===this.resWait_&&this.update())}},{key:"left",get:function(){return this.left_},set:function(t){this.left_!=t&&(this.left_=t,this._setBounds())}},{key:"top",get:function(){return this.top_},set:function(t){this.top_!=t&&(this.top_=t,this._setBounds())}},{key:"right",get:function(){return this.left_+this.width_},set:function(t){t>this.left_&&(this.width=t-this.left_)}},{key:"bottom",get:function(){return this.top_+this.height_},set:function(t){t>this.top_&&(this.height=t-this.top_)}},{key:"width",get:function(){return this.width_},set:function(t){this.width_!=t&&(this.width_=t,this._setBounds())}},{key:"height",get:function(){return this.height_},set:function(t){this.height_!=t&&(this.height_=t,this._setBounds())}},{key:"alpha",get:function(){return this.alpha_},set:function(t){this.alpha_!=t&&(this.alpha_=t,this.update())}},{key:"color",get:function(){return this.color_},set:function(t){this.color_!=t&&(this.color_=t,this.update())}},{key:"rotate",get:function(){return this._rotate},set:function(t){this._rotate!=t&&(this._rotate=t,this._setBounds())}},{key:"hint",get:function(){return this.getHint_()},set:function(t){this.setHint_(t)}},{key:"tab",get:function(){return this.tab_},set:function(t){this.tab_!=t&&this.parent.setTab(this,t)}},{key:"mouseIn",get:function(){return this.mouseStates.has(ie)}},{key:"align",get:function(){return this.align_},set:function(t){this.align_!=t&&(this.align_=t,null!=this.parent&&this.parent.reAlign())}},{key:"marginLeft",get:function(){return this._marginLeft},set:function(t){this.doSetMarginLeft_(t)}},{key:"marginTop",get:function(){return this._marginTop},set:function(t){this.doSetMarginTop_(t)}},{key:"marginRight",get:function(){return this._marginRight},set:function(t){this.doSetMarginRight_(t)}},{key:"marginBottom",get:function(){return this._marginBottom},set:function(t){this.doSetMarginBottom_(t)}},{key:"paddingLeft",get:function(){return this._paddingLeft},set:function(t){this.doSetPaddingLeft_(t)}},{key:"paddingTop",get:function(){return this._paddingTop},set:function(t){this.doSetPaddingTop_(t)}},{key:"paddingRight",get:function(){return this._paddingRight},set:function(t){this.doSetPaddingRight_(t)}},{key:"paddingBottom",get:function(){return this._paddingBottom},set:function(t){this.doSetPaddingBottom_(t)}},{key:"enabled",get:function(){return this.enabled_},set:function(t){this.enabled_!=t&&(this.enabled_=t,this.doEnableChange_(t))}},{key:"visible",get:function(){return this.visible_},set:function(t){this.visible_!=t&&(this.visible_=t,this.doVisibleChange_(t))}},{key:"focused",get:function(){return this._focused}},{key:"parent",get:function(){return this.doGetParent_()},set:function(t){this.doSetParent_(t)}},{key:"cursor",get:function(){return this.cursor_},set:function(t){this.cursor_!=t&&(this.cursor_=t,this.hcl.application.setCursorBy(this))}},{key:"popupMenu",get:function(){return this.doGetPopupMenu()},set:function(t){this.doSetPopupMenu(t)}},{key:"onResize",value:function(){}},{key:"onContextmenu",value:function(){}},{key:"onMouseEnter",value:function(){}},{key:"onMouseLeave",value:function(){}},{key:"onPaintBackground",value:function(t){}},{key:"onUpdate",value:function(t){}},{key:"onPaint",value:function(t){}},{key:"onMouseWheel",value:function(t){}},{key:"onMouseDown",value:function(t){}},{key:"onMouseMove",value:function(t){}},{key:"onClick",value:function(t){}},{key:"onDblClick",value:function(t){}},{key:"onMouseUp",value:function(t){}},{key:"onKeyDown",value:function(t){}},{key:"onKeyPress",value:function(t){}},{key:"onKeyUp",value:function(t){}},{key:"onCopy",value:function(t){}},{key:"onCut",value:function(t){}},{key:"onPaste",value:function(t){}}]),i}(ci),Si=function(t){m()(i,t);var e=jt(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).width_=100,n.height_=100,n.dropDownStyle=!1,n.popupLinkedList=null,n.forward=null,n.next=null,n.onClose=null,n.onDone=null,n.onGetHint=null,n}return l()(i,[{key:"getHint_",value:function(){return null!==this.onGetHint?this.onGetHint():f()(F()(i.prototype),"getHint_",this).call(this)}},{key:"getHintRect",value:function(){return null}},{key:"doPaintBackground_",value:function(t){var e=this.clientRect();this.hcl.theme.drawShadow(t,e,this.dropDownStyle),t.brush.color=this.hcl.theme.backgroundStaticColor,t.fillRect(e),f()(F()(i.prototype),"doPaintBackground_",this).call(this,t)}},{key:"getControlAtPos",value:function(t,e){return this}},{key:"updateRect",value:function(t){this.hcl.application.updateRect(t.offset(this.left,this.top,!0))}},{key:"update",value:function(){this.updateRect(this.clientRect())}},{key:"popup",value:function(t,e,i){this.left=t,this.top=e,this.visible=!0,this.hcl.application.trackPopupControl(this,i)}},{key:"popupControl",value:function(t){var e=t.clientToScreenAt(0,0);this.popup(e.x,e.y+t.height,!0)}},{key:"closePopup",value:function(){null!==this.onClose&&this.onClose()}},{key:"donePopup",value:function(){null!=this.onDone&&this.onDone(),this.hcl.application.closePopupControl(this.popupLinkedList.first)}},{key:"close",value:function(){this.hcl.application.closePopupControl(this)}}]),i}(mi),pi=0,yi=1,Fi=2,vi=3,Ii=0,gi=1,Ci=2,wi=3,Ai=4,Di=function(t){m()(i,t);var e=jt(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).width_=100,n.height_=20,n.min_=0,n.max_=0,n.pageSize_=0,n.position_=0,n.range_=0,n.precent_=0,n.leftBlank_=0,n.rightBlank_=0,n.buttonSize=20,n.btnStep_=5,n.thumRect_=new nt,n.leftBtnRect_=new nt,n.rightBtnRect_=new nt,n.mouseDownPt_=new et,n.mouseDownControl_=pi,n.orientation_=te,n.align_=qt,n._onScroll=null,n}return l()(i,[{key:"_reCalcButtonRect",value:function(){this.orientation_==te?(this.leftBtnRect_=nt.CreateByBounds(this.leftBlank_,0,this.buttonSize,this.height),this.rightBtnRect_=nt.CreateByBounds(this.width-this.rightBlank_-this.buttonSize,0,this.buttonSize,this.height)):(this.leftBtnRect_=nt.CreateByBounds(0,this.leftBlank_,this.width,this.buttonSize),this.rightBtnRect_=nt.CreateByBounds(0,this.height-this.rightBlank_-this.buttonSize,this.width,this.buttonSize))}},{key:"_reCalcThumRect",value:function(){var t=0,e=0;if(this.orientation_==te)if(this.thumRect_.top=0,this.thumRect_.bottom=this.height,this.pageSize_<this.range_){if(t=this.pageSize_/this.range_,(e=L.Round((this.width-this.leftBlank_-this.rightBlank_-2*this.buttonSize)*t))<this.buttonSize&&(e=this.buttonSize),this.precent_=(this.width-this.leftBlank_-this.rightBlank_-2*this.buttonSize-e)/(this.range_-this.pageSize_),this.precent_<0)return;this.thumRect_.left=this.leftBlank_+this.buttonSize+L.Round(this.position_*this.precent_),this.thumRect_.right=this.thumRect_.left+e}else this.thumRect_.left=this.leftBlank_+this.buttonSize,this.thumRect_.right=this.width-this.rightBlank_-this.buttonSize;else if(this.thumRect_.left=0,this.thumRect_.right=this.width,this.pageSize_<this.range_){if(t=this.pageSize_/this.range_,(e=L.Round((this.height-this.leftBlank_-this.rightBlank_-2*this.buttonSize)*t))<this.buttonSize&&(e=this.buttonSize),this.precent_=(this.height-this.leftBlank_-this.rightBlank_-2*this.buttonSize-e)/(this.range_-this.pageSize_),this.precent_<0)return;this.thumRect_.top=this.leftBlank_+this.buttonSize+L.Round(this.position_*this.precent_),this.thumRect_.bottom=this.thumRect_.top+e}else this.thumRect_.top=this.leftBlank_+this.buttonSize,this.thumRect_.bottom=this.height-this.rightBlank_-this.buttonSize;0==this.precent_&&(this.precent_=1)}},{key:"_setOrientation",value:function(t){this.orientation_!=t&&(this.orientation_=t,t==te?(this.height_=this.buttonSize,this.align=qt):(this.width_=this.buttonSize,this.align=Zt))}},{key:"_setMin",value:function(t){this.min_!=t&&(t>this.max_?this.min_=this.max_:this.min_=t,this.position_<this.min_&&(this.position_=this.min_),this.range_=this.max_-this.min_,this._reCalcThumRect(),this._updateRangRect())}},{key:"_setMax",value:function(t){this.max_!=t&&(t<this.min_?this.max_=this.min_:this.max_=t,this.position_+this.pageSize_>this.max_&&(this.position_=Math.max(this.max_-this.pageSize_,this.min_)),this.range_=this.max_-this.min_,this._reCalcThumRect(),this._updateRangRect())}},{key:"_setPageSize",value:function(t){this.pageSize_!=t&&(this.pageSize_=t,this.position_+this.pageSize_>this.max_&&(this.position_=Math.max(this.max_-this.pageSize_,this.min_)),this._reCalcThumRect(),this._updateRangRect())}},{key:"_setPosition",value:function(t){var e=0;e=t<this.min_?this.min_:t+this.pageSize_>this.max_?Math.max(this.max_-this.pageSize_,this.min_):t,this.position_!=e&&(this.position_=e,this._reCalcThumRect(),this._updateRangRect(),null!=this._onScroll&&this._onScroll(Ai,this.position_))}},{key:"scrollStep_",value:function(t){var e=0;switch(t){case Ii:(e=this.position_-this.btnStep_)<this.min_&&(e=this.min_),this.position_!=e&&(this.position=e);break;case gi:(e=this.position_+this.btnStep_)>this.range_-this.pageSize_&&(e=this.range_-this.pageSize_),this.position_!=e&&(this.position=e);break;case Ci:(e=this.position_-this.pageSize_)<this.min_&&(e=this.min_),this.position_!=e&&(this.position=e);break;case wi:(e=this.position_+this.pageSize_)>this.range_-this.pageSize_&&(e=this.range_-this.pageSize_),this.position_!=e&&(this.position=e)}}},{key:"doMouseDown_",value:function(t){f()(F()(i.prototype),"doMouseDown_",this).call(this,t),this.mouseDownPt_.x=t.x,this.mouseDownPt_.y=t.y,this.leftBtnRect_.pointIn(this.mouseDownPt_)?(this.mouseDownControl_=yi,this.scrollStep_(Ii)):this.thumRect_.pointIn(this.mouseDownPt_)?this.mouseDownControl_=Fi:this.rightBtnRect_.pointIn(this.mouseDownPt_)?(this.mouseDownControl_=vi,this.scrollStep_(gi)):this._ptInLeftBlankArea(t.x,t.y)||this._ptInRightBlankArea(t.x,t.y)||(this.mouseDownControl_=pi,this.thumRect_.top>t.y||this.thumRect_.left>t.x?this.scrollStep_(Ci):(this.thumRect_.bottom<t.y||this.thumRect_.right<t.x)&&this.scrollStep_(wi))}},{key:"doMouseMove_",value:function(t){f()(F()(i.prototype),"doMouseMove_",this).call(this,t);var e=0;t.button==ae&&(this.orientation_==te?this.mouseDownControl_==Fi&&(e=t.x-this.mouseDownPt_.x,this.position=this.position_+L.Round(e/this.precent_),this.mouseDownPt_.x=t.x):this.mouseDownControl_==Fi&&(e=t.y-this.mouseDownPt_.y,this.position=this.position_+L.Round(e/this.precent_),this.mouseDownPt_.y=t.y))}},{key:"doMouseEnter_",value:function(){f()(F()(i.prototype),"doMouseEnter_",this).call(this),this.update()}},{key:"doMouseLeave_",value:function(t){f()(F()(i.prototype),"doMouseLeave_",this).call(this),this.update()}},{key:"_updateRangRect",value:function(){this.update()}},{key:"_ptInLeftBlankArea",value:function(t,e){return 0!=this.leftBlank_&&(this.orientation_==te?nt.CreateByBounds(0,0,this.leftBlank_,this.height).pointInAt(t,e):nt.CreateByBounds(0,0,this.width,this.leftBlank_).pointInAt(t,e))}},{key:"_ptInRightBlankArea",value:function(t,e){return 0!=this.rightBlank_&&(this.orientation_==te?nt.CreateByBounds(this.width-this.rightBlank_,0,this.rightBlank_,this.height).pointInAt(t,e):nt.CreateByBounds(0,this.height-this.rightBlank_,this.width,this.rightBlank_).pointInAt(t,e))}},{key:"doResize_",value:function(){f()(F()(i.prototype),"doResize_",this).call(this),this.orientation_==ee?this.pageSize_=this.height:this.pageSize_=this.width,this.position_+this.pageSize_>this.max_&&(this.position_=Math.max(this.max_-this.pageSize_,this.min_)),this._reCalcThumRect(),this._reCalcButtonRect()}},{key:"doPaint_",value:function(t){this.paintToEx(t)}},{key:"doDrawThumBefor_",value:function(t,e){}},{key:"paintToEx",value:function(t){t.brush.color=this.hcl.theme.backgroundStaticColor,t.fillBounds(0,0,this.width,this.height);var e=nt.CreateByRect(this.thumRect_);t.pen.width=1,this.orientation_==te?(e.inFlate(0,-1),this.doDrawThumBefor_(t,e),t.brush.color=this.hcl.theme.backgroundHotColor,t.fillRect(e),t.pen.color=this.hcl.theme.borderColor,t.beginPath(),t.drawLine(e.left,e.top,e.right,e.top),t.drawLine(e.right,e.top,e.right,e.bottom),t.drawLine(e.right,e.bottom-1,e.left,e.bottom-1),t.drawLine(e.left,e.bottom,e.left,e.top),e.left=e.left+Math.trunc(e.width/2),t.drawLine(e.left,5,e.left,this.height-5),t.drawLine(e.left+3,5,e.left+3,this.height-5),t.drawLine(e.left-3,5,e.left-3,this.height-5),t.paintPath(),this.mouseIn?t.pen.color=this.hcl.theme.borderColor:t.pen.color=this.hcl.theme.backgroundHotColor,t.beginPath(),e.left=this.leftBtnRect_.left+Math.trunc((this.leftBtnRect_.width-4)/2)+4,e.top=this.leftBtnRect_.top+Math.trunc((this.leftBtnRect_.height-7)/2),t.drawLine(e.left,e.top,e.left,e.top+7),t.drawLine(e.left-1,e.top+1,e.left-1,e.top+6),t.drawLine(e.left-2,e.top+2,e.left-2,e.top+5),t.drawLine(e.left-3,e.top+3,e.left-3,e.top+4),e.left=this.rightBtnRect_.left+Math.trunc((this.rightBtnRect_.width-4)/2),e.top=this.rightBtnRect_.top+Math.trunc((this.rightBtnRect_.height-7)/2),t.drawLine(e.left,e.top,e.left,e.top+7),t.drawLine(e.left+1,e.top+1,e.left+1,e.top+6),t.drawLine(e.left+2,e.top+2,e.left+2,e.top+5),t.drawLine(e.left+3,e.top+3,e.left+3,e.top+4),t.paintPath()):(e.inFlate(-1,0),this.doDrawThumBefor_(t,e),t.brush.color=this.hcl.theme.backgroundHotColor,t.fillRect(e),t.pen.color=this.hcl.theme.borderColor,t.beginPath(),t.drawLine(e.left,e.top,e.right,e.top),t.drawLine(e.right-1,e.top,e.right-1,e.bottom),t.drawLine(e.right,e.bottom,e.left,e.bottom),t.drawLine(e.left,e.bottom,e.left,e.top),e.top=e.top+Math.trunc(e.height/2),t.drawLine(5,e.top,this.width-5,e.top),t.drawLine(5,e.top-3,this.width-5,e.top-3),t.drawLine(5,e.top+3,this.width-5,e.top+3),t.paintPath(),this.mouseIn?t.pen.color=this.hcl.theme.borderColor:t.pen.color=this.hcl.theme.backgroundHotColor,t.beginPath(),e.left=this.leftBtnRect_.left+Math.trunc((this.leftBtnRect_.width-7)/2),e.top=this.leftBtnRect_.top+Math.trunc((this.leftBtnRect_.height-4)/2)+4,t.drawLine(6,12,13,12),t.drawLine(e.left,e.top,e.left+7,e.top),t.drawLine(e.left+1,e.top-1,e.left+6,e.top-1),t.drawLine(e.left+2,e.top-2,e.left+5,e.top-2),t.drawLine(e.left+3,e.top-3,e.left+4,e.top-3),e.left=this.rightBtnRect_.left+Math.trunc((this.rightBtnRect_.width-7)/2),e.top=this.rightBtnRect_.top+Math.trunc((this.rightBtnRect_.height-4)/2),t.drawLine(e.left,e.top,e.left+7,e.top),t.drawLine(e.left+1,e.top+1,e.left+6,e.top+1),t.drawLine(e.left+2,e.top+2,e.left+5,e.top+2),t.drawLine(e.left+3,e.top+3,e.left+4,e.top+3),t.paintPath())}},{key:"orientation",get:function(){return this.orientation_},set:function(t){this._setOrientation(t)}},{key:"min",get:function(){return this.min_},set:function(t){this._setMin(t)}},{key:"max",get:function(){return this.max_},set:function(t){this._setMax(t)}},{key:"pageSize",get:function(){return this.pageSize_},set:function(t){this._setPageSize(t)}},{key:"range",get:function(){return this.range_}},{key:"position",get:function(){return this.position_},set:function(t){this._setPosition(t)}},{key:"btnStep",get:function(){return this.btnStep_},set:function(t){this.btnStep_!=t&&(this.btnStep_=t)}},{key:"onScroll",get:function(){return this._onScroll},set:function(t){this._onScroll=t}}]),i}(mi),Pi=0,ki=1,xi=2,Ri={Creating:1,Removing:2,Aligning:3,VisibleChange:4,KeyDown:5},Ti=1,bi=2,Bi=function(t){m()(i,t);var e=jt(i);function i(t){return r()(this,i),e.call(this,t)}return l()(i)}(function(t){m()(i,t);var e=jt(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).state_.add(Ri.Creating),n.handle_=0,n.image=null,n.keyPreview=!1,n.controls=new ot,n.controls.onAdded=function(t){n.doAddControl_(t)},n.controls.onRemoved=function(t){n.doRemoveControl_(t)},n._focusControl=null,n._captureControl=null,n._mouseMoveControl=null,n._dragDestControl=null,n.state_.delete(Ri.Creating),n}return l()(i,[{key:"dispose",value:function(){for(var t=0;t<this.controls.count;t++)this.controls[t].dispose();f()(F()(i.prototype),"dispose",this).call(this)}},{key:"doResize_",value:function(){this.reAlign(),f()(F()(i.prototype),"doResize_",this).call(this)}},{key:"doAddControl_",value:function(t){t.tab_=this.controls.count-1,t.added_(this),this.reAlignControl(t)}},{key:"doAlign_",value:function(){for(var t=this.paddingLeft,e=this.paddingTop,i=this.width-this.paddingRight,n=this.height-this.paddingBottom,o=null,s=0;s<this.controls.count;s++)(o=this.controls[s]).visible&&o.align==Xt&&(o.left=this.paddingLeft+o.marginLeft,o.top=e+o.marginTop,o.width=this.width-this.paddingLeft-this.paddingRight-o.marginLeft-o.marginRight,o.reAlign(),e=o.top+o.height+o.marginBottom);for(var r=0;r<this.controls.count;r++)(o=this.controls[r]).visible&&o.align==qt&&(o.left=this.paddingLeft+o.marginLeft,o.width=this.width-this.paddingLeft-this.paddingRight-o.marginLeft-o.marginRight,n=n-o.marginBottom-o.height,o.top=n,o.reAlign(),n=o.top-o.marginTop);for(var a=0;a<this.controls.count;a++)(o=this.controls[a]).visible&&o.align==Qt&&(o.left=t+o.marginLeft,o.top=e+o.marginTop,o.height=n-e-o.marginTop-o.marginBottom,o.reAlign(),t=o.left+o.width+o.marginRight);for(var l=0;l<this.controls.count;l++)(o=this.controls[l]).visible&&o.align==Zt&&(i=i-o.marginRight-o.width,o.left=i,o.top=e+o.marginTop,o.height=n-e-o.marginTop-o.marginBottom,o.reAlign(),i=o.left-o.marginLeft);for(var h=0;h<this.controls.count;h++)(o=this.controls[h]).visible&&o.align==$t&&(o.left=t+o.marginLeft,o.top=e+o.marginTop,o.width=i-t-o.marginLeft-o.marginRight,o.height=n-e-o.marginTop-o.marginBottom,o.reAlign())}},{key:"removed_",value:function(){this.state_.add(Ri.Removing),f()(F()(i.prototype),"removed_",this).call(this),this.controls.clear()}},{key:"doRemoveControl_",value:function(t){this._focusControl===t&&(this._focusControl=null),this._captureControl===t&&(this._captureControl=null),this._mouseMoveControl===t&&(this._mouseMoveControl=null),t.removed_(),this.reAlign()}},{key:"controlVisible_",value:function(t,e){!e&&this.focusControl&&(this.focusControl===t||this.focusControl.isChildControl(t))&&this.focusControl.killFocus(),this.reAlignControl(t)}},{key:"insertControl",value:function(t,e){this.controls.insert(t,e)}},{key:"addControl",value:function(t){this.controls.add(t),t.visible&&t.canFocus&&this.setFocusControl_(t,!0)}},{key:"removeControl",value:function(t){this.controls.remove(t)}},{key:"reAlign",value:function(){if(!this.state_.has(Ri.Creating)&&!this.state_.has(Ri.Aligning)&&!this.state_.has(Ri.Removing)){this.state_.add(Ri.Aligning);try{this.doAlign_(),f()(F()(i.prototype),"reAlign",this).call(this)}finally{this.state_.delete(Ri.Aligning),this.update()}}}},{key:"reAlignControl",value:function(t){t.align!=Yt&&this.reAlign()}},{key:"bringToFrontControl_",value:function(t){this.controls.move(t,this.controls.count-1),this.setFocusControl_(t,!0)}},{key:"bringToFront",value:function(){null!=this.parent&&this.parent.bringToFrontControl_(this)}},{key:"setFocusControl_",value:function(t,e){t!==this._focusControl&&e&&(null!==this._focusControl&&this._focusControl.killFocus(),this._focusControl=t),this.visible_&&null!=this.parent&&this.parent.setFocusControl_(t,e)}},{key:"killFocusControl_",value:function(t){this._focusControl=null,null!=this.parent?this.parent.killFocusControl_(t):this.hcl.application.killFocusControl_(t)}},{key:"killFocus",value:function(){this.focused?f()(F()(i.prototype),"killFocus",this).call(this):null!=this._focusControl&&this._focusControl.killFocus()}},{key:"deactivate",value:function(){this.killFocus()}},{key:"getControlIndexAt",value:function(t,e){for(var i=null,n=this.controls.count-1;n>=0;n--)if((i=this.controls[n]).visible&&i.bounds().pointInAt(t,e))return n;return-1}},{key:"getControlAt",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.getControlIndexAt(t,e);if(n>=0){var o=this.controls[n];return i&&!o.enabled?null:o}return null}},{key:"getControlAtPos",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=this.getControlAt(t,e,n);return null!=o?o.isClass(i)?o.getControlAtPos(t-o.left,e-o.top,n):o:this}},{key:"getControlByProperty",value:function(t,e){for(var i=null,n=this.controls.count-1;n>=0;n--)if((i=this.controls[n])[t]===e)return i;return null}},{key:"doMouseLeave_",value:function(){null!==this._mouseMoveControl&&(this._mouseMoveControl.mouseLeave(),this._mouseMoveControl=null),f()(F()(i.prototype),"doMouseLeave_",this).call(this)}},{key:"doMouseWheel_",value:function(t){if(this.enabled_)if(null!==this._mouseMoveControl){var e=new fi;e.assign(t),e.x=t.x-this._mouseMoveControl.left,e.y=t.y-this._mouseMoveControl.top,this._mouseMoveControl.mouseWheel(e)}else if(null!==this._focusControl){var n=new fi;n.assign(t),n.x=t.x-this._focusControl.left,n.y=t.y-this._focusControl.top,this._focusControl.mouseWheel(n)}else f()(F()(i.prototype),"doMouseWheel_",this).call(this,t)}},{key:"mouseDown",value:function(t){if(this.enabled_){var e=this.getControlAt(t.x,t.y);if(this.designState&&(null!=e?e.hclSelect():this.hclSelect()),null!==e){this._captureControl=e;var n=new fi;n.assign(t),n.x=t.x-this._captureControl.left,n.y=t.y-this._captureControl.top,this._captureControl.mouseDown(n)}else null!=this._focusControl&&this._focusControl.killFocus(),f()(F()(i.prototype),"mouseDown",this).call(this,t)}}},{key:"mouseMove",value:function(t){if(this.enabled_){if(t.button===ae&&null!==this._captureControl){var e=new fi;return e.assign(t),e.x=t.x-this._captureControl.left,e.y=t.y-this._captureControl.top,void this._captureControl.mouseMove(e)}var n=this.getControlAt(t.x,t.y);if(n!==this._mouseMoveControl&&(null!==this._mouseMoveControl&&this._mouseMoveControl.mouseLeave(),this._mouseMoveControl=n,null!==this._mouseMoveControl&&this._mouseMoveControl.mouseEnter()),null!==this._mouseMoveControl){var o=new fi;o.assign(t),o.x=t.x-this._mouseMoveControl.left,o.y=t.y-this._mouseMoveControl.top,this._mouseMoveControl.mouseMove(o)}else this.hcl.application.setCursorBy(this),f()(F()(i.prototype),"mouseMove",this).call(this,t)}}},{key:"mouseUp",value:function(t){if(this.enabled_){if(null!==this._captureControl){var e=new fi;e.assign(t),e.x=t.x-this._captureControl.left,e.y=t.y-this._captureControl.top,this._captureControl.mouseUp(e)}else f()(F()(i.prototype),"mouseUp",this).call(this,t);this._captureControl=null}}},{key:"dragenter",value:function(t){if(this.enabled_){var e=this.getControlAt(t.x,t.y);if(null!==e){this._dragDestControl=e;var n=new fi;n.assign(t),n.x=t.x-e.left,n.y=t.y-e.top,e.dragenter(n)}else f()(F()(i.prototype),"dragenter",this).call(this,t)}}},{key:"dragover",value:function(t){if(this.enabled_){var e=this.getControlAt(t.x,t.y);if(e!==this._dragDestControl){if(null!==this._dragDestControl){var n=new fi;n.assign(t),n.x=t.x-this._dragDestControl.left,n.y=t.y-this._dragDestControl.top,this._dragDestControl.dragleave(n)}if(this._dragDestControl=e,null!==this._dragDestControl){var o=new fi;o.assign(t),o.x=t.x-this._dragDestControl.left,o.y=t.y-this._dragDestControl.top,this._dragDestControl.dragenter(t)}}if(null!==e){var s=new fi;s.assign(t),s.x=t.x-e.left,s.y=t.y-e.top,e.dragover(s)}else f()(F()(i.prototype),"dragover",this).call(this,t)}}},{key:"dragleave",value:function(t){if(this.enabled_)if(null!==this._dragDestControl){var e=new fi;e.assign(t),e.x=t.x-this._dragDestControl.left,e.y=t.y-this._dragDestControl.top,this._dragDestControl.dragleave(e)}else f()(F()(i.prototype),"dragleave",this).call(this,t)}},{key:"drop",value:function(t){if(this.enabled_){var e=this.getControlAt(t.x,t.y);if(null!==e){var n=new fi;n.assign(t),n.x=t.x-e.left,n.y=t.y-e.top,n.dataTransfer=t.dataTransfer,e.drop(n)}else f()(F()(i.prototype),"drop",this).call(this,t)}}},{key:"doDblClick_",value:function(t){if(this.enabled_){var e=this.getControlAt(t.x,t.y);if(null!=e){var n=new fi;n.assign(t),n.x-=e.left,n.y-=e.top,e.dblClick(n)}else f()(F()(i.prototype),"doDblClick_",this).call(this,t)}}},{key:"setTab",value:function(t,e){e>this.controls.count-1&&(e=this.controls.count-1),t.tab_=e}},{key:"tabNext",value:function(t){for(var e=0;e<this.controls.count;e++)if(this.controls[e].tab>t.tab&&this.controls[e].canFocus&&this.controls[e].visible&&this.controls[e].enabled){this.controls[e].tabSetFocus();break}}},{key:"tabPrev",value:function(t){for(var e=this.controls.count-1;e>=0;e--)if(this.controls[e].tab<t.tab&&this.controls[e].canFocus&&this.controls[e].visible&&this.controls[e].enabled){this.controls[e].tabSetFocus();break}}},{key:"doKeyDown_",value:function(t){null!==this._focusControl?this._focusControl.keyDown(t):this.keyPreview||f()(F()(i.prototype),"doKeyDown_",this).call(this,t)}},{key:"doKeyPress_",value:function(t){null!=this._focusControl?this._focusControl.keyPress(t):this.keyPreview||f()(F()(i.prototype),"doKeyPress_",this).call(this,t)}},{key:"doKeyUp_",value:function(t){null!=this._focusControl?this._focusControl.keyUp(t):this.keyPreview||f()(F()(i.prototype),"doKeyUp_",this).call(this,t)}},{key:"doCopy_",value:function(t){null!=this._focusControl?this._focusControl.copy(t):f()(F()(i.prototype),"doCopy_",this).call(this,t)}},{key:"doCut_",value:function(t){null!=this._focusControl?this._focusControl.cut(t):f()(F()(i.prototype),"doCut_",this).call(this,t)}},{key:"doPaste_",value:function(t){null!=this._focusControl?this._focusControl.paste(t):f()(F()(i.prototype),"doPaste_",this).call(this,t)}},{key:"doPaintBackground_",value:function(t){null!=this.image?t.drawImage(0,0,this.image.image):(null!=this.color?t.brush.color=this.color:t.brush.color=this.hcl.theme.backgroundStaticColor,t.fillBounds(0,0,this.width,this.height)),f()(F()(i.prototype),"doPaintBackground_",this).call(this,t)}},{key:"doPaint_",value:function(t){for(var e=null,n=0;n<this.controls.count;n++)if((e=this.controls[n]).visible){t.save();try{t.translate(e.left,e.top),e.drawShadow&&this.hcl.theme.drawShadow(t,nt.CreateByBounds(0,0,e.width,e.height),e.dropDownStyle),t.clip(0,0,e.width,e.height),e.paint(t)}finally{t.restore()}}f()(F()(i.prototype),"doPaint_",this).call(this,t)}},{key:"broadcast",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=0;o<this.controls.count;o++)this.controls[o].broadcast(t,e,n);f()(F()(i.prototype),"broadcast",this).call(this,t,e,n)}},{key:"handle",get:function(){return this.handle_}},{key:"focusControl",get:function(){return this._focusControl}}]),i}(mi)),Ni=function(t){m()(i,t);var e=jt(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).dropDownStyle=!1,n.popupLinkedList=null,n.forward=null,n.next=null,n.onDone=null,n}return l()(i,[{key:"_doPaintShadow",value:function(t,e){t.brush.color=this.hcl.theme.backgroundStaticColor,t.fillRectShadow(e,this.hcl.theme.shadow)}},{key:"doPaintBackground_",value:function(t){var e=this.clientRect();this.hcl.theme.drawShadow(t,e,this.dropDownStyle),f()(F()(i.prototype),"doPaintBackground_",this).call(this,t)}},{key:"updateRect",value:function(t){this.hcl.application.updateRect(t.offset(this.left,this.top,!0))}},{key:"popup",value:function(t,e,i){this.left=t,this.top=e,this.visible=!0,this.hcl.application.trackPopupControl(this,i)}},{key:"popupControl",value:function(t){var e=t.clientToScreenAt(0,0);this.popup(e.x,e.y+t.height,!0)}},{key:"donePopup",value:function(){this.hcl.application.closePopupControl(this.popupLinkedList.first),null!=this.onDone&&this.onDone()}},{key:"closePopup",value:function(){this.deactivate(),null!=this.onClose&&this.onClose()}},{key:"close",value:function(){this.hcl.application.closePopupControl(this)}}]),i}(Bi),Oi=0,_i=1,Ei=function(){function t(){var e=this;r()(this,t),this._control=null,this._active=!1,this.onCompositionUpdate=null,this._input=document.createElement("input"),this._input.type="text",this._input.style.position="absolute",this._input.style.opacity=0,this._input.style.zIndex=-1,this._input.style.left="20px",this._input.style.top="10px",this._input.style.width="10px",this._input.style.height="10px",this._input.onfocus=function(t){e._doSetFocus()},this._input.onblur=function(t){e._doKillFocus()},this._input.addEventListener("compositionstart",(function(t){e._input.value=""})),this._input.addEventListener("compositionupdate",(function(t){e.doCompositionUpdate(t)})),this._input.addEventListener("compositionend",(function(t){e._doInput(t.data)})),this._input.oninput=function(t){if(!t.isComposing){if("insertText"!=t.inputType)return void(e._input.value="");e._doInput(e._input.value),e._input.value=""}}}return l()(t,[{key:"__hclLoaded",value:function(t){this._input.setAttribute("id","hclInput_"+t.system.Timestamp),t.parentElement.appendChild(this._input)}},{key:"__hclUnLoaded",value:function(t){t.parentElement.removeChild(this._input)}},{key:"_doSetFocus",value:function(){this._active=!0}},{key:"_doKillFocus",value:function(){this._active=!1,this._control=null}},{key:"_doInput",value:function(t){this._input.value="",null!==this._control&&this._control.imeInput(t)}},{key:"doCompositionUpdate",value:function(t){null!==this.onCompositionUpdate&&this.onCompositionUpdate(t)}},{key:"setControl",value:function(t){this._control=null!==t?t:null,null!==this._control?t.imeMode===Oi||this._active||(this.updateSize(14),this._input.focus(),this._control.imeActive()):this._input.value=""}},{key:"removeControl",value:function(t){this._control===t&&(this._control=null,this._input.value="")}},{key:"updateSize",value:function(t){null!==this._control&&(this._input.style.height=t+"px")}},{key:"updatePosition",value:function(t,e){if(null!==this._control){var i=this._control.clientToScreen(et.Create(t,e));this._input.style.left=Math.max(0,Math.min(i.x,this._control.hcl.width-this._input.offsetWidth))+"px",this._input.style.top=Math.max(0,Math.min(i.y,this._control.hcl.height-this._input.offsetHeight))+"px"}}},{key:"killFocus",value:function(){this._doKillFocus()}},{key:"readOnly",get:function(){return this._input.readOnly},set:function(t){this._input.readOnly=t}},{key:"control",get:function(){return this._control}}]),t}();function Mi(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return Li(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Li(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){a=!0,s=t},f:function(){try{r||null==i.return||i.return()}finally{if(a)throw s}}}}function Li(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function Gi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Hi=0,Vi=1,Ui=2,Wi=function(t){m()(i,t);var e=Gi(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).autoSize=!0,n.loaded=!1,n._srcType=Hi,n._imageType="",n.onImageLoaded=null,n.image=new Image,n.image.onload=function(t){n.doImageLoad_(t)},n.image.onerror=function(t){null!==n.onImageLoaded&&n.onImageLoaded("error"!==t.type,t),n.loaded=!0,n.update()},n}return l()(i,[{key:"assign",value:function(t){this.autoSize=t.autoSize,this._srcType=t._srcType,this._imageType=t._imageType,this.image=new Image,this.image.src=t.image.src}},{key:"doImageLoad_",value:function(t){if(this.autoSize&&(this.width=this.image.width,this.height=this.image.height),this.image.src.indexOf("data:image")>-1){this._srcType=Ui;var e=this.image.src.split(",");this._imageType=e[0].match(/:(.*?);/)[1]}else{this._srcType=Vi;var i=this.image.src.lastIndexOf(".");this._imageType=this.image.src.substring(i)}null!==this.onImageLoaded&&this.onImageLoaded("error"!==t.type,t),this.loaded=!0,this.update()}},{key:"doPaint_",value:function(t){this.loaded&&t.drawImage(0,0,this.image)}},{key:"doPaintBackground_",value:function(t){}},{key:"saveToStream",value:function(t){var e;switch(t.writeByte(this._srcType),this._srcType){case Vi:e=J.getBytes(this.image.src);break;case Ui:var i=this.image.src.split(",");e=U.fromBase64(i[1]);break;default:return}t.writeUInt32(e.length),t.writeBuffer(e)}},{key:"loadFromStream",value:function(t){if(this._srcType=t.readByte(),this._srcType!=Hi){var e=t.readUInt32();if(e>0){var i=t.readBuffer(e);switch(this._srcType){case Vi:this.image.src=i.toText();break;case Ui:this.image.src="data:image/png;base64,"+i.toBase64();break;default:return}}}}},{key:"src",get:function(){return this.image.src},set:function(t){this.image.src=t}},{key:"srcType",get:function(){return this._srcType}},{key:"imageType",get:function(){return this._imageType}}],[{key:"Create",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,o=new i(t);return o.width=e,o.height=n,o}}]),i}(mi),zi=function(t){m()(i,t);var e=Gi(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t)).text_=null!=n?n:"",o.font=new Nt(t),o.font.onChange=function(){o.doFontChange()},o.borderVisible_=!1,o.borderWidth_=1,o._horiAlign=Te,o._vertAlign=Oe,o._autoWidth=!1,o._autoHeight=!1,o.width_=75,o.height_=20,o._onChange=null,o}return l()(i,[{key:"doSetPaddingLeft_",value:function(t){this.paddingLeft!=t&&(f()(F()(i.prototype),"doSetPaddingLeft_",this).call(this,t),this._autoWidth&&this.doSetAutoWidth_())}},{key:"doSetPaddingTop_",value:function(t){this.paddingTop!=t&&(f()(F()(i.prototype),"doSetPaddingTop_",this).call(this,t),this._autoHeight&&this.doSetAutoHeight_())}},{key:"doSetPaddingRight_",value:function(t){this.paddingRight!=t&&(f()(F()(i.prototype),"doSetPaddingRight_",this).call(this,t),this._autoWidth&&this.doSetAutoWidth_())}},{key:"doSetPaddingBottom_",value:function(t){this.paddingBottom!=t&&(f()(F()(i.prototype),"doSetPaddingBottom_",this).call(this,t),this._autoHeight&&this.doSetAutoHeight_())}},{key:"doCalcWidth_",value:function(){return this.paddingLeft+this.paddingRight+this.hcl.textWidth(this.font,this.text)}},{key:"doSetAutoWidth_",value:function(){var t=this.doCalcWidth_();this.width!=t&&(this.width=t)}},{key:"doCalcHeight_",value:function(){return this.paddingTop+this.paddingBottom+this.font.height}},{key:"doSetAutoHeight_",value:function(){var t=this.doCalcHeight_();this.height!=t&&(this.height=t)}},{key:"reCalcSize_",value:function(){this.beginUpdate();try{this._autoWidth&&this.doSetAutoWidth_(),this._autoHeight&&this.doSetAutoHeight_()}finally{this.endUpdate()}}},{key:"doFontChange",value:function(){this.reCalcSize_()}},{key:"doChange_",value:function(){this.reCalcSize_(),null!=this._onChange&&this._onChange()}},{key:"doPaintText_",value:function(t,e,i){t.textOut(e,i,this.text_)}},{key:"doPaint_",value:function(t){if(this.text_.length>0){t.font.assign(this.font),this.enabled||(t.font.color=this.hcl.theme.textDisableColor);var e=0;switch(this._vertAlign){case Ne:e=this.height-(this.borderVisible_?this.borderWidth_:0)-this.paddingBottom;break;case Oe:e=Math.max(0,Math.round((this.height-this.font.height)/2));break;default:e=this.paddingTop+(this.borderVisible_?this.borderWidth_:0)}var i=0,n=this.hcl.textWidth(this.font,this.text_);switch(this._horiAlign){case be:i=this.width-n-(this.borderVisible_?this.borderWidth_:0)-this.paddingRight;break;case Be:i=this.paddingLeft+Math.max(0,Math.round((this.width-this.paddingLeft-this.paddingRight-n)/2));break;default:i=this.paddingLeft+(this.borderVisible_?this.borderWidth_:0)}this.doPaintText_(t,i,e)}}},{key:"doSetBorderVisible_",value:function(){this.update()}},{key:"getText_",value:function(){return this.text_}},{key:"setText_",value:function(t){this.text_!=t&&(this.text_=t.toString(),this.doSetText_())}},{key:"doSetText_",value:function(){this.doChange_()}},{key:"textArea",value:function(){return nt.Create(this.paddingLeft+(this.borderVisible_?this.borderWidth_:0),this.paddingTop+(this.borderVisible_?this.borderWidth_:0),this.width-(this.borderVisible_?this.borderWidth_:0)-this.paddingRight,this.height-(this.borderVisible_?this.borderWidth_:0)-this.paddingBottom)}},{key:"clear",value:function(){this.text=""}},{key:"autoWidth",get:function(){return this._autoWidth},set:function(t){this._autoWidth!=t&&(this._autoWidth=t,t&&this.doSetAutoWidth_())}},{key:"autoHeight",get:function(){return this._autoHeight},set:function(t){this._autoHeight!=t&&(this._autoHeight=t,t&&this.doSetAutoHeight_())}},{key:"autoSize",get:function(){return this._autoWidth&&this._autoHeight},set:function(t){this.autoWidth=t,this.autoHeight=t}},{key:"text",get:function(){return this.getText_()},set:function(t){this.setText_(t)}},{key:"borderVisible",get:function(){return this.borderVisible_},set:function(t){this.borderVisible_!=t&&(this.borderVisible_=t,this.doSetBorderVisible_())}},{key:"onChange",get:function(){return this._onChange},set:function(t){this._onChange=t}}]),i}(mi),Ki=function(t){m()(i,t);var e=Gi(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n))._vertAlign=Oe,o.transparent=!0,o.autoWidth=!0,o.autoHeight=!0,o}return l()(i)}(zi),Ji=function(t){m()(i,t);var e=Gi(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n))._horiAlign=Be,o._vertAlign=Oe,o._paddingLeft=5,o._paddingTop=5,o._paddingRight=5,o._paddingBottom=5,o.textVisible_=!0,o.canFocus=!0,o.width=75,o}return l()(i,[{key:"doMouseEnter_",value:function(){f()(F()(i.prototype),"doMouseEnter_",this).call(this),this.update()}},{key:"doMouseLeave_",value:function(){f()(F()(i.prototype),"doMouseLeave_",this).call(this),this.update()}},{key:"doMouseDown_",value:function(t){f()(F()(i.prototype),"doMouseDown_",this).call(this,t),this.update()}},{key:"doMouseUp_",value:function(t){f()(F()(i.prototype),"doMouseUp_",this).call(this,t),this.update()}},{key:"doSetAutoWidth_",value:function(){this.textVisible_?f()(F()(i.prototype),"doSetAutoWidth_",this).call(this):this.width=this.paddingLeft+this.paddingRight,this.width<this.hcl.theme.iconWidth&&(this.width=this.hcl.theme.iconWidth)}},{key:"doPaintStaticBackground_",value:function(t){t.brush.color=this.hcl.theme.backgroundLightColor,t.fillBounds(0,0,this.width,this.height)}},{key:"doPaintHotBackground_",value:function(t){this.mouseStates.has(ne)?t.brush.color=this.hcl.theme.backgroundDownColor:t.brush.color=this.hcl.theme.backgroundHotColor,t.fillBounds(0,0,this.width,this.height)}},{key:"doPaintBackground_",value:function(t){this.mouseStates.has(ie)?this.doPaintHotBackground_(t):this.doPaintStaticBackground_(t),f()(F()(i.prototype),"doPaintBackground_",this).call(this,t)}},{key:"doPaint_",value:function(t){this.textVisible_&&f()(F()(i.prototype),"doPaint_",this).call(this,t)}},{key:"setTextVisible_",value:function(t){this.textVisible_!=t&&(this.textVisible_=t)}},{key:"textVisible",get:function(){return this.textVisible_},set:function(t){this.setTextVisible_(t),this.doSetAutoWidth_()}}]),i}(zi),ji=function(t){m()(i,t);var e=Gi(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).image=Wi.Create(t,16,16),o.image.left=2,o.image.onImageLoaded=function(t,e){o.doImageLoaded_(t,e)},o.onImageLoaded=null,o}return l()(i,[{key:"doImageLoaded_",value:function(t,e){this.paddingLeft=this.image.width+4,this.autoWidth&&this.doSetAutoWidth_(),this.updateRect(this.image.bounds()),null!==this.onImageLoaded&&this.onImageLoaded(t,e)}},{key:"doPaintStaticBackground_",value:function(t){}},{key:"doPaint_",value:function(t){if(""!=this.image.src){this.image.top=Math.trunc((this.height-this.image.height)/2),this.image.paintTo(t,this.image.left,this.image.top),t.save();try{f()(F()(i.prototype),"doPaint_",this).call(this,t)}finally{t.restore()}}else f()(F()(i.prototype),"doPaint_",this).call(this,t)}},{key:"setTextVisible_",value:function(t){this.textVisible_!=t&&(this.textVisible_=t,this._paddingRight=t?5:0)}}]),i}(Ji),Yi=function(t){m()(i,t);var e=Gi(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).dropDownMenu=null,o._paddingRight=o.hcl.theme.dropDownButtonSize,o}return l()(i,[{key:"doClick_",value:function(){null!=this.dropDownMenu&&(this.dropDownMenu.dropDownStyle=!0,this.dropDownMenu.popupControl(this)),f()(F()(i.prototype),"doClick_",this).call(this)}},{key:"doPaintBackground_",value:function(t){f()(F()(i.prototype),"doPaintBackground_",this).call(this,t),this.hcl.theme.drawDropDown(t,nt.CreateByBounds(this.width-this.hcl.theme.dropDownButtonSize,0,this.hcl.theme.dropDownButtonSize,this.height))}},{key:"setTextVisible_",value:function(t){this.textVisible_!=t&&(this.textVisible_=t,this._paddingRight=t?this.hcl.theme.dropDownButtonSize:0)}}]),i}(ji),Qi=function(t){m()(i,t);var e=Gi(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).canFocus=!1,o._checked=!1,o.textVisible_=!1,o._paddingRight=0,o.align=Qt,o.autoWidth=!0,o.group=0,o.onCheckChange=null,o}return l()(i,[{key:"doPaintBackground_",value:function(t){this._checked?(t.brush.color=this.hcl.theme.backgroundDownColor,t.fillBounds(0,0,this.width,this.height)):f()(F()(i.prototype),"doPaintBackground_",this).call(this,t)}},{key:"checked",get:function(){return this._checked},set:function(t){this._checked!=t&&(this._checked=t,this.update(),this._checked&&null!=this.onCheckChange&&this.onCheckChange(this))}}]),i}(ji),Xi=function(t){m()(i,t);var e=Gi(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).canFocus=!1,o._checked=!1,o.textVisible_=!1,o.align=Qt,o.autoWidth=!0,o}return l()(i)}(Yi),Zi=function(t){m()(i,t);var e=Gi(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).width=3,n.align=Qt,n}return l()(i,[{key:"doPaintBackground_",value:function(t){t.pen.width=1,t.pen.color=this.hcl.theme.borderColor,t.beginPath(),t.drawLine(Math.trunc((this.width-t.pen.width)/2),2,Math.trunc((this.width-t.pen.width)/2),this.height-2),t.paintPath()}}]),i}(mi),qi=function(t){m()(i,t);var e=Gi(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).width_=200,n.height_=200,n.borders_=new me,n.borders_,n.borderVisible_=!0,n}return l()(i,[{key:"doPaintBorder_",value:function(t){this.borderVisible_&&this.borders_.value>0&&(t.pen.color=this.hcl.theme.borderColor,t.pen.width=this.hcl.theme.borderWidth,t.beginPath(),this.borders_.has(ce)&&(t.moveTo(0,0),t.lineTo(0,this.height)),this.borders_.has(ue)&&(t.moveTo(0,0),t.lineTo(this.width,0)),this.borders_.has(fe)&&(t.moveTo(this.width-this.hcl.theme.borderWidth,0),t.lineTo(this.width-this.hcl.theme.borderWidth,this.height)),this.borders_.has(de)&&(t.moveTo(0,this.height-this.hcl.theme.borderWidth),t.lineTo(this.width,this.height-this.hcl.theme.borderWidth)),t.paintPath())}},{key:"doPaint_",value:function(t){f()(F()(i.prototype),"doPaint_",this).call(this,t),this.doPaintBorder_(t)}},{key:"borderVisible",get:function(){return this.borderVisible_},set:function(t){this.borderVisible_!=t&&(this.borderVisible_=t,this.update())}},{key:"borders",get:function(){return this.borders_}}]),i}(Bi),$i=function(t){m()(i,t);var e=Gi(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).height_=22,n.borderVisible_=!1,n}return l()(i,[{key:"doPaintBorder_",value:function(t){this.borderVisible_&&(t.pen.color=this.hcl.theme.borderColor,t.pen.width=this.hcl.theme.borderWidth,t.beginPath(),t.moveTo(0,0),t.lineTo(0,this.height),t.moveTo(0,0),t.lineTo(this.width,0),t.moveTo(this.width-this.hcl.theme.borderWidth,0),t.lineTo(this.width-this.hcl.theme.borderWidth,this.height),t.moveTo(0,this.height-this.hcl.theme.borderWidth),t.lineTo(this.width,this.height-this.hcl.theme.borderWidth),t.paintPath())}},{key:"doPaint_",value:function(t){f()(F()(i.prototype),"doPaint_",this).call(this,t),this.doPaintBorder_(t)}},{key:"doAlign_",value:function(){for(var t=this.paddingLeft,e=this.width-this.paddingRight,i=null,n=0;n<this.controls.count;n++)(i=this.controls[n]).visible&&(i.align==Qt?(i.left=t+i.marginLeft,i.top=this.paddingTop+i.marginTop,i.height=this.height-this.paddingTop-this.paddingBottom-i.marginTop-i.marginBottom,t=i.left+i.width+i.marginRight):(e=e-i.marginRight-i.width,i.left=e,i.top=this.paddingTop+i.marginTop,i.height=this.height-this.paddingTop-this.paddingBottom-i.marginTop-i.marginBottom,e-=i.marginLeft));this.update()}},{key:"addButton",value:function(t){var e=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=new Qi(this.hcl,t);return o.textVisible=i,o.onCheckChange=function(t){if(t.checked&&t.group>0)for(var i=0;i<e.controls.count;i++)e.controls[i]!==t&&e.controls[i].group===t.group&&(e.controls[i].checked=!1)},""!==n&&(this.incResWait(),o.onImageLoaded=function(t,i){t&&e.decResWait()},o.image.src=n),this.addControl(o),o}},{key:"addSpliter",value:function(){var t=new Zi(this.hcl);return this.addControl(t),t}},{key:"borderVisible",get:function(){return this.borderVisible_},set:function(t){this.borderVisible_!=t&&(this.borderVisible_=t,this.update())}}]),i}(Bi),tn=function(t){m()(i,t);var e=Gi(i);function i(t){var n;return r()(this,i),(n=e.call(this,t))._x=0,n._y=0,n.captureParent=!0,n}return l()(i,[{key:"doMouseDown_",value:function(t){f()(F()(i.prototype),"doMouseDown_",this).call(this,t),this._x=t.x,this._y=t.y,t.button===ae&&this.captureParent&&null===this.getControlAt(t.x,t.y,!1)?(this.hcl.application.setCapture(this),this.captured=!0):this.captured=!1}},{key:"doMouseMove_",value:function(t){if(f()(F()(i.prototype),"doMouseMove_",this).call(this,t),this.captured&&this.captureParent){var e=this.parent,n=this.parent.bounds(),o=n.offset(t.x-this._x,t.y-this._y,!0);(o=o.union(n)).offset(-1,-1),e.left+=t.x-this._x,e.top+=t.y-this._y,this.hcl.application.updateRect(o)}}},{key:"doMouseUp_",value:function(t){f()(F()(i.prototype),"doMouseUp_",this).call(this,t),this.captured&&(this.hcl.application.releaseCapture(),this.captured=!1)}},{key:"getControlIndexAt",value:function(t,e){var n=f()(F()(i.prototype),"getControlIndexAt",this).call(this,t,e);return n>=0&&this.captureParent&&this.controls[n].isClass(Ki)?-1:n}}]),i}($i),en=function(t){m()(i,t);var e=Gi(i);function i(t,n){var o,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r()(this,i),(o=e.call(this,t,n))._checked=s,o._downInCheck=!1,o._checkByText=!0,o._state=s?Pi:xi,o.useCheckState=!1,o.paddingLeft=2+o.hcl.theme.iconSize,o.onSwitch=null,o}return l()(i,[{key:"_getBoxRect",value:function(){return nt.CreateByBounds(2,Math.trunc((this.height-this.hcl.theme.iconSize)/2)+1,this.hcl.theme.iconSize-2,this.hcl.theme.iconSize-2)}},{key:"doCalcWidth_",value:function(){return f()(F()(i.prototype),"doCalcWidth_",this).call(this)}},{key:"doSetBounds_",value:function(){this.height_<this.hcl.theme.iconSize&&(this.height_=this.hcl.theme.iconSize),f()(F()(i.prototype),"doSetBounds_",this).call(this)}},{key:"doMouseEnter_",value:function(){f()(F()(i.prototype),"doMouseEnter_",this).call(this),this.updateRect(this._getBoxRect())}},{key:"doMouseLeave_",value:function(){f()(F()(i.prototype),"doMouseLeave_",this).call(this),this.updateRect(this._getBoxRect())}},{key:"doMouseDown_",value:function(t){var e=this._getBoxRect();t.y<e.top||t.y>e.bottom||(this._checkByText?this._downInCheck=!0:this._downInCheck=e.pointInAt(t.x,t.y),f()(F()(i.prototype),"doMouseDown_",this).call(this,t))}},{key:"doMouseUp_",value:function(t){var e=this._getBoxRect();t.y<e.top||t.y>e.bottom||(this._downInCheck&&(this._checkByText||e.pointInAt(t.x,t.y))&&(this.useCheckState?this._state==Pi?this.state=ki:this._state==ki?this.state=xi:this.state=Pi:this.checked=!this._checked,null!=this.onSwitch&&this.onSwitch()),f()(F()(i.prototype),"doMouseUp_",this).call(this,t))}},{key:"doPaint_",value:function(t){this.mouseIn?t.pen.color=this.hcl.theme.borderHotColor:t.pen.color=this.hcl.theme.borderColor;var e=this._getBoxRect();this._state===Pi?this.hcl.theme.drawFrameControl(t,e,new Set([Pi]),bi):this._state===ki?this.hcl.theme.drawFrameControl(t,e,new Set([ki]),bi):this._state===xi&&this.hcl.theme.drawFrameControl(t,e,new Set([]),bi),f()(F()(i.prototype),"doPaint_",this).call(this,t)}},{key:"checked",get:function(){return this._checked},set:function(t){this._checked!=t&&(this._checked=t,this._state=t?Pi:xi,this.updateRect(this._getBoxRect()))}},{key:"state",get:function(){return this._state},set:function(t){this._state!=t&&(this._state=t,this._checked=t==Pi,this.updateRect(this._getBoxRect()))}}]),i}(Ki),nn=function(t){m()(i,t);var e=Gi(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n))._readOnly=!1,o.cursor_=Ce,o.imeMode=Oi,o.popupMenuEnable=!0,o.popupMenu=new gn(t),o._copyMenuItem=o.popupMenu.addItem(t.getLangItem(0)),o._copyMenuItem.onClick=function(){o.doCopy_(null)},o._copyToBrowerMenuItem=o.popupMenu.addItem(t.getLangItem(3)),o._copyToBrowerMenuItem.onClick=function(){o.doCopyToBrower_()},o._cutMenuItem=o.popupMenu.addItem(t.getLangItem(1)),o._cutMenuItem.onClick=function(){o.doCut_(null)},o._pasteMenuItem=o.popupMenu.addItem(t.getLangItem(2)),o._pasteMenuItem.onClick=function(){o.doPaste_(null)},o}return l()(i,[{key:"removed_",value:function(){f()(F()(i.prototype),"removed_",this).call(this),this.hcl.ime.removeControl(this)}},{key:"doContextMenu_",value:function(t,e){this.popupMenuEnable&&(this._copyMenuItem.enabled=this.canCopy_(),this._cutMenuItem.enabled=this.canCut_(),this._pasteMenuItem.enabled=this.canPaste_(),f()(F()(i.prototype),"doContextMenu_",this).call(this,t,e))}},{key:"doCheckImeMode_",value:function(){this._readOnly||this.imeMode!==Oi&&this.hcl.ime.setControl(this)}},{key:"doMouseDown_",value:function(t){f()(F()(i.prototype),"doMouseDown_",this).call(this,t),this.doCheckImeMode_()}},{key:"doMouseUp_",value:function(t){!this._readOnly&&this.mouseStates.has(ne)&&this.imeMode!==Oi&&this.hcl.ime.setControl(this),f()(F()(i.prototype),"doMouseUp_",this).call(this,t)}},{key:"doSetReadOnly_",value:function(){}},{key:"doCopy_",value:function(t){}},{key:"doCopyToBrower_",value:function(){}},{key:"doCut_",value:function(t){}},{key:"doPaste_",value:function(t){}},{key:"canCopy_",value:function(){return!1}},{key:"canCut_",value:function(){return!1}},{key:"canPaste_",value:function(){return!1}},{key:"imeActive",value:function(){}},{key:"setFocus",value:function(){f()(F()(i.prototype),"setFocus",this).call(this),this.focused&&this.imeMode!==Oi&&this.hcl.ime.control!==this&&this.hcl.ime.setControl(this)}},{key:"insertText",value:function(t,e){this.text=L.stringInsert(this.text,t,e)}},{key:"deleteText",value:function(t,e){this.text=L.stringDelete(this.text,t,e)}},{key:"imeInput",value:function(t){}},{key:"readOnly",get:function(){return this._readOnly},set:function(t){this._readOnly!=t&&(this._readOnly=t,this.doSetReadOnly_())}}]),i}(zi),on=function(t){m()(i,t);var e=Gi(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).canFocus=!0,o.borderVisible_=!0,o._vertAlign=Oe,o._selStart=-1,o._selEnd=-1,o._selMove=-1,o._leftOffset=0,o._marginLeft=2,o._marginTop=2,o._marginRight=2,o._marginBottom=2,o._paddingLeft=2,o._paddingTop=2,o._paddingRight=2,o._paddingBottom=2,o._textPrompt="",o.imeMode=_i,o}return l()(i,[{key:"_selectActionLeft",value:function(){this.selectExists()?(this._selMove==this._selStart&&this._selStart>0?(this._selStart--,this._selMove=this._selStart):this._selMove==this._selEnd&&this._selEnd<=this.text.length&&(this._selEnd--,this._selEnd==this._selStart?(this._selEnd=-1,this._selMove=this._selStart):this._selMove=this._selEnd),this.scrollAdjust_(this._selMove),this.resetSelect_()):this._selStart>0&&(this._selEnd=this._selStart,this._selStart--,this._selMove=this._selStart,this.scrollAdjust_(this._selMove),this.resetSelect_())}},{key:"_selectActionRight",value:function(){this.selectExists()?(this._selMove==this._selStart&&this._selStart<this.text.length?(this._selStart++,this._selStart==this._selEnd&&(this._selEnd=-1),this._selMove=this._selStart):this._selMove==this._selEnd&&this._selEnd<this.text.length&&(this._selEnd++,this._selMove=this._selEnd),this.scrollAdjust_(this._selMove),this.resetSelect_()):this._selStart<this.text.length&&(this._selEnd=this._selStart+1,this._selMove=this._selEnd,this.scrollAdjust_(this._selMove),this.resetSelect_())}},{key:"_createCaret",value:function(){this.hcl.application.createCaret(this,null,0,this.font.height+1)}},{key:"_destroyCaret",value:function(){this.hcl.application.destroyCaret(this)}},{key:"getCharOffsetAt_",value:function(t,e){var i=t-(this.borderVisible_?this.borderWidth_:0)-this.paddingLeft+this._leftOffset;if(this.text.length>0){for(var n=this.hcl.getTextExtent(this.font,this.text),o=0,s=0;s<n.length;s++)if((o+=n[s])>=i)return Math.trunc(o-n[s]/2)>i?s:s+1;if(i>o)return this.text.length}return 0}},{key:"getCharLeft_",value:function(t){var e=0;if(t>0)for(var i=this.hcl.getTextExtent(this.font,this.text,t),n=0;n<t;n++)e+=i[n];return e+(this.borderVisible_?this.borderWidth_:0)+this.paddingLeft-this._leftOffset}},{key:"getCharTop_",value:function(){switch(this._vertAlign){case Ne:return this.height-this.paddingBottom-(this.borderVisible_?this.borderWidth_:0);case Oe:return this.paddingTop+(this.borderVisible_?this.borderWidth_:0)+Math.max(0,Math.trunc((this.height-this.paddingTop-this.paddingBottom-(this.borderVisible_?this.borderWidth_+this.borderWidth_:0)-this.font.height)/2));default:return this.paddingTop+(this.borderVisible_?this.borderWidth_:0)}}},{key:"resetSelect_",value:function(){this.selectExists()?this.hideCaret_():this._selStart>=0&&this.showCaret_(),this.update()}},{key:"scrollAdjust_",value:function(t){var e=this.textArea(),i=this.hcl.textWidth(this.font,this.text);if(i<e.width)this._leftOffset=0;else if(i-this._leftOffset<e.width)this._leftOffset=i-e.width;else{var n=this.text.substring(0,t),o=this.hcl.textWidth(this.font,n)+e.left-this._leftOffset;o>e.right?this._leftOffset+=o-e.right:o<e.left&&(this._leftOffset-=e.left-o)}}},{key:"doPaintBorder_",value:function(t,e){t.pen.width=this.borderWidth_,t.pen.style=_t.Solid,this._readOnly?t.pen.color=this.hcl.theme.borderColor:this.focused?t.pen.color=this.hcl.theme.borderActiveColor:this.mouseIn?t.pen.color=this.hcl.theme.borderHotColor:t.pen.color=this.hcl.theme.borderColor,t.rectangleRect(e)}},{key:"doPaintSelected_",value:function(t){t.brush.color=this.hcl.theme.backgroundSelectColor;var e=this.getCharLeft_(this._selStart),i=this.getCharLeft_(this._selEnd),n=this.textArea();e=Math.max(n.left,Math.min(e,n.right)),i=Math.max(n.left,Math.min(i,n.right)),t.fillBounds(e,n.top,i-e,n.height)}},{key:"showCaret_",value:function(){if(!(this._selStart<0)){var t=this.getCharLeft_(this._selStart)-1;this.hcl.ime.updatePosition(t,0),this.hcl.application.setCaretPos(t,this.getCharTop_()-1),this.hcl.application.showCaret(this)}}},{key:"hideCaret_",value:function(){this.hcl.application.hideCaret(this)}},{key:"doCopy_",value:function(t){this.copy(t)}},{key:"doCopyToBrower_",value:function(){this.copyToBrower()}},{key:"doCut_",value:function(t){this.cut(t)}},{key:"doPaste_",value:function(t){this.paste(t)}},{key:"canCopy_",value:function(){return this.selectExists()}},{key:"canCut_",value:function(){return!this.readOnly&&this.selectExists()}},{key:"canPaste_",value:function(){return!this.readOnly}},{key:"doSetBounds_",value:function(){f()(F()(i.prototype),"doSetBounds_",this).call(this),this.showCaret_()}},{key:"reAlign",value:function(){this.showCaret_(),f()(F()(i.prototype),"reAlign",this).call(this)}},{key:"doBackKeyDown_",value:function(){this.beginUpdate();try{this.selectExists()?this.deleteSelect():this._selStart>0&&(this._selStart--,this.deleteText(this._selStart,1),this._selMove=this._selStart,this.scrollAdjust_(this._selMove),this.showCaret_())}finally{this.endUpdate()}}},{key:"doDeleteKeyDown_",value:function(){this.beginUpdate();try{this.selectExists()?this.deleteSelect():this._selStart<this.text.length&&(this.deleteText(this._selStart,1),this.showCaret_())}finally{this.endUpdate()}}},{key:"doLeftKeyDown_",value:function(){this.beginUpdate();try{!this.selectExists()&&this._selStart>0&&this._selStart--,this._selEnd=-1,this._selMove=this._selStart,this.scrollAdjust_(this._selMove),this.showCaret_()}finally{this.endUpdate()}}},{key:"doRightKeyDown_",value:function(){this.beginUpdate();try{!this.selectExists()&&this._selStart<this.text.length&&this._selStart++,this._selEnd=-1,this._selMove=this._selStart,this.scrollAdjust_(this._selMove),this.showCaret_()}finally{this.endUpdate()}}},{key:"doHomeKeyDown_",value:function(){this.beginUpdate();try{this._selEnd=-1,this._selStart=0,this._selMove=this._selStart,this.scrollAdjust_(this._selMove),this.showCaret_()}finally{this.endUpdate()}}},{key:"doEndKeyDown_",value:function(){this.beginUpdate();try{this._selEnd=-1,this._selStart=this.text.length,this._selMove=this._selStart,this.scrollAdjust_(this._selMove),this.showCaret_()}finally{this.endUpdate()}}},{key:"doMouseEnter_",value:function(){f()(F()(i.prototype),"doMouseEnter_",this).call(this),this._readOnly||this.update()}},{key:"doMouseLeave_",value:function(){f()(F()(i.prototype),"doMouseLeave_",this).call(this),this._readOnly||this.update()}},{key:"doMouseDown_",value:function(t){f()(F()(i.prototype),"doMouseDown_",this).call(this,t),t.button==ae?(this.disSelect(),t.x>0&&t.x<this.width-(this.borderVisible_?this.borderWidth_:0)-this.paddingRight&&(this._selStart=this.getCharOffsetAt_(t.x,t.y),this._selMove=this._selStart,this.scrollAdjust_(this._selMove),this.resetSelect_())):this._selStart<0&&(this._selStart=this.getCharOffsetAt_(t.x,t.y),this._selMove=this._selStart,this.scrollAdjust_(this._selMove),this.resetSelect_())}},{key:"doMouseMove_",value:function(t){var e=this.textArea();if(t.button===ae){if(t.x<0)this._leftOffset=Math.max(0,this._leftOffset-this.font.advCharWidth);else if(t.x>0){var n=this.hcl.textWidth(this.font,this.text_);t.x>e.right&&(this._leftOffset=Math.max(0,Math.min(n-e.width,this._leftOffset+this.font.advCharWidth)))}this._selEnd=this.getCharOffsetAt_(t.x,t.y),this._selMove=this._selEnd,this.selectExists()||this._selEnd>=0&&(this._selEnd=-1,this._selMove=this._selStart),this.scrollAdjust_(this._selMove),this.resetSelect_()}e.pointInAt(t.x,t.y)?this.cursor=Ce:this.cursor=Se,f()(F()(i.prototype),"doMouseMove_",this).call(this,t)}},{key:"doMouseUp_",value:function(t){if(t.button==ae&&this._selEnd>=0&&this._selEnd<this._selStart){var e=this._selStart;this._selStart=this._selEnd,this._selEnd=e}f()(F()(i.prototype),"doMouseUp_",this).call(this,t)}},{key:"doKeyDown_",value:function(t){if(!this.readOnly)switch(t.keyCode){case Ee:this.doBackKeyDown_();break;case Xe:this.doDeleteKeyDown_();break;case Je:L.setCompare(t.shiftState,new Set([oe]))?this._selectActionLeft():this.doLeftKeyDown_();break;case Ye:L.setCompare(t.shiftState,new Set([oe]))?this._selectActionRight():this.doRightKeyDown_();break;case Ke:this.doHomeKeyDown_();break;case ze:this.doEndKeyDown_();break;case Ze:L.setCompare(t.shiftState,new Set([re]))&&this.selectAll();break;default:f()(F()(i.prototype),"doKeyDown_",this).call(this,t)}}},{key:"doKeyPress_",value:function(t){this.insertText(this._selStart,t.key),f()(F()(i.prototype),"doKeyPress_",this).call(this,t)}},{key:"doKeyUp_",value:function(t){t.keyCode===Me?this.hcl.keyDownStates[Ge]?this.parent.tabPrev(this):this.parent.tabNext(this):f()(F()(i.prototype),"doKeyUp_",this).call(this,t)}},{key:"doSetFocus_",value:function(t){f()(F()(i.prototype),"doSetFocus_",this).call(this,t),t&&(this.doCheckImeMode_(),this._createCaret(),this._selStart=0,this._selMove=this._selStart,this.scrollAdjust_(this._selMove),this.resetSelect_())}},{key:"doKillFocus_",value:function(){this.disSelect(),this._selStart=-1,this._selMove=-1,this._leftOffset=0,f()(F()(i.prototype),"doKillFocus_",this).call(this)}},{key:"doDblClick_",value:function(t){this.selectAll(),f()(F()(i.prototype),"doDblClick_",this).call(this,t)}},{key:"doPaintBackground_",value:function(t){var e=this.clientRect();e.left=this.paddingLeft,t.brush.color=this.hcl.theme.backgroundContentColor,t.fillRect(e),this.selectExists()&&this.doPaintSelected_(t),this.borderVisible_&&(e.left-=this.borderWidth_,this.doPaintBorder_(t,e)),e=this.textArea(),this._leftOffset>0&&(t.brush.color=this.font.color,t.fillBounds(e.left-1,e.top+1,1,e.height-2)),this.hcl.textWidth(this.font,this.text_)>this._leftOffset+e.width&&(t.brush.color=this.font.color,t.fillBounds(e.right+1,e.top+1,1,e.height-2))}},{key:"doPaintText_",value:function(t,e,i){""!=this.text_&&t.textOut(e-this._leftOffset,i,this.text_)}},{key:"doPaint_",value:function(t){t.save();try{var e=this.textArea();t.clipRect(e),""!==this.text?f()(F()(i.prototype),"doPaint_",this).call(this,t):""!=this._textPrompt&&(t.font.styles.value=Ct,t.font.color=Ft.Gray,t.textOut(this.getCharLeft_(0),this.getCharTop_(),this._textPrompt))}finally{t.restore()}}},{key:"doSetText_",value:function(){this._selStart>this.text.length&&(this._selStart=this.text.length),this.disSelect(),this.resetSelect_(),f()(F()(i.prototype),"doSetText_",this).call(this)}},{key:"doInsertText",value:function(t,e){f()(F()(i.prototype),"insertText",this).call(this,t,e),this._selStart>=0&&(this._selStart+=e.length,this._selMove=this._selStart,this.scrollAdjust_(this._selMove),this.showCaret_())}},{key:"dispose",value:function(){this._destroyCaret()}},{key:"insertText",value:function(t,e){this.beginUpdate();try{this.selectExists()&&this.deleteSelect(),this.doInsertText(t,e)}finally{this.endUpdate()}}},{key:"copy",value:function(t){this.hcl.clipboard.clear(),this.hcl.localStorage.removeClipboardItem(),this.selectExists()&&this.hcl.clipboard.setText(this.selectText()),t&&t.clipboardData.setData(_.TXT,this.selectText())}},{key:"copyToBrower",value:function(){this.selectExists()&&this.hcl.clipboard.toBrowerClipboard(this.selectText())}},{key:"cut",value:function(t){this.copy(t),this.deleteSelect()}},{key:"paste",value:function(t){if(t&&t.clipboardData.types.indexOf(_.TXT)>-1)this.insertText(this._selStart,t.clipboardData.getData(_.TXT));else{var e=this.hcl.localStorage.getString(E.Text);null!=e&&this.insertText(this._selStart,e)}}},{key:"deleteSelect",value:function(){this.beginUpdate();try{this.deleteText(this._selStart,this.selLength),this._selEnd=-1,this._selMove=this._selStart,this.scrollAdjust_(this._selMove),this.showCaret_()}finally{this.endUpdate()}}},{key:"disSelect",value:function(){this._selMove=this._selStart,this.selectExists()&&(this._selEnd=-1,this.resetSelect_())}},{key:"select",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t<0||(this._selStart=t,e>0?(this._selEnd=t+e,this._selMove=this._selEnd):(this._selEnd=-1,this._selMove=this._selStart),this.scrollAdjust_(this._selMove),this.resetSelect_())}},{key:"selectAll",value:function(){this.select(0,this.text.length)}},{key:"selectText",value:function(){return this._selEnd>=0?this.text.substring(this._selStart,this._selEnd):""}},{key:"selectExists",value:function(){return this._selEnd>=0&&this._selEnd!=this._selStart}},{key:"imeInput",value:function(t){this.readOnly||this.insertText(this._selStart,t)}},{key:"tabSetFocus",value:function(){f()(F()(i.prototype),"tabSetFocus",this).call(this),this.selectAll()}},{key:"selStart",get:function(){return this.selectExists()&&this._selEnd<this._selStart?this._selEnd:this._selStart}},{key:"selLength",get:function(){return this._selEnd<0?0:Math.abs(this._selEnd-this._selStart)}},{key:"textPrompt",get:function(){return this._textPrompt},set:function(t){this._textPrompt!=t&&(this._textPrompt=t,this.update())}},{key:"number",get:function(){return parseInt(this.text)}}]),i}(nn),sn=0,rn=1,an=function(t){m()(i,t);var e=Gi(i);function i(t,n){var o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:NaN,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:NaN;return r()(this,i),o=e.call(this,t),n?L.isNumber(n)?o.text_=n.toString():o.text_=n:o.text_="0",o.valueMask_=sn,o.min=s,o.max=a,o}return l()(i,[{key:"doInsertText",value:function(t,e){var n=L.stringInsert(this.text,t,e);switch(this.valueMask_){case sn:if(!/^-?\d+$/.test(n))return;break;case rn:if(!/^(-?\d+)(\.\d+)?$/.test(n)&&!/^(-?\d+)(\.)?$/.test(n))return}f()(F()(i.prototype),"doInsertText",this).call(this,t,e)}},{key:"doKeyDown_",value:function(t){if(t.keyCode===je){var e=L.tryParseInt(this.text);e.ok&&(this.text=(e.value+1).toString())}else if(t.keyCode===Qe){var n=L.tryParseInt(this.text);n.ok&&(this.text=(n.value-1).toString())}else f()(F()(i.prototype),"doKeyDown_",this).call(this,t)}},{key:"getNumber",value:function(t){switch(this.valueMask_){case rn:return parseFloat(t);default:return parseInt(t)}}},{key:"setText_",value:function(t){!isNaN(this.min)&&this.getNumber(t)<this.min||!isNaN(this.max)&&this.getNumber(t)>this.max||f()(F()(i.prototype),"setText_",this).call(this,t)}},{key:"number",get:function(){return this.getNumber(this.text)}},{key:"valueMask",get:function(){return this.valueMask_},set:function(t){this.valueMask_=t}}]),i}(on),ln=function(t){m()(i,t);var e=Gi(i);function i(t,n){var o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:NaN,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:NaN;return r()(this,i),(o=e.call(this,t,n,s,a))._paddingRight=10,o.FIncrement=1,o._timerProc=!1,o.FRepeatTimer=null,o.FCapture=0,o.allowTimer=!0,o.btnUpRect=new nt,o.btnDownRect=new nt,o.calcButtonRect_(),o}return l()(i,[{key:"calcButtonRect_",value:function(){this.btnUpRect.reset(this.width-this._paddingRight+1,this.borderWidth_,this.width-this.borderWidth_,Math.trunc(this.height/2)-this.borderWidth_),this.btnDownRect.reset(this.btnUpRect.left,Math.trunc(this.height/2)-this.borderWidth_,this.btnUpRect.right,this.height-this.borderWidth_)}},{key:"doPaintBackground_",value:function(t){f()(F()(i.prototype),"doPaintBackground_",this).call(this,t),t.brush.color=this.hcl.theme.backgroundHotColor,t.fillRect(this.btnUpRect),t.fillRect(this.btnDownRect),this.hcl.theme.drawDropUp(t,this.btnUpRect),this.hcl.theme.drawDropDown(t,this.btnDownRect)}},{key:"doUpButtonClick_",value:function(){this.onUpButtonClick?this.onUpButtonClick():this.text=this.number+this.FIncrement,this.doChange_()}},{key:"doDownButtonClick_",value:function(){this.onDownButtonClick?this.onDownButtonClick():this.text=this.number-this.FIncrement,this.doChange_()}},{key:"doTimer_",value:function(){this._timerProc=this.FCapture>0,1===this.FCapture?this.doUpButtonClick_():2===this.FCapture&&this.doDownButtonClick_()}},{key:"doStopTimer",value:function(){null!==this.FRepeatTimer&&(this.FRepeatTimer.enabled=!1)}},{key:"doKillFocus_",value:function(){f()(F()(i.prototype),"doKillFocus_",this).call(this),this.doStopTimer()}},{key:"doMouseLeave_",value:function(){f()(F()(i.prototype),"doMouseLeave_",this).call(this),this.doStopTimer()}},{key:"doMouseDown_",value:function(t){var e=this;f()(F()(i.prototype),"doMouseDown_",this).call(this,t),!this.readOnly&&this.allowTimer&&(this.btnUpRect.pointInAt(t.x,t.y)?this.FCapture=1:this.btnDownRect.pointInAt(t.x,t.y)?this.FCapture=2:this.FCapture=0,this.FCapture>0&&(null===this.FRepeatTimer&&(this.FRepeatTimer=new ct(400),this.FRepeatTimer.onTimer=function(){e.doTimer_()}),this.FRepeatTimer.enabled=!0))}},{key:"doMouseUp_",value:function(t){this.doStopTimer(),this.readOnly||this._timerProc?f()(F()(i.prototype),"doMouseUp_",this).call(this,t):this.btnUpRect.pointInAt(t.x,t.y)?this.doUpButtonClick_():this.btnDownRect.pointInAt(t.x,t.y)?this.doDownButtonClick_():f()(F()(i.prototype),"doMouseUp_",this).call(this,t),this._timerProc=!1}},{key:"doResize_",value:function(){f()(F()(i.prototype),"doResize_",this).call(this),this.calcButtonRect_()}}]),i}(an),hn=function(t){m()(i,t);var e=Gi(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,o))._lableText=n,s._paddingLeft=t.theme.marginSpaceDouble+t.textWidth(s.font,s._lableText),s.width_=t.textWidth(t.defaultFont,n)+75,s}return l()(i,[{key:"doPaintBackground_",value:function(t){t.font.assign(this.hcl.defaultFont),t.textOut(this.hcl.theme.marginSpace,this.getCharTop_(),this._lableText),f()(F()(i.prototype),"doPaintBackground_",this).call(this,t)}},{key:"lableText",get:function(){return this._lableText},set:function(t){this._lableText=t}}]),i}(on),cn=function(t){m()(i,t);var e=Gi(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).image=new Image(o.hcl.theme.iconSize,o.hcl.theme.iconSize),o.image.onload=function(t){o._updateButtonRect()},o._paddingRight=o.hcl.theme.iconSize,o._buttonMouseIn=!1,o._buttonDown=!1,o._buttonRect=new nt,o.calcButtonRect_(),o}return l()(i,[{key:"doButtonClick_",value:function(){this.onButtonClick&&this.onButtonClick()}},{key:"_updateButtonRect",value:function(){this.updateRect(this._buttonRect)}},{key:"calcButtonRect_",value:function(){this._buttonRect.reset(this.width-this._paddingRight+1,this.borderWidth_,this.width-this.borderWidth_,this.height-this.borderWidth_)}},{key:"doPaintBackground_",value:function(t){f()(F()(i.prototype),"doPaintBackground_",this).call(this,t),this._buttonMouseIn&&(this._buttonDown?t.brush.color=this.hcl.theme.backgroundDownColor:t.brush.color=this.hcl.theme.backgroundHotColor,t.fillRect(this._buttonRect)),this.image.loaded?t.drawImage(this._buttonRect.left,this._buttonRect.top,this.image):this.hcl.theme.drawDropDown(t,this._buttonRect)}},{key:"doMouseEnter_",value:function(){f()(F()(i.prototype),"doMouseEnter_",this).call(this),this.cursor=Ce}},{key:"doMouseLeave_",value:function(){this._buttonMouseIn=!1,this._buttonDown=!1,f()(F()(i.prototype),"doMouseLeave_",this).call(this)}},{key:"doMouseDown_",value:function(t){this._buttonRect.pointInAt(t.x,t.y)?(this.hideCaret_(),this._buttonDown=!0,this._updateButtonRect(),this.focused||f()(F()(i.prototype),"doMouseDown_",this).call(this,t)):(this._buttonDown=!1,f()(F()(i.prototype),"doMouseDown_",this).call(this,t))}},{key:"doMouseMove_",value:function(t){this._buttonRect.pointInAt(t.x,t.y)?this._buttonMouseIn||(this._buttonMouseIn=!0,this._updateButtonRect(),this.cursor=Se):this._buttonMouseIn&&(this._buttonMouseIn=!1,this._updateButtonRect(),this.cursor=Ce),this._buttonDown||f()(F()(i.prototype),"doMouseMove_",this).call(this,t)}},{key:"doMouseUp_",value:function(t){this._buttonDown?(this._buttonDown=!1,this._updateButtonRect(),this._buttonRect.pointInAt(t.x,t.y)&&!this.readOnly&&this.doButtonClick_()):f()(F()(i.prototype),"doMouseUp_",this).call(this,t)}},{key:"doDblClick_",value:function(t){this._buttonRect.pointInAt(t.x,t.y)||f()(F()(i.prototype),"doDblClick_",this).call(this,t)}},{key:"doResize_",value:function(){f()(F()(i.prototype),"doResize_",this).call(this),this.calcButtonRect_()}},{key:"onButtonClick",value:function(){}}]),i}(on),un=function(){function t(){r()(this,t),this.text="",this.object=null}return l()(t,null,[{key:"Create",value:function(e,i){var n=new t;return n.text=e,n.object=i,n}}]),t}(),fn=function(t){m()(i,t);var e=Gi(i);function i(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return r()(this,i),e.call(this,t)}return l()(i,[{key:"add",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;f()(F()(i.prototype),"add",this).call(this,un.Create(t,e))}},{key:"indexOf",value:function(t){for(var e=0;e<this.count;e++)if(this[e].text==t)return e;return-1}},{key:"indexOfObject",value:function(t){for(var e=0;e<this.count;e++)if(this[e].object===t)return e;return-1}}]),i}(ot),dn=function(t){m()(i,t);var e=Gi(i);function i(t){var n;return r()(this,i),(n=e.call(this,t,"")).height_=100,n._itemIndex=-1,n._hotIndex=-1,n._displayFirst=-1,n._displayLast=-1,n._paddingLeft=2,n._paddingTop=2,n._paddingRight=2,n._paddingBottom=2,n.borderVisible_=!0,n._mouseDownScrollBar=!1,n._scrollBar=new Di(t),n._scrollBar.width=20,n._scrollBar.orientation=ee,n._scrollBar.onScroll=function(t,e){n._calcDisplayItem(),n.update()},n._items=new fn,n._items.onAdded=function(t){n._reSetContent()},n._items.onRemoved=function(t){n._itemIndex=-1,n._hotIndex=-1,n._reSetContent()},n.onSelectedIndexChange=null,n.onGetIndexHint=null,n}return l()(i,[{key:"_getTopOffset",value:function(){return this._scrollBar.visible?this._scrollBar.position:0}},{key:"_calcDisplayItem",value:function(){if(this._items.count>0){this._displayFirst=0;for(var t=this.paddingTop-this._getTopOffset()+this.font.height+this.hcl.theme.marginSpaceDouble,e=0;e<this._items.count;e++){if(t>0){this._displayFirst=e;break}t=t+this.font.height+this.hcl.theme.marginSpaceDouble}this._displayLast=this._items.count-1;for(var i=this._displayFirst;i<this._items.count;i++){if(t>this.height_-this.paddingBottom){this._displayLast=i;break}t=t+this.font.height+this.hcl.theme.marginSpaceDouble}}else this._displayFirst=-1,this._displayLast=-1}},{key:"_getItemRect",value:function(t){return nt.CreateByBounds(this.paddingLeft,t*(this.font.height+this.hcl.theme.marginSpaceDouble)-this._getTopOffset()+this.paddingTop+(this.borderVisible_?this.borderWidth_:0),this.width-this._paddingLeft-this.paddingRight,this.font.height+this.hcl.theme.marginSpaceDouble)}},{key:"_getItemIndexAt",value:function(t,e){if(t>0&&t<(this._scrollBar.visible?this._scrollBar.left:this.width))for(var i=-this._getTopOffset(),n=0;n<this._items.count;n++){if(e>i&&e<=i+this.font.height+this.hcl.theme.marginSpaceDouble)return n;i+=this.font.height+this.hcl.theme.marginSpaceDouble}return-1}},{key:"_getContentHeight",value:function(){return this._items.count*(this.font.height+this.hcl.theme.marginSpaceDouble)}},{key:"_setHotIndex",value:function(t){if(t!==this._hotIndex){var e=this._hotIndex;this._hotIndex=t,e>=0&&this.updateRect(this._getItemRect(e)),this._hotIndex>=0&&this.updateRect(this._getItemRect(this._hotIndex))}}},{key:"doSelectedIndexChange_",value:function(){null!=this.onSelectedIndexChange&&this.onSelectedIndexChange()}},{key:"_setItemIndex",value:function(t){if(t!=this._itemIndex){var e=this._itemIndex;if(this._itemIndex=t,e>=0&&this.updateRect(this._getItemRect(e)),this._itemIndex>=0&&this._itemIndex<this._items.count){this.text=this._items[this._itemIndex].text;var i=this._getItemRect(this._itemIndex);i.top<this.paddingTop?this._scrollBar.position-=this.paddingTop-i.top:i.bottom>this.height-this.paddingBottom?this._scrollBar.position+=i.bottom-this.height+this.paddingBottom:this.update()}else this.text="";this.doSelectedIndexChange_()}}},{key:"_reSetContent",value:function(){var t=this._getContentHeight();t>this.height?(this.borderVisible_?(this._scrollBar.height=this.height-this.borderWidth_-this.borderWidth_-1,this._scrollBar.left=this.width-this._scrollBar.width-this._paddingRight-this.borderWidth_+2,this._scrollBar.top=this.borderWidth_+1):(this._scrollBar.height=this.height,this._scrollBar.left=this.width-this._scrollBar.width-this._paddingRight,this._scrollBar.top=0),this._scrollBar.max=t,this._scrollBar.visible=!0):this._scrollBar.visible=!1,this._calcDisplayItem(),this.update()}},{key:"getHint_",value:function(){return this._hotIndex>=0&&null!==this.onGetIndexHint?this.onGetIndexHint(this._hotIndex):f()(F()(i.prototype),"getHint_",this).call(this)}},{key:"doSetPaddingRight_",value:function(t){f()(F()(i.prototype),"doSetPaddingRight_",this).call(this,t)}},{key:"doResize_",value:function(){f()(F()(i.prototype),"doResize_",this).call(this),this._reSetContent()}},{key:"doMouseEnter_",value:function(){f()(F()(i.prototype),"doMouseEnter_",this).call(this),this.update()}},{key:"doMouseLeave_",value:function(){this._hotIndex=-1,f()(F()(i.prototype),"doMouseLeave_",this).call(this),this.update()}},{key:"doMouseWheel_",value:function(t){this._scrollBar.visible&&(t.delta<0?this._scrollBar.position+=20:this._scrollBar.position-=20),f()(F()(i.prototype),"doMouseWheel_",this).call(this,t)}},{key:"doMouseDown_",value:function(t){if(this._mouseDownScrollBar=!1,this._scrollBar.visible){var e=this._scrollBar.bounds();if(e.pointInAt(t.x,t.y)){this._mouseDownScrollBar=!0;var n=new fi;return n.assign(t),n.x-=e.left,n.y-=e.top,void this._scrollBar.mouseDown(n)}}this.textArea().pointInAt(t.x,t.y)&&f()(F()(i.prototype),"doMouseDown_",this).call(this,t)}},{key:"doMouseMove_",value:function(t){var e=!1;if(this._scrollBar.visible){var n=this._scrollBar.bounds();if(n.pointInAt(t.x,t.y)){e=!0;var o=new fi;o.assign(t),o.x-=n.left,o.y-=n.top,this._scrollBar.mouseMove(o)}else if(this._mouseDownScrollBar){e=!0;var s=new fi;s.assign(t),s.x=n.left,s.y-=n.top,this._scrollBar.mouseMove(s)}}e&&this._hotIndex>=0?this._setHotIndex(-1):(this._mouseDownScrollBar?this._setHotIndex(-1):this._setHotIndex(this._getItemIndexAt(t.x,t.y)),f()(F()(i.prototype),"doMouseMove_",this).call(this,t))}},{key:"doMouseUp_",value:function(t){if(this._mouseDownScrollBar){if(this._scrollBar.visible){var e=this._scrollBar.bounds();if(e.pointInAt(t.x,t.y)){var n=new fi;n.assign(t),n.x-=e.left,n.y-=e.top,this._scrollBar.mouseUp(n)}}this._mouseDownScrollBar=!1}else{if(this._scrollBar.visible)if(this._scrollBar.bounds().pointInAt(t.x,t.y))return;t.button===ae&&this.textArea().pointInAt(t.x,t.y)&&(this.itemIndex=this._getItemIndexAt(t.x,t.y)),f()(F()(i.prototype),"doMouseUp_",this).call(this,t)}}},{key:"_doPaintBorder",value:function(t,e){t.pen.width=this.borderWidth_,this._readOnly?t.pen.color=this.hcl.theme.borderColor:this.focused?t.pen.color=this.hcl.theme.borderActiveColor:this.mouseIn?t.pen.color=this.hcl.theme.borderHotColor:t.pen.color=this.hcl.theme.borderColor,t.rectangleRect(e)}},{key:"_doPaintSelected",value:function(t){}},{key:"doPaintBackground_",value:function(t){var e=this.clientRect();if(t.brush.color=this.hcl.theme.backgroundContentColor,t.fillRect(e),this._itemIndex>=0||this._hotIndex>=0){var i=this.textArea();if(this._itemIndex>=0){var n=this._getItemRect(this._itemIndex);n=i.intersection(n),t.brush.color=this.hcl.theme.backgroundSelectColor,t.fillRect(n)}if(this._hotIndex>=0&&this._hotIndex!=this._itemIndex){var o=this._getItemRect(this._hotIndex);o=i.intersection(o),t.brush.color=this.hcl.theme.backgroundHotColor,t.fillRect(o)}}this.borderVisible_&&this._doPaintBorder(t,e)}},{key:"doPaintText_",value:function(t,e,i){var n=this.paddingLeft+this.hcl.theme.marginSpace+(this.borderVisible_?this.borderWidth_:0);if(!(this._displayLast<0)){t.font.assign(this.hcl.defaultFont);for(var o=this._getItemRect(this._displayFirst).top,s=this._displayFirst;s<=this._displayLast;s++)t.textOut(n,o+this.hcl.theme.marginSpace,this._items[s].text),o+=this.font.height+this.hcl.theme.marginSpaceDouble}}},{key:"doSetBorderVisible_",value:function(){this._reSetContent(),f()(F()(i.prototype),"doSetBorderVisible_",this).call(this)}},{key:"doPaint_",value:function(t){var e=this.textArea();t.save();try{t.clipRect(e),this.doPaintText_(t,this.paddingLeft,this.paddingTop)}finally{t.restore()}if(this._scrollBar.visible){e=this.clientRect(),t.save();try{t.clipRect(e),this._scrollBar.paintTo(t,this._scrollBar.left,this._scrollBar.top)}finally{t.restore()}}}},{key:"dispose",value:function(){this._items.clear()}},{key:"textArea",value:function(){var t=f()(F()(i.prototype),"textArea",this).call(this);return this._scrollBar.visible&&(t.right=t.right-this._scrollBar.width+2),t}},{key:"clear",value:function(){f()(F()(i.prototype),"clear",this).call(this),this._itemIndex=-1,this._hotIndex=-1,this._items.clear()}},{key:"addItem",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._items.add(t,e)}},{key:"deleteItem",value:function(t){t>=0&&t<this._items.count&&this._items.removeAt(t)}},{key:"itemIndexOf",value:function(t){return this._items.indexOf(t)}},{key:"getContentWidth",value:function(){for(var t=0,e=0,i=0;i<this._items.count;i++)t<(e=this.hcl.textWidth(this.font,this._items[i].text))&&(t=e);return this.paddingLeft+this.paddingRight+t}},{key:"scrollBarVisible",get:function(){return this._scrollBar.visible}},{key:"items",get:function(){return this._items},set:function(t){this._items=t,this._reSetContent()}},{key:"selectItem",get:function(){return this._itemIndex>=0?this._items[this._itemIndex]:null}},{key:"itemIndex",get:function(){return this._itemIndex},set:function(t){this._setItemIndex(t)}},{key:"contentHeight",get:function(){return this._getContentHeight()}}]),i}(zi),mn=function(t){m()(i,t);var e=Gi(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).popupAlign_=Qt,o.DropDownWidth_=100,o.autoDropDownWidth=!1,o.dropDownCount_=8,o.static_=!1,o.popupDownInTextArea_=!1,o._listBox=new dn(t),o._listBox.paddingLeft=0,o._listBox.paddingTop=0,o._listBox.paddingRight=0,o._listBox.paddingBottom=0,o._listBox.onUpdate=function(t){o._listBoxUpdate(t)},o._listBox.onGetIndexHint=function(t){return o.doGetIndexHint(t)},o._popupControl=null,o.onPopupBefor=null,o.onPopupAfter=null,o.onGetIndexHint=null,o.onSelectedIndexChange=null,o}return l()(i,[{key:"doKeyDown_",value:function(t){!this.readOnly&&this.items.count>0&&(t.keyCode===je&&this.itemIndex>0?this.itemIndex--:t.keyCode===Qe&&this.itemIndex<this.items.count-1&&this.itemIndex++),this.static_||f()(F()(i.prototype),"doKeyDown_",this).call(this,t)}},{key:"doKeyPress_",value:function(t){this.static_||f()(F()(i.prototype),"doKeyPress_",this).call(this,t)}},{key:"insertText",value:function(t,e){this.static_||f()(F()(i.prototype),"insertText",this).call(this,t,e)}},{key:"_listBoxUpdate",value:function(t){null!=this._popupControl&&this._popupControl.updateRect(t)}},{key:"doGetIndexHint",value:function(t){return null!=this._popupControl&&null!==this.onGetIndexHint?this.onGetIndexHint(t):this.getHint_()}},{key:"_popup",value:function(){var t=this;if(null!==this.onPopupBefor&&this.onPopupBefor(this),null==this._popupControl){this.autoDropDownWidth?this._listBox.width=this._listBox.getContentWidth()+this.hcl.theme.marginSpaceDouble+(this._listBox.scrollBarVisible?this._listBox._scrollBar.width:0):this._listBox.width=this.DropDownWidth_,this._listBox.itemIndex=this._listBox.itemIndexOf(this.text);var e=this.dropDownCount_*(this._listBox.font.height+this.hcl.theme.marginSpaceDouble),i=this._listBox.contentHeight;this._listBox.height=i>e?e:i,this._popupControl=new Si(this.hcl),this._popupControl.width=this._listBox.width,this._popupControl.height=this._listBox.height,this._popupControl.dropDownStyle=!0,this._popupControl.adjustPosition=!0,this._popupControl.onClose=function(){t._popupControl=null,null!==t.onPopupAfter&&t.onPopupAfter(t)},this._popupControl.onDone=function(){t.doSelectedIndexChange_()},this._popupControl.onPaint=function(e){t._listBox.paintTo(e,0,0)},this._popupControl.onMouseEnter=function(){t._listBox.mouseEnter()},this._popupControl.onMouseLeave=function(){t._listBox.mouseLeave()},this._popupControl.onMouseWheel=function(e){t._listBox.mouseWheel(e)},this._popupControl.onMouseDown=function(e){t.popupDownInTextArea_=t._listBox.textArea().pointInAt(e.x,e.y),t._listBox.mouseDown(e)},this._popupControl.onMouseMove=function(e){t._listBox.mouseMove(e)},this._popupControl.onMouseUp=function(e){t._listBox.mouseUp(e),t.popupDownInTextArea_&&t._listBox.textArea().pointInAt(e.x,e.y)&&t.doDonePopup_()},this._popupControl.onGetHint=function(){return t._listBox.getHint_()}}var n=this.clientToScreen(et.Create(0,0));this.popupAlign_===Qt?n.x+=this.paddingLeft-(this.borderVisible_?this.borderWidth_:0):n.x+=this.width-this._popupControl.width,this._popupControl.popup(n.x,n.y+this.height,!0)}},{key:"doDonePopup_",value:function(){this._popupControl.donePopup()}},{key:"doSelectedIndexChange_",value:function(){this.text=this._listBox.text,null!==this.onSelectedIndexChange&&this.onSelectedIndexChange()}},{key:"doButtonClick_",value:function(){this.readOnly||this._popup(),f()(F()(i.prototype),"doButtonClick_",this).call(this)}},{key:"addItem",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._listBox.addItem(t,e)}},{key:"removeItem",value:function(t){this._listBox.removeItem(t)}},{key:"itemIndexOf",value:function(t){return this._listBox.itemIndexOf(t)}},{key:"dropDownWidth",get:function(){return this.DropDownWidth_},set:function(t){this.DropDownWidth_=t}},{key:"itemIndex",get:function(){return this._listBox.itemIndex},set:function(t){this._listBox.itemIndex=t,this.text=this._listBox.text}},{key:"items",get:function(){return this._listBox.items}},{key:"static",get:function(){return this.static_},set:function(t){this.static_=t}}]),i}(cn),Sn=function(t){m()(i,t);var e=Gi(i);function i(t){var n;r()(this,i),(n=e.call(this,t)).FDateTime=lt.Now(),n.width_=170,n.height_=185,n.edtHour=new ln(t,0),n.edtHour.min=0,n.edtHour.max=23,n.edtHour.left=5,n.edtHour.top=162,n.edtHour.width=28,n.edtHour.onChange=function(){n.doChange_()};var o=new Ki(t,"时");o.left=34,o.top=166,n.edtMinute=new ln(t,0),n.edtMinute.min=0,n.edtMinute.max=59,n.edtMinute.left=48,n.edtMinute.top=162,n.edtMinute.width=28,n.edtMinute.onChange=function(){n.doChange_()};var s=new Ki(t,"分");s.left=77,s.top=166,n.edtSecond=new ln(t,0),n.edtSecond.min=0,n.edtSecond.max=59,n.edtSecond.left=90,n.edtSecond.top=162,n.edtSecond.width=28,n.edtSecond.onChange=function(){n.doChange_()};var a=new Ki(t,"秒");a.left=118,a.top=166,n.btnDone=new Ji(t,"确定"),n.btnDone.left=n.width-38,n.btnDone.top=162,n.btnDone.width=35,n.btnDone.onClick=function(){n.doDone_()},n.beginUpdate();try{n.addControl(n.edtHour),n.addControl(o),n.addControl(n.edtMinute),n.addControl(s),n.addControl(n.edtSecond),n.addControl(a),n.addControl(n.btnDone)}finally{n.endUpdate()}return n._initNewDT(),n}return l()(i,[{key:"_initNewDT",value:function(){this.newYear_=this.FDateTime.year,this.newMonth_=this.FDateTime.month,this.newDay_=this.FDateTime.day,this.newHour_=this.FDateTime.hour,this.newMinute_=this.FDateTime.minute,this.newSecond_=this.FDateTime.second,this.edtHour.text=this.newHour_.toString(),this.edtMinute.text=this.newMinute_.toString(),this.edtSecond.text=this.newSecond_.toString()}},{key:"doPaint_",value:function(t){t.brush.color=Ft.White,t.fillBounds(0,0,this.width_,this.height_-25),t.textOut(3,3,"<"),t.textOut(13,3,this.newYear_),t.textOut(45,3,">"),t.textOut(63,3,"<"),t.textOut(72,3,this.newMonth_),t.textOut(89,3,">"),t.textOut(this.width-30,3,"今天"),t.brush.color=Ft.LightGray,t.fillBounds(0,20,this.width_,20),t.textOut(5,23,"日"),t.textOut(29,23,"一"),t.textOut(53,23,"二"),t.textOut(77,23,"三"),t.textOut(101,23,"四"),t.textOut(125,23,"五"),t.textOut(149,23,"六");for(var e=new lt,n=this.newYear_==e.year&&this.newMonth_==e.month,o=new Date(this.newYear_,this.newMonth_,0),s=o.getDate(),r=(o=new Date(this.newYear_,this.newMonth_-1,1)).getDay(),a=24*r+3,l=43,h=1;h<=s;h++)n&&h==e.day&&(t.brush.color=Ft.Gray,t.fillBounds(a,l,20,20)),h==this.newDay_&&(t.brush.color=this.hcl.theme.backgroundSelectColor,t.fillBounds(a,l,20,20)),t.textOut(a+3,l+3,h),7==++r?(r=0,a=3,l+=20):a+=24;f()(F()(i.prototype),"doPaint_",this).call(this,t)}},{key:"doMouseUp_",value:function(t){if(t.x>0&&t.x<12&&t.y>0&&t.y<20)this.newYear_--,this.doChange_();else if(t.x>42&&t.x<54&&t.y>0&&t.y<20)this.newYear_++,this.doChange_();else if(t.x>60&&t.x<72&&t.y>0&&t.y<20){this.newMonth_>1?this.newMonth_--:(this.newYear_--,this.newMonth_=12);var e=new Date(this.newYear_,this.newMonth_,0).getDate();this.newDay_>e&&(this.newDay_=e),this.doChange_()}else if(t.x>86&&t.x<98&&t.y>0&&t.y<20){this.newMonth_<12?this.newMonth_++:(this.newYear_++,this.newMonth_=1);var n=new Date(this.newYear_,this.newMonth_,0).getDate();this.newDay_>n&&(this.newDay_=n),this.doChange_()}else if(t.x>this.width_-30&&t.y<20){var o=new lt;this.newYear_=o.year,this.newMonth_=o.month,this.newDay_=o.day,this.doChange_()}else for(var s=new Date(this.newYear_,this.newMonth_,0),r=s.getDate(),a=(s=new Date(this.newYear_,this.newMonth_-1,1)).getDay(),l=24*a+3,h=43,c=1;c<=r;c++){if(t.x>l&&t.x<l+20&&t.y>h&&t.y<h+20){this.newDay_=c,this.doChange_();break}7==++a?(a=0,l=3,h+=20):l+=24}f()(F()(i.prototype),"doMouseUp_",this).call(this,t)}},{key:"doDone_",value:function(){null!=this.onDone&&this.onDone()}},{key:"doChange_",value:function(){this.update(),null!=this.onChange&&this.onChange()}},{key:"newHour",get:function(){return this.newHour_},set:function(t){this.newHour_=t,this.edtHour.text=t.toString()}},{key:"newMinute",get:function(){return this.newMinute_},set:function(t){this.newMinute_=t,this.edtMinute.text=t.toString()}},{key:"newSecond",get:function(){return this.newSecond_},set:function(t){this.newSecond_=t,this.edtSecond.text=t.toString()}},{key:"dateTime",get:function(){return lt.Create(this.newYear_,this.newMonth_,this.newDay_,L.parseIntDef(this.edtHour.text,0),L.parseIntDef(this.edtMinute.text,0),L.parseIntDef(this.edtSecond.text,0))},set:function(t){t&&(this.FDateTime.initByDateTime(t),this._initNewDT(),this.doChange_())}}]),i}(Bi),pn={None:1,Year:2,Month:4,Day:8,Hour:16,Minute:32,Second:64,Millisecond:128},yn=function(t){m()(i,t);var e=Gi(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n.toString())).canFocus=!0,o.borderVisible_=!0,o.FDateTime=n,o.FFormat="yyyy-MM-dd hh:mm:ss",o._popupControl=null,o.paddingLeft=o.borderWidth_,o._paddingRight=o.hcl.theme.iconSize,o._buttonMouseIn=!1,o._buttonDown=!1,o._buttonRect=new nt,o.calcButtonRect_(),o.FActiveArea=pn.None,o.FAreaRect=new nt,o.FNewYear="",o.FJoinKey=!1,o}return l()(i,[{key:"_popup",value:function(){var t=this;null==this._popupControl&&(this._popupControl=new Ni(this.hcl),this._popupControl.width=170,this._popupControl.height=185,this._popupControl.dropDownStyle=!0,this.monthCalendar=new Sn(this.hcl),this.monthCalendar.onDone=function(){t._popupControl.donePopup()},this._popupControl.addControl(this.monthCalendar),this._popupControl.onClose=function(){t._popupControl=null},this._popupControl.onDone=function(){t.FDateTime=lt.CreateByDateTime(t.monthCalendar.dateTime),t.text=t.FDateTime.format(t.FFormat)}),this.monthCalendar.dateTime=lt.CreateByDateTime(this.FDateTime);var e=this.clientToScreen(et.Create(0,0));e.x+=this.paddingLeft-(this.borderVisible_?this.borderWidth_:0),this._popupControl.popup(e.x,e.y+this.height,!0)}},{key:"_updateButtonRect",value:function(){this.updateRect(this._buttonRect)}},{key:"calcButtonRect_",value:function(){this._buttonRect.reset(this.width-this._paddingRight+1,this.borderWidth_,this.width-this.borderWidth_,this.height-this.borderWidth_)}},{key:"GetAreaPosition",value:function(t,e){for(var i=!1,n=-1,o=0,s=0;s<this.FFormat.length;s++)if((e?this.FFormat[s].toUpperCase():this.FFormat[s])===t)i||(i=!0),n<0&&(n=s),o++;else if(i)return{index:n,count:o};return{index:n,count:o}}},{key:"AppendFormat",value:function(t,e,i){i.reset(0,0,0,0);var n,o=0,s=-1;switch(e){case pn.Year:o=(n=this.GetAreaPosition("y",!1)).index,s=n.count;break;case pn.Month:o=(n=this.GetAreaPosition("M",!0)).index,s=n.count;break;case pn.Day:o=(n=this.GetAreaPosition("d",!1)).index,s=n.count;break;case pn.Hour:o=(n=this.GetAreaPosition("H",!0)).index,s=n.count;break;case pn.Minute:o=(n=this.GetAreaPosition("m",!1)).index,s=n.count;break;case pn.Second:o=(n=this.GetAreaPosition("s",!1)).index,s=n.count}if(s>0){var r="";o>0&&(r=this.FFormat.substr(0,o)),i.left=this._paddingLeft+(this.borderVisible?this.borderWidth_:0),""!==r&&(i.left+=t.textWidth(r));var a=t.textMetric(this.FFormat.substr(o,s));i.top=Math.trunc((this.height-a.height)/2),i.right=i.left+a.width,i.bottom=i.top+a.height}}},{key:"GetAreaRect",value:function(t){var e=new nt;return t===pn.None||(this.hcl.hclCanvasTemp.font.assign(this.font),""!==this.FFormat&&this.AppendFormat(this.hcl.hclCanvasTemp,t,e)),e}},{key:"GetAreaAt",value:function(t,e){return this.GetAreaRect(pn.Year).pointInAt(t,e)?pn.Year:this.GetAreaRect(pn.Month).pointInAt(t,e)?pn.Month:this.GetAreaRect(pn.Day).pointInAt(t,e)?pn.Day:this.GetAreaRect(pn.Hour).pointInAt(t,e)?pn.Hour:this.GetAreaRect(pn.Minute).pointInAt(t,e)?pn.Minute:this.GetAreaRect(pn.Second).pointInAt(t,e)?pn.Second:this.GetAreaRect(pn.Millisecond).pointInAt(t,e)?pn.dtaMillisecond:pn.None}},{key:"SetDateTime",value:function(t){this.FDateTime!=t&&(this.FDateTime=t,f()(F()(i.prototype),"setText_",this).call(this,this.FDateTime.format(this.FFormat)),this.FAreaRect=this.GetAreaRect(this.FActiveArea))}},{key:"Power10",value:function(t){for(var e=10,i=2;i<=t;i++)e*=10;return e}},{key:"GetYear",value:function(t){var e=this.FDateTime.year,i=1999,n=L.tryParseInt(t);if(n.ok)if((i=n.value)<e){var o=this.Power10(t.length);e=Math.trunc(e/o),e=Math.trunc(e*o)+i}else e=i;return e}},{key:"SetInputYear",value:function(){""!=this.FNewYear&&(this.DateTime=lt.Create(this.GetYear(this.FNewYear),this.FDateTime.month,this.FDateTime.day,this.FDateTime.hour,this.FDateTime.minute,this.FDateTime.second),this.FNewYear="")}},{key:"SetFormat",value:function(t){this.FFormat!=t&&(this.FFormat=t,f()(F()(i.prototype),"setText_",this).call(this,this.FDateTime.format(this.FFormat)),this.FAreaRect=this.GetAreaRect(this.FActiveArea))}},{key:"doPaintBorder_",value:function(t,e){t.pen.width=this.borderWidth_,t.pen.style=_t.Solid,this.enabled?this.focused?t.pen.color=this.hcl.theme.borderActiveColor:this.mouseIn?t.pen.color=this.hcl.theme.borderHotColor:t.pen.color=this.hcl.theme.borderColor:t.pen.color=this.hcl.theme.borderColor,t.rectangleRect(e)}},{key:"doPaintBackground_",value:function(t){var e=this.clientRect();e.left=this.paddingLeft,t.brush.color=this.hcl.theme.backgroundContentColor,t.fillRect(e),this.borderVisible_&&(e.left-=this.borderWidth_,this.doPaintBorder_(t,e)),this._buttonMouseIn&&(this._buttonDown?t.brush.color=this.hcl.theme.backgroundDownColor:t.brush.color=this.hcl.theme.backgroundHotColor,t.fillRect(this._buttonRect)),this.hcl.theme.drawDropDown(t,this._buttonRect)}},{key:"doPaint_",value:function(t){f()(F()(i.prototype),"doPaint_",this).call(this,t);var e=nt.CreateByRect(this.FAreaRect);this.FActiveArea!==pn.None&&(t.brush.color=this.hcl.theme.backgroundSelectColor,t.fillRect(e)),f()(F()(i.prototype),"doPaint_",this).call(this,t),this.FActiveArea===pn.Year&&""!==this.FNewYear&&(t.brush.color=this.hcl.theme.backgroundSelectColor,t.fillRect(e),t.textRect(e,e.left,e.top,this.FNewYear))}},{key:"setActiveArea",value:function(t){t!==this.FActiveArea&&(this.FActiveArea===pn.Year&&this.SetInputYear(),this.FJoinKey=!1,this.FActiveArea=t,this.FActiveArea!==pn.None&&(this.FAreaRect=this.GetAreaRect(this.FActiveArea)),this.update())}},{key:"doMouseDown_",value:function(t){if(this.enabled)if(this._buttonRect.pointInAt(t.x,t.y))this._buttonDown=!0,this._updateButtonRect(),this.focused||f()(F()(i.prototype),"doMouseDown_",this).call(this,t);else{this._buttonDown=!1;var e=this.GetAreaAt(t.x,t.y);this.setActiveArea(e),f()(F()(i.prototype),"doMouseDown_",this).call(this,t)}}},{key:"doMouseMove_",value:function(t){this.enabled&&(this._buttonRect.pointInAt(t.x,t.y)?this._buttonMouseIn||(this._buttonMouseIn=!0,this._updateButtonRect()):this._buttonMouseIn&&(this._buttonMouseIn=!1,this._updateButtonRect()),this._buttonDown||f()(F()(i.prototype),"doMouseMove_",this).call(this,t))}},{key:"doMouseUp_",value:function(t){this._buttonDown?(this._buttonDown=!1,this.update(),this._buttonRect.pointInAt(t.x,t.y)&&this.doButtonClick_()):f()(F()(i.prototype),"doMouseUp_",this).call(this,t)}},{key:"doMouseEnter_",value:function(){f()(F()(i.prototype),"doMouseEnter_",this).call(this),this.enabled&&this.update()}},{key:"doMouseLeave_",value:function(){f()(F()(i.prototype),"doMouseLeave_",this).call(this),this._buttonMouseIn=!1,this._buttonDown=!1,this.enabled&&this.update()}},{key:"nextInputArea_",value:function(){this.FActiveArea<pn.Millisecond&&(this.FActiveArea===pn.Year&&this.SetInputYear(),this.FJoinKey=!1,this.FActiveArea=this.FActiveArea<<1,this.FAreaRect=this.GetAreaRect(this.FActiveArea),this.update())}},{key:"doKeyDown_",value:function(t){if(this.enabled)switch(t.keyCode){case Ue:""!==this.FNewYear&&(this.FNewYear="",this.update());break;case Le:this.FActiveArea===pn.Year&&(this.SetInputYear(),this.update());break;case Je:this.FActiveArea>pn.None&&(this.FActiveArea===pn.Year&&this.SetInputYear(),this.FJoinKey=!1,this.FActiveArea=this.FActiveArea>>1,this.FAreaRect=this.GetAreaRect(this.FActiveArea),this.update());break;case Ye:this.nextInputArea_()}}},{key:"doKeyPress_",value:function(t){if(this.enabled){var e=String.fromCharCode(t.keyCode),i=0,n=!1,o=lt.CreateByDateTime(this.FDateTime);if(this.FActiveArea!==pn.None){if("0123456789".indexOf(e)>=0)switch(this.FActiveArea){case pn.Year:this.FNewYear.length>3&&(this.FNewYear=L.stringDelete(this.FNewYear,0,1)),this.FNewYear=this.FNewYear+e,4===this.FNewYear.length&&(n=!0);break;case pn.Month:if((i=o.month)>9){if("0"==e)return;o=lt.Create(o.year,parseInt(e),o.day,o.hour,o.minute,o.second),n="1"!==e}else if(1===i&&this.FJoinKey)"012".indexOf(e)>=0?(i=10*i+parseInt(e),n=(o=lt.Create(o.year,i,o.day,o.hour,o.minute,o.second)).month>9):(o=lt.Create(o.year,parseInt(e),o.day,o.hour,o.minute,o.second),n=!0);else{if("0"===e)return;n=(o=lt.Create(o.year,parseInt(e),o.day,o.hour,o.minute,o.second)).month>1}break;case pn.Day:if((i=o.day)>9){if(0===t.keyCode||"0"===e)return;o=lt.Create(o.year,o.month,parseInt(e),o.hour,o.minute,o.second),parseInt(e)>Math.trunc(lt.DaysInMonth(o.year,o.month)/10)&&(n=!0)}else if(this.FJoinKey)(i=10*i+parseInt(e))>lt.DaysInMonth(o.year,o.month)&&(i=parseInt(e)),o=lt.Create(o.year,o.month,i,o.hour,o.minute,o.second),n=!0;else{if(0===t.keyCode||"0"===e)return;o=lt.Create(o.year,o.month,parseInt(e),o.hour,o.minute,o.second)}break;case pn.Hour:if((i=o.hour)>9){if("0"===e)return;n=(o=lt.Create(o.year,o.month,o.day,parseInt(e),o.minute,o.second)).hour>2}else if(this.FJoinKey)(i=10*i+parseInt(e))>23&&(i=parseInt(e)),n=(o=lt.Create(o.year,o.month,o.day,i,o.minute,o.second)).hour>9;else{if("0"===e)return;n=(o=lt.Create(o.year,o.month,o.day,parseInt(e),o.minute,o.second)).hour>2}break;case pn.Minute:if((i=o.minute)>9){if("0"===e)return;o=lt.Create(o.year,o.month,o.day,o.hour,parseInt(e),o.second)}else if(this.FJoinKey)(i=10*i+parseInt(e))>59&&(i=parseInt(e)),o=lt.Create(o.year,o.month,o.day,o.hour,i,o.second);else{if("0"===e)return;o=lt.Create(o.year,o.month,o.day,o.hour,parseInt(e),o.second)}break;case pn.Second:if((i=o.second)>9){if("0"===e)return;o=lt.Create(o.year,o.month,o.day,o.hour,o.minute,parseInt(e))}else if(this.FJoinKey)(i=10*i+parseInt(e))>59&&(i=parseInt(e)),o=lt.Create(o.year,o.month,o.day,o.hour,o.minute,i);else{if("0"===e)return;o=lt.Create(o.year,o.month,o.day,o.hour,o.minute,parseInt(e))}}this.FActiveArea!==pn.Year&&(this.FActiveArea=this.GetAreaAt(this.FAreaRect.left,this.FAreaRect.top),this.FActiveArea!==pn.None&&(this.FAreaRect=this.GetAreaRect(this.FActiveArea)),this.FJoinKey=!0,this.SetDateTime(o)),n?this.nextInputArea_():this.update()}}}},{key:"doResize_",value:function(){f()(F()(i.prototype),"doResize_",this).call(this),this.calcButtonRect_()}},{key:"setText_",value:function(t){var e=new lt;e.fromString(t)&&(this.FDateTime=e,f()(F()(i.prototype),"setText_",this).call(this,t))}},{key:"doButtonClick_",value:function(){this.readOnly||this._popup()}},{key:"doKillFocus_",value:function(){this.text=this.FDateTime.format(this.FFormat),this.setActiveArea(pn.None),f()(F()(i.prototype),"doKillFocus_",this).call(this)}},{key:"format",get:function(){return this.FFormat},set:function(t){t!=this.FFormat&&(this.FFormat=t,this.text=this.FDateTime.format(this.FFormat))}},{key:"dateTime",get:function(){return this.FDateTime},set:function(t){t&&(this.FDateTime=t,this.text=this.FDateTime.format(this.FFormat))}}]),i}(zi),Fn=function(t){m()(i,t);var e=Gi(i);function i(t){var n;r()(this,i),(n=e.call(this,t)).static_=!0;var o,s=Mi(xt);try{for(s.s();!(o=s.n()).done;){var a=o.value;(t.hasFont(a.c)||a.e!==a.c&&t.hasFont(a.e))&&n.addItem(a.n)}}catch(t){s.e(t)}finally{s.f()}return n.itemIndex=0,n}return l()(i,[{key:"getHint_",value:function(){return this.text}}]),i}(mn),vn=function(t){m()(i,t);var e=Gi(i);function i(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return r()(this,i),(n=e.call(this,t))._colorBand=50,n.width_=o,n.height_=o+n._colorBand,n._color=Ft.White,n._iniHotColor(),n._imageData=t.getColorPad(L.Round(o/2)),n}return l()(i,[{key:"_iniHotColor",value:function(){var t=this.hcl.colorToRGBA(this._color);this._R=t.r,this._G=t.g,this._B=t.b,this._A=t.a}},{key:"_setColor",value:function(t){this._color!=t&&(this._color=t,this._iniHotColor(),this.update())}},{key:"doPaintBackground_",value:function(t){t.brush.color=this.hotColor,t.fillRect(this.clientRect()),t.drawImageData(this._imageData,0,0,this.width,this.height)}},{key:"doPaint_",value:function(t){f()(F()(i.prototype),"doPaint_",this).call(this,t)}},{key:"doMouseLeave_",value:function(){f()(F()(i.prototype),"doMouseLeave_",this).call(this),this._iniHotColor(),this.update()}},{key:"doMouseMove_",value:function(t){if(f()(F()(i.prototype),"doMouseMove_",this).call(this,t),this.hcl.pointInEllipseBounds(0,0,this.width_,this.width_,t.x,t.y)){var e=4*(this.width_*t.y+t.x);this._R=this._imageData.data[e],this._G=this._imageData.data[e+1],this._B=this._imageData.data[e+2],this._A=this._imageData.data[e+3]}else this._iniHotColor();this.update()}},{key:"doClick_",value:function(){this._color=this.hotColor,f()(F()(i.prototype),"doClick_",this).call(this)}},{key:"hotColor",get:function(){return this.hcl.rgbaToColor(this._R,this._G,this._B,this._A)}},{key:"color",get:function(){return this._color},set:function(t){this._setColor(t)}}]),i}(Bi),In=function(t){m()(i,t);var e=Gi(i);function i(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"rgb(0, 0, 0)",s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r()(this,i),(n=e.call(this,t,o)).width_=36,n.height_=20,n.canFocus=!1,n.dropDownCount_=16,n.imeMode=Oi,n.dropDownWidth=64,n.addItem(Ft.Black),n.addItem(Ft.Red),n.addItem(Ft.Green),n.addItem(Ft.Blue),n.addItem(Ft.Yellow),n.addItem(Ft.Gray),n.addItem(Ft.Orange),s&&n.addItem(Ft.Transparent),n.addItem("更多..."),n.addItem("自定义"),n._listBox.doPaintBackground_=function(t){n._listBoxPaintBackground(t)},n._listBox.doPaintText_=function(t,e,i){n._listBoxPaintText(t,e,i)},setTimeout((function(){n._pad=new vn(t),n._pad.align=$t,n._pad.paddingLeft=0,n._pad.paddingTop=0,n._pad.paddingRight=0,n._pad.paddingBottom=0,n._pad.onClick=function(){n._padClick()}}),0),n._popupPadControl=null,n}return l()(i,[{key:"_listBoxPaintBackground",value:function(t){var e=this._listBox.clientRect();t.brush.color=this.hcl.theme.backgroundContentColor,t.fillRect(e),this._listBox.borderVisible_&&this._listBox._doPaintBorder(t,e)}},{key:"_listBoxPaintText",value:function(t,e,i){if(!(this._listBox._displayLast<0)){var n=new nt,o=this._listBox._getItemRect(this._listBox._displayFirst);o.inFlate(-1,0);for(var s=this._listBox._displayFirst;s<=this._listBox._displayLast;s++)s===this._listBox.items.count-1||s===this._listBox.items.count-2?(t.brush.color=Ft.White,n.resetRect(o),t.textOut(o.left+this._listBox.paddingLeft+this.hcl.theme.marginSpace,o.top+this.hcl.theme.marginSpace,this._listBox._items[s].text)):(t.brush.color=this._listBox._items[s].text,n.resetRect(o),n.inFlate(-1,0),t.brush.color!==Ft.Transparent?t.fillRect(n):this.hcl.theme.drawTransparent(t,n)),this._listBox._itemIndex==s&&(t.pen.color=this.hcl.theme.borderActiveColor,t.rectangleRect(o)),this._listBox._hotIndex==s&&(t.pen.color=this.hcl.theme.borderHotColor,t.rectangleRect(o)),o.offset(0,this._listBox.font.height+this.hcl.theme.marginSpaceDouble)}}},{key:"_padClick",value:function(){this._popupPadControl.donePopup(),this._listBox.text=this._pad.color,f()(F()(i.prototype),"doSelectedIndexChange_",this).call(this)}},{key:"doDonePopup_",value:function(){this._listBox.itemIndex===this._listBox.items.count-1?this._popupCustom():this._listBox.itemIndex===this._listBox.items.count-2?this._popupPad():f()(F()(i.prototype),"doDonePopup_",this).call(this)}},{key:"_popupCustom",value:function(){var t=this;if(null!=this._popupPadControl&&this._popupPadControl.close(),null==this._popupCustomControl){this._popupCustomControl=new Ni(this.hcl),this._popupCustomControl.width=224,this._popupCustomControl.height=50;var e=this.hcl.colorToRGBA(this.color),n=new Ki(this.hcl,"R:");n.left=this.hcl.theme.marginSpace,n.top=this.hcl.theme.marginSpace;var o=new ln(this.hcl,e.r,0,255);o.left=n.right,o.top=n.top-2,o.width=35,this._popupCustomControl.addControl(n),this._popupCustomControl.addControl(o);var s=new Ki(this.hcl,"G:");s.left=o.right+this.hcl.theme.marginSpace,s.top=this.hcl.theme.marginSpace;var r=new ln(this.hcl,e.g,0,255);r.left=s.right,r.top=s.top-2,r.width=35,this._popupCustomControl.addControl(s),this._popupCustomControl.addControl(r);var a=new Ki(this.hcl,"B:");a.left=r.right+this.hcl.theme.marginSpace,a.top=this.hcl.theme.marginSpace;var l=new ln(this.hcl,e.b,0,255);l.left=a.right,l.top=a.top-2,l.width=35,this._popupCustomControl.addControl(a),this._popupCustomControl.addControl(l);var h=new Ki(this.hcl,"A:");h.left=l.right+this.hcl.theme.marginSpace,h.top=this.hcl.theme.marginSpace;var c=new ln(this.hcl,e.a,0,255);c.left=h.right,c.top=h.top-2,c.width=35,this._popupCustomControl.addControl(h),this._popupCustomControl.addControl(c);var u=new Ji(this.hcl,"确定");u.onClick=function(){t._listBox.text="rgba("+o.number+","+r.number+","+l.number+","+c.number+")",t._popupCustomControl.donePopup(),f()(F()(i.prototype),"doSelectedIndexChange_",t).call(t)},u.left=L.Round((this._popupCustomControl.width-u.width)/2),u.top=o.bottom+this.hcl.theme.marginSpace,this._popupCustomControl.addControl(u),this._popupCustomControl.onClose=function(){t._popupCustomControl=null},this._popupCustomControl.onDone=function(){},null!=this._popupControl&&this._popupCustomControl.popup(this._popupControl.right,this._popupControl.bottom-this._listBox._getItemRect(0).height,!1)}}},{key:"_popupPad",value:function(){var t=this;if(null!=this._popupCustomControl&&this._popupCustomControl.close(),null==this._popupPadControl)if(this._pad.color=this.text,this._popupPadControl=new Ni(this.hcl),this._popupPadControl.width=this._pad.width,this._popupPadControl.height=this._pad.height,this._pad.parent=this._popupPadControl,this._popupPadControl.onClose=function(){t._popupPadControl=null},this._popupPadControl.onDone=function(){},null!=this._popupControl)this._popupPadControl.popup(this._popupControl.right,this._popupControl.top,!1);else{var e=this.clientToScreen(et.Create(0,0));this.popupAlign_==Qt?e.x+=this.paddingLeft-(this.borderVisible_?this.borderWidth_:0):e.x+=this.width-this._popupControl.width,this._popupPadControl.popup(e.x,e.y+this.height,!0)}}},{key:"doSetFocus_",value:function(){}},{key:"showCaret_",value:function(){}},{key:"doPaintSelected_",value:function(t){}},{key:"doPaintBackground_",value:function(t){var e=this.clientRect();e.left=this.paddingLeft,t.brush.color=this.hcl.theme.backgroundContentColor,t.fillRect(e),this.borderVisible_&&(e.left-=this.borderWidth_,this.doPaintBorder_(t,e)),this._buttonMouseIn&&(this._buttonDown?t.brush.color=this.hcl.theme.backgroundDownColor:t.brush.color=this.hcl.theme.backgroundHotColor,t.fillRect(this._buttonRect)),this.image.loaded?t.drawImage(this._buttonRect.left,this._buttonRect.top,this.image):this.hcl.theme.drawDropDown(t,this._buttonRect),e=this.textArea(),t.brush.color=this.color,this.color!==Ft.Transparent?t.fillRect(e):this.hcl.theme.drawTransparent(t,e)}},{key:"doPaint_",value:function(t){}},{key:"doMouseMove_",value:function(t){f()(F()(i.prototype),"doMouseMove_",this).call(this,t),this.cursor=Se}},{key:"doMouseUp_",value:function(t){this._buttonDown?f()(F()(i.prototype),"doMouseUp_",this).call(this,t):this.doButtonClick_()}},{key:"color",get:function(){return this.text},set:function(t){this.text=t}}]),i}(mn),gn=function(t){m()(i,t);var e=Gi(i);function i(t){var n;return r()(this,i),(n=e.call(this,t,""))._autoPopupMenuItem=null,n}return l()(i,[{key:"doDone",value:function(){f()(F()(i.prototype),"doDone",this).call(this),null!=this._autoPopupMenuItem&&null!=this._autoPopupMenuItem._popupControl&&this._autoPopupMenuItem._popupControl.donePopup()}},{key:"popup",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.hcl.beginUpdate();try{f()(F()(i.prototype),"popup",this).call(this,t,e,n),n&&null!=this._autoPopupMenuItem&&this._autoPopupMenuItem.visible&&this._autoPopupMenuItem.enabled&&(this._autoPopupMenuItem.popup(0,0,!0),this._autoPopupMenuItem._popupControl.left=this._popupControl.left-this._autoPopupMenuItem._popupControl.width-this.hcl.theme.shadow,this._autoPopupMenuItem._popupControl.top=this._popupControl.top)}finally{this.hcl.endUpdate()}}},{key:"autoPopupMenuDone",value:function(){null!=this._popupControl&&this._popupControl.donePopup()}},{key:"autoPopupMenuItem",get:function(){return this._autoPopupMenuItem},set:function(t){var e=this;this._autoPopupMenuItem=t,null!==t&&(t.onDone=function(){e.autoPopupMenuDone()})}}]),i}(function(t){m()(i,t);var e=Gi(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n))._popupControl=null,o.subItems.onAdded=function(t){o.doSubItemAdded(t)},o.tag=null,o.autoClose=!1,o.groupIndex=0,o.dropDownStyle=!1,o.image=Wi.Create(t,16,16),o.image.onImageLoaded=function(t,e){o.doImageLoaded_(t,e)},o._onClick=null,o.control_=null,o.onPopup=null,o.onDone=null,o.onItemAdded=null,o.onGetParent=null,o}return l()(i,[{key:"doImageLoaded_",value:function(t,e){t&&(this.image.left=Math.trunc((this.hcl.theme.popupMenuImagePadding-this.image.width)/2),this.image.top=Math.trunc((this.height-this.image.height)/2))}},{key:"doSubItemAdded",value:function(t){null!==this.onItemAdded&&this.onItemAdded(t)}},{key:"_closePopupControl_",value:function(){null!==this.control_&&this.control_.killFocus(),null!==this._popupControl&&this._popupControl.close(),this.hasSubItem&&this.onPopupClose&&this.onPopupClose()}},{key:"doDone",value:function(){null!=this.onDone&&this.onDone()}},{key:"doItemCheckChange",value:function(t){if(t.groupIndex>0)for(var e=0;e<this.subItems.count;e++)(this.subItems[e].groupIndex=t.groupIndex)&&(this.subItems[e].checked=!1)}},{key:"paint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.enabled?t.font.color=this.hcl.theme.textColor:t.font.color=this.hcl.theme.textDisableColor,f()(F()(i.prototype),"paint",this).call(this,t,e),this.groupIndex>0&&this.checked&&(""===this.image.src&&t.textOut(this.left+this.hcl.theme.marginSpace,this.top+e+Math.trunc((this.height-t.font.height)/2),"●"),t.pen.width=2,t.pen.color=this.hcl.theme.backgroundSelectColor,t.drawVerticalLineDriect(this.left+this.hcl.theme.popupMenuImagePadding-t.pen.width,this.top+e,this.top+e+this.height)),""!=this.image.src&&this.image.paintTo(t,this.image.left,this.top+e+this.image.top),null!==this.control_){t.save();try{t.translate(this.control_.left,this.control_.top),t.clip(0,0,this.control_.width,this.control_.height),this.control_.paint(t)}finally{t.restore()}}}},{key:"visibleCount",value:function(){for(var t=0,e=0;e<this.subItems.count;e++)this.subItems[e].visible&&t++;return t}},{key:"addItem",value:function(t,e,n){var o=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=new i(this.hcl,t);return e&&(r.image.src=e),n&&(r.groupIndex=n),""!==s&&(r.id=s),r.onDone=function(){o.doDone()},r.onCheckChange=function(t){o.doItemCheckChange(t)},this.subItems.add(r),this.hasSubItem_=!0,r}},{key:"addControl",value:function(t){this.subItems.add(t)}},{key:"addSpliter",value:function(){return this.addItem("-")}},{key:"popup",value:function(t,e){var i=this,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==this._popupControl){n&&this.allVisibleEnable(!0,!0),null!==this.onPopup&&this.onPopup(t,e,n);for(var o=0,s=-1;o<this.subItems.count;)this.subItems[o].visible&&s>0&&(this.subItems[o].isSpliter&&(this.subItems[s].visible=!1),s=-1),this.subItems[o].isSpliter&&this.subItems[o].visible&&(0===o?this.subItems[0].visible=!1:s=o),o++;s>0&&(this.subItems[s].visible=!1),this.subItemVisibleCount()>0&&(this._popupControl=new Cn(this.hcl,this),this._popupControl.dropDownStyle=this.dropDownStyle,this._popupControl.autoClose=this.autoClose,this._popupControl.onClose=function(){i._popupControl=null},this._popupControl.onDone=function(){i.doDone()},this._popupControl.popup(t,e,n))}}},{key:"popupControl",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=t.clientToScreen(et.Create(0,0));this.popup(i.x,i.y+t.height,e)}},{key:"getParent",value:function(){return this.onGetParent?this.onGetParent():null}},{key:"control",get:function(){return this.control_},set:function(t){var e=this;this.control_=t,t.onGetParent=function(){return e.getParent()}}},{key:"onClick",get:function(){return this._onClick},set:function(t){this._onClick=t}}]),i}(function(t){m()(i,t);var e=Gi(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t)).hasSubItem_=!1,o.text=n,o.subItems=new ot,o.enabled=!0,o.visible=!0,o.left=0,o.top=0,o.shortCut=0,o.checked_=!1,o.autoHeight=!0,o.width=o.hcl.theme.popupMenuImagePadding+o.hcl.theme.marginSpaceDouble,o.height=o.hcl.theme.itemHeight,o.onCheckChange=null,o}return l()(i,[{key:"paint",value:function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isSpliter?(t.pen.width=1,t.pen.color=Ft.Gray,e=i+this.top+Math.trunc(this.height/2),t.drawLineDriect(this.left+this.hcl.theme.popupMenuImagePadding,e,this.left+this.width-this.hcl.theme.marginSpace,e)):(e=i+this.top+Math.trunc((this.height-t.font.height)/2),null!=this.onPaintText?this.onPaintText(t,this.left+this.hcl.theme.popupMenuImagePadding+this.hcl.theme.marginSpace,e,this.text):t.textOut(this.left+this.hcl.theme.popupMenuImagePadding+this.hcl.theme.marginSpace,e,this.text),this.hasSubItem_&&this.hcl.theme.drawDropRight(t,nt.CreateByBounds(this.left+this.width-this.hcl.theme.iconSize,this.top+i,this.hcl.theme.iconSize,this.height)))}},{key:"bounds",value:function(){return nt.CreateByBounds(this.left,this.top,this.width,this.height)}},{key:"subItemByText",value:function(t){for(var e=0,i=this.subItems.count;e<i;e++)if(this.subItems[e].text==t)return this.subItems[e];return null}},{key:"subItemByID",value:function(t){for(var e=0,i=this.subItems.count;e<i;e++)if(this.subItems[e].id===t)return this.subItems[e];return null}},{key:"subItemVisibleCount",value:function(){for(var t=0,e=0;e<this.subItems.count;e++)this.subItems[e].visible&&t++;return t}},{key:"doCheckChange",value:function(){null!=this.onCheckChange&&this.onCheckChange(this)}},{key:"allVisibleEnable",value:function(t,e){for(var i=0,n=this.subItems.count;i<n;i++)this.subItems[i].visible=t,this.subItems[i].enabled=e,this.subItems[i].allVisibleEnable(t,e)}},{key:"isSpliter",get:function(){return"-"==this.text}},{key:"hasSubItem",get:function(){return this.hasSubItem_},set:function(t){this.hasSubItem_=t}},{key:"checked",get:function(){return this.checked_},set:function(t){this.checked_!==t&&(t&&this.doCheckChange(),this.checked_=t)}}]),i}(tt))),Cn=function(t){m()(i,t);var e=Gi(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t)).font=new Nt(t),o._mouseMoveIndex=-1,o._focusControl=null,o._offset=0,o._scrollRange=0,o._contentHeight=0,o.menuItem=n,o.adjustPosition=!0,o.autoClose=!1,o._calcPopupControl(),o}return l()(i,[{key:"setFocusControl_",value:function(t,e){t!==this._focusControl&&e&&(null!=this._focusControl&&this._focusControl.killFocus(),this._focusControl=t)}},{key:"killFocusControl_",value:function(t){this._focusControl=null,this.hcl.application.killFocusControl_(t)}},{key:"_calcPopupControl",value:function(){var t=this,e=0,i=100,n=0,o=null;this._offset=0,this._scrollRange=0,this._contentHeight=0;for(var s=0,r=this.menuItem.subItems.count;s<r;s++)(o=this.menuItem.subItems[s]).visible&&(o.left=0,o.top=e,o.isSpliter?(o.width=this.hcl.theme.marginSpaceDouble,o.height=this.hcl.theme.marginSpace):o.autoHeight&&(o.height=this.font.height+this.hcl.theme.marginSpaceDouble,n=null!=o.onGetTextWidth?o.onGetTextWidth(this.font,o):this.hcl.textWidth(this.font,o.text),null!==o.control&&(o.control.left=this.hcl.theme.popupMenuImagePadding+this.hcl.theme.marginSpace+n,n+=o.control.width,o.height=Math.max(o.height,o.control.height),o.control.top=o.top+Math.round((o.height-o.control.height)/2),o.onGetParent=function(){return t}),o.width=this.hcl.theme.popupMenuImagePadding+this.hcl.theme.marginSpace+n+this.hcl.theme.iconSize),i<o.width&&(i=o.width),e=o.top+o.height,this._contentHeight+=o.height);for(var a=0,l=this.menuItem.subItems.count;a<l;a++)(o=this.menuItem.subItems[a]).visible&&(o.width=i,null!==o.control&&o.control.align===Zt&&(o.control.left=i-this.hcl.theme.iconSize-o.control.width));this.width=i,this._scrollRange=this._contentHeight-(this.hcl.height-this.hcl.theme.shadow-this.hcl.theme.shadow),this._scrollRange>0?this.height=this.hcl.height-this.hcl.theme.shadow-this.hcl.theme.shadow:(this._scrollRange=0,this.height=this._contentHeight)}},{key:"_getItemIndexAt",value:function(t,e){for(var i=0;i<this.menuItem.subItems.count;i++)if(!this.menuItem.subItems[i].isSpliter&&this.menuItem.subItems[i].visible&&this.menuItem.subItems[i].bounds().offset(0,-this._offset).pointInAt(t,e))return i;return-1}},{key:"_getItemAt",value:function(t,e){var i=this._getItemIndexAt(t,e);return i>=0?this.items[i]:null}},{key:"getHint_",value:function(){if(this._mouseMoveIndex>=0){var t=this.menuItem.subItems[this._mouseMoveIndex].hint;return this.hcl.system.assigned(t)&&""!==t?t:f()(F()(i.prototype),"getHint_",this).call(this)}return f()(F()(i.prototype),"getHint_",this).call(this)}},{key:"closePopup",value:function(){f()(F()(i.prototype),"closePopup",this).call(this),null!=this._focusControl&&this._focusControl.killFocus()}},{key:"doMouseEnter_",value:function(){f()(F()(i.prototype),"doMouseEnter_",this).call(this),this.update()}},{key:"doMouseLeave_",value:function(){f()(F()(i.prototype),"doMouseLeave_",this).call(this),this.autoClose?this.close():this.update()}},{key:"doMouseDown_",value:function(t){if(f()(F()(i.prototype),"doMouseDown_",this).call(this,t),this._mouseMoveIndex>=0){var e=this.menuItem.subItems[this._mouseMoveIndex];if(e.enabled&&null!==e.control)if(nt.CreateByBounds(e.control.left,e.control.top,e.control.width,e.control.height).pointInAt(t.x,t.y)){var n=new fi;n.assign(t),n.x=t.x-e.control.left,n.y=t.y-e.control.top,e.control.mouseDown(n)}}}},{key:"doMouseMove_",value:function(t){f()(F()(i.prototype),"doMouseMove_",this).call(this,t);var e=this._getItemIndexAt(t.x,t.y);if(this._mouseMoveIndex!==e){if(this._mouseMoveIndex>=0&&this.menuItem.subItems[this._mouseMoveIndex]._closePopupControl_(),this._mouseMoveIndex=e,this._mouseMoveIndex>=0){var n=this.menuItem.subItems[this._mouseMoveIndex];n.visible&&n.enabled&&n.popup(this.left+this.width,this.top+n.top-this._offset,!1)}this.update()}if(this._mouseMoveIndex>=0&&null!==this.menuItem.subItems[this._mouseMoveIndex].control){var o=this.menuItem.subItems[this._mouseMoveIndex];if(nt.CreateByBounds(o.control.left,o.control.top,o.control.width,o.control.height).pointInAt(t.x,t.y)){var s=new fi;s.assign(t),s.x=t.x-o.control.left,s.y=t.y-o.control.top,o.control.mouseMove(s)}}}},{key:"doMouseUp_",value:function(t){if(f()(F()(i.prototype),"doMouseUp_",this).call(this,t),this._mouseMoveIndex>=0&&t.button===ae){var e=this.menuItem.subItems[this._mouseMoveIndex];if(e.enabled){if(null!==e.control)if(nt.CreateByBounds(e.control.left,e.control.top,e.control.width,e.control.height).pointInAt(t.x,t.y)){var n=new fi;return n.assign(t),n.x=t.x-e.control.left,n.y=t.y-e.control.top,void(2===t.clicks?e.control.dblClick(t):e.control.mouseUp(n))}null!=e.onClick&&e.onClick(e),e.hasSubItem||this.donePopup()}}}},{key:"doMouseWheel_",value:function(t){if(f()(F()(i.prototype),"doMouseWheel_",this).call(this,t),this._scrollRange>0){var e=this._offset+(t.delta<0?23:-23);e>this._scrollRange?e=this._scrollRange:e<0&&(e=0),e!==this._offset&&(this._offset=e,this.doMouseMove_(t),this.update())}}},{key:"doPaintBackground_",value:function(t){if(f()(F()(i.prototype),"doPaintBackground_",this).call(this,t),this._mouseMoveIndex>=0){var e=this.menuItem.subItems[this._mouseMoveIndex];!e.isSpliter&&e.visible&&(e.enabled?t.brush.color=this.hcl.theme.backgroundSelectColor:t.brush.color=this.hcl.theme.backgroundHotColor,t.clip(0,0,this.width,this.height),t.fillRect(e.bounds().offset(0,-this._offset)))}t.pen.width=1,t.pen.color=Ft.Gray,t.drawLineDriect(this.hcl.theme.popupMenuImagePadding,0,this.hcl.theme.popupMenuImagePadding,this.height),this._scrollRange>0&&this.mouseStates.has(ie)&&(t.brush.color=this.hcl.theme.backgroundDownColor,t.fillBounds(this.width-this.hcl.theme.marginSpace,this._offset,this.hcl.theme.marginSpace,this.height/this._contentHeight*this.height))}},{key:"doPaint_",value:function(t){f()(F()(i.prototype),"doPaint_",this).call(this,t),t.clip(0,0,this.width,this.height),t.font.assign(this.font);for(var e=0,n=this.menuItem.subItems.count;e<n;e++)this.menuItem.subItems[e].visible&&(this.menuItem.subItems[e].top-this._offset+this.menuItem.subItems[e].height<0||this.menuItem.subItems[e].top-this._offset>this.height||this.menuItem.subItems[e].paint(t,-this._offset))}},{key:"getHintRect",value:function(){if(this._mouseMoveIndex>=0){var t=this.menuItem.subItems[this._mouseMoveIndex].hint;return this.hcl.system.assigned(t)&&""!==t?this.menuItem.subItems[this._mouseMoveIndex].bounds().offset(0,-this._offset):f()(F()(i.prototype),"getHintRect",this).call(this)}return f()(F()(i.prototype),"getHintRect",this).call(this)}}]),i}(Si),wn=function(t){m()(i,t);var e=Gi(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).state_.add(Ri.Creating),n.contentHeight_=0,n.contentWidth_=0,n.HScroll_=new Di(t),n.HScroll_.orientation=te,n.HScroll_.align=qt,n.HScroll_.onScroll=function(){n.viewScroll_()},n.VScroll_=new Di(t),n.VScroll_.orientation=ee,n.VScroll_.onScroll=function(){n.viewScroll_()},n.addControl(n.VScroll_),n.addControl(n.HScroll_),n.state_.delete(Ri.Creating),n}return l()(i,[{key:"viewScroll_",value:function(){this.update()}},{key:"doResize_",value:function(){f()(F()(i.prototype),"doResize_",this).call(this),this.doContentResize_()}},{key:"doAlign_",value:function(){f()(F()(i.prototype),"doAlign_",this).call(this),this.VScroll_.visible?this.HScroll_.width=this.width-this.VScroll_.width:this.HScroll_.width=this.width,this.HScroll_.visible?this.VScroll_.height=this.height-this.HScroll_.height:this.VScroll_.height=this.height}},{key:"calcContentSize_",value:function(){this.contentHeight_=0,this.contentWidth_=0}},{key:"doContentResize_",value:function(){this.calcContentSize_();var t=this.contentHeight_,e=this.contentWidth_,i=t>this.height,n=e>this.width;i?n||(n=e>this.width-this.VScroll_.width):n&&(i=t>this.height-this.HScroll_.height),this.VScroll_.visible=i,this.VScroll_.max=t,i||(this.VScroll_.position=0),this.VScroll_.height=n?this.height-this.HScroll_.height:this.height,this.HScroll_.visible=n,this.HScroll_.max=e,n||(this.HScroll_.position=0),this.HScroll_.width=i?this.width-this.VScroll_.width:this.width}},{key:"doMouseWheel_",value:function(t){this.hcl.keyDownStates[Ge]?this.HScroll_.position-=t.delta:this.VScroll_.position-=t.delta}}]),i}(qi),An=function(t){m()(i,t);var e=Gi(i);function i(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"page";return r()(this,i),(n=e.call(this,t))._headerRect_=new nt,n._visible=!0,n.text_=o,n.onUpdateText=null,n}return l()(i,[{key:"doPaintBackground_",value:function(t){}},{key:"updateText",value:function(){null!=this.onUpdateText&&this.onUpdateText(this)}},{key:"text",get:function(){return this.text_},set:function(t){this.text_!=t&&(this.text_=t,this.updateText())}}]),i}(Bi),Dn=function(t){m()(i,t);var e=Gi(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).width=200,n.height=200,n._showCloseButton=!1,n._headerHeight=20,n._headerOffset=0,n._headerVisible=!0,n._activePageIndex=-1,n._hotHeaderIndex=-1,n._hotBtnPageIndex=-1,n.paddingTop=n._headerHeight,n}return l()(i,[{key:"doPageUpdateHeaderText",value:function(t){t.visible&&(this._formatHeader(t),this.updateRect(nt.CreateByBounds(0,0,this.width,this._headerHeight)))}},{key:"_formatHeader",value:function(t){var e=this.hcl.textWidth(this.hcl.defaultFont,t.text);this._showCloseButton&&(e+=this.hcl.theme.iconWidth),t._headerRect_.resetBounds(0,0,e+this.hcl.theme.marginSpaceDouble,this._headerHeight);for(var i,n=0,o=0;o<this.controls.count;o++)(i=this.controls[o])._headerRect_.resetBounds(n,0,i._headerRect_.width,i._headerRect_.height),n+=i._headerRect_.width}},{key:"_formatAllHeader",value:function(){for(var t=0;t<this.controls.count;t++)this._formatHeader(this.controls[t])}},{key:"doAddControl_",value:function(t){var e=this;t.isClass(An)?(t.align=$t,t.onUpdate=function(i){e.doPageUpdateRect(t,i)},t.onUpdateText=function(t){e.doPageUpdateHeaderText(t)},this._formatHeader(t),this.pageIndex=this.controls.count-1,f()(F()(i.prototype),"doAddControl_",this).call(this,t)):this.hcl.exception("只能添加TPage及其子类")}},{key:"doRemoveControl_",value:function(t){this._formatAllHeader(),0==this.controls.count?this._activePageIndex=-1:this._activePageIndex>this.controls.count-1&&(this.pageIndex=this.controls.count-1),f()(F()(i.prototype),"doRemoveControl_",this).call(this,t)}},{key:"doPaintBorder_",value:function(t){this._headerVisible?this.borderVisible_&&(this.controls.count>0?(t.pen.color=this.hcl.theme.borderColor,t.pen.width=this.hcl.theme.borderWidth,t.beginPath(),t.moveTo(0,this._headerHeight),t.lineTo(0,this.height-1),t.lineTo(this.width,this.height-1),t.lineTo(this.width,this._headerHeight),t.paintPath()):f()(F()(i.prototype),"doPaintBorder_",this).call(this,t)):f()(F()(i.prototype),"doPaintBorder_",this).call(this,t)}},{key:"doPaintPageHeader",value:function(t){var e;t.font.assign(this.hcl.defaultFont);for(var i=0;i<this.controls.count;i++)e=this.controls[i],t.textOut(e._headerRect_.left+this.hcl.theme.marginSpace,e._headerRect_.top+this.hcl.theme.marginSpace,e.text),this._showCloseButton&&i===this._hotBtnPageIndex&&(t.brush.color=this.hcl.theme.backgroundHotColor,t.fillBounds(e._headerRect_.right-this.hcl.theme.iconWidth,e._headerRect_.top,this.hcl.theme.iconWidth,this.hcl.theme.iconWidth)),i===this._activePageIndex?(t.pen.color=this.hcl.theme.borderColor,t.pen.width=this.hcl.theme.borderWidth,t.beginPath(),t.moveTo(0,this._headerHeight),t.lineTo(e._headerRect_.left+1,this._headerHeight),t.lineTo(e._headerRect_.left+1,0),t.lineTo(e._headerRect_.right,0),t.lineTo(e._headerRect_.right,this._headerHeight),t.lineTo(this.width,this._headerHeight),t.paintPath()):(t.pen.color=this.hcl.theme.borderColor,t.pen.width=this.hcl.theme.borderWidth,t.beginPath(),t.moveTo(e._headerRect_.right,2),t.lineTo(e._headerRect_.right,this._headerHeight-2),t.paintPath()),!this._showCloseButton||i!==this._activePageIndex&&i!==this._hotHeaderIndex||t.drawImage(e._headerRect_.right-this.hcl.theme.iconWidth,e._headerRect_.top+2,this.hcl.theme.closeImage)}},{key:"doPaintBackground_",value:function(t){f()(F()(i.prototype),"doPaintBackground_",this).call(this,t)}},{key:"doPaint_",value:function(t){if(this._activePageIndex>=0){var e=this.controls[this._activePageIndex];t.save();try{t.translate(e.left,e.top),t.clip(0,0,e.width,e.height),e.paint(t)}finally{t.restore()}}this.borderVisible&&this.doPaintBorder_(t),this._headerVisible&&this.doPaintPageHeader(t)}},{key:"_pageHeaderIndexAt",value:function(t,e){if(this._headerVisible)for(var i=new nt,n=0;n<this.controls.count;n++)if(i.resetRect(this.controls[n]._headerRect_),i.offset(-this._headerOffset,0),i.pointInAt(t,e))return n;return-1}},{key:"getControlAt",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._headerVisible&&e<this._headerHeight)return null;if(this._activePageIndex>=0){var o=this.controls[this._activePageIndex];if(n&&o.enabled)return o}return f()(F()(i.prototype),"getControlAt",this).call(this,t,e,n)}},{key:"doMouseDown_",value:function(t){if(this._headerVisible&&t.y<this._headerHeight){var e=this._pageHeaderIndexAt(t.x,t.y);e>=0&&e!=this._activePageIndex&&(this.pageIndex=e)}else f()(F()(i.prototype),"doMouseDown_",this).call(this,t)}},{key:"doMouseMove_",value:function(t){if(this._headerVisible){var e=!1,n=-1,o=this._pageHeaderIndexAt(t.x,t.y);if(o!=this._hotHeaderIndex&&(this._hotHeaderIndex=o,e=!0),this._hotHeaderIndex>=0){var s=this.controls[this._hotHeaderIndex];t.x>s._headerRect_.right-this.hcl.theme.iconWidth&&s._headerRect_.pointInAt(t.x,t.y)&&(n=this._hotHeaderIndex)}this._hotBtnPageIndex!=n&&(this._hotBtnPageIndex=n,e=!0),e&&this.updateRect(nt.CreateByBounds(0,0,this.width,this._headerHeight))}f()(F()(i.prototype),"doMouseMove_",this).call(this,t)}},{key:"doMouseUp_",value:function(t){if(this._showCloseButton&&this._headerVisible&&t.y<this._headerHeight){var e=this.controls[this._activePageIndex];this._activePageIndex>=0&&t.x>e._headerRect_.right-this.hcl.theme.iconWidth&&t.x<e._headerRect_.right&&this.closePage(this._activePageIndex)}else f()(F()(i.prototype),"doMouseUp_",this).call(this,t)}},{key:"closePage",value:function(t){this.beginUpdate();try{this.controls.removeAt(t)}finally{this.endUpdate()}}},{key:"addPage",value:function(t){var e=new An(this.hcl,t);return this.addControl(e),e}},{key:"pageIndex",get:function(){return this._activePageIndex},set:function(t){t>=0&&t<this.controls.count&&t!=this._activePageIndex&&(this._activePageIndex>=0&&this._activePageIndex<this.controls.count&&this.controls[this._activePageIndex].deactivate(),this._activePageIndex=t,this.update())}},{key:"activePage",get:function(){return this._activePageIndex>=0?this.controls[this._activePageIndex]:null}},{key:"headerVisible",get:function(){return this._headerVisible},set:function(t){this._headerVisible!=t&&(this._headerVisible=t,this.paddingTop=t?this._headerHeight:0)}},{key:"pageCount",get:function(){return this.controls.count}},{key:"pages",get:function(){return this.controls}},{key:"showCloseButton",get:function(){return this._showCloseButton},set:function(t){this._showCloseButton!=t&&(this._showCloseButton=t,this._formatAllHeader(),this.updateRect(nt.CreateByBounds(0,0,this.width,this._headerHeight)))}}]),i}(qi),Pn=function(t){m()(i,t);var e=Gi(i);function i(t){var n;return r()(this,i),(n=e.call(this)).obj=null,n.onAdded=function(t){t.onUpdate=function(){null!=n.onUpdate&&n.onUpdate()}},n.initCol(t),n}return l()(i,[{key:"createNewCell",value:function(){return new kn}},{key:"initCol",value:function(t){var e;this.clear();for(var i=0;i<t;i++)e=this.createNewCell(),this.add(e)}}]),i}(ot),kn=function(){function t(){r()(this,t),this._value="",this.obj=null,this.onUpdate=null}return l()(t,[{key:"setValue",value:function(t){this._value!=t&&(this._value=t,null!=this.onUpdate&&this.onUpdate())}},{key:"paintTo",value:function(t,e){t.textRect(e,e.left+2,e.top+4,this._value)}},{key:"value",get:function(){return this._value},set:function(t){this.setValue(t)}}]),t}(),xn=l()((function t(){r()(this,t),this.rowSelect=!0})),Rn=function(t){m()(i,t);var e=Gi(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,n,o)).readOnly=!1,s.FEditRow=-1,s.FEditCol=-1,s.FInnerEdit_=null,s.FInnerControl=null,s}return l()(i,[{key:"getCellEditControl",value:function(t,e){var i=this;return null==this.FInnerEdit_&&(this.FInnerEdit_=new on(this.hcl),this.FInnerEdit_.visible_=!1,this.FInnerEdit_._marginLeft=0,this.FInnerEdit_._marginTop=0,this.FInnerEdit_._marginRight=0,this.FInnerEdit_._marginBottom=0,this.FInnerEdit_._paddingLeft=2,this.FInnerEdit_._paddingTop=0,this.FInnerEdit_._paddingRight=2,this.FInnerEdit_._paddingBottom=0,this.FInnerEdit_.onKeyDown=function(t){t.keyCode===Le?i.doSetInnerEdit_():t.keyCode===Ue&&i.doSetInnerEdit_(!1)},this.FInnerEdit_.onKillFocus=function(){i.doSetInnerEdit_()},this.addControl(this.FInnerEdit_)),this.FInnerEdit_}},{key:"doSetInnerEdit_",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.FEditRow>=0&&this.FEditRow<this.rowCount&&(t?this.rows[this.FEditRow][this.FEditCol].value=this.FInnerControl.text:this.FInnerControl.text=this.rows[this.FEditRow][this.FEditCol].value),this.FInnerControl.visible=!1}},{key:"doMouseDown_",value:function(t){if(this.FInnerControl&&this.FInnerControl.visible_&&this.FInnerControl.bounds().pointInAt(t.x,t.y))f()(F()(i.prototype),"doMouseDown_",this).call(this,t);else{var e=this.row_,n=this.col_;if(f()(F()(i.prototype),"doMouseDown_",this).call(this,t),!this.readOnly&&this.row_>this.fixRowCount_-1&&this.col_>=0&&e==this.row_&&n==this.col_){this.FInnerControl=this.getCellEditControl(this.row_,this.col_),this.FInnerControl.text=this.rows[this.row_][this.col_].value;var o=this.getCellRect(this.row_,this.col_);o.left-=this.hcl.theme.borderWidth,o.top-=this.hcl.theme.borderWidth,this.FInnerControl.left=o.left,this.FInnerControl.top=o.top,this.FInnerControl.width=o.width,this.FInnerControl.height=o.height,this.FInnerControl.visible=!0,this.FEditRow=e,this.FEditCol=n;var s=new fi;s.assign(t),s.x-=this.FInnerControl.left,s.y-=this.FInnerControl.top,this.FInnerControl.mouseDown(s)}}}},{key:"doMouseUp_",value:function(t){if(f()(F()(i.prototype),"doMouseUp_",this).call(this,t),!this.readOnly&&this.FInnerControl&&this.FInnerControl.visible_){var e=new fi;e.assign(t),e.x-=this.FInnerControl.left,e.y-=this.FInnerControl.top,this.FInnerControl.mouseUp(e)}}}]),i}(function(t){m()(i,t);var e=Gi(i);function i(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return r()(this,i),(n=e.call(this,t)).state_.add(Ri.Creating),n.canFocus=!0,n.defaultRowHeight=22,n.defaultColWidth=30,n._colWidths=new Array,n.row_=-1,n.col_=-1,n.width_=200,n.height_=200,n.leftOffset_=0,n.topOffset_=0,n.fixRowCount_=0,n.FRowDispRange=null,n.FColDispRange=null,n.option=new xn,n.rows=new ot,n.rows.onAdded=function(t){t.onUpdate=function(){n.update()},n.doContentResize_()},n.rows.onRemoved=function(t){n.doContentResize_()},n.initRowCol(o,s),n.state_.delete(Ri.Creating),n.onRowChanged=null,n.onColChanged=null,n}return l()(i,[{key:"_calcDisplayRow",value:function(){for(var t=0,e=this.rows.count-1,i=0,n=0;n<e;n++)if((i+=this.getRowHeight_(n))>this.VScroll_.position){t=n,i-=this.getRowHeight_(n);break}for(var o=t;o<e;o++)if((i+=this.getRowHeight_(o))-this.VScroll_.position>this.height){e=o;break}return{first:t,last:e}}},{key:"_calcDisplayCol",value:function(){for(var t=0,e=this._colWidths.length-1,i=0,n=0;n<e;n++)if((i+=this._colWidths[n])>this.HScroll_.position){t=n,i-=this._colWidths[n];break}for(var o=t;o<e;o++)if((i+=this._colWidths[o])-this.HScroll_.position>this.width){e=o;break}return{first:t,last:e}}},{key:"_calcDisplayRowAndCol",value:function(){this.FRowDispRange=this._calcDisplayRow(),this.FColDispRange=this._calcDisplayCol(),this.topOffset_=0,this.leftOffset_=0;for(var t=0;t<this.FRowDispRange.first;t++)this.topOffset_+=this.getRowHeight_(t);this.topOffset_-=this.VScroll_.position;for(var e=0;e<this.FColDispRange.first;e++)this.leftOffset_+=this._colWidths[e];this.leftOffset_-=this.HScroll_.position}},{key:"viewScroll_",value:function(){this._calcDisplayRowAndCol(),f()(F()(i.prototype),"viewScroll_",this).call(this)}},{key:"calcContentSize_",value:function(){this.col_>this._colWidths.length-1&&(this.col=-1),this.row_>this.rows.count-1&&(this.row=-1),this.contentHeight_=0;for(var t=0;t<this.rows.count;t++)this.contentHeight_+=this.getRowHeight_(t);this.contentWidth_=0;for(var e=0;e<this._colWidths.length;e++)this.contentWidth_+=this._colWidths[e]}},{key:"doContentResize_",value:function(){this.updateCount_>0||(f()(F()(i.prototype),"doContentResize_",this).call(this),this._calcDisplayRowAndCol(),this.update())}},{key:"scrollToRow",value:function(t){for(var e=0,i=0;i<t;i++)e+=this.getRowHeight_(i);if(this.fixRowCount_>0)for(var n=0;n<this.fixRowCount_;n++)e-=this.getRowHeight_(n);this.VScroll_.position=e}},{key:"endUpdate",value:function(){f()(F()(i.prototype),"doContentResize_",this).call(this),this._calcDisplayRowAndCol(),f()(F()(i.prototype),"endUpdate",this).call(this)}},{key:"getRowHeight_",value:function(t){return this.defaultRowHeight}},{key:"getCellWidth_",value:function(t,e){return this._colWidths[e]}},{key:"doKeyDown_",value:function(t){f()(F()(i.prototype),"doKeyDown_",this).call(this,t),t.keyCode===Qe?this.row_<this.rows.count-1?this.fixRowCount_>0&&this.row_<this.fixRowCount_?this.row=this.fixRowCount_:this.row=this.row_+1:this.rows.count>0&&(this.fixRowCount_>0&&this.rows.count>this.fixRowCount_?this.row=this.fixRowCount_:this.row=0):t.keyCode===je&&this.rows.count>0&&(this.row_>0?this.fixRowCount_>0?this.row_>this.fixRowCount_?this.row=this.row_-1:this.row=this.rows.count-1:this.row_>0&&(this.row=this.row_-1):this.row=this.rows.count-1)}},{key:"doMouseDown_",value:function(t){if(f()(F()(i.prototype),"doMouseDown_",this).call(this,t),null==this.getControlAt(t.x,t.y,!0)){var e=this.getCellAt(t.x,t.y);this.row_==e.row&&this.col_==e.col||(this.row=e.row,this.col=e.col,this.update())}}},{key:"doRowPaint_",value:function(t,e,i){return null!=this.onRowPaint&&this.onRowPaint(t,e,i)}},{key:"doCellPaint_",value:function(t,e,i,n){if(null==this.onCellPaint)return!1;t.save();try{return this.onCellPaint(t,e,i,n)}finally{t.restore()}}},{key:"doPaint_",value:function(t){if(0!=this.rows.count){var e,n,o=0,s=0;t.font.assign(this.hcl.defaultFont),t.pen.width=this.hcl.theme.borderWidth,t.pen.color=this.hcl.theme.borderColor;var r=new nt;if(this.fixRowCount_){s=0,t.brush.color=this.hcl.theme.backgroundDownColor;for(var a=0;a<this.fixRowCount;a++){n=this.getRowHeight_(a),o=this.leftOffset_;for(var l=this.FColDispRange.first;l<=this.FColDispRange.last;l++)(e=this.getCellWidth_(a,l))>0&&(r.resetBounds(o,s,e,n),t.fillRect(r),this.doCellPaint_(t,r,a,l)||this.rows[a][l].paintTo(t,r),r.left-=this.hcl.theme.borderWidth,r.top-=this.hcl.theme.borderWidth,t.rectangleRect(r),o+=e);s+=n}}this.HScroll_.visible&&this.VScroll_.visible&&(t.brush.color=this.hcl.theme.backgroundStaticColor,t.fillBounds(this.VScroll_.left,this.HScroll_.top,this.VScroll_.width,this.HScroll_.height)),t.save();try{t.clip(this.borderVisible?this.hcl.theme.borderWidth:0,s,this.VScroll_.visible?this.width-this.VScroll_.width:this.width-this.hcl.theme.borderWidth,this.HScroll_.visible?this.height-s-this.HScroll_.height:this.height-s-this.hcl.theme.borderWidth),o=this.leftOffset_,s=this.topOffset_;for(var h=this.FRowDispRange.first;h<=this.FRowDispRange.last;h++){n=this.getRowHeight_(h),o=this.leftOffset_,r.resetBounds(0,s,this.width,n),this.doRowPaint_(t,r,h)||(t.brush.color=this.hcl.theme.backgroundContentColor,t.fillRect(r));for(var c=this.FColDispRange.first;c<=this.FColDispRange.last;c++)(e=this.getCellWidth_(h,c))>0&&(r.resetBounds(o,s,e,n),h==this.row_&&(this.option.rowSelect||c==this.col_)&&(t.brush.color=this.hcl.theme.backgroundSelectColor,t.fillRect(r)),this.doCellPaint_(t,r,h,c)||this.rows[h][c].paintTo(t,r),r.left-=this.hcl.theme.borderWidth,r.top-=this.hcl.theme.borderWidth,t.rectangleRect(r),o+=e);s+=n}}finally{t.restore()}f()(F()(i.prototype),"doPaint_",this).call(this,t)}}},{key:"doCreateNewRow_",value:function(t){return new Pn(t)}},{key:"initRowCol",value:function(t,e){var i;this.rows.clear();for(var n=0;n<t;n++)i=this.doCreateNewRow_(e),this.rows.add(i);this._colWidths=new Array(e);for(var o=0;o<e;o++)this._colWidths[o]=this.defaultColWidth;this.doContentResize_()}},{key:"setColWidth",value:function(t,e){this._colWidths[t]=e,this.doContentResize_()}},{key:"getColWidth",value:function(t){return this._colWidths[t]}},{key:"setRowCount",value:function(t){if(this.rows.count!=t)if(this.rows.count>t){this.beginUpdate();try{for(;this.rows.count>t;)this.rows.removeAt(this.rows.count-1)}finally{this.endUpdate()}}else{var e;this.beginUpdate();try{for(;this.rows.count<t;)e=this.doCreateNewRow_(this.colCount),this.rows.add(e)}finally{this.endUpdate()}}}},{key:"setColCount",value:function(t){if(this._colWidths.length!=t){if(this._colWidths.length>t)for(;this._colWidths.length>t;){for(var e=0;e<this.rows.count;e++)this.rows[e].removeAt(this._colWidths.length-1);this._colWidths.length-=1}else for(var i;this._colWidths.length<t;)for(var n=0;n<this.rows.count;n++)i=this.rows[n].createNewCell(),this.rows[n].add(i);this.doContentResize_()}}},{key:"fixRowHeight",value:function(){for(var t=0,e=0;e<this.fixRowCount_;e++)t+=this.getRowHeight_(e);return t}},{key:"getCellAt",value:function(t,e){var i,n,o,s=new nt,r=0;if(this.fixRowCount_>0)for(var a=0;a<this.fixRowCount_;a++){n=this.getRowHeight_(a),i=this.leftOffset_;for(var l=this.FColDispRange.first;l<=this.FColDispRange.last;l++){if(o=this.getCellWidth_(a,l),s.resetBounds(i,r,o,n),s.pointInAt(t,e))return{fixrow:a,fixcol:l,row:-1,col:-1};i+=o}r+=n}r=this.topOffset_;for(var h=this.FRowDispRange.first;h<=this.FRowDispRange.last;h++){n=this.getRowHeight_(h),i=this.leftOffset_;for(var c=this.FColDispRange.first;c<=this.FColDispRange.last;c++){if(o=this.getCellWidth_(h,c),s.resetBounds(i,r,o,n),s.pointInAt(t,e))return{fixrow:-1,fixcol:-1,row:h,col:c};i+=o}r+=n}return{fixrow:-1,fixcol:-1,row:-1,col:-1}}},{key:"getCellRect",value:function(t,e){for(var i=0,n=0,o=0;o<t;o++)i+=this.getRowHeight_(o);i-=this.VScroll_.position;for(var s=0;s<e;s++)n+=this._colWidths[s];return n-=this.HScroll_.position,nt.CreateByBounds(n,i,this._colWidths[e],this.getRowHeight_(t))}},{key:"deleteRow",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!(t<this.fixRowCount_||e<1)){var i=this.rowCount,n=this.colCount;for(e=Math.min(e,i-t);t+e<i;){for(var o=0;o<n;o++)this.rows[t][o].value=this.rows[t+e][o].value;t++}this.rowCount=this.rowCount-e,this.row=-1}}},{key:"contentHeight",get:function(){return this.contentHeight_}},{key:"contentWidth",get:function(){return this.contentWidth_}},{key:"rowCount",get:function(){return this.rows.count},set:function(t){this.setRowCount(t)}},{key:"colCount",get:function(){return this._colWidths.length},set:function(t){this.setColCount(t)}},{key:"fixRowCount",get:function(){return this.fixRowCount_},set:function(t){this.fixRowCount_!=t&&(this.fixRowCount_=t,this.update())}},{key:"row",get:function(){return this.row_},set:function(t){this.row_!=t&&(t>=0&&t<this.rows.count?this.row_=t:this.row_=-1,null!=this.onRowChanged&&this.onRowChanged(this.row_),this.update())}},{key:"col",get:function(){return this.col_},set:function(t){this.col_!=t&&(t>=0&&t<this._colWidths.length?this.col_=t:this.col_=-1,null!=this.onColChanged&&this.onColChanged(this.col_),this.update())}}]),i}(wn)),Tn={None:0,Edit:1,Combobox:2,CheckBox:3,DateTime:4,Number:5,Increment:6},bn={String:0,Number:1,Image:2},Bn=function(){function t(){r()(this,t),this.fieldName="",this.fieldType=bn.String,this.fieldTitle="",this.fieldProp="",this.inputStyle=Tn.None,this.static=!1}return l()(t,[{key:"fieldTypeParse",value:function(t){switch(t){case"Number":this.fieldType=bn.Number;break;case"Image":this.fieldType=bn.Image;break;default:this.fieldType=bn.String}}},{key:"fieldTypeName",value:function(){for(var t in bn)if(this.fieldType===bn[t])return t;return"undefined"}},{key:"inputStyleParse",value:function(t){switch(t){case"Edit":this.inputStyle=Tn.Edit;break;case"Combobox":this.inputStyle=Tn.Combobox;break;case"CheckBox":this.inputStyle=Tn.CheckBox;break;case"DateTime":this.inputStyle=Tn.DateTime;break;case"Number":this.inputStyle=Tn.Number;break;case"Increment":this.inputStyle=Tn.Increment;break;default:this.inputStyle=Tn.None}}},{key:"inputStyleName",value:function(){for(var t in Tn)if(this.inputStyle===Tn[t])return t;return"undefined"}}]),t}(),Nn=function(t){m()(i,t);var e=Gi(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,n,o)).FInnerCombobox_=null,s.columns=new ot,s.onGetCellEditControl=null,s.onCellPopupBefor=null,s.onCellPopupAfter=null,s}return l()(i,[{key:"curCellPopupBefor",value:function(t){null!==this.onCellPopupBefor&&this.onCellPopupBefor(this.row_,this.col_,t)}},{key:"curCellPopupAfter",value:function(t){null!==this.onCellPopupAfter&&this.onCellPopupAfter(this.row_,this.col_,t)}},{key:"getCellEditControl",value:function(t,e){var n=this;if(null!==this.onGetCellEditControl){var o=this.onGetCellEditControl(t,e);if(null!==o)return o}if(e<this.columns.count)switch(this.columns[e].inputStyle){case Tn.Combobox:return null===this.FInnerCombobox_&&(this.FInnerCombobox_=new mn(this.hcl,""),this.FInnerCombobox_.visible_=!1,this.FInnerCombobox_._marginLeft=0,this.FInnerCombobox_._marginTop=0,this.FInnerCombobox_._marginRight=0,this.FInnerCombobox_._marginBottom=0,this.FInnerCombobox_._paddingLeft=2,this.FInnerCombobox_._paddingTop=0,this.FInnerCombobox_._paddingRight+=2,this.FInnerCombobox_._paddingBottom=0,this.FInnerCombobox_.static=this.columns[e].static,this.FInnerCombobox_.onKeyDown=function(t){t.keyCode===Le?n.doSetInnerEdit_():t.keyCode===Ue&&n.doSetInnerEdit_(!1)},this.FInnerCombobox_.onKillFocus=function(){n.doSetInnerEdit_()},this.FInnerCombobox_.onPopupBefor=function(t){n.curCellPopupBefor(t)},this.FInnerCombobox_.onPopupAfter=function(t){n.curCellPopupAfter(t)},this.addControl(this.FInnerCombobox_)),this.FInnerCombobox_}return f()(F()(i.prototype),"getCellEditControl",this).call(this,t,e)}},{key:"addColumn",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bn.String,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Tn.None,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",r=new Bn;r.fieldName=t,r.fieldType=e,r.inputStyle=i,r.fieldTitle=o,r.static=n,r.fieldProp=s,this.columns.add(r)}}]),i}(Rn),On=function(t){m()(i,t);var e=Gi(i);function i(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return r()(this,i),(n=e.call(this,t)).text_=o,n.level=0,n._expand=!1,n.parent=null,n.object=null,n.onChange=null,n.onPaint=null,n.childs=new ot,n.childs.onAdded=function(t){t.parent=Jt()(n),t.level=n.level+1,t.onChange=function(t){n.doChange_(t)},t.onPaint=function(t,e,i,o){n.doPaint_(t,e,i,o)},n.doChange_()},n.childs.onRemoved=function(t){n.doChange_(t)},n}return l()(i,[{key:"doChange_",value:function(t){null!=this.onChange&&this.onChange(t)}},{key:"doPaint_",value:function(t,e,i,n){null!=this.onPaint&&this.onPaint(t,e,i,n)}},{key:"setText",value:function(t){this.text_!=t&&(this.text_=t,this.doChange_())}},{key:"getNodeAt",value:function(t,e,i){if(e>i&&e<=i+this.hcl.theme.itemHeight)return{node:this,top:i+this.hcl.theme.itemHeight};if(i+=this.hcl.theme.itemHeight,this._expand)for(var n,o=0,s=this.childCount;o<s;o++){if(null!=(n=this.childs[o].getNodeAt(t+this.hcl.theme.iconWidth,e,i)).node)return n;i=n.top}return{node:null,top:i}}},{key:"paintTo",value:function(t,e,i){if(this.doPaint_(t,this,e,i),i+=this.hcl.theme.itemHeight,this._expand)for(var n=0,o=this.childCount;n<o;n++)i=this.childs[n].paintTo(t,e+this.hcl.theme.iconWidth,i);return i}},{key:"addNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=new i(this.hcl,t);return n.object=e,this.childs.add(n),n}},{key:"getHeight",value:function(){var t=this.hcl.theme.itemHeight;if(this._expand)for(var e=0,i=this.childCount;e<i;e++)t+=this.childs[e].getHeight();return t}},{key:"deleteNode",value:function(t){null!=t&&this.childs.remove(t)}},{key:"childCount",get:function(){return this.childs.count}},{key:"text",get:function(){return this.text_},set:function(t){this.setText(t)}},{key:"expand",get:function(){return this._expand},set:function(t){this.childs.count>0&&this._expand!=t&&(this._expand=t,this.doChange_())}}]),i}(tt),_n=function(t){m()(i,t);var e=Gi(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).state_.add(Ri.Creating),n.canFocus=!0,n.selectNode=null,n.nodes=new ot,n.nodes.onAdded=function(t){t.parent=null,t.level=0,t.onPaint=function(t,e,i,o){n._doNodePaint(t,e,i,o)},t.onChange=function(t){n._doNodeChange(t)},n.doContentResize_()},n.nodes.onRemoved=function(t){n.doContentResize_()},n.width=200,n.height=200,n.onNodePaint=null,n.onCollaps=null,n.onExpand=null,n.onSelectChanged=null,n.state_.delete(Ri.Creating),n}return l()(i,[{key:"_doNodePaint",value:function(t,e,i,n){n+this.hcl.theme.itemHeight<0||n>this.height||(e===this.selectNode&&(t.brush.color=this.hcl.theme.backgroundSelectColor,t.fillBounds(0,n,this.width,this.hcl.theme.itemHeight)),e.childCount>0&&(e._expand?t.drawImage(i+2,n+2,this.hcl.theme.expandImage):t.drawImage(i+2,n+2,this.hcl.theme.foldImage)),null!=this.onNodePaint&&this.onNodePaint(t,e,i,n)||t.textOut(i+this.hcl.theme.iconWidth,n+3,e.text))}},{key:"_doNodeChange",value:function(t){this.doContentResize_()}},{key:"calcContentSize_",value:function(){f()(F()(i.prototype),"calcContentSize_",this).call(this);for(var t=0,e=this.nodes.count;t<e;t++)this.contentHeight_+=this.nodes[t].getHeight()}},{key:"doContentResize_",value:function(){f()(F()(i.prototype),"doContentResize_",this).call(this),this.update()}},{key:"doPaint_",value:function(t){var e=0,n=0;this.borderVisible&&(e=this.hcl.theme.borderWidth,n=this.hcl.theme.borderWidth),n-=this.VScroll_.position,t.font.assign(this.hcl.defaultFont);for(var o=0,s=this.nodes.count;o<s;o++)n=this.nodes[o].paintTo(t,e,n);f()(F()(i.prototype),"doPaint_",this).call(this,t)}},{key:"doMouseDown_",value:function(t){var e=this.getNodeAt(t.x,t.y);this.selectNode!==e&&(this.selectNode=e,this.onSelectChanged&&this.onSelectChanged(),this.update()),f()(F()(i.prototype),"doMouseDown_",this).call(this,t)}},{key:"doMouseUp_",value:function(t){var e=this.getNodeAt(t.x,t.y);null!=e&&e===this.selectNode&&t.x>e.level*this.hcl.theme.iconWidth&&t.x<(e.level+1)*this.hcl.theme.iconWidth&&this.expandSwitch(e),f()(F()(i.prototype),"doMouseUp_",this).call(this,t)}},{key:"doDblClick_",value:function(t){null!=this.selectNode&&this.expandSwitch(this.selectNode),f()(F()(i.prototype),"doDblClick_",this).call(this,t)}},{key:"expandSwitch",value:function(t){t.expand&&null!=this.onCollaps?this.onCollaps(t):t.expand||null==this.onExpand||this.onExpand(t),t.expand=!t.expand}},{key:"getNodeAt",value:function(t,e){var i=this.borderVisible?this.hcl.theme.borderWidth:0;i-=this.VScroll_.position;for(var n=null,o=0,s=this.nodes.count;o<s;o++){if(null!=(n=this.nodes[o].getNodeAt(t,e,i)).node)return n.node;i=n.top}return null}},{key:"addNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=new On(this.hcl,t);return i.object=e,this.nodes.add(i),i}},{key:"deleteNode",value:function(t){null!=t&&(null!=t.parent?t.parent.deleteNode(t):this.nodes.remove(t),this.selectNode=null)}}]),i}(wn),En=function(){function t(){r()(this,t)}return l()(t,null,[{key:"Initialization",value:function(e){var i=e.system.dpi;t.PixelsPerInchX=i.x,t.PixelsPerInchY=i.y,t.FontSizeScale=72/t.PixelsPerInchX,t.PixelsPerMMX=t.PixelsPerInchX/25.4,t.PixelsPerMMY=t.PixelsPerInchY/25.4}},{key:"twipToPixel",value:function(t,e){return L.Round(t*e/1440)}},{key:"pixelToTwip",value:function(t,e){return L.Round(1440*t/e)}},{key:"twipToMillimeter",value:function(t){return 25.4*t/1440}},{key:"millimeterToTwip",value:function(t){return 1440*t/25.4}},{key:"pixXToMillimeter",value:function(e){return e/t.PixelsPerMMX}},{key:"millimeterToPixX",value:function(e){return L.Round(e*t.PixelsPerMMX)}},{key:"millimeterToPixY",value:function(e){return L.Round(e*t.PixelsPerMMY)}},{key:"pixYToMillimeter",value:function(e){return e/t.PixelsPerMMY}},{key:"ptToPixel",value:function(t,e){return L.Round(t*e/72)}},{key:"pixelToPt",value:function(t,e){return t/e*72}},{key:"twipToPt",value:function(t){return t/1440*72}}]),t}();function Mn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}En.PixelsPerInchX=0,En.PixelsPerInchY=0,En.FontSizeScale=72/En.PixelsPerInchX,En.PixelsPerMMX=En.PixelsPerInchX/25.4,En.PixelsPerMMY=En.PixelsPerInchY/25.4;var Ln={Left:0,Center:1,Right:2,Justify:3,Scatter:4},Gn={Top:0,Center:1,Bottom:2},Hn={PLS100:0,PLS115:1,PLS150:2,PLS200:3,PLSMin:4,PLSFix:5,PLSMult:6},Vn=function(t){m()(i,t);var e=Mn(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).FLineSpaceMode=Hn.PLS150,n.FLineSpace=1,n.FFirstIndentPix=0,n.FLeftIndentPix=0,n.FRightIndentPix=0,n.FFirstIndent=0,n.FLeftIndent=0,n.FRightIndent=0,n.FBreakRough=!1,n.FBackColor=Yl.HCTransparentColor,n.FAlignHorz=Ln.Justify,n.FAlignVert=Gn.Center,n.CheckSaveUsed=!1,n.TempNo=-1,n}return l()(i,[{key:"SetFirstIndent",value:function(t){this.FFirstIndent!=t&&(this.FFirstIndent=t,this.FFirstIndentPix=En.millimeterToPixX(this.FFirstIndent))}},{key:"SetLeftIndent",value:function(t){this.FLeftIndent!=t&&(this.FLeftIndent=t,this.FLeftIndentPix=En.millimeterToPixX(this.FLeftIndent))}},{key:"SetRightIndent",value:function(t){this.FRightIndent!=t&&(this.FRightIndent=t,this.FRightIndentPix=En.millimeterToPixX(this.FRightIndent))}},{key:"EqualsEx",value:function(t){return this.FLineSpaceMode==t.LineSpaceMode&&this.FLineSpace==t.LineSpace&&this.FFirstIndent==t.FirstIndent&&this.FLeftIndent==t.LeftIndent&&this.FRightIndent==t.RightIndent&&this.FBackColor==t.BackColor&&this.FBreakRough==t.BreakRough&&this.FAlignHorz==t.AlignHorz&&this.FAlignVert==t.AlignVert}},{key:"AssignEx",value:function(t){this.FLineSpaceMode=t.LineSpaceMode,this.FLineSpace=t.LineSpace,this.FirstIndent=t.FirstIndent,this.LeftIndent=t.LeftIndent,this.RightIndent=t.RightIndent,this.FBackColor=t.BackColor,this.FBreakRough=t.BreakRough,this.FAlignHorz=t.AlignHorz,this.FAlignVert=t.AlignVert}},{key:"SaveToStream",value:function(t){t.writeByte(this.FLineSpaceMode),t.writeSingle(this.FLineSpace),t.writeSingle(this.FFirstIndent),t.writeSingle(this.FLeftIndent),t.writeSingle(this.FRightIndent),Yl.HCSaveColorToStream(this.hcl,t,this.FBackColor);var e=0;this.FBreakRough&&(e|=128),t.writeByte(e),e=this.FAlignHorz,t.writeByte(e),e=this.FAlignVert,t.writeByte(e)}},{key:"LoadFromStream",value:function(t,e){e<15&&t.readInt32(),e>16&&(this.FLineSpaceMode=t.readByte()),e>30?this.FLineSpace=t.readSingle():this.FLineSpaceMode==Hn.Fix&&(this.FLineSpace=12),e<22?(this.FFirstIndentPix=t.readInt32(),this.FLeftIndentPix=t.readInt32()):(this.FFirstIndent=t.readSingle(),this.FFirstIndentPix=En.millimeterToPixX(this.FFirstIndent),this.FLeftIndent=t.readSingle(),this.FLeftIndentPix=En.millimeterToPixX(this.FLeftIndent),this.FRightIndent=t.readSingle(),this.FRightIndentPix=En.millimeterToPixX(this.FRightIndent)),this.FBackColor=Yl.HCLoadColorFromStream(t),e<66&&(this.FBackColor=Yl.HCTransparentColor);var i=0;e>31&&(i=t.readByte(),this.FBreakRough=L.isOdd(i>>7)),this.FAlignHorz=t.readByte(),e>17&&(this.FAlignVert=t.readByte())}},{key:"ToCSS",value:function(){var t=" margin:0px 0; padding:0px 0; text-align: ";switch(this.FAlignHorz){case Ln.Left:t+="left";break;case Ln.Right:t+="right";break;case Ln.Center:t+="center";break;case Ln.Justify:case Ln.Scatter:t+="justify"}switch(this.FLineSpaceMode){case Hn.PLS100:t+="; line-height: 100%";break;case Hn.PLS115:t+="; line-height: 115%";break;case Hn.PLS150:t+="; line-height: 150%";break;case Hn.PLS200:t+="; line-height: 200%";break;case Hn.PLSMin:t+="; line-height: 100%";break;case Hn.PLSMult:t+="; line-height: "+Math.round(100*this.FLineSpace)+"%";break;case Hn.PLSFix:t+="; line-height: "+En.millimeterToPixY(.3527*this.FLineSpace)+"px"}return t}},{key:"GetLineSpaceModeXML_",value:function(){switch(this.FLineSpaceMode){case Hn.PLS100:return"100";case Hn.PLS115:return"115";case Hn.PLS150:return"150";case Hn.PLS200:return"200";case Hn.PLSMin:return"min";case Hn.PLSMult:return"mult";case Hn.PLSFix:return"fix";default:return"100"}}},{key:"GetHorzXML_",value:function(){switch(this.FAlignHorz){case Ln.Left:return"left";case Ln.Right:return"right";case Ln.Center:return"center";case Ln.Justify:return"justify";default:return"scatter"}}},{key:"GetVertXML_",value:function(){switch(this.FAlignVert){case Gn.Top:return"top";case Gn.Center:return"center";default:return"bottom"}}},{key:"ToJSONString",value:function(){return'"FirstIndent":'+this.FFirstIndent.toString()+',"LeftIndent":'+this.FLeftIndent.toString()+',"RightIndent":'+this.FRightIndent.toString()+',"LineSpaceMode":'+this.FLineSpaceMode.toString()+',"LineSpace":'+this.FLineSpace.toString()+',"BackColor":'+this.FBackColor+',"BreakRough":'+this.FBreakRough.toString()+',"AlignHorz":'+this.FAlignHorz.toString()+',"AlignVert":'+this.FAlignVert.toString()}},{key:"ParseJSONObject",value:function(t){null!=t.LineSpaceMode&&(this.FLineSpaceMode=t.LineSpaceMode),null!=t.LineSpace&&(this.FLineSpace=t.LineSpace),null!=t.FirstIndent&&(this.FirstIndent=t.FirstIndent),null!=t.LeftIndent&&(this.LeftIndent=t.LeftIndent),null!=t.RightIndent&&(this.RightIndent=t.RightIndent),null!=t.BackColor&&(this.FBackColor=t.BackColor),null!=t.BreakRough&&(this.FBreakRough=t.BreakRough),null!=t.AlignHorz&&(this.FAlignHorz=t.AlignHorz),null!=t.AlignVert&&(this.FAlignVert=t.AlignVert)}},{key:"ToXml",value:function(t){}},{key:"ParseXml",value:function(t){}},{key:"LineSpaceMode",get:function(){return this.FLineSpaceMode},set:function(t){this.FLineSpaceMode=t}},{key:"LineSpace",get:function(){return this.FLineSpace},set:function(t){this.FLineSpace=t}},{key:"FirstIndent",get:function(){return this.FFirstIndent},set:function(t){this.SetFirstIndent(t)}},{key:"LeftIndent",get:function(){return this.FLeftIndent},set:function(t){this.SetLeftIndent(t)}},{key:"RightIndent",get:function(){return this.FRightIndent},set:function(t){this.SetRightIndent(t)}},{key:"FirstIndentPix",get:function(){return this.FFirstIndentPix}},{key:"LeftIndentPix",get:function(){return this.FLeftIndentPix}},{key:"RightIndentPix",get:function(){return this.FRightIndentPix}},{key:"BackColor",get:function(){return this.FBackColor},set:function(t){this.FBackColor=t}},{key:"BreakRough",get:function(){return this.FBreakRough},set:function(t){this.FBreakRough=t}},{key:"AlignHorz",get:function(){return this.FAlignHorz},set:function(t){this.FAlignHorz=t}},{key:"AlignVert",get:function(){return this.FAlignVert},set:function(t){this.FAlignVert=t}}]),i}(tt);function Un(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Wn={Bold:1,Italic:2,Underline:4,Strikeout:8,Superscript:16,Subscript:32,Emphasize:64},zn=function(t){m()(i,t);var e=Un(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).DefaultFontSize=10.5,n.DefaultFontFamily=L.DefaultFont,n.MaxFontSize=512,n.FSize=n.DefaultFontSize,n.FFontHeight=14,n.FFamily=n.DefaultFontFamily,n.FFontStyles=new q,n.FColor=Ft.Black,n.FBackColor=Yl.HCTransparentColor,n.FCJKFont=!0,n.FTrueType=!0,n.FTextmetric_tmAscent=12,n.FTextmetric_tmDescent=2,n.FTextMetric_tmAveCharWidth=7,n.FTextMetric_tmExternalLeading=2,n.FTextMetric_tmHeight=14,n.CheckSaveUsed=!1,n.TempNo=-1,n.meaChar=!1,n}return l()(i,[{key:"SetFamily",value:function(t){this.FFamily!=t&&(this.FFamily=t)}},{key:"SetSize",value:function(t){this.FSize!=t&&(this.FSize=t)}},{key:"SetFontStyles",value:function(t){this.FFontStyles!=t&&(this.FFontStyles=t)}},{key:"ApplyStyle",value:function(t){this.hcl.sameColor(this.FBackColor,Yl.HCTransparentColor)?t.brush.style=Mt.Clear:t.brush.color=this.FBackColor,t.font.beginUpdate();try{t.font.color=this.FColor,t.font.name=this.FFamily,t.font.size=this.FSize,t.font.styles.value=this.FFontStyles.value,t.font.meaChar=this.meaChar}finally{t.font.endUpdate()}this.FFontStyles.has(Wn.Emphasize)&&(t.pen.style=_t.Solid,t.pen.width=1,t.pen.color=Ft.Red),this.FTextMetric_tmAveCharWidth=t.font.advCharWidth,this.FTextMetric_tmExternalLeading=t.font.externalLeading,this.FTextMetric_tmHeight=t.font.height,this.FFontHeight=t.font.height,this.FCJKFont=t.font.CJK,this.FTrueType=t.font.trueType,this.FTextmetric_tmAscent=t.font.ascent,this.FTextmetric_tmDescent=t.font.descent}},{key:"ApplySupSubStyle",value:function(t){this.FBackColor==Yl.HCTransparentColor?t.brush.style=Mt.Clear:t.brush.color=this.FBackColor,t.font.color=this.FColor,t.font.name=this.FFamily,t.font.size=L.Round(this.FSize*L.FontSupSubScale),this.FFontStyles.has(Wn.Bold)?t.font.styles.add(Wn.Bold):t.font.styles.remove(Wn.Bold),this.FFontStyles.has(Wn.Italic)?t.font.styles.add(Wn.Italic):t.font.styles.remove(Wn.Italic),this.FFontStyles.has(Wn.Underline)?t.font.styles.add(Wn.Underline):t.font.styles.remove(Wn.Underline),this.FFontStyles.has(Wn.Strikeout)?t.font.styles.add(Wn.Strikeout):t.font.styles.remove(Wn.Strikeout)}},{key:"EqualsEx",value:function(t){return this.FSize==t.Size&&this.FFontStyles.value==t.FontStyles.value&&this.FFamily==t.Family&&this.hcl.sameColor(this.FColor,t.Color)&&this.hcl.sameColor(this.FBackColor,t.BackColor)}},{key:"AssignEx",value:function(t){this.FSize=t.Size,this.FFontHeight=t.FontHeight,this.FFontStyles.value=t.FontStyles.value,this.FFamily=t.Family,this.FColor=t.Color,this.FBackColor=t.BackColor}},{key:"SaveToStream",value:function(t){t.writeSingle(this.FSize),Yl.HCSaveTextToStream(t,this.FFamily),t.writeByte(this.FFontStyles.value),Yl.HCSaveColorToStream(this.hcl,t,this.FColor),Yl.HCSaveColorToStream(this.hcl,t,this.FBackColor)}},{key:"LoadFromStream",value:function(t,e){if(e<12){var i=t.readInt32();this.FSize=new Y(i).value}else this.FSize=t.readSingle();this.FFamily=Yl.HCLoadTextFromStream(t,e),this.FFontStyles.value=t.readByte(),this.FColor=Yl.HCLoadColorFromStream(t),this.FBackColor=Yl.HCLoadColorFromStream(t)}},{key:"ToJSONString",value:function(){return'"Size":'+this.FSize.toString()+',"Family":'+this.FFamily+',"Color":'+this.FColor+',"BackColor":'+this.FBackColor+',"FontStyles":'+this.FFontStyles}},{key:"ParseJSON",value:function(t){null!=t.Size&&(this.FSize=Nt.fontSizeToPt(t.Size)),null!=t.Family&&(this.FFamily=t.Family),null!=t.Color&&(this.FColor=t.Color),null!=t.BackColor&&(this.FBackColor=t.BackColor),null!=t.ClearStyle&&t.ClearStyle&&(this.FFontStyles.value=0),null!=t.FontStyles&&(null!=t.FontStyles.Bold&&t.FontStyles.Bold&&this.FFontStyles.add(Wn.Bold),null!=t.FontStyles.Italic&&t.FontStyles.Italic&&this.FFontStyles.add(Wn.Italic),null!=t.FontStyles.Underline&&t.FontStyles.Underline&&this.FFontStyles.add(Wn.Underline),null!=t.FontStyles.Strikeout&&t.FontStyles.Strikeout&&this.FFontStyles.add(Wn.Strikeout),null!=t.FontStyles.Superscript&&t.FontStyles.Superscript&&this.FFontStyles.add(Wn.Superscript),null!=t.FontStyles.Subscript&&t.FontStyles.Subscript&&this.FFontStyles.add(Wn.Subscript),null!=t.FontStyles.Emphasize&&t.FontStyles.Emphasize&&this.FFontStyles.add(Wn.Emphasize))}},{key:"GetTextDecoration",value:function(){var t="";return this.FFontStyles.has(wt)&&(t=" underline"),this.FFontStyles.has(At)&&(""!=t?t+=", line-through":t=" line-through"),"text-decoration:"+t+";"}},{key:"ToCSS",value:function(){var t=L.stringFormat(" font-size: {0:N1}pt",this.FSize)+L.stringFormat(" font-family: {0};",this.FFamily)+L.stringFormat(" color:{0};",this.FColor);return this.FFontStyles.has(Ct)?t+=L.stringFormat(" font-style: {0};","italic"):t+=L.stringFormat(" font-style: {0};","normal"),this.FFontStyles.has(gt)||this.FFontStyles.has(At)?t+=L.stringFormat(" font-weight: {0};","bold"):t+=L.stringFormat(" font-weight: {0};","normal"),(this.FFontStyles.has(wt)||this.FFontStyles.has(At))&&(t+=" "+this.GetTextDecoration()),this.FFontStyles.has(Dt)&&(t+="  vertical-align:super;"),this.FFontStyles.has(Pt)&&(t+="  vertical-align:sub;"),t}},{key:"trueType",get:function(){return this.FTrueType}},{key:"CJKFont",get:function(){return this.FCJKFont}},{key:"Textmetric_tmAscent",get:function(){return this.FTextmetric_tmAscent}},{key:"Textmetric_tmDescent",get:function(){return this.FTextmetric_tmDescent}},{key:"TextMetric_tmAveCharWidth",get:function(){return this.FTextMetric_tmAveCharWidth}},{key:"TextMetric_tmExternalLeading",get:function(){return this.FTextMetric_tmExternalLeading}},{key:"TextMetric_tmHeight",get:function(){return this.FTextMetric_tmHeight}},{key:"Family",get:function(){return this.FFamily},set:function(t){this.SetFamily(t)}},{key:"Size",get:function(){return this.FSize},set:function(t){this.SetSize(t)}},{key:"FontHeight",get:function(){return this.FFontHeight}},{key:"FontStyles",get:function(){return this.FFontStyles},set:function(t){this.SetFontStyles(t)}},{key:"Color",get:function(){return this.FColor},set:function(t){this.FColor=t,0==this.hcl.colorToRGBA(this.FColor).a&&this.hcl.errorLog("字体颜色出现透明this.FColor"+this.FColor)}},{key:"BackColor",get:function(){return this.FBackColor},set:function(t){this.FBackColor=t}}]),i}(tt);function Kn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Jn=function(t){m()(i,t);var e=Kn(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).Name="",n.Value="",n}return l()(i)}(tt),jn=function(t){m()(i,t);var e=Kn(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).Attributes=null,n.ChildNodes=null,n}return l()(i,[{key:"SetAttribute",value:function(t,e){this.Attributes||(this.Attributes=new ot);var i=new Jn(this.hcl);i.Name=t,i.Value=e,this.Attributes.add(i)}},{key:"HasAttribute",value:function(t){if(!this.Attributes)return!1;for(var e=0;e<this.Attributes.count;e++)if(this.Attributes[e].Name==t)return!0;return!1}},{key:"GetAttribute",value:function(t){if(!this.Attributes)return null;for(var e=0;e<this.Attributes.count;e++)if(this.Attributes[e].Name==t)return this.Attributes[e].Value;return null}},{key:"AppendChild",value:function(t){this.ChildNodes||(this.ChildNodes=new ot),this.ChildNodes.add(t)}},{key:"FindNode",value:function(t){if(null==this.ChildNodes)return null;for(var e=0;e<this.ChildNodes.count;e++)if(this.ChildNodes[e].Name==t)return this.ChildNodes[e];return null}},{key:"ToString",value:function(){var t="<"+this.Name;if(this.Attributes&&this.Attributes.count>0)for(var e=0;e<this.Attributes.count;e++)t+=" "+this.Attributes[e].Name+'="'+this.Attributes[e].Value+'"';if(t+=">",this.ChildNodes&&this.ChildNodes.count>0)for(var i=0;i<this.ChildNodes.count;i++)t+=this.ChildNodes[i].ToString();else t+=this.Value;return t+="</"+this.Name+">"}}],[{key:"Create",value:function(t,e,n){var o=new i(n);return o.Name=t,e&&(o.Value=e),o}}]),i}(Jn),Yn=0,Qn=1,Xn=2,Zn=3,qn=function(t){m()(i,t);var e=Kn(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).Version="1.0",n.Encoding="UTF-8",n}return l()(i,[{key:"CreateNode",value:function(t,e){return jn.Create(t,e,this.hcl)}},{key:"ToString",value:function(){var t='<?xml version="'+this.Version+'" encoding="'+this.Encoding+'"?>';if(this.ChildNodes&&this.ChildNodes.count>0)for(var e=0;e<this.ChildNodes.count;e++)t+=this.ChildNodes[e].ToString();return t}},{key:"_findEndOffs",value:function(t,e,i,n){for(var o=i;o<n;){if(e[o]==t)return o;o++}return-1}},{key:"_parseNode",value:function(t,e,i,n){var o=this._findEndOffs(">",t,e+1,i);if(o>0){if("?"===t[e+1])return o;if(e<o-3&&"!"===t[e+1]&&"-"===t[e+2]&&"-"===t[e+3])return o;var s=new jn(this.hcl);null!=n&&n.AppendChild(s);for(var r="",a="",l=Yn,h=e+1;h<o;h++){if(" "===t[h]){if(l===Yn){s.Name=r,l=Qn,r="";continue}if(l===Zn)continue}else if("="===t[h]){if(l===Qn){a=r,r="";continue}}else{if('"'===t[h]||"'"===t[h]){l!=Xn?l=Xn:(s.SetAttribute(a,r),l=Zn,r="");continue}l===Zn&&(l=Qn)}r+=t[h]}for(""===s.Name&&(s.Name=r),r="",e=o+1;e<i;){if("<"===t[e]){if(e<i-1){if("/"===t[e+1]){s.Value=r,e+=1+s.Name.length+1;break}if((e=this._parseNode(t,e,i,s))<0)return-1}}else"\r"!==t[e]&&"\n"!==t[e]&&(r+=t[e]);e++}return e}return console.log("不正确的xml节点！位置："+e.toString()),-1}},{key:"FromString",value:function(t){for(var e=0,i=t.length;e<i;){if("<"===t[e]&&(e=this._parseNode(t,e,i,this))<0)return;e++}}},{key:"parseString",value:function(t){this.FromString(t)}},{key:"Text",get:function(){return this.ToString()}}]),i}(jn);function $n(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var to=l()((function t(){r()(this,t),this.RePaint=!1,this.ReCaret=!1,this.ReStyle=!1,this.ReScroll=!1,this.Selecting=!1,this.DragingSelected=!1})),eo=l()((function t(){r()(this,t),this.State=oh.Loading,this.Count=0})),io=function(){function t(){r()(this,t),this.FStates=new ot}return l()(t,[{key:"_deleteState",value:function(t){this.FStates.delete(t)}},{key:"_getStateIndex",value:function(t){for(var e=0;e<this.FStates.count;e++)if(this.FStates[e].State===t)return e;return-1}},{key:"Include",value:function(t){var e=this._getStateIndex(t);if(e>=0)this.FStates[e].Count++;else{var i=new eo;i.State=t,i.Count=1,this.FStates.add(i)}}},{key:"Exclude",value:function(t){var e=this._getStateIndex(t);e>=0&&(this.FStates[e].Count>1?this.FStates[e].Count--:this._deleteState(e))}},{key:"Contain",value:function(t){return this._getStateIndex(t)>=0}},{key:"UndoRedo",value:function(){return this.Contain(oh.Undoing)||this.Contain(oh.Redoing)}}]),t}(),no=function(t){m()(i,t);var e=$n(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).NO=-1,n.orgObj=null,n.objList=new ot,n}return l()(i,[{key:"CheckObj",value:function(t){t.Assign(this.orgObj),t.NO=0,t.ReFormatRequest()}},{key:"CheckObjList",value:function(){for(var t=0;t<this.objList.count;t++)this.CheckObj(this.objList[t]);this.objList.clear()}}]),i}(tt),oo=function(t){m()(i,t);var e=$n(i);function i(t){var n,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r()(this,i),(n=e.call(this,t)).FTempCanvas=n.CreateStyleCanvas(),n.FTempStyleNo=i.Null,n.FBackgroundColor="#ffffff",n.FSelColor="#a6caf0",n.FLineSpaceMin=8,n.FShowParaLastMark=!0,n.FDrawActiveDomainRegion=!0,n.FDrawHotDomainRegion=!0,n.FFormatVersion=Yl.HCFormatVersion,n.FStates=new io,n.FUpdateInfo=new to,n.FDefaultTextStyle=new zn(t),n.FDefaultTextStyle.ApplyStyle(n.FTempCanvas),n.FTextStyles=new ot,n.FParaStyles=new ot,n.SkipFormat=!1,n.FormatBrushStyleNo=0,n.Cursor=Se,n.CursorIBeamHore=Ce,n.CopyRectPart=!1,n.MergeStyle=!1,n.PrintTextBlack=!1,n.TraceAction=!0,n.UseResWaite=0,n.ResWaiteNo=0,n.ResWaiteList=new ot,n.RectReadOnlyColor=Yl.clBtnFace,n.RectHotBKColor="#cce0f4",n.RectActiveBKColor="#c4e1ff",n.RectActiveBorderColor="#003399",n.ItemMarkColor="#003399",n.DomainMarkColor="#003399",n.DomainBorderRelax=!1,n.DomainFormatWidth=0,n.DomainHotBorderColor="#b4b4b4",n.DomainActiveBorderColor="#003399",n.EditProtectColor="#f0f0f0",n.AllocMustColor="#ff0000",n.PromptFontColor=Ft.Gray,n.PromptFontStyles=new Tt,n.ReadOnlyProcessAnnotate=!1,n.AnnotateVisible=!0,n.AnnotateBKColor="rgb(255, 213, 213)",n.AnnotateBKHotColor="#FFBEBE",n.AnnotateBKActiveColor="rgb(255, 168, 168)",n.AnnotateLineColor="#CD5454",n.AnnotateBKSolveColor="#D7F0F0",n.AnnotateBKHotSolveColor="#BEE6E6",n.AnnotateBKActiveSolveColor="#ADE9E9",n.MultiplePage=!1,n.FilmOrientation=Ql.Portrait,n.HeaderFooterLayout=th.TopBottom,n.WillStyleNo=i.Null,o&&n.NewDefaultTextStyle(),s&&n.NewDefaultParaStyle(),n.FOnInvalidateRect=null,n}return l()(i,[{key:"NewResWaite",value:function(){this.ResWaiteNo++;var t=new no(this.hcl);return t.NO=this.ResWaiteNo,this.ResWaiteList.add(t),this.ResWaiteNo}},{key:"SetResWaiteOrgobj",value:function(t,e){for(var i=0;i<this.ResWaiteList.count;i++)if(this.ResWaiteList[i].NO===t){this.ResWaiteList[i].orgObj=e,this.ResWaiteList[i].CheckObjList();break}}},{key:"SetResWaiteObj",value:function(t,e){for(var i=0;i<this.ResWaiteList.count;i++)if(this.ResWaiteList[i].NO===t){null!==this.ResWaiteList[i].orgObj?this.ResWaiteList[i].CheckObj(e):this.ResWaiteList[i].objList.add(e);break}}},{key:"ClearResWaite",value:function(){this.ResWaiteList.clear()}},{key:"ResWaiteFinish",value:function(){for(var t=0;t<this.ResWaiteList.count;t++)if(0!==this.ResWaiteList[t].objList.length)return!1;return!0}},{key:"SetShowParaLastMark",value:function(t){this.FShowParaLastMark!=t&&(this.FShowParaLastMark=t,this.UpdateInfoRePaint())}},{key:"Initialize",value:function(){this.FFormatVersion=Yl.HCFormatVersion,this.FTextStyles.removeRange(1,this.FTextStyles.count-1),this.FTextStyles[0].AssignEx(this.FDefaultTextStyle),this.FParaStyles.removeRange(1,this.FParaStyles.count-1)}},{key:"UpdateInfoRePaint",value:function(){this.FUpdateInfo.RePaint=!0}},{key:"UpdateInfoReStyle",value:function(){this.FUpdateInfo.ReStyle=!0}},{key:"UpdateInfoReScroll",value:function(){this.FUpdateInfo.ReScroll=!0}},{key:"UpdateInfoReCaret",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.FUpdateInfo.ReCaret=!0,this.FUpdateInfo.ReStyle=t}},{key:"AddTextStyle",value:function(t){return this.FTextStyles.add(t),this.FTextStyles.count-1}},{key:"CreateStyleCanvas",value:function(){var t=document.createElement("canvas").getContext("2d");return new zt(this.hcl,t)}},{key:"DestroyStyleCanvas",value:function(t){t.h5context.canvas=null}},{key:"NewDefaultTextStyle",value:function(){var t=new zn(this.hcl);return this.FTextStyles.add(t),t.ApplyStyle(this.TempCanvas),this.FTempStyleNo=this.FTextStyles.count-1,this.FTextStyles.count-1}},{key:"NewDefaultParaStyle",value:function(){var t=new Vn(this.hcl);return this.FParaStyles.add(t),this.FParaStyles.count-1}},{key:"GetDefaultStyleNo",value:function(){return this.GetStyleNo(this.FDefaultTextStyle,!0)}},{key:"GetStyleNo",value:function(t,e){for(var i=-1,n=0;n<=this.FTextStyles.count-1;n++)if(this.FTextStyles[n].EqualsEx(t))return i=n;if(e&&i<0){var o=new zn(this.hcl);o.AssignEx(t),this.FTextStyles.add(o),o.ApplyStyle(this.TempCanvas),i=this.FTextStyles.count-1,this.FTempStyleNo=i}return i}},{key:"GetParaNo",value:function(t,e){for(var i=-1,n=0;n<=this.FParaStyles.count-1;n++)if(this.FParaStyles[n].EqualsEx(t))return i=n;if(e&&i<0){var o=new Vn(this.hcl);o.AssignEx(t),this.FParaStyles.add(o),i=this.FParaStyles.count-1}return i}},{key:"ApplyTempStyle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.FTempStyleNo!=t&&(this.FTempStyleNo=t,t>i.Null&&this.FTextStyles[t].ApplyStyle(this.FTempCanvas,e))}},{key:"SaveParaStyles",value:function(t){var e=this.FParaStyles.count;t.writeInt32(e);for(var i=0;i<this.FParaStyles.count;i++)this.FParaStyles[i].SaveToStream(t)}},{key:"SaveTextStyles",value:function(t){var e=this.TextStyles.count;t.writeInt32(e);for(var i=0;i<this.FTextStyles.count;i++)this.FTextStyles[i].SaveToStream(t)}},{key:"SaveToStream",value:function(t){var e=t.position;t.writeUInt64(e),t.writeByte(this.FFormatVersion),t.writeByte(this.FLineSpaceMin),t.writeByte(this.FilmOrientation),t.writeByte(this.HeaderFooterLayout),t.writeByte(this.DomainFormatWidth);var i=0;this.FShowParaLastMark&&(i|=128),this.PrintTextBlack&&(i|=64),t.writeByte(i),this.SaveParaStyles(t),this.SaveTextStyles(t);var n=t.position;t.position=e,e=n-e-8,t.writeUInt64(e),t.position=n}},{key:"LoadParaStyles",value:function(t,e){this.FParaStyles.clear();for(var i=t.readInt32(),n=0;n<=i-1;n++)this.FParaStyles[this.NewDefaultParaStyle()].LoadFromStream(t,e)}},{key:"LoadTextStyles",value:function(t,e){this.FTextStyles.clear();for(var i=t.readInt32(),n=0;n<=i-1;n++)this.FTextStyles[this.NewDefaultTextStyle()].LoadFromStream(t,e)}},{key:"LoadFromStream",value:function(t,e){if(t.readInt64(),this.FFormatVersion=e>33?t.readByte():1,this.FLineSpaceMin=e>49?t.readByte():8,e>63?(this.FilmOrientation=t.readByte(),this.HeaderFooterLayout=t.readByte()):(this.FilmOrientation=Ql.Portrait,this.HeaderFooterLayout=th.TopBottom),this.DomainFormatWidth=e>65?t.readByte():0,e>53){var i=t.readByte();this.FShowParaLastMark=L.isOdd(i>>7),this.PrintTextBlack=L.isOdd(i>>6)}else this.FShowParaLastMark=!0;this.LoadParaStyles(t,e),this.LoadTextStyles(t,e)}},{key:"ParaStylesToJSONString",value:function(){for(var t="",e=0;e<this.FParaStyles.count;e++)t+=this.FParaStyles[e].ToJSONString()+",";return","===t[t.length-1]&&(t=t.substring(0,t.length-1)),t}},{key:"TextStylesToJSONString",value:function(){for(var t="",e=0;e<this.FTextStyles.count;e++)t+=this.FTextStyles[e].ToJSONString()+",";return","===t[t.length-1]&&(t=t.substring(0,t.length-1)),t}},{key:"ToJSONString",value:function(){return'"FormatVersion":'+this.FFormatVersion.toString()+',"LineSpaceMin":'+this.FLineSpaceMin.toString()+',"ShowParaLastMark":'+this.FShowParaLastMark+',"PrintTextBlack":'+this.PrintTextBlack+',"ParaStyles":{'+this.ParaStylesToJSONString()+'},"TextStyles":{'+this.TextStylesToJSONString()+"}"}},{key:"ParaStylesParseJSONObj",value:function(t){}},{key:"TextStylesParseJSONObj",value:function(t){}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.FormatVersion&&(this.FFormatVersion=t.FormatVersion),null!=t.FLineSpaceMin&&(this.FLineSpaceMin=t.FLineSpaceMin),null!=t.ShowParaLastMark&&(this.FShowParaLastMark=t.ShowParaLastMark),null!=t.PrintTextBlack&&(this.PrintTextBlack=t.PrintTextBlack),null!=t.ParaStyles&&this.ParaStylesParseJSONObj(t.ParaStyles),null!=t.TextStyles&&this.TextStylesParseJSONObj(t.TextStyles)}},{key:"GetHtmlFileTempName",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return t?this.FHtmlFileTempName=0:this.FHtmlFileTempName++,this.FHtmlFileTempName.toString()}},{key:"ToCSS",value:function(){for(var t='<style type="text/css">table{border-collapse: collapse;}',e=0;e<this.FTextStyles.count;e++)t=(t=t+Yl.sLineBreak+"a.fs"+e.toString()+" {")+this.FTextStyles[e].ToCSS()+" }";for(var i=0;i<this.FParaStyles.count;i++)t+=Yl.sLineBreak+"p.ps"+i.toString()+" {",t+=this.FParaStyles[i].ToCSS()+" }";return t+Yl.sLineBreak+"</style>"}},{key:"InvalidateRect",value:function(t){null!=this.FOnInvalidateRect&&this.FOnInvalidateRect(t)}},{key:"ConvertToCurVersion",value:function(){this.FFormatVersion=Yl.HCFormatVersion}},{key:"TextStyleCharWidth",value:function(t,e){return this.FTextStyles[t].ApplyStyle(this.FTempCanvas),this.FTempCanvas.textWidth("工")*e}},{key:"DefaultTextStyle",get:function(){return this.FDefaultTextStyle}},{key:"TextStyles",get:function(){return this.FTextStyles},set:function(t){this.FTextStyles=t}},{key:"ParaStyles",get:function(){return this.FParaStyles},set:function(t){this.FParaStyles=t}},{key:"BackgroundColor",get:function(){return this.FBackgroundColor},set:function(t){this.FBackgroundColor=t}},{key:"SelColor",get:function(){return this.FSelColor},set:function(t){this.FSelColor=t}},{key:"LineSpaceMin",get:function(){return this.FLineSpaceMin},set:function(t){this.FLineSpaceMin=t}},{key:"TempStyleNo",get:function(){return this.FTempStyleNo}},{key:"TempCanvas",get:function(){return this.FTempCanvas}},{key:"UpdateInfo",get:function(){return this.FUpdateInfo}},{key:"DrawActiveDomainRegion",get:function(){return this.FDrawActiveDomainRegion},set:function(t){this.FDrawActiveDomainRegion=t}},{key:"DrawHotDomainRegion",get:function(){return this.FDrawHotDomainRegion},set:function(t){this.FDrawHotDomainRegion=t}},{key:"ShowParaLastMark",get:function(){return this.FShowParaLastMark},set:function(t){this.SetShowParaLastMark(t)}},{key:"States",get:function(){return this.FStates}},{key:"FormatVersion",get:function(){return this.FFormatVersion}},{key:"OnInvalidateRect",get:function(){return this.FOnInvalidateRect},set:function(t){this.FOnInvalidateRect=t}}]),i}(tt);function so(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}oo.Null=-1,oo.Image=-2,oo.Table=-3,oo.Tab=-4,oo.Line=-5,oo.Express=-6,oo.Vector=-7,oo.Domain=-8,oo.PageBreak=-9,oo.CheckBox=-10,oo.Gif=-11,oo.Control=-12,oo.Edit=-13,oo.Combobox=-14,oo.QRCode=-15,oo.BarCode=-16,oo.Fraction=-17,oo.DateTimePicker=-18,oo.RadioGroup=-19,oo.SupSubScript=-20,oo.Button=-21,oo.Bullet=-22,oo.FloatLine=-101,oo.FloatBarCode=-102,oo.FloatImage=-116,oo.FloatQRCode=-117,oo.Annotate=-118,oo.Chart=-119,oo.Fraction2=-120,oo.Label=-121,oo.Custom=-1e3;var ro=0,ao=2,lo=function(){function t(){r()(this,t),this.FOptions=new Set([]),this.ItemNo=-1,this.CharOffs=-1,this.CharLen=-1,this.rect=new nt}return l()(t,[{key:"GetLineFirst",value:function(){return this.FOptions.has(ro)}},{key:"SetLineFirst",value:function(t){t?this.FOptions.add(ro):this.FOptions.delete(ro)}},{key:"GetParaFirst",value:function(){return this.FOptions.has(ao)}},{key:"SetParaFirst",value:function(t){t?this.FOptions.add(ao):this.FOptions.delete(ao)}},{key:"CharOffsetStart",value:function(){return this.CharOffs-1}},{key:"CharOffsetEnd",value:function(){return this.CharOffs+this.CharLen-1}},{key:"width",get:function(){return this.rect.width}},{key:"height",get:function(){return this.rect.height}},{key:"LineFirst",get:function(){return this.GetLineFirst()},set:function(t){this.SetLineFirst(t)}},{key:"ParaFirst",get:function(){return this.GetParaFirst()},set:function(t){this.SetParaFirst(t)}}]),t}(),ho=function(t){m()(i,t);var e=so(i);function i(){var t;return r()(this,i),(t=e.call(this)).FDeleteStartDrawItemNo=-1,t.FDeleteCount=0,t}return l()(i,[{key:"insert",value:function(t,e){if(0==this.FDeleteCount)return f()(F()(i.prototype),"insert",this).call(this,t,e);this.FDeleteStartDrawItemNo++,this.FDeleteCount--;var n=this[t];return this.splice(t,1,e),this.doRemoved_(n),n=null,!0}},{key:"clear",value:function(){f()(F()(i.prototype),"clear",this).call(this),this.ClearFormatMark()}},{key:"MarkFormatDelete",value:function(t,e){this.FDeleteStartDrawItemNo=t,this.FDeleteCount=e-t+1}},{key:"DeleteFormatMark",value:function(){this.removeRange(this.FDeleteStartDrawItemNo,this.FDeleteCount),this.FDeleteStartDrawItemNo=-1,this.FDeleteCount=0}},{key:"ClearFormatMark",value:function(){this.FDeleteStartDrawItemNo=-1,this.FDeleteCount=0}}]),i}(ot);function co(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var uo=l()((function t(){r()(this,t),this.MapMode=0,this.WindowOrg=new et,this.WindowExt=new it,this.ViewportOrg=new et,this.ViewportExt=new it})),fo={Film:1,Page:2,Edit:3},mo=1,So=2,po=4,yo=0,Fo=1,vo=2,Io=l()((function t(){r()(this,t),this.Item=null,this.Rect=null})),go=function(){function t(){r()(this,t),this.FTopItems=new ot,this.Print=!1,this.ReadOnly=!1,this.ReadOnlyViewPrint=!1,this.Animation=!1,this.ViewMode=fo.Film,this.WindowWidth=0,this.WindowHeight=0,this.ScaleX=1,this.ScaleY=1,this.Zoom=1}return l()(t,[{key:"scaleCanvas",value:function(t){var e=new uo;return 1==this.ScaleX&&1==this.ScaleY?(e.MapMode=0,e):(e.ScaleX=1,e.ScaleY=1,t.scale(this.ScaleX,this.ScaleY),e)}},{key:"restoreCanvasScale",value:function(t,e){t.scale(e.ScaleX,e.ScaleY)}},{key:"getScaleX",value:function(t){return L.Round(t*this.ScaleX)}},{key:"getScaleY",value:function(t){return L.Round(t*this.ScaleY)}},{key:"drawNoScaleLine",value:function(t,e){var i=t.scaleSize;if(1!==i.x||1!==i.y){t.scale(1,1);try{t.drawLineByPointsDriect(e)}finally{t.scale(i.x,i.y)}}else t.drawLineByPointsDriect(e)}},{key:"AddTopItem",value:function(t,e){var i=new Io;i.Item=t,i.Rect=e,this.FTopItems.add(i)}},{key:"PaintTopItems",value:function(t){for(var e=0;e<this.FTopItems.count;e++)this.FTopItems[e].Item.PaintTop(t,this.FTopItems[e].Rect)}}]),t}(),Co=function(t){m()(i,t);var e=co(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).FParaNo=oo.Null,n.FStyleNo=oo.Null,n.FFirstDItemNo=-1,n.FActive=!1,n.FVisible=!0,n.FPrintInvisible=!1,n.FOptions=new q,n.FSelectState=yo,n.FormatDirection=$l.Horizontal,n.OnDblClick=null,n.OnChange=null,n}return l()(i,[{key:"DoChange",value:function(){null!==this.OnChange&&this.OnChange(this)}},{key:"GetParaFirst",value:function(){return this.FOptions.has(mo)}},{key:"SetParaFirst",value:function(t){t?this.FOptions.add(mo):this.FOptions.remove(mo)}},{key:"GetPageBreak",value:function(){return this.FOptions.has(So)}},{key:"SetPageBreak",value:function(t){t?this.FOptions.add(So):this.FOptions.remove(So)}},{key:"GetKeepParaFirst",value:function(){return this.FOptions.has(po)}},{key:"SetKeepParaFirst",value:function(t){t?this.FOptions.add(po):this.FOptions.remove(po)}},{key:"GetSelectComplate",value:function(){return this.FSelectState===vo}},{key:"GetSelectPart",value:function(){return this.FSelectState===Fo}},{key:"GetText",value:function(){return""}},{key:"SetText",value:function(t){}},{key:"GetHyperLink",value:function(){return""}},{key:"SetHyperLink",value:function(t){}},{key:"SetActive",value:function(t){this.FActive=t}},{key:"SetVisible",value:function(t){this.FVisible=t}},{key:"GetLength",value:function(){return 0}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){}},{key:"Assign",value:function(t){this.FStyleNo=t.StyleNo,this.FParaNo=t.ParaNo,this.FOptions.value=t.Options.value}},{key:"PaintTo",value:function(t,e,i,n,o,s,r,a){if(!a.Print||!this.FPrintInvisible){r.save();try{this.DoPaint(t,e,i,n,o,s,r,a)}finally{r.restore()}}}},{key:"PaintTop",value:function(t,e){}},{key:"CanConcatItems",value:function(t){return this.className===t.className&&this.FStyleNo===t.StyleNo&&this.FVisible===t.Visible}},{key:"DisSelect",value:function(){this.FSelectState=yo}},{key:"CanDrag",value:function(){return!0}},{key:"KillFocus",value:function(){}},{key:"DblClick",value:function(t,e){null!=this.OnDblClick&&this.OnDblClick()}},{key:"MouseDown",value:function(t){return this.Active=!0,this.FActive}},{key:"MouseMove",value:function(t){return this.FActive}},{key:"MouseUp",value:function(t){return this.FActive}},{key:"MouseEnter",value:function(){}},{key:"MouseLeave",value:function(){}},{key:"GetHint",value:function(){return""}},{key:"TextEffective",value:function(){return this.GetText()}},{key:"SelectComplate",value:function(){this.FSelectState=vo}},{key:"SelectPart",value:function(){this.FSelectState=Fo}},{key:"Selected",value:function(){return this.FSelectState!=yo}},{key:"AcceptAction",value:function(t,e,i){return!0}},{key:"BreakByOffset",value:function(t){var e=this.newInstance();return e.Assign(this),e.ParaFirst=!1,e}},{key:"SaveToStream",value:function(t){this.SaveToStreamRange(t,0,this.Length)}},{key:"SaveToStreamRange",value:function(t,e,i){t.writeInt32(this.FStyleNo),t.writeInt32(this.FParaNo),t.writeByte(this.FOptions.value),t.writeByte(this.FormatDirection);var n=0;this.FPrintInvisible&&(n|=128),this.FVisible||(n|=64),t.writeByte(n)}},{key:"LoadFromStream",value:function(t,e,i){if(this.FParaNo=t.readInt32(),i>25?(this.FOptions.value=t.readByte(),this.FormatDirection=i>63?t.readByte():$l.Horizontal):this.ParaFirst=t.readBoolean(),i>33){var n=t.readByte();this.FPrintInvisible=L.isOdd(n>>7),this.FVisible=!L.isOdd(n>>6)}}},{key:"ToHtml",value:function(){return""}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e='"StyleNo":'+this.StyleNo.toString();return t||(e+=',"ParaNo":'+this.ParaNo.toString()+',"Options":'+this.FOptions.value.toString()+',"PrintInvisible":'+(this.FPrintInvisible?"true":"false")+',"Visible":'+(this.Visible?"true":"false")),e}},{key:"ToJSONObject",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.ToJSONString(t);return JSON.parse("{"+e+"}")}},{key:"ParseJSONObject",value:function(t){null!=t.ParaNo&&(this.FParaNo=t.ParaNo),null!=t.KeepParaFirst&&(this.KeepParaFirst=t.KeepParaFirst),null!=t.Options?this.FOptions.value=t.Options:(null!=t.ParaFirst&&(this.ParaFirst=t.ParaFirst),null!=t.PageBreak&&(this.PageBreak=t.PageBreak)),null!=t.PrintInvisible&&(this.FPrintInvisible=t.PrintInvisible),null!=t.Visible&&(this.FVisible=t.Visible)}},{key:"Undo",value:function(t){}},{key:"Redo",value:function(t){}},{key:"Options",get:function(){return this.FOptions}},{key:"Text",get:function(){return this.GetText()},set:function(t){this.SetText(t)}},{key:"Length",get:function(){return this.GetLength()}},{key:"ParaFirst",get:function(){return this.GetParaFirst()},set:function(t){this.SetParaFirst(t)}},{key:"KeepParaFirst",get:function(){return this.GetKeepParaFirst()},set:function(t){this.SetKeepParaFirst(t)}},{key:"PageBreak",get:function(){return this.GetPageBreak()},set:function(t){this.SetPageBreak(t)}},{key:"HyperLink",get:function(){return this.GetHyperLink()},set:function(t){this.SetHyperLink(t)}},{key:"IsSelectComplate",get:function(){return this.GetSelectComplate()}},{key:"IsSelectPart",get:function(){return this.GetSelectPart()}},{key:"StyleNo",get:function(){return this.FStyleNo},set:function(t){this.FStyleNo=t}},{key:"ParaNo",get:function(){return this.FParaNo},set:function(t){this.FParaNo=t}},{key:"FirstDItemNo",get:function(){return this.FFirstDItemNo},set:function(t){this.FFirstDItemNo=t}},{key:"Active",get:function(){return this.FActive},set:function(t){this.SetActive(t)}},{key:"Visible",get:function(){return this.FVisible},set:function(t){this.SetVisible(t)}},{key:"PrintInvisible",get:function(){return this.FPrintInvisible},set:function(t){this.FPrintInvisible=t}}]),i}(tt),wo=function(t){m()(i,t);var e=co(i);function i(){return r()(this,i),e.call(this)}return l()(i)}(ot);function Ao(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Do=function(){function t(){r()(this,t),this.Stream=new ht}return l()(t,[{key:"dispose",value:function(){this.Stream.clear()}}]),t}(),Po=function(){function t(){r()(this,t),this.A=-1,this.B=-1}return l()(t,[{key:"dispose",value:function(){}}]),t}(),ko=function(t){m()(i,t);var e=Ao(i);function i(){return r()(this,i),e.call(this)}return l()(i,[{key:"Row",get:function(){return this.A},set:function(t){this.A=t}},{key:"Col",get:function(){return this.B},set:function(t){this.B=t}}]),i}(Po),xo=function(t){m()(i,t);var e=Ao(i);function i(){return r()(this,i),e.call(this)}return l()(i)}(ko),Ro=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).FCol=-1,t}return l()(i,[{key:"Col",get:function(){return this.FCol},set:function(t){this.FCol=t}},{key:"OldWidth",get:function(){return this.A},set:function(t){this.A=t}},{key:"NewWidth",get:function(){return this.B},set:function(t){this.B=t}}]),i}(Po),To=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).FRow=-1,t}return l()(i,[{key:"Row",get:function(){return this.FRow},set:function(t){this.FRow=t}},{key:"OldHeight",get:function(){return this.A},set:function(t){this.A=t}},{key:"NewHeight",get:function(){return this.B},set:function(t){this.B=t}}]),i}(Po),bo=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).FNewWidth=0,t.FNewHeight=0,t}return l()(i,[{key:"OldWidth",get:function(){return this.A},set:function(t){this.A=t}},{key:"OldHeight",get:function(){return this.B},set:function(t){this.B=t}},{key:"NewWidth",get:function(){return this.FNewWidth},set:function(t){this.FNewWidth=t}},{key:"NewHeight",get:function(){return this.FNewHeight},set:function(t){this.FNewHeight=t}}]),i}(Po),Bo=function(){function t(){r()(this,t),this.Tag=null,this.ItemNo=-1,this.Offset=-1,this.ParaFirst=!1,this.Active=!1}return l()(t,[{key:"dispose",value:function(){}}]),t}(),No=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).Text="",t}return l()(i)}(Bo),Oo=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).NextText="",t}return l()(i)}(No),_o=0,Eo=1,Mo=2,Lo=3,Go=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).Tag=rh.ItemProperty,t.ItemProperty=null,t}return l()(i)}(Bo),Ho=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).ItemProperty=_o,t.OldStyleNo=0,t.NewStyleNo=0,t}return l()(i)}(Go),Vo=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).ItemProperty=Eo,t.OldParaNo=0,t.NewParaNo=0,t}return l()(i)}(Go),Uo=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).ItemProperty=Mo,t.OldParaFirst=0,t.NewParaFirst=0,t}return l()(i)}(Go),Wo=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).ItemProperty=Lo,t.OldPageBreak=0,t.NewPageBreak=0,t}return l()(i)}(Go),zo=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).ItemStream=new ht,t}return l()(i)}(Bo),Ko=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).Tag=rh.ItemSelf,t.Object=null,t}return l()(i)}(Bo),Jo=function(t){m()(i,t);var e=Ao(i);function i(){return r()(this,i),e.call(this)}return l()(i)}(ot),jo=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).Data=null,t}return l()(i,[{key:"ActionAppend",value:function(t,e,i,n,o){var s=null;switch(t){case rh.BackDeleteText:case rh.DeleteText:case rh.InsertText:s=new No;break;case rh.SetItemText:s=new Oo;break;case rh.DeleteItem:case rh.InsertItem:case rh.ItemMirror:s=new zo;break;case rh.ItemSelf:s=new Ko;break;default:s=new Bo}return s.Tag=t,s.ItemNo=e,s.Offset=i,s.ParaFirst=n,s.Active=o,this.Actions.add(s),s}}]),i}(function(){function t(){r()(this,t),this.IsUndo=!0,this.Actions=new Jo}return l()(t,[{key:"dispose",value:function(){}}]),t}()),Yo=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).CaretDrawItemNo=-1,t}return l()(i)}(jo),Qo=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).HScrollPos=0,t.VScrollPos=0,t}return l()(i)}(Yo),Xo=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).SectionIndex=-1,t}return l()(i)}(Qo),Zo=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).ItemNo=-1,t.Offset=-1,t}return l()(i)}(Yo),qo=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).HScrollPos=0,t.VScrollPos=0,t}return l()(i)}(Zo),$o=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).SectionIndex=-1,t}return l()(i)}(qo),ts=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).ItemNo=-1,t.Offset=-1,t}return l()(i)}(Yo),es=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).HScrollPos=0,t.VScrollPos=0,t}return l()(i)}(ts),is=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).SectionIndex=-1,t}return l()(i)}(es),ns=function(t){m()(i,t);var e=Ao(i);function i(){var t;return r()(this,i),(t=e.call(this)).FSeek=-1,t.FEnable=!0,t.FEnableStateStack=new st,t.FMaxUndoCount=99,t.FGroupWorking=!1,t.FGroupBeginIndex=-1,t.FGroupEndIndex=-1,t.FOnUndoNew=null,t.FOnUndoGroupStart=null,t.FOnUndoGroupEnd=null,t.FOnUndo=null,t.FOnRedo=null,t.FOnUndoDestroy=null,t.OnSeek=null,t}return l()(i,[{key:"doSeek",value:function(t){null!==this.OnSeek&&this.OnSeek(t)}},{key:"doClear_",value:function(){f()(F()(i.prototype),"doClear_",this).call(this),this.FSeek=-1,this.FGroupBeginIndex=-1,this.FGroupEndIndex=-1,this.doSeek(-1)}},{key:"doRemoved_",value:function(t){f()(F()(i.prototype),"doRemoved_",this).call(this,t),null!=this.FOnUndoDestroy&&this.FOnUndoDestroy(t)}},{key:"DoNewUndo",value:function(t){if(this.FSeek<this.count-1&&(this.FSeek>0?(this[this.FSeek].IsUndo&&this.FSeek++,this.removeRange(this.FSeek,this.count-this.FSeek)):this.clear()),this.count>this.FMaxUndoCount&&!this.FGroupWorking){var e=0,i=-1;if(this[0]instanceof Zo){for(var n=1;n<=this.count-1;n++)if(this[n]instanceof ts){if(0==e){i=n;break}e--}else this[n]instanceof Zo&&e++;this.removeRange(0,i+1)}else this.removeAt(0)}this.add(t),this.FSeek=this.count-1,this.doSeek(this.FSeek)}},{key:"UndoGroupBegin",value:function(t,e){this.FGroupWorking=!0;var i=null;(i=null!=this.FOnUndoGroupStart?this.FOnUndoGroupStart(t,e):new Zo).ItemNo=t,i.Offset=e,this.DoNewUndo(i)}},{key:"UndoGroupEnd",value:function(t,e){if(this.last instanceof Zo)this.last instanceof Zo&&this.delete(this.count-1);else{var i=null;(i=null!=this.FOnUndoGroupEnd?this.FOnUndoGroupEnd(t,e):new ts).ItemNo=t,i.Offset=e,this.DoNewUndo(i)}this.FGroupWorking=!1}},{key:"UndoNew",value:function(){var t=null;return t=null!=this.FOnUndoNew?this.FOnUndoNew():new jo,this.DoNewUndo(t),t}},{key:"DoSeekUndoEx",value:function(t){return null!=this.FOnUndo&&this.FOnUndo(this[t]),this[t].IsUndo=!1,t--,this.doSeek(t),t}},{key:"Undo",value:function(){if(this.FSeek>=0){var t=0,e=-1;if(this[this.FSeek]instanceof ts){t=0,e=0;for(var i=this.FSeek-1;i>=0;i--)if(this[i]instanceof Zo){if(0==t){e=i;break}t--}else this[i]instanceof ts&&t++;this.FGroupBeginIndex=e,this.FGroupEndIndex=this.FSeek;try{for(this.FGroupWorking=!0;this.FSeek>=e;)this.FSeek==e&&(this.FGroupWorking=!1),this.FSeek=this.DoSeekUndoEx(this.FSeek)}finally{this.FGroupWorking=!1,this.FGroupBeginIndex=-1,this.FGroupEndIndex=-1}}else this.FSeek=this.DoSeekUndoEx(this.FSeek)}}},{key:"DoSeekRedoEx",value:function(t){return t++,null!=this.FOnRedo&&this.FOnRedo(this[t]),this[t].IsUndo=!0,this.doSeek(t),t}},{key:"Redo",value:function(){if(this.FSeek<this.count-1){var t=-1,e=-1;if(this[this.FSeek+1]instanceof Zo){t=0,e=this.count-1;for(var i=this.FSeek+2;i<=this.count-1;i++)if(this[i]instanceof ts){if(0==t){e=i;break}t--}else this[i]instanceof Zo&&t++;this.FGroupBeginIndex=this.FSeek+1,this.FGroupEndIndex=e;try{for(this.FGroupWorking=!0;this.FSeek<e;)this.FSeek==e-1&&(this.FGroupWorking=!1),this.FSeek=this.DoSeekRedoEx(this.FSeek)}finally{this.FGroupWorking=!1,this.FGroupBeginIndex=-1,this.FGroupEndIndex=-1}}else this.FSeek=this.DoSeekRedoEx(this.FSeek)}}},{key:"SaveState",value:function(){this.FEnableStateStack.push(this.FEnable)}},{key:"RestoreState",value:function(){this.FEnableStateStack.count>0&&(this.FEnable=this.FEnableStateStack.pop())}},{key:"Enable",get:function(){return this.FEnable},set:function(t){this.FEnable=t}},{key:"MaxUndoCount",get:function(){return this.FMaxUndoCount},set:function(t){this.FMaxUndoCount=t}},{key:"Seek",get:function(){return this.FSeek}},{key:"GroupWorking",get:function(){return this.FGroupWorking}},{key:"CurGroupBeginIndex",get:function(){return this.FGroupBeginIndex}},{key:"CurGroupEndIndex",get:function(){return this.FGroupEndIndex}},{key:"OnUndoNew",get:function(){return this.FOnUndoNew},set:function(t){this.FOnUndoNew=t}},{key:"OnUndoGroupStart",get:function(){return this.FOnUndoGroupStart},set:function(t){this.FOnUndoGroupStart=t}},{key:"OnUndoGroupEnd",get:function(){return this.FOnUndoGroupEnd},set:function(t){this.FOnUndoGroupEnd=t}},{key:"OnUndoDestroy",get:function(){return this.FOnUndoDestroy},set:function(t){this.FOnUndoDestroy=t}},{key:"OnUndo",get:function(){return this.FOnUndo},set:function(t){this.FOnUndo=t}},{key:"OnRedo",get:function(){return this.FOnRedo},set:function(t){this.FOnRedo=t}}]),i}(ot);function os(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var ss=function(t){m()(i,t);var e=os(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FOwnerData=n,o.FWidth=100,o.FHeight=50,o.ParaNo=n.CurParaNo,o.FOnGetMainUndoList=n.OnGetUndoList,o.FTextWrapping=!1,o.FIsFormatDirty=!1,o.FCanPageBreak=!1,o.FMangerUndo=!1,o.FMouseIn=!1,o.FVersion=o.GetLastVersion(),o}return l()(i,[{key:"GetLastVersion",value:function(){return 0}},{key:"GetWidth",value:function(){return this.FWidth}},{key:"SetWidth",value:function(t){this.FWidth=t}},{key:"GetHeight",value:function(){return this.FHeight}},{key:"SetHeight",value:function(t){this.FHeight=t}},{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.OwnerData.Change()}},{key:"DoItemChange",value:function(t,e){this.OwnerData.ItemChange(this,t,e)}},{key:"SelfUndoListInitializate",value:function(t){var e=this;t.OnUndoNew=function(){return e.DoSelfUndoNew()},t.OnUndo=function(t){e.DoSelfUndo(t)},t.OnRedo=function(t){e.DoSelfRedo(t)},t.OnUndoDestroy=function(t){e.DoSelfUndoDestroy(t)}}},{key:"SelfUndo_New",value:function(){var t=this.GetSelfUndoList();null!==t&&t.Enable&&t.UndoNew()}},{key:"GetSelfUndoList",value:function(){if(null==this.FOnGetMainUndoList)return null;var t=this.FOnGetMainUndoList();if(null!=t&&t.Enable&&t.count>0&&t.last.Actions.count>0&&t.last.Actions.last instanceof Ko){var e=t.last.Actions.last;null==e.Object&&(e.Object=new ns,this.SelfUndoListInitializate(e.Object)),t=e.Object}return t}},{key:"DoSelfUndoDestroy",value:function(t){null!=t.Data&&(t.Data.dispose(),t.Data=null)}},{key:"DoSelfUndoNew",value:function(){return new jo}},{key:"DoSelfUndo",value:function(t){}},{key:"DoSelfRedo",value:function(t){}},{key:"GetPageBreakCount",value:function(){return 0}},{key:"ApplySelectParaStyle",value:function(t,e){}},{key:"MatchTextStyle",value:function(t,e){return!1}},{key:"ApplySelectTextStyle",value:function(t,e){}},{key:"ApplyContentAlign",value:function(t){}},{key:"FormatToDrawItem",value:function(t,e){}},{key:"ClearFormatExtraHeight",value:function(){return 0}},{key:"ReFormatActiveItem",value:function(){}},{key:"ReFormatActiveDomain",value:function(){}},{key:"ReFormatRequest",value:function(){this.FormatDirty(),this.OwnerData.ItemReFormatRequest(this)}},{key:"ReCaretRequest",value:function(){this.OwnerData.ItemSetCaretRequestEx(this,Yl.OffsetInner)}},{key:"ActiveItemReAdaptEnvironment",value:function(){}},{key:"DeleteSelected",value:function(){return!1}},{key:"InsertAnnotate",value:function(t,e,i){return!1}},{key:"DeleteActiveAnnotate",value:function(){return!1}},{key:"DeleteActiveDomain",value:function(){return!1}},{key:"DeleteActiveDataItems",value:function(t,e,i){}},{key:"SetActiveItemText",value:function(t){}},{key:"MarkStyleUsed",value:function(t){}},{key:"SaveSelectToStream",value:function(t){}},{key:"SaveSelectToText",value:function(){return""}},{key:"SelectToHtml",value:function(){return""}},{key:"GetActiveItem",value:function(){return this}},{key:"GetTopLevelItem",value:function(){return this}},{key:"GetTopLevelDrawItem",value:function(){return null}},{key:"GetTopLevelDrawItemCoord",value:function(){return et.Create(-1,-1)}},{key:"GetTopLevelRectDrawItem",value:function(){return null}},{key:"GetTopLevelRectDrawItemCoord",value:function(){return et.Create(-1,-1)}},{key:"GetTopLevelRectItem",value:function(){return null}},{key:"GetOffsetAt",value:function(t){return t<=0?Yl.OffsetBefor:t>=this.Width?Yl.OffsetAfter:Yl.OffsetInner}},{key:"CoordInSelect",value:function(t,e){return!!this.IsSelectComplate&&nt.Create(0,0,this.FWidth,this.FHeight).pointInAt(t,e)}},{key:"WantKeyDown",value:function(t){return!1}},{key:"JustifySplit",value:function(){return!0}},{key:"GetCaretInfo",value:function(t){t.Visible=!1}},{key:"GetPageBreakHeight",value:function(t){return this.OwnerData.DrawItems[this.FirstDItemNo].rect.height}},{key:"CheckFormatPageBreakBefor",value:function(){}},{key:"CheckFormatPageBreak",value:function(t,e,i,n,o,s,r,a,l){return r=-1,a=0,l=0,this.FCanPageBreak?(r=this.Height-s-(o-e),i>o&&(l=o-i)):(r=0,i>o&&(a=o-e)),{breakSeat:r,fmtOffset:a,fmtHeightInc:l}}},{key:"CheckPageSurplus",value:function(t){return 0}},{key:"InsertItem",value:function(t){return!1}},{key:"InsertText",value:function(t){return!1}},{key:"InsertGraphic",value:function(t,e){return!1}},{key:"InsertStream",value:function(t,e,i){return!1}},{key:"InsertJSONObject",value:function(t){return!1}},{key:"PasteRectPart",value:function(t,e,i,n){return!1}},{key:"SaveToPartStream",value:function(t){t.writeByte(lh.Custom)}},{key:"LoadFromPartStream",value:function(t,e,i){}},{key:"KeyDown",value:function(t){t.Handled=!0}},{key:"KeyPress",value:function(t){}},{key:"IsSelectComplateTheory",value:function(){return this.IsSelectComplate||this.Active}},{key:"SelectExists",value:function(){return!1}},{key:"Search",value:function(t,e,i){return!1}},{key:"Clear",value:function(){}},{key:"GetActiveData",value:function(){return null}},{key:"GetTopLevelDataAt",value:function(t,e){return null}},{key:"GetTopLevelData",value:function(){return null}},{key:"FormatDirty",value:function(){this.FIsFormatDirty=!0,this.OwnerData.FormatDirty()}},{key:"TraverseItem",value:function(t){}},{key:"SaveToImage",value:function(t){if(0===this.FWidth||0===this.FHeight)return null;var e=new go;e.Print=!0,e.WindowWidth=this.FWidth,e.WindowHeight=this.FHeight,e.ScaleX=1,e.ScaleY=1,e.Zoom=1;var i=null,n=zt.CreateTemp(this.hcl,this.FWidth,this.FHeight);try{n.clear(0,0,this.FWidth,this.FHeight),this.DoPaint(this.OwnerData.Style,nt.Create(0,0,this.FWidth,this.FHeight),0,this.FHeight,0,this.FHeight,n,e),i=n.toImage(t)}finally{zt.DestroyTemp(n)}return i}},{key:"SetActive",value:function(t){f()(F()(i.prototype),"SetActive",this).call(this,t),this.FActive||(this.FMouseIn=!1)}},{key:"SetCanPageBreak",value:function(t){this.FCanPageBreak!==t&&(this.FCanPageBreak=t,this.CheckFormatPageBreakBefor())}},{key:"MouseEnter",value:function(){this.FMouseIn=!0,f()(F()(i.prototype),"MouseEnter",this).call(this)}},{key:"MouseLeave",value:function(){this.FMouseIn=!1,f()(F()(i.prototype),"MouseLeave",this).call(this)}},{key:"MouseDown",value:function(t){return this.Active=nt.CreateByBounds(0,0,this.FWidth,this.FHeight).pointInAt(t.x,t.y),this.Active}},{key:"BreakByOffset",value:function(t){return null}},{key:"CanConcatItems",value:function(t){return!1}},{key:"DoPaintBackground",value:function(t,e,i,n,o,s,r,a){}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){this.DoPaintBackground(t,e,n,o,s,r,a,l),f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FWidth=t.Width,this.FHeight=t.Height,this.FVersion=t.FVersion}},{key:"Undo",value:function(t){if(t instanceof Ko){var e=t.Object;null!==e?e.Undo():f()(F()(i.prototype),"Undo",this).call(this,t)}else f()(F()(i.prototype),"Undo",this).call(this,t)}},{key:"Redo",value:function(t){if(t instanceof Ko){var e=t.Object;null!==e?(e.Seek<0&&this.SelfUndoListInitializate(e),e.Redo()):f()(F()(i.prototype),"Redo",this).call(this,t)}else f()(F()(i.prototype),"Redo",this).call(this,t)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),this.FVersion=this.GetLastVersion(),t.writeByte(this.FVersion);var o=0;this.FCanPageBreak&&(o|=128),t.writeByte(o),t.writeInt32(this.FWidth),t.writeInt32(this.FHeight)}},{key:"LoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FVersion=n>62?t.readByte():0,this.FVersion>this.GetLastVersion()){var o="请使用"+this.FVersion.toString()+"或以上版本打开"+this.className+"对象！";throw alert(o),o}if(n>67){var s=t.readByte();this.FCanPageBreak=L.isOdd(s>>7)}this.FWidth=t.readInt32(),this.FHeight=t.readInt32(),this.FormatDirty()}},{key:"ToHtml",value:function(){var t=this.SaveToImage();return t?'<img width="'+this.FWidth.toString()+'" height="'+this.FHeight.toString()+'" src="'+t+'" alt="'+this.className+'" />':""}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t),t.SetAttribute("width",this.FWidth.toString()),t.SetAttribute("height",this.FHeight.toString())}},{key:"ParseXml",value:function(t){}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=f()(F()(i.prototype),"ToJSONString",this).call(this,t);return t||(e+=',"Width":'+this.FWidth.toString()+',"Height":'+this.FHeight.toString()+',"Version":'+this.GetLastVersion().toString()),e}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.Version&&(this.FVersion=t.Version),null!=t.Width&&(this.FWidth=t.Width),null!=t.Height&&(this.FHeight=t.Height)}},{key:"GetLength",value:function(){return 1}},{key:"Width",get:function(){return this.GetWidth()},set:function(t){this.SetWidth(t)}},{key:"Height",get:function(){return this.GetHeight()},set:function(t){this.SetHeight(t)}},{key:"TextWrapping",get:function(){return this.FTextWrapping},set:function(t){this.FTextWrapping=t}},{key:"IsFormatDirty",get:function(){return this.FIsFormatDirty},set:function(t){this.FIsFormatDirty=t}},{key:"CanPageBreak",get:function(){return this.FCanPageBreak},set:function(t){this.SetCanPageBreak(t)}},{key:"PageBreakCount",get:function(){return this.GetPageBreakCount()}},{key:"OwnerData",get:function(){return this.FOwnerData}},{key:"MangerUndo",get:function(){return this.FMangerUndo}}],[{key:"Create",value:function(t,e,n,o){var s=new i(t,e);return s.Width=n,s.Height=o,s}}]),i}(Co),rs=function(t){m()(i,t);var e=os(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).StyleNo=oo.Domain,o.FMarkType=ch.Beg,o.FLevel=0,o.Width=0,o.Height=n.Style.TextStyles[0].FontHeight,o.Empty=!0,o}return l()(i,[{key:"GetInnerText",value:function(){return this.OwnerData.GetDomainText(this)}},{key:"SetInnerText",value:function(t){this.OwnerData.SetDomainText(this,t)}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l),l.Print||l.ReadOnly&&l.ReadOnlyViewPrint||l.AddTopItem(this,e)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FMarkType=t.MarkType,this.FLevel=t.Level,this.Empty=t.Empty}},{key:"BeginMark",value:function(){return this.FMarkType===ch.Beg}},{key:"Clear",value:function(){this.FMarkType===ch.Beg&&this.OwnerData.ClearDomain(this)}},{key:"EndMark",value:function(){return this.FMarkType===ch.End}},{key:"GetOffsetAt",value:function(t){return t>=0&&t<=this.Width?this.FMarkType===ch.Beg?Yl.OffsetAfter:Yl.OffsetBefor:f()(F()(i.prototype),"GetOffsetAt",this).call(this,t)}},{key:"JustifySplit",value:function(){return!1}},{key:"FormatToDrawItem",value:function(t,e){if(this.Width=0,this.Height=t.Style.TextStyles[0].FontHeight,this.Empty=!1,this.MarkType===ch.Beg)if(e<t.Items.count-1){var i=t.Items[e+1];i.StyleNo===this.StyleNo&&i.MarkType===ch.End?(this.Width=10,this.Empty=!0):i.ParaFirst?this.Width=10:i.StyleNo>oo.Null&&(this.Height=t.Style.TextStyles[i.StyleNo].FontHeight)}else this.Width=10;else{var n=t.Items[e-1];n.StyleNo===this.StyleNo&&n.MarkType===ch.Beg?(this.Width=10,this.Empty=!0):this.ParaFirst?this.Width=10:n.StyleNo>oo.Null&&(this.Height=t.Style.TextStyles[n.StyleNo].FontHeight)}}},{key:"PaintTop",value:function(t,e){f()(F()(i.prototype),"PaintTop",this).call(this,t,e),t.pen.width=1,this.FMarkType===ch.Beg?(t.pen.width=1,t.pen.style=_t.Solid,t.pen.color=Ft.Blue,t.drawLineByPointsDriect(new Array(et.Create(e.left+3,e.top-1),et.Create(e.left,e.top-1),et.Create(e.left,e.bottom+1))),t.moveTo(e.left,e.bottom+1),t.lineTo(e.left+3,e.bottom+1)):(t.pen.width=1,t.pen.style=_t.Solid,t.pen.color=Ft.Blue,t.drawLineByPointsDriect(new Array(et.Create(e.right-3,e.top-1),et.Create(e.right,e.top-1),et.Create(e.right,e.bottom+1))),t.moveTo(e.right,e.bottom+1),t.lineTo(e.right-3,e.bottom+1))}},{key:"SaveToBitmap",value:function(t){return!1}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),t.writeByte(this.FMarkType),t.writeByte(this.FLevel)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FMarkType=t.readByte(),n>38&&(this.FLevel=t.readByte())}},{key:"ToXml",value:function(t){}},{key:"ParseXml",value:function(t){}},{key:"GetTextStyleNo",value:function(){return this.OwnerData.Style.GetDefaultStyleNo()}},{key:"FormatOffset",value:function(){return 0}},{key:"InnerText",get:function(){return this.GetInnerText()},set:function(t){this.SetInnerText(t)}},{key:"MarkType",get:function(){return this.FMarkType},set:function(t){this.FMarkType=t}},{key:"Level",get:function(){return this.FLevel},set:function(t){this.FLevel=t}}],[{key:"IsBeginMark",value:function(t){return t.StyleNo===oo.Domain&&t.MarkType===ch.Beg}},{key:"IsEndMark",value:function(t){return t.StyleNo===oo.Domain&&t.MarkType===ch.End}}]),i}(ss),as={Left:0,Center:1,Right:2},ls={Top:0,Center:1,Bottom:2},hs=function(t){m()(i,t);var e=os(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FMouseLBDowning=!1,o.FOutSelectInto=!1,o.FTextStyleNo=0,n.CurStyleNo>oo.Null&&(o.FTextStyleNo=n.CurStyleNo),o}return l()(i,[{key:"SetTextStyleNo",value:function(t){this.FTextStyleNo!=t&&(this.FTextStyleNo=t)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FTextStyleNo=t.TextStyleNo}},{key:"SetSelect",value:function(t){return!1}},{key:"GetOffsetAt",value:function(t){return this.FOutSelectInto?t<this.Width/2?Yl.OffsetBefor:Yl.OffsetAfter:f()(F()(i.prototype),"GetOffsetAt",this).call(this,t)}},{key:"JustifySplit",value:function(){return!1}},{key:"MatchTextStyle",value:function(t,e){return e.Append=!e.StyleHasMatch(t,this.FTextStyleNo),!0}},{key:"ApplySelectTextStyle",value:function(t,e){this.SetTextStyleNo(e.GetMatchStyleNo(this.hcl,t,this.FTextStyleNo))}},{key:"MarkStyleUsed",value:function(t){t?this.OwnerData.Style.TextStyles[this.FTextStyleNo].CheckSaveUsed=!0:this.FTextStyleNo=this.OwnerData.Style.TextStyles[this.FTextStyleNo].TempNo}},{key:"SelectExists",value:function(){return this.GetSelectComplate()}},{key:"MouseDown",value:function(t){return this.FMouseLBDowning=t.button===ae,this.FOutSelectInto=!1,f()(F()(i.prototype),"MouseDown",this).call(this,t)}},{key:"MouseMove",value:function(t){return this.FMouseLBDowning||t.button!==ae||(this.FOutSelectInto=!0),f()(F()(i.prototype),"MouseMove",this).call(this,t)}},{key:"MouseUp",value:function(t){return this.FMouseLBDowning=!1,this.FOutSelectInto=!1,f()(F()(i.prototype),"MouseUp",this).call(this,t)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),t.writeInt32(this.FTextStyleNo)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FTextStyleNo=t.readInt32(),this.OwnerData.Style.MergeStyle?this.FTextStyleNo=null!==e?this.OwnerData.Style.GetStyleNo(e.TextStyles[this.FTextStyleNo],!0):this.OwnerData.Style.GetDefaultStyleNo():null!=e&&this.FTextStyleNo>e.TextStyles.count-1&&(this.FTextStyleNo=0)}},{key:"ToXml",value:function(t){}},{key:"ParseXml",value:function(t){}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Text":"'+this.Text+'"'}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.TextStyleNo&&(this.TextStyleNo=t.TextStyleNo)}},{key:"TextStyleNo",get:function(){return this.FTextStyleNo},set:function(t){this.SetTextStyleNo(t)}}]),i}(ss),cs=function(t){m()(i,t);var e=os(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FAutoSize=!0,o.FEnabled=!0,o.FPaddingLeft=5,o.FPaddingRight=5,o.FPaddingTop=5,o.FPaddingBottom=5,o.FMinWidth=20,o.FMinHeight=10,o.Tag=0,o.OnClick=null,o.OnKeyDown=null,o.OnKeyPress=null,o}return l()(i,[{key:"DoClick",value:function(){null!=this.OnClick&&this.OwnerData.CanEdit()&&this.OnClick()}},{key:"KeyDown",value:function(t){null!=this.OnKeyDown&&this.OnKeyDown(t)}},{key:"MouseUp",value:function(t){return t.button==ae&&this.FEnabled&&this.ClientRect().pointInAt(t.x,t.y)&&this.DoClick(),f()(F()(i.prototype),"MouseUp",this).call(this,t)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FAutoSize=t.AutoSize,this.FEnabled=t.Enabled}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FAutoSize&&(o|=128),this.FEnabled&&(o|=64),t.writeByte(o),t.writeInt32(this.Tag),t.writeByte(this.FPaddingLeft),t.writeByte(this.FPaddingTop),t.writeByte(this.FPaddingRight),t.writeByte(this.FPaddingBottom),t.writeInt32(this.FMinWidth),t.writeInt32(this.FMinHeight)}},{key:"LoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),n<51)this.FAutoSize=t.readBoolean();else{var o=t.readByte();this.FAutoSize=L.isOdd(o>>7),this.FEnabled=L.isOdd(o>>6),this.Tag=n>53?t.readInt32():0,n>64&&(this.FPaddingLeft=t.readByte(),this.FPaddingTop=t.readByte(),this.FPaddingRight=t.readByte(),this.FPaddingBottom=t.readByte(),this.FMinWidth=t.readInt32(),this.FMinHeight=t.readInt32())}}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.AutoSize&&(this.FAutoSize=t.AutoSize),null!=t.Enabled&&(this.FEnabled=t.Enabled)}},{key:"ClientRect",value:function(){return nt.Create(0,0,this.Width,this.Height)}},{key:"AutoSize",get:function(){return this.FAutoSize},set:function(t){this.FAutoSize=t}},{key:"Enabled",get:function(){return this.FEnabled},set:function(t){this.FEnabled=t}},{key:"PaddingLeft",get:function(){return this.FPaddingLeft},set:function(t){this.FPaddingLeft=t}},{key:"PaddingTop",get:function(){return this.FPaddingTop},set:function(t){this.FPaddingTop=t}},{key:"PaddingRight",get:function(){return this.FPaddingRight},set:function(t){this.FPaddingRight=t}},{key:"PaddingBottom",get:function(){return this.FPaddingBottom},set:function(t){this.FPaddingBottom=t}}]),i}(hs),us=0,fs=1,ds=2,ms=3,Ss=4,ps=5,ys=6,Fs=7,vs=8,Is=function(t){m()(i,t);var e=os(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FCanResize=!0,o.FGripSize=8,o.FResizing=!1,o.FResizeWidth=0,o.FResizeHeight=0,o.FResizeX=0,o.FResizeY=0,o}return l()(i,[{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FCanResize=t.CanResize}},{key:"GetGripType",value:function(t,e){var i=et.Create(t,e);return nt.CreateByBounds(0,0,this.GripSize,this.GripSize).pointIn(i)?fs:nt.CreateByBounds(this.Width-this.GripSize,0,this.GripSize,this.GripSize).pointIn(i)?ds:nt.CreateByBounds(0,this.Height-this.GripSize,this.GripSize,this.GripSize).pointIn(i)?ms:nt.CreateByBounds(this.Width-this.GripSize,this.Height-this.GripSize,this.GripSize,this.GripSize).pointIn(i)?Ss:us}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){if(f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l),!l.Print&&this.Active){if(this.Resizing){var h;switch(this.FResizeGrip){case fs:h=nt.CreateByBounds(e.left+this.Width-this.FResizeWidth,e.top+this.Height-this.FResizeHeight,this.FResizeWidth,this.FResizeHeight);break;case ds:h=nt.CreateByBounds(e.left,e.top+this.Height-this.FResizeHeight,this.FResizeWidth,this.FResizeHeight);break;case ms:h=nt.CreateByBounds(e.left+this.Width-this.FResizeWidth,e.top,this.FResizeWidth,this.FResizeHeight);break;case Ss:h=nt.CreateByBounds(e.left,e.top,this.FResizeWidth,this.FResizeHeight);break;default:h=new nt}l.AddTopItem(this,h)}this.AllowResize&&(a.brush.color=Ft.Gray,a.fillRect(nt.CreateByBounds(e.left,e.top,this.GripSize,this.GripSize)),a.fillRect(nt.CreateByBounds(e.right-this.GripSize,e.top,this.GripSize,this.GripSize)),a.fillRect(nt.CreateByBounds(e.left,e.bottom-this.GripSize,this.GripSize,this.GripSize)),a.fillRect(nt.CreateByBounds(e.right-this.GripSize,e.bottom-this.GripSize,this.GripSize,this.GripSize)))}}},{key:"MouseDown",value:function(t){this.FResizeGrip=us;var e=f()(F()(i.prototype),"MouseDown",this).call(this,t);return this.Active&&this.AllowResize&&(this.FResizeGrip=this.GetGripType(t.x,t.y),this.FResizing=this.FResizeGrip!=us,this.FResizing&&(this.FResizeX=t.x,this.FResizeY=t.y,this.FResizeWidth=this.Width,this.FResizeHeight=this.Height)),e}},{key:"SelfUndo_Resize",value:function(t,e){var i=this.GetSelfUndoList();if(null!=i&&i.Enable){this.SelfUndo_New();var n=i.last;if(null!==n){var o=new bo;o.OldWidth=this.Width,o.OldHeight=this.Height,o.NewWidth=t,o.NewHeight=e,n.Data=o}}}},{key:"DoSelfUndoDestroy",value:function(t){null!==t.Data&&t.Data instanceof bo&&(t.Data.dispose(),t.Data=null),f()(F()(i.prototype),"DoSelfUndoDestroy",this).call(this,t)}},{key:"DoSelfUndo",value:function(t){if(t.Data)if(t.Data instanceof bo){var e=t.Data;this.Width=e.OldWidth,this.Height=e.OldHeight}else f()(F()(i.prototype),"DoSelfUndo",this).call(this,t);else f()(F()(i.prototype),"DoSelfUndo",this).call(this,t)}},{key:"DoSelfRedo",value:function(t){if(t.Data)if(t.Data instanceof bo){var e=t.Data;this.Width=e.NewWidth,this.Height=e.NewHeight}else f()(F()(i.prototype),"DoSelfRedo",this).call(this,t);else f()(F()(i.prototype),"DoSelfRedo",this).call(this,t)}},{key:"GetResizing",value:function(){return this.FResizing}},{key:"SetResizing",value:function(t){this.FResizing!=t&&(this.FResizing=t)}},{key:"GetAllowResize",value:function(){return this.FCanResize&&this.OwnerData.CanEditItem(this.OwnerData,this)}},{key:"ResizeGrip",get:function(){return this.FResizeGrip}},{key:"CoordInSelect",value:function(t,e){return this.SelectExists()&&nt.CreateByBounds(0,0,this.Width,this.Height).pointInAt(t,e)&&this.GetGripType(t,e)==us}},{key:"PaintTop",value:function(t,e){f()(F()(i.prototype),"PaintTop",this).call(this,t,e),this.FResizing&&(t.brush.style=Mt.Clear,t.rectangleRect(e),t.brush.color=Ft.White,t.font.size=8,t.font.color=Ft.Black,t.font.styles.value=0,t.textOut(e.left+2,e.top+2,this.FResizeWidth+" x "+this.FResizeHeight))}},{key:"MouseMove",value:function(t){var e=f()(F()(i.prototype),"MouseMove",this).call(this,t);if(this.OwnerData.Style.Cursor=Se,this.Active&&this.AllowResize){var n=0,o=0,s=0,r=0,a=0;if(this.FResizing)switch(a=this.Width/this.Height,n=t.x-this.FResizeX,o=t.y-this.FResizeY,this.FResizeGrip){case fs:s=L.Round(o*a),r=L.Round(n/a),s>n?o=r:n=s,this.FResizeWidth=this.Width-n,this.FResizeHeight=this.Height-o;break;case ds:s=Math.abs(L.Round(o*a)),r=Math.abs(L.Round(n/a)),n<0?o>r?o=r:n=o>0?-s:s:-o<r?o=-r:n=s,this.FResizeWidth=this.Width+n,this.FResizeHeight=this.Height-o;break;case ms:s=Math.abs(L.Round(o*a)),r=Math.abs(L.Round(n/a)),n<0?o<r?o=r:n=-s:n>s||o>r?n=o<0?s:-s:o=-r,this.FResizeWidth=this.Width-n,this.FResizeHeight=this.Height+o;break;case Ss:s=L.Round(o*a),r=L.Round(n/a),s>n?n=s:o=r,this.FResizeWidth=this.Width+n,this.FResizeHeight=this.Height+o}else switch(this.GetGripType(t.x,t.y)){case fs:case Ss:this.OwnerData.Style.Cursor=ke;break;case ds:case ms:this.OwnerData.Style.Cursor=De;break;case ps:case Fs:this.OwnerData.Style.Cursor=xe;break;case ys:case vs:this.OwnerData.Style.Cursor=Pe}}return e}},{key:"MouseUp",value:function(t){var e=f()(F()(i.prototype),"MouseUp",this).call(this,t);if(this.FResizing){if(this.FResizeWidth<0||this.FResizeHeight<0)return this.FResizing=!1,e;this.SelfUndo_Resize(this.FResizeWidth,this.FResizeHeight),this.Width=this.FResizeWidth,this.Height=this.FResizeHeight,this.FResizing=!1}return e}},{key:"CanDrag",value:function(){return!this.FResizing}},{key:"SelectExists",value:function(){return this.IsSelectComplateTheory()}},{key:"IsSelectComplateTheory",value:function(){return!!this.AllowResize&&f()(F()(i.prototype),"IsSelectComplateTheory",this).call(this)}},{key:"GetOffsetAt",value:function(t){return this.AllowResize?f()(F()(i.prototype),"GetOffsetAt",this).call(this,t):t<this.Width/2?Yl.OffsetBefor:Yl.OffsetAfter}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),t.writeBoolean(this.FCanResize)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),n>44&&(this.FCanResize=t.readBoolean())}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t),t.SetAttribute("canresize",this.FCanResize.toString())}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t),this.FCanResize=t.GetAttribute("canresize")}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.CanResize&&(this.FCanResize=t.CanResize)}},{key:"RestrainSize",value:function(t,e){}},{key:"GripSize",get:function(){return this.FGripSize},set:function(t){this.FGripSize=t}},{key:"Resizing",get:function(){return this.GetResizing()},set:function(t){this.SetResizing(t)}},{key:"ResizeWidth",get:function(){return this.FResizeWidth}},{key:"ResizeHeight",get:function(){return this.FResizeHeight}},{key:"CanResize",get:function(){return this.FCanResize},set:function(t){this.FCanResize=t}},{key:"AllowResize",get:function(){return this.GetAllowResize()}}],[{key:"Create",value:function(t,e,n,o){var s=new i(t,e);return s.Width=n,s.Height=o,s.CanResize=!0,s.GripSize=8,s}}]),i}(ss),gs=function(t){m()(i,t);var e=os(i);function i(t,n){return r()(this,i),e.call(this,t,n)}return l()(i,[{key:"GetOffsetAt",value:function(t){return t<this.Width/2?Yl.OffsetBefor:Yl.OffsetAfter}}]),i}(ss),Cs=function(t){m()(i,t);var e=os(i);function i(t,n){return r()(this,i),e.call(this,t,n)}return l()(i,[{key:"DoChange",value:function(){this.FormatDirty(),f()(F()(i.prototype),"DoChange",this).call(this)}},{key:"GetTextStyleNo",value:function(){return this.OwnerData.Style.GetDefaultStyleNo()}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)}}]),i}(Is);function ws(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}rs.HCDefaultDomainItemClass=rs;var As=function(t){m()(i,t);var e=ws(i);function i(t){var n;if(r()(this,i),(n=e.call(this,t)).constructor.prototype===i.prototype)throw"THCStyleMatch类为抽象类，不可直接实例使用！";if("function"!=typeof n.DoMatchCur)throw n.prototype+" 没有实现DoMatchCur方法！";if("function"!=typeof n.DoMatchNew)throw n.prototype+" 没有实现DoMatchNew方法！";return n.FAppend=!1,n.FLock=!1,n.FOnTextStyle=null,n}return l()(i,[{key:"SetAppend",value:function(t){this.FAppend==t||this.FLock||(this.FAppend=t),this.FLock=!0}},{key:"GetMatchStyleNo",value:function(t,e,i){if(this.DoMatchCur(e.TextStyles[i]))return i;var n=new zn(t);return n.AssignEx(e.TextStyles[i]),this.DoMatchNew(n),null!==this.FOnTextStyle&&this.FOnTextStyle(i,n),e.GetStyleNo(n,!0)}},{key:"StyleHasMatch",value:function(t,e){return!1}},{key:"Append",get:function(){return this.FAppend},set:function(t){this.SetAppend(t)}},{key:"OnTextStyle",get:function(){return this.FOnTextStyle},set:function(t){this.FOnTextStyle=t}}]),i}(tt),Ds=function(t){m()(i,t);var e=ws(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).FontStyle=0,n}return l()(i,[{key:"DoMatchCur",value:function(t){return this.Append&&t.FontStyles.has(this.FontStyle)}},{key:"DoMatchNew",value:function(t){this.Append?(this.FontStyle===Wn.Superscript?t.FontStyles.remove(Wn.Subscript):this.FontStyle===Wn.Subscript&&t.FontStyles.remove(Wn.Superscript),t.FontStyles.add(this.FontStyle)):t.FontStyles.remove(this.FontStyle)}},{key:"StyleHasMatch",value:function(t,e){return t.TextStyles[e].FontStyles.has(this.FontStyle)}}]),i}(As),Ps=function(t){m()(i,t);var e=ws(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).FontName="",n}return l()(i,[{key:"DoMatchCur",value:function(t){return t.Family===this.FontName}},{key:"DoMatchNew",value:function(t){t.Family=this.FontName}}]),i}(As),ks=function(t){m()(i,t);var e=ws(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).FontSize=10,n}return l()(i,[{key:"DoMatchCur",value:function(t){return t.Size===this.FontSize}},{key:"DoMatchNew",value:function(t){t.Size=this.FontSize}}]),i}(As),xs=function(t){m()(i,t);var e=ws(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).Color=Ft.Black,n}return l()(i,[{key:"DoMatchCur",value:function(t){return this.hcl.sameColor(t.Color,this.Color)}},{key:"DoMatchNew",value:function(t){t.Color=this.Color}}]),i}(As),Rs=function(t){m()(i,t);var e=ws(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).Color=Ft.White,n}return l()(i,[{key:"DoMatchCur",value:function(t){return this.hcl.sameColor(t.BackColor,this.Color)}},{key:"DoMatchNew",value:function(t){t.BackColor=this.Color}}]),i}(As),Ts=function(t){m()(i,t);var e=ws(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).StyleNo=0,n}return l()(i,[{key:"DoMatchCur",value:function(t){return!1}},{key:"DoMatchNew",value:function(t){}},{key:"GetMatchStyleNo",value:function(t,e,i){return this.StyleNo}},{key:"StyleHasMatch",value:function(t,e){return!1}}]),i}(As),bs=function(){function t(){if(r()(this,t),this.constructor.prototype===As.prototype)throw"THCParaMatch类为抽象类，不可直接实例使用！";if("function"!=typeof this.DoMatchCurPara)throw this.prototype+" 没有实现DoMatchCurPara方法！";if("function"!=typeof this.DoMatchNewPara)throw this.prototype+" 没有实现DoMatchNewPara方法！"}return l()(t,[{key:"GetMatchParaNo",value:function(t,e,i){if(this.DoMatchCurPara(e.ParaStyles[i]))return i;var n=new Vn(t);return n.AssignEx(e.ParaStyles[i]),this.DoMatchNewPara(n),e.GetParaNo(n,!0)}}]),t}(),Bs=function(t){m()(i,t);var e=ws(i);function i(){var t;return r()(this,i),(t=e.call(this)).Align=Ln.Left,t}return l()(i,[{key:"DoMatchCurPara",value:function(t){return t.AlignHorz===this.Align}},{key:"DoMatchNewPara",value:function(t){t.AlignHorz=this.Align}}]),i}(bs),Ns=function(t){m()(i,t);var e=ws(i);function i(){var t;return r()(this,i),(t=e.call(this)).Align=Gn.Center,t}return l()(i,[{key:"DoMatchCurPara",value:function(t){return t.AlignVert===this.Align}},{key:"DoMatchNewPara",value:function(t){t.AlignVert=this.Align}}]),i}(bs),Os=function(t){m()(i,t);var e=ws(i);function i(){var t;return r()(this,i),(t=e.call(this)).SpaceMode=Hn.PLS100,t.Space=1,t}return l()(i,[{key:"DoMatchCurPara",value:function(t){return!(this.SpaceMode!=t.LineSpaceMode)&&(this.SpaceMode===Hn.Fix||this.SpaceMode,this.Space===t.LineSpace)}},{key:"DoMatchNewPara",value:function(t){t.LineSpaceMode=this.SpaceMode,t.LineSpace=this.Space}}]),i}(bs),_s=function(t){m()(i,t);var e=ws(i);function i(){var t;return r()(this,i),(t=e.call(this)).BackColor=Ft.White,t}return l()(i,[{key:"DoMatchCurPara",value:function(t){return this.hcl.sameColor(t.BackColor,this.BackColor)}},{key:"DoMatchNewPara",value:function(t){t.BackColor=this.BackColor}}]),i}(bs),Es=function(t){m()(i,t);var e=ws(i);function i(){var t;return r()(this,i),(t=e.call(this)).BreakRough=!1,t}return l()(i,[{key:"DoMatchCurPara",value:function(t){return t.BreakRough===this.BreakRough}},{key:"DoMatchNewPara",value:function(t){t.BreakRough=this.BreakRough}}]),i}(bs),Ms=function(t){m()(i,t);var e=ws(i);function i(){var t;return r()(this,i),(t=e.call(this)).Indent=0,t}return l()(i,[{key:"DoMatchCurPara",value:function(t){return t.FirstIndent===this.Indent}},{key:"DoMatchNewPara",value:function(t){t.FirstIndent=this.Indent}}]),i}(bs),Ls=function(t){m()(i,t);var e=ws(i);function i(){var t;return r()(this,i),(t=e.call(this)).Indent=0,t}return l()(i,[{key:"DoMatchCurPara",value:function(t){return t.LeftIndent===this.Indent}},{key:"DoMatchNewPara",value:function(t){t.LeftIndent=this.Indent}}]),i}(bs),Gs=function(t){m()(i,t);var e=ws(i);function i(){var t;return r()(this,i),(t=e.call(this)).Indent=0,t}return l()(i,[{key:"DoMatchCurPara",value:function(t){return t.RightIndent===this.Indent}},{key:"DoMatchNewPara",value:function(t){t.RightIndent=this.Indent}}]),i}(bs);function Hs(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Vs=function(t){m()(i,t);var e=Hs(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t)).FText=n,o.FHyperLink="",o}return l()(i,[{key:"GetText",value:function(){return this.FText}},{key:"SetText",value:function(t){this.FText=Yl.HCDeleteBreak(t.toString()),f()(F()(i.prototype),"SetText",this).call(this,t)}},{key:"GetHyperLink",value:function(){return this.FHyperLink}},{key:"SetHyperLink",value:function(t){this.FHyperLink=t}},{key:"GetLength",value:function(){return this.FText.length}},{key:"PaintTextBefor",value:function(t,e,i,n,o){}},{key:"PaintTextAfter",value:function(t,e,i,n,o){}},{key:"SubStringEffective",value:function(t,e){return this.SubString(t,e)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FText=t.Text,this.FHyperLink=t.HyperLink}},{key:"BreakByOffset",value:function(t){var e=null;return t>=this.Length||t<=0||((e=f()(F()(i.prototype),"BreakByOffset",this).call(this,t)).Text=this.SubString(t+1,this.Length-t),this.FText=this.FText.substr(0,t)),e}},{key:"CanConcatItems",value:function(t){var e=f()(F()(i.prototype),"CanConcatItems",this).call(this,t);return e&&(e=this.FHyperLink==t.HyperLink),e}},{key:"AcceptAction",value:function(t,e,n){var o=f()(F()(i.prototype),"AcceptAction",this).call(this,t,e,n);return o&&""!=this.FHyperLink&&n==rh.ConcatText&&(o=!1),o}},{key:"AdjustWordByOffset",value:function(t){return{result:!1,startOffset:-1,endOffset:-1}}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=this.SubString(e+1,n-e),s=J.getBytes(o),r=s.length;r>Yl.HC_TEXTMAXSIZE&&this.hcl.exception(Yl.HCS_EXCEPTION_TEXTOVER),t.writeUInt32(r),r>0&&t.writeBuffer(s),Yl.HCSaveTextToStream(t,this.FHyperLink)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n);var o=t.readUInt32();if(o>0){var s=t.readBuffer(o);this.FText=J.getString(s)}this.FHyperLink=n>34?Yl.HCLoadTextFromStream(t,n):""}},{key:"ToHtml",value:function(){return'<a class="fs'+this.StyleNo.toString()+'">'+this.Text.replace(new RegExp(" ","g"),"&ensp;")+"</a>"}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t),""!=this.FHyperLink&&t.SetAttribute("link",this.FHyperLink),t.Value=this.FText}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Text":'+JSON.stringify(this.FText)+',"HyperLink":"'+this.FHyperLink+'"'}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.Text&&(this.FText=Yl.HCDeleteBreak(t.Text.toString())),null!=t.Hyperlink&&(this.FHyperLink=t.HyperLink)}},{key:"SubString",value:function(t,e){return this.FText.substr(t-1,e)}}]),i}(Co);function Us(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}Vs.HCDefaultTextItemClass=Vs;var Ws=function(){function t(){r()(this,t),this.Clear()}return l()(t,[{key:"Clear",value:function(){this.Data=null,this.BeginNo=-1,this.EndNo=-1}},{key:"Assign",value:function(t){this.Data=t.Data,this.BeginNo=t.BeginNo,this.EndNo=t.EndNo}},{key:"Contain",value:function(t){return t>=this.BeginNo&&t<=this.EndNo}}]),t}(),zs=function(t){m()(i,t);var e=Us(i);function i(){var t;return r()(this,i),(t=e.call(this)).Parent=null,t.Childs=new ot(!1),t}return l()(i,[{key:"Clear",value:function(){if(f()(F()(i.prototype),"Clear",this).call(this),null!=this.Childs){for(var t=0;t<this.Childs.count;t++)this.Childs[t].Clear(),this.Childs[t]=null;this.Childs.clear()}}},{key:"AppendChild",value:function(){var t=new i;return t.Parent=this,this.Childs.add(t),t}}]),i}(Ws),Ks=l()((function t(){r()(this,t),this.SectionIndex=-1,this.Areas=new Set([]),this.Tag=0,this.Invisible=!1,this.Stop=!1,this.ReverseOrder=!1,this.Process=null,this.DomainNode=new zs,this.DomainStack=new st,this.DomainStack.push(this.DomainNode)})),Js=function(){function t(){r()(this,t),this.Initialize()}return l()(t,[{key:"Initialize",value:function(){this.StartItemNo=-1,this.StartItemOffset=-1,this.StartRestrain=!1,this.EndItemNo=-1,this.EndItemOffset=-1}}]),t}(),js=function(t){m()(i,t);var e=Us(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t)).FParentData=null,o.FStyle=n,o.FCurStyleNo=-1,o.FCurParaNo=-1,o.FDrawItems=new ho,o.FItems=new wo,o.FItems.onAdded=function(t){o.DoInsertItem(t)},o.FItems.onRemoved=function(t){o.DoRemoveItem_(t)},o.FLoading=!1,o.FCurStyleNo=0,o.FCurParaNo=0,o.FCaretDrawItemNo=-1,o.FSelectInfo=new Js,o.OnInsertItem=null,o.OnRemoveItem=null,o.OnSaveItem=null,o.OnGetUndoList=null,o.OnCurParaNoChange=null,o.OnChange=null,o.OnItemChange=null,o.OnDrawItemPaintBefor=null,o.OnDrawItemPaintAfter=null,o.OnDrawItemPaintContent=null,o.OnCanEditItem=null,o.OnCanNotEditNotify=null,o}return l()(i,[{key:"DoRemoveItem_",value:function(t){this.FStyle.States.Contain(oh.Destroying)||this.DoRemoveItem(t)}},{key:"DrawItemPaintBefor",value:function(t,e,i,n,o,s,r,a,l,h,c,u){c.save();try{this.DoDrawItemPaintBefor(t,e,i,n,o,s,r,a,l,h,c,u)}finally{c.restore()}}},{key:"DrawItemPaintAfter",value:function(t,e,i,n,o,s,r,a,l,h,c,u){c.save();try{this.DoDrawItemPaintAfter(t,e,i,n,o,s,r,a,l,h,c,u)}finally{c.restore()}}},{key:"DrawItemPaintContent",value:function(t,e,i,n,o,s,r,a,l,h,c,u,f){u.save();try{this.DoDrawItemPaintContent(t,e,i,n,o,s,r,a,l,h,c,u,f)}finally{u.restore()}}},{key:"SetCurStyleNo",value:function(t){this.FCurStyleNo!=t&&(this.FCurStyleNo=t)}},{key:"SetCurParaNo",value:function(t){this.FCurParaNo!==t&&(this.FCurParaNo=t,null!==this.OnCurParaNoChange&&this.OnCurParaNoChange(this,null))}},{key:"MatchTextStyleNoAt",value:function(t,e){return this.FItems[t].StyleNo<oo.Null?e===Yl.OffsetBefor?this.FItems[t].ParaFirst||this.FItems[t-1].StyleNo<oo.Null?this.FStyle.GetDefaultStyleNo():this.FItems[t-1].StyleNo:e===Yl.OffsetAfter?t<this.FItems.count-1?this.FItems[t+1].ParaFirst||this.FItems[t+1].StyleNo<oo.Null?this.FStyle.GetDefaultStyleNo():this.FItems[t+1].StyleNo:this.FStyle.GetDefaultStyleNo():this.FItems[t].isClass(hs)?this.FItems[t].TextStyleNo:this.FItems[t].isClass(Cs)?this.FItems[t].GetTextStyleNo():this.FStyle.GetDefaultStyleNo():this.FItems[t].StyleNo}},{key:"MergeItemText",value:function(t,e){var i=t.CanConcatItems(e);return i&&(t.Text=t.Text+e.Text),i}},{key:"MergeItemToPrio",value:function(t){return t>0&&!this.FItems[t].ParaFirst&&this.MergeItemText(this.FItems[t-1],this.FItems[t])}},{key:"MergeItemToNext",value:function(t){return t<this.FItems.count-1&&!this.FItems[t+1].ParaFirst&&this.MergeItemText(this.FItems[t],this.FItems[t+1])}},{key:"CalcContentHeight",value:function(){return this.FDrawItems.count>0?this.FDrawItems.last.rect.bottom-this.FDrawItems[0].rect.top:0}},{key:"CheckItemSelectedState",value:function(t){t>this.FSelectInfo.StartItemNo&&t<this.FSelectInfo.EndItemNo?this.FItems[t].SelectComplate():t===this.FSelectInfo.StartItemNo?t===this.FSelectInfo.EndItemNo?this.FItems[t].StyleNo<oo.Null?this.FSelectInfo.StartItemOffset===Yl.OffsetInner||this.FSelectInfo.EndItemOffset===Yl.OffsetInner?this.FItems[t].SelectExists()&&this.FItems[t].SelectPart():this.FItems[t].SelectComplate():0===this.FSelectInfo.StartItemOffset&&this.FSelectInfo.EndItemOffset===this.FItems[t].Length?this.FItems[t].SelectComplate():this.FItems[t].SelectPart():0===this.FSelectInfo.StartItemOffset?this.FItems[t].SelectComplate():this.FSelectInfo.StartItemOffset<this.GetItemOffsetAfter(t)&&(this.FItems[t].StyleNo<oo.Null?this.FItems[t].SelectExists()&&this.FItems[t].SelectPart():this.FItems[t].SelectPart()):this.FItems[t].StyleNo<oo.Null?this.FSelectInfo.EndItemOffset===Yl.OffsetAfter?this.FItems[t].SelectComplate():this.FSelectInfo.EndItemOffset>Yl.OffsetBefor&&this.FItems[t].SelectExists()&&this.FItems[t].SelectPart():this.FSelectInfo.EndItemOffset===this.FItems[t].Length?this.FItems[t].SelectComplate():this.FItems[t].SelectPart()}},{key:"MatchItemSelectState",value:function(){if(this.SelectExists())for(var t=this.FSelectInfo.StartItemNo;t<=this.FSelectInfo.EndItemNo;t++)this.CheckItemSelectedState(t)}},{key:"GetParaItemRang",value:function(t,e,i){for(e=t;e>0&&!this.FItems[e].ParaFirst;)e--;for(i=t+1;i<this.FItems.count&&!this.FItems[i].ParaFirst;)i++;return{a:e,b:--i}}},{key:"GetParaFirstItemNo",value:function(t){for(var e=t;e>0&&!this.FItems[e].ParaFirst;)e--;return e}},{key:"GetParaLastItemNo",value:function(t){for(var e=t+1;e<this.FItems.count&&!this.FItems[e].ParaFirst;)e++;return--e}},{key:"GetLineFirstItemNo",value:function(t,e){for(var i=this.GetDrawItemNoByOffset(t,e);i>0&&!this.FDrawItems[i].LineFirst;)i--;return i}},{key:"GetLineLastItemNo",value:function(t,e){for(var i=this.GetDrawItemNoByOffset(t,e)+1;i<this.FDrawItems.count&&!this.FDrawItems[i].LineFirst;)i++;return i--,this.FDrawItems[i].ItemNo}},{key:"GetLineDrawItemRang",value:function(t,e){for(;t>0&&!this.FDrawItems[t].LineFirst;)t--;for(e=t+1;e<this.FDrawItems.count&&!this.FDrawItems[e].LineFirst;)e++;return{a:t,b:--e}}},{key:"GetJustifyCount",value:function(t,e,i){var n=0;if(""==e)throw console.log(this.FItems[this.FDrawItems[t].ItemNo]),"异常：不能对空字符串计算分散!";null!==i&&i.clear();for(var o=1;o<=e.length;o++)Yl.UNPLACEHOLDERCHAR?Yl.UnPlaceholderChar.indexOf(e[o-1])<0&&(n++,null!=i&&i.add(o)):(n++,null!=i&&i.add(o));return null!==i&&i.add(e.length+1),n}},{key:"DeleteEmptyItem",value:function(){for(var t=this.FItems.count-1;t>=0;t--)this.FItems[t].StyleNo>oo.Null&&0==this.FItems[t].Length&&(this.FItems[t].ParaFirst?t<this.FItems.count-1&&!this.FItems[t+1].ParaFirst&&(this.FItems[t+1].ParaFirst=!0,this.FItems.delete(t)):this.FItems.delete(t))}},{key:"SetCaretDrawItemNo",value:function(t){if(this.FStyle.WillStyleNo=oo.Null,this.FCaretDrawItemNo>=0&&this.FCaretDrawItemNo<this.FDrawItems.count){var e=this.FDrawItems[this.FCaretDrawItemNo].ItemNo;t>=0&&e!==this.FDrawItems[t].ItemNo&&(this.FItems[e].Active=!1)}this.FCaretDrawItemNo=t,this.FStyle.States.Contain(oh.Loading)||(this.SetCurStyle(this.FDrawItems[this.FCaretDrawItemNo].ItemNo,this.FSelectInfo.StartItemOffset),this.FCaretDrawItemNo>=0&&(this.FItems[this.FDrawItems[this.FCaretDrawItemNo].ItemNo].StyleNo<oo.Null?this.FSelectInfo.StartItemOffset===Yl.OffsetInner&&(this.FItems[this.FDrawItems[this.FCaretDrawItemNo].ItemNo].Active=!0):this.FSelectInfo.StartRestrain||(this.FItems[this.FDrawItems[this.FCaretDrawItemNo].ItemNo].Active=!0)),this.DoCaretItemChanged())}},{key:"CancelCaretDrawItem",value:function(){if(this.FCaretDrawItemNo>=0&&this.FCaretDrawItemNo<this.FDrawItems.count){var t=this.FDrawItems[this.FCaretDrawItemNo].ItemNo;this.FItems[t].Active=!1}this.FCaretDrawItemNo=-1}},{key:"SetCurStyle",value:function(t,e){this.CurStyleNo=this.MatchTextStyleNoAt(t,e),this.CurParaNo=this.FItems[t].ParaNo}},{key:"CalculateLineHeight",value:function(t,e){var i=t.FontHeight;if(e.LineSpaceMode===Hn.PLSMin)return i;if(e.LineSpaceMode===Hn.PLSFix){var n=En.millimeterToPixY(.3527*e.LineSpace);return n<i?i:n}if(this.FStyle.FormatVersion>1)switch(e.LineSpaceMode){case Hn.PLS115:i+=L.Round(.15*t.TextMetric_tmHeight);break;case Hn.PLS150:i+=L.Round(.5*t.TextMetric_tmHeight);break;case Hn.PLS200:i+=t.TextMetric_tmHeight;break;case Hn.PLSMult:i+=L.Round(t.TextMetric_tmHeight*e.LineSpace)}else{var o=0,s=0;if(t.trueType>0&&t.CJKFont)if(0!=(128&t.OutlineTextmetric_otmfsSelection))o=t.OutlineTextmetric_otmAscent,s=-t.OutlineTextmetric_otmDescent;else{o=t.Textmetric_tmAscent,s=t.Textmetric_tmDescent;var r=Math.ceil(1.3*(o+s))-(o+s),a=Math.trunc(r/2);switch(i=(o+=a)+(s+=r-a),e.LineSpaceMode){case Hn.PLS115:i+=Math.trunc(3*i/20);break;case Hn.PLS150:i=Math.trunc(3*i/2);break;case Hn.PLS200:i*=2;break;case Hn.PLSMult:i=Math.trunc(i*e.LineSpace)}}else switch(e.LineSpaceMode){case Hn.PLS100:i+=t.TextMetric_tmExternalLeading;break;case Hn.PLS115:i=i+t.TextMetric_tmExternalLeading+L.Round(.15*(t.TextMetric_tmHeight+t.TextMetric_tmExternalLeading));break;case Hn.PLS150:i=i+t.TextMetric_tmExternalLeading+L.Round(.5*(t.TextMetric_tmHeight+t.TextMetric_tmExternalLeading));break;case Hn.PLS200:i=i+t.TextMetric_tmExternalLeading+t.TextMetric_tmHeight+t.TextMetric_tmExternalLeading;break;case Hn.PLSMult:i=i+t.TextMetric_tmExternalLeading+L.Round((t.TextMetric_tmHeight+t.TextMetric_tmExternalLeading)*e.LineSpace)}}return i}},{key:"GetUndoList",value:function(){return null!=this.OnGetUndoList?this.OnGetUndoList():null}},{key:"DoSaveItem",value:function(t){return null===this.OnSaveItem||this.OnSaveItem(this,t)}},{key:"DoInsertItem",value:function(t){null!==this.OnInsertItem&&this.OnInsertItem(this,t)}},{key:"DoRemoveItem",value:function(t){null!==this.OnRemoveItem&&this.OnRemoveItem(this,t)}},{key:"DoDrawItemPaintBefor",value:function(t,e,i,n,o,s,r,a,l,h,c,u){null!==this.OnDrawItemPaintBefor&&this.OnDrawItemPaintBefor(t,e,i,n,o,s,r,a,l,h,c,u)}},{key:"DoDrawItemPaintContent",value:function(t,e,i,n,o,s,r,a,l,h,c,u,f){null!==this.OnDrawItemPaintContent&&this.OnDrawItemPaintContent(t,e,i,n,o,s,r,a,l,h,c,u,f)}},{key:"DoDrawItemPaintAfter",value:function(t,e,i,n,o,s,r,a,l,h,c,u){null!==this.OnDrawItemPaintAfter&&this.OnDrawItemPaintAfter(t,e,i,n,o,s,r,a,l,h,c,u)}},{key:"DoLoadFromStream",value:function(t,e,i){this.Clear()}},{key:"DoItemChange",value:function(t,e,i){this.FStyle.States.Contain(oh.Loading)||(this.Change(),null!==this.OnItemChange&&this.OnItemChange(this,t,e,i))}},{key:"DoDataDeleteItemAction",value:function(t,e){e()}},{key:"DoCaretItemChanged",value:function(){}},{key:"DoCanNotEditNotify",value:function(t){null!==this.OnCanNotEditNotify&&this.OnCanNotEditNotify(t)}},{key:"Loading",get:function(){return this.FLoading}},{key:"CanEdit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.GetActiveItem();return null===e&&(e=this.FItems[0]),this.CanEditItem(this,e,t)}},{key:"CanEditItem",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!!this.FLoading||(null!==this.OnCanEditItem?this.OnCanEditItem(t,e,i):null===t.ParentData||t.ParentData.CanEdit(i))}},{key:"SelectAll",value:function(){this.FItems.count>0&&(this.FSelectInfo.StartItemNo=0,this.FSelectInfo.StartItemOffset=0,this.IsEmptyData()?(this.FSelectInfo.EndItemNo=-1,this.FSelectInfo.EndItemOffset=-1):(this.FSelectInfo.EndItemNo=this.FItems.count-1,this.FSelectInfo.EndItemOffset=this.GetItemOffsetAfter(this.FSelectInfo.EndItemNo)),this.MatchItemSelectState())}},{key:"SelectedAll",value:function(){return 0===this.FSelectInfo.StartItemNo&&0===this.FSelectInfo.StartItemOffset&&this.FSelectInfo.EndItemNo===this.FItems.count-1&&this.FSelectInfo.EndItemOffset===this.GetItemOffsetAfter(this.FItems.count-1)}},{key:"Clear",value:function(){this.FSelectInfo.Initialize(),this.FCaretDrawItemNo=-1,this.FDrawItems.clear(),this.FItems.clear(),this.FCurStyleNo=0,this.FCurParaNo=0,this.FStyle.ApplyTempStyle(oo.Null)}},{key:"InitializeField",value:function(){this.FCaretDrawItemNo=-1}},{key:"Change",value:function(){this.FStyle.States.Contain(oh.Loading)||null!==this.OnChange&&this.OnChange()}},{key:"ItemChange",value:function(t,e,i){var n=this.FItems.indexOf(t);n>=0&&this.DoItemChange(n,e,i)}},{key:"ItemChangeBy",value:function(t,e,i){this.DoItemChange(t,e,i)}},{key:"Clone",value:function(t){this.InitializeField(),this.FItems.clear();for(var e=0;e<t.Items.count;e++){var i=this.CreateItemByStyle(t.Items[e].StyleNo);i.Assign(t.Items[e]),i.Active=!1,i.DisSelect(),this.FItems.add(i)}}},{key:"GetRootData",value:function(){return this}},{key:"GetScreenCoord",value:function(t,e){return this.GetRootData().GetScreenCoord(t,e)}},{key:"CreateDefaultTextItem",value:function(){var t=new Vs.HCDefaultTextItemClass(this.hcl,"");return this.FCurStyleNo<oo.Null?t.StyleNo=this.FStyle.GetDefaultStyleNo():t.StyleNo=this.FCurStyleNo,t.ParaNo=this.FCurParaNo,t}},{key:"CreateDefaultDomainItem",value:function(){var t=new rs.HCDefaultDomainItemClass(this.hcl,this);return t.ParaNo=this.FCurParaNo,t}},{key:"CreateItemByStyle",value:function(t){return null}},{key:"GetCaretInfo",value:function(t,e,i){var n,o;n=this.FCaretDrawItemNo<0?this.FItems[t].StyleNo<oo.Null?this.FItems[t].FirstDItemNo:this.GetDrawItemNoByOffset(t,e):this.FCaretDrawItemNo;var s=this.FDrawItems[n];if(i.Height=s.height,this.FStyle.UpdateInfo.ReStyle&&(o=t,0===e&&!this.FItems[t].ParaFirst&&t>0&&this.FItems[t-1].StyleNo>oo.Null&&(o=t-1),this.SetCurStyle(o,this.FSelectInfo.StartItemOffset)),this.FItems[t].StyleNo<oo.Null){var r=this.FItems[t];e===Yl.OffsetBefor?(r.CanPageBreak&&this.GetRectItemInnerCaretInfo(r,t,n,s,i),i.X+=s.rect.left):e===Yl.OffsetInner?(this.GetRectItemInnerCaretInfo(r,t,n,s,i),i.X+=s.rect.left):(r.CanPageBreak&&this.GetRectItemInnerCaretInfo(r,t,n,s,i),i.X+=s.rect.right),r.JustifySplit()&&(this.FStyle.ParaStyles[r.ParaNo].AlignHorz===Ln.Justify&&!this.IsParaLastDrawItem(n)||this.FStyle.ParaStyles[r.ParaNo].AlignHorz===Ln.Scatter?this.IsLineLastDrawItem(n)&&(i.X+=s.width-r.Width):i.X+=s.width-r.Width)}else i.X+=s.rect.left+this.GetDrawItemOffsetWidth(n,e-s.CharOffs+1);i.Y+=s.rect.top}},{key:"SetTextItemStyle",value:function(t,e){if(this.FItems[t].StyleNo<oo.Null)return!1;var i=this.FStyle.GetStyleNo(e,!0);return i!==this.FItems[t].StyleNo&&(this.FItems[t].StyleNo=i,!0)}},{key:"SetTextItemFontColor",value:function(t,e){if(this.FItems[t].StyleNo<oo.Null)return!1;var i=new zn(this.hcl);i.AssignEx(this.FStyle.TextStyles[this.FItems[t].StyleNo]),i.Color=e;var n=this.SetTextItemStyle(t,i);return i=null,n}},{key:"GetItemAt",value:function(t,e,i,n,o,s){if(i=-1,n=-1,o=-1,s=!0,this.IsEmptyData())return{itemNo:i=0,offset:n=0,drawItemNo:o=0,restrain:s};var r,a,l,h=-1;if(e<0)r=0;else{if(e>(l=this.FDrawItems.last.rect).bottom)r=this.FDrawItems.count-1;else for(r=0,h=this.FDrawItems.count-1;;){if(h-r>1){if(a=Math.trunc(r+(h-r)/2),e>this.FDrawItems[a].rect.bottom){r=a+1;continue}if(e<this.FDrawItems[a].rect.top){h=a-1;continue}r=a;break}(e>=this.FDrawItems[h].rect.bottom||e>this.FDrawItems[h].rect.top)&&(r=h);break}e<this.FDrawItems[r].rect.top&&r--}var c=this.GetLineDrawItemRang(r,h);if(r=c.a,h=c.b,t<=this.FDrawItems[r].rect.left)o=r,i=this.FDrawItems[r].ItemNo,n=this.FItems[i].StyleNo<oo.Null?this.GetDrawItemOffsetAt(r,t):this.FDrawItems[r].CharOffs-1;else if(t>=this.FDrawItems[h].rect.right)o=h,i=this.FDrawItems[h].ItemNo,n=this.FItems[i].StyleNo<oo.Null?this.GetDrawItemOffsetAt(h,t):this.FDrawItems[h].CharOffs+this.FDrawItems[h].CharLen-1;else for(var u=r;u<=h;u++)if(this.FItems[this.FDrawItems[u].ItemNo].Visible&&t>=(l=this.FDrawItems[u].rect).left&&t<l.right){s=e<l.top||e>l.bottom,o=u,i=this.FDrawItems[u].ItemNo,n=this.FItems[i].StyleNo<oo.Null?this.GetDrawItemOffsetAt(u,t):this.FDrawItems[u].CharOffs+this.GetDrawItemOffsetAt(u,t)-1;break}return{itemNo:i,offset:n,drawItemNo:o,restrain:s}}},{key:"CoordInSelect",value:function(t,e,i,n,o){var s=!1;if(i<0||n<0)return s;if(o)return s;var r=this.GetDrawItemNoByOffset(i,n);return(s=this.FDrawItems[r].rect.pointInAt(t,e))&&(s=this.OffsetInSelect(i,n)),s}},{key:"GetDrawItemText",value:function(t){var e=this.FDrawItems[t];return this.FItems[e.ItemNo].Text.substr(e.CharOffs-1,e.CharLen)}},{key:"_GetNorAlignDrawItemOffsetWidth",value:function(t,e,i){var n,o=0;if(Yl.UNPLACEHOLDERCHAR){if(""!==(n=this.GetDrawItemText(t))){var s=n.length;o=i.getTextExtentExPoint(n,s)[e-1]}}else{var r=this.FDrawItems[t];""!==(n=this.FItems[r.ItemNo].Text.substr(r.CharOffs-1,e))&&(o=i.textWidth(n))}return o}},{key:"GetDrawItemOffsetWidth",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e)return 0;if(!this.Items[this.FDrawItems[t].ItemNo].Visible)return 0;var n=0,o=this.FDrawItems[t],s=this.FItems[o.ItemNo].StyleNo;if(s<oo.Null)e>Yl.OffsetBefor&&(n=this.FDrawItems[t].width);else{var r=null;null!=i?r=i:(r=this.FStyle.TempCanvas,this.FStyle.ApplyTempStyle(s));var a=this.FStyle.ParaStyles[this.GetDrawItemParaStyle(t)].AlignHorz;switch(a){case Ln.Left:case Ln.Right:case Ln.Center:n=this._GetNorAlignDrawItemOffsetWidth(t,e,r);break;case Ln.Justify:case Ln.Scatter:if(a===Ln.Justify&&this.IsParaLastDrawItem(t))return n=this._GetNorAlignDrawItemOffsetWidth(t,e,r);var l=this.GetDrawItemText(t),h=l.length,c=r.getTextExtentExPoint(l,h),u=o.width-c[h-1],f=0,d=new ot,m=this.GetJustifyCount(t,l,d),S=this.IsLineLastDrawItem(t);S&&m>0&&m--,m>0&&(f=u%m,u=Math.trunc(u/m));for(var p=0,y=0,F=0;F<d.count-1;F++){if(S&&F===d.count-2||(f>0?(p+=u+1,f--):p+=u),(y=d[F+1]-1)===e){n=c[y-1]+p;break}if(y>e){n=c[e-d[F]]+p;break}}}}return n}},{key:"GetRectItemInnerCaretInfo",value:function(t,e,i,n,o){t.GetCaretInfo(o);var s=Math.trunc(this.GetLineBlankSpace(i)/2),r=n.rect.inFlate(0,-s,!0);switch(this.FStyle.ParaStyles[this.FItems[e].ParaNo].AlignVert){case Gn.Center:o.Y=o.Y+s+(r.height-t.Height)/2;break;case Gn.Top:o.Y=o.Y+s;break;default:o.Y=o.Y+s+r.height-t.Height}}},{key:"GetItemActualOffset",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Yl.GetTextActualOffset(this.FItems[t].Text,e,i)}},{key:"GetItemOffsetAfter",value:function(t){return this.FItems[t].StyleNo<oo.Null?Yl.OffsetAfter:this.FItems[t].Length}},{key:"GetDataDrawItemRang",value:function(t,e,i,n){i=-1,n=-1;for(var o=0,s=-1;o<this.FDrawItems.count;){if(this.FDrawItems[o].LineFirst){for(s=o;o<this.FDrawItems.count&&!this.FItems[this.FDrawItems[o].ItemNo].Visible;)o++;if(o===this.FDrawItems.count)break;if(this.FDrawItems[o].rect.bottom>t&&this.FDrawItems[o].rect.top<e){i=s;break}}o++}if(i<0)return{a:i,b:n};for(var r=i;r<this.FDrawItems.count;r++)if(this.FDrawItems[r].LineFirst&&this.FDrawItems[r].rect.top>=e){n=r-1;break}return n<0&&(n=this.FDrawItems.count-1),{a:i,b:n}}},{key:"GetItemLastDrawItemNo",value:function(t){var e=-1;if(this.FItems[t].FirstDItemNo<0)return e;for(e=this.FItems[t].FirstDItemNo+1;e<this.FDrawItems.count&&!this.FDrawItems[e].ParaFirst&&this.FDrawItems[e].ItemNo===t;)e++;return--e}},{key:"OffsetInSelect",value:function(t,e){var i=!1;return t<0||e<0?i:this.FItems[t].StyleNo<oo.Null?(e===Yl.OffsetInner&&this.FItems[t].IsSelectComplate&&(i=!0),i):(this.SelectExists()&&(t>this.FSelectInfo.StartItemNo&&t<this.FSelectInfo.EndItemNo?i=!0:t===this.FSelectInfo.StartItemNo?i=t===this.FSelectInfo.EndItemNo?e>=this.FSelectInfo.StartItemOffset&&e<=this.FSelectInfo.EndItemOffset:e>=this.FSelectInfo.StartItemOffset:t===this.FSelectInfo.EndItemNo&&(i=e<=this.FSelectInfo.EndItemOffset)),i)}},{key:"CoordToDrawItem",value:function(t,e,i,n,o){n=t,o=e;var s=this.FDrawItems[i].rect.inFlate(0,-Math.trunc(this.GetLineBlankSpace(i)/2),!0);if(n-=s.left,o-=s.top,this.FItems[this.FDrawItems[i].ItemNo].StyleNo<oo.Null){var r=this.FItems[this.FDrawItems[i].ItemNo];switch(this.FStyle.ParaStyles[r.ParaNo].AlignVert){case Gn.Center:o-=Math.trunc((s.height-r.Height)/2);break;case Gn.Top:break;default:o-=s.height-r.Height}}return{x:n,y:o}}},{key:"CoordToItemOffset",value:function(t,e,i,n,o,s){if(o=t,s=e,i<0)return{x:o,y:s};var r=this.GetDrawItemNoByOffset(i,n);return this.CoordToDrawItem(t,e,r,o,s)}},{key:"GetDrawItemNoByOffset",value:function(t,e){var i=this.FItems[t].FirstDItemNo;if(this.FItems[t].StyleNo>oo.Null&&this.FItems[t].Length>0)for(var n,o=this.FItems[t].FirstDItemNo;o<this.FDrawItems.count&&(n=this.FDrawItems[o]).ItemNo===t;o++)if(e-n.CharOffs<n.CharLen){i=o;break}return i}},{key:"IsLineLastDrawItem",value:function(t){return t===this.FDrawItems.count-1||this.FDrawItems[t+1].LineFirst}},{key:"IsParaLastDrawItem",value:function(t){var e=!1,i=this.FDrawItems[t].ItemNo;return i<this.FItems.count-1?this.FItems[i+1].ParaFirst&&(e=this.FDrawItems[t].CharOffsetEnd()==this.FItems[i].Length):e=this.FDrawItems[t].CharOffsetEnd()==this.FItems[i].Length,e}},{key:"IsParaLastDrawItemEx",value:function(t){return t<this.FDrawItems.count-1&&this.FDrawItems[t+1].ParaFirst||t===this.FDrawItems.count-1}},{key:"IsParaLastItem",value:function(t){return t===this.FItems.count-1||this.FItems[t+1].ParaFirst}},{key:"GetTopLevelData",value:function(){var t=null;return this.FSelectInfo.StartItemNo>=0&&this.FSelectInfo.EndItemNo<0&&this.FItems[this.FSelectInfo.StartItemNo].StyleNo<oo.Null&&this.FSelectInfo.StartItemOffset===Yl.OffsetInner&&(t=this.FItems[this.FSelectInfo.StartItemNo].GetTopLevelData()),null==t&&(t=this),t}},{key:"GetTopLevelDataAt",value:function(t,e){var i=null,n=-1,o=0,s=-1,r=!1,a=this.GetItemAt(t,e,n,o,s,r);if(n=a.itemNo,o=a.offset,s=a.drawItemNo,!(r=a.restrain)&&n>=0&&this.FItems[n].StyleNo<oo.Null){var l=this.CoordToItemOffset(t,e,n,o,0,0);i=this.FItems[n].GetTopLevelDataAt(l.x,l.y)}return null===i&&(i=this),i}},{key:"GetActiveDrawItemNo",value:function(){if(this.FCaretDrawItemNo>=0)return this.FCaretDrawItemNo;var t=-1;if(this.FSelectInfo.StartItemNo<0);else{var e=-1;if(e=this.SelectExists()&&this.FSelectInfo.EndItemNo>=0?this.FSelectInfo.EndItemNo:this.FSelectInfo.StartItemNo,this.FItems[e].StyleNo<oo.Null)t=this.FItems[e].FirstDItemNo;else for(var i=this.FItems[e].FirstDItemNo;i<this.FDrawItems.count;i++){var n=this.FDrawItems[i];if(this.FSelectInfo.StartItemOffset-n.CharOffs+1<=n.CharLen){t=i;break}}}return t}},{key:"GetActiveDrawItem",value:function(){var t=this.GetActiveDrawItemNo();return t<0?null:this.FDrawItems[t]}},{key:"GetActiveItemNo",value:function(){return this.FSelectInfo.StartItemNo}},{key:"GetActiveItem",value:function(){var t=this.GetActiveItemNo();return t<0?null:this.FItems[t]}},{key:"GetActiveRectItem",value:function(){var t=this.GetActiveItem();return null!==t&&t.StyleNo<oo.Null?t:null}},{key:"GetTopLevelItem",value:function(){var t=this.GetActiveItem();return null!==t&&t.StyleNo<oo.Null&&(t=t.GetTopLevelItem()),t}},{key:"GetTopLevelDrawItem",value:function(){var t=null,e=this.GetActiveItem();return null!==e&&e.StyleNo<oo.Null&&(t=e.GetTopLevelDrawItem()),null===t&&(t=this.GetActiveDrawItem()),t}},{key:"GetTopLevelDrawItemCoord",value:function(){var t=et.Create(0,0),e=et.Create(0,0),i=this.GetActiveDrawItem();if(null!==i){t=i.rect.leftTop;var n=this.GetActiveItem();null!==n&&n.StyleNo<oo.Null&&((e=n.GetTopLevelDrawItemCoord()).y=e.y+Math.trunc(this.FStyle.LineSpaceMin/2)),t.x=t.x+e.x,t.y=t.y+e.y}return t}},{key:"GetTopLevelRectDrawItem",value:function(){var t=null,e=this.GetActiveItem();return null!==e&&e.StyleNo<oo.Null&&null===(t=e.GetTopLevelRectDrawItem())&&(t=this.GetActiveDrawItem()),t}},{key:"GetTopLevelRectDrawItemCoord",value:function(){var t=et.Create(-1,-1),e=this.GetActiveItem();if(null!==e&&e.StyleNo<oo.Null){(t=this.FDrawItems[e.FirstDItemNo].rect.leftTop).y+=Math.trunc(this.FStyle.LineSpaceMin/2);var i=e.GetTopLevelRectDrawItemCoord();i.x>=0&&(t.x=t.x+i.x,t.y=t.y+i.y)}return t}},{key:"GetTopLevelRectItem",value:function(){var t=this.GetActiveItem();if(null!==t&&t.StyleNo<oo.Null){var e=t.GetTopLevelRectItem();return null===e?t:e}return null}},{key:"IsRectItem",value:function(t){return this.FItems[t].StyleNo<oo.Null}},{key:"IsTextItem",value:function(t){return this.FItems[t].StyleNo>oo.Null}},{key:"GetItemStyle",value:function(t){return this.FItems[t].StyleNo}},{key:"GetDrawItemStyle",value:function(t){return this.GetItemStyle(this.FDrawItems[t].ItemNo)}},{key:"GetItemParaStyle",value:function(t){return this.FItems[t].ParaNo}},{key:"GetDrawItemParaStyle",value:function(t){return this.GetItemParaStyle(this.FDrawItems[t].ItemNo)}},{key:"GetDrawItemOffsetAt",value:function(t,e){var i=0,n=this.FDrawItems[t],o=this.FItems[n.ItemNo];if(o.StyleNo<oo.Null)i=o.GetOffsetAt(e-n.rect.left);else{i=n.CharLen;var s=o.SubString(n.CharOffs,n.CharLen);this.FStyle.ApplyTempStyle(o.StyleNo);var r=this.FStyle.ParaStyles[o.ParaNo],a=e-n.rect.left;switch(r.AlignHorz){case Ln.Left:case Ln.Right:case Ln.Center:i=Yl.GetNorAlignCharOffsetAt(this.FStyle.TempCanvas,s,a);break;case Ln.Justify:case Ln.Scatter:if(r.AlignHorz===Ln.Justify&&this.IsParaLastDrawItem(t))return i=Yl.GetNorAlignCharOffsetAt(this.FStyle.TempCanvas,s,a);var l=s.length,h=this.FStyle.TempCanvas.getTextExtentExPoint(s,l),c=n.width-h[l-1],u=0,f=new ot,d=this.GetJustifyCount(t,s,f),m=this.IsLineLastDrawItem(t);m&&d>0&&d--,d>0&&(u=c%d,c=Math.trunc(c/d));for(var S=0,p=0,y=0;y<f.count-1;y++)if(m&&y===f.count-2?p=0:(u>0?(p=c+1,u--):p=c,S+=p),h[f[y+1]-1-1]+S>a){for(var F=f[y];F<f[y+1];)if(Yl.UNPLACEHOLDERCHAR&&(F=Yl.GetTextActualOffset(s,F,!0)),h[F-1]+S>a){a>(Yl.UNPLACEHOLDERCHAR?S-Math.trunc(p/2)+Yl.GetCharHalfFarfromUN(s,F,h):S-Math.trunc(p/2)+Yl.GetCharHalfFarfrom(F,h))?i=F:(i=F-1,Yl.UNPLACEHOLDERCHAR&&Yl.IsUnPlaceHolderChar(s[i+1-1])&&(i=Yl.GetTextActualOffset(s,i)-1));break}break}}}return i}},{key:"GetSelectStartDrawItemNo",value:function(){var t=-1;return this.FSelectInfo.StartItemNo<0||(t=this.GetDrawItemNoByOffset(this.FSelectInfo.StartItemNo,this.FSelectInfo.StartItemOffset),this.FSelectInfo.EndItemNo>=0&&t<this.FItems.count-1&&(this.FDrawItems[t+1].ParaFirst||(this.FItems[this.FSelectInfo.StartItemNo].StyleNo<oo.Null?this.FSelectInfo.StartItemOffset===Yl.OffsetAfter&&t++:this.FDrawItems[t].CharOffsetEnd()===this.FSelectInfo.StartItemOffset&&t++))),t}},{key:"GetSelectEndDrawItemNo",value:function(){var t=-1;return this.FSelectInfo.EndItemNo<0?t:t=this.GetDrawItemNoByOffset(this.FSelectInfo.EndItemNo,this.FSelectInfo.EndItemOffset)}},{key:"SelectRectItemTheory",value:function(){return this.FSelectInfo.EndItemNo<0&&this.FItems[this.FSelectInfo.StartItemNo].StyleNo<oo.Null&&this.FSelectInfo.StartItemOffset===Yl.OffsetInner&&this.FItems[this.FSelectInfo.StartItemNo].IsSelectComplateTheory()}},{key:"SelectInSameDrawItem",value:function(){var t=this.GetSelectStartDrawItemNo();return!(t<0)&&(this.GetDrawItemStyle(t)<oo.Null?this.FItems[this.FDrawItems[t].ItemNo].IsSelectComplate&&this.FSelectInfo.EndItemNo<0:t===this.GetSelectEndDrawItemNo())}},{key:"SelectInSameItem",value:function(){return this.FSelectInfo.StartItemNo>=0&&(this.FSelectInfo.EndItemNo<0||this.FSelectInfo.StartItemNo===this.FSelectInfo.EndItemNo)}},{key:"DisSelect",value:function(){var t=null;this.FSelectInfo.StartItemNo>=0&&((t=this.FItems[this.FSelectInfo.StartItemNo]).Active=!1,t.DisSelect());var e=this.SelectExists();if(e){for(var i=this.FSelectInfo.StartItemNo+1;i<=this.FSelectInfo.EndItemNo;i++)(t=this.FItems[i]).Active=!1,t.DisSelect();this.FSelectInfo.EndItemNo=-1,this.FSelectInfo.EndItemOffset=-1}return this.FSelectInfo.StartItemNo=-1,this.FSelectInfo.StartItemOffset=-1,this.FCaretDrawItemNo=-1,e}},{key:"SelectedCanDrag",value:function(){var t=!0;if(this.FSelectInfo.EndItemNo<0)this.FSelectInfo.StartItemNo>=0&&(t=this.FItems[this.FSelectInfo.StartItemNo].CanDrag());else for(var e=this.FSelectInfo.StartItemNo;e<=this.FSelectInfo.EndItemNo;e++){if(this.FItems[e].StyleNo<oo.Null&&!this.FItems[e].IsSelectComplate){t=!1;break}if(!this.FItems[e].CanDrag()){t=!1;break}}return t}},{key:"SelectedHasRectItem",value:function(){if(this.FSelectInfo.EndItemNo<0){if(this.FSelectInfo.StartItemNo>=0)return this.FItems[this.FSelectInfo.StartItemNo].StyleNo<oo.Null}else for(var t=this.FSelectInfo.StartItemNo;t<=this.FSelectInfo.EndItemNo;t++)if(this.FItems[t].StyleNo<oo.Null)return!0;return!1}},{key:"SelectedResizing",value:function(){return!!(this.FSelectInfo.StartItemNo>=0&&(this.FSelectInfo.EndItemNo<0||this.FSelectInfo.StartItemNo===this.FSelectInfo.EndItemNo)&&this.FItems[this.FSelectInfo.StartItemNo].isClass(Is))&&this.FItems[this.FSelectInfo.StartItemNo].Resizing}},{key:"IsEmptyData",value:function(){return 1===this.FItems.count&&this.IsEmptyLine(0)}},{key:"IsEmptyLine",value:function(t){return this.FItems[t].StyleNo>oo.Null&&""===this.FItems[t].Text}},{key:"ApplyParaAlignHorz",value:function(t){var e=new Bs;e.Align=t,this.ApplySelectParaStyle(e)}},{key:"ApplyParaAlignVert",value:function(t){var e=new Ns;e.Align=t,this.ApplySelectParaStyle(e)}},{key:"ApplyParaBackColor",value:function(t){var e=new _s;e.BackColor=t,this.ApplySelectParaStyle(e)}},{key:"ApplyParaBreakRough",value:function(t){var e=new Es;e.BreakRough=t,this.ApplySelectParaStyle(e)}},{key:"ApplyParaLineSpace",value:function(t,e){var i=new Os;i.SpaceMode=t,i.Space=e,this.ApplySelectParaStyle(i)}},{key:"ApplyParaLeftIndent",value:function(t){var e=new Ls;e.Indent=t,this.ApplySelectParaStyle(e)}},{key:"ApplyParaRightIndent",value:function(t){var e=new Gs;e.Indent=t,this.ApplySelectParaStyle(e)}},{key:"ApplyParaFirstIndent",value:function(t){var e=new Ms;e.Indent=t,this.ApplySelectParaStyle(e)}},{key:"ApplyParaFirstIndentCharCount",value:function(t){var e=this.GetParaFirstItemNo(this.GetActiveItemNo()),i=this.FItems[e].StyleNo;i<oo.Null&&(i=this.FStyle.GetDefaultStyleNo());var n=this.FStyle.TextStyleCharWidth(i,2);this.ApplyParaFirstIndent(En.PixXToMillimeter(n))}},{key:"ApplyBullet",value:function(t,e,i,n){}},{key:"ApplySelectTextStyle",value:function(t){}},{key:"ApplySelectParaStyle",value:function(t){}},{key:"ApplyTableCellAlign",value:function(t){}},{key:"DeleteSelected",value:function(){return!1}},{key:"DeleteItemDirect",value:function(t){this.FItems.delete(t)}},{key:"ApplyTextStyle",value:function(t){var e=new Ds(this.hcl);e.FontStyle=t,this.ApplySelectTextStyle(e)}},{key:"ApplyTextStyleNo",value:function(t){var e=new Ts(this.hcl);e.StyleNo=t,this.ApplySelectTextStyle(e)}},{key:"ApplyTextFontName",value:function(t){var e=new Ps(this.hcl);e.FontName=t,this.ApplySelectTextStyle(e)}},{key:"ApplyTextFontSize",value:function(t){var e=new ks(this.hcl);e.FontSize=t,this.ApplySelectTextStyle(e)}},{key:"ApplyTextColor",value:function(t){var e=new xs(this.hcl);e.Color=t,this.ApplySelectTextStyle(e)}},{key:"ApplyTextBackColor",value:function(t){var e=new Rs(this.hcl);e.Color=t,this.ApplySelectTextStyle(e)}},{key:"DrawItemSelectAll",value:function(t,e){var i=this.GetSelectStartDrawItemNo(),n=this.GetSelectEndDrawItemNo();return(i<t||i===t&&this.FSelectInfo.StartItemOffset===this.FDrawItems[i].CharOffsetStart())&&(n>e||n===e&&this.SelectInfo.EndItemOffset===this.FDrawItems[n].CharOffsetEnd())}},{key:"DrawTextJsutify",value:function(t,e,i,n,o,s){var r=i.left,a=n.length,l=t.getTextExtentExPoint(n,a),h=i.width-l[a-1];if(h>0){var c=t.font.styles.has(wt),u=t.font.styles.has(At);(c||u)&&(t.pen.style=_t.Solid,t.pen.width=1,t.pen.color=Ft.Black,t.beginPath(),c&&(t.moveTo(i.left,i.bottom),t.lineTo(i.right,i.bottom)),u&&(t.moveTo(i.left,i.bottom-Math.trunc(i.height/2)),t.lineTo(i.right,i.bottom-Math.trunc(i.height/2))),t.paintPath());var f=new ot,d=this.GetJustifyCount(e,n,f);o&&d>0&&d--;var m=0;d>0&&(m=h%d,h=Math.trunc(h/d)),r=0;var S,p=0;try{c&&t.font.styles.remove(wt),u&&t.font.styles.remove(At);for(var y=0;y<f.count-1;y++)a=f[y+1]-f[y],S=n.substr(f[y]-1,a),y>0&&(r=l[f[y]-2]+p),t.textOut(i.left+r,s,S),o&&y===f.count-2||(m>0?(p+=h+1,m--):p+=h)}finally{c&&t.font.styles.add(wt),u&&t.font.styles.add(At)}f=null}else t.textOut(r,s,n,l)}},{key:"PaintDataRange",value:function(t,e,i,n,o,s,r,a,l,h,c){if(!(a<0||l<0)){var u=-1,f=-1,d=-1,m=-1,S=!1;c.Print||(f=(u=this.GetSelectStartDrawItemNo())<0?-1:this.FSelectInfo.StartItemOffset-this.FDrawItems[u].CharOffs+1,m=(d=this.GetSelectEndDrawItemNo())<0?-1:this.FSelectInfo.EndItemOffset-this.FDrawItems[d].CharOffs+1,S=this.DrawItemSelectAll(a,l));var p=oo.Null,y=oo.Null,F=0,v=e-r;h.save();try{var I,g,C,w=-1;this.FDrawItems[a].LineFirst||(w=this.GetLineBlankSpace(a));for(var A,D,P,k=Ln.Left,x=a;x<=l;x++)if(I=this.FDrawItems[x],A=this.FItems[I.ItemNo],g=I.rect.offset(t,v,!0),I.LineFirst&&(w=this.GetLineBlankSpace(x)),C=g.inFlate(0,-Math.trunc(w/2),!0),A.Visible){if(this.DrawItemPaintBefor(this,I.ItemNo,x,g,C,t,i,n,o,s,h,c),y!==A.ParaNo&&(y=A.ParaNo,k=this.FStyle.ParaStyles[A.ParaNo].AlignHorz),A.StyleNo<oo.Null){switch(p=(D=A).StyleNo,D.JustifySplit()&&(k===Ln.Justify&&!this.IsLineLastDrawItem(x)||k===Ln.Scatter?this.IsLineLastDrawItem(x)&&C.offset(C.width-D.Width,0):C.right=C.left+D.Width),this.FStyle.ParaStyles[A.ParaNo].AlignVert){case Gn.Center:C.inFlate(0,-Math.trunc((C.height-D.Height)/2));break;case Gn.Top:break;default:C.top=C.bottom-D.Height}this.DrawItemPaintContent(this,I.ItemNo,x,g,C,"",t,i,n,o,s,h,c),!c.Print&&D.IsSelectComplate&&(h.brush.color=this.FStyle.SelColor,h.fillRect(g)),A.PaintTo(this.FStyle,C,e,n,o,s,h,c)}else{A.StyleNo!=p&&(p=A.StyleNo,this.FStyle.TextStyles[p].ApplyStyle(h,c.ScaleY/c.Zoom),this.FStyle.ApplyTempStyle(p),c.Print&&this.FStyle.PrintTextBlack&&(h.font.color=Ft.Black),F=this.FStyle.TextStyles[p].FontHeight);var R=void 0;switch(this.FStyle.ParaStyles[A.ParaNo].AlignVert){case Gn.Center:R=C.top+Math.trunc((C.bottom-C.top-F)/2);break;case Gn.Top:R=C.top;break;default:R=C.bottom-F}if(this.FStyle.TextStyles[p].BackColor!==Yl.HCTransparentColor&&(c.Print&&this.FStyle.PrintTextBlack||(h.brush.color=this.FStyle.TextStyles[p].BackColor,h.fillRect(nt.Create(C.left,C.top,C.left+I.width,C.bottom)))),P=A.Text.substr(I.CharOffs-1,I.CharLen),this.DrawItemPaintContent(this,I.ItemNo,x,g,C,P,t,i,n,o,s,h,c),c.Print||(S?(h.brush.color=this.FStyle.SelColor,h.fillRect(nt.Create(g.left,g.top,g.left+I.width,Math.min(g.bottom,s)))):d>=0&&(h.brush.color=this.FStyle.SelColor,u===d&&x===u?h.fillRect(nt.Create(g.left+this.GetDrawItemOffsetWidth(x,f),g.top,g.left+this.GetDrawItemOffsetWidth(x,m,this.FStyle.TempCanvas),Math.min(g.bottom,s))):x===u?h.fillRect(nt.Create(g.left+this.GetDrawItemOffsetWidth(x,f,this.FStyle.TempCanvas),g.top,g.right,Math.min(g.bottom,s))):x===d?h.fillRect(nt.Create(g.left,g.top,g.left+this.GetDrawItemOffsetWidth(x,m,this.FStyle.TempCanvas),Math.min(g.bottom,s))):x>u&&x<d&&h.fillRect(g))),A.PaintTo(this.FStyle,C,e,n,o,s,h,c),""!==P){if(!c.Print||!A.PrintInvisible){switch(h.brush.style=Mt.Clear,this.hcl.hc.PAINTTEXTEVENT&&A.PaintTextBefor(this.FStyle,g,C,h,c),k){case Ln.Left:case Ln.Right:case Ln.Center:case Ln.Justify:case Ln.Scatter:this.DrawTextJsutify(h,x,C,P,this.IsLineLastDrawItem(x),R)}this.hcl.hc.PAINTTEXTEVENT&&A.PaintTextAfter(this.FStyle,g,C,h,c),this.FStyle.TextStyles[p].FontStyles.has(kt)&&(h.drawLineDriect(C.left,C.bottom-1,C.right,C.bottom-1),h.drawLineDriect(C.left,C.bottom+1,C.right,C.bottom+1))}}else if(this.hcl.hc.CHECKNULLITEM&&!A.ParaFirst)throw console.error(Yl.HCS_EXCEPTION_NULLTEXT,this,I.ItemNo,A),Yl.HCS_EXCEPTION_NULLTEXT}this.DrawItemPaintAfter(this,I.ItemNo,x,g,C,t,i,n,o,s,h,c)}else this.DrawItemPaintAfter(this,I.ItemNo,x,g,C,t,i,n,o,s,h,c)}finally{h.restore()}}}},{key:"PaintData",value:function(t,e,i,n,o,s,r,a,l){if(0!=this.FItems.count){var h=-1,c=-1,u=e-r,f=this.GetDataDrawItemRang(Math.max(e,o)-u,Math.min(n,s)-u,h,c);h=f.a,c=f.b,this.PaintDataRange(t,e,i,n,o,s,r,h,c,a,l)}}},{key:"GetLineBlankSpace",value:function(t){var e=t,i=-1,n=this.GetLineDrawItemRang(e,i);e=n.a,i=n.b;var o,s,r=0;o=e;for(var a=e;a<=i;a++)(s=this.GetDrawItemStyle(a)<oo.Null?this.FItems[this.FDrawItems[a].ItemNo].Height:this.FStyle.TextStyles[this.FItems[this.FDrawItems[a].ItemNo].StyleNo].FontHeight)>r&&(r=s,o=a);var l=this.GetDrawItemStyle(o);return l<oo.Null?l==oo.Bullet?this.GetDrawItemLineSpace(o)-r:this.FStyle.LineSpaceMin:this.GetDrawItemLineSpace(o)-r}},{key:"GetDrawItemLineSpace",value:function(t){var e=this.FStyle.LineSpaceMin,i=this.GetDrawItemStyle(t);return i>=oo.Null?e=this.CalculateLineHeight(this.FStyle.TextStyles[this.GetDrawItemStyle(t)],this.FStyle.ParaStyles[this.GetDrawItemParaStyle(t)]):i==oo.Bullet&&(i=this.FItems[this.FDrawItems[t].ItemNo].TextStyleNo,e=this.CalculateLineHeight(this.FStyle.TextStyles[i],this.FStyle.ParaStyles[this.GetDrawItemParaStyle(t)])),e}},{key:"SelectStartItemBoundary",value:function(){return this.FSelectInfo.StartItemNo>=0&&(0===this.FSelectInfo.StartItemOffset||this.FSelectInfo.StartItemOffset===this.GetItemOffsetAfter(this.FSelectInfo.StartItemNo))}},{key:"SelectExists",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!1;return this.FSelectInfo.StartItemNo>=0&&(this.FSelectInfo.EndItemNo>=0?e=this.FSelectInfo.StartItemNo!=this.FSelectInfo.EndItemNo||this.FSelectInfo.StartItemOffset!=this.FSelectInfo.EndItemOffset:t&&this.FItems[this.FSelectInfo.StartItemNo].StyleNo<oo.Null&&(e=this.FItems[this.FSelectInfo.StartItemNo].SelectExists())),e}},{key:"MarkStyleUsed",value:function(t){for(var e,i=0;i<=this.FItems.count-1;i++)e=this.FItems[i],t?(this.FStyle.ParaStyles[e.ParaNo].CheckSaveUsed=!0,e.StyleNo<oo.Null?e.MarkStyleUsed(t):this.FStyle.TextStyles[e.StyleNo].CheckSaveUsed=!0):(e.ParaNo=this.FStyle.ParaStyles[e.ParaNo].TempNo,e.StyleNo<oo.Null?e.MarkStyleUsed(t):e.StyleNo=this.FStyle.TextStyles[e.StyleNo].TempNo)}},{key:"SaveItemToStream",value:function(t,e,i,n,o){var s=t.position;t.writeUInt64(s);var r=n-e+1;t.writeInt32(r);var a=0;if(r>0){var l=!1;if(e!==n){this.DoSaveItem(e)?(this.FItems[e].SaveToStreamRange(t,i,this.FItems[e].Length),a++):l=this.FItems[e].ParaFirst;for(var h=e+1;h<=n-1;h++)if(this.DoSaveItem(h)){if(l&&!this.FItems[h].ParaFirst){this.FItems[h].ParaFirst=!0;try{this.FItems[h].SaveToStream(t)}finally{this.FItems[h].ParaFirst=!1}l=!1}else this.FItems[h].SaveToStream(t);a++}else l=l||this.FItems[h].ParaFirst;if(this.DoSaveItem(n))if(n>0&&0===o)(this.FItems[n].ParaFirst||l)&&(this.SaveParaFirstState(n,t),a++);else{if(l&&!this.FItems[n].ParaFirst){this.FItems[n].ParaFirst=!0;try{this.FItems[n].SaveToStreamRange(t,0,o)}finally{this.FItems[n].ParaFirst=!1}}else this.FItems[n].SaveToStreamRange(t,0,o);a++}}else this.DoSaveItem(n)&&(n>0&&0===o?(this.FItems[n].ParaFirst||l)&&(this.SaveParaFirstState(n,t),a++):(this.FItems[e].SaveToStreamRange(t,i,o),a++))}var c=t.position;t.position=s,s=c-s-8,t.writeUInt64(s),r!==a&&t.writeInt32(a),t.position=c}},{key:"JSONItemsToStream",value:function(t,e,i){for(var n=null,o=null,s=0,r=t.length,a=oo.Null,l=0;l<r;l++){if(null!=(n=t[l]).StyleNo?o=this.CreateItemByStyle(n.StyleNo):(o=this.CreateDefaultTextItem()).StyleNo=this.FStyle.GetDefaultStyleNo(),o.ParseJSONObject(n),o.ParaFirst)if(null!=n.ParaStyle){var h=new Vn(this.hcl);h.ParseJSONObject(n.ParaStyle),a=this.FStyle.GetParaNo(h,!0),h.dispose(),h=null}else a=oo.Null;if(a>oo.Null&&(o.ParaNo=a),null!=n.TextStyle){var c=new zn(this.hcl);o.StyleNo>oo.Null?(null!=e?c.AssignEx(e.TextStyles[o.StyleNo]):c.AssignEx(this.FStyle.TextStyles[this.FStyle.GetDefaultStyleNo()]),c.ParseJSON(n.TextStyle),o.StyleNo=this.FStyle.GetStyleNo(c,!0)):o instanceof hs&&(null!=e?c.AssignEx(this.FStyle.TextStyles[o.TextStyleNo]):c.AssignEx(this.FStyle.TextStyles[this.FStyle.GetDefaultStyleNo()]),c.ParseJSON(n.TextStyle),o.TextStyleNo=this.FStyle.GetStyleNo(c,!0)),c.dispose(),c=null}else null==e&&(o.StyleNo>oo.Null?o.StyleNo=this.FStyle.GetDefaultStyleNo():o instanceof hs&&(o.TextStyleNo=this.FStyle.GetDefaultStyleNo()));o.SaveToStream(i),s++,o.StyleNo===oo.Domain&&null!=n.Items&&(s+=this.JSONItemsToStream(n.Items,e,i),o.MarkType=ch.End,o.SaveToStream(i),s++),o=null}return s}},{key:"DataJSONToStream",value:function(t,e,i){var n=i.position;i.writeUInt64(n);var o=t.length,s=i.position;if(i.writeInt32(o),0!==o){this.FStyle.UseResWaite++;try{var r=this.JSONItemsToStream(t,e,i);if(r!=o){var a=i.position;i.position=s,i.writeInt32(r),i.position=a}}finally{this.FStyle.UseResWaite--}var l=i.position;i.position=n,n=l-n-8,i.writeUInt64(n),i.position=l}}},{key:"SaveToStream",value:function(t){this.SaveToStreamRange(t,0,0,this.FItems.count-1,this.FItems.last.Length)}},{key:"SaveParaFirstState",value:function(t,e){var i=this.CreateDefaultTextItem();this.FItems[t].StyleNo>oo.Null?i.StyleNo=this.FItems[t].StyleNo:this.FItems[t].isClass(hs)?i.StyleNo=this.FItems[t].TextStyleNo:this.FItems[t].StyleNo===oo.Domain&&(i.StyleNo=this.FItems[t].GetTextStyleNo()),i.ParaNo=this.FItems[t].ParaNo,i.FormatDirection=this.FItems[t].FormatDirection,i.ParaFirst=!0,i.SaveToStreamRange(e,0,0),i=null}},{key:"SaveToStreamRange",value:function(t,e,i,n,o){this.SaveItemToStream(t,e,i,n,o)}},{key:"SaveToStreamRangeAll",value:function(t){this.SaveToStreamRange(t,0,0,this.FItems.count-1,this.GetItemOffsetAfter(this.FItems.count-1))}},{key:"SaveToText",value:function(){return this.SaveToTextRange(0,0,this.FItems.count-1,this.GetItemOffsetAfter(this.FItems.count-1))}},{key:"SaveToTextRange",value:function(t,e,i,n){var o="";if(i-t+1>0)if(t!==i){var s=!1;this.FItems[t].Visible&&this.DoSaveItem(t)?o=this.FItems[t].StyleNo>oo.Null?this.FItems[t].SubStringEffective(e+1,this.FItems[t].Length-e):this.FItems[t].TextEffective():s=this.FItems[t].ParaFirst;for(var r="",a=t+1;a<=i-1;a++)this.FItems[a].Visible&&this.DoSaveItem(a)?(r=this.FItems[a].TextEffective(),s||this.FItems[a].ParaFirst?o+=Yl.sLineBreak+r:o+=r,s&&!this.FItems[a].ParaFirst&&(s=!1)):s=s||this.FItems[a].ParaFirst;this.FItems[i].Visible&&this.DoSaveItem(i)&&(this.FItems[i].StyleNo>oo.Null?((s||this.FItems[i].ParaFirst)&&(o+=Yl.sLineBreak),o+=this.FItems[i].SubStringEffective(1,n)):((s||this.FItems[i].ParaFirst)&&(o+=Yl.sLineBreak),o+=this.FItems[i].TextEffective()))}else this.FItems[t].Visible&&this.DoSaveItem(t)&&(o=this.FItems[t].StyleNo>oo.Null?this.FItems[t].SubStringEffective(e+1,n-e):this.FItems[t].TextEffective());return o}},{key:"SaveSelectToStream",value:function(t){this.SelectExists()?this.FSelectInfo.EndItemNo<0&&this.FItems[this.FSelectInfo.StartItemNo].StyleNo<oo.Null?this.FItems[this.FSelectInfo.StartItemNo].IsSelectComplateTheory()?this.SaveToStreamRange(t,this.FSelectInfo.StartItemNo,Yl.OffsetBefor,this.FSelectInfo.StartItemNo,Yl.OffsetAfter):this.FItems[this.FSelectInfo.StartItemNo].SaveSelectToStream(t):this.SaveToStreamRange(t,this.FSelectInfo.StartItemNo,this.FSelectInfo.StartItemOffset,this.FSelectInfo.EndItemNo,this.FSelectInfo.EndItemOffset):t.writeUInt64(0)}},{key:"SaveSelectToText",value:function(){var t="";return this.SelectExists()&&(t=this.FSelectInfo.EndItemNo<0&&this.FItems[this.FSelectInfo.StartItemNo].StyleNo<oo.Null?this.FItems[this.FSelectInfo.StartItemNo].SaveSelectToText():this.SaveToTextRange(this.FSelectInfo.StartItemNo,this.FSelectInfo.StartItemOffset,this.FSelectInfo.EndItemNo,this.FSelectInfo.EndItemOffset)),t}},{key:"GetSelectText",value:function(){return this.SaveSelectToText()}},{key:"InsertStream",value:function(t,e,i){return!1}},{key:"LoadFromStream",value:function(t,e,i){this.FLoading=!0;try{this.DoLoadFromStream(t,e,i)}finally{this.FLoading=!1}}},{key:"SelectToHtml",value:function(){var t="";return this.SelectExists()&&(t=this.FSelectInfo.EndItemNo<0&&this.FItems[this.FSelectInfo.StartItemNo].StyleNo<oo.Null?this.FItems[this.FSelectInfo.StartItemNo].IsSelectComplateTheory()?this.FItems[this.FSelectInfo.StartItemNo].ToHtml():this.FItems[this.FSelectInfo.StartItemNo].SelectToHtml():this.ToHtmlRange(this.FSelectInfo.StartItemNo,this.FSelectInfo.StartItemOffset,this.FSelectInfo.EndItemNo,this.FSelectInfo.EndItemOffset)),t}},{key:"ToHtmlRange",value:function(t,e,i,n){var o="";if(t!==i){var s=this.FItems[t];o='<p class="ps'+s.ParaNo.toString()+'">',s.Visible?s.StyleNo>oo.Null?o+='<a class="fs'+s.StyleNo.toString()+'" sm="[23,4,55,6,73,234]">'+s.SubStringEffective(e+1,s.Length-e).replace(new RegExp(" ","g"),"&ensp;")+"</a>":o+=s.SelectToHtml():vParaFirstTemp=this.FItems[t].ParaFirst;for(var r=t+1;r<i;r++)this.FItems[r].Visible&&(this.FItems[r].ParaFirst&&(o+='</p><p class="ps'+this.FItems[r].ParaNo.toString()+'">'),this.FItems[r].StyleNo>oo.Null?o+='<a class="fs'+this.FItems[r].StyleNo.toString()+'" sm="[23,4,55,6,73,234]">'+this.FItems[r].TextEffective().replace(new RegExp(" ","g"),"&ensp;")+"</a>":o+=this.FItems[r].ToHtml());(s=this.FItems[i]).ParaFirst&&(o+='</p><p class="ps'+s.ParaNo.toString()+'">'),s.Visible&&(s.StyleNo>oo.Null?o+='<a class="fs'+s.StyleNo.toString()+'" sm="[23,4,55,6,73,234]">'+s.SubStringEffective(1,n).replace(new RegExp(" ","g"),"&ensp;")+"</a>":o+=s.SelectToHtml()),o+="</p>"}else{var a=this.FItems[t];o='<p class="ps'+a.ParaNo.toString()+'">',a.Visible&&(a.StyleNo>oo.Null?o+='<a class="fs'+a.StyleNo.toString()+'" sm="[23,4,55,6,73,234]">'+a.SubStringEffective(e+1,n-e).replace(new RegExp(" ","g"),"&ensp;")+"</a>":o+=a.ToHtml()),o+="</p>"}return o}},{key:"ToHtml",value:function(t,e){for(var i="",n=t||0,o=e||this.FItems.count-1,s=n;s<=o;s++)this.FItems[s].Visible&&(this.FItems[s].ParaFirst&&(0!==s&&(i+="</p>"),i+='<p class="ps'+this.FItems[s].ParaNo.toString()+'">'),i+=this.FItems[s].ToHtml());return i+"</p>"}},{key:"ToXml",value:function(t){var e;t.SetAttribute("itemcount",this.FItems.count.toString());for(var i=0;i<this.FItems.count;i++)e=jn.Create("item"),this.FItems[i].ToXml(e),t.AppendChild(e)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.ToJSONStringRange(0,this.FItems.count-1,t,e)}},{key:"ItemRangeToJSONString",value:function(t,e){return""}},{key:"ToJSONStringRange",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return'"Items":['+this.ItemRangeToJSONString(t,e,i,n)+"]"}},{key:"ParseJSONObject",value:function(t){this.Clear()}},{key:"ParentData",get:function(){return this.FParentData},set:function(t){this.FParentData=t}},{key:"Style",get:function(){return this.FStyle}},{key:"CurStyleNo",get:function(){return this.FCurStyleNo},set:function(t){this.SetCurStyleNo(t)}},{key:"CurParaNo",get:function(){return this.FCurParaNo},set:function(t){this.SetCurParaNo(t)}},{key:"Items",get:function(){return this.FItems}},{key:"DrawItems",get:function(){return this.FDrawItems}},{key:"SelectInfo",get:function(){return this.FSelectInfo}},{key:"CaretDrawItemNo",get:function(){return this.FCaretDrawItemNo},set:function(t){this.SetCaretDrawItemNo(t)}}]),i}(tt);function Ys(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Qs=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];r()(this,t),this.x=0,this.y=0,this.boundary=e}return l()(t,[{key:"equal",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"reset",value:function(t,e){this.x=t,this.y=e,this.boundary=!1}},{key:"resetByPoint",value:function(t){this.reset(t.x,t.y)}}],[{key:"Create",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=new t;return o.x=e,o.y=i,o.boundary=n,o}},{key:"CreateByPoint",value:function(e){return t.Create(e.x,e.y)}}]),t}(),Xs=function(t){m()(i,t);var e=Ys(i);function i(){var t;return r()(this,i),(t=e.call(this)).rbIndex=0,t}return l()(i)}(ot),Zs=function(t){m()(i,t);var e=Ys(i);function i(){return r()(this,i),e.call(this)}return l()(i,[{key:"_rectSort",value:function(t,e){var i=t.y-e.y;if(i<0)return-1;if(i>0)return 1;var n=t.x-e.x;return n<0?-1:n>0?1:0}},{key:"_addRectPath",value:function(t){if(t.left!==t.right&&t.top!==t.bottom){var e,i=Qs.CreateByPoint(t.leftTop),n=Qs.CreateByPoint(t.rightTop),o=Qs.CreateByPoint(t.rightBottom),s=Qs.CreateByPoint(t.leftBottom);if(0==this.count)return(e=new Xs).add(i),e.add(n),e.add(o),e.add(s),e.rbIndex=2,void this.add(e);var r,a=!1;if(r=(e=this.last)[e.rbIndex],s.equal(r)||s.equal(e[e.rbIndex+1]))e[e.rbIndex-1].resetByPoint(n),r.resetByPoint(o),a=!0;if(a||((e=new Xs).add(i),e.add(n),e.add(o),e.add(s),e.rbIndex=2,this.add(e)),this.count>1){e=this.last;var l=this[this.count-2],h=e[0],c=e[1];h.y==l[l.rbIndex].y&&c.x>l[l.rbIndex+1].x&&(h.x==l[l.rbIndex+1].x?l[l.rbIndex+1].resetByPoint(e[3]):(l.insert(l.rbIndex+1,e[0]),l.insert(l.rbIndex+1,e[3])),l.insert(l.rbIndex+1,e[2]),l.insert(l.rbIndex+1,e[1]),l.rbIndex+=2,this.delete(this.count-1))}}}},{key:"combineRect",value:function(t){this._addRectPath(t)}},{key:"frameRgn",value:function(t){var e;t.beginPath();for(var i=0;i<this.count;i++){e=this[i];for(var n=1;n<e.length;n++)e[n].x===e[n-1].x?(e[n].boundary=!0,e[n-1].boundary=!0):e[n].boundary=!1;t.h5context.moveTo(e[0].x+.5,e[0].y+.5);for(var o=1;o<e.length;o++)e[o].boundary?t.h5context.lineTo(e[o].x-.5,e[o].y+.5):t.h5context.lineTo(e[o].x+.5,e[o].y+.5);t.h5context.lineTo(e[0].x+.5,e[0].y+.5)}t.paintPath()}}]),i}(ot);function qs(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var $s=0,tr=1,er=2,ir=3,nr=4,or=5,sr=6,rr=l()((function t(){r()(this,t),this.TableSite=$s,this.DestX=0,this.DestY=0})),ar=l()((function t(){r()(this,t),this.Row=-1,this.Leftside=!0})),lr=function(){function t(){r()(this,t),this.StartRow=-1,this.StartCol=-1,this.EndRow=-1,this.EndCol=-1}return l()(t,[{key:"SelectCellRang",value:function(){this.Initialize()}},{key:"Initialize",value:function(){this.StartRow=-1,this.StartCol=-1,this.InitializeEnd()}},{key:"InitializeEnd",value:function(){this.EndRow=-1,this.EndCol=-1}},{key:"SetStart",value:function(t,e){this.StartRow=t,this.StartCol=e}},{key:"SetEnd",value:function(t,e){this.EndRow=t,this.EndCol=e}},{key:"EditCell",value:function(){return this.StartRow>=0&&this.EndRow<0}},{key:"SameRow",value:function(){return this.StartRow>=0&&this.StartRow==this.EndRow}},{key:"SameCol",value:function(){return this.StartCol>=0&&this.StartCol==this.EndCol}},{key:"SelectExists",value:function(){return this.StartRow>=0&&this.EndRow>=0}}]),t}(),hr=0,cr=1,ur=2,fr=function(t){m()(i,t);var e=qs(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t)).FCellData=new Yl.TableCellData(t,n),o.FAlignVert=hr,o.FBorderSides=new uh,o.FBorderSides.add(Zl.Left),o.FBorderSides.add(Zl.Top),o.FBorderSides.add(Zl.Right),o.FBorderSides.add(Zl.Bottom),o.FBackgroundColor=Ft.Transparent,o.FRowSpan=0,o.FColSpan=0,o.FWidth=0,o.FHeight=0,o.RightOffset=0,o.KeepPageOffs=0,o.LeftBorderStyle=_t.Solid,o.TopBorderStyle=_t.Solid,o.RightBorderStyle=_t.Solid,o.BottomBorderStyle=_t.Solid,o.LTRBBorderStyle=_t.Solid,o.RTLBBorderStyle=_t.Solid,o}return l()(i,[{key:"GetActive",value:function(){return null!==this.FCellData&&this.FCellData.Active}},{key:"SetActive",value:function(t){null!==this.FCellData&&(this.FCellData.Active=t)}},{key:"SetHeight",value:function(t){this.FHeight!==t&&(this.FHeight=t,null!=this.FCellData&&(this.FCellData.CellHeight=t))}},{key:"GetContentAlign",value:function(){var t=0;switch(t=this.CellData.GetActiveItemNo()>=0?this.CellData.GetActiveItem().ParaNo:this.CellData.Items[0].ParaNo,this.CellData.Style.ParaStyles[t].AlignHorz){case Ln.Center:switch(this.FAlignVert){case hr:return ih.TopCenter;case cr:return ih.CenterCenter;case ur:return ih.BottomCenter}break;case Ln.Right:switch(this.FAlignVert){case hr:return ih.TopRight;case cr:return ih.CenterRight;case ur:return ih.BottomRight}break;default:switch(this.FAlignVert){case hr:return ih.TopLeft;case cr:return ih.CenterLeft;case ur:return ih.BottomLeft}}return ih.TopLeft}},{key:"dispose",value:function(){f()(F()(i.prototype),"dispose",this).call(this),null!=this.FCellData&&this.FCellData.dispose()}},{key:"Assign",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.FRightOffset=t.RightOffset,this.FBackgroundColor=t.BackgroundColor,this.FAlignVert=t.AlignVert,this.FBorderSides.value=t.BorderSides.value,this.LeftBorderStyle=t.LeftBorderStyle,this.TopBorderStyle=t.TopBorderStyle,this.RightBorderStyle=t.RightBorderStyle,this.BottomBorderStyle=t.BottomBorderStyle,this.LTRBBorderStyle=t.LTRBBorderStyle,this.RTLBBorderStyle=t.RTLBBorderStyle,null!==this.FCellData&&null!==t.CellData&&(e?(this.FCellData.Items[0].StyleNo>oo.Null&&t.CellData.Items[0].StyleNo>oo.Null&&(this.FCellData.Items[0].StyleNo=t.CellData.Items[0].StyleNo),this.FCellData.Items[0].ParaNo=t.CellData.Items[0].ParaNo):this.FCellData.Clone(t.CellData))}},{key:"MouseDown",value:function(t,e,i){if(this.Active=!0,null!==this.FCellData){var n=new fi;n.assign(t),n.x-=e,n.y-=this.GetCellDataTop(i),this.FCellData.MouseDown(n)}}},{key:"MouseMove",value:function(t,e,i){if(null!==this.FCellData){var n=new fi;n.assign(t),n.x-=e,n.y-=this.GetCellDataTop(i),this.FCellData.MouseMove(n)}}},{key:"MouseUp",value:function(t,e,i){if(null!==this.FCellData){var n=new fi;n.assign(t),n.x-=e,n.y-=this.GetCellDataTop(i),this.FCellData.MouseUp(n)}}},{key:"IsMergeSource",value:function(){return null===this.FCellData}},{key:"IsMergeDest",value:function(){return this.FRowSpan>0||this.FColSpan>0}},{key:"ClearFormatExtraHeight",value:function(){return null!==this.FCellData?this.FCellData.ClearFormatExtraHeight():0}},{key:"SaveToStream",value:function(t){t.writeInt32(this.FWidth),t.writeInt32(this.FHeight),t.writeInt32(this.FRowSpan),t.writeInt32(this.FColSpan),t.writeInt32(this.RightOffset),t.writeByte(this.FAlignVert),Yl.HCSaveColorToStream(this.hcl,t,this.FBackgroundColor),t.writeByte(this.FBorderSides.value),t.writeByte(this.LeftBorderStyle),t.writeByte(this.TopBorderStyle),t.writeByte(this.RightBorderStyle),t.writeByte(this.BottomBorderStyle),t.writeByte(this.LTRBBorderStyle),t.writeByte(this.RTLBBorderStyle);var e=null===this.FCellData;t.writeBoolean(e),e||this.FCellData.SaveToStream(t)}},{key:"LoadFromStream",value:function(t,e,i){this.FWidth=t.readInt32(),this.FHeight=t.readInt32(),this.FRowSpan=t.readInt32(),this.FColSpan=t.readInt32(),this.RightOffset=i>58?t.readInt32():0,i>11&&(this.FAlignVert=t.readByte(),this.FBackgroundColor=Yl.HCLoadColorFromStream(t)),i>13&&(this.FBorderSides.value=t.readByte()),i>66?(this.LeftBorderStyle=t.readByte(),this.TopBorderStyle=t.readByte(),this.RightBorderStyle=t.readByte(),this.BottomBorderStyle=t.readByte(),this.LTRBBorderStyle=t.readByte(),this.RTLBBorderStyle=t.readByte()):(this.LeftBorderStyle=_t.Solid,this.TopBorderStyle=_t.Solid,this.RightBorderStyle=_t.Solid,this.BottomBorderStyle=_t.Solid,this.LTRBBorderStyle=_t.Solid,this.RTLBBorderStyle=_t.Solid),t.readBoolean()?(this.FRowSpan<0||this.FColSpan<0)&&(this.FCellData.dispose(),this.FCellData=null):(this.FCellData.LoadFromStream(t,e,i),this.FCellData.CellHeight=this.FHeight)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i="";return null!==this.FCellData&&(i=this.FCellData.ToJSONString(t,e)),t||(i+=""!==i?',"AlignVert":'+this.FAlignVert:'"AlignVert":'+this.FAlignVert),i}},{key:"ToXml",value:function(t){}},{key:"ParseXml",value:function(t){}},{key:"GetCellDataTop",value:function(t){if(this.KeepPageOffs<0)return t;switch(this.FAlignVert){case hr:return t;case cr:return t+Math.trunc((this.FHeight-this.KeepPageOffs-t-this.FCellData.height-t)/2);default:return this.FHeight-this.KeepPageOffs-t-this.FCellData.height}}},{key:"GetCaretInfo",value:function(t,e,i,n,o){null!==this.FCellData?(this.FCellData.GetCaretInfo(t,e,o),o.Visible&&(o.X+=i,o.Y+=this.GetCellDataTop(n))):o.Visible=!1}},{key:"SetCaretRequest",value:function(){null!==this.FCellData&&this.FCellData.ItemSetCaretRequest(0,0)}},{key:"PaintTo",value:function(t,e,i,n,o,s,r,a,l,h,c){if(null!==this.FCellData){var u=e+this.GetCellDataTop(l);this.FCellData.PaintData(t+a,u,i-a,n,o,s,r,h,c)}}},{key:"CellData",get:function(){return this.FCellData},set:function(t){this.FCellData=t}},{key:"Width",get:function(){return this.FWidth},set:function(t){this.FWidth=t}},{key:"Height",get:function(){return this.FHeight},set:function(t){this.SetHeight(t)}},{key:"RowSpan",get:function(){return this.FRowSpan},set:function(t){this.FRowSpan=t}},{key:"ColSpan",get:function(){return this.FColSpan},set:function(t){this.FColSpan=t}},{key:"BackgroundColor",get:function(){return this.FBackgroundColor},set:function(t){this.FBackgroundColor=t}},{key:"Active",get:function(){return this.GetActive()},set:function(t){this.SetActive(t)}},{key:"AlignVert",get:function(){return this.FAlignVert},set:function(t){this.FAlignVert=t}},{key:"ContentAlign",get:function(){return this.GetContentAlign()}},{key:"BorderSides",get:function(){return this.FBorderSides},set:function(t){this.FBorderSides=t}}]),i}(tt);function dr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var mr=function(t){m()(i,t);var e=dr(i);function i(t,n,o){var s;r()(this,i),(s=e.call(this)).hcl=t,s.FHeight=10,s.FFmtOffset=0,s.FAutoHeight=!0,s.FOnGetVPaddingPix=null;for(var a=0;a<o;a++)s.add(s.DoCreateCell(n));return s}return l()(i,[{key:"CalcMaxCellDataHeight",value:function(){for(var t=Yl.MinRowHeight,e=0,i=this.count;e<i;e++)null!==this[e].CellData&&0===this[e].RowSpan&&this[e].CellData.height>t&&(t=this[e].CellData.height);return t}},{key:"SetRowWidth",value:function(t){for(var e=Math.trunc(t/this.count),i=0;i<=this.count-2;i++)this[i].Width=e;this.last.Width=t-(this.count-1)*e}},{key:"CalcNorHeight",value:function(){return this.CalcMaxCellDataHeight()+this.GetVPadding()+this.GetVPadding()}},{key:"RecoverNorHeight",value:function(){this.FHeight=this.CalcNorHeight(),this.FAutoHeight=!0;for(var t=0,e=this.count;t<e;t++)this[t].Height=this.FHeight}},{key:"SetHeight",value:function(t){if(this.FHeight!=t){var e=this.CalcNorHeight();this.FHeight=e<t?t:e;for(var i=0,n=this.count;i<n;i++)this[i].Height=this.FHeight}}},{key:"GetVPadding",value:function(){return null!=this.FOnGetVPaddingPix?this.FOnGetVPaddingPix():0}},{key:"DoCreateCell",value:function(t){return new fr(this.hcl,t)}},{key:"Assign",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e?this.FAutoHeight=!0:(this.FAutoHeight=t.AutoHeight,this.FAutoHeight||(this.FHeight=t.Height));for(var i=Math.min(this.ColCount,t.ColCount),n=0;n<i;n++)this[n].Assign(t[n],e)}},{key:"FormatInit",value:function(){var t=this.CalcNorHeight();this.FAutoHeight?this.FHeight=t:this.FHeight<t&&(this.FHeight=t,this.FAutoHeight=!0);for(var e=0,i=this.count;e<i;e++)this[e].Height=this.FHeight}},{key:"CreateCell",value:function(t){return this.DoCreateCell(t)}},{key:"SaveToStream",value:function(t){}},{key:"LoadFromStream",value:function(t,e){}},{key:"CellsToJSONString",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i="",n="",o=0,s=this.count;o<s;o++)n=this[o].ToJSONString(t,e),t?""!==n&&(i+=n+","):i+="{"+n+"},";return","===i[i.length-1]&&(i=i.substring(0,i.length-1)),i}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?this.CellsToJSONString(t,e):'"AutoHeight":'+this.FAutoHeight+',"Cells":['+this.CellsToJSONString(t,e)+"]"}},{key:"ToXml",value:function(t){}},{key:"ParseXml",value:function(t){}},{key:"ColCount",get:function(){return this.count}},{key:"Height",get:function(){return this.FHeight},set:function(t){this.SetHeight(t)}},{key:"AutoHeight",get:function(){return this.FAutoHeight},set:function(t){this.FAutoHeight=t}},{key:"FmtOffset",get:function(){return this.FFmtOffset},set:function(t){this.FFmtOffset=t}},{key:"OnGetVPaddingPix",get:function(){return this.FOnGetVPaddingPix},set:function(t){this.FOnGetVPaddingPix=t}}]),i}(ot);function Sr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var pr=l()((function t(){r()(this,t),this.PageIndex=-1,this.Row=-1,this.Col=-1,this.DrawItemNo=-1,this.BreakSeat=0,this.BreakBottom=0})),yr=function(t){m()(i,t);var e=Sr(i);function i(){var t;return r()(this,i),(t=e.call(this)).FOnRowAdd=null,t}return l()(i,[{key:"doAdded_",value:function(t){f()(F()(i.prototype),"doAdded_",this).call(this,t),null!=this.FOnRowAdd&&this.FOnRowAdd(t)}},{key:"onRowAdd",get:function(){return this.FOnRowAdd},set:function(t){this.FOnRowAdd=t}}]),i}(ot),Fr=l()((function t(){r()(this,t),this.Col=-1,this.DrawItemNo=-1,this.VDrawOffset=0})),vr=function(){function t(){r()(this,t),this.FEnable=!1,this.Row=-1,this.Col=-1}return l()(t,[{key:"SetEnable",value:function(t){this.FEnable!=t&&(this.FEnable=t,this.FEnable&&this.Init(-1,-1))}},{key:"Init",value:function(t,e){this.Row=t,this.Col=e}},{key:"Enable",get:function(){return this.FEnable},set:function(t){this.SetEnable(t)}}]),t}(),Ir=function(t){m()(i,t);var e=Sr(i);function i(t,n,o,s,a){var l;return r()(this,i),l=e.call(this,t,n),0==o&&l.hcl.exception("异常：不能创建行数为0的表格！"),0==s&&l.hcl.exception("异常：不能创建列数为0的表格！"),l.StyleNo=oo.Table,l.ParaNo=n.CurParaNo,l.GripSize=2,l.FBorderWidthPix=0,l.FCellHPaddingPix=2,l.FCellVPaddingPix=2,l.BorderWidthPt=.5,l.CellVPaddingMM=0,l.CellHPaddingMM=.5,l.FOutsideInfo=new ar,l.FMouseDownRow=-1,l.FMouseDownCol=-1,l.FMouseMoveRow=-1,l.FMouseMoveCol=-1,l.FMouseDownX=0,l.FMouseDownY=0,l.FFormatHeight=0,l.FDefaultRowHeight=Yl.MinRowHeight,l.FMouseDownResizeInfo=new rr,l.FMulCellUndo=new vr,l.FBorderVisible=!0,l.FMouseLBDowning=!1,l.FSelecting=!1,l.FDraging=!1,l.FOutSelectInto=!1,l.FResizeKeepWidth=!1,l.FBorderColor="#000000",l.FFixColor=Yl.clBtnFace,l.BorderWidthPt=.5,l.FSelectCellRang=new lr,l.FColWidths=new ot,l.FRows=new yr,l.FRows.onRowAdd=function(t){l.DoRowAdd(t)},l.FRows.onRemoved=function(t){l.DoRowRemove(t)},l.FRowCacheCount=50,l.FRowCache=new Array(0),l.ResetRowCol(a,o,s),l.FPageBreaks=new ot,l.CanPageBreak=!0,l.FMangerUndo=!0,l.FOnCellPaintBK=null,l.FOnCellPaintData=null,l.OnKeyDown=null,l}return l()(i,[{key:"InitializeMouseInfo",value:function(){this.FMouseDownRow=-1,this.FMouseDownCol=-1,this.FMouseMoveRow=-1,this.FMouseMoveCol=-1}},{key:"InitializeCellData",value:function(t){var e=this;t.ParentData=this.OwnerData,t.OnInsertItem=function(t,i){e.OwnerData.OnInsertItem(t,i)},t.OnRemoveItem=function(t,i){e.OwnerData.OnRemoveItem(t,i)},t.OnSaveItem=function(t,i){return e.OwnerData.OnSaveItem(t,i)},t.OnAcceptActionBefor=function(t,i,n,o){return e.OwnerData.OnAcceptActionBefor(t,i,n,o)},t.OnAcceptAction=function(t,i,n,o){return e.OwnerData.OnAcceptAction(t,i,n,o)},t.OnSelectApplyTextStyle=function(t,i){return e.OwnerData.OnSelectApplyTextStyle(t,i)},t.OnItemMouseDown=function(t,i,n,o){e.OwnerData.OnItemMouseDown(t,i,n,o)},t.OnItemMouseUp=function(t,i,n,o){e.OwnerData.OnItemMouseUp(t,i,n,o)},t.OnDrawItemMouseMove=function(t,i,n,o,s){e.OwnerData.OnDrawItemMouseMove(t,i,n,o,s)},t.OnItemReFormatRequest=function(t,i){e.DoCellDataItemReFormatRequest(t,i)},t.OnItemSetCaretRequest=function(t,i,n){e.DoCellDataItemSetCaretRequest(t,i,n)},t.OnCreateItemByStyle=function(t,i){return e.OwnerData.OnCreateItemByStyle(t,i)},t.OnDrawItemPaintBefor=function(t,i,n,o,s,r,a,l,h,c,u,f){e.OwnerData.OnDrawItemPaintBefor(t,i,n,o,s,r,a,l,h,c,u,f)},t.OnDrawItemPaintContent=function(t,i,n,o,s,r,a,l,h,c,u,f,d){e.OwnerData.OnDrawItemPaintContent(t,i,n,o,s,r,a,l,h,c,u,f,d)},t.OnDrawItemPaintAfter=function(t,i,n,o,s,r,a,l,h,c,u,f){e.DoCellDataDrawItemPaintAfter(t,i,n,o,s,r,a,l,h,c,u,f)},this.hcl.hc.DOMAINPAINTEVENT&&(t.OnDomainDrawItemPaintBefor=function(t,i,n,o,s,r,a){e.OwnerData.OnDomainDrawItemPaintBefor(t,i,n,o,s,r,a)},t.OnDomainDrawItemPaintAfter=function(t,i,n,o,s,r,a){e.OwnerData.OnDomainDrawItemPaintAfter(t,i,n,o,s,r,a)}),t.OnInsertAnnotate=function(t,i){e.OwnerData.OnInsertAnnotate(t,i)},t.OnRemoveAnnotate=function(t,i){e.OwnerData.OnRemoveAnnotate(t,i)},t.OnDrawItemAnnotate=function(t,i,n,o){e.OwnerData.OnDrawItemAnnotate(t,i,n,o)},t.OnRequestAnnotateID=function(){return e.OwnerData.OnRequestAnnotateID()},t.OnCaretItemChanged=function(t,i){e.OwnerData.OnCaretItemChanged(t,i)},t.OnDomainSwitch=function(t,i,n){e.OwnerData.OnDomainSwitch(t,i,n)},t.OnChange=function(){e.OwnerData.OnChange()},t.OnItemChange=function(t,i,n,o){return e.DoCellDataItemChange(t,i,n,o)},t.OnDomainChange=function(t,i,n,o){return e.OwnerData.OnDomainChange(t,i,n,o)},t.OnCanNotEditNotify=function(t){e.OwnerData.OnCanNotEditNotify(t)},t.OnCanEditItem=function(t,i,n){return e.DoCellDataCanEditItem(t,i,n)},t.OnInsertTextBefor=function(t,i,n,o){return e.OwnerData.OnInsertTextBefor(t,i,n,o)},t.OnPaintDomainRegion=function(t,i){return e.OwnerData.OnPaintDomainRegion(t,i)},t.OnMatchTextStyleNoAt=function(t,i,n){return e.OwnerData.OnMatchTextStyleNoAt(t,i,n)},t.OnItemResized=function(t,i){e.OwnerData.OnItemResized(t,i)},t.OnCurParaNoChange=function(t){e.OwnerData.OnCurParaNoChange(t)},t.OnCreateItem=function(t){e.OwnerData.OnCreateItem(t)},t.OnGetUndoList=function(){return e.GetSelfUndoList()},t.OnGetRootData=function(){return e.DoCellDataGetRootData()},t.OnGetFormatCoord=function(t){return e.DoCellDataGetFormatCoord(t)},t.OnFormatDirty=function(){e.DoCellDataFormatDirty()},t.OnSetFormatHeightChange=function(){e.DoCellDataSetFormatHeightChange()},t.OnGetScreenCoord=function(t,i){return e.OwnerData.OnGetScreenCoord(t,i)},t.OnCheckInsertItemCount=function(t,i,n){return e.OwnerData.OnCheckInsertItemCount(t,i,n)},t.OnSelectBound=function(t){e.OwnerData.OnSelectBound(t)}}},{key:"DoCellDataCanEditItem",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.OwnerData.CanEditItem(t,e,i)}},{key:"DoCellDataGetRootData",value:function(){return this.OwnerData.GetRootData()}},{key:"DoCellDataFormatDirty",value:function(){this.FormatDirty()}},{key:"DoCellDataSetFormatHeightChange",value:function(){this.OwnerData.SetFormatHeightChange()}},{key:"_safeRowCol",value:function(t,e){return!(t<0||t>this.FRows.count-1)&&!(e<0||e>this.FColWidths.count-1)}},{key:"getCellText",value:function(t,e){if(this._safeRowCol(t,e))return null!==this.FRows[t][e].CellData?this.FRows[t][e].CellData.Items[0].Text:""}},{key:"setCellText",value:function(t,e,i){if(this._safeRowCol(t,e)){var n=this.FRows[t][e].CellData;if(null!==n){if(""==i&&n.Items.count>1&&!n.Items[1].ParaFirst)return;this.FRows[t][e].CellData.Items[0].Text=i}}}},{key:"setCellColor",value:function(t,e,i){this._safeRowCol(t,e)&&(this.FRows[t][e].BackgroundColor=i)}},{key:"DoColCountChange",value:function(){this._CacheDynamicAppendRow(!0)}},{key:"DoCellDataItemReFormatRequest",value:function(t,e){this.FormatDirty(),this.OwnerData.ItemReFormatRequest(this)}},{key:"DoCellDataItemSetCaretRequest",value:function(t,e,i){for(var n=-1,o=-1,s=0;s<this.RowCount&&!(n>=0);s++)for(var r=0;r<this.FColWidths.count;r++)if(this.FRows[s][r].CellData===t){n=s,o=r;break}n>=0&&(this.OwnerData.ItemSetCaretRequest(this.OwnerData.GetItemNo(this),Yl.OffsetInner),n===this.FSelectCellRang.StartRow&&o===this.FSelectCellRang.StartCol||(this.FMouseDownRow!==n&&this.FMouseDownCol!==o&&this.DoSelectCellChange(this.FMouseDownRow,this.FMouseDownCol,n,o),this.DisSelect(),this.FMouseDownRow=n,this.FMouseDownCol=o,this.FSelectCellRang.SetStart(n,o),this.FRows[n][o].CellData.Active=!0))}},{key:"DoCellDataGetFormatCoord",value:function(t){for(var e=0,i=Math.trunc(this.OwnerData.GetLineBlankSpace(this.FirstDItemNo)/2)+this.FBorderWidthPix,n=!1,o=null,s=new et,r=0;r<this.FRows.count&&!n;r++){e=this.FBorderWidthPix;for(var a=0;a<this.FColWidths.count;a++){if(null!==(o=this.FRows[r][a].CellData)&&o.equal(t)){i+=this.FCellVPaddingPix,e+=this.FCellHPaddingPix,n=!0;break}e+=this.FColWidths[a]+this.FBorderWidthPix}n||(i+=this.FRows[r].FmtOffset+this.FRows[r].Height+this.FBorderWidthPix)}var l=this.OwnerData.GetDrawItemFormatCoord(this.FirstDItemNo);return s.x=e+l.x,s.y=i+l.y,s}},{key:"DoSelectCellChange",value:function(t,e,i,n){}},{key:"DoRowAdd",value:function(t){var e=this;t.OnGetVPaddingPix=function(){return e.DoRowGetVPaddingPix()};for(var i=null,n=0;n<t.ColCount;n++)null!==(i=t[n].CellData)&&this.InitializeCellData(i)}},{key:"DoRowRemove",value:function(t){this.InitializeMouseInfo()}},{key:"DoRowGetVPaddingPix",value:function(){return this.FCellVPaddingPix}},{key:"CellChangeByAction",value:function(t,e,i){this.IsFormatDirty=!1,i(),this.IsFormatDirty||(this.IsFormatDirty=this.FRows[t][e].CellData.FormatHeightChange)}},{key:"GetFormatHeight",value:function(){this.FFormatHeight=this.FBorderWidthPix;for(var t=0;t<this.RowCount;t++)this.FFormatHeight=this.FFormatHeight+this.FRows[t].Height+this.FBorderWidthPix;return this.FFormatHeight}},{key:"CalcRowCellHeight",value:function(t){var e=this.FRows[t].CalcNorHeight();this.FRows[t].AutoHeight?this.FRows[t].Height=e:e>this.FRows[t].Height&&(this.FRows[t].AutoHeight=!0,this.FRows[t].Height=e)}},{key:"CalcMergeRowHeightFrom",value:function(t){for(var e=-1,i=-1,n=0,o=0,s=-1,r=-1,a=t;a<this.RowCount;a++)for(var l=0;l<this.FRows[a].ColCount;l++)if(null===this.FRows[a][l].CellData){if(this.FRows[a][l].ColSpan<0)continue;var h=this.GetDestCell(a,l);if(e=h.row,i=h.col,e+this.FRows[e][l].RowSpan===a){n=this.FCellVPaddingPix+this.FRows[e][l].CellData.height+this.FCellVPaddingPix,this.FRows[e][l].Height=n,n=n-this.FRows[e].Height-this.FBorderWidthPix;for(var c=e+1;c<=a-1;c++)n=n-this.FRows[c].FmtOffset-this.FRows[c].Height-this.FBorderWidthPix;if(n>this.FRows[a].FmtOffset+this.FRows[a].Height){o=n-this.FRows[a].FmtOffset-this.FRows[a].Height,this.FRows[a].Height=n-this.FRows[a].FmtOffset;for(var u=0;u<this.FRows[a].ColCount;u++)if(null===this.FRows[a][u].CellData){if(this.FRows[a][u].ColSpan<0)continue;s=(h=this.GetDestCell(a,u)).row,r=h.col,s===e&&r===i||(this.FRows[s][u].Height=this.FRows[s][u].Height+o)}}else this.FRows[e][l].Height+=this.FRows[a].FmtOffset+this.FRows[a].Height-n}}}},{key:"SrcCellDataTopDistanceToDest",value:function(t,e){for(var i=this.FBorderWidthPix+this.FRows[t].FmtOffset,n=t-1;n>e;)i+=this.FRows[n].Height+this.FBorderWidthPix+this.FRows[n].FmtOffset,n--;return i+this.FRows[e].Height}},{key:"GetRowAt",value:function(t){for(var e=this.FBorderWidthPix,i=0;i<this.FRows.count;i++){if(t>=e&&t<=e+this.FRows[i].Height)return i;e+=this.FRows[i].FmtOffset+this.FRows[i].Height+this.FBorderWidthPix}}},{key:"GetRowTop",value:function(t){for(var e=this.FBorderWidthPix,i=0;i<t;i++)e+=this.FRows[i].FmtOffset+this.FRows[i].Height+this.FBorderWidthPix;return e+this.FRows[t].FmtOffset}},{key:"GetRowBottom",value:function(t){return this.GetRowTop(t)+this.FRows[t].Height}},{key:"GetCellPostion",value:function(t,e){for(var i=et.Create(this.FBorderWidthPix,this.GetRowTop(t)),n=0;n<e;n++)i.x+=this.FColWidths[n]+this.FBorderWidthPix;return i}},{key:"ActiveDataResizing",value:function(){return!!this.FSelectCellRang.EditCell()&&this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].CellData.SelectedResizing()}},{key:"DisSelectSelectedCell",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(this.FSelectCellRang.StartRow>=0){var i=null;this.FSelectCellRang.StartRow===t&&this.FSelectCellRang.StartCol===e||(this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].Active=!1);for(var n=this.FSelectCellRang.StartRow;n<=this.FSelectCellRang.EndRow;n++)for(var o=this.FSelectCellRang.StartCol;o<=this.FSelectCellRang.EndCol;o++)n===t&&o===e||(this.FRows[n][o].Active=!1,null!==(i=this.FRows[n][o].CellData)&&(i.DisSelect(),i.InitializeField()))}}},{key:"SetBorderWidthPt",value:function(t){this.FBorderWidthPt!=t&&(this.FBorderWidthPt=t,this.FBorderWidthPix=En.ptToPixel(this.FBorderWidthPt,En.PixelsPerInchX),this.FormatDirty())}},{key:"SetCellVPaddingMM",value:function(t){this.FCellVPaddingMM!=t&&(this.FCellVPaddingMM=t,this.FCellVPaddingPix=En.millimeterToPixY(this.FCellVPaddingMM),this.FormatDirty())}},{key:"SetCellHPaddingMM",value:function(t){this.FCellHPaddingMM!=t&&(this.FCellHPaddingMM=t,this.FCellHPaddingPix=En.millimeterToPixX(this.FCellHPaddingMM),this.FormatDirty())}},{key:"CanDrag",value:function(){var t=f()(F()(i.prototype),"CanDrag",this).call(this);return t&&(t=this.FSelectCellRang.EditCell()?this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].CellData.SelectedCanDrag():this.IsSelectComplate||this.IsSelectPart),t}},{key:"GetSelectComplate",value:function(){return 0===this.FSelectCellRang.StartRow&&0===this.FSelectCellRang.StartCol&&this.FSelectCellRang.EndRow===this.FRows.count-1&&this.FSelectCellRang.EndCol===this.FColWidths.count-1}},{key:"SelectComplate",value:function(){this.SelectRange(0,0,this.RowCount-1,this.FColWidths.count-1)}},{key:"GetResizing",value:function(){return f()(F()(i.prototype),"GetResizing",this).call(this)||this.ActiveDataResizing()}},{key:"SetResizing",value:function(t){f()(F()(i.prototype),"SetResizing",this).call(this,t)}},{key:"DoCreateRow",value:function(t,e){return new mr(this.hcl,t,e)}},{key:"DoCreateRowDynamic",value:function(t,e){return this.DoCreateRow(t,e)}},{key:"DoCellDataItemChange",value:function(t,e,i,n){return this.OwnerData.OnItemChange(t,e,i,n)}},{key:"DoPaintRowBefor",value:function(t,e,i,n,o,s,r){}},{key:"CheckRowBorderShouLian",value:function(t,e,i,n,o,s){if(0===o){for(var r=n.top+this.FBorderWidthPix-1,a=0;a<t;a++)r=r+this.FRows[a].FmtOffset+this.FRows[a].Height+this.FBorderWidthPix;if(this.FRows[t].FmtOffset>0){if(t!==s)return{shouLian:o=r-this.FBorderWidthPix,firstDrawRow:s};if(r+this.FRows[t].FmtOffset+this.FRows[t].Height<=e)return{shouLian:o=r+this.FRows[t].FmtOffset+this.FRows[t].Height,firstDrawRow:s}}r+=this.FRows[t].FmtOffset;for(var l,h,c,u=0,f=0,d=-1,m=-1,S=0,p=null,y=this.FRows[t].ColCount,F=!1,v=0;v<y;v++)if(f=r,d=(l=this.GetDestCell(t,v)).row,m=l.col,c=this.FRows[d][m].GetCellDataTop(this.FCellVPaddingPix),v===m+this.FRows[d][m].ColSpan){p=this.FRows[d][m].CellData,d!==t&&(f-=this.SrcCellDataTopDistanceToDest(t,d)),S=p.DrawItems.count;for(var I=0;I<S;I++)if(p.DrawItems[I].LineFirst){if((h=nt.CreateByRect(p.DrawItems[I].rect)).bottom=h.bottom+this.FCellVPaddingPix,f+c+h.bottom>e){o=I>0?e-f-c-p.DrawItems[I-1].rect.bottom>this.FCellVPaddingPix?Math.max(o,f+c+p.DrawItems[I-1].rect.bottom+this.FCellVPaddingPix):Math.max(o,f+c+p.DrawItems[I-1].rect.bottom):Math.max(o,f-this.FBorderWidthPix),F=!0;break}u=Math.max(u,f+c+h.bottom)}}o=F?Math.max(o,u):Math.min(i,r+this.FRows[t].FmtOffset+this.FRows[t].Height)}return{shouLian:o,firstDrawRow:s}}},{key:"DoDrawPageBreakMark",value:function(t,e,i,n,o){e.pen.color="gray",e.pen.style=_t.Dot,e.pen.width=1,t?(e.drawLineDriect(i+5,n-1,i+20,n-1),e.pen.style=_t.Solid,e.drawLineByPointsDriect([et.Create(i+19,n-2),et.Create(i+19,n-10),et.Create(i+5,n-10),et.Create(i+5,n-2)])):(e.drawLineDriect(i+5,o+1,i+20,o+1),e.pen.style=_t.Solid,e.drawLineByPointsDriect([et.Create(i+19,o+3),et.Create(i+19,o+10),et.Create(i+5,o+10),et.Create(i+5,o+3)])),e.pen.color="black"}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){for(var l,h,c,u,f,d,m=-1,S=0,p=0,y=0,F=0,v=0,I=0,g=0,C=0,w=0,A=0,D=0,P=0,k=0,x=0,R=!1,T=Math.trunc(this.FBorderWidthPix/2),b=!1,B=e.top+this.FBorderWidthPix,N=this.FRows.count,O=0,_=this.FColWidths.length,E=0;E<N;E++){if((B=B+this.FRows[E].FmtOffset+this.FCellVPaddingPix)>=s){m<0&&this.IsBreakRow(E)&&(b=this.FFixRow>=0&&E>this.FFixRow+this.FFixRowCount-1);break}if((S=B-this.FCellVPaddingPix+this.FRows[E].Height-this.FCellVPaddingPix)<=o)B=S+this.FCellVPaddingPix+this.FBorderWidthPix;else{m<0&&(m=E,b=this.FFixRow>=0&&E>this.FFixRow+this.FFixRowCount-1),this.DoPaintRowBefor(E,e.left+this.FCellVPaddingPix,B,e.right-this.FCellVPaddingPix-this.FCellVPaddingPix,S,r,a),p=e.left+this.FBorderWidthPix,y=0,O=this.FRows[E].ColCount;for(var M=0;M<O;M++)if(this.FRows[E][M].ColSpan<0)p=p+this.FColWidths[M]+this.FBorderWidthPix;else{if(R=!0,this.FRows[E][M].RowSpan<0&&E!==m&&(R=!1),F=B,v=(h=this.GetDestCell(E,M)).row,I=h.col,v!==E&&(F-=this.SrcCellDataTopDistanceToDest(E,v)),d=this.FBorderVisible||!a.Print,(w=(l=F-this.FCellVPaddingPix-this.FBorderWidthPix)+this.FBorderWidthPix+Math.max(this.FRows[E].Height,this.FRows[v][I].Height))>s)if(P=0,this.FRows[E][M].RowSpan>0)for(P=l,g=E;g<N;){if((P=P+this.FRows[g].FmtOffset+this.FRows[g].Height+this.FBorderWidthPix)>s){P>n&&(y=(h=this.CheckRowBorderShouLian(g,n,s,e,y,m)).shouLian,m=h.firstDrawRow,w=y);break}g++}else if(this.FRows[E][M].RowSpan<0)if(E!==m)d=!1;else{P=l;for(var L=v;L<E;L++)P=P+this.FRows[L].Height+this.FBorderWidthPix;for(g=E;g<N;){if((P=P+this.FRows[g].Height+this.FBorderWidthPix)>s){P>n&&(y=(h=this.CheckRowBorderShouLian(g,n,s,e,y,m)).shouLian,m=h.firstDrawRow,w=y);break}g++}}else this.IsBreakRow(E)&&(y=(h=this.CheckRowBorderShouLian(E,n,s,e,y,m)).shouLian,m=h.firstDrawRow,w=y);R&&(A=Math.min(s,B+Math.max(this.FRows[E].Height,this.FRows[v][I].Height)-this.FCellVPaddingPix),c=this.FRows[v][I].CellData,(D=Math.max(o,B-this.FCellVPaddingPix))-F<this.FRows[v][I].Height&&(u=nt.Create(p,F-this.FCellVPaddingPix,p+this.FRows[v][I].CellData.Width+this.FCellHPaddingPix+this.FCellHPaddingPix,Math.max(w,F+this.FRows[v][I].CellData.height+this.FCellVPaddingPix)),!this.IsSelectComplate&&!c.CellSelectedAll||a.Print?(f=!0,null!==this.FOnCellPaintBK&&(f=this.FOnCellPaintBK(this,this.FRows[v][I],u,r,a,f)),f&&!a.Print&&(this.IsFixRow(E)||this.IsFixCol(M)?(r.brush.color=this.FFixColor,r.fillRect(u)):"#ffffff"!==this.FRows[v][I].BackgroundColor?(r.brush.color=this.FRows[v][I].BackgroundColor,r.fillRect(u)):r.brush.style=Mt.Clear)):(r.brush.color=this.OwnerData.Style.SelColor,r.fillRect(u)),A-D>this.FCellVPaddingPix&&(this.DoCellPaintDataBefor(v,I,u,r,a),this.FRows[v][I].PaintTo(p,F-this.FCellVPaddingPix,p+this.FColWidths[M]+this.GetColSpanWidth(v,I),n,o,s,0,this.FCellHPaddingPix,this.FCellVPaddingPix,r,a),null!==this.FOnCellPaintData&&this.FOnCellPaintData(this,e,u,v,I,F,n,o,s,r,a),this.DoCellPaintDataAfter(v,I,u,r,a)))),d&&(a.Print?r.pen.width=Math.max(1,En.ptToPixel(this.FBorderWidthPt,a.DPI)):r.pen.width=this.FBorderWidthPix,this.FBorderVisible?(r.pen.color=Ft.Black,r.pen.style=_t.Solid):a.Print||(r.pen.color=Yl.clActiveBorder,r.pen.style=_t.Dot,r.pen.width=1),k=p-this.FBorderWidthPix,x=p+this.FColWidths[M]+this.GetColSpanWidth(v,I),this.IsBreakRow(E)&&E===m&&(l-=1),l<o&&i>=0&&(l=o),l+this.FBorderWidthPix>0&&this.FRows[E][M].BorderSides.has(Zl.Top)&&(this.FBorderVisible&&(r.pen.style=this.FRows[E][M].TopBorderStyle),a.Print?a.drawNoScaleLine(r,[et.Create(k+T,l+T),et.Create(x+T,l+T)]):r.drawLineDriect(k+T,l+T,x+T,l+T)),this.FRows[E][M].BorderSides.has(Zl.Right)&&(this.FBorderVisible&&(r.pen.style=this.FRows[E][M].RightBorderStyle),a.Print?a.drawNoScaleLine(r,[et.Create(x+T,l+T),et.Create(x+T,w+T)]):r.drawLineDriect(x+T,l+T,x+T,w+T)),w<=s&&this.FRows[E][M].BorderSides.has(Zl.Bottom)&&(this.FBorderVisible&&(r.pen.style=this.FRows[E][M].BottomBorderStyle),a.Print?a.drawNoScaleLine(r,[et.Create(k+T,w+T),et.Create(x+T,w+T)]):r.drawLineDriect(k+T,w+T,x+T+1,w+T)),this.FRows[E][M].BorderSides.has(Zl.Left)&&(this.FBorderVisible&&(r.pen.style=this.FRows[E][M].LeftBorderStyle),a.Print?a.drawNoScaleLine(r,[et.Create(k+T,l+T),et.Create(k+T,w+T)]):r.drawLineDriect(k+T,l+T,k+T,w+T)),this.FRows[E][M].BorderSides.has(Zl.LTRB)&&(this.FBorderVisible&&(r.pen.style=this.FRows[E][M].LTRBBorderStyle),a.Print?a.drawNoScaleLine(r,[et.Create(k+T,l+T),et.Create(x+T,w+T)]):r.drawLineDriect(k+T,l+T,x+T,w+T)),this.FRows[E][M].BorderSides.has(Zl.RTLB)&&(this.FBorderVisible&&(r.pen.style=this.FRows[E][M].RTLBBorderStyle),a.Print?a.drawNoScaleLine(r,[et.Create(x+T,l+T),et.Create(k+T,w+T)]):r.drawLineDriect(x+T,l+T,k+T,w+T)),this.DoPaintCellBorderSides(r,E,M,k+T,l+T,x+T,w+T),C=M+this.FRows[E][M].ColSpan,a.Print||C!==_-1||((B+this.FRows[E].Height-this.FCellVPaddingPix>n||E<N-1&&w+this.FRows[E+1].FmtOffset+this.FRows[E+1].Height>n&&(this.FRows[E+1].FmtOffset>0||w===n))&&this.DoDrawPageBreakMark(!0,r,x,w,i),0!==m&&E===m&&e.top<i&&this.DoDrawPageBreakMark(!1,r,x,w,i))),p=p+this.FColWidths[M]+this.FBorderWidthPix}B=S+this.FCellVPaddingPix+this.FBorderWidthPix}}if(b&&this.PaintFixRows(e.left,i,s,r,a),this.FFixCol>=0&&this.GetFixColLeft()+e.left<0&&this.PaintFixCols(e.top,0,i,s,r,a),this.Resizing)if(this.FMouseDownResizeInfo.TableSite==nr)r.pen.color=this.FBorderColor,r.pen.style=_t.Dot,r.pen.width=1,r.drawLineDriect(e.left+this.FMouseDownResizeInfo.DestX,Math.max(i,e.top),e.left+this.FMouseDownResizeInfo.DestX,Math.min(n,Math.min(e.bottom,w)));else if(this.FMouseDownResizeInfo.TableSite===or)r.pen.color=this.FBorderColor,r.pen.style=_t.Dot,r.pen.width=1,r.drawLineDriect(e.left,e.top+this.FMouseDownResizeInfo.DestY,e.right,e.top+this.FMouseDownResizeInfo.DestY);else if(this.FMouseDownResizeInfo.TableSite===sr){r.pen.color=this.FBorderColor,r.pen.style=_t.Dot,r.pen.width=1,r.beginPath();try{r.moveTo(e.right,Math.max(i,e.top)),r.lineTo(e.left+this.FMouseDownResizeInfo.DestX,Math.max(i,e.top)),r.lineTo(e.left+this.FMouseDownResizeInfo.DestX,e.top+this.FMouseDownResizeInfo.DestY),r.moveTo(e.left,Math.max(i,e.top)),r.lineTo(e.left,e.top+this.FMouseDownResizeInfo.DestY),r.lineTo(e.left+this.FMouseDownResizeInfo.DestX,e.top+this.FMouseDownResizeInfo.DestY)}finally{r.paintPath()}}}},{key:"DoCellPaintDataBefor",value:function(t,e,i,n,o){}},{key:"DoCellPaintDataAfter",value:function(t,e,i,n,o){}},{key:"DoCellDataDrawItemPaintAfter",value:function(t,e,i,n,o,s,r,a,l,h,c,u){null!==this.OwnerData.OnDrawItemPaintAfter&&this.OwnerData.OnDrawItemPaintAfter(t,e,i,n,o,s,r,a,l,h,c,u)}},{key:"DoPaintCellBorderSides",value:function(t,e,i,n,o,s,r){}},{key:"DoFormatToDrawItem",value:function(){}},{key:"MouseDown",value:function(t){var e,n=f()(F()(i.prototype),"MouseDown",this).call(this,t),o=-1,s=-1,r=null,a=new et;this.FMouseLBDowning=t.button===ae&&!this.hcl.keyDownStates[Ge],this.FOutSelectInto=!1,this.FSelecting=!1,this.FDraging=!1,this.FOutsideInfo.Row=-1;var l=this.GetCellAt(t.x,t.y,o,s);this.FMouseDownResizeInfo=l.resizeInfo,o=l.row,s=l.col;var h=this.FMouseDownResizeInfo.TableSite===nr||this.FMouseDownResizeInfo.TableSite===or||this.FMouseDownResizeInfo.TableSite===sr;if(this.Resizing=t.button===ae&&1===t.clicks&&h&&this.AllowResize,this.Resizing||h)return this.FMouseDownX=t.x,this.FMouseDownY=t.y,this.OwnerData.Style.UpdateInfoRePaint(),n;if(this.FMouseDownResizeInfo.TableSite===tr)if(this.CoordInSelect(t.x,t.y))2!==t.clicks&&this.FMouseLBDowning&&(this.FDraging=!0),this.FMouseDownRow===o&&this.FMouseDownCol===s||(this.DoSelectCellChange(this.FMouseDownRow,this.FMouseDownCol,o,s),this.FMouseDownRow=o,this.FMouseDownCol=s),a=this.GetCellPostion(this.FMouseDownRow,this.FMouseDownCol),(e=new fi).assign(t),e.x-=a.x,e.y-=a.y,this.FRows[this.FMouseDownRow][this.FMouseDownCol].MouseDown(e,this.FCellHPaddingPix,this.FCellVPaddingPix);else{if(o!==this.FMouseDownRow||s!==this.FMouseDownCol){if(null!=(r=this.GetEditCell())&&(r.Active=!1),this.FMouseDownRow<0||this.FMouseDownCol<0){var c=this.GetEditCellWith();this.FMouseDownRow=c.row,this.FMouseDownCol=c.col}this.FMouseDownRow===o&&this.FMouseDownCol===s||this.DoSelectCellChange(this.FMouseDownRow,this.FMouseDownCol,o,s),this.OwnerData.Style.UpdateInfoReCaret(),this.DisSelect(),this.FMouseDownRow=o,this.FMouseDownCol=s}this.FSelectCellRang.SetStart(this.FMouseDownRow,this.FMouseDownCol),a=this.GetCellPostion(this.FMouseDownRow,this.FMouseDownCol),(e=new fi).assign(t),e.x-=a.x,e.y-=a.y,this.FRows[this.FMouseDownRow][this.FMouseDownCol].MouseDown(e,this.FCellHPaddingPix,this.FCellVPaddingPix)}else this.DisSelect(),this.FMouseDownResizeInfo.TableSite==$s&&(this.FOutsideInfo.Row=o,this.FOutsideInfo.Leftside=t.x<0);return n}},{key:"DoCellMouseMove",value:function(t,e,i){this.FRows[e][i].MouseMove(t,this.FCellHPaddingPix,this.FCellVPaddingPix)}},{key:"AdjustSelectRang",value:function(t,e){if(this.FSelectCellRang.StartRow>=0)for(var i=this.FSelectCellRang.StartRow;i<=this.FSelectCellRang.EndRow;i++)for(var n=this.FSelectCellRang.StartCol;n<=this.FSelectCellRang.EndCol;n++)i==this.FMouseDownRow&&n==this.FMouseDownCol||null!=this.FRows[i][n].CellData&&this.FRows[i][n].CellData.DisSelect();var o,s=-1,r=-1;if(this.FMouseDownRow<0?(0==t?(this.DoSelectCellChange(this.FMouseDownRow,this.FMouseDownCol,0,0),this.FMouseDownRow=0,this.FMouseDownCol=0,this.FSelectCellRang.SetStart(this.FMouseDownRow,this.FMouseDownCol),this.FSelectCellRang.SetEnd(t,e)):(s=(o=this.GetDestCell(this.RowCount-1,this.FColWidths.count-1)).row,r=o.col,this.DoSelectCellChange(this.FMouseDownRow,this.FMouseDownCol,s,r),this.FMouseDownRow=s,this.FMouseDownCol=r,this.FSelectCellRang.SetStart(t,e),this.FSelectCellRang.SetEnd(this.FMouseDownRow,this.FMouseDownCol)),this.FOutSelectInto=!0):this.FMouseMoveRow>this.FMouseDownRow?(this.FSelectCellRang.StartRow=this.FMouseDownRow,this.FSelectCellRang.EndRow=this.FMouseMoveRow,this.FMouseMoveCol<this.FMouseDownCol?(this.FSelectCellRang.StartCol=this.FMouseMoveCol,this.FSelectCellRang.EndCol=this.FMouseDownCol):(this.FSelectCellRang.StartCol=this.FMouseDownCol,this.FSelectCellRang.EndCol=this.FMouseMoveCol)):this.FMouseMoveRow<this.FMouseDownRow?(this.FSelectCellRang.StartRow=this.FMouseMoveRow,this.FSelectCellRang.EndRow=this.FMouseDownRow,this.FMouseMoveCol<this.FMouseDownCol?(this.FSelectCellRang.StartCol=this.FMouseMoveCol,this.FSelectCellRang.EndCol=this.FMouseDownCol):(this.FSelectCellRang.StartCol=this.FMouseDownCol,this.FSelectCellRang.EndCol=this.FMouseMoveCol)):(this.FSelectCellRang.StartRow=this.FMouseDownRow,this.FSelectCellRang.EndRow=this.FMouseMoveRow,this.FMouseMoveCol>this.FMouseDownCol?(this.FSelectCellRang.StartCol=this.FMouseDownCol,this.FSelectCellRang.EndCol=this.FMouseMoveCol):this.FMouseMoveCol<this.FMouseDownCol?(this.FSelectCellRang.StartCol=this.FMouseMoveCol,this.FSelectCellRang.EndCol=this.FMouseDownCol):(this.FSelectCellRang.StartCol=this.FMouseDownCol,this.FSelectCellRang.EndCol=this.FMouseMoveCol)),this.FSelectCellRang.StartRow==this.FSelectCellRang.EndRow&&this.FSelectCellRang.StartCol==this.FSelectCellRang.EndCol)this.FSelectCellRang.InitializeEnd();else{this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].IsMergeSource()&&(s=(o=this.GetDestCell(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol)).row,r=o.col,this.FSelectCellRang.SetStart(s,r));for(var a=this.FSelectCellRang.StartCol,l=this.FSelectCellRang.StartRow+1;l<=this.FSelectCellRang.EndRow;l++)this.FRows[l][this.FSelectCellRang.StartCol].IsMergeSource()&&(o=this.GetDestCell(l,this.FSelectCellRang.StartCol)).col<a&&(a=o.col);this.FSelectCellRang.StartCol=a,this.FRows[this.FSelectCellRang.EndRow][this.FSelectCellRang.EndCol].IsMergeSource()&&(o=this.GetDestCell(this.FSelectCellRang.EndRow,this.FSelectCellRang.EndCol),this.FSelectCellRang.SetEnd(o.row,o.col)),this.FRows[this.FSelectCellRang.EndRow][this.FSelectCellRang.EndCol].IsMergeDest()&&(s=(o=this.GetSourceCell(this.FSelectCellRang.EndRow,this.FSelectCellRang.EndCol)).row,r=o.col,this.FSelectCellRang.SetEnd(s,r)),this.FSelectCellRang.StartRow==this.FSelectCellRang.EndRow&&this.FSelectCellRang.StartCol==this.FSelectCellRang.EndCol&&this.FSelectCellRang.InitializeEnd()}}},{key:"MatchCellSelectState",value:function(){if(this.FSelectCellRang.EditCell())this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].CellData.CellSelectedAll=!1;else for(var t=this.FSelectCellRang.StartRow;t<=this.FSelectCellRang.EndRow;t++)for(var e=this.FSelectCellRang.StartCol;e<=this.FSelectCellRang.EndCol;e++)null!=this.FRows[t][e].CellData&&this.FRows[t][e].CellData.SelectAll()}},{key:"MouseMove",value:function(t){var e=null;if(this.ActiveDataResizing()){e=this.GetCellPostion(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol);var i=new fi;return i.assign(t),i.x-=e.x,i.y-=e.y,this.DoCellMouseMove(i,this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol),!0}if(this.Resizing)return this.FMouseDownResizeInfo.DestX=t.x,this.FMouseDownResizeInfo.DestY=t.y,this.OwnerData.Style.UpdateInfoRePaint(),this.FMouseDownResizeInfo.TableSite===nr?this.OwnerData.Style.Cursor=ge:this.FMouseDownResizeInfo.TableSite===or?this.OwnerData.Style.Cursor=Re:this.FMouseDownResizeInfo.TableSite===sr&&(this.OwnerData.Style.Cursor=ke),!0;var n,o=-1,s=-1,r=this.GetCellAt(t.x,t.y,o,s),a=r.resizeInfo;if(o=r.row,s=r.col,a.TableSite===tr)if(this.FMouseLBDowning||t.button===ae&&!this.hcl.keyDownStates[Ge]){if(this.FDraging||this.OwnerData.Style.UpdateInfo.DragingSelected)return this.FMouseMoveRow=o,this.FMouseMoveCol=s,e=this.GetCellPostion(this.FMouseMoveRow,this.FMouseMoveCol),(n=new fi).assign(t),n.x-=e.x,n.y-=e.y,this.DoCellMouseMove(n,this.FMouseMoveRow,this.FMouseMoveCol),!0;this.FSelecting||(this.FSelecting=!0),o===this.FMouseMoveRow&&s===this.FMouseMoveCol||(this.FMouseMoveRow=o,this.FMouseMoveCol=s,this.FSelecting&&this.FMouseDownResizeInfo.TableSite===$s?this.SelectAll():this.FMouseDownResizeInfo.TableSite===tr&&(this.AdjustSelectRang(o,s),this.MatchCellSelectState())),e=this.GetCellPostion(this.FMouseMoveRow,this.FMouseMoveCol),(n=new fi).assign(t),n.x-=e.x,n.y-=e.y,this.DoCellMouseMove(n,this.FMouseMoveRow,this.FMouseMoveCol)}else{if(o===this.FMouseMoveRow&&s===this.FMouseMoveCol||(this.FMouseMoveRow>=0&&this.FMouseMoveCol>=0&&null!=this.FRows[this.FMouseMoveRow][this.FMouseMoveCol].CellData&&this.FRows[this.FMouseMoveRow][this.FMouseMoveCol].CellData.MouseLeave(),this.FMouseMoveRow=o,this.FMouseMoveCol=s),this.FMouseMoveRow<0||this.FMouseMoveCol<0)return!0;e=this.GetCellPostion(this.FMouseMoveRow,this.FMouseMoveCol),(n=new fi).assign(t),n.x-=e.x,n.y-=e.y,this.DoCellMouseMove(n,this.FMouseMoveRow,this.FMouseMoveCol)}else this.FMouseMoveRow>=0&&this.FMouseMoveCol>=0&&null!=this.FRows[this.FMouseMoveRow][this.FMouseMoveCol].CellData&&this.FRows[this.FMouseMoveRow][this.FMouseMoveCol].CellData.MouseLeave(),this.FMouseMoveRow=-1,this.FMouseMoveCol=-1,this.OwnerData.Style.UpdateInfo.Selecting,this.AllowResize&&(a.TableSite===nr?this.OwnerData.Style.Cursor=ge:a.TableSite===or?this.OwnerData.Style.Cursor=Re:a.TableSite===sr&&(this.OwnerData.Style.Cursor=ke));return!0}},{key:"DoCellMouseUp",value:function(t,e,i){this.FRows[e][i].MouseUp(t,this.FCellHPaddingPix,this.FCellVPaddingPix)}},{key:"MouseUp",value:function(t){var e=new et;if(this.FMouseLBDowning=!1,this.ActiveDataResizing()){e=this.GetCellPostion(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol);var i=new fi;return i.assign(t),i.x-=e.x,i.y-=e.y,this.DoCellMouseUp(i,this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol),!0}var n,o,s,r=-1,a=-1;return this.Resizing?(n=(o=this.GetCellAt(this.FMouseDownX,this.FMouseDownY,r,a,!1)).resizeInfo,r=o.row,a=o.col,this.FMouseDownResizeInfo.TableSite===nr?(e.x=t.x-this.FMouseDownX,0!=e.x&&n.TableSite!==$s&&0!==e.x&&(e.x>0?a<this.FColWidths.count-1?(this.FColWidths[a+1]-e.x<Yl.MinColWidth&&(e.x=this.FColWidths[a+1]-Yl.MinColWidth),0!==e.x&&(this.Undo_ColResize(a,this.FColWidths[a],this.FColWidths[a]+e.x),this.FColWidths[a]=this.FColWidths[a]+e.x,this.FResizeKeepWidth&&a<this.FColWidths.count-1&&(this.FColWidths[a+1]-=e.x))):(this.FResizeKeepWidth&&this.FColWidths[a]+e.x>this.OwnerData.Width&&(e.x=this.OwnerData.Width-this.FColWidths[a+1]),this.Undo_ColResize(a,this.FColWidths[a],this.FColWidths[a]+e.x),this.FColWidths[a]=this.FColWidths[a]+e.x):(this.FColWidths[a]+e.x<Yl.MinColWidth&&(e.x=Yl.MinColWidth-this.FColWidths[a]),0!==e.x&&(this.Undo_ColResize(a,this.FColWidths[a],this.FColWidths[a]+e.x),this.FColWidths[a]=this.FColWidths[a]+e.x,this.FResizeKeepWidth&&a<this.FColWidths.count-1&&(this.FColWidths[a+1]-=e.x))))):this.FMouseDownResizeInfo.TableSite===or?(e.y=t.y-this.FMouseDownY,0!=e.y&&(this.Undo_RowResize(r,this.FRows[r].Height,this.FRows[r].Height+e.y),e.y=this.FRows[r].Height+e.y,this.FRows[r].Height=e.y,this.FRows[r].AutoHeight=e.y!=this.FRows[r].Height)):this.FMouseDownResizeInfo.TableSite===sr&&(e.x=t.x-this.FMouseDownX,e.y=t.y-this.FMouseDownY,0===e.x&&0===e.y||this.ResizeByInc(e.x,e.y)),this.FormatDirty(),this.Resizing=!1,this.OwnerData.Style.Cursor=Se,this.OwnerData.Style.UpdateInfoRePaint(),this.OwnerData.Style.UpdateInfoReCaret(),!0):(this.FSelecting||this.OwnerData.Style.UpdateInfo.Selecting?(this.FSelecting=!1,this.FMouseDownRow>=0&&!this.FOutSelectInto&&(e=this.GetCellPostion(this.FMouseDownRow,this.FMouseDownCol),(s=new fi).assign(t),s.x-=e.x,s.y-=e.y,this.DoCellMouseUp(s,this.FMouseDownRow,this.FMouseDownCol)),n=(o=this.GetCellAt(t.x,t.y,r,a)).resizeInfo,r=o.row,a=o.col,n.TableSite===tr&&(r==this.FMouseDownRow&&a==this.FMouseDownCol||(e=this.GetCellPostion(r,a),(s=new fi).assign(t),s.x-=e.x,s.y-=e.y,this.DoCellMouseUp(s,r,a)))):this.FDraging||this.OwnerData.Style.UpdateInfo.DragingSelected?(this.FDraging=!1,n=(o=this.GetCellAt(t.x,t.y,r,a)).resizeInfo,r=o.row,a=o.col,n.TableSite===tr&&(this.FMouseDownRow>=0&&this.FMouseDownRow!==r&&this.FMouseDownCol!==a&&this.DoSelectCellChange(this.FMouseDownRow,this.FMouseDownCol,r,a),this.DisSelect(),this.FMouseMoveRow=r,this.FMouseMoveCol=a,this.FMouseDownRow=r,this.FMouseDownCol=a,this.FSelectCellRang.SetStart(r,a),e=this.GetCellPostion(r,a),(s=new fi).assign(t),s.x-=e.x,s.y-=e.y,this.DoCellMouseUp(s,r,a))):this.FMouseDownRow>=0&&(e=this.GetCellPostion(this.FMouseDownRow,this.FMouseDownCol),(s=new fi).assign(t),s.x-=e.x,s.y-=e.y,this.DoCellMouseUp(s,this.FMouseDownRow,this.FMouseDownCol)),!0)}},{key:"MouseLeave",value:function(){f()(F()(i.prototype),"MouseLeave",this).call(this),this.FMouseMoveRow<0||this.FMouseMoveCol<0||(null!=this.FRows[this.FMouseMoveRow][this.FMouseMoveCol].CellData&&this.FRows[this.FMouseMoveRow][this.FMouseMoveCol].CellData.MouseLeave(),this.SelectExists()||(this.FMouseMoveRow=-1,this.FMouseMoveCol=-1))}},{key:"ClearFormatExtraHeight",value:function(){if(this.Height===this.FFormatHeight)return 0;for(var t,e=this.Height,i=-1,n=0,o=this.FRows.count-1;o>=0;o--){0!=this.FRows[o].FmtOffset&&(i=o,this.FRows[o].FmtOffset=0);for(var s=0;s<this.ColCount;s++)(0!=(t=this.FRows[o][s]).ClearFormatExtraHeight()||null!=t.CellData&&t.Height!=this.FCellHPaddingPix+t.CellData.height+this.FCellHPaddingPix)&&(i=o,this.CalcRowCellHeight(o))}return i>=0&&(this.CalcMergeRowHeightFrom(i),this.Height=this.GetFormatHeight(),n=e-this.Height),n}},{key:"DeleteSelected",value:function(){var t=this,e=f()(F()(i.prototype),"DeleteSelected",this).call(this);if(this.FSelectCellRang.StartRow>=0)if(this.FSelectCellRang.EndRow>=0){this.FMulCellUndo.Enable=!0;try{var n=this.GetSelfUndoList();n.UndoGroupBegin(0,0);try{for(var o=this.FSelectCellRang.StartRow;o<=this.FSelectCellRang.EndRow;o++)for(var s=this.FSelectCellRang.StartCol;s<=this.FSelectCellRang.EndCol;s++)null!=this.FRows[o][s].CellData&&(this.FMulCellUndo.Init(o,s),this.FRows[o][s].CellData.DeleteSelected())}finally{n.UndoGroupEnd(0,0)}}finally{this.FMulCellUndo.Enable=!1}this.FormatDirty(),e=!0}else{this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){e=t.FRows[t.FSelectCellRang.StartRow][t.FSelectCellRang.StartCol].CellData.DeleteSelected()}))}return e}},{key:"DisSelect",value:function(){f()(F()(i.prototype),"DisSelect",this).call(this),this.DisSelectSelectedCell(),this.InitializeMouseInfo(),this.FSelectCellRang.Initialize(),this.FSelecting=!1,this.FDraging=!1,this.FOutSelectInto=!1}},{key:"MarkStyleUsed",value:function(t){f()(F()(i.prototype),"MarkStyleUsed",this).call(this,t);for(var e=0;e<=this.FRows.count-1;e++)for(var n=0;n<this.FRows[e].ColCount;n++)null!=this.FRows[e][n].CellData&&this.FRows[e][n].CellData.MarkStyleUsed(t)}},{key:"GetCaretInfo",value:function(t){var e=-1,i=-1;this.OwnerData.Style.UpdateInfo.DragingSelected?(e=this.FMouseMoveRow,i=this.FMouseMoveCol):(e=this.FSelectCellRang.StartRow,i=this.FSelectCellRang.StartCol);var n=null,o=-1,s=-1;if(e<0)if(this.FMouseDownResizeInfo.TableSite===$s){e=this.FOutsideInfo.Row>=0?this.FOutsideInfo.Row:this.FRows.count-1,this.FOutsideInfo.Leftside&&(t.X=t.X-2),o=0;for(var r=this.FPageBreaks.count-1;r>=0;r--)if(this.FPageBreaks[r].Row<=e&&this.FPageBreaks[r].PageIndex==t.PageIndex-1){o=this.FPageBreaks[r].BreakBottom;break}s=this.Height;for(var a=0;a<=this.FPageBreaks.count-1;a++)if(this.FPageBreaks[a].Row>=e&&this.FPageBreaks[a].PageIndex==t.PageIndex){s=this.FPageBreaks[a].BreakSeat;break}t.Y=t.Y+o,t.Height=s-o}else t.Visible=!1;else{if(n=this.FRows[e][i],this.OwnerData.Style.UpdateInfo.DragingSelected){if(n.CellData.MouseMoveItemNo<0||n.CellData.MouseMoveItemOffset<0)return void(t.Visible=!1);n.GetCaretInfo(n.CellData.MouseMoveItemNo,n.CellData.MouseMoveItemOffset,this.FCellHPaddingPix,this.FCellVPaddingPix,t)}else{if(n.CellData.SelectInfo.StartItemNo<0||n.CellData.SelectInfo.StartItemOffset<0)return void(t.Visible=!1);n.GetCaretInfo(n.CellData.SelectInfo.StartItemNo,n.CellData.SelectInfo.StartItemOffset,this.FCellHPaddingPix,this.FCellVPaddingPix,t)}var l=this.GetCellPostion(e,i);t.X=l.x+t.X,t.Y=l.y+t.Y}}},{key:"SetActive",value:function(t){if(this.Active!==t){if(!t){var e=this.GetEditCell();if(null!==e)e.Active=t;else if(this.FSelectCellRang.SelectExists())for(var n=this.FSelectCellRang.StartRow;n<=this.FSelectCellRang.EndRow;n++)for(var o=this.FSelectCellRang.StartCol;o<=this.FSelectCellRang.EndCol;o++)this.FRows[n][o].Active=t;if(this.FMouseDownRow<0||this.FMouseDownCol<0){var s=this.GetEditCellWith();this.DoSelectCellChange(s.row,s.col,-1,-1)}else this.DoSelectCellChange(this.FMouseDownRow,this.FMouseDownCol,-1,-1);this.InitializeMouseInfo(),this.FSelectCellRang.Initialize()}f()(F()(i.prototype),"SetActive",this).call(this,t)}}},{key:"DoSelfUndoNew",value:function(){if(this.FMulCellUndo.Enable){var t=new Yo,e=new xo;return e.Row=this.FMulCellUndo.Row,e.Col=this.FMulCellUndo.Col,t.Data=e,t}if(this.FSelectCellRang.EditCell()){var n=new Yo,o=new ko;return o.Row=this.FSelectCellRang.StartRow,o.Col=this.FSelectCellRang.StartCol,n.Data=o,n}return f()(F()(i.prototype),"DoSelfUndoNew",this).call(this)}},{key:"DoSelfUndoDestroy",value:function(t){t.Data instanceof ko&&(t.Data=null),f()(F()(i.prototype),"DoSelfUndoDestroy",this).call(this,t)}},{key:"DoSelfUndo",value:function(t){var e=this;if(this.InitializeMouseInfo(),this.FSelectCellRang.Initialize(),t.Data)if(t.Data instanceof xo){var n=t.Data;this.FRows[n.Row][n.Col].CellData.Undo(t),this.FormatDirty()}else if(t.Data instanceof ko){var o=t.Data;this.FSelectCellRang.StartRow=o.Row,this.FSelectCellRang.StartCol=o.Col;this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){e.FRows[o.Row][o.Col].CellData.Undo(t)}))}else if(t.Data instanceof Ro){var s=t.Data;this.FResizeKeepWidth&&s.Col<this.FColWidths.count-1&&(this.FColWidths[s.Col+1]=this.FColWidths[s.Col+1]+s.NewWidth-s.OldWidth),this.FColWidths[s.Col]=s.OldWidth,this.FormatDirty()}else if(t.Data instanceof To){var r=t.Data;this.FRows[r.Row].Height=r.OldHeight,this.FormatDirty()}else if(t.Data instanceof Do){var a=new ht;try{this.SaveToStream(a);var l=t.Data;l.Stream.position=0,l.Stream.readInt32(),this.LoadFromStream(l.Stream,this.OwnerData.Style,Yl.HC_FileVersionInt),l.Stream.clear(0),l.Stream.copyFrom(a,0),this.FormatDirty()}finally{a=null}}else f()(F()(i.prototype),"DoSelfUndo",this).call(this,t);else f()(F()(i.prototype),"DoSelfUndo",this).call(this,t)}},{key:"DoSelfRedo",value:function(t){var e=this;if(this.InitializeMouseInfo(),this.FSelectCellRang.Initialize(),t.Data)if(t.Data instanceof xo){var n=t.Data;this.FRows[n.Row][n.Col].CellData.Redo(t),this.FormatDirty()}else if(t.Data instanceof ko){var o=t.Data;this.FSelectCellRang.StartRow=o.Row,this.FSelectCellRang.StartCol=o.Col;this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){e.FRows[o.Row][o.Col].CellData.Redo(t)}))}else if(t.Data instanceof Ro){var s=t.Data;this.FResizeKeepWidth&&s.Col<this.FColWidths.count-1&&(this.FColWidths[s.Col+1]=this.FColWidths[s.Col+1]-s.NewWidth-s.OldWidth),this.FColWidths[s.Col]=s.NewWidth,this.FormatDirty()}else if(t.Data instanceof To){var r=t.Data;this.FRows[r.Row].Height=r.NewHeight,this.FormatDirty()}else if(t.Data instanceof Do){var a=new ht;try{this.SaveToStream(a);var l=t.Data;l.Stream.position=0,l.Stream.readInt32(),this.LoadFromStream(l.Stream,this.OwnerData.Style,Yl.HC_FileVersionInt),l.Stream.clear(0),l.Stream.copyFrom(a,0),this.FormatDirty()}finally{a=null}}else f()(F()(i.prototype),"DoSelfRedo",this).call(this,t);else f()(F()(i.prototype),"DoSelfRedo",this).call(this,t)}},{key:"Undo_ColResize",value:function(t,e,i){var n=this.GetSelfUndoList();if(null!=n&&n.Enable){this.SelfUndo_New();var o=n.last;if(null!=o){var s=new Ro;s.Col=t,s.OldWidth=e,s.NewWidth=i,o.Data=s}}}},{key:"Undo_RowResize",value:function(t,e,i){var n=this.GetSelfUndoList();if(null!=n&&n.Enable){this.SelfUndo_New();var o=n.last;if(null!=n){var s=new To;s.Row=t,s.OldHeight=e,s.NewHeight=i,o.Data=s}}}},{key:"Undo_Mirror",value:function(){var t=this.GetSelfUndoList();if(null!=t&&t.Enable){this.SelfUndo_New();var e=t.last;if(null!=e){var i=new Do;this.SaveToStream(i.Stream),e.Data=i}}}},{key:"GetRowCount",value:function(){return this.FRows.count}},{key:"GetColCount",value:function(){return this.FColWidths.count}},{key:"CheckFixColSafe",value:function(t){this.FFixCol+this.FFixColCount-1>=t&&(this.FFixCol=-1,this.FFixColCount=0)}},{key:"CheckFixRowSafe",value:function(t){this.FFixRow+this.FFixRowCount-1>=t&&(this.FFixRow=-1,this.FFixRowCount=0)}},{key:"AdjustCellRange",value:function(t,e,i,n){for(var o,s=i,r=n,a=null,l=-1,h=-1,c=t;c<=i;c++)for(var u=e;u<=n;u++)((a=this.FRows[c][u]).RowSpan>0||a.ColSpan>0)&&(l=(o=this.GetDestCell(c,u)).row,h=o.col,s<(l+=(a=this.FRows[l][h]).RowSpan)&&(s=l),r<(h+=a.ColSpan)&&(r=h));return{row:s,col:r}}},{key:"DeleteEmptyRows",value:function(t,e){for(var i,n=e;n>=t;n--){i=!0;for(var o=0;o<this.FRows[n].ColCount;o++)if(null!=this.FRows[n][o].CellData){i=!1;break}if(i){for(var s=null,r=0;r<n;r++)for(var a=0;a<this.FRows[r].ColCount;a++)r+(s=this.FRows[r][a]).RowSpan>=n&&s.RowSpan--;for(var l=n+1;l<this.FRows.count;l++)for(var h=0;h<this.FRows[l].ColCount;h++)l+(s=this.FRows[l][h]).RowSpan<n&&s.RowSpan++;this.FRows.removeAt(n)}}}},{key:"DeleteEmptyCols",value:function(t,e){for(var i=!1,n=e;n>=t;n--){i=!0;for(var o=0;o<this.RowCount;o++)if(null!=this.FRows[o][n].CellData){i=!1;break}if(i){for(var s=null,r=this.RowCount-1;r>=0;r--){for(var a=0;a<n;a++)a+(s=this.FRows[r][a]).ColSpan>=n&&(s.ColSpan=s.ColSpan-1);for(var l=n;l<this.FRows[r].ColCount;l++)l+(s=this.FRows[r][l]).ColSpan<n&&(s.ColSpan=s.ColSpan+1);this.FRows[r].removeAt(n)}n>0&&(this.FColWidths[n-1]+=this.FBorderWidthPix+this.FColWidths[n]),this.FColWidths.removeAt(n),this.DoColCountChange()}}}},{key:"MergeCells",value:function(t,e,i,n){var o=!1,s=i,r=n,a=this.AdjustCellRange(t,e,s,r);if(s=a.row,r=a.col,!(o=this.CellsCanMerge(t,e,s,r)))return o;if(t==s){for(var l=e+1;l<=r;l++)null!=this.FRows[t][l].CellData&&(this.FRows[t][e].CellData.AddData(this.FRows[t][l].CellData),this.FRows[t][l].CellData.dispose(),this.FRows[t][l].CellData=null),this.FRows[t][l].ColSpan=e-l;this.FRows[t][e].ColSpan=r-e,this.DeleteEmptyCols(e+1,r),o=!0}else if(e==r){for(var h=t+1;h<=s;h++)null!=this.FRows[h][e].CellData&&(this.FRows[t][e].CellData.AddData(this.FRows[h][e].CellData),this.FRows[h][e].CellData.dispose(),this.FRows[h][e].CellData=null),this.FRows[h][e].RowSpan=t-h;this.FRows[t][e].RowSpan=s-t,this.DeleteEmptyRows(t+1,s),o=!0}else{for(var c=e+1;c<=r;c++)null!=this.FRows[t][c].CellData&&(this.FRows[t][e].CellData.AddData(this.FRows[t][c].CellData),this.FRows[t][c].CellData.dispose(),this.FRows[t][c].CellData=null),this.FRows[t][c].RowSpan=0,this.FRows[t][c].ColSpan=e-c;for(var u=t+1;u<=s;u++)for(var f=e;f<=r;f++)null!=this.FRows[u][f].CellData&&(this.FRows[t][e].CellData.AddData(this.FRows[u][f].CellData),this.FRows[u][f].CellData.dispose(),this.FRows[u][f].CellData=null),this.FRows[u][f].ColSpan=e-f,this.FRows[u][f].RowSpan=t-u;this.FRows[t][e].RowSpan=s-t,this.FRows[t][e].ColSpan=r-e,this.DeleteEmptyRows(t+1,s),this.DeleteEmptyCols(e+1,r),o=!0}return o}},{key:"GetCells",value:function(t,e){return this.FRows[t][e]}},{key:"GetColWidth",value:function(t){return this.FColWidths[t]}},{key:"GetRowColByCellData",value:function(t){for(var e=0;e<this.FRows.count;e++)for(var i=0;i<this.FColWidths.count;i++)if(null!==this.FRows[e][i].CellData&&this.FRows[e][i].CellData===t)return{row:e,col:i};return{row:-1,col:-1}}},{key:"InsertCol",value:function(t,e){this.FMouseDownRow>=0&&this.DoSelectCellChange(this.FMouseDownRow,this.FMouseDownCol,-1,-1),this.Undo_Mirror();for(var i,n,o=-1,s=-1,r=Yl.MinColWidth-this.FBorderWidthPix,a=0;a<e;a++){for(var l=0;l<this.RowCount;l++){if((i=this.FRows[l].CreateCell(this.OwnerData.Style)).Width=r,i.Height=this.FRows[l].Height,t<this.FColWidths.count&&this.FRows[l][t].ColSpan<0){o=(n=this.GetDestCell(l,t)).row,s=n.col,i.CellData.dispose(),i.CellData=null,i.RowSpan=this.FRows[l][t].RowSpan,i.ColSpan=this.FRows[l][t].ColSpan;for(var h=t;h<=s+this.FRows[o][s].ColSpan;h++)this.FRows[l][h].ColSpan=this.FRows[l][h].ColSpan-1;l==o+this.FRows[o][s].RowSpan&&this.FRows[o][s].ColSpan++}else this.InitializeCellData(i.CellData);this.FRows[l].insert(t,i)}this.FColWidths.insert(t,r)}return this.FResizeKeepWidth&&this.AdjustWidth(!1),this.DoColCountChange(),this.InitializeMouseInfo(),this.FSelectCellRang.Initialize(),this.FormatDirty(),!0}},{key:"InsertRow",value:function(t,e){this.FMouseDownRow>=0&&this.DoSelectCellChange(this.FMouseDownRow,this.FMouseDownCol,-1,-1),this.Undo_Mirror();for(var i,n,o=-1,s=-1,r=0;r<e;r++){i=this.DoCreateRow(this.OwnerData.Style,this.FColWidths.count);for(var a=0;a<=this.FColWidths.count-1;a++)if(i[a].Width=this.FColWidths[a],t<this.FRows.count&&this.FRows[t][a].RowSpan<0){o=(n=this.GetDestCell(t,a)).row,s=n.col,i[a].CellData.dispose(),i[a].CellData=null,i[a].RowSpan=this.FRows[t][a].RowSpan,i[a].ColSpan=this.FRows[t][a].ColSpan;for(var l=t;l<=o+this.FRows[o][s].RowSpan;l++)this.FRows[l][a].RowSpan--;a==s+this.FRows[o][s].ColSpan&&this.FRows[o][s].RowSpan++}else this.InitializeCellData(i[a].CellData);this.FRows.insert(t,i)}return this.InitializeMouseInfo(),this.FSelectCellRang.Initialize(),this.FormatDirty(),!0}},{key:"DeleteCol",value:function(t){if(1==this.FColWidths.count)return!1;if(!this.ColCanDelete(t))return!1;this.FMouseDownRow>=0&&this.DoSelectCellChange(this.FMouseDownRow,this.FMouseDownCol,-1,-1),this.Undo_Mirror();for(var e,i=-1,n=-1,o=0;o<this.RowCount;o++){if(this.FRows[o][t].ColSpan<0){i=(e=this.GetDestCell(o,t)).row,n=e.col;for(var s=t;s<=n+this.FRows[i][n].ColSpan;s++)this.FRows[o][s].ColSpan++;o==i+this.FRows[i][n].RowSpan&&this.FRows[i][n].ColSpan--}else this.FRows[o][t].ColSpan;this.FRows[o].removeAt(t)}return this.FColWidths.removeAt(t),this.DoColCountChange(),this.DeleteEmptyRows(0,this.RowCount-1),this.CheckFixColSafe(t),this.InitializeMouseInfo(),this.FSelectCellRang.Initialize(),this.FormatDirty(),!0}},{key:"DeleteRow",value:function(t){return this.DeleteRowFrom(t,t)}},{key:"DeleteRowFrom",value:function(t,e){if(0==t&&e==this.FRows.count-1)return!1;if(1==this.FRows.count)return!1;if(t<0||e>this.FRows.count-1)return!1;this.FMouseDownRow>=0&&this.DoSelectCellChange(this.FMouseDownRow,this.FMouseDownCol,-1,-1);var i,n=-1,o=-1;this.Undo_Mirror();for(var s=e;s>=t;s--){if(!this.RowCanDelete(s))return!1;for(var r=0;r<this.FColWidths.count;r++)if(this.FRows[s][r].RowSpan<0){n=(i=this.GetDestCell(s,r)).row,o=i.col;for(var a=s;a<=n+this.FRows[n][o].RowSpan;a++)this.FRows[a][r].RowSpan++;r==o+this.FRows[n][o].ColSpan&&this.FRows[n][o].RowSpan--}else this.FRows[s][r].ColSpan;this.FRows.removeAt(s)}return this.DeleteEmptyCols(0,this.ColCount-1),this.CheckFixRowSafe(t),this.InitializeMouseInfo(),this.FSelectCellRang.Initialize(),this.FormatDirty(),!0}},{key:"dispose",value:function(){this.FRows.clear(),f()(F()(i.prototype),"dispose",this).call(this)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t);var e,n,o=t;this.ResetRowCol(o.Width,o.RowCount,o.ColCount),this.FBorderVisible=o.BorderVisible,this.BorderWidthPt=o.BorderWidthPt,this.FResizeKeepWidth=o.ResizeKeepWidth,this.CellHPaddingMM=o.CellHPaddingMM,this.CellVPaddingMM=o.CellVPaddingMM,this.FFixRow=o.FixRow,this.FFixRowCount=o.FixRowCount,this.FFixCol=o.FixCol,this.FFixColCount=o.FixColCount;for(var s=0;s<this.ColCount;s++)this.FColWidths[s]=o.FColWidths[s];for(var r=0;r<this.RowCount;r++){this.FRows[r].AutoHeight=o.Rows[r].AutoHeight,this.FRows[r].Height=o.Rows[r].Height;for(var a=0;a<=this.ColCount-1;a++)e=this.FRows[r][a],n=o.Rows[r][a],e.Width=this.FColWidths[a],e.RowSpan=n.RowSpan,e.ColSpan=n.ColSpan,e.BackgroundColor=n.BackgroundColor,e.AlignVert=n.AlignVert,e.BorderSides=n.BorderSides,e.LeftBorderStyle=n.LeftBorderStyle,e.TopBorderStyle=n.TopBorderStyle,e.RightBorderStyle=n.RightBorderStyle,e.BottomBorderStyle=n.BottomBorderStyle,e.LTRBBorderStyle=n.LTRBBorderStyle,e.RTLBBorderStyle=n.RTLBBorderStyle,null!=n.CellData?e.CellData.AddData(n.CellData):(e.CellData.dispose(),e.CellData=null)}}},{key:"DblClick",value:function(t,e){if(this.FSelectCellRang.EditCell()){var n=this.GetCellPostion(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol),o=this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol];o.CellData.DblClick(t-n.x-this.FCellHPaddingPix,e-n.y-o.GetCellDataTop(this.FCellVPaddingPix))}else f()(F()(i.prototype),"DblClick",this).call(this,t,e)}},{key:"CoordInSelect",value:function(t,e){var n=f()(F()(i.prototype),"CoordInSelect",this).call(this,t,e);if(n){var o=-1,s=-1,r=this.GetCellAt(t,e,o,s),a=r.resizeInfo;if(o=r.row,s=r.col,(n=a.TableSite==tr)&&this.FSelectCellRang.StartRow>=0)if(this.FSelectCellRang.EndRow>=0)n=o>=this.FSelectCellRang.StartRow&&o<=this.FSelectCellRang.EndRow&&s>=this.FSelectCellRang.StartCol&&s<=this.FSelectCellRang.EndCol;else{var l=this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol];if(l.CellData.SelectExists()){var h=this.GetCellPostion(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol),c=t-h.x-this.FCellHPaddingPix,u=e-h.y-l.GetCellDataTop(this.FCellVPaddingPix),d=-1,m=-1,S=-1,p=!1;d=(r=l.CellData.GetItemAt(c,u,d,m,S,p)).itemNo,m=r.offset,S=r.drawItemNo,p=r.restrain,n=l.CellData.CoordInSelect(c,u,d,m,p)}}}return n}},{key:"GetTopLevelDataAt",value:function(t,e){var i=null,n=-1,o=-1,s=this.GetCellAt(t,e,n,o);if(n=s.row,o=s.col,n<0||o<0)return i;var r=this.GetCellPostion(n,o);return i=this.FRows[n][o].CellData.GetTopLevelDataAt(t-r.x-this.FCellHPaddingPix,e-r.y-this.FCellVPaddingPix)}},{key:"GetTopLevelData",value:function(){var t=this.GetEditCell();return null!=t?t.CellData.GetTopLevelData():f()(F()(i.prototype),"GetTopLevelData",this).call(this)}},{key:"GetActiveData",value:function(){var t=this.GetEditCell();return null!=t?t.CellData:f()(F()(i.prototype),"GetActiveData",this).call(this)}},{key:"GetActiveItem",value:function(){var t=this.GetEditCell();return null!=t?t.CellData.GetActiveItem():f()(F()(i.prototype),"GetActiveItem",this).call(this)}},{key:"GetTopLevelItem",value:function(){var t=this.GetEditCell();return null!=t?t.CellData.GetTopLevelItem():f()(F()(i.prototype),"GetTopLevelItem",this).call(this)}},{key:"GetTopLevelDrawItem",value:function(){var t=this.GetActiveData();return null!=t?t.GetTopLevelDrawItem():f()(F()(i.prototype),"GetTopLevelDrawItem",this).call(this)}},{key:"GetTopLevelDrawItemCoord",value:function(){var t=et.Create(0,0),e=this.GetEditCell();if(null!=e){t=e.CellData.GetTopLevelDrawItemCoord();var i=this.GetCellPostion(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol);t.x=t.x+i.x+this.FCellHPaddingPix,t.y=t.y+i.y+e.GetCellDataTop(this.FCellVPaddingPix)}return t}},{key:"GetTopLevelRectDrawItem",value:function(){var t=this.GetActiveData();return null!=t?t.GetTopLevelRectDrawItem():f()(F()(i.prototype),"GetTopLevelRectDrawItem",this).call(this)}},{key:"GetTopLevelRectDrawItemCoord",value:function(){var t=et.Create(-1,-1),e=this.GetEditCell();if(null!=e){var i=e.CellData.GetTopLevelRectDrawItemCoord();i.x>=0&&((t=this.GetCellPostion(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol)).x=t.x+i.x+this.FCellHPaddingPix,t.y=t.y+i.y+e.GetCellDataTop(this.FCellVPaddingPix))}return t}},{key:"GetTopLevelRectItem",value:function(){var t=this.GetActiveData();return null!==t?t.GetTopLevelRectItem():f()(F()(i.prototype),"GetTopLevelRectItem",this).call(this)}},{key:"GetHint",value:function(){var t=f()(F()(i.prototype),"GetHint",this).call(this);if(this.FMouseMoveRow<0||this.FMouseMoveCol<0)return t;var e=this.FRows[this.FMouseMoveRow][this.FMouseMoveCol];return null!=e&&null!=e.CellData&&(t=e.CellData.GetHint()),t}},{key:"InsertText",value:function(t){var e=this,n=!1;if(this.FSelectCellRang.EditCell()){return this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){var i=e.FRows[e.FSelectCellRang.StartRow][e.FSelectCellRang.StartCol];n=i.CellData.InsertText(t)})),n}if(this.FSelectCellRang.SelectExists()&&this.OwnerData.Style.States.Contain(oh.Pasting)){for(var o=null,s=this.FSelectCellRang.StartRow;s<=this.FSelectCellRang.EndRow;s++)for(var r=this.FSelectCellRang.StartCol;r<=this.FSelectCellRang.EndCol;r++)null!==(o=this.FRows[s][r].CellData)&&(o.InsertText(t)&&(n=!0),this.IsFormatDirty||(this.IsFormatDirty=o.FormatHeightChange));return n}return f()(F()(i.prototype),"InsertText",this).call(this,t)}},{key:"InsertItem",value:function(t){var e=this,n=!1;if(this.FSelectCellRang.EditCell()){return this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){var i=e.FRows[e.FSelectCellRang.StartRow][e.FSelectCellRang.StartCol];n=i.CellData.InsertItem(t)})),n}if(this.FSelectCellRang.SelectExists()&&this.OwnerData.Style.States.Contain(oh.Pasting)){for(var o=null,s=this.FSelectCellRang.StartRow;s<=this.FSelectCellRang.EndRow;s++)for(var r=this.FSelectCellRang.StartCol;r<=this.FSelectCellRang.EndCol;r++)if(null!==(o=this.FRows[s][r].CellData)){var a=o.CreateItemByStyle(t.StyleNo);a.Assign(t),o.InsertItem(a)&&(n=!0),this.IsFormatDirty||(this.IsFormatDirty=o.FormatHeightChange)}return n}return f()(F()(i.prototype),"InsertItem",this).call(this,t)}},{key:"InsertStream",value:function(t,e,n){var o=this,s=!1;if(this.FSelectCellRang.EditCell()){return this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){var i=o.FRows[o.FSelectCellRang.StartRow][o.FSelectCellRang.StartCol];s=i.CellData.InsertStream(t,e,n)})),s}if(this.FSelectCellRang.SelectExists()&&this.OwnerData.Style.States.Contain(oh.Pasting)){for(var r=null,a=t.position,l=t.position,h=this.FSelectCellRang.StartRow;h<=this.FSelectCellRang.EndRow;h++)for(var c=this.FSelectCellRang.StartCol;c<=this.FSelectCellRang.EndCol;c++)null!==(r=this.FRows[h][c].CellData)&&(r.InsertStream(t,e,n)&&(l=t.position,s=!0),t.position=a,this.IsFormatDirty||(this.IsFormatDirty=r.FormatHeightChange));return t.position=l,s}return f()(F()(i.prototype),"InsertStream",this).call(this,t,e,n)}},{key:"InsertJSONObject",value:function(t){var e=this,n=!1;if(this.FSelectCellRang.EditCell()){return this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){var i=e.FRows[e.FSelectCellRang.StartRow][e.FSelectCellRang.StartCol];n=i.CellData.InsertJSONObject(t)})),n}return f()(F()(i.prototype),"InsertJSONObject",this).call(this,t)}},{key:"ReFormatActiveDomain",value:function(){var t=this;if(this.FSelectCellRang.EditCell()){this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){t.FRows[t.FSelectCellRang.StartRow][t.FSelectCellRang.StartCol].CellData.ReFormatActiveDomain()}))}this.FormatDirty()}},{key:"ReFormatActiveItem",value:function(){var t=this;if(this.FSelectCellRang.EditCell()){this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){t.FRows[t.FSelectCellRang.StartRow][t.FSelectCellRang.StartCol].CellData.ReFormatActiveItem()}))}this.FormatDirty()}},{key:"ActiveItemReAdaptEnvironment",value:function(){var t=this;if(this.FSelectCellRang.EditCell()){this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){t.FRows[t.FSelectCellRang.StartRow][t.FSelectCellRang.StartCol].CellData.ActiveItemReAdaptEnvironment()}))}}},{key:"DeleteActiveDomain",value:function(){var t=this,e=f()(F()(i.prototype),"DeleteActiveDomain",this).call(this);if(this.FSelectCellRang.EditCell()){this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){var i=t.FRows[t.FSelectCellRang.StartRow][t.FSelectCellRang.StartCol];e=i.CellData.DeleteActiveDomain()}))}return e}},{key:"InsertAnnotate",value:function(t,e,i){var n=this.GetEditCell();if(null==n)return!1;var o=!1;return this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){o=n.CellData.InsertAnnotate(t,e,i)})),o}},{key:"DeleteActiveAnnotate",value:function(){var t=this,e=f()(F()(i.prototype),"DeleteActiveAnnotate",this).call(this);if(this.FSelectCellRang.EditCell()){this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){var i=t.FRows[t.FSelectCellRang.StartRow][t.FSelectCellRang.StartCol];e=i.CellData.DeleteActiveAnnotate()}))}return e}},{key:"DeleteActiveDataItems",value:function(t,e,i){var n=this;if(this.FSelectCellRang.EditCell()){this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){n.FRows[n.FSelectCellRang.StartRow][n.FSelectCellRang.StartCol].CellData.DeleteActiveDataItems(t,e,i)}))}}},{key:"SetActiveItemText",value:function(t){var e=this;if(f()(F()(i.prototype),"SetActiveItemText",this).call(this,t),this.FSelectCellRang.EditCell()){this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){e.FRows[e.FSelectCellRang.StartRow][e.FSelectCellRang.StartCol].CellData.SetActiveItemText(t)}))}}},{key:"DoCrossCellKey",value:function(t,e){var i=!1,n=-1,o=-1,s=this.FSelectCellRang.StartRow,r=this.FSelectCellRang.StartCol;if(t==Je){if(e.CellData.SelectFirstItemOffsetBefor()){for(var a=this.FSelectCellRang.StartCol-1;a>=0;a--)if(this.FRows[this.FSelectCellRang.StartRow][a].ColSpan>=0){this.FRows[this.FSelectCellRang.StartRow][a].RowSpan<0&&(this.FSelectCellRang.StartRow+=this.FRows[this.FSelectCellRang.StartRow][a].RowSpan),o=a;break}o>=0&&(s>=0&&r>=0&&(this.FRows[s][r].Active=!1),this.FSelectCellRang.StartCol=o,this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].Active=!0,this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].CellData.SelectLastItemAfterWithCaret(),i=!0)}}else if(t==Ye){if(e.CellData.SelectLastItemOffsetAfter()){for(var l=this.FSelectCellRang.StartCol+1;l<this.FColWidths.count;l++)if(this.FRows[this.FSelectCellRang.StartRow][l].ColSpan>=0){this.FRows[this.FSelectCellRang.StartRow][l].RowSpan<0&&(this.FSelectCellRang.StartRow+=this.FRows[this.FSelectCellRang.StartRow][l].RowSpan),o=l;break}o>=0&&(s>=0&&r>=0&&(this.FRows[s][r].Active=!1),this.FSelectCellRang.StartCol=o,this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].Active=!0,this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].CellData.SelectFirstItemBeforWithCaret(),i=!0)}}else if(t==je){if(e.CellData.SelectFirstLine()&&this.FSelectCellRang.StartRow>0){var h=this.GetDestCell(this.FSelectCellRang.StartRow-1,this.FSelectCellRang.StartCol);n=h.row,o=h.col,n>=0&&o>=0&&(s>=0&&r>=0&&(this.FRows[s][r].Active=!1),this.FSelectCellRang.StartRow=n,this.FSelectCellRang.StartCol=o,this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].Active=!0,this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].CellData.SelectLastItemAfterWithCaret(),i=!0)}}else if(t==Qe&&e.CellData.SelectLastLine()&&this.FSelectCellRang.StartRow<this.RowCount-1){var c=this.GetDestCell(this.FSelectCellRang.StartRow+1,this.FSelectCellRang.StartCol);n=c.row,o=c.col,n>=0&&o>=0&&(s>=0&&r>=0&&(this.FRows[s][r].Active=!1),this.FSelectCellRang.StartRow=n,this.FSelectCellRang.StartCol=o,this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].Active=!0,this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].CellData.SelectFirstItemBeforWithCaret(),i=!0)}return s===this.FSelectCellRang.StartRow&&r===this.FSelectCellRang.StartCol||this.DoSelectCellChange(s,r,this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol),i}},{key:"KeyDown",value:function(t){var e=this.GetEditCell();if(null!=e){var i=t.keyCode;switch(t.keyCode){case Ee:case Xe:case Le:case Me:this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){e.CellData.KeyDown(t)}));break;case Je:case Ye:case je:case Qe:case Ke:case ze:e.CellData.KeyDown(t),t.Handled&&Yl.IsDirectionKey(t.keyCode)&&this.DoCrossCellKey(t.keyCode,e)&&(this.OwnerData.Style.UpdateInfoReCaret(),t.keyCode=i);break;default:e.CellData.KeyDown(t)}null!=this.OnKeyDown&&this.OnKeyDown(t)}else t.Handled=!0}},{key:"KeyPress",value:function(t){var e=this.GetEditCell();if(null!=e){this.CellChangeByAction(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,(function(){e.CellData.KeyPress(t)}))}}},{key:"GetText",value:function(){for(var t=f()(F()(i.prototype),"GetText",this).call(this),e=0;e<this.FRows.count;e++)for(var n=0;n<this.FRows[e].ColCount;n++)null!=this.FRows[e][n].CellData&&(t+=""!=t?"，"+this.FRows[e][n].CellData.SaveToText():this.FRows[e][n].CellData.SaveToText());return t}},{key:"GetPageBreakCount",value:function(){return this.FPageBreaks.count}},{key:"IsSelectComplateTheory",value:function(){return this.IsSelectComplate}},{key:"SelectExists",value:function(){var t=!1;return this.IsSelectComplate?t=!0:this.FSelectCellRang.StartRow>=0&&(t=this.FSelectCellRang.EndRow>=0||this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].CellData.SelectExists()),t}},{key:"GetOffsetAt",value:function(t){return t<=0?Yl.OffsetBefor:t>=this.Width?Yl.OffsetAfter:Yl.OffsetInner}},{key:"GetTextStyleNo",value:function(){var t,e=oo.Null;return this.OwnerData.Style.UpdateInfo.DragingSelected&&this.FMouseMoveRow>=0?(t=this.FRows[this.FMouseMoveRow][this.FMouseMoveCol]).CellData.MouseMoveItemNo>=0&&(e=t.CellData.Items[t.CellData.MouseMoveItemNo].StyleNo):null!==(t=this.GetEditCell())&&(e=t.CellData.CurStyleNo),e===oo.Null&&(e=f()(F()(i.prototype),"GetTextStyleNo",this).call(this)),e}},{key:"TraverseItem",value:function(t){for(var e=0;e<this.FRows.count&&!t.Stop;e++)for(var i=0;i<this.FColWidths.count&&!t.Stop;i++)null!==this.FRows[e][i].CellData&&this.FRows[e][i].CellData.TraverseItem(t)}},{key:"Traverse",value:function(t){if(null!=t){var e=new Ks;e.ReverseOrder=!0,e.Process=function(e,i,n,o,s){t(e,i)},this.TraverseItem(e)}}},{key:"Search",value:function(t,e,i){var n=!1,o=-1,s=-1,r=null;if(e){if(this.FSelectCellRang.StartRow<0&&(this.FSelectCellRang.StartRow=this.FRows.count-1,this.FSelectCellRang.StartCol=this.FColWidths.count-1,this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].Active=!0,o=this.FSelectCellRang.StartRow,s=this.FSelectCellRang.StartCol,null!=this.FRows[o][s].CellData&&((r=this.FRows[o][s].CellData).SelectInfo.StartItemNo=r.Items.count-1,r.SelectInfo.StartItemOffset=r.GetItemOffsetAfter(r.Items.count-1))),o=this.FSelectCellRang.StartRow,s=this.FSelectCellRang.StartCol,o>=0&&s>=0){if(null!=this.FRows[o][s].CellData&&(n=this.FRows[o][s].CellData.Search(t,e,i)),!n)for(var a=s-1;a>=0&&(this.FRows[o][a].ColSpan<0||this.FRows[o][a].RowSpan<0||(this.FSelectCellRang.StartRow>=0&&this.FSelectCellRang.StartCol>=0&&(this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].Active=!1),this.FSelectCellRang.StartCol=a,this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].Active=!0,(r=this.FRows[o][a].CellData).SelectInfo.StartItemNo=r.Items.count-1,r.SelectInfo.StartItemOffset=r.GetItemOffsetAfter(r.Items.count-1),!(n=this.FRows[o][a].CellData.Search(t,e,i))));a--);if(!n)for(var l=this.FSelectCellRang.StartRow-1;l>=0;l--){for(var h=this.FColWidths.count-1;h>=0&&(this.FRows[l][h].ColSpan<0||this.FRows[l][h].RowSpan<0||(this.FSelectCellRang.StartRow>=0&&this.FSelectCellRang.StartCol>=0&&(this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].Active=!1),this.FSelectCellRang.StartRow=l,this.FSelectCellRang.StartCol=h,this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].Active=!0,(r=this.FRows[l][h].CellData).SelectInfo.StartItemNo=r.Items.count-1,r.SelectInfo.StartItemOffset=r.GetItemOffsetAfter(r.Items.count-1),!(n=this.FRows[l][h].CellData.Search(t,e,i))));h--);if(n)break}}}else if(this.FSelectCellRang.StartRow<0&&(this.FSelectCellRang.StartRow=0,this.FSelectCellRang.StartCol=0,this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].Active=!0,this.FRows[0][0].CellData.SelectInfo.StartItemNo=0,this.FRows[0][0].CellData.SelectInfo.StartItemOffset=0),o=this.FSelectCellRang.StartRow,s=this.FSelectCellRang.StartCol,o>=0&&s>=0){if(!(n=this.FRows[o][s].CellData.Search(t,e,i)))for(var c=s+1;c<this.FColWidths.count&&(this.FRows[o][c].ColSpan<0||this.FRows[o][c].RowSpan<0||(this.FSelectCellRang.StartRow>=0&&this.FSelectCellRang.StartCol>=0&&(this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].Active=!1),this.FSelectCellRang.StartCol=c,this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].Active=!0,this.FRows[o][c].CellData.SelectInfo.StartItemNo=0,this.FRows[o][c].CellData.SelectInfo.StartItemOffset=0,!(n=this.FRows[o][c].CellData.Search(t,e,i))));c++);if(!n)for(var u=this.FSelectCellRang.StartRow+1;u<this.FRows.count;u++){for(var f=0;f<this.FColWidths.count&&(this.FRows[u][f].ColSpan<0||this.FRows[u][f].RowSpan<0||(this.FSelectCellRang.StartRow>=0&&this.FSelectCellRang.StartCol>=0&&(this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].Active=!1),this.FSelectCellRang.StartRow=u,this.FSelectCellRang.StartCol=f,this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].Active=!0,this.FRows[u][f].CellData.SelectInfo.StartItemNo=0,this.FRows[u][f].CellData.SelectInfo.StartItemOffset=0,!(n=this.FRows[u][f].CellData.Search(t,e,i))));f++);if(n)break}}return n||(this.FSelectCellRang.StartRow>=0&&this.FSelectCellRang.StartCol>=0&&(this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].Active=!1),this.FSelectCellRang.Initialize()),n}},{key:"CheckFormatPageBreakBefor",value:function(){this.FPageBreaks.clear();for(var t=0;t<this.FRows.count;t++)for(var e=0;e<this.FRows[t].ColCount;e++)this.FRows[t][e].KeepPageOffs=0}},{key:"ApplySelectTextStyle",value:function(t,e){var i=null;if(this.FSelectCellRang.EditCell())(i=this.GetEditCell().CellData).ApplySelectTextStyle(e),this.IsFormatDirty=i.FormatHeightChange||i.FormatDrawItemCountChange;else if(this.FSelectCellRang.StartRow>=0)for(var n=this.FSelectCellRang.StartRow;n<=this.FSelectCellRang.EndRow;n++)for(var o=this.FSelectCellRang.StartCol;o<=this.FSelectCellRang.EndCol;o++)if(null!=(i=this.FRows[n][o].CellData))if(this.IsFormatDirty){i.BeginFormat();try{i.ApplySelectTextStyle(e)}finally{i.EndFormat(!1)}}else i.ApplySelectTextStyle(e),this.IsFormatDirty=i.FormatHeightChange|i.FormatDrawItemCountChange}},{key:"ApplySelectParaStyle",value:function(t,e){if(f()(F()(i.prototype),"ApplySelectParaStyle",this).call(this,t,e),this.FSelectCellRang.StartRow>=0){var n=null;if(this.FSelectCellRang.EndRow>=0){for(var o=this.FSelectCellRang.StartRow;o<=this.FSelectCellRang.EndRow;o++)for(var s=this.FSelectCellRang.StartCol;s<=this.FSelectCellRang.EndCol;s++)if(null!=(n=this.FRows[o][s].CellData))if(this.IsFormatDirty){n.BeginFormat();try{n.ApplySelectParaStyle(e)}finally{n.EndFormat(!1)}}else n.ApplySelectParaStyle(e),this.IsFormatDirty=n.FormatHeightChange||n.FormatDrawItemCountChange}else(n=this.GetEditCell().CellData).ApplySelectParaStyle(e),this.IsFormatDirty=n.FormatHeightChange||n.FormatDrawItemCountChange}else this.ParaNo=e.GetMatchParaNo(this.hcl,this.OwnerData.Style,this.ParaNo)}},{key:"ApplyCellAlign_",value:function(t,e){switch(e){case ih.TopLeft:case ih.TopCenter:case ih.TopRight:t.AlignVert=hr;break;case ih.CenterLeft:case ih.CenterCenter:case ih.CenterRight:t.AlignVert=cr;break;default:t.AlignVert=ur}var i=t.CellData;if(null!=i){i.BeginFormat();try{switch(e){case ih.TopLeft:case ih.CenterLeft:case ih.BottomLeft:i.ApplyParaAlignHorz(Ln.Left);break;case ih.TopCenter:case ih.CenterCenter:case ih.BottomCenter:i.ApplyParaAlignHorz(Ln.Center);break;default:i.ApplyParaAlignHorz(Ln.Right)}}finally{i.EndFormat(!0)}}}},{key:"ApplyContentAlign",value:function(t){if(f()(F()(i.prototype),"ApplyContentAlign",this).call(this,t),this.FSelectCellRang.StartRow>=0)if(this.FSelectCellRang.EndRow>=0)for(var e=this.FSelectCellRang.StartRow;e<=this.FSelectCellRang.EndRow;e++)for(var n=this.FSelectCellRang.StartCol;n<=this.FSelectCellRang.EndCol;n++)this.ApplyCellAlign_(this.FRows[e][n],t);else this.ApplyCellAlign_(this.GetEditCell(),t);else for(var o=0;o<this.FRows.count;o++)for(var s=0;s<this.FColWidths.count;s++)this.ApplyCellAlign_(this.FRows[o][s],t)}},{key:"FormatToDrawItem",value:function(t,e){if(this.IsFormatDirty){this.DoFormatToDrawItem();for(var i=0;i<this.RowCount;i++)this.FormatRow(i),this.CalcRowCellHeight(i);this.CalcMergeRowHeightFrom(0),this.Height=this.GetFormatHeight(),this.Width=this.GetFormatWidth(),this.FSelectCellRang.SelectExists()&&this.MatchCellSelectState()}else this.ClearFormatExtraHeight()}},{key:"WantKeyDown",value:function(t){if(t.keyCode===He||t.keyCode===Ge||t.keyCode===Ve)return!1;if(t.keyCode===Ye)if(this.FSelectCellRang.StartRow<0)this.FRows[0][0].CellData.ItemSetCaretRequest(0,0);else{var e=this.GetDestCell(this.FRows.count-1,this.FColWidths.count-1);if(this.FSelectCellRang.StartRow===e.row&&this.FSelectCellRang.StartCol===e.col&&this.FRows[e.row][e.col].CellData.SelectLastItemOffsetAfter())return!1}else if(t.keyCode===Je)if(this.FSelectCellRang.StartRow<0){var i=this.GetDestCell(this.FRows.count-1,this.FColWidths.count-1);i.row>=0&&this.FRows[i.row][i.col].CellData.ItemSetCaretRequest(0,0)}else if(0===this.FSelectCellRang.StartRow&&0===this.FSelectCellRang.StartCol&&this.FRows[0][0].CellData.SelectFirstItemOffsetBefor())return!1;return!0}},{key:"AddPageBreak",value:function(t,e,i,n,o){var s=new pr;return s.PageIndex=i,s.Row=t,s.BreakSeat=e,s.BreakBottom=n-o,this.FPageBreaks.add(s),s}},{key:"GetPageBreakHeight",value:function(t){var e=f()(F()(i.prototype),"GetPageBreakHeight",this).call(this,t);if(this.FPageBreaks.count>0){for(var n=!1,o=0,s=0;s<this.FPageBreaks.count;s++)if(this.FPageBreaks[s].PageIndex===t-1)o=this.FPageBreaks[s].BreakBottom;else if(this.FPageBreaks[s].PageIndex===t){e=this.FPageBreaks[s].BreakSeat-o,n=!0;break}n||(e-=o)}return e}},{key:"CheckFormatPageBreak",value:function(t,e,i,n,o,s,r,a,l){r=-1,a=0,l=0;for(var h=e+this.FBorderWidthPix-1,c=0;c<s;c++)h+=this.FRows[c].FmtOffset+this.FRows[c].Height+this.FBorderWidthPix;for(var u=s,f=0;u<this.RowCount;){if((f=h+this.FRows[u].FmtOffset+this.FRows[u].Height+this.FBorderWidthPix)>o){r=u,!this.FRows[u].AutoHeight&&this.OwnerData.Style.FormatVersion>3&&h+this.FRows[u].FmtOffset+this.FRows[u].CalcNorHeight()+this.FBorderWidthPix<=o&&(a=this.FRows[u].CalcNorHeight()-this.FRows[u].Height,this.FRows[u].RecoverNorHeight(),r=-1);break}h=f,u++}if(r<0)return{breakSeat:r,fmtOffset:a,fmtHeightInc:l};if(!this.CanPageBreak&&0==r)return{breakSeat:r,fmtOffset:a=o-e,fmtHeightInc:l};for(var d,m,S=!0,p=!1,y=o,F=-1,v=-1,I=0,g=null,C=null,w=0;w<this.FRows[r].ColCount;w++)if(!(this.FRows[r][w].ColSpan<0)){F=(d=this.GetDestCell(r,w)).row,v=d.col,g=this.FRows[F][v].CellData,I=h+this.FCellVPaddingPix,r!=F&&(I-=this.SrcCellDataTopDistanceToDest(r,F)),m=this.FRows[F][v].GetCellDataTop(this.FCellVPaddingPix);for(var A=0;A<g.DrawItems.count;A++)if((C=g.DrawItems[A]).LineFirst&&I+m+C.rect.bottom+this.FBorderWidthPix>o){p=!0,0==A&&(S=!1,y=h);break}if(!S)break}S&&!p&&(S=!1);for(var D,P=0,k=0,x=0,R=0,T=new ot,b=0;b<this.FRows[r].ColCount;b++)if(!(this.FRows[r][b].ColSpan<0)){F=(d=this.GetDestCell(r,b)).row,v=d.col,g=this.FRows[F][v].CellData,R=this.FRows[F][v].Height-(this.FCellVPaddingPix+g.height+this.FCellVPaddingPix),I=h+this.FCellVPaddingPix,r!=F&&(I-=this.SrcCellDataTopDistanceToDest(r,F)),(D=new Fr).Col=b;for(var B=0;B<g.DrawItems.count;B++)if((C=g.DrawItems[B]).LineFirst&&I+C.rect.bottom+this.FCellVPaddingPix+this.FBorderWidthPix>y){P=(x=o-(I+C.rect.top)+this.FBorderWidthPix+this.FCellVPaddingPix-1)>R?x-R:0,D.DrawItemNo=B,D.VDrawOffset=x,B>0?I+g.DrawItems[B-1].rect.bottom+this.FCellVPaddingPix+this.FBorderWidthPix>k&&(k=I+g.DrawItems[B-1].rect.bottom+this.FCellVPaddingPix+this.FBorderWidthPix):I>k&&(k=I-this.FCellVPaddingPix);break}l<P&&(l=P),T.add(D),this.FRows[F][v].AlignVert!==hr&&(D.DrawItemNo<0?this.FRows[F][v].KeepPageOffs=I-this.FCellVPaddingPix+this.FRows[F][v].Height-y+this.FBorderWidthPix:this.FRows[F][v].KeepPageOffs=-1)}k=k-e+1;var N=0;if(this.FFixRow>=0&&r>this.FFixRow+this.FFixRowCount-1&&(l+=N=this.GetFixRowHeight()),S)this.FRows[r].Height=this.FRows[r].Height+l;else{if(0==r)return{breakSeat:r,fmtOffset:a=o-e,fmtHeightInc:l=0};for(var O=0;O<T.count;O++)0==T[O].DrawItemNo&&(T[O].VDrawOffset>0?(this.FRows[r].FmtOffset=T[O].VDrawOffset+N,T[O].VDrawOffset=0):this.FRows[r].FmtOffset=N)}for(var _=this.AddPageBreak(r,k,t,o,e),E=0;E<T.count;E++)if(!(T[E].DrawItemNo<0||0==T[E].VDrawOffset)){F=(d=this.GetDestCell(r,T[E].Col)).row,v=d.col,g=this.FRows[F][v].CellData;for(var M=T[E].DrawItemNo;M<g.DrawItems.count;M++)g.DrawItems[M].rect.offset(0,T[E].VDrawOffset+N);_.Col=E,_.DrawItemNo=T[E].DrawItemNo}return this.CalcMergeRowHeightFrom(r),T=null,{breakSeat:r,fmtOffset:a,fmtHeightInc:l}}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FBorderVisible&&(o|=128),this.FResizeKeepWidth&&(o|=64),t.writeByte(o),t.writeSingle(this.FBorderWidthPt),t.writeSingle(this.FCellVPaddingMM),t.writeSingle(this.FCellHPaddingMM),t.writeInt32(this.FRows.count),t.writeInt32(this.FColWidths.count),t.writeByte(this.FFixRow),t.writeByte(this.FFixRowCount),t.writeByte(this.FFixCol),t.writeByte(this.FFixColCount);for(var s=0;s<=this.FColWidths.count-1;s++)t.writeInt32(this.FColWidths[s]);for(var r=0;r<=this.FRows.count-1;r++){t.writeBoolean(this.FRows[r].AutoHeight),this.FRows[r].AutoHeight||t.writeInt32(this.FRows[r].Height);for(var a=0;a<=this.FRows[r].ColCount-1;a++)this.FRows[r][a].SaveToStream(t);this.FRows[r].SaveToStream(t)}}},{key:"SaveSelectToStream",value:function(t){if(this.IsSelectComplate)this.hcl.exception("保存选中内容出错，表格不应该由内部处理全选中的保存！");else if(this.FSelectCellRang.EditCell()){var e=this.GetActiveData();null!==e&&e.SaveSelectToStream(t)}else this.FSelectCellRang.SelectExists()&&(this.OwnerData.Style.CopyRectPart=!0,this.SaveToPartStream(t))}},{key:"SaveSelectToText",value:function(){var t="",e=null;if(this.FSelectCellRang.EditCell())null!==(e=this.GetActiveData())&&(t=e.SaveSelectToText());else if(this.FSelectCellRang.SelectExists())for(var i="",n=this.FSelectCellRang.StartRow;n<=this.FSelectCellRang.EndRow;n++){i="";for(var o=this.FSelectCellRang.StartCol;o<=this.FSelectCellRang.EndCol;o++)null!==this.FRows[n][o].CellData&&(i+=this.FRows[n][o].CellData.SaveToText());""!==i&&(""===t?t=i:t+=Yl.sLineBreak+i)}return t}},{key:"SelectToHtml",value:function(){var t="",e=null;return this.FSelectCellRang.EditCell()?null!==(e=this.GetActiveData())&&(t=e.SelectToHtml()):this.FSelectCellRang.SelectExists()&&(t=this.ToHtmlRange(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,this.FSelectCellRang.EndRow,this.FSelectCellRang.EndCol)),t}},{key:"LoadFromStream",value:function(t,e,n){if(this.FRows.clear(),f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),n>55){var o=t.readByte();this.FBorderVisible=L.isOdd(o>>7),this.FResizeKeepWidth=L.isOdd(o>>6)}else this.FBorderVisible=t.readBoolean();n>31?this.BorderWidthPt=t.readSingle():n>29&&(this.FBorderWidthPix=t.readByte(),this.FBorderWidthPt=Math.min(.5,En.pixelToPt(this.FBorderWidthPix,En.PixelsPerInchX))),n>34?(this.FCellVPaddingMM=t.readSingle(),this.FCellVPaddingPix=En.millimeterToPixY(this.FCellVPaddingMM),this.FCellHPaddingMM=t.readSingle(),this.FCellHPaddingPix=En.millimeterToPixY(this.FCellHPaddingMM)):(this.FCellVPaddingMM=En.pixYToMillimeter(2),this.FCellVPaddingPix=2,this.FCellHPaddingMM=En.pixXToMillimeter(2),this.FCellHPaddingPix=2);var s,r=t.readInt32(),a=t.readInt32();n>24&&(this.FFixRow=t.readInt8(),this.FFixRowCount=t.readByte(),this.FFixCol=t.readInt8(),this.FFixColCount=t.readByte());for(var l=0;l<r;l++)s=this.DoCreateRow(this.OwnerData.Style,a),this.FRows.add(s);this.FColWidths.clear();for(var h=Yl.MinColWidth,c=0;c<a;c++)h=t.readInt32(),this.FColWidths.add(h);this.DoColCountChange();for(var u=!1,d=0;d<this.FRows.count;d++){u=t.readBoolean(),this.FRows[d].AutoHeight=u,this.FRows[d].AutoHeight||(this.FRows[d].Height=t.readInt32());for(var m=0;m<this.FRows[d].ColCount;m++)this.FRows[d][m].CellData.Width=this.FColWidths[m]-2*this.FCellHPaddingPix,this.FRows[d][m].LoadFromStream(t,e,n);this.FRows[d].LoadFromStream(t,n)}}},{key:"ToHtmlRange",value:function(t,e,i,n){var o,s='<table border="';this.FBorderVisible?s+=this.FBorderWidthPix.toString():s+="0",s+='" cellpadding="0"; cellspacing="0">';for(var r=t;r<=i;r++){s+=Yl.sLineBreak+"<tr>";for(var a=e;a<=n;a++)if(!((o=this.FRows[r][a]).RowSpan<0||o.ColSpan<0)){switch(s+=Yl.sLineBreak+L.stringFormat('<td rowspan="{0}" colspan="{1}" width="{2}" height="{3}"',o.RowSpan+1,o.ColSpan+1,o.Width,o.Height),o.AlignVert){case hr:s+='valign="top"';break;case cr:s+='valign="middle"';break;case ur:s+='valign="bottom"'}s+=">",null!==o.CellData&&(s+=o.CellData.ToHtml()),s+=Yl.sLineBreak+"</td>"}s+=Yl.sLineBreak+"</tr>"}return s+=Yl.sLineBreak+"</table>"}},{key:"ToHtml",value:function(){return this.ToHtmlRange(0,0,this.FRows.count-1,this.FColWidths.count-1)}},{key:"ToXml",value:function(t){}},{key:"ParseXml",value:function(t){this.DoColCountChange()}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.RowCount&&null!=t.ColCount&&this.ResetRowCol(null!=t.Width?t.Width:this.OwnerData.Width,t.RowCount,t.ColCount),null!=t.BorderVisible&&(this.FBorderVisible=t.BorderVisible),null!=t.ResizeKeepWidth&&(this.FResizeKeepWidth=t.ResizeKeepWidth),null!=t.BorderWidthPt&&(this.BorderWidthPt=t.BorderWidthPt),null!=t.CellVPaddingMM&&(this.FCellVPaddingMM=t.CellVPaddingMM,this.FCellVPaddingPix=En.millimeterToPixY(this.FCellVPaddingMM)),null!=t.CellHPaddingMM&&(this.FCellHPaddingMM=t.CellHPaddingMM,this.FCellHPaddingPix=En.millimeterToPixY(this.FCellHPaddingMM)),null!=t.FixRow&&(this.FFixRow=t.FixRow,null!=t.FixRowCount&&(this.FFixRowCount=t.FixRowCount)),null!=t.FixCol&&(this.FFixCol=t.FixCol,null!=t.FixColCount&&(this.FFixColCount=t.FixColCount));var e=0;if(t.ColWidths){for(var n,o=0,s=-1,r=this.Width,a=Math.min(this.ColCount,t.ColWidths.length),l=0;l<a;l++)(n=t.ColWidths[l].toString()).indexOf("%")>=0?(n=n.replace(/%/,""),(s=L.parseIntDef(n,-1))>0&&(s=Math.trunc(this.Width*s/100))):L.isNumber(t.ColWidths[l])&&(s=L.parseIntDef(t.ColWidths[l],-1)),s>0&&(this.FColWidths[o]=s),r=r-this.FColWidths[o]-this.FBorderWidthPix,o++;for(r=Math.trunc(r/(t.ColCount-o))-this.FBorderWidthPix;o<t.ColCount;)this.FColWidths[o]=r,o++}if(t.Rows)for(var h=Math.min(this.RowCount,t.Rows.length),c=0;c<h;c++)if(null!=t.Rows[c].AutoHeight&&(this.FRows[c].AutoHeight=t.Rows[c].AutoHeight),t.Rows[c].Cells){e=Math.min(this.ColCount,t.Rows[c].Cells.length);for(var u=0;u<e;u++)null!=t.Rows[c].Cells[u].RowSpan&&(this.Rows[c][u].RowSpan=t.Rows[c].Cells[u].RowSpan,this.Rows[c][u].RowSpan<0&&(this.Rows[c][u].CellData=null)),null!=t.Rows[c].Cells[u].ColSpan&&(this.Rows[c][u].ColSpan=t.Rows[c].Cells[u].ColSpan,this.Rows[c][u].ColSpan<0&&(this.Rows[c][u].CellData=null)),this.Rows[c][u].CellData&&(t.Rows[c].Cells[u].Text?this.Rows[c][u].CellData.Items[0].Text=t.Rows[c].Cells[u].Text:t.Rows[c].Cells[u].CellData&&this.Rows[c][u].CellData.ParseJSONObject(t.Rows[c].Cells[u].CellData)),t.Rows[c].Cells[u].Align&&this.ApplyCellAlign_(this.Rows[c][u],t.Rows[c].Cells[u].Align)}}},{key:"RowsToJSONString",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i="",n="",o=0;o<this.FRows.count;o++)n=this.FRows[o].ToJSONString(t,e),t?""!==n&&(i+=n+","):i+="{"+n+"},";return","===i[i.length-1]&&(i=i.substring(0,i.length-1)),i}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?this.RowsToJSONString(t,e):f()(F()(i.prototype),"ToJSONString",this).call(this,t,e)+',"RowCount":"'+this.RowCount.toString()+'","ColCount":"'+this.ColCount.toString()+'","Rows":['+this.RowsToJSONString(t,e)+"]"}},{key:"PasteRectPart",value:function(t,e,i,n){if(this.FMouseDownRow>=0&&this.DoSelectCellChange(this.FMouseDownRow,this.FMouseDownCol,-1,-1),t===lh.Table&&this.FSelectCellRang.StartRow>=0){var o=e.readInt32(),s=this.OwnerData.CreateItemByStyle(o);try{if(s.LoadFromStream(e,i,n),this.Undo_Mirror(),this.FSelectCellRang.EndRow<0)this.GetEditCell().CellData.AddData(s.Rows[0][0].CellData);else for(var r=null,a=Math.min(s.RowCount,this.FSelectCellRang.EndRow-this.FSelectCellRang.StartRow+1),l=Math.min(s.ColCount,this.FSelectCellRang.EndCol-this.FSelectCellRang.StartCol+1),h=0;h<a;h++)for(var c=0;c<l;c++)null==(r=this.FRows[this.FSelectCellRang.StartRow+h][this.FSelectCellRang.StartCol+c]).CellData||r.CellData.ReadOnly||null==s.Rows[h][c].CellData||(r.CellData.Items.clear(),r.CellData.AddData(s.Rows[h][c].CellData));return this.FormatDirty(),!0}finally{s=null}}return!1}},{key:"SaveToPartStream",value:function(t){t.writeByte(lh.Table),this.SaveCellsToStream(t,this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,this.FSelectCellRang.EndRow,this.FSelectCellRang.EndCol)}},{key:"LoadFromPartStream",value:function(t,e,i){this.LoadFromStream(t,e,i)}},{key:"Clear",value:function(){for(var t=0;t<this.FRows.count;t++)for(var e=0;e<this.FColWidths.count;e++)null!==this.FRows[t][e].CellData&&this.FRows[t][e].CellData.Clear();this.FormatDirty()}},{key:"SaveCellsToStream",value:function(t,e,i,n,o){var s=this,r=this.OwnerData.CreateItemByStyle(this.StyleNo);try{for(var a=this.FBorderWidthPix,l=i;l<=o;l++)a+=this.FColWidths[l]+this.FBorderWidthPix;var h,c,u=null;r.ResetRowCol(a,n-e+1,o-i+1),r.BorderVisible=this.FBorderVisible,r.BorderWidthPt=this.FBorderWidthPt,r.CellVPaddingMM=this.FCellVPaddingMM,r.CellHPaddingMM=this.FCellHPaddingMM;for(var f=e;f<=n;f++){r.Rows[f-e].Height=this.FRows[e].Height,r.Rows[f-e].AutoHeight=this.FRows[e].AutoHeight;for(var d=i;d<=o;d++)h=r.Rows[f-e][d-i],c=this.FRows[f][d],h.Width=c.Width,h.Height=c.Height,h.RowSpan=c.RowSpan,h.ColSpan=c.ColSpan,h.RightOffset=c.RightOffset,h.BackgroundColor=c.BackgroundColor,h.AlignVert=c.AlignVert,h.BorderSides=c.BorderSides,h.LeftBorderStyle=c.LeftBorderStyle,h.TopBorderStyle=c.TopBorderStyle,h.RightBorderStyle=c.RightBorderStyle,h.BottomBorderStyle=c.BottomBorderStyle,h.LTRBBorderStyle=c.LTRBBorderStyle,h.RTLBBorderStyle=c.RTLBBorderStyle,null!=c.CellData?((u=h.CellData).BeginFormat(),u.Items.clear(),u.OnSaveItem=function(t,e){return s.OwnerData.OnSaveItem(t,e)},u.OnCreateItemByStyle=function(t,e){return s.OwnerData.OnCreateItemByStyle(t,e)},u.AddData(c.CellData)):(h.CellData.dispose(),h.CellData=null)}r.SaveToStream(t)}finally{r=null}}},{key:"ResetRowCol",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.FFixRow=-1,this.FFixRowCount=0,this.FFixCol=-1,this.FFixColCount=0,this.FDefaultRowHeight=Yl.MinRowHeight,this.InitializeMouseInfo(),this.FSelectCellRang.Initialize(),this.Width=t;var o=-1;Yl.RESETTABLEUSEFIRSTROWHEIGHT&&this.FRows.count>0&&(o=this.FRows[0].Height),this.Height=e*(this.FDefaultRowHeight+this.FBorderWidthPix)+this.FBorderWidthPix;var s,r=t-(i+1)*this.FBorderWidthPix;this.FRows.clear();for(var a=0;a<e;a++)(s=this.DoCreateRow(this.OwnerData.Style,i)).SetRowWidth(r),0==a&&(n?o=s[0].CellData.height+this.FCellVPaddingPix+this.FCellVPaddingPix:o<0&&(o=this.FDefaultRowHeight)),Yl.RESETTABLEUSEFIRSTROWHEIGHT&&(s.Height=o,o!=this.FDefaultRowHeight&&(s.AutoHeight=!1)),this.FRows.add(s);this.FColWidths.clear();for(var l=0;l<i;l++)this.FColWidths.add(this.FRows[0][l].Width);return this.DoColCountChange(),this.FormatDirty(),!0}},{key:"GetFormatWidth",value:function(){for(var t=this.FBorderWidthPix,e=0;e<this.FColWidths.count;e++)t=t+this.FColWidths[e]+this.FBorderWidthPix;return t}},{key:"AdjustWidth",value:function(t){var e=this.OwnerData.Width-this.GetFormatWidth();if(0!=e){for(var i=Math.trunc(e/this.FColWidths.count),n=e%this.FColWidths.count,o=0;o<this.FColWidths.count;o++)this.FColWidths[o]+=i,0!=n&&(o==this.FColWidths.count-1?this.FColWidths[o]+=n:n>0?(this.FColWidths[o]+=1,n--):(this.FColWidths[o]-=1,n++));t&&this.ReFormatRequest()}}},{key:"CheckRowBorderRang",value:function(t,e){return t>=e-this.GripSize&&t<=e+this.GripSize}},{key:"CheckColBorderRang",value:function(t,e){return t>=e-this.GripSize&&t<=e+this.GripSize}},{key:"GetCellAt",value:function(t,e,i,n){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=new rr;if(s.TableSite=$s,s.DestX=-1,s.DestY=-1,i=-1,n=-1,e<0||e>this.Height)return{resizeInfo:s,row:i,col:n};var r=0,a=0;if(t<0||t>this.Width){r=this.FBorderWidthPix;for(var l=0;l<this.RowCount;l++){if(a=(r+=this.FRows[l].FmtOffset)+this.FRows[l].Height,r<e&&a>e){i=l;break}r=a}return{resizeInfo:s,row:i,col:n}}if(r=this.FBorderWidthPix,this.CheckRowBorderRang(e,r))return s.TableSite=ir,{resizeInfo:s,row:i,col:n};if(this.CheckColBorderRang(t,r))return s.TableSite=er,{resizeInfo:s,row:i,col:n};for(var h=0;h<this.RowCount;h++){if(a=(r+=this.FRows[h].FmtOffset)+this.FRows[h].Height+this.FBorderWidthPix,this.CheckRowBorderRang(e,a)){i=h,s.TableSite=or,s.DestY=a;break}if(r<e&&a>e){i=h;break}r=a}if(i<0)return{resizeInfo:s,row:i,col:n};for(var c,u=this.FBorderWidthPix,f=0,d=-1,m=-1,S=0;S<this.FColWidths.count;S++){if(f=u+this.FColWidths[S]+this.FBorderWidthPix,d=(c=this.GetDestCell(i,S)).row,m=c.col,this.CheckColBorderRang(t,f)){n=S,m+this.FRows[d][m].ColSpan!=S?s.TableSite=tr:S===this.FColWidths.count-1&&i===this.FRows.count-1&&s.TableSite===or?s.TableSite=sr:s.TableSite=nr,s.DestX=f;break}if(u<t&&f>t){n=S,s.TableSite==or&&d+this.FRows[d][m].RowSpan!=i&&(s.TableSite=tr);break}u=f}return n>=0&&(s.TableSite==$s&&(s.TableSite=tr),o&&null==this.FRows[i][n].CellData&&(i=(c=this.GetDestCell(i,n)).row,n=c.col)),{resizeInfo:s,row:i,col:n}}},{key:"GetDestCell",value:function(t,e){var i=t,n=e;return this.FRows[t][e].RowSpan<0&&(i+=this.FRows[t][e].RowSpan),this.FRows[t][e].ColSpan<0&&(n+=this.FRows[t][e].ColSpan),{row:i,col:n}}},{key:"GetSourceCell",value:function(t,e){if(null!=this.FRows[t][e].CellData)return{row:t+this.FRows[t][e].RowSpan,col:e+this.FRows[t][e].ColSpan};this.hcl.exception(Yl.HCS_EXCEPTION_VOIDSOURCECELL)}},{key:"SelectRange",value:function(t,e,n,o){0==t&&0==e&&n==this.RowCount-1&&o==this.FColWidths.count-1&&f()(F()(i.prototype),"SelectComplate",this).call(this),this.FSelectCellRang.SetStart(t,e),this.FSelectCellRang.SetEnd(n,o);for(var s=t;s<=n;s++)for(var r=e;r<=o;r++)null!=this.FRows[s][r].CellData&&this.FRows[s][r].CellData.SelectAll()}},{key:"SelectAll",value:function(){this.SelectComplate()}},{key:"IsSelectRange",value:function(){return this.FSelectCellRang.SelectExists()}},{key:"PaintRow",value:function(t,e,i,n,o,s){var r=Math.trunc(this.FBorderWidthPix/2),a=e+this.FBorderWidthPix,l=i+this.FBorderWidthPix+this.FCellVPaddingPix;this.DoPaintRowBefor(t,a,i+this.FBorderWidthPix,e+this.Width-this.FCellVPaddingPix-this.FCellVPaddingPix,i+this.FBorderWidthPix+this.FRows[t].Height,o,s);for(var h,c=-1,u=-1,f=-1,d=-1,m=-1,S=null,p=!1,y=0;y<this.FRows[t].ColCount;y++)this.FRows[t][y].ColSpan<0||this.FRows[t][y].RowSpan<0||(c=Math.min(n,l+Math.max(this.FRows[t].Height,this.FRows[t][y].Height)-this.FCellVPaddingPix),h=nt.Create(a,i+this.FBorderWidthPix,a+this.FRows[t][y].Width,c),S=this.FRows[t][y].CellData,!this.IsSelectComplate&&!S.CellSelectedAll||s.Print?(p=!0,null!=this.FOnCellPaintBK&&(p=this.FOnCellPaintBK(this,this.FRows[t][y],h,o,s,p)),p&&(this.FRows[t][y].BackgroundColor!=Yl.HCTransparentColor?o.brush.color=this.FRows[t][y].BackgroundColor:o.brush.style=Mt.Clear,o.fillRect(h))):(o.brush.color=this.OwnerData.Style.SelColor,o.fillRect(h)),c-l>this.FCellVPaddingPix&&this.FRows[t][y].PaintTo(a,l-this.FCellVPaddingPix,h.right,c,i,n,0,this.FCellHPaddingPix,this.FCellVPaddingPix,o,s),!this.FBorderVisible&&s.Print||(s.Print?o.pen.width=Math.max(1,En.ptToPixel(this.FBorderWidthPt,s.DPI)):o.pen.width=this.FBorderWidthPix,this.FBorderVisible?(o.pen.color="black",o.pen.style=_t.Solid):s.Print||(o.pen.color=Yl.clActiveBorder,o.pen.style=_t.Dot),f=(u=l-this.FCellVPaddingPix-this.FBorderWidthPix)+this.FBorderWidthPix+Math.max(this.FRows[t].Height,this.FRows[t][y].Height),d=a-this.FBorderWidthPix,m=a+this.FColWidths[y]+this.GetColSpanWidth(t,y),u>=0&&this.FRows[t][y].BorderSides.has(Zl.Top)&&(this.FBorderVisible&&(o.pen.style=this.FRows[t][y].TopBorderStyle),s.Print?s.drawNoScaleLine(o,[et.Create(d+r,u+r),et.Create(m+r,u+r)]):o.drawLineDriect(d+r,u+r,m+r,u+r)),this.FRows[t][y].BorderSides.has(Zl.Right)&&(this.FBorderVisible&&(o.pen.style=this.FRows[t][y].RightBorderStyle),s.Print?s.drawNoScaleLine(o,[et.Create(m+r,u+r),et.Create(m+r,f+r)]):o.drawLineDriect(m+r,u+r,m+r,f+r)),this.FRows[t][y].BorderSides.has(Zl.Bottom)&&(this.FBorderVisible&&(o.pen.style=this.FRows[t][y].BottomBorderStyle),s.Print?s.drawNoScaleLine(o,[et.Create(d+r,f+r),et.Create(m+r,f+r)]):o.drawLineDriect(d+r,f+r,m+r,f+r)),this.FRows[t][y].BorderSides.has(Zl.Left)&&(this.FBorderVisible&&(o.pen.style=this.FRows[t][y].LeftBorderStyle),s.Print?s.drawNoScaleLine(o,[et(d+r,u+r),et.Create(d+r,f+r)]):o.drawLineDriect(d+r,u+r,d+r,f+r)),this.FRows[t][y].BorderSides.has(Zl.LTRB)&&(this.FBorderVisible&&(o.pen.style=this.FRows[t][y].LTRBBorderStyle),s.Print?s.drawNoScaleLine(o,[et.Create(d+r,u+r),et(m+r,f+r)]):o.drawLineDriect(d+r,u+r,m+r,f+r)),this.FRows[t][y].BorderSides.has(Zl.RTLB)&&(this.FBorderVisible&&(o.pen.style=this.FRows[t][y].RTLBBorderStyle),s.Print?s.drawNoScaleLine(o,[et.Create(m+r,u+r),et.Create(d+r,f+r)]):o.drawLineDriect(m+r,u+r,d+r,f+r)))),a=a+this.FColWidths[y]+this.FBorderWidthPix}},{key:"PaintFixRows",value:function(t,e,i,n,o){var s=this.GetFixRowHeight();if(!(e+s<0)){var r=nt.CreateByBounds(t,e,this.Width,s);o.Print&&(n.brush.color=Ft.White,n.fillRect(r)),this.DoPaint(this.OwnerData.Style,r,e,e+s,e,e+s,n,o)}}},{key:"PaintFixCols",value:function(t,e,i,n,o,s){for(var r=Math.max(i,t)+this.FBorderWidthPix,a=0;a<this.FFixRow+this.FFixRowCount;a++)r=r+this.FRows[a].FmtOffset+this.FRows[a].Height+this.FBorderWidthPix;var l=nt.CreateByBounds(e,r,this.GetFixColWidth(),n-r);o.brush.color=Yl.clBtnFace,o.fillRect(l);var h=0,c=0,u=0,f=0,d=0,m=0,S=Math.trunc(this.FBorderWidthPix/2);r=t+this.FBorderWidthPix;for(var p=0;p<this.FRows.count;p++)if((h=(r+=this.FRows[p].FmtOffset)+this.FRows[p].Height)<i||p<this.FFixRow+this.FFixRowCount)r=h+this.FBorderWidthPix;else{c=e+this.FBorderWidthPix;for(var y=this.FFixCol;y<this.FFixCol+this.FFixColCount&&!((l=nt.Create(c,r,c+this.FColWidths[y],h)).top>n);y++)l.bottom>n&&(l.bottom=n),this.FRows[p][y].PaintTo(c,r,l.right,h,i,n,0,this.FCellHPaddingPix,this.FCellVPaddingPix,o,s),!this.FBorderVisible&&s.Print||(s.Print?o.pen.width=Math.max(1,En.ptToPixel(this.FBorderWidthPt,s.DPI)):o.pen.width=this.FBorderWidthPix,this.FBorderVisible?(o.pen.color="black",o.pen.style=_t.Solid):s.Print||(o.pen.color=Yl.clActiveBorder,o.pen.style=_t.Dot),f=(u=r-this.FBorderWidthPix)+this.FBorderWidthPix+Math.max(this.FRows[p].Height,this.FRows[p][y].Height),d=c-this.FBorderWidthPix,m=c+this.FColWidths[y]+this.GetColSpanWidth(p,y),u>=0&&this.FRows[p][y].BorderSides.has(Zl.Top)&&(this.FBorderVisible&&(o.pen.style=this.FRows[p][y].TopBorderStyle),s.Print?s.drawNoScaleLine(o,[et.Create(d+S,u+S),et.Create(m+S,u+S)]):o.drawLineDriect(d+S,u+S,m+S,u+S)),this.FRows[p][y].BorderSides.has(Zl.Right)&&(this.FBorderVisible&&(o.pen.style=this.FRows[p][y].RightBorderStyle),s.Print?s.drawNoScaleLine(o,[et.Create(m+S,u+S),et.Create(m+S,f+S)]):o.drawLineDriect(m+S,u+S,m+S,f+S)),f<=n&&this.FRows[p][y].BorderSides.has(Zl.Bottom)&&(this.FBorderVisible&&(o.pen.style=this.FRows[p][y].BottomBorderStyle),s.Print?s.drawNoScaleLine(o,[et.Create(d+S,f+S),et.Create(m+S,f+S)]):o.drawLineDriect(d+S,f+S,m+S,f+S)),this.FRows[p][y].BorderSides.has(Zl.Left)&&(this.FBorderVisible&&(o.pen.style=this.FRows[p][y].LeftBorderStyle),s.Print?s.drawNoScaleLine(o,[et.Create(d+S,u+S),et.Create(d+S,f+S)]):o.drawLineDriect(d+S,u+S,d+S,f+S)),this.FRows[p][y].BorderSides.has(Zl.LTRB)&&(this.FBorderVisible&&(o.pen.style=this.FRows[p][y].LTRBBorderStyle),s.Print?s.drawNoScaleLine(o,[et.Create(d+S,u+S),et.Create(m+S,f+S)]):o.drawLineDriect(d+S,u+S,m+S,f+S)),this.FRows[p][y].BorderSides.has(Zl.RTLB)&&(this.FBorderVisible&&(o.pen.style=this.FRows[p][y].RTLBBorderStyle),s.Print?s.drawNoScaleLine(o,[et.Create(m+S,u+S),et.Create(d+S,f+S)]):o.drawLineDriect(m+S,u+S,d+S,f+S))),c=c+this.FColWidths[y]+this.FBorderWidthPix;r=h+this.FBorderWidthPix}}},{key:"FormatRow",value:function(t){var e,i=this.FRows[t];i.FmtOffset=0,i.FormatInit();for(var n=0;n<i.ColCount;n++)null!=i[n].CellData&&(e=this.FColWidths[n]+this.GetColSpanWidth(t,n),i[n].Width=e,i[n].CellData.Width=e-this.FCellHPaddingPix-this.FCellHPaddingPix,i[n].CellData.ReFormat())}},{key:"GetColSpanWidth",value:function(t,e){for(var i=0,n=1;n<=this.FRows[t][e].ColSpan;n++)i=i+this.FBorderWidthPix+this.FColWidths[e+n];return i}},{key:"GetRowSpanHeight",value:function(t,e){for(var i=0,n=1;n<=this.FRows[t][e].RowSpan;n++)i+=this.FBorderWidthPix+this.FRows[n].Height;return i}},{key:"ResizeByInc",value:function(t,e){for(var i=L.Round(t/this.ColCount),n=0;n<this.ColCount;n++)this.FColWidths[n]+=i;i=L.Round(e/this.RowCount);for(var o=0;o<this.RowCount;o++)this.FRows[o].Height+=i,this.FRows[o].AutoHeight=!1}},{key:"CellsCanMerge",value:function(t,e,i,n){for(var o,s,r=t;r<=i;r++)for(var a=e;a<=n;a++)if(null==this.FRows[r][a].CellData&&(o=this.GetDestCell(r,a),s=this.GetSourceCell(o.row,o.col),o.row<t||s.row>i||o.col<e||s.col>n))return!1;return!0}},{key:"RowCanDelete",value:function(t){for(var e=!1,i=0;i<this.FColWidths.count;i++)if(this.FRows[t][i].RowSpan>0)return e;return e=!0}},{key:"CurRowCanDelete",value:function(){return this.FSelectCellRang.EndRow<0&&this.FSelectCellRang.StartRow>=0&&this.RowCanDelete(this.FSelectCellRang.StartRow)}},{key:"ColCanDelete",value:function(t){for(var e=!1,i=0;i<this.RowCount;i++)if(this.FRows[i][t].ColSpan>0)return e;return e=!0}},{key:"CurColCanDelete",value:function(){return this.FSelectCellRang.EndCol<0&&this.FSelectCellRang.StartCol>=0&&this.ColCanDelete(this.FSelectCellRang.StartCol)}},{key:"SetFixRowAndCount",value:function(t,e){if(t<0||0===e)this.FFixRow=-1,this.FFixRowCount=0;else{var i=t;t>this.FRows.count-1&&(i=this.FRows.count-1);var n=e;i+e>this.FRows.count&&(n=this.FRows.count-i),this.FFixRow===i&&this.FFixRowCount===n||(this.FFixRow=i,this.FFixRowCount=n,this.FormatDirty())}}},{key:"SetFixColAndCount",value:function(t,e){if(t<0||0==e)this.FFixCol=-1,this.FFixColCount=0;else{var i=t;t>this.FColWidths.count-1&&(i=this.FColWidths.count-1);var n=e;i+e>this.FColWidths.count&&(n=this.FColWidths.count-i),this.FFixCol===i&&this.FFixColCount===n||(this.FFixCol=i,this.FFixColCount=n,this.FormatDirty())}}},{key:"MergeSelectCells",value:function(){var t=!1;if(this.FSelectCellRang.StartRow>=0&&this.FSelectCellRang.EndRow>=0){if(this.Undo_Mirror(),t=this.MergeCells(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,this.FSelectCellRang.EndRow,this.FSelectCellRang.EndCol)){this.FormatDirty();var e=this.FSelectCellRang.StartRow,i=this.FSelectCellRang.StartCol;this.FSelectCellRang.InitializeEnd(),this.DisSelect(),this.FSelectCellRang.SetStart(e,i),this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].CellData.InitializeField()}}else t=!!this.FSelectCellRang.EditCell()&&this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol].CellData.MergeTableSelectCells();return t}},{key:"SelectedCellCanMerge",value:function(){return!!this.FSelectCellRang.SelectExists()&&this.CellsCanMerge(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,this.FSelectCellRang.EndRow,this.FSelectCellRang.EndCol)}},{key:"GetEditCell",value:function(){return this.FSelectCellRang.EditCell()?this.FRows[this.FSelectCellRang.StartRow][this.FSelectCellRang.StartCol]:null}},{key:"GetEditCellWith",value:function(){var t=-1,e=-1,i=!1;return this.FSelectCellRang.EditCell()&&(t=this.FSelectCellRang.StartRow,e=this.FSelectCellRang.StartCol,i=!0),{result:i,row:t,col:e}}},{key:"IsEditCell",value:function(t,e){return!!this.FSelectCellRang.EditCell()&&(this.FSelectCellRang.StartRow===t&&this.FSelectCellRang.StartCol===e)}},{key:"GetCellRect",value:function(t,e){var i=new nt;return i.leftTop=this.GetCellPostion(t,e),i.right=i.left+this.FColWidths[e]+this.GetColSpanWidth(t,e),i.bottom=i.top+this.FRows[t].Height+this.GetRowSpanHeight(t,e),i}},{key:"GetCellWidth",value:function(t,e){return this.FColWidths[e]+this.GetColSpanWidth(t,e)}},{key:"_CacheDynamicAppendRow",value:function(t){}},{key:"AppendRowDynamic",value:function(t){if(0!=t){this.InitializeMouseInfo();for(var e=null,i=0;i<t;i++)e=this.DoCreateRowDynamic(this.OwnerData.Style,this.ColCount),this.FRows.add(e),this.FormatRow(this.FRows.count-1),e.Height=e.CalcNorHeight();this.GetFormatHeight(),this._CacheDynamicAppendRow()}}},{key:"InsertRowAfter",value:function(t){var e=this.GetEditCell();return null!=e&&(e.CellData.InitializeField(),e.RowSpan>0?this.InsertRow(this.FSelectCellRang.StartRow+e.RowSpan+1,t):this.InsertRow(this.FSelectCellRang.StartRow+1,t))}},{key:"InsertRowBefor",value:function(t){var e=this.GetEditCell();return null!=e&&(e.CellData.InitializeField(),this.InsertRow(this.FSelectCellRang.StartRow,t))}},{key:"InsertColAfter",value:function(t){var e=this.GetEditCell();return null!=e&&(e.CellData.InitializeField(),e.ColSpan>0?this.InsertCol(this.FSelectCellRang.StartCol+e.ColSpan+1,t):this.InsertCol(this.FSelectCellRang.StartCol+1,t))}},{key:"InsertColBefor",value:function(t){var e=this.GetEditCell();return null!=e&&(e.CellData.InitializeField(),this.InsertCol(this.FSelectCellRang.StartCol,t))}},{key:"DeleteCurCol",value:function(){var t=this.GetEditCell();return null!=t&&(t.CellData.InitializeField(),this.FColWidths.count>1&&this.DeleteCol(this.FSelectCellRang.StartCol))}},{key:"DeleteCurRow",value:function(){var t=this.GetEditCell();return null!=t&&(t.CellData.InitializeField(),this.DeleteRow(this.FSelectCellRang.StartRow))}},{key:"SplitCurRow",value:function(){var t=this.GetEditCell();if(null==t)return!1;t.CellData.InitializeField();var e=this.FSelectCellRang.StartRow,i=this.FSelectCellRang.StartCol,n=-1,o=-1,s=-1,r=-1;if(this.Undo_Mirror(),this.FRows[e][i].RowSpan>0){var a=this.GetSourceCell(e,i);n=a.row,o=a.col,this.FRows[e][i].RowSpan=0;for(var l=e+1;l<=n;l++)for(var h=i;h<=o;h++)this.FRows[l][h].RowSpan=this.FRows[l][h].RowSpan+1;this.FRows[e+1][i].CellData=new Yl.TableCellData(this.hcl,this.OwnerData.Style),this.InitializeCellData(this.FRows[e+1][i].CellData),this.FRows[e+1][i].RowSpan=n-(e+1),this.FRows[e+1][i].ColSpan=o-i}else if(this.InsertRow(e+1,1))for(var c=0;c<this.ColCount;)if(t=this.FRows[e][c],c==i)if(t.ColSpan>0)for(o=i+t.ColSpan;c<=o;)this.FRows[e+1][c].ColSpan=this.FRows[e][c].ColSpan,this.FRows[e+1][c].ColSpan<0&&(this.FRows[e+1][c].CellData.dispose(),this.FRows[e+1][c].CellData=null),c++;else c++;else if(0==t.ColSpan)0==t.RowSpan?(this.FRows[e+1][c].CellData.dispose(),this.FRows[e+1][c].CellData=null,this.FRows[e+1][c].RowSpan=-1,t.RowSpan=1,c++):t.RowSpan<0?(e==(n=(s=e+t.RowSpan)+this.FRows[s][c].RowSpan)&&(this.FRows[e+1][c].CellData.dispose(),this.FRows[e+1][c].CellData=null,this.FRows[e+1][c].RowSpan=t.RowSpan-1,this.FRows[s][c].RowSpan=this.FRows[s][c].RowSpan+1),c++):c++;else if(t.ColSpan>0)if(0==t.RowSpan)for(t.RowSpan=1,r=c,o=c+t.ColSpan;c<=o;)this.FRows[e+1][c].CellData.dispose(),this.FRows[e+1][c].CellData=null,this.FRows[e+1][c].ColSpan=r-c,this.FRows[e+1][c].RowSpan=-1,c++;else c++;else c++;return this.FormatDirty(),!0}},{key:"SplitCurCol",value:function(){var t=this.GetEditCell();if(null==t)return!1;t.CellData.InitializeField();var e=this.FSelectCellRang.StartRow,i=this.FSelectCellRang.StartCol,n=-1,o=-1,s=-1,r=-1;if(this.Undo_Mirror(),this.FRows[e][i].ColSpan>0){var a=this.GetSourceCell(e,i);n=a.row,o=a.col,this.FRows[e][i].ColSpan=0;for(var l=i+1;l<=o;l++)for(var h=e;h<=n;h++)this.FRows[h][l].ColSpan=this.FRows[h][l].ColSpan+1;this.FRows[e][i+1].CellData=new Yl.TableCellData(this.hcl,this.OwnerData.Style),this.InitializeCellData(this.FRows[e][i+1].CellData),this.FRows[e][i+1].RowSpan=n-e,this.FRows[e][i+1].ColSpan=o-(i+1)}else if(this.InsertCol(i+1,1))for(var c=0;c<this.RowCount;)if(t=this.FRows[c][i],c==e)if(t.RowSpan>0)for(n=e+t.RowSpan;c<=n;)this.FRows[c][i+1].RowSpan=this.FRows[c][i].RowSpan,this.FRows[c][i+1].RowSpan<0&&(this.FRows[c][i+1].CellData.dispose(),this.FRows[c][i+1].CellData=null),c++;else c++;else if(0==t.RowSpan)0==t.ColSpan?(this.FRows[c][i+1].CellData.dispose(),this.FRows[c][i+1].CellData=null,this.FRows[c][i+1].ColSpan=-1,t.ColSpan=1,c++):t.ColSpan<0?(i==(o=(r=i+t.ColSpan)+this.FRows[c][r].ColSpan)&&(this.FRows[c][i+1].CellData.dispose(),this.FRows[c][i+1].CellData=null,this.FRows[c][i+1].ColSpan=t.ColSpan-1,this.FRows[c][r].ColSpan=this.FRows[c][r].ColSpan+1),c++):c++;else if(t.RowSpan>0)if(0==t.ColSpan)for(t.ColSpan=1,s=c,n=c+t.RowSpan;c<=n;)this.FRows[c][i+1].CellData.dispose(),this.FRows[c][i+1].CellData=null,this.FRows[c][i+1].RowSpan=s-c,this.FRows[c][i+1].ColSpan=-1,c++;else c++;else c++;return this.FormatDirty(),!0}},{key:"IsBreakRow",value:function(t){for(var e=!1,i=0;i<this.FPageBreaks.count;i++)if(t==this.FPageBreaks[i].Row){e=!0;break}return e}},{key:"IsFixRow",value:function(t){return this.FFixRow>=0&&(t>=this.FFixRow&&t<this.FFixRow+this.FFixRowCount)}},{key:"IsFixCol",value:function(t){return this.FFixCol>=0&&(t>=this.FFixCol&&t<this.FFixCol+this.FFixColCount)}},{key:"IsEmptyRow",value:function(t){for(var e=0;e<this.FRows[t].ColCount;e++)if(null!==this.FRows[t][e].CellData&&!this.FRows[t][e].CellData.IsEmptyData())return!1;return!0}},{key:"GetFixRowLast",value:function(){return this.FFixRow<0?-1:this.FFixRow+this.FFixRowCount-1}},{key:"GetFixRowHeight",value:function(){if(this.FFixRow<0)return 0;for(var t=this.FBorderWidthPix,e=this.FFixRow;e<this.FFixRow+this.FFixRowCount;e++)t=t+this.FRows[e].Height+this.FBorderWidthPix;return t}},{key:"GetFixColLast",value:function(){return this.FFixCol<0?-1:this.FFixCol+this.FFixColCount-1}},{key:"GetFixColWidth",value:function(){if(this.FFixCol<0)return 0;for(var t=this.FBorderWidthPix,e=this.FFixCol;e<this.FFixCol+this.FFixColCount;e++)t=t+this.FColWidths[e]+this.FBorderWidthPix;return t}},{key:"GetFixColLeft",value:function(){if(this.FFixCol<0)return 0;for(var t=this.FBorderWidthPix,e=0;e<this.FFixCol;e++)t=t+this.FColWidths[e]+this.FBorderWidthPix;return t}},{key:"ColWidth",value:function(t){return this.GetColWidth(t)}},{key:"SetColWidth",value:function(t,e){this.FColWidths[t]=e;for(var i=0;i<this.RowCount;i++)this.FRows[i][t].Width=e,null!=this.FRows[i][t].CellData&&(this.FRows[i][t].CellData.Width=e-this.FCellHPaddingPix-this.FCellHPaddingPix)}},{key:"Rows",get:function(){return this.FRows}},{key:"RowCount",get:function(){return this.GetRowCount()}},{key:"ColCount",get:function(){return this.GetColCount()}},{key:"SelectCellRang",get:function(){return this.FSelectCellRang}},{key:"BorderVisible",get:function(){return this.FBorderVisible},set:function(t){this.FBorderVisible=t}},{key:"BorderWidthPix",get:function(){return this.FBorderWidthPix}},{key:"BorderWidthPt",get:function(){return this.FBorderWidthPt},set:function(t){this.SetBorderWidthPt(t)}},{key:"CellHPaddingPix",get:function(){return this.FCellHPaddingPix}},{key:"CellVPaddingPix",get:function(){return this.FCellVPaddingPix}},{key:"CellVPaddingMM",get:function(){return this.FCellVPaddingMM},set:function(t){this.SetCellVPaddingMM(t)}},{key:"CellHPaddingMM",get:function(){return this.FCellHPaddingMM},set:function(t){this.SetCellHPaddingMM(t)}},{key:"FixCol",get:function(){return this.FFixCol}},{key:"FixColCount",get:function(){return this.FFixColCount}},{key:"FixRow",get:function(){return this.FFixRow}},{key:"FixRowCount",get:function(){return this.FFixRowCount}},{key:"ResizeKeepWidth",get:function(){return this.FResizeKeepWidth},set:function(t){this.FResizeKeepWidth=t}},{key:"DefaultRowHeight",get:function(){return this.FDefaultRowHeight}},{key:"PageBreaks",get:function(){return this.FPageBreaks}},{key:"OnCellPaintBK",get:function(){return this.FOnCellPaintBK},set:function(t){this.OnCellPaintBK=t}},{key:"OnCellPaintData",get:function(){return this.OnCellPaintData},set:function(t){this.OnCellPaintData=t}}]),i}(Cs);function gr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}function Cr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var wr=function(t){m()(i,t);var e=Cr(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FFormatFirstItemNo,o.FFormatFirstDrawItemNo,o.FFormatLastItemNo,o.FUndoGroupCount=0,o.FItemAddCount=0,o.FForceClearExtra,o}return l()(i,[{key:"UndoRedoDeleteBackText",value:function(t,e,i,n){var o=t;i=o.ItemNo;var s=o.Text.length,r=this.Items[o.ItemNo].Text;return e?(r=L.stringInsert(r,o.Offset-1,o.Text),n=o.Offset-1):(r=L.stringDelete(r,o.Offset-1,s),n=o.Offset-1),this.Items[o.ItemNo].Text=r,this.DoItemChange(o.ItemNo,n,rh.ContentChange),{itemNo:i,offset:n}}},{key:"UndoRedoDeleteText",value:function(t,e,i,n){var o=t;i=o.ItemNo;var s=o.Text.length,r=this.Items[o.ItemNo].Text;return r=e?L.stringInsert(r,o.Offset-1,o.Text):L.stringDelete(r,o.Offset-1,s),n=o.Offset-1,this.Items[o.ItemNo].Text=r,this.DoItemChange(o.ItemNo,n,rh.ContentChange),{itemNo:i,offset:n}}},{key:"UndoRedoInsertText",value:function(t,e,i,n){var o=t;i=o.ItemNo;var s=this.Items[o.ItemNo].Text,r=o.Text.length;return e?(s=L.stringDelete(s,o.Offset-1,r),n=o.Offset-1):(s=L.stringInsert(s,o.Offset-1,o.Text),n=o.Offset+r-1),this.Items[o.ItemNo].Text=s,this.DoItemChange(o.ItemNo,n,rh.ContentChange),{itemNo:i,offset:n}}},{key:"UndoRedoSetItemText",value:function(t,e,i,n){var o=t;return i=o.ItemNo,e?(this.Items[o.ItemNo].Text=o.Text,n=o.Offset):(this.Items[o.ItemNo].Text=o.NewText,n=o.NewText.length),this.DoItemChange(o.ItemNo,n,rh.ContentChange),{itemNo:i,offset:n}}},{key:"UndoRedoDeleteItem",value:function(t,e,i,n){var o=this,s=t;if(i=s.ItemNo,e){var r={item:null};this.LoadItemFromStreamAlone(s.ItemStream,r),this.Items.insert(s.ItemNo,r.item),this.FItemAddCount++,n=s.Offset,this.DoItemChange(s.ItemNo,n,rh.ContentChange)}else this.DoDataDeleteItemAction(s.ItemNo,(function(){o.Items.delete(s.ItemNo)})),this.FItemAddCount--,i>0?(i--,n=this.Items[i].StyleNo>oo.Null?this.Items[i].Length:Yl.OffsetAfter):n=0;return{itemNo:i,offset:n}}},{key:"UndoRedoInsertItem",value:function(t,e,i,n,o,s){var r=this,a=e;if(n=a.ItemNo,i)n<this.Items.count-1?this.Items[n].ParaFirst?(o=0,s=this.Items[n+1].FirstDItemNo):(n--,o=this.Items[n].StyleNo>oo.Null?this.Items[n].Length:Yl.OffsetAfter,s=t.CaretDrawItemNo):n>0?(n--,o=this.Items[n].StyleNo>oo.Null?this.Items[n].Length:Yl.OffsetAfter,s=t.CaretDrawItemNo-1):o=0,this.DoDataDeleteItemAction(a.ItemNo,(function(){r.Items.delete(a.ItemNo)})),this.FItemAddCount--;else{var l={item:null};this.LoadItemFromStreamAlone(a.ItemStream,l),this.Items.insert(a.ItemNo,l.item),this.FItemAddCount++,n=a.ItemNo,o=this.Items[n].StyleNo>oo.Null?this.Items[n].Length:Yl.OffsetAfter,this.DoItemChange(a.ItemNo,o,rh.ContentChange),s=t.CaretDrawItemNo+1}return{itemNo:n,offset:o,drawItemNo:s}}},{key:"UndoRedoItemProperty",value:function(t,e,i,n){var o=t;i=o.ItemNo,n=o.Offset;var s=this.Items[o.ItemNo];switch(o.ItemProperty){case _o:s.StyleNo=e?o.OldStyleNo:o.NewStyleNo;break;case Eo:var r=this.GetParaLastItemNo(o.ItemNo);if(e)for(var a=o.ItemNo;a<=r;a++)this.Items[a].ParaNo=o.OldParaNo;else for(var l=o.ItemNo;l<=r;l++)this.Items[l].ParaNo=o.NewParaNo;break;case Mo:s.ParaFirst=e?o.OldParaFirst:o.NewParaFirst;break;case Lo:this.FForceClearExtra=!0,s.PageBreak=e?o.OldPageBreak:o.NewPageBreak}return{itemNo:i,offset:n}}},{key:"UndoRedoItemSelf",value:function(t,e,i,n){var o=t;return i=o.ItemNo,n=o.Offset,e?this.Items[i].Undo(o):this.Items[i].Redo(o),{itemNo:i,offset:n}}},{key:"UndoRedoItemMirror",value:function(t,e,i,n){var o=t;i=o.ItemNo,n=o.Offset;var s={item:this.Items[i]};return this.LoadItemFromStreamAlone(o.ItemStream,s),this.Items[i].StyleNo<oo.Null&&this.Items[i].Undo(t),{itemNo:i,offset:n}}},{key:"DoUndoRedoAction",value:function(t,e,i,n,o,s){var r;switch(e.Tag){case rh.BackDeleteText:n=(r=this.UndoRedoDeleteBackText(e,i,n,o)).itemNo,o=r.offset;break;case rh.DeleteText:n=(r=this.UndoRedoDeleteText(e,i,n,o)).itemNo,o=r.offset;break;case rh.InsertText:n=(r=this.UndoRedoInsertText(e,i,n,o)).itemNo,o=r.offset;break;case rh.SetItemText:n=(r=this.UndoRedoSetItemText(e,i,n,o)).itemNo,o=r.offset;break;case rh.DeleteItem:n=(r=this.UndoRedoDeleteItem(e,i,n,o)).itemNo,o=r.offset;break;case rh.InsertItem:n=(r=this.UndoRedoInsertItem(t,e,i,n,o,s)).itemNo,o=r.offset,s=r.drawItemNo;break;case rh.ItemProperty:n=(r=this.UndoRedoItemProperty(e,i,n,o)).itemNo,o=r.offset;break;case rh.ItemSelf:n=(r=this.UndoRedoItemSelf(e,i,n,o)).itemNo,o=r.offset;break;case rh.ItemMirror:n=(r=this.UndoRedoItemMirror(e,i,n,o)).itemNo,o=r.offset}return{itemNo:n,offset:o,drawItemNo:s}}},{key:"GetActionAffectFirst",value:function(t,e){var i=t.ItemNo;switch(t.Tag){case rh.DeleteItem:i>0&&i--;break;case rh.InsertItem:e?i>0&&i--:i>this.Items.count-1&&i--;break;case rh.ItemProperty:var n=t;n.ItemProperty!==Mo&&n.ItemProperty!==Lo&&n.ItemProperty!==_o||i>0&&i--}return i>this.Items.count-1&&(i=this.Items.count-1),i}},{key:"GetActionAffectLast",value:function(t,e){var i=t.ItemNo;switch(t.Tag){case rh.DeleteItem:e?i>0&&i--:i<this.Items.count-1&&i++;break;case rh.InsertItem:e?i<this.Items.count-1&&t.ParaFirst&&i++:i>this.Items.count-1&&i--;break;case rh.ItemProperty:var n=t;n.ItemProperty!==Mo&&n.ItemProperty!==Lo&&n.ItemProperty!==_o||i<this.Items.count-1&&i++}return i>this.Items.count-1&&(i=this.Items.count-1),i}},{key:"CalcAffectRange",value:function(t){this.FFormatFirstItemNo=this.GetActionAffectFirst(t.Actions.first,t.IsUndo),this.FFormatLastItemNo=this.GetActionAffectLast(t.Actions.first,t.IsUndo);var e=-1,i=-1,n=0;t.Actions.first.Tag===rh.InsertItem&&n++;for(var o=1;o<t.Actions.count;o++)e=this.GetActionAffectFirst(t.Actions[o],t.IsUndo),i=this.GetActionAffectLast(t.Actions[o],t.IsUndo),t.Actions[o].Tag==rh.InsertItem&&n++,this.FFormatFirstItemNo>e&&(this.FFormatFirstItemNo=e),this.FFormatLastItemNo<i&&(this.FFormatLastItemNo=i);this.FFormatFirstItemNo<0&&(this.FFormatFirstItemNo=0),t.IsUndo&&(this.FFormatLastItemNo+=n),this.FFormatLastItemNo>this.Items.count-1&&(this.FFormatLastItemNo=this.Items.count-1)}},{key:"DoUndoRedo",value:function(t){if(this.FForceClearExtra=!1,t instanceof ts)if(t.IsUndo){if(0===this.FUndoGroupCount){var e=this.GetUndoList();if(this.FFormatFirstItemNo=e[e.CurGroupBeginIndex].ItemNo,this.FFormatLastItemNo=e[e.CurGroupEndIndex].ItemNo,this.FFormatFirstItemNo>0&&this.FFormatFirstItemNo--,this.FFormatLastItemNo<this.Items.count-1&&this.FFormatLastItemNo++,this.FFormatFirstItemNo!==this.FFormatLastItemNo)this.FFormatFirstItemNo=this.GetParaFirstItemNo(this.FFormatFirstItemNo),this.FFormatFirstDrawItemNo=this.Items[this.FFormatFirstItemNo].FirstDItemNo,this.FFormatLastItemNo=this.GetParaLastItemNo(this.FFormatLastItemNo);else{var i=this.GetFormatRangeByOffset(this.FFormatFirstItemNo,1,this.FFormatFirstDrawItemNo,this.FFormatLastItemNo);this.FFormatFirstDrawItemNo=i.firstDrawItemNo,this.FFormatLastItemNo=i.lastItemNo}this.FormatPrepare(this.FFormatFirstDrawItemNo,this.FFormatLastItemNo),this.SelectInfo.Initialize(),this.InitializeField(),this.FItemAddCount=0}this.FUndoGroupCount++}else this.FUndoGroupCount--,0===this.FUndoGroupCount&&(this.ReFormatData(this.FFormatFirstDrawItemNo,this.FFormatLastItemNo+this.FItemAddCount,this.FItemAddCount,this.FForceClearExtra),this.SelectInfo.StartItemNo=t.ItemNo,this.SelectInfo.StartItemOffset=t.Offset,this.CaretDrawItemNo=t.CaretDrawItemNo,this.Style.UpdateInfoReCaret(),this.Style.UpdateInfoRePaint());else if(t instanceof Zo)if(t.IsUndo)this.FUndoGroupCount--,0===this.FUndoGroupCount&&(this.ReFormatData(this.FFormatFirstDrawItemNo,this.FFormatLastItemNo+this.FItemAddCount,this.FItemAddCount,this.FForceClearExtra),this.SelectInfo.StartItemNo=t.ItemNo,this.SelectInfo.StartItemOffset=t.Offset,this.CaretDrawItemNo=t.CaretDrawItemNo,this.Style.UpdateInfoReCaret(),this.Style.UpdateInfoRePaint());else{if(0===this.FUndoGroupCount){var n=this.GetUndoList();this.FFormatFirstItemNo=-1,this.FFormatLastItemNo=-1;for(var o=-1,s=n.CurGroupBeginIndex;s<=n.CurGroupEndIndex;s++)n[s]instanceof Zo?this.FFormatFirstItemNo>n[s].ItemNo&&(this.FFormatFirstItemNo=n[s].ItemNo):n[s]instanceof ts?this.FFormatLastItemNo<n[s].ItemNo&&(this.FFormatLastItemNo=n[s].ItemNo):(o=this.GetParaFirstItemNo(this.GetActionAffectFirst(n[s].Actions.first,n[s].IsUndo)),this.FFormatFirstItemNo>o&&(this.FFormatFirstItemNo=o),o=this.GetParaLastItemNo(this.GetActionAffectLast(n[s].Actions.last,n[s].IsUndo)),this.FFormatLastItemNo<o&&(this.FFormatLastItemNo=o));this.FFormatFirstItemNo<0&&(this.FFormatFirstItemNo=0),this.FFormatLastItemNo>this.Items.count-1&&(this.FFormatLastItemNo=this.Items.count-1),this.FFormatFirstDrawItemNo=this.GetFormatFirstDrawItem(this.Items[this.FFormatFirstItemNo].FirstDItemNo),this.FormatPrepare(this.FFormatFirstDrawItemNo,this.FFormatLastItemNo),this.SelectInfo.Initialize(),this.InitializeField(),this.FItemAddCount=0}this.FUndoGroupCount++}else if(0!=t.Actions.count){var r,a=-1,l=-1,h=-1,c=!1;if(0===this.FUndoGroupCount&&(this.SelectInfo.Initialize(),this.InitializeField(),this.FItemAddCount=0,a=t.CaretDrawItemNo,this.CalcAffectRange(t),this.FFormatLastItemNo=this.GetParaLastItemNo(this.FFormatLastItemNo),this.FFormatFirstDrawItemNo=this.GetFormatFirstDrawItem(this.FFormatFirstItemNo),this.FormatPrepare(this.FFormatFirstDrawItemNo,this.FFormatLastItemNo)),t.IsUndo)for(var u=t.Actions.count-1;u>=0;u--)l=(r=this.DoUndoRedoAction(t,t.Actions[u],!0,l,h,a)).itemNo,h=r.offset,a=r.drawItemNo,c=t.Actions[u].active;else for(var f=0;f<t.Actions.count;f++)l=(r=this.DoUndoRedoAction(t,t.Actions[f],!1,l,h,a)).itemNo,h=r.offset,a=r.drawItemNo,c=t.Actions[f].active;if(0===this.FUndoGroupCount){this.ReFormatData(this.FFormatFirstDrawItemNo,this.FFormatLastItemNo+this.FItemAddCount,this.FItemAddCount,this.FForceClearExtra);var d=this.GetDrawItemNoByOffset(l,h);a<0||a>this.DrawItems.count-1?a=d:d!==a&&(this.DrawItems[a].ItemNo==l&&this.DrawItems[a].CharOffs==h||(a=d)),this.CaretDrawItemNo=a,this.Items[l].Active=c,this.Style.UpdateInfoReCaret(),this.Style.UpdateInfoRePaint()}this.SelectInfo.StartItemNo=l,this.SelectInfo.StartItemOffset=h}}},{key:"GetUndoList",value:function(){return this.Loading?null:f()(F()(i.prototype),"GetUndoList",this).call(this)}},{key:"Undo_New",value:function(){var t=this.GetUndoList();if(null!==t&&t.Enable){var e=t.UndoNew();e instanceof Yo&&(e.CaretDrawItemNo=this.CaretDrawItemNo)}}},{key:"Undo_GroupBegin",value:function(t,e){var i=this.GetUndoList();null!==i&&i.Enable&&i.UndoGroupBegin(t,e)}},{key:"Undo_GroupEnd",value:function(t,e){var i=this.GetUndoList();null!==i&&i.Enable&&i.UndoGroupEnd(t,e)}},{key:"UndoAction_DeleteBackText",value:function(t,e,i){var n=this.GetUndoList();if(null!==n&&n.Enable){var o=n.last;if(null!==o)o.ActionAppend(rh.BackDeleteText,t,e,this.Items[t].ParaFirst,this.Items[t].Active).Text=i}}},{key:"UndoAction_DeleteText",value:function(t,e,i){var n=this.GetUndoList();if(null!==n&&n.Enable){var o=n.last;if(null!==o)o.ActionAppend(rh.DeleteText,t,e,this.Items[t].ParaFirst,this.Items[t].Active).Text=i}}},{key:"UndoAction_InsertText",value:function(t,e,i){var n=this.GetUndoList();if(null!==n&&n.Enable){var o=n.last;if(null!==o)o.ActionAppend(rh.InsertText,t,e,this.Items[t].ParaFirst,this.Items[t].Active).Text=i}}},{key:"UndoAction_SetItemText",value:function(t,e,i){var n=this.GetUndoList();if(null!==n&&n.Enable){var o=n.last;if(null!==o){var s=o.ActionAppend(rh.SetItemText,t,e,this.Items[t].ParaFirst,this.Items[t].Active);s.Text=this.Items[t].Text,s.NewText=i}}}},{key:"UndoAction_DeleteItem",value:function(t,e){var i=this.GetUndoList();if(null!==i&&i.Enable){var n=i.last;if(null!==n){var o=n.ActionAppend(rh.DeleteItem,t,e,this.Items[t].ParaFirst,this.Items[t].Active);this.SaveItemToStreamAlone(o.ItemStream,this.Items[t])}}}},{key:"UndoAction_InsertItem",value:function(t,e){var i=this.GetUndoList();if(null!==i&&i.Enable&&i.count>0){var n=i.last;if(null!==n){var o=n.ActionAppend(rh.InsertItem,t,e,this.Items[t].ParaFirst,this.Items[t].Active);this.SaveItemToStreamAlone(o.ItemStream,this.Items[t])}}}},{key:"UndoAction_ItemStyle",value:function(t,e,i){var n=this.GetUndoList();if(null!==n&&n.Enable){var o=n.last;if(null!==o){var s=new Ho;s.ItemNo=t,s.Offset=e,s.OldStyleNo=this.Items[t].StyleNo,s.NewStyleNo=i,o.Actions.add(s)}}}},{key:"UndoAction_ItemParaNo",value:function(t,e,i){var n=this.GetUndoList();if(null!==n&&n.Enable){var o=n.last;if(null!==o){var s=new Vo;s.ItemNo=t,s.Offset=e,s.OldParaNo=this.Items[t].ParaNo,s.NewParaNo=i,o.Actions.add(s)}}}},{key:"UndoAction_ItemParaFirst",value:function(t,e,i){var n=this.GetUndoList();if(null!==n&&n.Enable){var o=n.last;if(null!==o){var s=new Uo;s.ItemNo=t,s.Offset=e,s.OldParaFirst=this.Items[t].ParaFirst,s.NewParaFirst=i,o.Actions.add(s)}}}},{key:"UndoAction_ItemPageBreak",value:function(t,e,i){var n=this.GetUndoList();if(null!==n&&n.Enable){var o=n.last;if(null!==o){var s=new Wo;s.ItemNo=t,s.Offset=e,s.OldPageBreak=this.Items[t].PageBreak,s.NewPageBreak=i,o.Actions.add(s)}}}},{key:"UndoAction_ItemSelf",value:function(t,e){var i=this.GetUndoList();if(null!==i&&i.Enable){var n=i.last;null!==n&&n.ActionAppend(rh.ItemSelf,t,e,this.Items[t].ParaFirst,this.Items[t].Active)}}},{key:"UndoAction_ItemMirror",value:function(t,e){var i=this.GetUndoList();if(null!==i&&i.Enable){var n=i.last;if(null!==n){var o=n.ActionAppend(rh.ItemMirror,t,e,this.Items[t].ParaFirst,this.Items[t].Active);this.SaveItemToStreamAlone(o.ItemStream,this.Items[t])}}}},{key:"Clear",value:function(){if(this.Items.count>0){var t=this.GetUndoList();if(null!==t&&t.Enable){this.Undo_New();for(var e=this.Items.count-1;e>=0;e--)this.UndoAction_DeleteItem(e,0)}}f()(F()(i.prototype),"Clear",this).call(this)}},{key:"Undo",value:function(t){this.DoUndoRedo(t)}},{key:"Redo",value:function(t){this.DoUndoRedo(t)}},{key:"UndoItemMirror",value:function(t,e){this.UndoAction_ItemMirror(t,e)}},{key:"SaveItemToStreamAlone",value:function(t,e){Yl._SaveFileFormatAndVersion(t),t.writeByte(Yl.HC_STREAM_ITEM),this.Style.SaveToStream(t),e.SaveToStream(t)}},{key:"LoadItemFromStreamAlone",value:function(t,e){t.position=0;var i=Yl._LoadFileFormatAndVersion(t),n=i.fileExt,o=i.fileVersion;if(n!==Yl.HC_EXT&&"cff."!==n&&this.hcl.exception("加载失败，仅支持"+Yl.HC_EXT+"文件！实际为"+n+"文件"),i.fileVersion>59&&t.readByte()!=Yl.HC_STREAM_ITEM)console.error("调用LoadItemFromStreamAlone时传递的数据不是ITEM类型！");else{var s=new oo(this.hcl);s.LoadFromStream(t,o);var r=t.readInt32();if(r>oo.Null){var a=s.TextStyles[r];r=this.Style.GetStyleNo(a,!0)}null===e.item&&(e.item=this.CreateItemByStyle(r)),e.item.LoadFromStream(t,s,o),e.item.StyleNo=r;var l=e.item.ParaNo,h=s.ParaStyles[l];l=this.Style.GetParaNo(h,!0),e.item.ParaNo=l}}}]),i}(function(t){m()(i,t);var e=gr(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FormatTextCut=8192,o.FWidth=0,o.FFormatCount=0,o.FItemFormatHeight=0,o.FFormatChange=!1,o.FormatDirection=$l.Horizontal,o.OnFormatDirty=null,o.OnItemReFormatRequest=null,o.OnItemSetCaretRequest=null,o.FormatInit(),o}return l()(i,[{key:"DoLoadFromStream",value:function(t,e,n){this.FormatDirection=n>63?t.readByte():$l.Horizontal,f()(F()(i.prototype),"DoLoadFromStream",this).call(this,t,e,n)}},{key:"SaveToStream",value:function(t){t.writeByte(this.FormatDirection),f()(F()(i.prototype),"SaveToStream",this).call(this,t)}},{key:"FormatRange",value:function(t,e){var i=-1,n=-1,o=-1,s=null,r=new et;this.FFormatChange?this.FFormatStartDrawItemNo<t&&(this.FFormatStartDrawItemNo=t):this.FFormatStartDrawItemNo=t,t>0?(i=t-1,n=this.DrawItems[t].ItemNo,o=this.DrawItems[t].CharOffs,s=this.Style.ParaStyles[this.Items[n].ParaNo],this.DrawItems[t].LineFirst?(r.x=s.LeftIndentPix,r.y=this.DrawItems[i].rect.bottom):(r.x=this.DrawItems[i].rect.right,r.y=this.DrawItems[i].rect.top)):(i=-1,n=0,o=1,s=this.Style.ParaStyles[this.Items[n].ParaNo],r.x=s.LeftIndentPix,r.y=0),this.Style.ApplyTempStyle(oo.Null);var a=this.FormatItemToDrawItems(n,o,s.LeftIndentPix,this.FWidth-s.RightIndentPix,this.FWidth,r,i);r=a.pos,i=a.drawItemNo;for(var l=n+1;l<=e;l++)this.Items[l].ParaFirst&&(s=this.Style.ParaStyles[this.Items[l].ParaNo],r.x=s.LeftIndentPix),r=(a=this.FormatItemToDrawItems(l,1,s.LeftIndentPix,this.FWidth-s.RightIndentPix,this.FWidth,r,i)).pos,i=a.drawItemNo;this.DrawItems.DeleteFormatMark()}},{key:"FormatItem",value:function(t){var e=this.FItems.indexOf(t);e>=0&&this.FormatItemNo(e)}},{key:"FormatItemNo",value:function(t){if(t>=0){var e=this.Items.count-1,i=this.GetFormatRangeByOffset(t,0,0,e);this.FormatPrepare(i.firstDrawItemNo,i.lastItemNo),this.ReFormatData(i.firstDrawItemNo,i.lastItemNo),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),this.SelectInfo.StartItemNo===t&&this.SelectInfo.StartItemOffset>this.Items[t].Length&&this.ReSetSelectAndCaret(t)}}},{key:"CalcItemFormatHeigh",value:function(t){this.Style.TempStyleNo!==t.StyleNo?(this.Style.ApplyTempStyle(t.StyleNo),this.FLastFormatParaNo=t.ParaNo,this.FItemFormatHeight=this.CalculateLineHeight(this.Style.TextStyles[t.StyleNo],this.Style.ParaStyles[t.ParaNo])):this.FLastFormatParaNo!==t.ParaNo&&(this.FLastFormatParaNo=t.ParaNo,this.FItemFormatHeight=this.CalculateLineHeight(this.Style.TextStyles[t.StyleNo],this.Style.ParaStyles[t.ParaNo]))}},{key:"FinishLine",value:function(t,e,i){for(var n=e,o=e;o>=0;o--)if(this.DrawItems[o].LineFirst){n=o;break}for(var s=-1,r=0,a=n;a<=e;a++)if(this.Items[this.DrawItems[a].ItemNo].Visible){s=a;break}var l=s>=0;if(l){r=this.DrawItems[e].rect.bottom;for(var h=e-1;h>=n;h--)this.DrawItems[h].rect.bottom>r&&(r=this.DrawItems[h].rect.bottom)}else{var c=this.GetParaItemRang(t,-1,-1);if(this.InvisibleRange(c.a,c.b)&&c.a>0)r=this.FDrawItems[n].rect.top;else{var u=this.FItems[this.FDrawItems[n].ItemNo];r=u.StyleNo>oo.Null?this.CalculateLineHeight(this.FStyle.TextStyles[u.StyleNo],this.FStyle.ParaStyles[u.ParaNo]):this.CalculateLineHeight(this.FStyle.DefaultTextStyle,this.FStyle.ParaStyles[u.ParaNo]),r+=this.FDrawItems[n].rect.top}}for(var f=e;f>=n;f--)this.DrawItems[f].rect.bottom=r;var d=0,m=this.Style.ParaStyles[this.Items[t].ParaNo];switch(m.AlignHorz){case Ln.Left:break;case Ln.Right:for(var S=e;S>=n;S--)this.DrawItems[S].rect.offset(i,0);break;case Ln.Center:d=Math.trunc(i/2);for(var p=e;p>=n;p--)this.DrawItems[p].rect.offset(d,0);break;case Ln.Justify:case Ln.Scatter:if(m.AlignHorz===Ln.Justify){if(this.IsParaLastDrawItem(e))return l}else if(n===e&&this.Items[this.DrawItems[n].ItemNo].Length<2)return d=Math.trunc(i/2),this.DrawItems[n].rect.offset(d,0),l;if(0===(d=Math.max(0,i)))return l;for(var y,F,v,I=0,g=0,C=0,w=new Array(e-n+1),A=n;A<=e;A++)this.Items[this.DrawItems[A].ItemNo].Visible&&(this.GetDrawItemStyle(A)<oo.Null?y=this.Items[this.DrawItems[A].ItemNo].JustifySplit()&&n!=e&&A!==e?1:0:(y=this.GetJustifyCount(A,this.GetDrawItemText(A),null),A===e&&y>0&&y--),w[A-n]=y,I+=y);I>1&&(d=Math.trunc(i/I),C=i%I),w[0]>0&&(this.DrawItems[n].rect.width+=w[0]*d,C>0&&(C>(v=this.DrawItems[n].CharLen)?(this.DrawItems[n].rect.right+=v,C-=v):(this.DrawItems[n].rect.right+=C,C=0)));for(var D=n+1;D<=e;D++)this.Items[this.DrawItems[D].ItemNo].Visible?(F=this.DrawItems[D].width,w[D-n]>0?(g=w[D-n]*d,C>0&&(this.GetDrawItemStyle(D)<oo.Null?this.Items[this.DrawItems[D].ItemNo].JustifySplit()&&(g++,C--):C>(v=this.DrawItems[D].CharLen)?(g+=v,C-=v):(g+=C,C=0))):g=0,this.DrawItems[D].rect.left=this.DrawItems[D-1].rect.right,this.DrawItems[D].rect.right=this.DrawItems[D].rect.left+F+g):(this.DrawItems[D].rect.left=this.DrawItems[D-1].rect.right,this.DrawItems[D].rect.right=this.DrawItems[D].rect.left)}return l}},{key:"CalcEmptyItemDrawRect",value:function(t){return this.CalcItemFormatHeigh(t),nt.Create(0,0,0,this.FItemFormatHeight)}},{key:"NewDrawItem",value:function(t,e,i,n,o,s,r){var a=new lo;return a.ItemNo=t,a.CharOffs=e,a.CharLen=i,a.ParaFirst=o,a.LineFirst=s,a.rect.resetRect(n),r++,this.DrawItems.insert(r,a),1===e&&(this.Items[t].FirstDItemNo=r),r}},{key:"GetHeadTailBreak",value:function(t,e){if(e<1)return e;var i=t[e+1-1];return Yl.PosCharHC(i,Yl.DontLineFirstChar)>0?(e--,e=this.GetHeadTailBreak(t,e)):(i=t[e-1],this.CharCannotEndOfLine(i)&&(e--,e=this.GetHeadTailBreak(t,e))),e}},{key:"MatchBreak",value:function(t,e,i,n){switch(e){case sh.Break:return eh.Prev;case sh.HZ:if(t===sh.ZM||t===sh.SZ||t===sh.HZ||t===sh.FH)return eh.Prev;break;case sh.ZW:if(t!==sh.ZW&&t!==sh.ZM&&t!==sh.SZ)return eh.Prev;break;case sh.ZM:if(t!==sh.ZM&&t!==sh.SZ)return eh.Prev;break;case sh.SZ:switch(t){case sh.ZM:case sh.SZ:break;case sh.FH:var o=i[n-1-1];if("￠"===o);else if("."!==o&&":"!==o&&"-"!==o&&"^"!==o&&"*"!==o&&"/"!==o)return eh.Prev;break;default:return eh.Prev}break;case sh.FH:switch(t){case sh.FH:break;case sh.SZ:var s=i[n-1];if("."!==s&&":"!==s&&"-"!==s&&"^"!==s&&"*"!==s&&"/"!==s)return eh.Prev;break;case sh.ZM:if(":"!==i[n-1])return eh.Prev;break;default:return eh.Prev}}return eh.None}},{key:"GetDefaultCursor",value:function(){return this.FormatDirection===$l.Horizontal?Ce:this.FStyle.CursorIBeamHore}},{key:"FindLineBreak",value:function(t,e,i,n){if((n=this.GetHeadTailBreak(t,n))<1)return n;if(e)return n;var o=this.GetUnicodeCharType(t[n-1]),s=this.GetUnicodeCharType(t[n+1-1]);if(this.MatchBreak(o,s,t,n+1)!=eh.Prev&&o!==sh.Break){for(var r,a=!1,l=n-1;l>=i;l--){if(r=this.GetUnicodeCharType(t[l-1]),this.MatchBreak(r,o,t,l+1)==eh.Prev){n=l,a=!0;break}o=r}a||(n=0)}return n}},{key:"DoFormatToPrev",value:function(t,e,i,n,o,s,r,a,l,h,c){return a.left=this.FDrawItems[h].rect.right,a.top=this.FDrawItems[h].rect.top,a.right=a.left,a.bottom=a.top,h=this.NewDrawItem(t,n,o,a,s,!1,h),c=i-a.right,this.FinishLine(t,h,c),t<this.FItems.count-1&&this.FItems[t+1].ParaFirst||c<=0?(r.x=e,r.y=this.DrawItems[h].rect.bottom,l=!0):(r.x=a.right,r.y=this.DrawItems[h].rect.top,l=!1),{pos:r,rect:a,lineFirst:l,drawItemNo:h,remainderWidth:c,finishLined:!0}}},{key:"DoFormatRectItemToDrawItem",value:function(t,e,i,n,o,s,r,a,l,h,c,u,f){t.FormatToDrawItem(this,e);var d;return 0===t.Width&&!r&&c?this.DoFormatToPrev(e,i,o,s,1,r,l,h,c,u,f):(d=o-l.x,!c&&(t.Width>d||t.CanPageBreak&&l.x!==i)&&(this.FinishLine(e,u,d),l.x=i,l.y=this.DrawItems[u].rect.bottom,c=!0),h.left=l.x,h.top=l.y,h.right=h.left+t.Width,t.StyleNo===oo.Bullet?h.bottom=h.top+t.Height:h.bottom=h.top+t.Height+this.Style.LineSpaceMin,u=this.NewDrawItem(e,s,1,h,r,c,u),t.IsFormatDirty=!1,{pos:l,rect:h,lineFirst:c,drawItemNo:u,remainderWidth:f=o-h.right,finishLined:!1})}},{key:"_FormatBreakTextDrawItem",value:function(t,e,i,n,o,s,r,a){var l=this.DrawItems[n],h=this.Items[l.ItemNo],c=h.Text.length;this.CalcItemFormatHeigh(h);var u=this.Style.TempCanvas.textWidth(h.Text[c-1]);return l.CharLen=l.CharLen-1,l.rect.right=l.rect.right-u,r=i-l.rect.right,this.FinishLine(t,n,r),o.x=e,o.y=l.rect.bottom,s.left=o.x,s.top=o.y,s.right=s.left+u,s.bottom=s.top+this.FItemFormatHeight,n=this.NewDrawItem(l.ItemNo,c,1,s,!1,!0,n),!1,o.x=s.right,{drawItemNo:n,point:o,rect:s,remainderWidth:r=i-s.right,paraFirst:!1}}},{key:"DoFormatTextItemToDrawItems",value:function(t,e,i,n,o,s,r,a,l,h,c,u,f,d,m,S,p,y,F){var v,I,g,C=!1;if((m=d)||S.x!==l||(m=1!==n||this.ConfirmLineFirst(F,S)),I=0,g=u[n-1]-s,o<0)I=n;else if(this.Style.FormatVersion>1){C=!1;for(var w=n-1;w<a;w++)if(u[w]-s>o){if(!C&&this.CharCanSqueeze(i[w])&&u[w]-s-o>Yl.SQUEEZEWIDTH){C=!0;continue}I=w+1;break}}else for(var A=n-1;A<a;A++)if(u[A]-s>o){I=A+1;break}if(0===I)p.left=S.x,p.top=S.y,p.right=p.left+u[a-1]-s,p.bottom=p.top+this.FItemFormatHeight,F=this.NewDrawItem(r,e+n-1,a-n+1,p,d,m,F),d=!1,y=c-p.right;else if(I===n)if(g>c-l){if(p.left=S.x,p.top=S.y,p.right=p.left+u[a-1]-s,p.bottom=p.top+this.FItemFormatHeight,F=this.NewDrawItem(r,e+n-1,1,p,d,m,F),d=!1,y=c-p.right,this.FinishLine(r,F,y),S.x=l,S.y=this.DrawItems[F].rect.bottom,n<a){var D=this.DoFormatTextItemToDrawItems(t,e,i,n+1,c-S.x,u[n-1],r,a,l,h,c,u,f,d,m,S,p,y,F);d=D.paraFirst,m=D.lineFirst,S=D.pos,p=D.rect,y=D.remainderWidth,F=D.drawItemNo}}else if(Yl.PosCharHC(i[n-1],Yl.DontLineFirstChar)>0&&this.Items[r-1].StyleNo>oo.Null&&this.DrawItems[F].CharLen>1){var P=this._FormatBreakTextDrawItem(r,l,c,F,S,p,y,d);F=P.drawItemNo,S=P.point,p=P.rect,y=P.remainderWidth,d=P.paraFirst,this.CalcItemFormatHeigh(t);var k=this.DoFormatTextItemToDrawItems(t,e,i,n,c-S.x,s,r,a,l,h,c,u,f,d,m,S,p,y,F);d=k.paraFirst,m=k.lineFirst,S=k.pos,p=k.rect,y=k.remainderWidth,F=k.drawItemNo}else{y=o,F>=0&&this.FinishLine(r,F,y),S.x=l,F>=0&&(S.y=this.DrawItems[F].rect.bottom);var x=this.DoFormatTextItemToDrawItems(t,e,i,n,c-S.x,s,r,a,l,h,c,u,f,d,m,S,p,y,F);d=x.paraFirst,m=x.lineFirst,S=x.pos,p=x.rect,y=x.remainderWidth,F=x.drawItemNo}else if(v=g>c-l?I:I-1,0===(v=this.FindLineBreak(i,f.BreakRough,n,v))&&!m&&S.x>l){y=o,this.FinishLine(r,F,y),S.x=l,S.y=this.DrawItems[F].rect.bottom;var R=this.DoFormatTextItemToDrawItems(t,e,i,n,c-S.x,s,r,a,l,h,c,u,f,d,m,S,p,y,F);d=R.paraFirst,m=R.lineFirst,S=R.pos,p=R.rect,y=R.remainderWidth,F=R.drawItemNo}else if(v<n&&(v=g>c-l?I:I-1),C&&v<I-1&&this.Style.FormatVersion>2&&(C=!1),p.left=S.x,p.top=S.y,p.right=p.left+u[v-1]-s,p.bottom=p.top+this.FItemFormatHeight,F=this.NewDrawItem(r,e+n-1,v-n+1,p,d,m,F),d=!1,y=C?0:c-p.right,this.FinishLine(r,F,y),S.x=l,S.y=this.DrawItems[F].rect.bottom,v<a){var T=this.DoFormatTextItemToDrawItems(t,e,i,v+1,c-S.x,u[v-1],r,a,l,h,c,u,f,d,m,S,p,y,F);d=T.paraFirst,m=T.lineFirst,S=T.pos,p=T.rect,y=T.remainderWidth,F=T.drawItemNo}return{paraFirst:d,lineFirst:m,pos:S,rect:p,remainderWidth:y,drawItemNo:F}}},{key:"ConfirmLineFirst",value:function(t,e){for(var i=t;i>=0&&0===this.FDrawItems[i].width&&this.FDrawItems[i].rect.left===e.x&&this.FDrawItems[i].rect.top===e.y;){if(this.FDrawItems[i].LineFirst)return!1;i--}return!0}},{key:"FormatItemToDrawItems",value:function(t,e,i,n,o,s,r){var a=!1,l=!1,h=!1,c=null,u="",f=new nt,d=0,m=this.Items[t],S=this.Style.ParaStyles[m.ParaNo];if(m.ParaFirst&&1===e?(l=!0,h=!0,s.x+=S.FirstIndentPix):(l=!1,(h=s.x===i)&&1===e&&(h=this.ConfirmLineFirst(r,s))),m.Visible)if(m.StyleNo<oo.Null){c=m;var p=this.DoFormatRectItemToDrawItem(c,t,i,o,n,e,l,S,s,f,h,r,d);s=p.pos,f=p.rect,h=p.lineFirst,r=p.drawItemNo,d=p.remainderWidth,a=p.finishLined,this.Style.ApplyTempStyle(oo.Null)}else if(this.CalcItemFormatHeigh(m),d=n-s.x,""===(u=1!==e?m.Text.substr(e-1,m.Length-e+1):m.Text)){if(this.hcl.hc.CHECKNULLITEM&&!m.ParaFirst)throw console.error(Yl.HCS_EXCEPTION_NULLTEXT,this,t,m),Yl.HCS_EXCEPTION_NULLTEXT;f.left=s.x,f.top=s.y,f.right=f.left,f.bottom=f.top+this.FItemFormatHeight,l=!0,h=!0,r=this.NewDrawItem(t,e,0,f,l,h,r),l=!1}else{for(var y=u.length,F=new Array(y),v=null,I=y,g=0,C=0;I>this.FormatTextCut;){v=this.Style.TempCanvas.getTextExtentExPoint(u.substr(g,this.FormatTextCut),this.FormatTextCut);for(var w=0;w<this.FormatTextCut;w++)F[g+w]=v[w]+C;I-=this.FormatTextCut,C=F[(g+=this.FormatTextCut)-1]}v=this.Style.TempCanvas.getTextExtentExPoint(u.substr(g,I),I);for(var A=0;A<I;A++)F[g+A]=v[A]+C;var D=this.DoFormatTextItemToDrawItems(m,e,u,1,n-s.x,0,t,y,i,o,n,F,S,l,h,s,f,d,r);l=D.paraFirst,h=D.lineFirst,s=D.pos,f=D.rect,d=D.remainderWidth,r=D.drawItemNo}else{if(!l&&h){var P=this.DoFormatToPrev(t,i,n,e,m.Length,l,s,f,h,r,d);return a=P.finishLined,{pos:P.pos,drawItemNo:P.drawItemNo}}f.left=s.x,f.top=s.y,f.right=f.left,f.bottom=f.top,r=this.NewDrawItem(t,e,m.Length,f,l,l,r),d=n-s.x}return a||(t===this.Items.count-1?this.FinishLine(t,r,d):this.Items[t+1].ParaFirst||d<=0?(this.FinishLine(t,r,d),s.x=i,s.y=this.DrawItems[r].rect.bottom):s.x=f.right),{pos:s,drawItemNo:r}}},{key:"DoFormatDirty",value:function(){null!==this.OnFormatDirty&&this.OnFormatDirty(this)}},{key:"FormatInit",value:function(){this.FFormatChange||(this.FFormatHeightChange=!1,this.FFormatStartDrawItemNo=0),this.FFormatDrawItemCountChange=!1,this.FFormatStartTop=0,this.FFormatEndBottom=0,this.FLastFormatParaNo=oo.Null}},{key:"ReSetSelectAndCaret",value:function(t){this.ReSetSelectAndCaretByOffset(t,this.GetItemOffsetAfter(t))}},{key:"ReSetSelectAndCaretByOffset",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.SelectInfo.StartItemNo=t,this.SelectInfo.StartItemOffset=e,this.SelectInfo.StartRestrain=!1,0!==this.FFormatCount)return this.FCurStyleNo=this.Items[this.SelectInfo.StartItemNo].StyleNo,void(this.FCurParaNo=this.Items[this.SelectInfo.StartItemNo].ParaNo);var n=0;n=this.Items[t].StyleNo>oo.Null&&this.SelectInfo.StartItemOffset>this.Items[t].Length?this.Items[t].Length:e;var o=this.GetDrawItemNoByOffset(t,n);i&&o<this.DrawItems.count-1&&this.DrawItems[o+1].ItemNo===t&&this.DrawItems[o+1].CharOffs===n+1&&o++,this.CaretDrawItemNo=o}},{key:"GetFormatRange",value:function(t,e){var i=this.GetFormatRangeByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,t,e);return{firstDrawItemNo:i.firstDrawItemNo,lastItemNo:i.lastItemNo}}},{key:"GetFormatRangeByOffset",value:function(t,e,i,n){return 0!==this.FFormatCount?{firstDrawItemNo:i,lastItemNo:n}:{firstDrawItemNo:this.GetFormatFirstDrawItemByOffset(t,e),lastItemNo:this.GetParaLastItemNo(t)}}},{key:"GetFormatFirstDrawItemByOffset",value:function(t,e){var i=this.GetDrawItemNoByOffset(t,e);return this.GetFormatFirstDrawItem(i)}},{key:"GetFormatFirstDrawItem",value:function(t){var e=t;if(!this.DrawItems[e].ParaFirst)for(this.DrawItems[e].LineFirst&&e--;e>0;){if(this.FDrawItems[e].LineFirst){if(e===t-1&&this.FItems[this.FDrawItems[e].ItemNo].StyleNo>oo.Null&&1===this.FDrawItems[e].CharLen&&this.FItems[this.FDrawItems[t].ItemNo].StyleNo>oo.Null&&this.CharCanNotFirstOfLine(this.FItems[this.FDrawItems[t].ItemNo].Text[0])){e--;continue}break}e--}return e>0&&this.GetDrawItemStyle(e-1)<oo.Null&&this.Items[this.DrawItems[e-1].ItemNo].PageBreakCount>0&&e--,e}},{key:"FormatPrepare",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(0==this.FFormatCount){if(this.FormatInit(),t>0&&!this.DrawItems[t].LineFirst)throw"行中格式化必需从行首开始，否则会影响分散的计算！";var i=-1,n=-1;i=e<0?this.DrawItems[t].ItemNo:e;var o=this.GetItemLastDrawItemNo(i);this.DrawItems.MarkFormatDelete(t,o),t>0?(this.FFormatStartTop=this.DrawItems[t-1].rect.bottom,n=this.DrawItems[t].rect.top-this.FFormatStartTop):(this.FFormatStartTop=0,n=0);for(var s=t+1;s<=o;s++)this.DrawItems[s].LineFirst&&(n=n+this.DrawItems[s].rect.top-this.DrawItems[s-1].rect.bottom);this.FFormatEndBottom=0!=n?-1:this.DrawItems[o].rect.bottom-n}}},{key:"ReFormatData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(0==this.FFormatCount){var o=-1;o=e<0?this.DrawItems[t].ItemNo:e;var s=this.DrawItems.count;this.FormatRange(t,o),this.FFormatDrawItemCountChange=this.DrawItems.count!=s;var r=!1,a=this.GetItemLastDrawItemNo(o);if((r=!!(this.Items[o].StyleNo<oo.Null&&this.Items[o].IsFormatDirty)||(n||this.DrawItems[t].rect.top!=this.FFormatStartTop||this.DrawItems[a].rect.bottom!=this.FFormatEndBottom))||0!=i||this.FFormatDrawItemCountChange){this.FFormatChange=!0,o=-1;for(var l=0,h=0,c=a+1;c<=this.DrawItems.count-1;c++)(0!=i||this.FFormatDrawItemCountChange)&&(this.DrawItems[c].ItemNo=this.DrawItems[c].ItemNo+i,o!=this.DrawItems[c].ItemNo&&(o=this.DrawItems[c].ItemNo,this.Items[o].FirstDItemNo=c)),r&&(this.DrawItems[c].LineFirst&&(l=this.DrawItems[c-1].rect.bottom-this.DrawItems[c].rect.top),this.DrawItems[c].rect.offset(0,l),this.Items[this.DrawItems[c].ItemNo].StyleNo<oo.Null&&(h=this.Items[this.DrawItems[c].ItemNo].ClearFormatExtraHeight(),this.DrawItems[c].rect.bottom=this.DrawItems[c].rect.bottom-h))}this.FFormatChange&&this.FFormatHeightChange||(this.FFormatHeightChange=r)}}},{key:"GetUnicodeCharType",value:function(t){var e=t.charCodeAt(0);return e>=11904&&e<=12019||e>=12032&&e<=12245||e>=12272&&e<=12283||12295==e||e>=12549&&e<=12591||e>=12704&&e<=12730||e>=12736&&e<=12771||e>=13312&&e<=19893||e>=19968&&e<=40869||e>=40870&&e<=40943||e>=58368&&e<=58856||e>=58880&&e<=59087||e>=59413&&e<=59503||e>=63744&&e<=64217||e>=131072&&e<=173782||e>=173824&&e<=177972||e>=177984&&e<=178205||e>=178208&&e<=183969||e>=183984&&e<=191456||e>=194560&&e<=195101?sh.HZ:e>=3840&&e<=3850||e>=3854&&e<=4095?sh.ZW:e>=3851&&e<=3853?sh.Break:e>=6144&&e<=6319?sh.HZ:e>=33&&e<=47||e>=58&&e<=64||e>=91&&e<=96||e>=123&&e<=126||65504==e?sh.FH:8220==e||8221==e||65509==e||8216==e||215==e||12290==e||12289==e||65281==e||65283==e||65285==e||65286==e||65288==e||65289==e||65291==e||65292==e||65293==e?this.Style.FormatVersion>2?sh.FH:sh.Break:e>=48&&e<=57?sh.SZ:e>=65&&e<=90||e>=97&&e<=122?sh.ZM:sh.Break}},{key:"CharCannotEndOfLine",value:function(t){return this.Style.FormatVersion>2?Yl.PosCharHC(t,Yl.DontLineLastCharV3)>0:Yl.PosCharHC(t,Yl.DontLineLastCharLessV3)>0}},{key:"CharCanNotFirstOfLine",value:function(t){return Yl.PosCharHC(t,Yl.DontLineFirstChar)}},{key:"CharCanSqueeze",value:function(t){return this.Style.FormatVersion>2?Yl.PosCharHC(t,Yl.LineSqueezeCharV3)>0:Yl.PosCharHC(t,Yl.LineSqueezeCharLessV3)>0}},{key:"ReFormat",value:function(){0==this.FFormatCount&&(this.DrawItems.clear(),this.InitializeField(),this.DrawItems.MarkFormatDelete(0,this.DrawItems.count-1),this.FormatInit(),this.FormatRange(0,this.Items.count-1),this.FFormatHeightChange=!0,this.SetFormatHeightChange()),this.SelectInfo.StartItemNo>=0&&this.SelectInfo.StartItemNo<this.Items.count&&this.SelectInfo.StartItemOffset>=0&&this.SelectInfo.StartItemOffset<=this.GetItemOffsetAfter(this.SelectInfo.StartItemNo)?this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset):this.ReSetSelectAndCaretByOffset(0,0)}},{key:"ReFormatActiveParagraph",value:function(){if(this.SelectInfo.StartItemNo>=0){var t=this.GetParaItemRang(this.SelectInfo.StartItemNo,-1,-1);this.ReFormatItemRange(t.a,t.b),this.ReSetSelectAndCaret(this.SelectInfo.StartItemNo)}}},{key:"ReFormatActiveItem",value:function(){if((!this.SelectExists()||this.SelectInSameItem())&&this.SelectInfo.StartItemNo>=0){var t=-1,e=-1,i=this.GetFormatRange(t,e);t=i.firstDrawItemNo,e=i.lastItemNo,this.FormatPrepare(t,e),this.Items[this.SelectInfo.StartItemNo].StyleNo<oo.Null&&this.Items[this.SelectInfo.StartItemNo].ReFormatActiveItem(),this.ReFormatData(t,e),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),this.SelectInfo.StartItemOffset>this.Items[this.SelectInfo.StartItemNo].Length&&this.ReSetSelectAndCaret(this.SelectInfo.StartItemNo)}}},{key:"ReFormatItemRange",value:function(t,e){this.FormatPrepare(this.Items[t].FirstDItemNo,e),this.ReFormatData(this.Items[t].FirstDItemNo,e),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret()}},{key:"ItemReFormatRequest",value:function(t){this.FFormatCount>0?this.FormatDirty():this.FStyle.States.Contain(oh.BatchInsert)||null===this.OnItemReFormatRequest||this.OnItemReFormatRequest(this,t)}},{key:"ItemReFormatResponse",value:function(t){this.FormatItem(t)}},{key:"ItemSetCaretRequest",value:function(t,e){t>=0&&(this.SelectInfo.EndItemNo>=0&&this.DisSelect(),null!=this.OnItemSetCaretRequest&&(this.OnItemSetCaretRequest(this,t,e),this.ReSetSelectAndCaretByOffset(t,e),this.Items[t].Active=!0,this.Style.UpdateInfoReCaret(!0)))}},{key:"ItemSetCaretRequestEx",value:function(t,e){var i=this.FItems.indexOf(t);this.ItemSetCaretRequest(i,e)}},{key:"SetFormatHeightChange",value:function(){this.FFormatChange=!0}},{key:"GetDrawItemFormatCoord",value:function(t){return this.DrawItems[t].rect.leftTop}},{key:"Clone",value:function(t){f()(F()(i.prototype),"Clone",this).call(this,t),this.ReFormat()}},{key:"GetItemNo",value:function(t){return this.FItems.indexOf(t)}},{key:"ClearFormatExtraHeight",value:function(){for(var t=0,e=0,i=1,n=this.DrawItems.count;i<n;i++)if(this.DrawItems[i].LineFirst&&this.DrawItems[i].rect.top!=this.DrawItems[i-1].rect.bottom&&(e=this.DrawItems[i].rect.top-this.DrawItems[i-1].rect.bottom)>t&&(t=e),0!==e&&this.DrawItems[i].rect.offset(0,-e),this.Items[this.DrawItems[i].ItemNo].StyleNo<oo.Null){var o=this.Items[this.DrawItems[i].ItemNo].ClearFormatExtraHeight();this.DrawItems[i].rect.bottom=this.DrawItems[i].rect.bottom-o}return t}},{key:"InvisiblePara",value:function(t){var e=this.GetParaItemRang(t,-1,-1);return this.InvisibleRange(e.a,e.b)}},{key:"InvisibleRange",value:function(t,e){for(var i=t;i<=e;i++)if(this.FItems[i].Visible)return!1;return!0}},{key:"FormatDirty",value:function(){this.DoFormatDirty()}},{key:"BeginFormat",value:function(){this.FFormatCount++}},{key:"EndFormat",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.FFormatCount>0&&this.FFormatCount--,0==this.FFormatCount&&t&&this.ReFormat()}},{key:"GetLineCount",value:function(){for(var t=0,e=0;e<this.FDrawItems.count;e++)this.FDrawItems[e].LineFirst&&t++;return t}},{key:"GetLineWidth",value:function(t){for(var e=-1,i=-1,n=0;n<this.FDrawItems.count;n++)if(this.FDrawItems[n].LineFirst&&++i===t){var o=-1;(o=this.GetLineDrawItemRang(i,o).b)>=0&&(e=this.FDrawItems[o].rect.right);break}return e}},{key:"GetDrawItemLineIndex",value:function(t){for(var e=-1,i=-1,n=0;n<this.FDrawItems.count;n++)if(this.FDrawItems[n].LineFirst&&i++,t===n){e=i;break}return e}},{key:"Width",get:function(){return this.FWidth},set:function(t){this.FWidth=t}},{key:"FormatStartDrawItemNo",get:function(){return this.FFormatStartDrawItemNo}},{key:"FormatHeightChange",get:function(){return this.FFormatHeightChange}},{key:"FormatDrawItemCountChange",get:function(){return this.FFormatDrawItemCountChange}},{key:"FormatChange",get:function(){return this.FFormatChange},set:function(t){this.FFormatChange=t}},{key:"FormatCount",get:function(){return this.FFormatCount}}]),i}(js));function Ar(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Dr=0,Pr=1,kr=2,xr=3,Rr=4,Tr=5,br=0,Br=1,Nr=2,Or=function(t){m()(i,t);var e=Ar(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).FStyle=Dr,n.FStructState=br,n.FVersion=n.GetLastVersion(),n.FColor=Ft.Black,n.Cursor=Se,n.FActive=!1,n.PointSize=5,n.OnStructStart=null,n.FOnStructOver=null,n}return l()(i,[{key:"GetLastVersion",value:function(){return 0}},{key:"PaintAnchor",value:function(t,e){}},{key:"SetActive",value:function(t){this.FActive!=t&&(this.FActive=t,t||(this.FStructState=br))}},{key:"SetColor",value:function(t){this.FColor!=t&&(this.FColor=t)}},{key:"StructState",get:function(){return this.FStructState},set:function(t){this.FStructState=t}},{key:"Assign",value:function(t){this.FStyle=t.Style,this.FVersion=t.GetLastVersion(),this.FColor=t.Color}},{key:"MouseDown",value:function(t){return this.Active=!0,this.FActive}},{key:"MouseMove",value:function(t){return this.FActive}},{key:"MouseUp",value:function(t){return this.FActive}},{key:"KeyDown",value:function(t){return!1}},{key:"KeyPress",value:function(t){return!1}},{key:"KeyUp",value:function(t){return!1}},{key:"PaintTo",value:function(t,e,i){}},{key:"PointInClient",value:function(t,e){return this.ClientRect().pointInAt(t,e)}},{key:"ClientRect",value:function(){return nt.CreateByBounds(0,0,0,0)}},{key:"SaveToStream",value:function(t){this.FStyle==Dr&&this.hcl.exception("HCShape保存失败，无效的样式值！"),t.writeByte(this.FStyle),this.FVersion=this.GetLastVersion(),t.writeByte(this.FVersion),Yl.HCSaveColorToStream(this.hcl,t,this.FColor)}},{key:"LoadFromStream",value:function(t){this.FStyle=t.readByte(),this.FVersion=t.readByte(),this.FColor=Yl.HCLoadColorFromStream(t)}},{key:"StructStart",value:function(){this.FStructState=Br,null!=this.OnStructStart&&this.OnStructStart(this)}},{key:"StructOver",value:function(){this.FStructState=br,null!=this.FOnStructOver&&this.FOnStructOver(this)}},{key:"Style",get:function(){return this.FStyle},set:function(t){this.FStyle=t}},{key:"Active",get:function(){return this.FActive},set:function(t){this.SetActive(t)}},{key:"Color",get:function(){return this.FColor},set:function(t){this.SetColor(t)}},{key:"OnStructOver",get:function(){return this.FOnStructOver},set:function(t){this.FOnStructOver=t}}]),i}(tt),_r=0,Er=1,Mr=2,Lr=3,Gr=function(){function t(e){r()(this,t),this.hcl=e,this.Color=Ft.Black,this.Style=0,this.Width=10}return l()(t,[{key:"PaintTo",value:function(t,e,i){switch(this.Style){case 1:i.pen.style=_t.Solid,i.pen.width=2,i.pen.color=this.Color,i.brush.style=Mt.Clear,i.ellipseBoundsDriect(t-this.Width/2,e-this.Width/2,this.Width,this.Width);break;case 2:i.pen.style=_t.Clear,i.brush.color=this.Color,i.ellipseBoundsDriect(t-this.Width/2,e-this.Width/2,this.Width,this.Width);break;case 3:i.pen.style=_t.Solid,i.pen.width=2,i.pen.color=this.Color,i.beginPath(),i.moveTo(t-this.Width/2,e-this.Width/2),i.lineTo(t+this.Width/2,e+this.Width/2),i.moveTo(t-this.Width/2,e+this.Width/2),i.lineTo(t+this.Width/2,e-this.Width/2),i.paintPath()}}},{key:"SaveToStream",value:function(t){t.writeByte(this.Style),t.writeByte(this.Width),Yl.HCSaveColorToStream(this.hcl,t,this.Color)}},{key:"LoadFromStream",value:function(t){this.Style=t.readByte(),this.Width=t.readByte(),this.Color=Yl.HCLoadColorFromStream(t)}}]),t}(),Hr=function(t){m()(i,t);var e=Ar(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).Style=Pr,n.FStartPt=et.Create(0,0),n.FEndPt=et.Create(0,0),n.FMousePt=et.Create(0,0),n.FWidth=1,n.FActiveOjb=_r,n.FLineStyle=_t.Solid,n.StartPoint=new Gr(t),n.EndPoint=new Gr(t),n}return l()(i,[{key:"GetLastVersion",value:function(){return 1}},{key:"SetWidth",value:function(t){this.FWidth!=t&&(this.FWidth=t)}},{key:"SetLineStyle",value:function(t){this.FLineStyle!=t&&(this.FLineStyle=t)}},{key:"PaintAnchor",value:function(t,e){t.pen.color=Ft.Blue,t.pen.width=1,t.pen.style=_t.Solid,t.brush.color=Ft.White,t.fillBounds(this.FStartPt.x+e.left-this.PointSize,this.FStartPt.y+e.top-this.PointSize,this.PointSize+this.PointSize,this.PointSize+this.PointSize),t.rectangleBounds(this.FStartPt.x+e.left-this.PointSize,this.FStartPt.y+e.top-this.PointSize,this.PointSize+this.PointSize,this.PointSize+this.PointSize),t.fillBounds(this.FEndPt.x+e.left-this.PointSize,this.FEndPt.y+e.top-this.PointSize,this.PointSize+this.PointSize,this.PointSize+this.PointSize),t.rectangleBounds(this.FEndPt.x+e.left-this.PointSize,this.FEndPt.y+e.top-this.PointSize,this.PointSize+this.PointSize,this.PointSize+this.PointSize)}},{key:"SetActive",value:function(t){f()(F()(i.prototype),"SetActive",this).call(this,t),this.Active||(this.FActiveOjb=_r)}},{key:"GetObjAt",value:function(t,e){var i=_r;if(nt.Create(this.FStartPt.x-this.PointSize,this.FStartPt.y-this.PointSize,this.FStartPt.x+this.PointSize,this.FStartPt.y+this.PointSize).pointInAt(t,e))i=Mr;else if(nt.Create(this.FEndPt.x-this.PointSize,this.FEndPt.y-this.PointSize,this.FEndPt.x+this.PointSize,this.FEndPt.y+this.PointSize).pointInAt(t,e))i=Lr;else{var n=new Array(4);Math.abs(this.FStartPt.y-this.FEndPt.y)<10?(n[0]=et.Create(this.FStartPt.x,this.FStartPt.y-this.PointSize),n[1]=et.Create(this.FStartPt.x,this.FStartPt.y+this.PointSize),n[2]=et.Create(this.FEndPt.x,this.FEndPt.y+this.PointSize),n[3]=et.Create(this.FEndPt.x,this.FEndPt.y-this.PointSize)):(n[0]=et.Create(this.FStartPt.x-this.PointSize,this.FStartPt.y),n[1]=et.Create(this.FStartPt.x+this.PointSize,this.FStartPt.y),n[2]=et.Create(this.FEndPt.x+this.PointSize,this.FEndPt.y),n[3]=et.Create(this.FEndPt.x-this.PointSize,this.FEndPt.y)),this.hcl.pointInPathAt(n,t,e)&&(i=Er)}return i}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FStartPt.resetByPoint(t.FStartPt),this.FEndPt.resetByPoint(t.FEndPt)}},{key:"MouseDown",value:function(t){if(t.button!=ae)return!1;var e=!1;if(this.StructState!=br)this.StructState==Br?(this.FStartPt.reset(t.x,t.y),this.FEndPt.reset(t.x,t.y),this.StructState=Nr):this.StructOver(),e=!0;else{var i=this.GetObjAt(t.x,t.y);this.FActiveOjb!=i?(this.FActiveOjb=i,this.Active=this.FActiveOjb!=_r,e=this.Active):e=i!=_r,e&&this.FActiveOjb==Er&&this.FMousePt.reset(t.x,t.y)}return e}},{key:"MouseMove",value:function(t){if(this.StructState==Nr)return this.FEndPt.reset(t.x,t.y),!0;var e=!1;if(t.button!=ae||this.hcl.keyDownStates[Ge]||this.FActiveOjb==_r){var i=this.GetObjAt(t.x,t.y);!this.Active||i!=Mr&&i!=Lr?i!=_r&&(this.Cursor=Ae):this.Cursor=ye,e=i!=_r}else switch(e=!0,this.FActiveOjb){case Er:this.FStartPt.x=this.FStartPt.x+t.x-this.FMousePt.x,this.FStartPt.y=this.FStartPt.y+t.y-this.FMousePt.y,this.FEndPt.x=this.FEndPt.x+t.x-this.FMousePt.x,this.FEndPt.y=this.FEndPt.y+t.y-this.FMousePt.y,this.FMousePt.x=t.x,this.FMousePt.y=t.y;break;case Mr:this.FStartPt.x=t.x,this.FStartPt.y=t.y;break;case Lr:this.FEndPt.x=t.x,this.FEndPt.y=t.y}return e}},{key:"MouseUp",value:function(t){return!1}},{key:"PaintTo",value:function(t,e,i){t.pen.color=this.Color,t.pen.width=this.FWidth,t.pen.style=this.FLineStyle,t.drawLineDriect(this.FStartPt.x+e.left,this.FStartPt.y+e.top,this.FEndPt.x+e.left,this.FEndPt.y+e.top),this.StartPoint.PaintTo(this.FStartPt.x+e.left,this.FStartPt.y+e.top,t),this.EndPoint.PaintTo(this.FEndPt.x+e.left,this.FEndPt.y+e.top,t),!i.Print&&this.Active&&this.PaintAnchor(t,e)}},{key:"PointInClient",value:function(t,e){return this.GetObjAt(t,e)!=_r}},{key:"ClientRect",value:function(){var t=new nt;return this.FStartPt.x<this.FEndPt.x?(t.left=this.FStartPt.x,t.right=this.FEndPt.x):(t.left=this.FEndPt.x,t.right=this.FStartPt.x),this.FStartPt.y<this.FEndPt.y?(t.top=this.FStartPt.y,t.bottom=this.FEndPt.y):(t.top=this.FEndPt.y,t.bottom=this.FStartPt.y),t}},{key:"SaveToStream",value:function(t){f()(F()(i.prototype),"SaveToStream",this).call(this,t),t.writeByte(this.FWidth),t.writeByte(this.FLineStyle),t.writeInt32(this.FStartPt.x),t.writeInt32(this.FStartPt.y),t.writeInt32(this.FEndPt.x),t.writeInt32(this.FEndPt.y),this.StartPoint.SaveToStream(t),this.EndPoint.SaveToStream(t)}},{key:"LoadFromStream",value:function(t){f()(F()(i.prototype),"LoadFromStream",this).call(this,t),this.FWidth=t.readByte(),this.FLineStyle=t.readByte(),this.FStartPt.x=t.readInt32(),this.FStartPt.y=t.readInt32(),this.FEndPt.x=t.readInt32(),this.FEndPt.y=t.readInt32(),this.FVersion>0&&(this.StartPoint.LoadFromStream(t),this.EndPoint.LoadFromStream(t))}},{key:"StartPt",get:function(){return this.FStartPt},set:function(t){this.FStartPt=t}},{key:"EndPt",get:function(){return this.FEndPt},set:function(t){this.FEndPt=t}},{key:"Width",get:function(){return this.FWidth},set:function(t){this.SetWidth(t)}},{key:"LineStyle",get:function(){return this.FLineStyle},set:function(t){this.SetLineStyle(t)}},{key:"ActiveObj",get:function(){return this.FActiveOjb}}],[{key:"Create",value:function(t,e,n){var o=new i(t);return o.FStartPt.reset(e.x,e.y),o.FEndPt.reset(n.x,n.y),o}}]),i}(Or),Vr=function(t){m()(i,t);var e=Ar(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).Style=kr,n.FBackColor=Yl.HCTransparentColor,n}return l()(i,[{key:"GetObjAt",value:function(t,e){var i=_r;if(nt.Create(this.StartPt.x-this.PointSize,this.StartPt.y-this.PointSize,this.StartPt.x+this.PointSize,this.StartPt.y+this.PointSize).pointInAt(t,e))i=Mr;else if(nt.Create(this.EndPt.x-this.PointSize,this.EndPt.y-this.PointSize,this.EndPt.x+this.PointSize,this.EndPt.y+this.PointSize).pointInAt(t,e))i=Lr;else{var n=this.ClientRect();n.inFlate(this.PointSize,this.PointSize),n.pointInAt(t,e)&&(n.inFlate(-this.PointSize-this.PointSize,-this.PointSize-this.PointSize),n.pointInAt(t,e)||(i=Er))}return i}},{key:"PaintTo",value:function(t,e,i){t.pen.color=this.Color,t.pen.width=this.Width,t.pen.style=this.LineStyle,this.FBackColor==Yl.HCTransparentColor&&(t.brush.style=Mt.Clear),t.rectangle(this.StartPt.x+e.left,this.StartPt.y+e.top,this.EndPt.x+e.left,this.EndPt.y+e.top),!i.Print&&this.Active&&this.PaintAnchor(t,e)}},{key:"BackColor",get:function(){return this.FBackColor},set:function(t){this.FBackColor=t}}]),i}(Hr),Ur=function(t){m()(i,t);var e=Ar(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).Style=xr,n}return l()(i,[{key:"GetObjAt",value:function(t,e){var i=_r;if(nt.Create(this.StartPt.x-this.PointSize,this.StartPt.y-this.PointSize,this.StartPt.x+this.PointSize,this.StartPt.y+this.PointSize).pointInAt(t,e))i=Mr;else if(nt.Create(this.EndPt.x-this.PointSize,this.EndPt.y-this.PointSize,this.EndPt.x+this.PointSize,this.EndPt.y+this.PointSize).pointInAt(t,e))i=Lr;else{var n=this.ClientRect();n.inFlate(this.PointSize,this.PointSize),this.hcl.pointInEllipseRect(n,t,e)&&(n.inFlate(-this.PointSize-this.PointSize,-this.PointSize-this.PointSize),this.hcl.pointInEllipseRect(n,t,e)||(i=Er))}return i}},{key:"PaintTo",value:function(t,e,i){t.pen.color=this.Color,t.pen.width=this.Width,t.pen.style=this.LineStyle,this.BackColor==Yl.HCTransparentColor&&(t.brush.style=Mt.Clear),t.ellipseDriect(this.StartPt.x+e.left,this.StartPt.y+e.top,this.EndPt.x+e.left,this.EndPt.y+e.top),!i.Print&&this.Active&&this.PaintAnchor(t,e)}}]),i}(Vr),Wr=function(t){m()(i,t);var e=Ar(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).Style=Rr,n.FWidth=1,n.FLineStyle=_t.Solid,n.FBrushStyle=Mt.Clear,n.FPoints=new ot,n.FActivePointIndex=-1,n.FActiveLineIndex=-1,n.FMousePt=new et,n}return l()(i,[{key:"GetLastVersion",value:function(){return 1}},{key:"OffsetPoints",value:function(t,e){for(var i=0;i<this.FPoints.count;i++)this.FPoints[i].offset(t,e)}},{key:"SetWidth",value:function(t){this.FWidth!=t&&(this.FWidth=t)}},{key:"PaintAnchor",value:function(t,e){t.pen.color=Ft.Blue,t.pen.width=1,t.pen.style=_t.Solid,t.brush.color=Ft.White;for(var i=0;i<this.FPoints.count;i++)t.fillBounds(this.FPoints[i].x+e.left-this.PointSize,this.FPoints[i].y+e.top-this.PointSize,this.PointSize+this.PointSize,this.PointSize+this.PointSize),t.rectangle(this.FPoints[i].x+e.left-this.PointSize,this.FPoints[i].y+e.top-this.PointSize,this.FPoints[i].x+e.left+this.PointSize,this.FPoints[i].y+e.top+this.PointSize);this.FActivePointIndex>=0&&(t.pen.color=Ft.Red,this.StructState==Nr&&(t.pen.style=_t.Dot),t.brush.color=Ft.Blue,t.pen.color=Ft.White,t.fillBounds(this.FPoints[this.FActivePointIndex].x+e.left-this.PointSize,this.FPoints[this.FActivePointIndex].y+e.top-this.PointSize,this.PointSize+this.PointSize,this.PointSize+this.PointSize),t.rectangle(this.FPoints[this.FActivePointIndex].x+e.left-this.PointSize,this.FPoints[this.FActivePointIndex].y+e.top-this.PointSize,this.FPoints[this.FActivePointIndex].x+e.left+this.PointSize,this.FPoints[this.FActivePointIndex].y+e.top+this.PointSize))}},{key:"SetActive",value:function(t){f()(F()(i.prototype),"SetActive",this).call(this,t),this.Active||(this.FActivePointIndex=-1,this.FActiveLineIndex=-1)}},{key:"GetPointAt",value:function(t,e){for(var i=null,n=0;n<this.FPoints.count;n++)if(i=this.FPoints[n],nt.Create(i.x-this.PointSize,i.y-this.PointSize,i.x+this.PointSize,i.y+this.PointSize).pointInAt(t,e))return n;return-1}},{key:"GetLineAt",value:function(t,e){for(var i=new Array(4),n=0;n<this.FPoints.count;n++)if(n==this.FPoints.count-1?Math.abs(this.FPoints[n].y-this.FPoints[0].y)<10?(i[0]=et.Create(this.FPoints[n].x,this.FPoints[n].y-this.PointSize),i[1]=et.Create(this.FPoints[n].x,this.FPoints[n].y+this.PointSize),i[2]=et.Create(this.FPoints[0].x,this.FPoints[0].y+this.PointSize),i[3]=et.Create(this.FPoints[0].x,this.FPoints[0].y-this.PointSize)):(i[0]=et.Create(this.FPoints[n].x-this.PointSize,this.FPoints[n].y),i[1]=et.Create(this.FPoints[n].x+this.PointSize,this.FPoints[n].y),i[2]=et.Create(this.FPoints[0].x+this.PointSize,this.FPoints[0].y),i[3]=et.Create(this.FPoints[0].x-this.PointSize,this.FPoints[0].y)):Math.abs(this.FPoints[n].y-this.FPoints[n+1].y)<10?(i[0]=et.Create(this.FPoints[n].x,this.FPoints[n].y-this.PointSize),i[1]=et.Create(this.FPoints[n].x,this.FPoints[n].y+this.PointSize),i[2]=et.Create(this.FPoints[n+1].x,this.FPoints[n+1].y+this.PointSize),i[3]=et.Create(this.FPoints[n+1].x,this.FPoints[n+1].y-this.PointSize)):(i[0]=et.Create(this.FPoints[n].x-this.PointSize,this.FPoints[n].y),i[1]=et.Create(this.FPoints[n].x+this.PointSize,this.FPoints[n].y),i[2]=et.Create(this.FPoints[n+1].x+this.PointSize,this.FPoints[n+1].y),i[3]=et.Create(this.FPoints[n+1].x-this.PointSize,this.FPoints[n+1].y)),this.hcl.pointInPathAt(i,t,e))return n;return-1}},{key:"PtInAt",value:function(t,e){return this.hcl.pointInPathAt(this.FPoints,t,e)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FLineStyle=t.LineStyle,this.FBrushStyle=t.BrushStyle;var e=null;this.FPoints.Clear();for(var n=0;n<t.Points.count;n++)e=et.Create(t.Points[n].x,t.Points[n].y),this.FPoints.add(e)}},{key:"MouseDown",value:function(t){if(t.button==le)return this.StructState==Nr&&(this.StructOver(),!0);if(t.button!=ae)return!1;var e=null,i=!1;if(this.StructState!=br)this.StructState==Br?(e=et.Create(t.x,t.y),this.FPoints.add(e),e=et.Create(t.x,t.y),this.FPoints.add(e),this.FActivePointIndex=this.FPoints.count-1,this.StructState=Nr):this.StructState==Nr?(e=et.Create(t.x,t.y),this.FPoints.add(e),this.FActivePointIndex=this.FPoints.count-1):this.StructOver(),i=!0;else{var n=this.GetPointAt(t.x,t.y);this.FActivePointIndex!=n?(this.FActivePointIndex=n,this.Active=this.FActivePointIndex>=0,i=this.Active):i=n>=0,i||(n=this.GetLineAt(t.x,t.y),this.FActiveLineIndex!=n?(this.FActiveLineIndex=n,this.Active=this.FActiveLineIndex>=0,i=this.Active):i=n>=0),i||this.FBrushStyle===Mt.Clear||(i=this.PtInAt(t.x,t.y),this.Active=i),i&&this.FMousePt.reset(t.x,t.y)}return i}},{key:"MouseMove",value:function(t){if(this.StructState==Nr)return this.FPoints[this.FActivePointIndex].reset(t.x,t.y),!0;if(t.button!=ae||this.hcl.keyDownStates[Ge]){var e=this.GetPointAt(t.x,t.y);if(e>=0)return this.Cursor=ye,!0;if((e=this.GetLineAt(t.x,t.y))>=0)return this.Cursor=Ae,!0;if(this.FBrushStyle!==Mt.Clear&&this.PtInAt(t.x,t.y))return this.Cursor=Ae,!0}else{if(this.FActivePointIndex>=0)return this.FPoints[this.FActivePointIndex].reset(t.x,t.y),!0;if(this.FActiveLineIndex>=0)return this.OffsetPoints(t.x-this.FMousePt.x,t.y-this.FMousePt.y),this.FMousePt.reset(t.x,t.y),!0;if(this.FBrushStyle!==Mt.Clear)return this.OffsetPoints(t.x-this.FMousePt.x,t.y-this.FMousePt.y),this.FMousePt.reset(t.x,t.y),!0}return!1}},{key:"MouseUp",value:function(t){return!1}},{key:"KeyDown",value:function(t){return(t.keyCode===Ee||t.keyCode===Xe)&&this.StructState===br&&this.FActivePointIndex>=0&&this.FPoints.count>3&&(this.FPoints.removeAt(this.FActivePointIndex),this.FActivePointIndex=-1,!0)}},{key:"PaintTo",value:function(t,e,i){if(0!==this.FPoints.count){t.pen.color=this.Color,t.pen.width=this.FWidth,t.pen.style=this.FLineStyle,t.beginPath(),t.h5context.moveTo(this.FPoints[0].x+e.left,this.FPoints[0].y+e.top);for(var n=1;n<this.FPoints.count;n++)t.h5context.lineTo(this.FPoints[n].x+e.left,this.FPoints[n].y+e.top);this.FPoints.count>2&&t.h5context.lineTo(this.FPoints[0].x+e.left,this.FPoints[0].y+e.top),t.closePath(),this.FBrushStyle!=Mt.Clear&&(t.brush.style=this.FBrushStyle,t.fillPath()),t.paintPath(),!i.Print&&this.Active&&this.PaintAnchor(t,e)}}},{key:"PointInClient",value:function(t,e){var i=this.GetPointAt(t,e);return i>=0||((i=this.GetLineAt(t,e))>=0||!!this.PtInAt(t,e))}},{key:"StructOver",value:function(){this.FActivePointIndex=-1,this.FActiveLineIndex=-1,this.FPoints.count>2&&this.FPoints.removeAt(this.FPoints.count-1),f()(F()(i.prototype),"StructOver",this).call(this)}},{key:"SaveToStream",value:function(t){f()(F()(i.prototype),"SaveToStream",this).call(this,t),t.writeByte(this.FWidth),t.writeByte(this.FLineStyle),t.writeByte(this.FBrushStyle),t.writeInt32(this.FPoints.count);for(var e=0;e<this.FPoints.count;e++)t.writeInt32(this.FPoints[e].x),t.writeInt32(this.FPoints[e].y)}},{key:"LoadFromStream",value:function(t){this.FPoints.clear(),f()(F()(i.prototype),"LoadFromStream",this).call(this,t),this.FWidth=t.readByte(),this.FLineStyle=t.readByte(),this.FVersion<1?this.FBrushStyle=Mt.Clear:this.FBrushStyle=t.readByte();for(var e=t.readInt32(),n=0,o=0,s=null,r=0;r<e;r++)n=t.readInt32(),o=t.readInt32(),s=et.Create(n,o),this.FPoints.add(s)}},{key:"Points",get:function(){return this.FPoints}},{key:"Width",get:function(){return this.FWidth},set:function(t){this.SetWidth(t)}},{key:"LineStyle",get:function(){return this.FLineStyle},set:function(t){this.FLineStyle=t}},{key:"BrushStyle",get:function(){return this.FBrushStyle},set:function(t){this.FBrushStyle=t}}]),i}(Or),zr=function(t){m()(i,t);var e=Ar(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).FName=L.DefaultFont,n.FSize=12,n.FStyle=new Tt,n.Color=Ft.Black,n.OnChange=null,n}return l()(i,[{key:"DoChange",value:function(t){null!=this.OnChange&&this.OnChange(t)}},{key:"SetName",value:function(t){this.FName!=t&&(this.FName=t,this.DoChange(this))}},{key:"SetSize",value:function(t){this.FSize!=t&&(this.FSize=t,this.DoChange(this))}},{key:"SetStyle",value:function(t){this.FStyle!=t&&(this.FStyle=t,this.DoChange(this))}},{key:"ToCanvas",value:function(t){t.font.name=this.FName,t.font.size=this.FSize,t.font.styles.value=this.FStyle.value,t.font.color=this.Color}},{key:"SaveToStream",value:function(t){t.writeInt32(this.FSize),t.writeByte(this.FStyle.value),Yl.HCSaveColorToStream(this.hcl,t,this.Color),Yl.HCSaveTextToStream(t,this.FName)}},{key:"LoadFromStream",value:function(t){this.FSize=t.readInt32(),this.FStyle.value=t.readByte(),this.Color=Yl.HCLoadColorFromStream(t),this.FName=Yl.HCLoadTextFromStream(t,Yl.HC_FileVersionInt)}},{key:"Name",get:function(){return this.FName},set:function(t){this.SetName(t)}},{key:"Size",get:function(){return this.FSize},set:function(t){this.SetSize(t)}},{key:"Style",get:function(){return this.FStyle},set:function(t){this.SetStyle(t)}}]),i}(tt),Kr=function(t){m()(i,t);var e=Ar(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).Style=Tr,n.FStartPt=new et,n.FMousePt=new et,n.FWidth=0,n.FHeight=0,n.FText="文本标注",n.FFont=new zr(t),n.FFont.Color=n.Color,n.FFont.OnChange=function(t){n.DoFontChange(t)},n.CalcSize(),n}return l()(i,[{key:"CalcSize",value:function(){this.FFont.ToCanvas(this.hcl.hclCanvasTemp);var t=this.hcl.hclCanvasTemp.textMetric(this.FText);this.FWidth=t.width,this.FHeight=t.height}},{key:"PaintAnchor",value:function(t,e){t.pen.color=Ft.Blue,t.pen.width=1,t.pen.style=_t.Solid,t.rectangleBounds(e.left+this.FStartPt.x-2,e.top+this.FStartPt.y-2,this.FWidth+4,this.FHeight+4)}},{key:"SetText",value:function(t){this.FText!=t&&(this.FText=t,this.CalcSize())}},{key:"SetColor",value:function(t){f()(F()(i.prototype),"SetColor",this).call(this,t),this.FFont.Color=this.Color}},{key:"DoFontChange",value:function(t){this.CalcSize()}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FText=t.Text}},{key:"MouseDown",value:function(t){return this.StructState===Br?(this.FStartPt.reset(t.x,t.y),this.StructOver()):this.Active=!0,this.FMousePt.reset(t.x,t.y),!0}},{key:"MouseMove",value:function(t){var e=!1;return t.button===ae&&(e=!0,this.FStartPt.x=this.FStartPt.x+t.x-this.FMousePt.x,this.FStartPt.y=this.FStartPt.y+t.y-this.FMousePt.y,this.FMousePt.reset(t.x,t.y)),this.ClientRect().pointInAt(t.x,t.y)&&(this.Cursor=Ae,e=!0),e}},{key:"MouseUp",value:function(t){return!1}},{key:"PaintTo",value:function(t,e,i){t.brush.style=Mt.Clear,this.FFont.ToCanvas(t),t.textOut(this.FStartPt.x+e.left,this.FStartPt.y+e.top,this.FText),!i.Print&&this.Active&&this.PaintAnchor(t,e)}},{key:"ClientRect",value:function(){return nt.CreateByBounds(this.FStartPt.x,this.FStartPt.y,this.FWidth,this.FHeight)}},{key:"SaveToStream",value:function(t){f()(F()(i.prototype),"SaveToStream",this).call(this,t),this.FFont.SaveToStream(t),t.writeInt32(this.FStartPt.x),t.writeInt32(this.FStartPt.y),Yl.HCSaveTextToStream(t,this.FText)}},{key:"LoadFromStream",value:function(t){f()(F()(i.prototype),"LoadFromStream",this).call(this,t),this.FFont.LoadFromStream(t),this.FStartPt.x=t.readInt32(),this.FStartPt.y=t.readInt32(),this.FText=Yl.HCLoadTextFromStream(t,Yl.HC_FileVersionInt),this.CalcSize()}},{key:"Text",get:function(){return this.FText},set:function(t){this.SetText(t)}}]),i}(Or),Jr=function(t){m()(i,t);var e=Ar(i);function i(t){var n;return r()(this,i),(n=e.call(this)).hcl=t,n.FActiveIndex=-1,n.FHotIndex=-1,n.FOperStyle=Dr,n.FOnStructOver=null,n.OnStructStart=null,n.OnActiveChange=null,n}return l()(i,[{key:"CreateShapeByStyle",value:function(t){var e=null;switch(t){case Dr:this.hcl.exception("HCShape读取失败，无效的样式值！");break;case Pr:e=new Hr(this.hcl);break;case kr:e=new Vr(this.hcl);break;case xr:e=new Ur(this.hcl);break;case Rr:e=new Wr(this.hcl);break;case Tr:e=new Kr(this.hcl)}return e}},{key:"NewShape",value:function(t){var e=this,i=this.CreateShapeByStyle(t);return null!=i?(i.OnStructStart=function(t){e.DoShapeStructStart(t)},i.OnStructOver=function(t){e.DoShapeStructOver(t)},this.add(i),this.count-1):-1}},{key:"DoShapeStructStart",value:function(t){null!=this.OnStructStart&&this.OnStructStart(t)}},{key:"DoShapeStructOver",value:function(t){null!=this.FOnStructOver&&this.FOnStructOver(t)}},{key:"SetOperStyle",value:function(t){this.FOperStyle!=t&&(this.FOperStyle=t,this.FOperStyle!=Dr&&(this.ActiveIndex=-1))}},{key:"SetActiveIndex",value:function(t){this.FActiveIndex!=t&&(this.FActiveIndex>=0&&(this[this.FActiveIndex].Active=!1),this.FActiveIndex=t,this.FActiveIndex>=0&&(this[this.FActiveIndex].Active=!0),null!=this.OnActiveChange&&this.OnActiveChange())}},{key:"MouseDown",value:function(t){var e=!1;if(t.button!=ae)return this.FActiveIndex>=0&&(e=this[this.FActiveIndex].MouseDown(t)),e||(this.ActiveIndex=-1),!0;if(this.FOperStyle!=Dr){if(this.FActiveIndex<0){var i=this.NewShape(this.FOperStyle);this[i].StructStart(),this.ActiveIndex=i}this.FActiveIndex>=0&&((e=this[this.FActiveIndex].MouseDown(t))||(this.ActiveIndex=-1))}else{for(var n=-1,o=this.count-1;o>=0;o--)if(this[o].PointInClient(t.x,t.y)&&this[o].MouseDown(t)){n=o,e=!0;break}n!=this.FActiveIndex&&(this.ActiveIndex=n,e=!0)}return e}},{key:"MouseMove",value:function(t){if(this.FActiveIndex>=0&&this[this.FActiveIndex].MouseMove(t))return this.FHotIndex=this.FActiveIndex,!0;this.FHotIndex=-1;for(var e=this.count-1;e>=0;e--)if(this[e].PointInClient(t.x,t.y)&&this[e].MouseMove(t))return this.FHotIndex=e,!0;return!1}},{key:"MouseUp",value:function(t){for(var e=this.count-1;e>=0;e--)if(this[e].MouseUp(t))return!0;return!1}},{key:"KeyDown",value:function(t){if(this.FActiveIndex>=0){if(this[this.FActiveIndex].KeyDown(t))return!0;if(t.keyCode===Ee||t.keyCode===Xe)return this.removeAt(this.FActiveIndex),this.FActiveIndex=-1,!0}return!1}},{key:"DisActive",value:function(){this.FOperStyle=Dr,this.FActiveIndex>=0&&(this[this.FActiveIndex].Active=!1)}},{key:"PaintTo",value:function(t,e,i){for(var n=0;n<this.count;n++)this[n].PaintTo(t,e,i)}},{key:"SaveToStream",value:function(t){t.writeInt32(this.count);for(var e=0;e<this.count;e++)this[e].SaveToStream(t)}},{key:"LoadFromStream",value:function(t){this.clear();for(var e=t.readInt32(),i=null,n=Dr,o=0;o<e;o++)n=t.readByte(),i=this.CreateShapeByStyle(n),t.position=t.position-1,i.LoadFromStream(t),this.add(i)}},{key:"OperStyle",get:function(){return this.FOperStyle},set:function(t){this.SetOperStyle(t)}},{key:"ActiveIndex",get:function(){return this.FActiveIndex},set:function(t){this.SetActiveIndex(t)}},{key:"HotIndex",get:function(){return this.FHotIndex}},{key:"OnStructOver",get:function(){return this.FOnStructOver},set:function(t){this.FOnStructOver=t}}]),i}(ot);function jr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Yr=function(t){m()(i,t);var e=jr(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FImage=null,o.StyleNo=oo.Image,o.FShapeManager=new Jr(t),o.FEmpty=!0,o.OnImageLoaded=null,o.Clear(),o}return l()(i,[{key:"DoImageLoaded",value:function(t,e){null!==this.OnImageLoaded&&this.OnImageLoaded(t,e)}},{key:"GetWidth",value:function(){var t=f()(F()(i.prototype),"GetWidth",this).call(this);return 0==t&&(t=this.FImage.width),t}},{key:"GetHeight",value:function(){var t=f()(F()(i.prototype),"GetHeight",this).call(this);return 0==t&&(t=this.FImage.height),t}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){this.FImage.width!=this.Width||this.FImage.height!=this.Height?a.drawImageRect(e,this.FImage.image):a.drawImage(e.left,e.top,this.FImage.image),this.FEmpty&&(a.pen.style=_t.Solid,a.pen.color=Ft.Black,a.pen.width=1,a.rectangleRect(e)),a.save();try{a.translate(e.left,e.top),a.scale(this.Width/this.FImage.width,this.Height/this.FImage.height),this.FShapeManager.PaintTo(a,e.offset(-e.left,-e.top,!0),l)}finally{a.restore()}f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,r,r,a,l)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FImage.assign(t.Image),this.FEmpty=t.Empty}},{key:"PaintTop",value:function(t,e){if(this.Resizing){t.save();try{t.alpha=.5,t.drawImageRect(e,this.FImage.image)}finally{t.restore()}}f()(F()(i.prototype),"PaintTop",this).call(this,t,e)}},{key:"Clear",value:function(){var t=this;this.FImage=Wi.Create(this.hcl,this.Width,this.Height),this.FImage.onImageLoaded=function(e,i){t.OwnerData.Style.InvalidateRect(null)},this.FEmpty=!0}},{key:"ResizeToHeight",value:function(t){var e=this.FImage.image.height/t;this.Height=t,this.Width=L.Round(this.FImage.image.width/e)}},{key:"RestrainSize",value:function(t,e){if(this.Width>t){var i=this.Width/t;this.Width=t,this.Height=L.Round(this.Height/i)}if(this.Height>e){var n=this.Height/e;this.Height=e,this.Width=L.Round(this.Width/n)}}},{key:"LoadGraphicFile",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=new FileReader;o.readAsDataURL(t),o.onload=function(t){e.FImage=new Wi(e.hcl),e.FImage.onImageLoaded=function(t,o){t&&(n&&(e.Width=e.FImage.width,e.Height=e.FImage.height),e.FEmpty=!1,e.DoImageLoaded(t,o)),null!=i&&i(t,e)},e.FImage.src=o.result},o.onerror=function(t){null!=i&&i(!1,e)}}},{key:"LoadGraphicStream",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];null===this.FImage&&(this.FImage=new Wi(this.hcl));var o=t.buffer;this.FImage.onImageLoaded=function(t,o){t&&(n&&(e.Width=e.FImage.width,e.Height=e.FImage.height),e.FEmpty=!1,e.DoImageLoaded(t,o)),null!=i&&i(t,e)},this.FImage.src="data:image/png;base64,"+o.toBase64()}},{key:"LoadFromBase64",value:function(t,e,i){var n=this;null===this.FImage&&(this.FImage=new Wi(this.hcl)),this.FImage.onImageLoaded=function(t,e){t&&(n.Width=n.FImage.width,n.Height=n.FImage.height,n.FEmpty=!1,n.DoImageLoaded(t,e)),i&&i(t,n)},t?0!=t.indexOf("data:")?this.FImage.src="data:image/"+e+";base64,"+t:this.FImage.src=t:(this.Clear(),i&&i(!1,this))}},{key:"SaveToStreamRange",value:function(t,e,n){if(f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),""!=this.FImage.src){var o=this.FImage.src.split(","),s=U.fromBase64(o[1]);t.writeUInt32(s.length),s.length>0&&t.writeBuffer(s)}else t.writeUInt32(0);this.FShapeManager.SaveToStream(t)}},{key:"LoadFromStream",value:function(t,e,n){var o=this;f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n);var s=t.readUInt32();if(s>0){null==this.FImage&&(this.FImage=new Wi(this.hcl));var r=t.readBuffer(s);this.FImage.src="data:image/png;base64,"+U.fromBuffer(r).toBase64(),this.FEmpty=!1}else this.FImage=Wi.Create(this.hcl,this.Width,this.Height),this.FEmpty=!0;this.FImage.onImageLoaded=function(t,e){o.OwnerData.Style.InvalidateRect(null)},n>26&&this.FShapeManager.LoadFromStream(t)}},{key:"ToHtml",value:function(){var t=this.SaveToImage();return t?'<img width="'+this.FWidth+'" height="'+this.FHeight+'" src="'+t+'" alt="HCImageItem" />':'<img width="'+this.Width+'" height="'+this.Height+'" src="" alt="HCImageItem" />'}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t)}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t)}},{key:"RecoverOrigianlSize",value:function(){this.Width=this.FImage.width,this.Height=this.FImage.height}},{key:"Image",get:function(){return this.FImage},set:function(t){this.FImage=t}},{key:"Empty",get:function(){return this.FEmpty}},{key:"ShapeManager",get:function(){return this.FShapeManager}}],[{key:"Create",value:function(t,e,n,o){var s=new i(t,e);return s.Width=n,s.Height=o,s.FCanResize=!0,s.FGripSize=8,s}}]),i}(Is);function Qr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Xr=function(t){m()(i,t);var e=Qr(i);function i(t,n){var o;r()(this,i),(o=e.call(this,t,n)).StyleNo=oo.Tab;var s=n.Style.TempCanvas.textMetric("荆通");return o.Width=s.width,o.Height=s.height,o}return l()(i,[{key:"GetOffsetAt",value:function(t){return t<this.Width/2?Yl.OffsetBefor:Yl.OffsetAfter}},{key:"JustifySplit",value:function(){return!1}}]),i}(hs);function Zr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var qr=function(t){m()(i,t);var e=Zr(i);function i(t,n,o,s){var a,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return r()(this,i),(a=e.call(this,t,n)).StyleNo=oo.Line,a.FLineHeight=l,a.Width=o,a.Height=s,a.FLineStyle=_t.Solid,a}return l()(i,[{key:"GetOffsetAt",value:function(t){return t<this.Width/2?Yl.OffsetBefor:Yl.OffsetAfter}},{key:"FormatToDrawItem",value:function(t,e){}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){r.pen.width=this.FLineHeight,r.pen.style=this.FLineStyle,r.pen.color=Ft.Black;var l=Math.trunc((e.top+e.bottom)/2);r.drawLineDriect(e.left,l,e.right,l)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FLineHeight=t.LineHeight,this.FLineStyle=t.FLineStyle}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),t.writeByte(this.FLineHeight),t.writeByte(this.FLineStyle)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FLineHeight=t.readByte(),this.FLineStyle=t.readByte()}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.LineHeight&&(this.FLineHeight=t.LineHeight),null!=t.LineStyle&&(this.FLineStyle=t.LineStyle)}},{key:"LineStyle",get:function(){return this.FLineStyle},set:function(t){this.FLineStyle=t}},{key:"LineHeight",get:function(){return this.FLineHeight},set:function(t){this.FLineHeight=t}}]),i}(ss);function $r(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var ta=function(t){m()(i,t);var e=$r(i);function i(t,n,o,s){var a;return r()(this,i),(a=e.call(this,t,n)).StyleNo=oo.Fraction,a.FPadding=5,a.FActiveArea=Xl.None,a.FCaretOffset=-1,a.FLineHide=!1,a.FTopText=o,a.FBottomText=s,a.FTopRect=new nt,a.FBottomRect=new nt,a.FActiveArea=Xl.None,a.FMouseMoveArea=Xl.None,a}return l()(i,[{key:"GetText",value:function(){return f()(F()(i.prototype),"GetText",this).call(this)+this.FTopText+this.FBottomText}},{key:"FormatToDrawItem",value:function(t,e){var i=t.Style;i.ApplyTempStyle(this.TextStyleNo);var n=i.TextStyles[this.TextStyleNo].FontHeight,o=Math.max(i.TempCanvas.textWidth(this.FTopText),this.FPadding),s=Math.max(i.TempCanvas.textWidth(this.FBottomText),this.FPadding);this.Width=o>s?o+4*this.FPadding:s+4*this.FPadding,this.Height=2*n+4*this.FPadding,this.FTopRect.resetBounds(this.FPadding+Math.trunc((this.Width-this.FPadding-this.FPadding-o)/2),this.FPadding,o,n),this.FBottomRect.resetBounds(this.FPadding+Math.trunc((this.Width-this.FPadding-this.FPadding-s)/2),this.Height-this.FPadding-n,s,n)}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){if(!this.Active&&!this.FMouseIn||a.Print||(r.brush.color=Yl.clBtnFace,r.fillRect(e)),this.FLineHide||(r.pen.color=Ft.Black,r.drawLineDriect(e.left+this.FPadding,e.top+this.FTopRect.bottom+this.FPadding,e.left+this.Width-this.FPadding,e.top+this.FTopRect.bottom+this.FPadding)),!a.Print){var l=new nt;this.FActiveArea!=Xl.None&&(this.FActiveArea==Xl.Top?l.resetRect(this.FTopRect):this.FActiveArea==Xl.Bottom&&l.resetRect(this.FBottomRect),l.offset(e.left,e.top),l.inFlate(2,2),r.pen.color=Ft.Blue,r.rectangleRect(l)),this.FMouseMoveArea!=Xl.None&&this.FMouseMoveArea!=this.FActiveArea&&(this.FMouseMoveArea==Xl.Top?l.resetRect(this.FTopRect):this.FMouseMoveArea==Xl.Bottom&&l.resetRect(this.FBottomRect),l.offset(e.left,e.top),l.inFlate(2,2),r.pen.color=Yl.clMedGray,r.rectangleRect(l))}t.TextStyles[this.TextStyleNo].ApplyStyle(r,a.ScaleY/a.Zoom),r.textOut(e.left+this.FTopRect.left,e.top+this.FTopRect.top,this.FTopText),r.textOut(e.left+this.FBottomRect.left,e.top+this.FBottomRect.top,this.FBottomText)}},{key:"SetActive",value:function(t){f()(F()(i.prototype),"SetActive",this).call(this,t),t||(this.FActiveArea=Xl.None)}},{key:"MouseLeave",value:function(){f()(F()(i.prototype),"MouseLeave",this).call(this),this.FMouseMoveArea=Xl.None}},{key:"MouseDown",value:function(t){var e=f()(F()(i.prototype),"MouseDown",this).call(this,t);this.FMouseMoveArea!=this.FActiveArea&&(this.FActiveArea=this.FMouseMoveArea,this.OwnerData.Style.UpdateInfoReCaret());var n="",o=0;this.FActiveArea==Xl.Top?(n=this.FTopText,o=t.x-this.FTopRect.left):this.FActiveArea==Xl.Bottom&&(n=this.FBottomText,o=t.x-this.FBottomRect.left);var s=-1;return this.FActiveArea!=Xl.None&&(this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo),s=Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,n,o)),s!=this.FCaretOffset&&(this.FCaretOffset=s,this.OwnerData.Style.UpdateInfoReCaret()),e}},{key:"MouseMove",value:function(t){var e=f()(F()(i.prototype),"MouseMove",this).call(this,t);if(this.FOutSelectInto)this.FMouseMoveArea=Xl.None;else{var n=this.GetExpressArea(t.x,t.y);n!=this.FMouseMoveArea&&(this.FMouseMoveArea=n,this.OwnerData.Style.UpdateInfoRePaint())}return e}},{key:"WantKeyDown",value:function(t){return!0}},{key:"KeyDown",value:function(t){switch(t.keyCode){case Ee:this.FActiveArea==Xl.Top?this.FCaretOffset>0&&(this.TopText=L.stringDelete(this.FTopText,this.FCaretOffset-1,1),this.FCaretOffset--):this.FActiveArea==Xl.Bottom&&this.FCaretOffset>0&&(this.BottomText=L.stringDelete(this.FBottomText,this.FCaretOffset-1,1),this.FCaretOffset--),this.FormatDirty();break;case Je:this.FCaretOffset>0&&this.FCaretOffset--;break;case Ye:var e="";this.FActiveArea==Xl.Top?e=this.FTopText:this.FActiveArea==Xl.Bottom&&(e=this.FBottomText),this.FCaretOffset<e.length&&this.FCaretOffset++;break;case Xe:this.FActiveArea==Xl.Top?this.FCaretOffset<this.FTopText.length&&(this.TopText=L.stringDelete(this.FTopText,this.FCaretOffset,1)):this.FActiveArea==Xl.Bottom&&this.FCaretOffset<this.FBottomText.length&&(this.BottomText=L.stringDelete(this.FBottomText,this.FCaretOffset,1)),this.FormatDirty();break;case Ke:this.FCaretOffset=0;break;case ze:this.FActiveArea==Xl.Top?this.FCaretOffset=this.FTopText.length:this.FActiveArea==Xl.Bottom&&(this.FCaretOffset=this.FBottomText.length)}}},{key:"KeyPress",value:function(t){if(this.FActiveArea==Xl.None)return 0;this.InsertText(String.fromCharCode(t.keyCode))}},{key:"InsertText",value:function(t){return this.FActiveArea!=Xl.None&&(this.FActiveArea==Xl.Top?this.TopText=L.stringInsert(this.FTopText,this.FCaretOffset,t):this.FActiveArea==Xl.Bottom&&(this.BottomText=L.stringInsert(this.FBottomText,this.FCaretOffset,t)),this.FCaretOffset+=t.length,this.FormatDirty(),!0)}},{key:"GetCaretInfo",value:function(t){this.FActiveArea!=Xl.None&&this.FCaretOffset>=0?(this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo),this.FActiveArea==Xl.Top?(this.FCaretOffset<0&&(this.FCaretOffset=0),t.Height=this.FTopRect.bottom-this.FTopRect.top,t.X=this.FTopRect.left+this.OwnerData.Style.TempCanvas.textWidth(this.FTopText.substr(0,this.FCaretOffset)),t.Y=this.FTopRect.top):this.FActiveArea==Xl.Bottom&&(this.FCaretOffset<0&&(this.FCaretOffset=0),t.Height=this.FBottomRect.bottom-this.FBottomRect.top,t.X=this.FBottomRect.left+this.OwnerData.Style.TempCanvas.textWidth(this.FBottomText.substr(0,this.FCaretOffset)),t.Y=this.FBottomRect.top)):t.Visible=!1}},{key:"GetExpressArea",value:function(t,e){return this.FTopRect.pointInAt(t,e)?Xl.Top:this.FBottomRect.pointInAt(t,e)?Xl.Bottom:Xl.None}},{key:"TopRect",get:function(){return this.FTopRect},set:function(t){this.FTopRect=t}},{key:"BottomRect",get:function(){return this.FBottomRect},set:function(t){this.FBottomRect=t}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FTopText=t.TopText,this.FBottomText=t.BottomText}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.FTopText),Yl.HCSaveTextToStream(t,this.FBottomText)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FTopText=Yl.HCLoadTextFromStream(t,n),this.FBottomText=Yl.HCLoadTextFromStream(t,n)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"TopText":"'+this.TopText+'","BottomText":"'+this.BottomText+'"'}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t)}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t)}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.TopText&&(this.FTopText=t.TopText),null!=t.BottomText&&(this.FBottomText=t.BottomText)}},{key:"Padding",get:function(){return this.FPadding}},{key:"LineHide",get:function(){return this.FLineHide},set:function(t){this.FLineHide=t}},{key:"TopText",get:function(){return this.FTopText},set:function(t){this.FTopText=t,this.DoChange()}},{key:"BottomText",get:function(){return this.FBottomText},set:function(t){this.FBottomText=t,this.DoChange()}},{key:"ActiveArea",get:function(){return this.FActiveArea}}]),i}(hs);function ea(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var ia=function(t){m()(i,t);var e=ea(i);function i(t,n,o,s){var a;return r()(this,i),(a=e.call(this,t,n,o,s)).StyleNo=oo.Fraction2,a}return l()(i,[{key:"FormatToDrawItem",value:function(t,e){var i=t.Style;i.ApplyTempStyle(this.TextStyleNo);var n=i.TempCanvas.textExtent("H"),o=i.TempCanvas.textWidth(this.FTopText),s=i.TempCanvas.textWidth(this.FBottomText);this.Width=Math.max(o,n.width)+Math.max(s,n.width),this.Height=n.height+n.height,this.FTopRect.resetBounds(0,0,Math.max(n.width,o),n.height),this.FBottomRect.resetBounds(Math.max(n.width,o),this.Height-n.height,Math.max(n.width,s),n.height)}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){!this.Active&&!this.FMouseIn||a.Print||(r.brush.color=Yl.clBtnFace,r.fillRect(e)),t.TextStyles[this.TextStyleNo].ApplyStyle(r,a.ScaleY/a.Zoom);var l=r.textExtent("H");if(this.FLineHide||(r.pen.color=Ft.Black,r.drawLineDriect(e.left+this.FTopRect.right+l.width,e.top,e.left+this.FTopRect.right-l.width,e.top+this.Height)),!a.Print){var h=new nt;this.FActiveArea!=Xl.None&&(this.FActiveArea==Xl.Top?h.resetRect(this.FTopRect):this.FActiveArea==Xl.Bottom&&h.resetRect(this.FBottomRect),h.offset(e.left,e.top),h.inFlate(2,2),r.pen.color=Ft.Blue,r.rectangleRect(h)),this.FMouseMoveArea!=Xl.None&&this.FMouseMoveArea!=this.FActiveArea&&(this.FMouseMoveArea==Xl.Top?h.resetRect(this.FTopRect):this.FMouseMoveArea==Xl.Bottom&&h.resetRect(this.FBottomRect),h.offset(e.left,e.top),h.inFlate(2,2),r.pen.color=Yl.clMedGray,r.rectangleRect(h))}r.textOut(e.left+this.FTopRect.left,e.top+this.FTopRect.top,this.FTopText),r.textOut(e.left+this.FBottomRect.left,e.top+this.FBottomRect.top,this.FBottomText)}}]),i}(ta),na=function(t){m()(i,t);var e=ea(i);function i(t,n,o,s,a,l){var h;return r()(this,i),(h=e.call(this,t,n,s,l)).StyleNo=oo.Express,h.FLeftText=o,h.FRightText=a,h.FLeftRect=new nt,h.FRightRect=new nt,h}return l()(i,[{key:"GetText",value:function(){return f()(F()(i.prototype),"GetText",this).call(this)+this.FLeftText+this.FRightText}},{key:"FormatToDrawItem",value:function(t,e){var i=t.Style;i.ApplyTempStyle(this.TextStyleNo);var n=i.TempCanvas.textHeight("H"),o=Math.max(i.TempCanvas.textWidth(this.FLeftText),this.Padding),s=Math.max(i.TempCanvas.textWidth(this.TopText),this.Padding),r=Math.max(i.TempCanvas.textWidth(this.FRightText),this.Padding),a=Math.max(i.TempCanvas.textWidth(this.BottomText),this.Padding);this.Width=s>a?o+s+r+6*this.Padding:o+a+r+6*this.Padding,this.Height=2*n+4*this.Padding,this.FLeftRect.resetBounds(this.Padding,Math.trunc((this.Height-n)/2),o,n),this.FRightRect.resetBounds(this.Width-this.Padding-r,Math.trunc((this.Height-n)/2),r,n),this.TopRect.resetBounds(this.FLeftRect.right+this.Padding+Math.trunc((this.FRightRect.left-this.Padding-(this.FLeftRect.right+this.Padding)-s)/2),this.Padding,s,n),this.BottomRect.resetBounds(this.FLeftRect.right+this.Padding+Math.trunc((this.FRightRect.left-this.Padding-(this.FLeftRect.right+this.Padding)-a)/2),this.Height-this.Padding-n,a,n)}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){if(!this.Active&&!this.FMouseIn||a.Print||(r.brush.color=Yl.clBtnFace,r.fillRect(e)),r.pen.color=Ft.Black,r.drawLineDriect(e.left+this.FLeftRect.right+this.Padding,e.top+this.TopRect.bottom+this.Padding,e.left+this.FRightRect.left-this.Padding,e.top+this.TopRect.bottom+this.Padding),!a.Print){var l=new nt;if(this.FActiveArea!=Xl.None){switch(this.FActiveArea){case Xl.Left:l.resetRect(this.FLeftRect);break;case Xl.Top:l.resetRect(this.TopRect);break;case Xl.Right:l.resetRect(this.FRightRect);break;case Xl.Bottom:l.resetRect(this.BottomRect)}l.offset(e.left,e.top),l.inFlate(2,2),r.pen.color=Ft.Blue,r.rectangleRect(l)}if(this.FMouseMoveArea!=Xl.None&&this.FMouseMoveArea!=this.FActiveArea){switch(this.FMouseMoveArea){case Xl.Left:l.resetRect(this.FLeftRect);break;case Xl.Top:l.resetRect(this.TopRect);break;case Xl.Right:l.resetRect(this.FRightRect);break;case Xl.Bottom:l.resetRect(this.BottomRect)}l.offset(e.left,e.top),l.inFlate(2,2),r.pen.color=Yl.clMedGray,r.rectangleRect(l)}}t.TextStyles[this.TextStyleNo].ApplyStyle(r,a.ScaleY/a.Zoom),r.textOut(e.left+this.FLeftRect.left,e.top+this.FLeftRect.top,this.FLeftText),r.textOut(e.left+this.TopRect.left,e.top+this.TopRect.top,this.TopText),r.textOut(e.left+this.FRightRect.left,e.top+this.FRightRect.top,this.FRightText),r.textOut(e.left+this.BottomRect.left,e.top+this.BottomRect.top,this.BottomText)}},{key:"MouseDown",value:function(t){var e=f()(F()(i.prototype),"MouseDown",this).call(this,t);this.FMouseMoveArea!=this.FActiveArea&&(this.FActiveArea=this.FMouseMoveArea,this.OwnerData.Style.UpdateInfoReCaret());var n="",o=0;switch(this.FActiveArea){case Xl.Left:n=this.FLeftText,o=t.x-this.FLeftRect.left;break;case Xl.Top:n=this.TopText,o=t.x-this.TopRect.left;break;case Xl.Right:n=this.FRightText,o=t.x-this.FRightRect.left;break;case Xl.Bottom:n=this.BottomText,o=t.x-this.BottomRect.left}var s=0;return this.FActiveArea!=Xl.None?(this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo),s=Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,n,o)):s=-1,s!=this.FCaretOffset&&(this.FCaretOffset=s,this.OwnerData.Style.UpdateInfoReCaret()),e}},{key:"KeyDown",value:function(t){if(this.FActiveArea==Xl.Left||this.FActiveArea==Xl.Right)switch(t.keyCode){case Ee:this.FActiveArea==Xl.Left?this.FCaretOffset>0&&(this.LeftText=L.stringDelete(this.FLeftText,this.FCaretOffset-1,1),this.FCaretOffset--):this.FCaretOffset>0&&(this.RightText=L.stringDelete(this.FRightText,this.FCaretOffset-1,1),this.FCaretOffset--),this.FormatDirty();break;case Je:this.FCaretOffset>0&&this.FCaretOffset--;break;case Ye:var e=this.FRightText;this.FActiveArea==Xl.Left&&(e=this.FLeftText),this.FCaretOffset<e.length&&this.FCaretOffset++;break;case Xe:this.FActiveArea==Xl.Left?this.FCaretOffset<this.FLeftText.length&&(this.LeftText=L.stringDelete(this.FLeftText,this.FCaretOffset,1)):this.FCaretOffset<this.FRightText.length&&(this.RightText=L.stringDelete(this.FRightText,this.FCaretOffset,1)),this.FormatDirty();break;case Ke:this.FCaretOffset=0;break;case ze:this.FActiveArea==Xl.Left?this.FCaretOffset=this.FLeftText.length:this.FCaretOffset=this.FRightText.length}else f()(F()(i.prototype),"KeyDown",this).call(this,t)}},{key:"GetExpressArea",value:function(t,e){var n=f()(F()(i.prototype),"GetExpressArea",this).call(this,t,e);return n==Xl.None?this.FLeftRect.pointInAt(t,e)?Xl.Left:this.FRightRect.pointInAt(t,e)?Xl.Right:n:n}},{key:"InsertText",value:function(t){if(this.FActiveArea==Xl.None)return!1;switch(this.FActiveArea){case Xl.Left:return this.LeftText=L.stringInsert(this.FLeftText,this.FCaretOffset,t),this.FCaretOffset+=t.length,this.FormatDirty(),!0;case Xl.Right:return this.RightText=L.stringInsert(this.FRightText,this.FCaretOffset,t),this.FCaretOffset+=t.length,this.FormatDirty(),!0;default:return f()(F()(i.prototype),"InsertText",this).call(this,t)}}},{key:"GetCaretInfo",value:function(t){if(this.FActiveArea!=Xl.None)switch(this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo),this.FActiveArea){case Xl.Left:this.FCaretOffset<0&&(this.FCaretOffset=0),t.Height=this.FLeftRect.bottom-this.FLeftRect.top,t.X=this.FLeftRect.left+this.OwnerData.Style.TempCanvas.textWidth(this.FLeftText.substr(0,this.FCaretOffset)),t.Y=this.FLeftRect.top;break;case Xl.Top:this.FCaretOffset<0&&(this.FCaretOffset=0),t.Height=this.TopRect.bottom-this.TopRect.top,t.X=this.TopRect.left+this.OwnerData.Style.TempCanvas.textWidth(this.TopText.substr(0,this.FCaretOffset)),t.Y=this.TopRect.top;break;case Xl.Right:this.FCaretOffset<0&&(this.FCaretOffset=0),t.Height=this.FRightRect.bottom-this.FRightRect.top,t.X=this.FRightRect.left+this.OwnerData.Style.TempCanvas.textWidth(this.FRightText.substr(0,this.FCaretOffset)),t.Y=this.FRightRect.top;break;case Xl.Bottom:this.FCaretOffset<0&&(this.FCaretOffset=0),t.Height=this.BottomRect.bottom-this.BottomRect.top,t.X=this.BottomRect.left+this.OwnerData.Style.TempCanvas.textWidth(this.BottomText.substr(0,this.FCaretOffset)),t.Y=this.BottomRect.top}else t.Visible=!1}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FLeftText=t.LeftText,this.FRightText=t.RightText}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.FLeftText),Yl.HCSaveTextToStream(t,this.FRightText)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FLeftText=Yl.HCLoadTextFromStream(t,n),this.FRightText=Yl.HCLoadTextFromStream(t,n)}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.LeftText&&(this.FLeftText=t.LeftText),null!=t.RightText&&(this.FRightText=t.RightText)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"LeftText":"'+this.LeftText+'","RightText":"'+this.RightText+'"'}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t)}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t)}},{key:"LeftRect",get:function(){return this.FLeftRect},set:function(t){this.FLeftRect=t}},{key:"RightRect",get:function(){return this.FRightRect},set:function(t){this.FRightRect=t}},{key:"LeftText",get:function(){return this.FLeftText},set:function(t){this.FLeftText=t,this.FActiveArea===Xl.Left&&this.FCaretOffset>this.FLeftText.length&&(this.FCaretOffset=this.FLeftText.length),this.DoChange()}},{key:"RightText",get:function(){return this.FRightText},set:function(t){this.FRightText=t,this.FActiveArea===Xl.Right&&this.FCaretOffset>this.FRightText.length&&(this.FCaretOffset=this.FRightText.length),this.DoChange()}}]),i}(ta);function oa(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var sa=function(t){m()(i,t);var e=oa(i);function i(t,n,o,s){var a;return r()(this,i),(a=e.call(this,t,n)).StyleNo=oo.CheckBox,a.FChecked=s,a.FText=o,a.FPaddingLeft=2,a.ItemHit=!1,a.BoxRight=!1,a.AutoWrap=!1,a.CheckBoxSize=14,a.OnCheckChanged=null,a}return l()(i,[{key:"GetBoxRect",value:function(){return this.BoxRight?nt.CreateByBounds(this.Width-this.FPaddingLeft-this.CheckBoxSize,Math.trunc((this.Height-this.CheckBoxSize)/2),this.CheckBoxSize,this.CheckBoxSize):nt.CreateByBounds(this.FPaddingLeft,Math.trunc((this.Height-this.CheckBoxSize)/2),this.CheckBoxSize,this.CheckBoxSize)}},{key:"SetChecked",value:function(t){this.FChecked!=t&&(this.FChecked=t,this.DoChange(),null!=this.OnCheckChanged&&this.OnCheckChanged(this))}},{key:"DoSetChecked",value:function(t){this.SetChecked(t),this.DoItemChange(Yl.OffsetInner,rh.ContentChange)}},{key:"GetText",value:function(){return this.FText}},{key:"SetText",value:function(t){this.FText=t,f()(F()(i.prototype),"SetText",this).call(this,t)}},{key:"TextEffective",value:function(){return this.FChecked?this.FText:""}},{key:"MouseMove",value:function(t){return this.OwnerData.Style.Cursor=pe,f()(F()(i.prototype),"MouseMove",this).call(this,t)}},{key:"MouseUp",value:function(t){return this.Enabled&&this.OwnerData.CanEdit()&&!this.OwnerData.Style.UpdateInfo.Selecting&&(this.ItemHit?nt.CreateByBounds(0,0,this.Width,this.Height).pointInAt(t.x,t.y)&&this.DoSetChecked(!this.FChecked):this.GetBoxRect().pointInAt(t.x,t.y)&&this.DoSetChecked(!this.FChecked)),f()(F()(i.prototype),"MouseUp",this).call(this,t)}},{key:"FormatToDrawItem",value:function(t,e){if(this.AutoSize){t.Style.ApplyTempStyle(this.TextStyleNo);var i=t.Style.TempCanvas.textMetric(this.FText);this.Width=this.FPaddingLeft+this.CheckBoxSize+this.FPaddingLeft+i.width,this.Height=Math.max(i.height,this.CheckBoxSize)}else if(this.AutoWrap){t.Style.ApplyTempStyle(this.TextStyleNo);var n=Yl.LineCountWithWidth(this.FText,this.Width-this.FPaddingLeft-this.CheckBoxSize-this.FPaddingLeft,t.Style.TempCanvas,null);this.Height=n*(t.Style.TempCanvas.font.height+5)-5}this.Width<this.FMinWidth&&(this.Width=this.FMinWidth),this.Height<this.FMinHeight&&(this.Height=this.FMinHeight)}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l);var h=this.GetBoxRect();h.offset(e.left,e.top),l.Print||(this.IsSelectComplate?(a.brush.color=t.SelColor,a.fillRect(e)):this.FMouseIn&&(a.brush.color=Yl.clBtnFace,a.fillRect(e))),this.FChecked?this.hcl.theme.drawFrameControl(a,h,new Set([Pi]),bi):this.hcl.theme.drawFrameControl(a,h,new Set([]),bi);var c=e.left+this.FPaddingLeft+this.CheckBoxSize+this.FPaddingLeft;if(this.BoxRight&&(c=e.left),t.TextStyles[this.TextStyleNo].ApplyStyle(a,l.ScaleY/l.Zoom),!this.AutoSize&&this.AutoWrap){var u=new at;Yl.LineCountWithWidth(this.Text,this.Width-this.FPaddingLeft-this.CheckBoxSize-this.FPaddingLeft,a,u);for(var d=e.top,m=0;m<u.length;m++)a.textOut(c,d,u[m]),d+=a.font.height+5}else a.textOut(c,Math.trunc(e.top+(this.Height-a.font.height)/2),this.FText)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FChecked=t.Checked,this.FText=t.Text}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FChecked&&(o|=128),this.BoxRight&&(o|=64),this.ItemHit&&(o|=32),this.AutoWrap&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,this.FText)}},{key:"LoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),n>51){var o=t.readByte();this.FChecked=L.isOdd(o>>7),this.BoxRight=L.isOdd(o>>6),this.ItemHit=L.isOdd(o>>5),this.AutoWrap=n>62&&L.isOdd(o>>4)}else this.FChecked=t.readBoolean();this.FText=Yl.HCLoadTextFromStream(t,n)}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t)}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Checked":'+(this.FChecked?"true":"false")}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.Checked&&(this.FChecked=t.Checked)}},{key:"Checked",get:function(){return this.FChecked},set:function(t){this.SetChecked(t)}}]),i}(cs);function ra(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var aa=function(t){m()(i,t);var e=ra(i);function i(){return r()(this,i),e.apply(this,arguments)}return l()(i)}(gs);function la(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var ha=function(t){m()(i,t);var e=la(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,n)).StyleNo=oo.Edit,s.FText=o,s.FTextAlignHorz=as.Left,s.FBorderWidth=1,s.FReadOnly=!1,s.FPrintOnlyText=!1,s.FCaretOffset=-1,s.FSelEnd=-1,s.FSelMove=-1,s.FLeftOffset=0,s.FAlignLeft=0,s.FPaddingLeft=4,s.FPaddingRight=4,s.FPaddingTop=4,s.FPaddingBottom=4,s.Width=50,s.FTextSize=null,s.FBorderSides=new uh,s.FBorderSides.add(Zl.Left),s.FBorderSides.add(Zl.Top),s.FBorderSides.add(Zl.Right),s.FBorderSides.add(Zl.Bottom),s.OnActivate=null,s.OnDeactivate=null,s.CalcSize(),s}return l()(i,[{key:"CalcTextSize",value:function(){this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo),""!=this.FText?this.FTextSize=this.OwnerData.Style.TempCanvas.textMetric(this.FText):this.FTextSize=this.OwnerData.Style.TempCanvas.textMetric("H")}},{key:"CalcSize",value:function(){this.CalcTextSize(),this.AutoSize&&(this.Width=this.FPaddingLeft+this.FTextSize.width+this.FPaddingRight,this.Height=this.FPaddingTop+this.FTextSize.height+this.FPaddingBottom),this.Width<this.FMinWidth&&(this.Width=this.FMinWidth),this.Height<this.FMinHeight&&(this.Height=this.FMinHeight)}},{key:"ScrollAdjust",value:function(t){if(this.AutoSize)this.FLeftOffset=0;else if(this.FTextSize.width+this.FPaddingLeft<=this.Width-this.FPaddingRight)this.FLeftOffset=0;else if(this.FTextSize.width+this.FPaddingLeft-this.FLeftOffset<this.Width-this.FPaddingRight)this.FLeftOffset=this.FLeftOffset-(this.Width-this.FPaddingLeft-this.FTextSize.width+this.FLeftOffset-this.FPaddingRight);else{this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo);var e=this.FText.substr(0,t),i=this.OwnerData.Style.TempCanvas.textWidth(e)+this.FPaddingLeft+this.FAlignLeft-this.FLeftOffset;i>this.Width-this.FPaddingRight?this.FLeftOffset=this.FLeftOffset+i-this.Width+this.FPaddingRight:i<0&&(this.FLeftOffset=this.FLeftOffset+i)}}},{key:"GetCharDrawLeft",value:function(t){var e=0;return t>0&&(t==this.FText.length?e=this.Width:(this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo),e=this.FPaddingLeft+this.FAlignLeft+this.OwnerData.Style.TempCanvas.textWidth(this.FText.substr(0,t))-this.FLeftOffset)),e}},{key:"OffsetInSelect",value:function(t){return t>=this.FCaretOffset&&t<=this.FSelEnd}},{key:"DeleteSelectText",value:function(){this.FText=L.stringDelete(this.FText,this.FCaretOffset,this.FSelEnd-this.FCaretOffset),this.FSelEnd=-1,this.FSelMove=this.FCaretOffset,this.CalcTextSize(),this.DoChange()}},{key:"DisSelectText",value:function(){this.FSelMove=this.FCaretOffset,this.SelectTextExists()&&(this.FSelEnd=-1)}},{key:"GetReadOnly",value:function(){return this.FReadOnly}},{key:"SetReadOnly",value:function(t){this.FReadOnly!=t&&(this.FReadOnly=t)}},{key:"FormatToDrawItem",value:function(t,e){switch(this.CalcSize(),this.FTextAlignHorz){case as.Center:this.FAlignLeft=Math.trunc((this.Width-this.FPaddingLeft-this.FTextSize.width-this.FPaddingRight)/2);break;case as.Right:this.FAlignLeft=this.Width-this.FPaddingLeft-this.FTextSize.width-this.FPaddingRight;break;default:this.FAlignLeft=0}}},{key:"DoPaintBackground",value:function(t,e,i,n,o,s,r,a){if(!a.Print&&(this.IsSelectComplate?(r.brush.color=t.SelColor,r.fillRect(e)):this.FReadOnly?(r.brush.color=t.RectReadOnlyColor,r.fillRect(e)):this.Active||this.FMouseIn&&(r.brush.color=t.RectHotBKColor,r.fillRect(e)),this.SelectTextExists())){r.brush.color=t.SelColor;var l=this.GetCharDrawLeft(this.FCaretOffset),h=this.GetCharDrawLeft(this.FSelEnd);l=Math.max(0,Math.min(l,this.Width)),h=Math.max(0,Math.min(h,this.Width)),r.fillRect(nt.Create(e.left+l,e.top,e.left+h,e.bottom))}}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){if(f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l),t.TextStyles[this.TextStyleNo].ApplyStyle(a,l.ScaleY/l.Zoom),this.AutoSize?a.textOut(e.left+this.FPaddingLeft+this.FAlignLeft,e.top+this.FPaddingTop,this.FText):a.textRect(e,e.left+this.FPaddingLeft+this.FAlignLeft-this.FLeftOffset,e.top+this.FPaddingTop,this.FText),(!l.Print||!this.FPrintOnlyText)&&this.FBorderSides.value>0){!l.Print&&this.Active?a.pen.color=t.RectActiveBorderColor:a.pen.color=Ft.Black,a.pen.width=this.FBorderWidth,a.pen.style=_t.Solid,a.beginPath();try{this.FBorderSides.has(Zl.Left)&&a.drawLine(e.left,e.top,e.left,e.bottom),this.FBorderSides.has(Zl.Top)&&a.drawLine(e.left,e.top,e.right,e.top),this.FBorderSides.has(Zl.Right)&&a.drawLine(e.right-1,e.top,e.right-1,e.bottom),this.FBorderSides.has(Zl.Bottom)&&a.drawLine(e.left,e.bottom-1,e.right,e.bottom-1)}finally{a.paintPath()}}}},{key:"GetOffsetAt",value:function(t){return t<=this.FPaddingLeft?Yl.OffsetBefor:t>=this.Width?Yl.OffsetAfter:Yl.OffsetInner}},{key:"SetActive",value:function(t){var e=this.Active;f()(F()(i.prototype),"SetActive",this).call(this,t),t||(this.DisSelectText(),this.FLeftOffset=0,this.FCaretOffset=-1),e!=this.Active&&(e&&null!=this.OnDeactivate?this.OnDeactivate(this):e||null==this.OnActivate||this.OnActivate(this,null))}},{key:"MouseDown",value:function(t){var e=f()(F()(i.prototype),"MouseDown",this).call(this,t);if(!this.Active)return e;this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo);var n=Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,this.FText,t.x-this.FPaddingLeft-this.FAlignLeft+this.FLeftOffset);if(t.button==ae)this.DisSelectText();else{if(this.OffsetInSelect(n))return e;this.DisSelectText()}return n!=this.FCaretOffset&&(this.FCaretOffset=n,this.FSelMove=n,this.ScrollAdjust(n),this.OwnerData.Style.UpdateInfoReCaret()),e}},{key:"MouseMove",value:function(t){var e=f()(F()(i.prototype),"MouseMove",this).call(this,t);return t.button==ae&&(t.x<0?this.FLeftOffset=Math.max(this.FAlignLeft,this.FLeftOffset-this.OwnerData.Style.TextStyles[this.TextStyleNo].TextMetric_tmAveCharWidth):t.x>this.Width-this.FPaddingRight&&(this.FLeftOffset=Math.max(this.FAlignLeft,Math.min(this.FTextSize.width-this.Width+this.FPaddingRight+this.FAlignLeft,this.FLeftOffset+this.OwnerData.Style.TextStyles[this.TextStyleNo].TextMetric_tmAveCharWidth))),this.FSelEnd=Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,this.FText,t.x-this.FPaddingLeft-this.FAlignLeft+this.FLeftOffset),this.FSelMove=this.FSelEnd,!this.SelectTextExists()&&this.FSelEnd>=0&&(this.FSelEnd=-1,this.FSelMove=this.FCaretOffset),this.ScrollAdjust(this.FSelMove)),e}},{key:"MouseUp",value:function(t){if(t.button==ae&&this.FSelEnd>=0&&this.FSelEnd<this.FCaretOffset){var e=this.FCaretOffset;this.FCaretOffset=this.FSelEnd,this.FSelEnd=e}return this.OwnerData.Style.UpdateInfo.DragingSelected&&this.DisSelect(),f()(F()(i.prototype),"MouseUp",this).call(this,t)}},{key:"WantKeyDown",value:function(t){var e=!1;return t.keyCode===Je?0===this.FCaretOffset?this.FCaretOffset=-1:this.FCaretOffset<0?(this.FCaretOffset=this.FText.length,this.ScrollAdjust(this.FCaretOffset),this.OwnerData.Style.UpdateInfoRePaint(),e=!0):e=!0:t.keyCode===Ye?this.FCaretOffset===this.FText.length?this.FCaretOffset=-1:this.FCaretOffset<0?(this.FCaretOffset=0,this.ScrollAdjust(this.FCaretOffset),this.OwnerData.Style.UpdateInfoRePaint(),e=!0):e=!0:e=!0,e}},{key:"KeyDown",value:function(t){if(this.Enabled&&!this.FReadOnly)switch(t.keyCode){case Ee:this.SelectTextExists()?this.DeleteSelectText():this.FCaretOffset>0&&(this.FText=L.stringDelete(this.FText,this.FCaretOffset-1,1),this.FCaretOffset--),this.ScrollAdjust(this.FCaretOffset),this.FormatDirty(),this.DoItemChange(Yl.OffsetInner,rh.ContentChange);break;case Je:this.DisSelectText(),this.FCaretOffset>0&&this.FCaretOffset--,this.ScrollAdjust(this.FCaretOffset),this.OwnerData.Style.UpdateInfoRePaint();break;case Ye:this.DisSelectText(),this.FCaretOffset<this.FText.length&&this.FCaretOffset++,this.ScrollAdjust(this.FCaretOffset),this.OwnerData.Style.UpdateInfoRePaint();break;case Xe:this.SelectTextExists()?this.DeleteSelectText():this.FCaretOffset<this.FText.length&&(this.FText=L.stringDelete(this.FText,this.FCaretOffset,1)),this.ScrollAdjust(this.FCaretOffset),this.FormatDirty(),this.DoItemChange(Yl.OffsetInner,rh.ContentChange);break;case Ke:this.FCaretOffset=0,this.ScrollAdjust(this.FCaretOffset);break;case ze:this.FCaretOffset=this.FText.length,this.ScrollAdjust(this.FCaretOffset)}f()(F()(i.prototype),"KeyDown",this).call(this,t)}},{key:"KeyPress",value:function(t){this.Enabled&&!this.FReadOnly&&(this.SelectTextExists()&&this.DeleteSelectText(),this.FText=L.stringInsert(this.FText,this.FCaretOffset,String.fromCharCode(t.keyCode)),this.FCaretOffset++,this.ScrollAdjust(this.FCaretOffset),this.FormatDirty(),this.DoItemChange(Yl.OffsetInner,rh.ContentChange)),f()(F()(i.prototype),"KeyPress",this).call(this,t)}},{key:"InsertText",value:function(t){return this.FText=L.stringInsert(this.FText,this.FCaretOffset,t),this.FCaretOffset+=t.length,this.ScrollAdjust(this.FCaretOffset),this.FormatDirty(),this.DoItemChange(Yl.OffsetInner,rh.ContentChange),!0}},{key:"InsertStream",value:function(t,e,i){return!!this.OwnerData.Style.States.Contain(oh.Pasting)&&this.InsertText(this.hcl.clipboard.toString())}},{key:"GetCaretInfo",value:function(t){if(this.FCaretOffset<0)t.Visible=!1;else if(this.SelectTextExists())t.Visible=!1;else{var e=this.FText.substring(0,this.FCaretOffset);if(this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo),""!=e){var i=this.OwnerData.Style.TempCanvas.textMetric(e);t.Height=i.height,t.X=this.FPaddingLeft+this.FAlignLeft-this.FLeftOffset+i.width}else t.Height=this.OwnerData.Style.TextStyles[this.TextStyleNo].FontHeight,t.X=this.FPaddingLeft+this.FAlignLeft-this.FLeftOffset;t.Y=this.FPaddingTop,!this.AutoSize&&t.X>this.Width&&(t.Visible=!1)}}},{key:"GetText",value:function(){return this.FText}},{key:"SetText",value:function(t){this.FReadOnly||this.FText==t||(this.FText=t,this.FCaretOffset>this.FText.length&&(this.FCaretOffset=0),this.AutoSize?this.OwnerData.ItemReFormatRequest(this):this.OwnerData.Style.UpdateInfoRePaint(),f()(F()(i.prototype),"SetText",this).call(this,t))}},{key:"SetTextAlignHorz",value:function(t){this.FTextAlignHorz!=t&&(this.FTextAlignHorz=t,this.ReFormatRequest())}},{key:"SetSelect",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return this.FCaretOffset=t,this.FSelMove=this.FCaretOffset,this.FSelEnd=e,!0}},{key:"SelectTextExists",value:function(){return this.FCaretOffset>=0&&this.FSelEnd>=0&&this.FSelEnd!==this.FCaretOffset}},{key:"CoordInSelect",value:function(t,e){return this.SelectExists()&&nt.CreateByBounds(0,0,this.Width,this.Height).pointInAt(t,e)}},{key:"SelectExists",value:function(){return f()(F()(i.prototype),"SelectExists",this).call(this)||this.SelectTextExists()}},{key:"IsSelectComplateTheory",value:function(){return this.IsSelectComplate}},{key:"DeleteSelected",value:function(){var t=f()(F()(i.prototype),"DeleteSelected",this).call(this);return this.SelectTextExists()&&(this.DeleteSelectText(),t=!0),t}},{key:"DisSelect",value:function(){this.DisSelectText(),f()(F()(i.prototype),"DisSelect",this).call(this)}},{key:"SaveSelectToText",value:function(){return this.SelectTextExists()?this.FText.substr(this.FCaretOffset,this.FSelEnd-this.FCaretOffset):this.IsSelectComplate?this.FText:f()(F()(i.prototype),"SaveSelectToText",this).call(this)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FText=t.Text,this.FReadOnly=t.ReadOnly,this.FPrintOnlyText=t.PrintOnlyText,this.FBorderSides.Value=t.BorderSides.Value,this.FBorderWidth=t.BorderWidth}},{key:"Undo",value:function(t){f()(F()(i.prototype),"Undo",this).call(this,t),this.FCaretOffset>this.FText.length&&(this.FCaretOffset=-1)}},{key:"Clear",value:function(){this.Text=""}},{key:"ReFormatRequest",value:function(){f()(F()(i.prototype),"ReFormatRequest",this).call(this)}},{key:"ReCaretRequest",value:function(){this.FCaretOffset=0,this.FSelMove=0,this.ScrollAdjust(0),f()(F()(i.prototype),"ReCaretRequest",this).call(this)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.FText);var o=0;this.FReadOnly&&(o|=128),this.FPrintOnlyText&&(o|=64),t.writeByte(o),t.writeByte(this.FBorderSides.value),t.writeByte(this.FBorderWidth),t.writeByte(this.FTextAlignHorz)}},{key:"LoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FText=Yl.HCLoadTextFromStream(t,n),n>33){var o=t.readByte();this.FReadOnly=L.isOdd(o>>7),this.FPrintOnlyText=L.isOdd(o>>6)}else this.FReadOnly=t.readBoolean(),this.FPrintOnlyText=!1;n>15&&(this.FBorderSides.value=t.readByte(),this.FBorderWidth=t.readByte()),n>56&&(this.FTextAlignHorz=t.readByte())}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t)}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t)}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.Text&&(this.FText=t.Text),null!=t.BorderWidth&&(this.FBorderWidth=t.BorderWidth),null!=t.TextAlignHorz&&(this.FTextAlignHorz=t.TextAlignHorz),t.PrintOnlyText&&(this.FPrintOnlyText=t.PrintOnlyText),t.ReadOnly&&(this.ReadOnly=t.ReadOnly)}},{key:"ReadOnly",get:function(){return this.GetReadOnly()},set:function(t){this.SetReadOnly(t)}},{key:"PrintOnlyText",get:function(){return this.FPrintOnlyText},set:function(t){this.FPrintOnlyText=t}},{key:"BorderSides",get:function(){return this.FBorderSides},set:function(t){this.FBorderSides=t}},{key:"BorderWidth",get:function(){return this.FBorderWidth},set:function(t){this.FBorderWidth=t}},{key:"TextAlignHorz",get:function(){return this.FTextAlignHorz},set:function(t){this.SetTextAlignHorz(t)}}]),i}(cs);function ca(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var ua=l()((function t(){r()(this,t),this.Text="",this.Code="",this.ID="",this.Value=""})),fa=function(t){m()(i,t);var e=ca(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,n,o)).StyleNo=oo.Combobox,s.BTNWIDTH=16,s.BTNMARGIN=1,s.FPaddingRight=s.BTNWIDTH,s.Width=80,s.FSaveItem=!0,s.FStatic=!1,s.FItemIndex=-1,s.FItems=new ot,s.FButtonDrawRect=new nt,s.FButtonRect=new nt,s.FMouseInButton=!1,s.PopupAutoWidth=!1,s.OnPopupItem=null,s._popupControl=null,s._dropDownCount=8,s._popupAlign=Qt,s._listBox=new dn(t),s._listBox.width=80,s._listBox.onUpdate=function(t){s._listBoxUpdate(t)},s._listBox.onSelectedIndexChange=function(){s.FItemIndex=s._listBox.itemIndex,s.Text=s._listBox.text,s.DoItemIndexChanged(),s.DoItemChange(Yl.OffsetInner,rh.ContentChange)},s.OnItemIndexChanged=null,s}return l()(i,[{key:"_listBoxUpdate",value:function(t){null!=this._popupControl&&this._popupControl.updateRect(t)}},{key:"FormatToDrawItem",value:function(t,e){f()(F()(i.prototype),"FormatToDrawItem",this).call(this,t,e),this.FButtonRect.resetBounds(this.Width-this.BTNMARGIN-this.BTNWIDTH,this.BTNMARGIN,this.BTNWIDTH,this.Height-this.BTNMARGIN-this.BTNMARGIN),this._listBox.width=this.Width}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){if(f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l),this.FButtonDrawRect.resetRect(this.FButtonRect),this.FButtonDrawRect.offset(e.left,e.top),!l.Print){this.IsSelectComplate?a.brush.color=t.SelColor:this.FMouseInButton?a.brush.color=Yl.clMenu:a.brush.color=Yl.clWindow,a.fillRect(this.FButtonDrawRect),a.pen.color=Ft.Black,a.pen.style=_t.Solid;var h=this.FButtonDrawRect.left+Math.trunc((this.BTNWIDTH-7)/2),c=this.FButtonDrawRect.top+Math.trunc((this.FButtonDrawRect.height-4)/2);a.beginPath();try{for(var u=0;u<=3;u++)a.drawLine(h,c,h+7-u-u,c),h++,c++}finally{a.paintPath()}}}},{key:"DoPopup",value:function(){var t=this;if(null!=this.OnPopupItem){var e=this.OnPopupItem(this);if(e&&e.stopPopup)return}if(null==this._popupControl){if(this.PopupAutoWidth){for(var i=0,n=0,o=0,s=this._listBox.items.count;o<s;o++)this._listBox.items[o].text.length>n&&(n=this._listBox.items[o].text.length,i=o);if(n>0){this.OwnerData.Style.TempCanvas.save();try{this.OwnerData.Style.TempCanvas.font.size=this._listBox.font.size,this.OwnerData.Style.TempCanvas.font.styles.value=this._listBox.font.styles.value,n=this._listBox.paddingLeft+this.hcl.theme.marginSpace+(this._listBox.borderVisible_?this._listBox.borderWidth_:0)+this.OwnerData.Style.TempCanvas.textWidth(this._listBox.items[i].text)+4}finally{this.OwnerData.Style.TempCanvas.restore()}this._listBox.scrollBarVisible&&(n+=this._listBox._scrollBar.width),n<this.Width&&(n=this.Width),this._listBox.width=n}}else this._listBox.scrollBarVisible?this._listBox.width=Math.max(this.Width+this._listBox._scrollBar.width,50):this._listBox.width=Math.max(this.Width,50);this._listBox.itemIndex=this._listBox.itemIndexOf(this.Text);var r=this._dropDownCount*(this._listBox.font.height+this.hcl.theme.marginSpaceDouble),a=this._listBox.contentHeight;this._listBox.height=a>r?r:a,this._popupControl=new Si(this.hcl),this._popupControl.width=this._listBox.width,this._popupControl.height=this._listBox.height,this._popupControl.dropDownStyle=!0,this._popupControl.onClose=function(){t._popupControl=null},this._popupControl.onPaint=function(e){t._listBox.paintTo(e,0,0)},this._popupControl.onMouseEnter=function(){t._listBox.mouseEnter()},this._popupControl.onMouseLeave=function(){t._listBox.mouseLeave()},this._popupControl.onMouseWheel=function(e){t._listBox.mouseWheel(e)},this._popupControl.onMouseDown=function(e){t._popupDownInTextArea=t._listBox.textArea().pointInAt(e.x,e.y),t._listBox.mouseDown(e)},this._popupControl.onMouseMove=function(e){t._listBox.mouseMove(e)},this._popupControl.onMouseUp=function(e){t._listBox.mouseUp(e),t._popupDownInTextArea&&(t._popupControl.donePopup(),t.OwnerData.Style.InvalidateRect(nt.Create(t.FButtonDrawRect.right-t.Width,t.FButtonDrawRect.top,t.FButtonDrawRect.right,t.FButtonDrawRect.bottom)))}}var l=this.OwnerData.GetScreenCoord(this.FButtonDrawRect.left-(this.Width-this.FButtonDrawRect.width),this.FButtonDrawRect.bottom+1);this._popupAlign==Qt||(l.x+=this.Width-this._popupControl.width),this._popupControl.popup(l.x,l.y,!0)}},{key:"KeyDown",value:function(t){this.FStatic||t.keyCode==Ee||t.keyCode==Xe?null!=this.OnKeyDown&&this.OnKeyDown(t):f()(F()(i.prototype),"KeyDown",this).call(this,t)}},{key:"KeyPress",value:function(t){!this.FStatic&&this.Enabled&&f()(F()(i.prototype),"KeyPress",this).call(this,t)}},{key:"MouseDown",value:function(t){return this.Enabled&&!this.ReadOnly&&this.OwnerData.CanEdit()&&t.button==ae&&(this.FStatic&&this.ClientRect().pointInAt(t.x,t.y)||this.FButtonRect.pointInAt(t.x,t.y))?(this.DoPopup(),!0):f()(F()(i.prototype),"MouseDown",this).call(this,t)}},{key:"MouseMove",value:function(t){return this.FButtonRect.pointInAt(t.x,t.y)?(this.FMouseInButton||(this.FMouseInButton=!0,this.OwnerData.Style.UpdateInfoRePaint()),this.OwnerData.Style.Cursor=Se,!0):(this.FMouseInButton&&(this.FMouseInButton=!1,this.OwnerData.Style.UpdateInfoRePaint()),this.FStatic&&this.ClientRect().pointInAt(t.x,t.y)&&(this.OwnerData.Style.Cursor=Se),f()(F()(i.prototype),"MouseMove",this).call(this,t))}},{key:"MouseLeave",value:function(){f()(F()(i.prototype),"MouseLeave",this).call(this),this.FMouseInButton=!1}},{key:"GetCaretInfo",value:function(t){f()(F()(i.prototype),"GetCaretInfo",this).call(this,t),!this.AutoSize&&t.X>this.Width-this.BTNWIDTH&&(t.Visible=!1)}},{key:"SetItemIndex",value:function(t){this.ReadOnly||(t>=0&&t<this._listBox.items.count?this._listBox.itemIndex=t:(this.FItemIndex=-1,this.Text="",this.DoItemIndexChanged()),this.DoItemChange(Yl.OffsetInner,rh.ContentChange))}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FStatic=t.Static,this.FSaveItem=t.SaveItem,this._listBox.items.clear(),this.FItems.clear();for(var e=0;e<t.Items.count;e++)this._listBox.items.add(t.Items[e].Text);this.FItems.clear();for(var n=0;n<t.Items.count;n++)this.AddItemEx(t.Items[n].Text,t.Items[n].Code,t.Items[n].ID,t.Items[n].Value)}},{key:"DoItemIndexChanged",value:function(){null!=this.OnItemIndexChanged&&this.OnItemIndexChanged(this)}},{key:"InsertText",value:function(t){return!(this.FStatic||!this.Enabled)&&f()(F()(i.prototype),"InsertText",this).call(this,t)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;if(this.FStatic&&(o|=128),this.FSaveItem&&(o|=64),this.PopupAutoWidth&&(o|=32),t.writeByte(o),this.FSaveItem){var s="",r="",a="",l="";if(this.FItems.count>0){s=this.FItems[0].Text,r=this.FItems[0].Code,a=this.FItems[0].ID,l=this.FItems[0].Value;for(var h=1;h<this.FItems.count;h++)s+=Yl.sLineBreak+this.FItems[h].Text,r+=Yl.sLineBreak+this.FItems[h].Code,a+=Yl.sLineBreak+this.FItems[h].ID,l+=Yl.sLineBreak+this.FItems[h].Value}Yl.HCSaveTextToStream(t,s),Yl.HCSaveTextToStream(t,r),Yl.HCSaveTextToStream(t,a),Yl.HCSaveTextToStream(t,l)}}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this._listBox.items.clear();if(this.PopupAutoWidth=!1,!(n>36))throw new Error("为提高效率，66版本编辑器不再支持小于37版本的文件！");if(n>40){var o=t.readByte();this.FStatic=L.isOdd(o>>7),this.FSaveItem=L.isOdd(o>>6),this.PopupAutoWidth=L.isOdd(o>>5)}else this.FSaveItem=t.readBoolean();if(this.FItems.clear(),this.FSaveItem){for(var s=Yl.HCLoadTextFromStream(t,n).split(Yl.sLineBreak),r=0,a=s.length;r<a;r++)this.AddItem(s[r],"");for(var l=0,h=(s=Yl.HCLoadTextFromStream(t,n).split(Yl.sLineBreak)).length;l<h;l++)this.FItems[l].Code=s[l];if(n>65){for(var c=0,u=(s=Yl.HCLoadTextFromStream(t,n).split(Yl.sLineBreak)).length;c<u;c++)this.FItems[c].ID=s[c];for(var d=0,m=(s=Yl.HCLoadTextFromStream(t,n).split(Yl.sLineBreak)).length;d<m;d++)this.FItems[d].Value=s[d]}else for(var S=0;S<this.FItems.count;S++)this.FItems[S].Value=this.FItems[S].Code}}},{key:"AddItem",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=new ua;return n.Text=t,n.Code=e,i<0||i>this.FItems.count?(this._listBox.items.add(t),this.FItems.add(n)):(this._listBox.items.insert(i,t),this.FItems.insert(i,n)),n}},{key:"AddItemEx",value:function(t,e,i,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,s=this.AddItem(t,e,o);return s.ID=i,s.Value=n,s}},{key:"TextEffective",value:function(){return this._listBox.itemIndex>=0?this.Text:""}},{key:"Clear",value:function(){this._listBox.items.clear(),this.FItems.clear()}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t)}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t)}},{key:"ParseJSONObject",value:function(t){if(f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.SaveItem&&(this.FSaveItem=t.SaveItem),null!=t.Static&&(this.FStatic=t.Static),null!=t.PopupAutoWidth&&(this.PopupAutoWidth=L.parseBooleanDef(t.PopupAutoWidth,!1)),null!=t.Items)for(var e=0;e<t.Items.length;e++)t.Items[e].ID&&t.Items[e].Value?this.AddItemEx(t.Items[e].Text,t.Items[e].Code,t.Items[e].ID,t.Items[e].Value):this.AddItem(t.Items[e].Text,t.Items[e].TextValue||t.Items[e].Code)}},{key:"Items",get:function(){return this.FItems}},{key:"ItemIndex",get:function(){return this.FItemIndex},set:function(t){this.SetItemIndex(t)}},{key:"SaveItem",get:function(){return this.FSaveItem},set:function(t){this.FSaveItem=t}},{key:"Static",get:function(){return this.FStatic},set:function(t){this.FStatic=t}}]),i}(ha);function da(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var ma=function(t){m()(i,t);var e=da(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t))._canvas=document.createElement("canvas"),s._canvas.width=n||100,s._canvas.height=o||100,s._context=s._canvas.getContext("2d"),s.canvas=new zt(t,s._context),s.canvas.prepareConext(s.hcl._scale),s}return l()(i,[{key:"width",get:function(){return this._canvas.width},set:function(t){this._canvas.width=t}},{key:"height",get:function(){return this._canvas.height},set:function(t){this._canvas.height=t}}]),i}(tt);function Sa(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var pa=0,ya=0,Fa=1,va=2,Ia=4,ga=6,Ca=function(){function t(){r()(this,t),this.Bits=0,this.Ordinal=0}return l()(t,[{key:"Assign",value:function(t){this.Bits=t.Bits}}]),t}(),wa=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;r()(this,t),this.Size=e,this.Bits=new H(e>0?e+31>>5:1)}return l()(t,[{key:"EnsureCapacity",value:function(t){if(t>this.Bits.length<<5){var e=this.Bits.length;this.Bits.length=t;for(var i=e;i<this.Bits.length;i++)this.Bits[i]=0}}},{key:"GetSizeInBytes",value:function(){return this.Size+7>>3}},{key:"GetSize",value:function(){return this.Size}},{key:"Get",value:function(t){return 0!=(this.Bits[t>>5]&1<<(31&t))}},{key:"SetBit",value:function(t){this.Bits[t>>5]|=1<<(31&t)}},{key:"AppendBit",value:function(t){this.EnsureCapacity(this.Size+1),t&&(this.Bits[this.Size>>5]|=1<<(31&this.Size)),this.Size++}},{key:"AppendBits",value:function(t,e){this.EnsureCapacity(this.Size+e);for(var i=e;i>0;i--)this.AppendBit(1==(t>>i-1&1))}},{key:"AppendBitArray",value:function(t){var e=t.GetSize();this.EnsureCapacity(this.Size+e);for(var i=0;i<e;i++)this.AppendBit(t.Get(i))}},{key:"ToBytes",value:function(t,e,i,n){for(var o,s=0;s<n;s++){o=0;for(var r=0;r<8;r++)this.Get(t)&&(o|=1<<7-r),t++;e[i+s]=o}}},{key:"XorOperation",value:function(t){if(this.Bits.length==t.Bits.length)for(var e=0;e<this.Bits.length;e++)this.Bits[e]^=t.Bits[e]}}]),t}(),Aa=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1],Da=[[0,0,0],[10,12,14],[9,11,13],[0,0,0],[8,16,16],[0,0,0],[8,10,12],[0,0,0],[0,0,0],[8,10,12]],Pa=[0,1,2,3,4,7,8,5,9,13],ka=[[8,0],[8,1],[8,2],[8,3],[8,4],[8,5],[8,7],[8,8],[7,8],[5,8],[4,8],[3,8],[2,8],[1,8],[0,8]],xa=[[0,0,0,0,0,0,0,0]],Ra=[[0],[0],[0],[0],[0],[0],[0]],Ta=[[1,1,1,1,1,1,1],[1,0,0,0,0,0,1],[1,0,1,1,1,0,1],[1,0,1,1,1,0,1],[1,0,1,1,1,0,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1]],ba=[[1,1,1,1,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,1,1,1,1]],Ba=[[-1,-1,-1,-1,-1,-1,-1],[6,18,-1,-1,-1,-1,-1],[6,22,-1,-1,-1,-1,-1],[6,26,-1,-1,-1,-1,-1],[6,30,-1,-1,-1,-1,-1],[6,34,-1,-1,-1,-1,-1],[6,22,38,-1,-1,-1,-1],[6,24,42,-1,-1,-1,-1],[6,26,46,-1,-1,-1,-1],[6,28,50,-1,-1,-1,-1],[6,30,54,-1,-1,-1,-1],[6,32,58,-1,-1,-1,-1],[6,34,62,-1,-1,-1,-1],[6,26,46,66,-1,-1,-1],[6,26,48,70,-1,-1,-1],[6,26,50,74,-1,-1,-1],[6,30,54,78,-1,-1,-1],[6,30,56,82,-1,-1,-1],[6,30,58,86,-1,-1,-1],[6,34,62,90,-1,-1,-1],[6,28,50,72,94,-1,-1],[6,26,50,74,98,-1,-1],[6,30,54,78,102,-1,-1],[6,28,54,80,106,-1,-1],[6,32,58,84,110,-1,-1],[6,30,58,86,114,-1,-1],[6,34,62,90,118,-1,-1],[6,26,50,74,98,122,-1],[6,30,54,78,102,126,-1],[6,26,52,78,104,130,-1],[6,30,56,82,108,134,-1],[6,34,60,86,112,138,-1],[6,30,58,86,114,142,-1],[6,34,62,90,118,146,-1],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],Na=function(){function t(e,i){r()(this,t),this.Count=e,this.DataCodewords=i}return l()(t,[{key:"GetCount",value:function(){return this.Count}},{key:"GetDataCodewords",value:function(){return this.DataCodewords}}]),t}(),Oa=function(){function t(){r()(this,t),this.ECCodewordsPerBlock,this.ECBlocks}return l()(t,[{key:"GetTotalECCodewords",value:function(){return this.ECCodewordsPerBlock*this.GetNumBlocks()}},{key:"GetNumBlocks",value:function(){for(var t=0,e=0;e<this.ECBlocks.length;e++)t+=this.ECBlocks[e].GetCount();return t}},{key:"GetECCodewordsPerBlock",value:function(){return this.ECCodewordsPerBlock}},{key:"GetECBlocks",value:function(){return this.ECBlocks}}],[{key:"Create2",value:function(e,i){var n=new t;return n.ECCodewordsPerBlock=e,n.ECBlocks=new G(1),n.ECBlocks[0]=i,n}},{key:"Create3",value:function(e,i,n){var o=new t;return o.ECCodewordsPerBlock=e,o.ECBlocks=new G(2),o.ECBlocks[0]=i,o.ECBlocks[1]=n,o}}]),t}(),_a=function(){function t(e,i,n,o,s,a){r()(this,t),this.VersionNumber=e,this.AlignmentPatternCenters=i,this.ECBlocks=new G(4),this.ECBlocks[0]=n,this.ECBlocks[1]=o,this.ECBlocks[2]=s,this.ECBlocks[3]=a,this.TotalCodewords=0,this.ECCodewords=n.GetECCodewordsPerBlock();for(var l,h=n.GetECBlocks(),c=0;c<h.length;c++)l=h[c],this.TotalCodewords+=l.GetCount()*(l.GetDataCodewords()+this.ECCodewords)}return l()(t,[{key:"GetTotalCodewords",value:function(){return this.TotalCodewords}},{key:"GetECBlocksForLevel",value:function(t){return this.ECBlocks[t.Ordinal]}},{key:"GetDimensionForVersion",value:function(){return 17+4*this.VersionNumber}}],[{key:"GetVersionForNumber",value:function(e){return 1==e?new t(1,[],Oa.Create2(7,new Na(1,19)),Oa.Create2(10,new Na(1,16)),Oa.Create2(13,new Na(1,13)),Oa.Create2(17,new Na(1,9))):2==e?new t(2,[6,18],Oa.Create2(10,new Na(1,34)),Oa.Create2(16,new Na(1,28)),Oa.Create2(22,new Na(1,22)),Oa.Create2(28,new Na(1,16))):3==e?new t(3,[6,22],Oa.Create2(15,new Na(1,55)),Oa.Create2(26,new Na(1,44)),Oa.Create2(18,new Na(2,17)),Oa.Create2(22,new Na(2,13))):4==e?new t(4,[6,26],Oa.Create2(20,new Na(1,80)),Oa.Create2(18,new Na(2,32)),Oa.Create2(26,new Na(2,24)),Oa.Create2(16,new Na(4,9))):5==e?new t(5,[6,30],Oa.Create2(26,new Na(1,108)),Oa.Create2(24,new Na(2,43)),Oa.Create3(18,new Na(2,15),new Na(2,16)),Oa.Create3(22,new Na(2,11),new Na(2,12))):6==e?new t.Create(6,[6,34],Oa.Create2(18,new Na(2,68)),Oa.Create2(16,new Na(4,27)),Oa.Create2(24,new Na(4,19)),Oa.Create2(28,new Na(4,15))):7==e?new t.Create(7,[6,22,38],Oa.Create2(20,new Na(2,78)),Oa.Create2(18,new Na(4,31)),Oa.Create3(18,new Na(2,14),new Na(4,15)),Oa.Create3(26,new Na(4,13),new Na(1,14))):8==e?new t.Create(8,[6,24,42],Oa.Create2(24,new Na(2,97)),Oa.Create3(22,new Na(2,38),new Na(2,39)),Oa.Create3(22,new Na(4,18),new Na(2,19)),Oa.Create3(26,new Na(4,14),new Na(2,15))):9==e?new t.Create(9,[6,26,46],Oa.Create2(30,new Na(2,116)),Oa.Create3(22,new Na(3,36),new Na(2,37)),Oa.Create3(20,new Na(4,16),new Na(4,17)),Oa.Create3(24,new Na(4,12),new Na(4,13))):10==e?new t.Create(10,[6,28,50],Oa.Create3(18,new Na(2,68),new Na(2,69)),Oa.Create3(26,new Na(4,43),new Na(1,44)),Oa.Create3(24,new Na(6,19),new Na(2,20)),Oa.Create3(28,new Na(6,15),new Na(2,16))):11==e?new t.Create(11,[6,30,54],Oa.Create2(20,new Na(4,81)),Oa.Create3(30,new Na(1,50),new Na(4,51)),Oa.Create3(28,new Na(4,22),new Na(4,23)),Oa.Create3(24,new Na(3,12),new Na(8,13))):12==e?new t.Create(12,[6,32,58],Oa.Create3(24,new Na(2,92),new Na(2,93)),Oa.Create3(22,new Na(6,36),new Na(2,37)),Oa.Create3(26,new Na(4,20),new Na(6,21)),Oa.Create3(28,new Na(7,14),new Na(4,15))):13==e?new t.Create(13,[6,34,62],Oa.Create2(26,new Na(4,107)),Oa.Create3(22,new Na(8,37),new Na(1,38)),Oa.Create3(24,new Na(8,20),new Na(4,21)),Oa.Create3(22,new Na(12,11),new Na(4,12))):14==e?new t.Create(14,[6,26,46,66],Oa.Create3(30,new Na(3,115),new Na(1,116)),Oa.Create3(24,new Na(4,40),new Na(5,41)),Oa.Create3(20,new Na(11,16),new Na(5,17)),Oa.Create3(24,new Na(11,12),new Na(5,13))):15==e?new t.Create(15,[6,26,48,70],Oa.Create3(22,new Na(5,87),new Na(1,88)),Oa.Create3(24,new Na(5,41),new Na(5,42)),Oa.Create3(30,new Na(5,24),new Na(7,25)),Oa.Create3(24,new Na(11,12),new Na(7,13))):16==e?new t.Create(16,[6,26,50,74],Oa.Create3(24,new Na(5,98),new Na(1,99)),Oa.Create3(28,new Na(7,45),new Na(3,46)),Oa.Create3(24,new Na(15,19),new Na(2,20)),Oa.Create3(30,new Na(3,15),new Na(13,16))):17==e?new t.Create(17,[6,30,54,78],Oa.Create3(28,new Na(1,107),new Na(5,108)),Oa.Create3(28,new Na(10,46),new Na(1,47)),Oa.Create3(28,new Na(1,22),new Na(15,23)),Oa.Create3(28,new Na(2,14),new Na(17,15))):18==e?new t.Create(18,[6,30,56,82],Oa.Create3(30,new Na(5,120),new Na(1,121)),Oa.Create3(26,new Na(9,43),new Na(4,44)),Oa.Create3(28,new Na(17,22),new Na(1,23)),Oa.Create3(28,new Na(2,14),new Na(19,15))):19==e?new t.Create(19,[6,30,58,86],Oa.Create3(28,new Na(3,113),new Na(4,114)),Oa.Create3(26,new Na(3,44),new Na(11,45)),Oa.Create3(26,new Na(17,21),new Na(4,22)),Oa.Create3(26,new Na(9,13),new Na(16,14))):20==e?new t.Create(20,[6,34,62,90],Oa.Create3(28,new Na(3,107),new Na(5,108)),Oa.Create3(26,new Na(3,41),new Na(13,42)),Oa.Create3(30,new Na(15,24),new Na(5,25)),Oa.Create3(28,new Na(15,15),new Na(10,16))):21==e?new t.Create(21,[6,28,50,72,94],Oa.Create3(28,new Na(4,116),new Na(4,117)),Oa.Create2(26,new Na(17,42)),Oa.Create3(28,new Na(17,22),new Na(6,23)),Oa.Create3(30,new Na(19,16),new Na(6,17))):22==e?new t.Create(22,[6,26,50,74,98],Oa.Create3(28,new Na(2,111),new Na(7,112)),Oa.Create2(28,new Na(17,46)),Oa.Create3(30,new Na(7,24),new Na(16,25)),Oa.Create2(24,new Na(34,13))):23==e?new t.Create(23,[6,30,54,78,102],Oa.Create3(30,new Na(4,121),new Na(5,122)),Oa.Create3(28,new Na(4,47),new Na(14,48)),Oa.Create3(30,new Na(11,24),new Na(14,25)),Oa.Create3(30,new Na(16,15),new Na(14,16))):24==e?new t.Create(24,[6,28,54,80,106],Oa.Create3(30,new Na(6,117),new Na(4,118)),Oa.Create3(28,new Na(6,45),new Na(14,46)),Oa.Create3(30,new Na(11,24),new Na(16,25)),Oa.Create3(30,new Na(30,16),new Na(2,17))):25==e?new t.Create(25,[6,32,58,84,110],Oa.Create3(26,new Na(8,106),new Na(4,107)),Oa.Create3(28,new Na(8,47),new Na(13,48)),Oa.Create3(30,new Na(7,24),new Na(22,25)),Oa.Create3(30,new Na(22,15),new Na(13,16))):26==e?new t.Create(26,[6,30,58,86,114],Oa.Create3(28,new Na(10,114),new Na(2,115)),Oa.Create3(28,new Na(19,46),new Na(4,47)),Oa.Create3(28,new Na(28,22),new Na(6,23)),Oa.Create3(30,new Na(33,16),new Na(4,17))):27==e?new t.Create(27,[6,34,62,90,118],Oa.Create3(30,new Na(8,122),new Na(4,123)),Oa.Create3(28,new Na(22,45),new Na(3,46)),Oa.Create3(30,new Na(8,23),new Na(26,24)),Oa.Create3(30,new Na(12,15),new Na(28,16))):28==e?new t.Create(28,[6,26,50,74,98,122],Oa.Create3(30,new Na(3,117),new Na(10,118)),Oa.Create3(28,new Na(3,45),new Na(23,46)),Oa.Create3(30,new Na(4,24),new Na(31,25)),Oa.Create3(30,new Na(11,15),new Na(31,16))):29==e?new t.Create(29,[6,30,54,78,102,126],Oa.Create3(30,new Na(7,116),new Na(7,117)),Oa.Create3(28,new Na(21,45),new Na(7,46)),Oa.Create3(30,new Na(1,23),new Na(37,24)),Oa.Create3(30,new Na(19,15),new Na(26,16))):30==e?new t.Create(30,[6,26,52,78,104,130],Oa.Create3(30,new Na(5,115),new Na(10,116)),Oa.Create3(28,new Na(19,47),new Na(10,48)),Oa.Create3(30,new Na(15,24),new Na(25,25)),Oa.Create3(30,new Na(23,15),new Na(25,16))):31==e?new t.Create(31,[6,30,56,82,108,134],Oa.Create3(30,new Na(13,115),new Na(3,116)),Oa.Create3(28,new Na(2,46),new Na(29,47)),Oa.Create3(30,new Na(42,24),new Na(1,25)),Oa.Create3(30,new Na(23,15),new Na(28,16))):32==e?new t.Create(32,[6,34,60,86,112,138],Oa.Create2(30,new Na(17,115)),Oa.Create3(28,new Na(10,46),new Na(23,47)),Oa.Create3(30,new Na(10,24),new Na(35,25)),Oa.Create3(30,new Na(19,15),new Na(35,16))):33==e?new t.Create(33,[6,30,58,86,114,142],Oa.Create3(30,new Na(17,115),new Na(1,116)),Oa.Create3(28,new Na(14,46),new Na(21,47)),Oa.Create3(30,new Na(29,24),new Na(19,25)),Oa.Create3(30,new Na(11,15),new Na(46,16))):34==e?new t.Create(34,[6,34,62,90,118,146],Oa.Create3(30,new Na(13,115),new Na(6,116)),Oa.Create3(28,new Na(14,46),new Na(23,47)),Oa.Create3(30,new Na(44,24),new Na(7,25)),Oa.Create3(30,new Na(59,16),new Na(1,17))):35==e?new t.Create(35,[6,30,54,78,102,126,150],Oa.Create3(30,new Na(12,121),new Na(7,122)),Oa.Create3(28,new Na(12,47),new Na(26,48)),Oa.Create3(30,new Na(39,24),new Na(14,25)),Oa.Create3(30,new Na(22,15),new Na(41,16))):36==e?new t.Create(36,[6,24,50,76,102,128,154],Oa.Create3(30,new Na(6,121),new Na(14,122)),Oa.Create3(28,new Na(6,47),new Na(34,48)),Oa.Create3(30,new Na(46,24),new Na(10,25)),Oa.Create3(30,new Na(2,15),new Na(64,16))):37==e?new t.Create(37,[6,28,54,80,106,132,158],Oa.Create3(30,new Na(17,122),new Na(4,123)),Oa.Create3(28,new Na(29,46),new Na(14,47)),Oa.Create3(30,new Na(49,24),new Na(10,25)),Oa.Create3(30,new Na(24,15),new Na(46,16))):38==e?new t.Create(38,[6,32,58,84,110,136,162],Oa.Create3(30,new Na(4,122),new Na(18,123)),Oa.Create3(28,new Na(13,46),new Na(32,47)),Oa.Create3(30,new Na(48,24),new Na(14,25)),Oa.Create3(30,new Na(42,15),new Na(32,16))):39==e?new t.Create(39,[6,26,54,82,110,138,166],Oa.Create3(30,new Na(20,117),new Na(4,118)),Oa.Create3(28,new Na(40,47),new Na(7,48)),Oa.Create3(30,new Na(43,24),new Na(22,25)),Oa.Create3(30,new Na(10,15),new Na(67,16))):40==e?new t.Create(40,[6,30,58,86,114,142,170],Oa.Create3(30,new Na(19,118),new Na(6,119)),Oa.Create3(28,new Na(18,47),new Na(31,48)),Oa.Create3(30,new Na(34,24),new Na(34,25)),Oa.Create3(30,new Na(20,15),new Na(61,16))):null}},{key:"ChooseVersion",value:function(e,i){for(var n,o=1;o<=40;o++)if((n=t.GetVersionForNumber(o)).GetTotalCodewords()-n.GetECBlocksForLevel(i).GetTotalECCodewords()>=Math.trunc((e+7)/8))return n;return null}}]),t}(),Ea=function(){function t(){r()(this,t)}return l()(t,[{key:"GetDataMaskBit",value:function(t,e,i){var n,o=0;if(t>=0&&t<8)switch(t){case 0:o=i+e&1;break;case 1:o=1&i;break;case 2:o=e%3;break;case 3:o=(i+e)%3;break;case 4:o=(i>>1)+Math.trunc(e/3)&1;break;case 5:o=(1&(n=i*e))+n%3;break;case 6:o=(1&(n=i*e))+(3&n)&1;break;case 7:o=(n=i*e)%3+(i+e&1)&1}return 0==o}}]),t}(),Ma=function(){function t(){r()(this,t),this.MatrixUtilError=!1}return l()(t,[{key:"ClearMatrix",value:function(t){t.Clear(255)}},{key:"EmbedBasicPatterns",value:function(t,e){this.EmbedPositionDetectionPatternsAndSeparators(e),this.EmbedDarkDotAtLeftBottomCorner(e),this.MaybeEmbedPositionAdjustmentPatterns(t,e),this.EmbedTimingPatterns(e)}},{key:"EmbedTypeInfo",value:function(t,e,i){var n,o,s,r,a,l=new wa;this.MakeTypeInfoBits(t,e,l);for(var h=0;h<l.GetSize();h++)n=l.Get(l.GetSize()-1-h),o=ka[h][0],r=ka[h][1],i.SetBoolean(o,r,n),h<8?(s=i.Width-h-1,a=8,i.SetBoolean(s,a,n)):(s=8,a=i.Height-7+(h-8),i.SetBoolean(s,a,n))}},{key:"MaybeEmbedVersionInfo",value:function(t,e){if(!(t<7)){var i=new wa;this.MakeVersionInfoBits(t,i);for(var n,o=17,s=0;s<6;s++)for(var r=0;r<3;r++)n=i.Get(o),o--,e.SetBoolean(s,e.Height-11+r,n),e.SetBoolean(e.Height-11+r,s,n)}}},{key:"EmbedDataBits",value:function(t,e,i){for(var n,o,s=new Ea,r=0,a=-1,l=i.Width-1,h=i.Height-1;l>0;){for(6==l&&l--;h>=0&&h<i.Height;){for(var c=0;c<2;c++)n=l-c,this.IsEmpty(i.Get(n,h))&&(r<t.GetSize()?(o=t.Get(r),r++):o=!1,-1!=e&&s.GetDataMaskBit(e,n,h)&&(o=!o),i.SetBoolean(n,h,o));h+=a}h+=a=-a,l-=2}r!=t.GetSize()&&(this.MatrixUtilError=!0)}},{key:"FindMSBSet",value:function(t){for(var e=0;0!=t;)t>>=1,e++;return e}},{key:"CalculateBCHCode",value:function(t,e){var i=this.FindMSBSet(e);for(t<<=i-1;this.FindMSBSet(t)>=i;)t^=e<<this.FindMSBSet(t)-i;return t}},{key:"MakeTypeInfoBits",value:function(t,e,i){if(e>=0&&e<8){var n=t.Bits<<3|e;i.AppendBits(n,5);var o=this.CalculateBCHCode(n,1335);i.AppendBits(o,10);var s=new wa;if(s.AppendBits(21522,15),i.XorOperation(s),15!=i.GetSize())return void(this.MatrixUtilError=!0)}}},{key:"MakeVersionInfoBits",value:function(t,e){e.AppendBits(t,6);var i=this.CalculateBCHCode(t,7973);e.AppendBits(i,12),18!=e.GetSize()&&(this.MatrixUtilError=!0)}},{key:"IsEmpty",value:function(t){return-1==t}},{key:"EmbedTimingPatterns",value:function(t){for(var e,i=8;i<=t.Width-9;i++)e=(i+1)%2,this.IsEmpty(t.Get(i,6))&&t.SetInteger(i,6,e),this.IsEmpty(t.Get(6,i))&&t.SetInteger(6,i,e)}},{key:"EmbedDarkDotAtLeftBottomCorner",value:function(t){0!=t.Get(8,t.Height-8)?t.SetInteger(8,t.Height-8,1):this.MatrixUtilError=!0}},{key:"EmbedHorizontalSeparationPattern",value:function(t,e,i){for(var n=0;n<8;n++){if(!this.IsEmpty(i.Get(t+n,e)))return void(this.MatrixUtilError=!0);i.SetInteger(t+n,e,xa[0][n])}}},{key:"EmbedVerticalSeparationPattern",value:function(t,e,i){for(var n=0;n<7;n++){if(!this.IsEmpty(i.Get(t,e+n)))return void(this.MatrixUtilError=!0);i.SetInteger(t,e+n,Ra[n][0])}}},{key:"EmbedPositionAdjustmentPattern",value:function(t,e,i){for(var n=0;n<5;n++)for(var o=0;o<5;o++){if(!this.IsEmpty(i.Get(t+o,e+n)))return void(this.MatrixUtilError=!0);i.SetInteger(t+o,e+n,ba[n][o])}}},{key:"EmbedPositionDetectionPattern",value:function(t,e,i){for(var n=0;n<7;n++)for(var o=0;o<7;o++){if(!this.IsEmpty(i.Get(t+o,e+n)))return void(this.MatrixUtilError=!0);i.SetInteger(t+o,e+n,Ta[n][o])}}},{key:"EmbedPositionDetectionPatternsAndSeparators",value:function(t){var e=Ta[0].length;this.EmbedPositionDetectionPattern(0,0,t),this.EmbedPositionDetectionPattern(t.Width-e,0,t),this.EmbedPositionDetectionPattern(0,t.Width-e,t);var i=xa[0].length;this.EmbedHorizontalSeparationPattern(0,i-1,t),this.EmbedHorizontalSeparationPattern(t.Width-i,i-1,t),this.EmbedHorizontalSeparationPattern(0,t.Width-i,t);var n=Ra.length;this.EmbedVerticalSeparationPattern(n,0,t),this.EmbedVerticalSeparationPattern(t.Height-n-1,0,t),this.EmbedVerticalSeparationPattern(n,t.Height-n,t)}},{key:"MaybeEmbedPositionAdjustmentPatterns",value:function(t,e){if(t>=2){for(var i,n,o=t-1,s=Ba[o].length,r=new H(s),a=0;a<s;a++)r[a]=Ba[o][a];for(var l=0;l<s;l++)for(var h=0;h<s;h++)n=r[l],-1!=(i=r[h])&&-1!=n&&this.IsEmpty(e.Get(i,n))&&this.EmbedPositionAdjustmentPattern(i-2,n-2,e)}}},{key:"BuildMatrix",value:function(t,e,i,n,o){this.ClearMatrix(o),this.EmbedBasicPatterns(i,o),this.EmbedTypeInfo(e,n,o),this.MaybeEmbedVersionInfo(i,o),this.EmbedDataBits(t,n,o)}}]),t}(),La=function(){function t(e,i,n){r()(this,t),this.FInitialized=!1,this.FPrimitive=e,this.FSize=i,this.FGeneratorBase=n,this.FPolyList=new G(0),this.FSize<0&&this.Initialize()}return l()(t,[{key:"CheckInit",value:function(){this.FInitialized||this.Initialize()}},{key:"Initialize",value:function(){this.FExpTable=new H(this.FSize),this.FLogTable=new H(this.FSize);for(var t=1,e=0;e<this.FSize;e++)this.FExpTable[e]=t,(t<<=1)>=this.FSize&&(t^=this.FPrimitive,t&=this.FSize-1);for(var i=0;i<this.FSize-1;i++)this.FLogTable[this.FExpTable[i]]=i;var n=new H(1);n[0]=0,this.FZero=new Ga(this,n),(n=new H(1))[0]=1,this.FOne=new Ga(this,n),this.FInitialized=!0}},{key:"GetZero",value:function(){return this.CheckInit(),this.FZero}},{key:"Exp",value:function(t){return this.CheckInit(),this.FExpTable[t]}},{key:"GetGeneratorBase",value:function(){return this.FGeneratorBase}},{key:"Inverse",value:function(t){return this.CheckInit(),0!=t?this.FExpTable[this.FSize-this.FLogTable[t]-1]:0}},{key:"Multiply",value:function(t,e){return this.CheckInit(),0!=t&&0!=e?this.FExpTable[(this.FLogTable[t]+this.FLogTable[e])%(this.FSize-1)]:0}},{key:"BuildMonomial",value:function(t,e){if(this.CheckInit(),t>=0){if(0==e)return this.FZero;var i=new H(t+1);return i[0]=e,new Ga(this,i)}return null}}],[{key:"CreateQRCodeField256",value:function(){return new t(285,256,0)}},{key:"AddOrSubtract",value:function(t,e){return t^e}}]),t}(),Ga=function(){function t(e,i){r()(this,t),this.Coefficients=i,this.FField=e,this.FField.FPolyList.length=this.FField.FPolyList.length+1,this.FField.FPolyList[this.FField.FPolyList.length-1]=this;var n=i.length;if(n>1&&0==i[0]){for(var o=1;o<n&&0==i[o];)o++;if(o==n)this.Coefficients=e.GetZero().Coefficients;else{var s=n-o;this.Coefficients=new H(s);for(var a=0;a<s;a++)this.Coefficients[a]=i[o+a]}}}return l()(t,[{key:"Multiply",value:function(e){var i,n,o,s;if(this.FField==e.FField){if(this.IsZero()||e.IsZero())return this.FField.GetZero();o=(i=this.Coefficients.concat()).length,s=(n=e.Coefficients.concat()).length;for(var r=new H(o+s-1),a=0,l=0;l<o;l++){a=i[l];for(var h=0;h<s;h++)r[l+h]=La.AddOrSubtract(r[l+h],this.FField.Multiply(a,n[h]))}return new t(this.FField,r)}return null}},{key:"MultiplyByMonomial",value:function(e,i){if(e>=0){if(0==i)return this.FField.GetZero();for(var n=this.Coefficients.length,o=new H(n+e),s=0;s<n;s++)o[s]=this.FField.Multiply(this.Coefficients[s],i);return new t(this.FField,o)}}},{key:"Divide",value:function(t){var e=null;if(this.FField==t.FField&&!t.IsZero()){for(var i,n,o,s,r=this.FField.GetZero(),a=this,l=t.GetCoefficient(t.GetDegree()),h=this.FField.Inverse(l);a.GetDegree()>=t.GetDegree()&&!a.IsZero();)i=a.GetDegree()-t.GetDegree(),n=this.FField.Multiply(a.GetCoefficient(a.GetDegree()),h),o=t.MultiplyByMonomial(i,n),s=this.FField.BuildMonomial(i,n),r=r.AddOrSubtract(s),a=a.AddOrSubtract(o);(e=new G(2))[0]=r,e[1]=a}return e}},{key:"GetCoefficients",value:function(){return this.Coefficients}},{key:"IsZero",value:function(){return 0==this.Coefficients[0]}},{key:"GetCoefficient",value:function(t){return this.Coefficients[this.Coefficients.length-1-t]}},{key:"GetDegree",value:function(){return this.Coefficients.length-1}},{key:"AddOrSubtract",value:function(e){if(null!=e&&this.FField===e.FField){if(this.IsZero())return e;if(e.IsZero())return this;var i=this.Coefficients.concat(),n=e.Coefficients.concat();if(i.length>n.length){var o=i.concat();i=n,n=o}var s=new H(n.length),r=n.length-i.length;r>0&&(s=n.concat());for(var a=r,l=n.length;a<l;a++)s[a]=La.AddOrSubtract(i[a-r],n[a]);return new t(this.FField,s)}return null}}]),t}(),Ha=function(){function t(e){r()(this,t),this.FField=e,this.FCachedGenerators=new ot;var i=new H(1);i[0]=1;var n=new Ga(e,i);this.FCachedGenerators.add(n)}return l()(t,[{key:"Encode",value:function(t,e){if(e>0){var i=t.length-e;if(i>0){for(var n=this.BuildGenerator(e),o=new H(i),s=0;s<i;s++)o[s]=t[s];for(var r=new Ga(this.FField,o),a=(r=r.MultiplyByMonomial(e,1)).Divide(n)[1].GetCoefficients(),l=e-a.length,h=0;h<l;h++)t[i+h]=0;for(var c=0,u=a.length;c<u;c++)t[i+l+c]=a[c]}}}},{key:"BuildGenerator",value:function(t){if(t>=this.FCachedGenerators.count)for(var e,i,n=this.FCachedGenerators[this.FCachedGenerators.count-1],o=new H(2),s=this.FCachedGenerators.count;s<=t;s++)o[0]=1,o[1]=this.FField.Exp(s-1+this.FField.GetGeneratorBase()),e=new Ga(this.FField,o),i=n.Multiply(e),this.FCachedGenerators.add(i),n=i;return this.FCachedGenerators[t]}}]),t}(),Va=function(){function t(e,i){r()(this,t),this.FDataBytes=e,this.FErrorCorrectionBytes=i}return l()(t,[{key:"GetDataBytes",value:function(){return this.FDataBytes}},{key:"GetErrorCorrectionBytes",value:function(){return this.FErrorCorrectionBytes}}]),t}(),Ua=function(){function t(){r()(this,t),this.EncoderError=!1}return l()(t,[{key:"ApplyMaskPenaltyRule1Internal",value:function(t,e){var i,n,o=0,s=0,r=-1;e?(i=t.Height,n=t.Width):(i=t.Width,n=t.Height);for(var a,l=t.GetArray(),h=0;h<i;h++){for(var c=0;c<n;c++)(a=e?l[h][c]:l[c][h])==r?5==++s?o+=3:s>5&&o++:(s=1,r=a);s=0}return o}},{key:"ChooseMode",value:function(t,e){var i,n=!0,o=!0,s=!0;if(0==e){for(var r=0;r<t.length;r++)if((i=t[r])<"0"||i>"9"){n=!1;break}if(n)o=!1;else for(var a=0;a<t.length;a++)if(i=t[a],this.GetAlphanumericCode(i.charCodeAt(0))<0){o=!1;break}if(o)s=!1;else for(var l=0;l<t.length;l++)if((i=t[l]).charCodeAt(0)>255){s=!1;break}return n?{mode:Fa,encoding:e}:o?{mode:va,encoding:e}:s?{mode:Ia,encoding:3}:{mode:Ia,encoding:4}}return 1==e?{mode:Fa,encoding:e}:2==e?{mode:va,encoding:e}:{mode:Ia,encoding:e}}},{key:"FilterContent",value:function(t,e,i){for(var n="",o=!1,s=0;s<t.length;s++)o=!1,e==Fa?o=t[s]>="0"&&t[s]<="9":e==va?o=this.GetAlphanumericCode(t[s].charCodeAt(0))>0:e==Ia&&(3==i?o=t[s].charCodeAt(0)<=255:4!=i&&5!=i||(o=!0)),o&&(n+=t[s]);return n}},{key:"Append8BitBytes",value:function(t,e,i){var n=null;if(3==i){n=new Uint8Array(t.length);for(var o=0;o<t.length;o++)n[o]=255&t[o].charCodeAt(0)}else if(4==i){var s=K.getBytes(t);(n=new Uint8Array(s.length+3))[0]=239,n[1]=187,n[2]=191;for(var r=0;r<s.length;r++)n[3+r]=s[r]}else 5==i&&(n=K.getBytes(t));if(null!=n)for(var a=0;a<n.length;a++)e.AppendBits(n[a],8)}},{key:"AppendAlphanumericBytes",value:function(t,e){for(var i,n,o=t.length,s=0;s<o;){if(-1==(i=this.GetAlphanumericCode(t[s].charCodeAt(0))))return void(this.EncoderError=!0);if(s+1<o){if(-1==(n=this.GetAlphanumericCode(t[s+1].charCodeAt(0))))return void(this.EncoderError=!0);e.AppendBits(45*i+n,11),s+=2}else e.AppendBits(i,6),s++}}},{key:"AppendBytes",value:function(t,e,i,n){e==Fa?this.AppendNumericBytes(t,i):e==va?this.AppendAlphanumericBytes(t,i):e==Ia?this.Append8BitBytes(t,i,n):e==ga?this.AppendKanjiBytes():this.EncoderError=!0}},{key:"AppendKanjiBytes",value:function(){}},{key:"AppendLengthInfo",value:function(t,e,i,n){var o=_a.GetVersionForNumber(e),s=this.GetModeCharacterCountBits(i,o);t>(1<<s)-1?this.EncoderError=!0:n.AppendBits(t,s)}},{key:"GetModeBits",value:function(t){return Pa[t]}},{key:"AppendModeInfo",value:function(t,e){e.AppendBits(this.GetModeBits(t),4)}},{key:"AppendNumericBytes",value:function(t,e){for(var i,n,o,s=t.length,r=0;r<s;)i=t[r].charCodeAt(0)-"0".charCodeAt(0),r+2<s?(n=t[r+1].charCodeAt(0)-"0".charCodeAt(0),o=t[r+2].charCodeAt(0)-"0".charCodeAt(0),e.AppendBits(100*i+10*n+o,10),r+=3):r+1<s?(n=t[r+1].charCodeAt(0)-"0".charCodeAt(0),e.AppendBits(10*i+n,7),r+=2):(e.AppendBits(i,4),r++)}},{key:"ChooseMaskPattern",value:function(t,e,i,n){for(var o,s=2147483647,r=-1,a=0;a<8;a++)(new Ma).BuildMatrix(t,e,i,a,n),(o=this.CalculateMaskPenalty(n))<s&&(s=o,r=a);return r}},{key:"GenerateECBytes",value:function(t,e){for(var i=t.length,n=new H(i+e),o=0;o<i;o++)n[o]=255&t[o];var s=La.CreateQRCodeField256();new Ha(s).Encode(n,e);for(var r=new Uint8Array(e),a=0;a<e;a++)r[a]=n[i+a];return r}},{key:"GetAlphanumericCode",value:function(t){return t<Aa.length?Aa[t]:-1}},{key:"GetNumDataBytesAndNumECBytesForBlockID",value:function(t,e,i,n,o,s){if(n>=i)this.EncoderError=!0;else{var r=t%i,a=i-r,l=Math.trunc(t/i),h=l+1,c=Math.trunc(e/i),u=c+1,f=l-c,d=h-u;f==d&&i==a+r&&t==(c+f)*a+(u+d)*r?n<a?(o[0]=c,s[0]=f):(o[0]=u,s[0]=d):this.EncoderError=!0}}},{key:"InterleaveWithECBytes",value:function(t,e,i,n,o){if(t.GetSizeInBytes()==i){for(var s,r,a,l,h=0,c=0,u=0,f=new H(1),d=new H(1),m=new ot,S=0;S<n;S++)this.GetNumDataBytesAndNumECBytesForBlockID(e,i,n,S,f,d),s=f[0],r=new V(s),t.ToBytes(8*h,r,0,s),a=this.GenerateECBytes(r,d[0]),l=new Va(r,a),m.add(l),c=Math.max(c,s),u=Math.max(u,a.length),h+=f[0];if(i==h){for(var p=0;p<c;p++)for(var y=0;y<m.count;y++)p<(r=m[y].GetDataBytes()).length&&o.AppendBits(r[p],8);for(var F=0;F<u;F++)for(var v=0;v<m.count;v++)F<(a=m[v].GetErrorCorrectionBytes()).length&&o.AppendBits(a[F],8);e!=o.GetSizeInBytes()&&(this.EncoderError=!0)}else this.EncoderError=!0}else this.EncoderError=!0}},{key:"TerminateBits",value:function(t,e){var i=t<<3;if(e.GetSize()>i)this.FEncoderError=!0;else{for(var n=0;n<4&&e.GetSize()<i;)e.AppendBit(!1),n++;var o=7&e.GetSize();if(o>0)for(var s=o;s<8;s++)e.AppendBit(!1);for(var r=t-e.GetSizeInBytes(),a=0;a<r;a++)0==(1&a)?e.AppendBits(236,8):e.AppendBits(17,8);e.GetSize()!=i&&(this.EncoderError=!0)}}},{key:"CalculateMaskPenalty",value:function(t){var e=0;return e+=this.ApplyMaskPenaltyRule1(t),e+=this.ApplyMaskPenaltyRule2(t),e+=this.ApplyMaskPenaltyRule3(t),e+=this.ApplyMaskPenaltyRule4(t)}},{key:"ApplyMaskPenaltyRule1",value:function(t){return this.ApplyMaskPenaltyRule1Internal(t,!0)+this.ApplyMaskPenaltyRule1Internal(t,!1)}},{key:"ApplyMaskPenaltyRule2",value:function(t){for(var e,i=0,n=t.GetArray(),o=t.Width,s=t.Height,r=0;r<s-1;r++)for(var a=0;a<o-1;a++)(e=n[r][a])==n[r][a+1]&&e==n[r+1][a]&&e==n[r+1][a+1]&&(i+=3);return i}},{key:"ApplyMaskPenaltyRule3",value:function(t){for(var e=0,i=t.GetArray(),n=t.Width,o=t.Height,s=0;s<o;s++)for(var r=0;r<n;r++)r+6<n&&1==i[s][r]&&0==i[s][r+1]&&1==i[s][r+2]&&1==i[s][r+3]&&1==i[s][r+4]&&0==i[s][r+5]&&1==i[s][r+6]&&(r+10<n&&0==i[s][r+7]&&0==i[s][r+8]&&0==i[s][r+9]&&0==i[s][r+10]||r-4>=0&&0==i[s][r-1]&&0==i[s][r-2]&&0==i[s][r-3]&&0==i[s][r-4])&&(e+=40),s+6<o&&1==i[s][r]&&0==i[s+1][r]&&1==i[s+2][r]&&1==i[s+3][r]&&1==i[s+4][r]&&0==i[s+5][r]&&1==i[s+6][r]&&(s+10<o&&0==i[s+7][r]&&0==i[s+8][r]&&0==i[s+9][r]&&0==i[s+10][r]||s-4>=0&&0==i[s-1][r]&&0==i[s-2][r]&&0==i[s-3][r]&&0==i[s-4][r])&&(e+=40);return e}},{key:"ApplyMaskPenaltyRule4",value:function(t){for(var e=0,i=t.GetArray(),n=t.Width,o=t.Height,s=0;s<o;s++)for(var r=0;r<n;r++)1==i[s][r]&&e++;var a=e/(t.Height*t.Width);return Math.trunc(Math.abs(100*a-50)/50)}},{key:"GetModeCharacterCountBits",value:function(t,e){var i=e.VersionNumber;return Da[t][i<=9?0:i<=26?1:2]}},{key:"Encode",value:function(t,e,i,n){var o=new wa,s=new wa,r=this.ChooseMode(t,e);e=r.encoding;var a=this.FilterContent(t,r.mode,e);this.AppendBytes(a,r.mode,o,e),this.AppendModeInfo(r.mode,s);var l=_a.GetVersionForNumber(1),h=s.GetSize()+this.GetModeCharacterCountBits(r.mode,l)+o.GetSize();l=_a.ChooseVersion(h,i);var c=s.GetSize()+this.GetModeCharacterCountBits(r.mode,l)+o.GetSize(),u=_a.ChooseVersion(c,i),f=new wa,d=new wa;f.AppendBitArray(s);var m=a.length;r.mode==Ia&&(m=o.GetSizeInBytes()),this.AppendLengthInfo(m,u.VersionNumber,r.mode,f),f.AppendBitArray(o);var S=u.GetECBlocksForLevel(i),p=u.GetTotalCodewords()-S.GetTotalECCodewords();this.TerminateBits(p,f),this.InterleaveWithECBytes(f,u.GetTotalCodewords(),p,S.GetNumBlocks(),d),n.SetECLevel(i),n.Mode=r.mode,n.Version=u.VersionNumber;var y=u.GetDimensionForVersion(),F=new za(y,y);n.MaskPattern=this.ChooseMaskPattern(d,i,u.VersionNumber,F),F=new za(y,y),(new Ma).BuildMatrix(d,n.ECLevel,n.Version,n.MaskPattern,F),n.SetMatrix(F)}}]),t}(),Wa=function(){function t(){r()(this,t),this.Matrix=null,this.ECLevel=null,this.Mode=ya,this.Version=-1,this.MatrixWidth=-1,this.MaskPattern=-1,this.NumTotalBytes=-1,this.NumDataBytes=-1,this.NumECBytes=-1,this.NumRSBlocks=-1,this.QRCodeError=!1}return l()(t,[{key:"At",value:function(t,e){var i=this.Matrix.Get(t,e);return 0!=i&&1!=i&&(this.QRCodeError=!0),i}},{key:"IsValid",value:function(){return null!=this.ECLevel&&-1!=this.Version&&-1!=this.MatrixWidth&&-1!=this.MaskPattern&&-1!=this.NumTotalBytes&&-1!=this.NumDataBytes&&-1!=this.NumECBytes&&-1!=this.NumRSBlocks&&this.IsValidMaskPattern(this.MaskPattern)&&this.NumTotalBytes==this.NumDataBytes+this.NumECBytes&&null!=this.Matrix&&this.MatrixWidth==this.Matrix.Width&&this.Matrix.Width==this.Matrix.Height}},{key:"IsValidMaskPattern",value:function(t){return t>=0&&t<8}},{key:"SetMatrix",value:function(t){this.Matrix=t}},{key:"SetECLevel",value:function(t){this.ECLevel=new Ca,this.ECLevel.Assign(t)}},{key:"SetAll",value:function(t,e,i,n,o,s){this.Version=t,this.NumTotalBytes=e,this.NumDataBytes=i,this.NumRSBlocks=n,this.NumECBytes=o,this.MatrixWidth=s}}]),t}(),za=function(){function t(e,i){r()(this,t),this.Width=e,this.Height=i,this.Bytes=new G(i);for(var n=0;n<i;n++){this.Bytes[n]=new Uint8Array(e);for(var o=0;o<e;o++)this.Bytes[n][o]=0}}return l()(t,[{key:"Get",value:function(t,e){return 255==this.Bytes[e][t]?-1:this.Bytes[e][t]}},{key:"SetBoolean",value:function(t,e,i){this.Bytes[e][t]=255&(i?1:0)}},{key:"SetInteger",value:function(t,e,i){this.Bytes[e][t]=255&i}},{key:"GetArray",value:function(){return this.Bytes}},{key:"Assign",value:function(t){this.Bytes=t.Bytes.concat(),this.Width=t.Width,this.Height=t.Height}},{key:"Clear",value:function(t){for(var e=0;e<this.Height;e++)for(var i=0;i<this.Width;i++)this.Bytes[e][i]=t}},{key:"Hash",value:function(){for(var t,e,i="",n=0;n<this.Height;n++){t=0;for(var o=0;o<this.Width;o++)-1==(e=this.Get(o,n))&&(e=255),t+=e;i+=String.fromCharCode(t%26+65)}return i}}]),t}(),Ka=function(t){m()(i,t);var e=Sa(i);function i(t,n,o,s){var a;return r()(this,i),(a=e.call(this,t,o,s)).FText=n,a.FEncoding=pa,a.FElements=null,a.FRows=0,a.FColumns=0,a.FPixSize=4,a.Encode(),a}return l()(i,[{key:"GenerateQRCode",value:function(t,e){var i=new Ca;i.Bits=1;var n=new Ua,o=new Wa;return n.Encode(t,e,i,o),o.Matrix}},{key:"Encode",value:function(){if(this.width<0||this.height<0)throw this.className+"无效的尺寸！";this.FElements=this.GenerateQRCode(this.FText,this.FEncoding),this.FRows=this.FElements.Height,this.FColumns=this.FElements.Width,this.width=this.FColumns*this.FPixSize,this.height=this.FRows*this.FPixSize,this.canvas.brush.color=Ft.Black;var t,e=0,i=0;this.canvas.beginPath();try{for(var n=0;n<this.FRows;n++){t=this.FElements.Bytes[n],e=0;for(var o=0;o<this.FColumns;o++)1==t[o]&&this.canvas.fillBounds(e,i,this.FPixSize,this.FPixSize),e+=this.FPixSize;i+=this.FPixSize}}finally{this.canvas.paintPath()}}},{key:"Text",get:function(){return this.FText},set:function(t){this.FText!=t&&(this.FText=t,this.Encode())}}]),i}(ma),Ja=function(t){m()(i,t);var e=Sa(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,n)).StyleNo=oo.QRCode,s.Width=100,s.Height=100,s.FQRCode=new Ka(t,o,100,100),s}return l()(i,[{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){r.bitBlt(e.left,e.top,e.width,e.height,this.FQRCode.canvas,0,0,this.FQRCode.width,this.FQRCode.height)}},{key:"GetText",value:function(){return this.FQRCode.Text}},{key:"SetText",value:function(t){this.FQRCode.Text=t,f()(F()(i.prototype),"SetText",this).call(this,t)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.FQRCode.Text)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FQRCode.Text=Yl.HCLoadTextFromStream(t,n)}},{key:"ToHtml",value:function(){return""}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t),t.Value=this.FQRCode.Text}},{key:"ParseXml",value:function(t){}},{key:"RestrainSize",value:function(t,e){var i;this.Width>t&&(i=this.Width/t,this.Width=t,this.Height=L.Round(this.Height/i)),this.Height>e&&(i=this.Height/e,this.Height=e,this.Width=L.Round(this.Width/i))}}]),i}(Is),ja=0,Ya=1,Qa=2,Xa=3,Za=4,qa=0,$a=1,tl=2,el=3,il=4,nl=5,ol=[[" "," ","00","212222"],["!","!","01","222122"],['"','"',"02","222221"],["#","#","03","121223"],["$","$","04","121322"],["%","%","05","131222"],["&","&","06","122213"],["'","'","07","122312"],["(","(","08","132212"],[")",")","09","221213"],["*","*","10","221312"],["+","+","11","231212"],[",",",","12","112232"],["-","-","13","122132"],[".",".","14","122231"],["/","/","15","113222"],["0","0","16","123122"],["1","1","17","123221"],["2","2","18","223211"],["3","3","19","221132"],["4","4","20","221231"],["5","5","21","213212"],["6","6","22","223112"],["7","7","23","312131"],["8","8","24","311222"],["9","9","25","321122"],[":",":","26","321221"],[";",";","27","312212"],["<","<","28","322112"],["=","=","29","322211"],[">",">","30","212123"],["?","?","31","212321"],["@","@","32","232121"],["A","A","33","111323"],["B","B","34","131123"],["C","C","35","131321"],["D","D","36","112313"],["E","E","37","132113"],["F","F","38","132311"],["G","G","39","211313"],["H","H","40","231113"],["I","I","41","231311"],["J","J","42","112133"],["K","K","43","112331"],["L","L","44","132131"],["M","M","45","113123"],["N","N","46","113321"],["O","O","47","133121"],["P","P","48","313121"],["Q","Q","49","211331"],["R","R","50","231131"],["S","S","51","213113"],["T","T","52","213311"],["U","U","53","213131"],["V","V","54","311123"],["W","W","55","311321"],["X","X","56","331121"],["Y","Y","57","312113"],["Z","Z","58","312311"],["[","[","59","332111"],["\\","\\","60","314111"],["]","]","61","221411"],["^","^","62","431111"],["_","_","63","111224"],[String.fromCharCode(0),"`","64","111422"],[String.fromCharCode(1),"a","65","121124"],[String.fromCharCode(2),"b","66","121421"],[String.fromCharCode(3),"c","67","141122"],[String.fromCharCode(4),"d","68","141221"],[String.fromCharCode(5),"e","69","112214"],[String.fromCharCode(6),"f","70","112412"],[String.fromCharCode(7),"g","71","122114"],[String.fromCharCode(8),"h","72","122411"],[String.fromCharCode(9),"i","73","142112"],[String.fromCharCode(10),"j","74","142211"],[String.fromCharCode(11),"k","75","241211"],[String.fromCharCode(12),"l","76","221114"],[String.fromCharCode(13),"m","77","413111"],[String.fromCharCode(14),"n","78","241112"],[String.fromCharCode(15),"o","79","134111"],[String.fromCharCode(16),"p","80","111242"],[String.fromCharCode(17),"q","81","121142"],[String.fromCharCode(18),"r","82","121241"],[String.fromCharCode(19),"s","83","114212"],[String.fromCharCode(20),"t","84","124112"],[String.fromCharCode(21),"u","85","124211"],[String.fromCharCode(22),"v","86","411212"],[String.fromCharCode(23),"w","87","421112"],[String.fromCharCode(24),"x","88","421211"],[String.fromCharCode(25),"y","89","212141"],[String.fromCharCode(26),"z","90","214121"],[String.fromCharCode(27),"{","91","412121"],[String.fromCharCode(28),"|","92","111143"],[String.fromCharCode(29),"}","93","111341"],[String.fromCharCode(30),"~","94","131141"],[String.fromCharCode(31)," ","95","114113"],[" "," ","96","114311"],[" "," ","97","411113"],[" "," ","98","411311"],[" "," ","99","113141"],[" "," ","  ","114131"],[" "," ","  ","311141"],[" "," ","  ","411131"],[" "," ","  ","211412"],[" "," ","  ","211214"],[" "," ","  ","211232"]],sl=function(){function t(e){r()(this,t),this.FModul=1,this.FZoom=1,this.FWidth=1,this.FHeight=100,this.FModules=new Array(4),this.FText="",this.FCode="",this.FTextVisible=!0,this.onWidthChanged=null,this.SetText(e)}return l()(t,[{key:"IsDigit",value:function(t){return t>=0&&t<=9}},{key:"IsFourOrMoreDigits",value:function(t,e,i){i=0;var n=t.length;if(this.IsDigit(t[e])&&e+4<n)for(;e+i<n&&this.IsDigit(t[e+i]);)i++;return{numDigits:i,result:i>=4}}},{key:"FindCodeA",value:function(t){for(var e=0,i=ol.length;e<i;e++)if(t===ol[e][0])return e;return-1}},{key:"FindCodeB",value:function(t){for(var e=0,i=ol.length;e<i;e++)if(t===ol[e][1])return e;return-1}},{key:"FindCodeC",value:function(t){for(var e=0,i=ol.length;e<i;e++)if(t===ol[e][2])return e;return-1}},{key:"GetNextChar",value:function(t,e,i){var n=t.length-1;if(e>n)return{index:e,encoding:i,result:""};var o="",s="";return"&"===t[e]&&e+2<=n&&";"===t[e+2]&&("A"===(s=t[e+1].toUpperCase())||"B"===s||"C"===s||"S"===s||"1"===s||"2"===s||"3"===s||"4"===s)?{index:e+=3,encoding:i,result:o="&"+s+";"}:i===Xa&&e+1<=n?(o=t.substr(e,2),{index:e+=2,encoding:i,result:o}):(o=t.substr(e,1),{index:++e,encoding:i,result:o})}},{key:"StripControlCodes",value:function(t,e){for(var i,n,o="",s=0,r=t.length,a=ja;s<r;)i=(n=this.GetNextChar(t,s,a)).result,s=n.index,a=n.encoding,"&A;"!==i&&"&B;"!==i&&"&C;"!==i&&"&S;"!==i&&(!e||"&1;"!==i&&"&2;"!==i&&"&3;"!==i&&"&4;"!==i)&&(o+=i);return o}},{key:"GetNextPortion",value:function(t,e,i){var n,o,s,r,a,l,h=t.length;if(e>h-1)return{index:e,encoding:i,result:""};var c,u="",f="";"&"===t[e]&&e+2<h&&";"===t[e+2]&&("A"===(u=t[e+1].toUpperCase())||"B"===u||"C"===u||"S"===u||"1"===u||"2"===u||"3"===u||"4"===u?(u=t.substr(e,3),e+=3):u=""),n=this.FindCodeA(t[e]),o=this.FindCodeB(t[e]),a=Ya,-1===n&&-1!==o?a=Qa:-1!==n&&-1!==o&&(a=Za),s=0;var d=this.IsFourOrMoreDigits(t,e,s);if(s=d.numDigits,d.result&&(a=Xa),a===Xa)return s=2*parseInt(s/2),f=t.substr(e,s),f=i!==Xa?"&C;"+u+f:u+f,{index:e+=s,encoding:i=Xa,result:f};for(r=1;e+r<h&&(n=this.FindCodeA(t[e+r]),o=this.FindCodeB(t[e+r]),l=Ya,-1===n&&-1!==o?l=Qa:-1!==n&&-1!==o&&(l=Za),s=(d=this.IsFourOrMoreDigits(t,e+r,s)).numDigits,d.result&&(l=Xa),l!==Xa&&l!==a&&(a===Za?a=l:l===Za&&(l=a)),a===l);)r++;return a===Za&&(a=Qa),c=a===Ya?"&A;":"&B;",i===a||1!==r||i!==Ya&&i!==Qa||a!==Ya&&a!==Qa?i=a:c="&S;",f=c+u+t.substr(e,r),{index:e+=r,encoding:i,result:f}}},{key:"Encode",value:function(t){t=this.StripControlCodes(t,!1);for(var e,i="",n=0,o=ja,s=t.length;n<s;)n=(e=this.GetNextPortion(t,n,o)).index,o=e.encoding,i+=e.result;return i}},{key:"Convert",value:function(t){for(var e,i="",n=0,o=t.length;n<o;n++)e=t[n].charCodeAt()-1,L.isOdd(n)||(e+=5),i+=String.fromCharCode(e);return i}},{key:"GetCode",value:function(t){t=t.replace(/&FNC1;/g,"&1;"),t=this.Encode(t);var e,i,n,o=ja,s=0,r=this.GetNextChar(t,s,o);s=r.index,o=r.encoding;var a=r.result,l="";if("&A;"===a)o=Ya,e=103,l=ol[103][3];else if("&B;"===a)o=Qa,e=104,l=ol[104][3];else{if("&C;"!==a)throw"无效的条码内容！";o=Xa,e=105,l=ol[105][3]}var h=l;i=1;for(var c=t.length;s<c;){if(s=(r=this.GetNextChar(t,s,o)).index,o=r.encoding,"&A;"===(a=r.result)?(o=Ya,n=101):"&B;"===a?(o=Qa,n=100):"&C;"===a?(o=Xa,n=99):"&S;"===a?(o=o===Ya?Qa:Ya,n=98):n="&1;"===a?102:"&2;"===a?97:"&3;"===a?96:"&4;"===a?o===Ya?101:100:o===Ya?this.FindCodeA(a[0]):o===Qa?this.FindCodeB(a[0]):this.FindCodeC(a),n<0)throw"无效的条码内容！";h+=ol[n][3],e+=n*i,i++,"&S;"===a&&(o=o===Ya?Qa:Ya)}return h+=ol[e%=103][3],h+="2331112",h=this.Convert(h)}},{key:"OneBarProps",value:function(t){var e,i=0;switch(t){case"0":i=this.FModules[0],e=qa;break;case"1":i=this.FModules[1],e=qa;break;case"2":i=this.FModules[2],e=qa;break;case"3":i=this.FModules[3],e=qa;break;case"5":i=this.FModules[0],e=$a;break;case"6":i=this.FModules[1],e=$a;break;case"7":i=this.FModules[2],e=$a;break;case"8":i=this.FModules[3],e=$a;break;case"A":i=this.FModules[0],e=tl;break;case"B":i=this.FModules[1],e=tl;break;case"C":i=this.FModules[2],e=tl;break;case"D":i=this.FModules[3],e=tl;break;case"F":i=this.FModules[0],e=el;break;case"G":i=this.FModules[0],e=il;break;case"H":i=this.FModules[0],e=nl;break;default:throw"HCCode128计算宽度出错！"}return{w:i,lineType:e}}},{key:"GetBarWidth",value:function(t){this.FModules[0]=this.FModul,this.FModules[1]=2*this.FModul,this.FModules[2]=parseInt(3*this.FModules[1]/2),this.FModules[3]=2*this.FModules[1];for(var e=0,i=0,n=t.length;i<n;i++)e+=this.OneBarProps(t[i]).w;return e}},{key:"PaintTo",value:function(t,e){var i,n,o=0,s=e.height;this.FTextVisible&&(s-=12);for(var r=new nt,a=0,l=this.FCode.length;a<l;a++)qa,n=(i=this.OneBarProps(this.FCode[a])).lineType,t.brush.color=n!=qa?Ft.Black:Ft.White,r.reset(o,0,o+i.w*this.FZoom,s),o=r.right,r.offset(e.left,e.top),t.fillRect(r);""===this.FCode&&(t.pen.width=1,t.pen.color=Ft.Black,t.rectangleRect(e)),this.FTextVisible&&(t.font.size=8,t.font.styles.clear(),t.font.name="Arial",t.font.color=Ft.Black,""!==this.FCode?t.textOut(e.left+Math.trunc((e.width-t.textWidth(this.FText))/2),e.top+s,this.FText):t.textOut(e.left+Math.trunc((e.width-t.textWidth("无效条码"+this.FText))/2),e.top+Math.trunc((e.height-t.font.height)/2),"无效条码"+this.FText))}},{key:"_calcWidth",value:function(){var t;(t=""!==this.FCode?this.GetBarWidth(this.FCode)*this.FZoom:60)!==this.FWidth&&(this.FWidth=t,null!=this.onWidthChanged&&this.onWidthChanged())}},{key:"SetText",value:function(t){if(this.FText!==t){for(var e=0,i=t.length;e<i;e++)if(t.charCodeAt(e)>128)return void console.error("条码不支持的字符 "+t);this.FText=t;try{this.FCode=this.GetCode(this.FText)}catch(t){this.FCode=""}this._calcWidth()}}},{key:"SetZoom",value:function(t){this.FZoom!==t&&(this.FZoom=t,this._calcWidth())}},{key:"Text",get:function(){return this.FText},set:function(t){this.SetText(t)}},{key:"TextVisible",get:function(){return this.FTextVisible},set:function(t){this.FTextVisible=t}},{key:"Width",get:function(){return this.FWidth}},{key:"Height",get:function(){return this.FHeight},set:function(t){this.FHeight=t}},{key:"Zoom",get:function(){return this.FZoom},set:function(t){this.SetZoom(t)}}]),t}();function rl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var al=function(t){m()(i,t);var e=rl(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,n)).StyleNo=oo.BarCode,s.FCode128=new sl(o),s.FCode128.onWidthChanged=function(){s.Width=s.FCode128.Width},s.Width=s.FCode128.Width,s.Height=100,s}return l()(i,[{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){this.FCode128.PaintTo(a,e),f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l)}},{key:"GetText",value:function(){return this.FCode128.FText}},{key:"SetText",value:function(t){this.FCode128.Text=t,f()(F()(i.prototype),"SetText",this).call(this,t)}},{key:"SetWidth",value:function(t){f()(F()(i.prototype),"SetWidth",this).call(this,this.FCode128.Width)}},{key:"SetHeight",value:function(t){f()(F()(i.prototype),"SetHeight",this).call(this,t),this.FCode128.Height=this.Height}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FCode128.Text=t.Text}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.FCode128.Text)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FCode128.Text=Yl.HCLoadTextFromStream(t,n)}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t)}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t)}},{key:"RestrainSize",value:function(t,e){this.Height>e&&(this.Height=e)}}]),i}(Is);function ll(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var hl={None:1,Year:2,Month:4,Day:8,Hour:16,Minute:32,Second:64,Millisecond:128},cl=function(t){m()(i,t);var e=ll(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,n,o.format("yyyy-MM-dd hh:mm:ss"))).StyleNo=oo.DateTimePicker,s.FFormat="yyyy-MM-dd hh:mm:ss",s.FDateTime=o,s.Width=80,s.FPaddingLeft=2,s.FActiveArea=hl.None,s.FAreaRect=new nt,s.FNewYear="",s.FJoinKey=!1,s}return l()(i,[{key:"GetAreaPosition",value:function(t,e){for(var i=!1,n=-1,o=0,s=0;s<this.FFormat.length;s++)if((e?this.FFormat[s].toUpperCase():this.FFormat[s])==t)i||(i=!0),n<0&&(n=s),o++;else if(i)return{index:n,count:o};return{index:n,count:o}}},{key:"AppendFormat",value:function(t,e,i){i.reset(0,0,0,0);var n,o=0,s=-1;switch(e){case hl.Year:o=(n=this.GetAreaPosition("y",!1)).index,s=n.count;break;case hl.Month:o=(n=this.GetAreaPosition("M",!0)).index,s=n.count;break;case hl.Day:o=(n=this.GetAreaPosition("d",!1)).index,s=n.count;break;case hl.Hour:o=(n=this.GetAreaPosition("H",!0)).index,s=n.count;break;case hl.Minute:o=(n=this.GetAreaPosition("m",!1)).index,s=n.count;break;case hl.Second:o=(n=this.GetAreaPosition("s",!1)).index,s=n.count}if(s>0){var r="";o>0&&(r=this.FFormat.substr(0,o)),i.left=this.FPaddingLeft,""!==r&&(i.left+=t.textWidth(r));var a=t.textMetric(this.FFormat.substr(o,s));i.top=Math.trunc((this.Height-a.height)/2),i.right=i.left+a.width,i.bottom=i.top+a.height}}},{key:"GetAreaRect",value:function(t){var e=new nt;if(t===hl.None)return e;var i=this.hcl.hclCanvasTemp;return this.OwnerData.Style.TextStyles[this.TextStyleNo].ApplyStyle(i),""!==this.FFormat&&this.AppendFormat(i,t,e),e}},{key:"GetAreaAt",value:function(t,e){return this.GetAreaRect(hl.Year).pointInAt(t,e)?hl.Year:this.GetAreaRect(hl.Month).pointInAt(t,e)?hl.Month:this.GetAreaRect(hl.Day).pointInAt(t,e)?hl.Day:this.GetAreaRect(hl.Hour).pointInAt(t,e)?hl.Hour:this.GetAreaRect(hl.Minute).pointInAt(t,e)?hl.Minute:this.GetAreaRect(hl.Second).pointInAt(t,e)?hl.Second:this.GetAreaRect(hl.Millisecond).pointInAt(t,e)?hl.dtaMillisecond:hl.None}},{key:"SetDateTime",value:function(t){this.FDateTime!=t&&(this.FDateTime=t,f()(F()(i.prototype),"SetText",this).call(this,this.FDateTime.format(this.FFormat)),this.FAreaRect=this.GetAreaRect(this.FActiveArea))}},{key:"Power10",value:function(t){for(var e=10,i=2;i<=t;i++)e*=10;return e}},{key:"GetYear",value:function(t){var e=this.FDateTime.year,i=1999,n=L.tryParseInt(t);if(n.ok)if((i=n.value)<e){var o=this.Power10(t.length);e=Math.trunc(e/o),e=Math.trunc(e*o)+i}else e=i;return e}},{key:"SetInputYear",value:function(){""!==this.FNewYear&&(this.DateTime=lt.Create(this.GetYear(this.FNewYear),this.FDateTime.month,this.FDateTime.day,this.FDateTime.hour,this.FDateTime.minute,this.FDateTime.second),this.FNewYear="")}},{key:"SetFormat",value:function(t){this.FFormat!=t&&(this.FFormat=t,f()(F()(i.prototype),"SetText",this).call(this,this.FDateTime.format(this.FFormat)),this.FAreaRect=this.GetAreaRect(this.FActiveArea))}},{key:"DoPopup",value:function(){}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){var h=nt.CreateByRect(this.FAreaRect);h.offset(e.left,e.top),this.FActiveArea===hl.None||this.IsSelectComplate||l.Print||(a.brush.color=t.SelColor,a.fillRect(h)),f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l),this.FActiveArea!==hl.Year||""===this.FNewYear||l.Print||(a.brush.color=t.SelColor,a.fillRect(h),a.textRect(h,h.left,h.top,this.FNewYear))}},{key:"SetActive",value:function(t){f()(F()(i.prototype),"SetActive",this).call(this,t),this.Active||(this.FActiveArea===hl.Year&&this.SetInputYear(),this.FActiveArea=hl.None)}},{key:"MouseDown",value:function(t){this.Active=nt.Create(0,0,this.Width,this.Height).pointInAt(t.x,t.y);var e=this.GetAreaAt(t.x,t.y);return e!==this.FActiveArea&&(this.FActiveArea===hl.Year&&this.SetInputYear(),this.FActiveArea=e,this.FActiveArea!==hl.None&&(this.FAreaRect=this.GetAreaRect(this.FActiveArea)),this.OwnerData.Style.UpdateInfoRePaint()),this.DoPopup(),!0}},{key:"WantKeyDown",value:function(t){return!0}},{key:"KeyDown",value:function(t){if(this.Enabled&&!this.ReadOnly)switch(t.keyCode){case Ue:""!==this.FNewYear&&(this.FNewYear="",this.OwnerData.Style.UpdateInfoRePaint());break;case Le:this.FActiveArea===hl.Year&&(this.SetInputYear(),this.OwnerData.Style.UpdateInfoRePaint());break;case Je:this.FActiveArea>hl.None&&(this.FActiveArea===hl.Year&&this.SetInputYear(),this.FActiveArea=this.FActiveArea>>1,this.FAreaRect=this.GetAreaRect(this.FActiveArea),this.OwnerData.Style.UpdateInfoRePaint());break;case Ye:this.FActiveArea<hl.Millisecond&&(this.FActiveArea===hl.Year&&this.SetInputYear(),this.FActiveArea=this.FActiveArea<<1,this.FAreaRect=this.GetAreaRect(this.FActiveArea),this.OwnerData.Style.UpdateInfoRePaint())}}},{key:"KeyPress",value:function(t){if(this.Enabled&&!this.ReadOnly){var e=String.fromCharCode(t.keyCode),i=0,n=lt.CreateByDateTime(this.FDateTime);if(this.FActiveArea!==hl.None){if("0123456789".indexOf(e)>=0)switch(this.FActiveArea){case hl.Year:this.FNewYear.length>3&&(this.FNewYear=L.stringDelete(this.FNewYear,0,1)),this.FNewYear=this.FNewYear+e;break;case hl.Month:if((i=n.month)>9){if("0"==e)return;n=lt.Create(n.year,parseInt(e),n.day,n.hour,n.minute,n.second)}else if(1===i&&this.FJoinKey)"012".indexOf(e)>=0?(i=10*i+parseInt(e),n=lt.Create(n.year,i,n.day,n.hour,n.minute,n.second)):n=lt.Create(n.year,parseInt(e),n.day,n.hour,n.minute,n.second);else{if("0"===e)return;n=lt.Create(n.year,parseInt(e),n.day,n.hour,n.minute,n.second)}break;case hl.Day:if((i=n.day)>9){if(0===t.keyCode)return;n=lt.Create(n.year,n.month,parseInt(e),n.hour,n.minute,n.second)}else this.FJoinKey&&((i=10*i+parseInt(e))>lt.DaysInMonth(n.year,n.month)&&(i=parseInt(e)),n=lt.Create(n.year,n.month,i,n.hour,n.minute,n.second));break;case hl.Hour:if((i=n.hour)>9){if("0"===e)return;n=lt.Create(n.year,n.month,n.day,parseInt(e),n.minute,n.second)}else if(this.FJoinKey)(i=10*i+parseInt(e))>23&&(i=parseInt(e)),n=lt.Create(n.year,n.month,n.day,i,n.minute,n.second);else{if("0"===e)return;n=lt.Create(n.year,n.month,n.day,parseInt(e),n.minute,n.second)}break;case hl.Minute:if((i=n.minute)>9){if("0"===e)return;n=lt.Create(n.year,n.month,n.day,n.hour,parseInt(e),n.second)}else if(this.FJoinKey)(i=10*i+parseInt(e))>59&&(i=parseInt(e)),n=lt.Create(n.year,n.month,n.day,n.hour,i,n.second);else{if("0"===e)return;n=lt.Create(n.year,n.month,n.day,n.minute,parseInt(e),n.second)}break;case hl.Second:if((i=n.second)>9){if("0"===e)return;n=lt.Create(n.year,n.month,n.day,n.hour,n.minute,parseInt(e))}else if(this.FJoinKey)(i=10*i+parseInt(e))>59&&(i=parseInt(e)),n=lt.Create(n.year,n.month,n.day,n.hour,n.minute,i);else{if("0"===e)return;n=lt.Create(n.year,n.month,n.day,n.hour,n.minute,parseInt(e))}}this.FActiveArea!==hl.Year&&(this.FActiveArea=this.GetAreaAt(this.FAreaRect.left,this.FAreaRect.top),this.FActiveArea!==hl.None&&(this.FAreaRect=this.GetAreaRect(this.FActiveArea)),this.FJoinKey=!0,this.SetDateTime(n),this.DoItemChange(Yl.OffsetInner,rh.ContentChange)),this.OwnerData.Style.UpdateInfoRePaint()}}}},{key:"InsertText",value:function(t){return 1===t.length&&"0123456789".indexOf(t)>=0&&this.KeyPress({keyCode:t.charCodeAt(0),key:t[0]}),!1}},{key:"SetText",value:function(t){}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FFormat=t.Format,this.FDateTime=lt.CreateByDateTime(t.DateTime)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.FFormat),t.writeDateTime(this.FDateTime)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FFormat=Yl.HCLoadTextFromStream(t,n),this.FDateTime=t.readDateTime()}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t)}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t)}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.Format&&(this.FFormat=t.Format),null!=t.DateTime&&(this.FDateTime=t.DateTime)}},{key:"Format",get:function(){return this.FFormat},set:function(t){this.SetFormat(t)}},{key:"DateTime",get:function(){return this.FDateTime},set:function(t){this.SetDateTime(t)}}]),i}(ha);function ul(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var fl=0,dl=1,ml=function(){function t(){r()(this,t),this.FChecked=!1,this.OnSetChecked=null,this.Text="",this.TextValue="",this.Prefix="",this.ID="",this.Code="",this.Rect=new nt}return l()(t,[{key:"SetChecked",value:function(t){this.FChecked!=t&&(this.FChecked=t,null!=this.OnSetChecked&&this.OnSetChecked(this))}},{key:"Checked",get:function(){return this.FChecked},set:function(t){this.SetChecked(t)}}]),t}(),Sl=function(t){m()(i,t);var e=ul(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).StyleNo=oo.RadioGroup,o.Width=100,o.FMultSelect=!1,o.FItemHit=!1,o.FColumns=0,o.FBatchCount=0,o.FColumnWidth=0,o.FColumnAlign=!0,o.FItems=new ot,o.FItems.onAdded=function(t){o.DoItemNotify(t)},o.FItems.onRemoved=function(){o.ReLayout()},o.FRadioStyle=fl,o.RadioButtonWidth=16,o.BoxRight=!1,o.OnSetItemChecked=null,o}return l()(i,[{key:"ReLayout",value:function(){if(!(this.FBatchCount>0)){this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo);var t=this.OwnerData.Style.TempCanvas.font.height,e=0,i=0,n=0,o=0,s=this.FPaddingLeft,r=this.FPaddingTop,a=new it;if(0===this.FColumns){for(var l=0;l<this.FItems.count;l++)o=""!==this.FItems[l].Prefix?this.OwnerData.Style.TempCanvas.textWidth(this.FItems[l].Prefix):0,a=""!==this.FItems[l].Text?this.OwnerData.Style.TempCanvas.textMetric(this.FItems[l].Text):this.OwnerData.Style.TempCanvas.textMetric("H"),this.FColumnWidth>0?(n=Yl.LineCountWithWidth(this.FItems[l].Text,this.FColumnWidth-this.RadioButtonWidth-o,this.OwnerData.Style.TempCanvas,null),e=this.FColumnWidth,t<(i=n*(this.OwnerData.Style.TempCanvas.font.height+5)-5)&&(t=i)):(e=this.RadioButtonWidth+a.width+o,i=a.height),this.AutoSize&&l>0&&s+e>this.Width&&(s=this.FPaddingLeft,r+=i+this.FPaddingBottom,t=this.OwnerData.Style.TempCanvas.font.height),this.FItems[l].Rect.resetBounds(s,r,e,i),s+=e+this.FPaddingRight;this.AutoSize&&(this.Width=s),this.Height=r+t+this.FPaddingBottom}else{var h=0,c=1,u=this.FColumns;a.height=0,this.FColumns>this.FItems.count&&(u=this.FItems.count);for(var f=0;f<this.FItems.count;f++)o=""!==this.FItems[f].Prefix?this.OwnerData.Style.TempCanvas.textWidth(this.FItems[f].Prefix):0,a=""!==this.FItems[f].Text?this.OwnerData.Style.TempCanvas.textMetric(this.FItems[f].Text):this.OwnerData.Style.TempCanvas.textMetric("H"),this.FColumnWidth>0?(n=Yl.LineCountWithWidth(this.FItems[f].Text,this.FColumnWidth-this.RadioButtonWidth-o,this.OwnerData.Style.TempCanvas,null),e=this.FColumnWidth,t<(i=n*(this.OwnerData.Style.TempCanvas.font.height+5)-5)&&(t=i)):(e=this.RadioButtonWidth+a.width+o,i=a.height),this.FItems[f].Rect.resetBounds(s,r,e,i),s+=e+this.FPaddingRight,c===u?(s>h&&(h=s),f<this.FItems.count-1&&(c=1,s=this.FPaddingLeft,r+=t+this.FPaddingBottom,t=this.OwnerData.Style.TempCanvas.font.height)):c++;if(this.Height=r+t+this.FPaddingBottom,this.FColumnAlign&&this.FItems.count>0){for(var d=0;d<u-1;d++){for(c=d,h=this.FItems[c].Rect.right;c+u<this.FItems.count;)c+=u,h<this.FItems[c].Rect.right&&(h=this.FItems[c].Rect.right);for(h+=this.FPaddingRight,c=d+1,this.FItems[c].Rect.offset(h-this.FItems[c].Rect.left,0);c+u<this.FItems.count;)c+=u,this.FItems[c].Rect.offset(h-this.FItems[c].Rect.left,0)}if(this.AutoSize){for(c=u-1,h=this.FItems[c].Rect.right;c+u<this.FItems.count;)c+=u,h<this.FItems[c].Rect.right&&(h=this.FItems[c].Rect.right);this.Width=h+this.FPaddingRight}}else this.AutoSize&&(this.Width=h)}}}},{key:"GetItemAt",value:function(t,e){var i=0;this.FItemHit||this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo);for(var n=0;n<this.FItems.count;n++)if(this.FItemHit){if(this.FItems[n].Rect.pointInAt(t,e))return n}else{var o=new nt;if(this.BoxRight?o.resetBounds(this.FItems[n].Rect.right-this.RadioButtonWidth,this.FItems[n].Rect.top,this.RadioButtonWidth,this.RadioButtonWidth):(i=""!==this.FItems[n].Prefix?this.OwnerData.Style.TempCanvas.textWidth(this.FItems[n].Prefix):0,o.resetBounds(this.FItems[n].Rect.left+i,this.FItems[n].Rect.top,this.RadioButtonWidth,this.RadioButtonWidth)),o.pointInAt(t,e))return n}return-1}},{key:"SetColumns",value:function(t){this.FColumns!=t&&(this.FColumns=t,this.ReLayout())}},{key:"SetColumnWidth",value:function(t){this.FColumnWidth!=t&&(this.FColumnWidth=t,this.ReLayout())}},{key:"SetColumnAlign",value:function(t){this.FColumnAlign!=t&&(this.FColumnAlign=t,this.ReLayout())}},{key:"DoSetItemChecked",value:function(t,e){this.FItems[t].Checked=e,this.DoItemChange(Yl.OffsetInner,rh.ContentChange),null!=this.OnSetItemChecked&&this.OnSetItemChecked(this,t)}},{key:"DoItemNotify",value:function(t){var e=this;t.OnSetChecked=function(t){e.DoItemSetChecked(t)},this.ReLayout()}},{key:"DoItemSetChecked",value:function(t){if(!this.FMultSelect&&t.Checked)for(var e=this.FItems.indexOf(t),i=0;i<this.FItems.count;i++)i!==e&&(this.FItems[i].Checked=!1)}},{key:"DoPaintItems",value:function(t,e){for(var i=new et,n=new nt,o=0,s=0;s<=this.FItems.count-1;s++)if(i.x=this.FItems[s].Rect.left,i.y=this.FItems[s].Rect.top,i.offset(e.left,e.top),""!==this.FItems[s].Prefix?(t.textOut(i.x,i.y,this.FItems[s].Prefix),o=this.OwnerData.Style.TempCanvas.textWidth(this.FItems[s].Prefix)):o=0,this.BoxRight?n.resetBounds(this.FItems[s].Rect.right+e.left-this.RadioButtonWidth,i.y,this.RadioButtonWidth,this.RadioButtonWidth):n.resetBounds(i.x+o,i.y,this.RadioButtonWidth,this.RadioButtonWidth),this.FItems[s].Checked?this.hcl.theme.drawFrameControl(t,n,new Set([Pi]),this.FRadioStyle===fl?Ti:bi):this.hcl.theme.drawFrameControl(t,n,new Set([]),this.FRadioStyle===fl?Ti:bi),this.FColumnWidth>0){var r=i.x+this.RadioButtonWidth;this.BoxRight&&(r=i.x);var a=new at;Yl.LineCountWithWidth(this.FItems[s].Text,this.FColumnWidth-this.RadioButtonWidth-o,t,a);var l=i.y;r+=o;for(var h=0;h<a.count;h++)t.textOut(r,l,a[h]),l+=t.font.height+5}else this.BoxRight?t.textOut(i.x+o,i.y,this.FItems[s].Text):t.textOut(i.x+o+this.RadioButtonWidth,i.y,this.FItems[s].Text)}},{key:"FormatToDrawItem",value:function(t,e){this.Width<this.FMinWidth&&(this.Width=this.FMinWidth),this.Height<this.FMinHeight&&(this.Height=this.FMinHeight)}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){if(f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l),l.Print||(this.IsSelectComplate?(a.brush.color=t.SelColor,a.fillRect(e)):this.FMouseIn&&(a.brush.color=Yl.clBtnFace,a.fillRect(e))),t.TextStyles[this.TextStyleNo].ApplyStyle(a,l.ScaleY/l.Zoom),this.Enabled||l.Print||(a.font.color=Ft.Gray),this.AutoSize)this.DoPaintItems(a,e);else{a.save();try{a.clipRect(e),this.DoPaintItems(a,e)}finally{a.restore()}}}},{key:"SetTextStyleNo",value:function(t){this.TextStyleNo!=t&&(f()(F()(i.prototype),"SetTextStyleNo",this).call(this,t),this.ReLayout())}},{key:"MouseDown",value:function(t){var e=f()(F()(i.prototype),"MouseDown",this).call(this,t);if(this.Enabled&&this.OwnerData.CanEdit()&&t.button==ae){var n=this.GetItemAt(t.x,t.y);n>=0&&this.DoSetItemChecked(n,!this.FItems[n].Checked)}return e}},{key:"MouseMove",value:function(t){return this.OwnerData.Style.Cursor=Se,f()(F()(i.prototype),"MouseMove",this).call(this,t)}},{key:"GetOffsetAt",value:function(t){return t<=this.FPaddingLeft?Yl.OffsetBefor:t>=this.Width-this.FPaddingRight?Yl.OffsetAfter:Yl.OffsetInner}},{key:"GetText",value:function(){for(var t=f()(F()(i.prototype),"GetText",this).call(this),e=0;e<this.FItems.count;e++)t+=""!=t?"，"+this.FItems[e].Text:this.FItems[e].Text;return t}},{key:"TextEffective",value:function(){for(var t="",e=0;e<this.FItems.count;e++)this.FItems[e].Checked&&(t+=""!=t?"，"+this.FItems[e].Text:this.FItems[e].Text);return t}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FItems.clear();for(var e=0;e<t.Items.count;e++)this.AddItem(t.Items[e].Text,t.Items[e].TextValue,t.Items[e].Checked,t.Items[e].Prefix,t.Items[e].ID,t.Items[e].Code)}},{key:"Clear",value:function(){f()(F()(i.prototype),"Clear",this).call(this),this.BeginAdd();try{this.FItems.clear()}finally{this.EndAdd()}}},{key:"BeginAdd",value:function(){this.FBatchCount++}},{key:"EndAdd",value:function(){this.FBatchCount>0&&this.FBatchCount--,0==this.FBatchCount&&this.ReLayout()}},{key:"AddItem",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",r=new ml;r.Checked=i,r.Text=t,r.TextValue=e,r.Prefix=n,r.ID=o,r.Code=s,this.FItems.add(r)}},{key:"InsertRadioItem",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=new ml;o.Checked=n,o.Text=e,o.TextValue=i,this.FItems.insert(t,o)}},{key:"SetAllChecked",value:function(t){for(var e=0;e<this.FItems.count;e++)this.FItems[e].Checked=t;this.DoChange()}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),t.writeByte(this.FColumns),t.writeUInt16(this.FColumnWidth);var o=0;this.FMultSelect&&(o|=128),this.FItemHit&&(o|=64),this.FColumnAlign&&(o|=32),this.BoxRight&&(o|=16),t.writeByte(o);var s="",r="",a="",l="",h="";if(this.FItems.count>0){s=this.FItems[0].Text,r=this.FItems[0].TextValue,a=this.FItems[0].Prefix,l=this.FItems[0].ID,h=this.FItems[0].Code;for(var c=1;c<this.FItems.count;c++)s+=Yl.sLineBreak+this.FItems[c].Text,r+=Yl.sLineBreak+this.FItems[c].TextValue,a+=Yl.sLineBreak+this.FItems[c].Prefix,l+=Yl.sLineBreak+this.FItems[c].ID,h+=Yl.sLineBreak+this.FItems[c].Code}Yl.HCSaveTextToStream(t,s),Yl.HCSaveTextToStream(t,r),Yl.HCSaveTextToStream(t,a),Yl.HCSaveTextToStream(t,l),Yl.HCSaveTextToStream(t,h);for(var u=0;u<this.FItems.count;u++)t.writeBoolean(this.FItems[u].Checked);t.writeByte(this.FRadioStyle)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.BeginAdd();try{if(n>39){this.FColumns=t.readByte(),this.FColumnWidth=n>62?t.readUInt16():0;var o=t.readByte();this.FMultSelect=L.isOdd(o>>7),this.FItemHit=L.isOdd(o>>6),this.FColumnAlign=L.isOdd(o>>5),this.BoxRight=L.isOdd(o>>4)}this.FItems.clear();var s=Yl.HCLoadTextFromStream(t,n),r=null;if(""!==s){r=s.split(Yl.sLineBreak);for(var a=0;a<r.length;a++)this.AddItem(r[a])}if(n>35&&""!==(s=Yl.HCLoadTextFromStream(t,n))){r=s.split(Yl.sLineBreak);for(var l=0;l<r.length;l++)this.FItems[l].TextValue=r[l]}if(n>64&&""!==(s=Yl.HCLoadTextFromStream(t,n))){r=s.split(Yl.sLineBreak);for(var h=0;h<r.length;h++)this.FItems[h].Prefix=r[h]}if(n>65){if(""!==(s=Yl.HCLoadTextFromStream(t,n))){r=s.split(Yl.sLineBreak);for(var c=0;c<r.length;c++)this.FItems[c].ID=r[c]}if(""!==(s=Yl.HCLoadTextFromStream(t,n))){r=s.split(Yl.sLineBreak);for(var u=0;u<r.length;u++)this.FItems[u].Code=r[u]}}for(var d=0;d<this.FItems.count;d++)this.FItems[d].Checked=t.readBoolean();n>33&&(this.FRadioStyle=t.readByte())}finally{this.EndAdd()}}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t)}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t)}},{key:"ToJSONString",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=',"Items":[',n=0;n<this.FItems.count;n++)e+='{"Checked":'+this.FItems[n].Checked+',"Text":"'+this.FItems[n].Text+'","TextValue":"'+this.FItems[n].TextValue+'","Prefix":"'+this.FItems[n].Prefix+'"},';return","===e[e.length-1]&&(e=e.substring(0,e.length-1)),e+="]",t||(e+=',"MultSelect":'+this.FMultSelect),f()(F()(i.prototype),"ToJSONString",this).call(this,t)+e}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t);var e=!1;if(null!=t.Columns&&(this.FColumns=t.Columns,e=!0),null!=t.ColumnWidth&&(this.FColumnWidth=t.ColumnWidth,e=!0),null!=t.ColumnAlign&&(this.FColumnAlign=t.ColumnAlign,e=!0),null!=t.MultSelect&&(this.FMultSelect=L.parseBooleanDef(t.MultSelect,!1)),null!=t.ItemHit&&(this.FItemHit=t.ItemHit),null!=t.BoxRight&&(this.BoxRight=t.BoxRight),(null!=t.Style||null!=t.RadioStyle)&&("CheckBox"==t.Style?this.FRadioStyle=dl:this.FRadioStyle=fl),null!=t.ClearItem&&this.Items.clear(),null!=t.Items)for(var n=!1,o=!1,s=t.Items.length-1;s>=0;s--)n=null!=t.Items[s].Checked&&t.Items[s].Checked,this.FMultSelect||o||!n?o&&(n=!1):o=!0,this.InsertRadioItem(0,null!=t.Items[s].Text?t.Items[s].Text:"",null!=t.Items[s].TextValue?t.Items[s].TextValue:"",n);else 0==this.FItems.count&&(this.AddItem("选项1"),this.AddItem("选项2"),this.AddItem("选项3"));e&&this.ReLayout()}},{key:"MultSelect",get:function(){return this.FMultSelect},set:function(t){this.FMultSelect=t}},{key:"RadioStyle",get:function(){return this.FRadioStyle},set:function(t){this.FRadioStyle=t}},{key:"ItemHit",get:function(){return this.FItemHit},set:function(t){this.FItemHit=t}},{key:"Columns",get:function(){return this.FColumns},set:function(t){this.SetColumns(t)}},{key:"ColumnWidth",get:function(){return this.FColumnWidth},set:function(t){this.SetColumnWidth(t)}},{key:"ColumnAlign",get:function(){return this.FColumnAlign},set:function(t){this.SetColumnAlign(t)}},{key:"Items",get:function(){return this.FItems}}]),i}(cs);function pl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var yl=function(t){m()(i,t);var e=pl(i);function i(t,n,o,s){var a;return r()(this,i),(a=e.call(this,t,n)).StyleNo=oo.SupSubScript,a.FPadding=1,a.FActiveArea=Xl.None,a.FMouseMoveArea=Xl.None,a.FCaretOffset=-1,a.FSupText=o,a.FSubText=s,a.FSupRect=new nt,a.FSubRect=new nt,a}return l()(i,[{key:"FormatToDrawItem",value:function(t,e){var i=t.Style;i.TextStyles[this.TextStyleNo].ApplySupSubStyle(i.TempCanvas);var n=i.TempCanvas.textHeight("H"),o=Math.max(i.TempCanvas.textWidth(this.FSupText),this.FPadding),s=Math.max(i.TempCanvas.textWidth(this.FSubText),this.FPadding);this.Width=o>s?o+4*this.FPadding:s+4*this.FPadding,this.Height=2*n+4*this.FPadding,this.FSupRect.resetBounds(this.FPadding,this.FPadding,o,n),this.FSubRect.resetBounds(this.FPadding,this.Height-this.FPadding-n,s,n)}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){if(!a.Print){(this.Active||this.FMouseIn)&&(r.brush.color=Yl.clBtnFace,r.fillRect(e));var l=new nt;this.FActiveArea!==Xl.None&&(this.FActiveArea===Xl.Top?l.resetRect(this.FSupRect):this.FActiveArea==Xl.Bottom&&l.resetRect(this.FSubRect),l.offset(e.left,e.top),l.inFlate(2,2),r.pen.color=Ft.Blue,r.rectangleRect(l)),this.FMouseMoveArea!==Xl.None&&this.FMouseMoveArea!==this.FActiveArea&&(this.FMouseMoveArea===Xl.Top?l.resetRect(this.FSupRect):this.FMouseMoveArea===Xl.Bottom&&l.resetRect(this.FSubRect),l.offset(e.left,e.top),l.inFlate(2,2),r.pen.color=Yl.clMedGray,r.rectangleRect(l))}t.TextStyles[this.TextStyleNo].ApplySupSubStyle(r,a.ScaleY/a.Zoom),r.textOut(e.left+this.FSupRect.left,e.top+this.FSupRect.top,this.FSupText),r.textOut(e.left+this.FSubRect.left,e.top+this.FSubRect.top,this.FSubText)}},{key:"SetActive",value:function(t){f()(F()(i.prototype),"SetActive",this).call(this,t),t||(this.FActiveArea=Xl.None)}},{key:"MouseLeave",value:function(){f()(F()(i.prototype),"MouseLeave",this).call(this),this.FMouseMoveArea=Xl.None}},{key:"MouseDown",value:function(t){var e=f()(F()(i.prototype),"MouseDown",this).call(this,t);this.FMouseMoveArea!=this.FActiveArea&&(this.FActiveArea=this.FMouseMoveArea,this.OwnerData.Style.UpdateInfoReCaret());var n=this.GetAreaOffset(this.FActiveArea,t.x);return n!=this.FCaretOffset&&(this.FCaretOffset=n,this.OwnerData.Style.UpdateInfoReCaret()),e}},{key:"MouseMove",value:function(t){var e=f()(F()(i.prototype),"MouseMove",this).call(this,t);if(this.FOutSelectInto)this.FMouseMoveArea=Xl.None;else{var n=this.GetExpressArea(t.x,t.y);n!=this.FMouseMoveArea&&(this.FMouseMoveArea=n,this.OwnerData.Style.UpdateInfoRePaint())}return e}},{key:"KeyDown",value:function(t){switch(t.keyCode){case Ee:this.DoBackspaceKeyDown();break;case Je:this.DoLeftKeyDown();break;case Ye:this.DoRightKeyDown();break;case Xe:this.DoDeleteKeyDown();break;case Ke:this.DoHomeKeyDown();break;case ze:this.DoEndKeyDown()}}},{key:"KeyPress",value:function(t){if(this.FActiveArea===Xl.None)return 0;this.InsertText(String.fromCharCode(t.keyCode))}},{key:"InsertText",value:function(t){return this.FActiveArea!=Xl.None&&(this.FActiveArea==Xl.Top?this.SupText=L.stringInsert(this.FSupText,this.FCaretOffset,t):this.FActiveArea==Xl.Bottom&&(this.SubText=L.stringInsert(this.FSubText,this.FCaretOffset,t)),this.FCaretOffset+=t.length,this.FormatDirty(),!0)}},{key:"GetCaretInfo",value:function(t){this.FActiveArea!=Xl.None?(this.OwnerData.Style.TextStyles[this.TextStyleNo].ApplySupSubStyle(this.OwnerData.Style.TempCanvas),this.FActiveArea===Xl.Top?(t.Height=this.FSupRect.bottom-this.FSupRect.top,t.X=this.FSupRect.left+this.OwnerData.Style.TempCanvas.textWidth(this.FSupText.substr(0,this.FCaretOffset)),t.Y=this.FSupRect.top):this.FActiveArea===Xl.Bottom&&(t.Height=this.FSubRect.bottom-this.FSubRect.top,t.X=this.FSubRect.left+this.OwnerData.Style.TempCanvas.textWidth(this.FSubText.substr(0,this.FCaretOffset)),t.Y=this.FSubRect.top)):t.Visible=!1}},{key:"GetExpressArea",value:function(t,e){var i=Xl.None;return this.FSupRect.pointInAt(t,e)?i=Xl.Top:this.FSubRect.pointInAt(t,e)&&(i=Xl.Bottom),i}},{key:"GetAreaOffset",value:function(t,e){var i=-1,n="",o=0;switch(t){case Xl.Top:n=this.FSupText,o=e-this.FSupRect.left;break;case Xl.Bottom:n=this.FSubText,o=e-this.FSubRect.left}return t!=Xl.None&&(this.OwnerData.Style.TextStyles[this.TextStyleNo].ApplySupSubStyle(this.OwnerData.Style.TempCanvas),i=Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,n,o),this.OwnerData.Style.ApplyTempStyle(oo.Null)),i}},{key:"DoBackspaceKeyDown",value:function(){switch(this.FActiveArea){case Xl.Top:this.SupText=this.BackDeleteChar(this.FSupText);break;case Xl.Bottom:this.SubText=this.BackDeleteChar(this.FSubText)}this.FormatDirty()}},{key:"DoLeftKeyDown",value:function(){this.FCaretOffset>0&&this.FCaretOffset--}},{key:"DoRightKeyDown",value:function(){switch(this.FActiveArea){case Xl.Top:this.FCaretOffset<this.FSupText.length&&this.FCaretOffset++;break;case Xl.Bottom:this.FCaretOffset<this.FSubText.length&&this.FCaretOffset++}}},{key:"DoDeleteKeyDown",value:function(){switch(this.FActiveArea){case Xl.Top:this.SupText=this.DeleteChar(this.FSupText);break;case Xl.Bottom:this.SubText=this.DeleteChar(this.FSubText)}this.FormatDirty()}},{key:"DoHomeKeyDown",value:function(){this.FCaretOffset=0}},{key:"DoEndKeyDown",value:function(){switch(this.FActiveArea){case Xl.Top:this.FCaretOffset=this.FSupText.length;break;case Xl.Bottom:this.FCaretOffset=this.FSubText.length}this.FormatDirty()}},{key:"BackDeleteChar",value:function(t){if(this.FCaretOffset>0)return t=L.stringDelete(t,this.FCaretOffset-1,1),this.FCaretOffset--,t}},{key:"DeleteChar",value:function(t){return this.FCaretOffset<t.length&&(t=L.stringDelete(t,this.FCaretOffset,1)),t}},{key:"SupRect",get:function(){return this.FSupRect},set:function(t){this.FSupRect=t}},{key:"SubRect",get:function(){return this.FSubRect},set:function(t){this.FSubRect=t}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FSupText=t.SupText,this.FSubText=t.SubText}},{key:"WantKeyDown",value:function(t){return!0}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.FSupText),Yl.HCSaveTextToStream(t,this.FSubText)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FSupText=Yl.HCLoadTextFromStream(t,n),this.FSubText=Yl.HCLoadTextFromStream(t,n)}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.SupText&&(this.FSupText=t.SupText),null!=t.SubText&&(this.FSubText=t.SubText)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"SupText":"'+this.SupText+'","SubText":"'+this.SubText+'"'}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t)}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t)}},{key:"SupText",get:function(){return this.FSupText},set:function(t){this.FSupText=t,this.DoChange()}},{key:"SubText",get:function(){return this.FSubText},set:function(t){this.FSubText=t,this.DoChange()}}]),i}(hs);function Fl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}function vl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Il=function(t){m()(i,t);var e=vl(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,n,o)).StyleNo=oo.Button,s.FDown=!1,s}return l()(i,[{key:"MouseLeave",value:function(){this.FDown=!1,f()(F()(i.prototype),"MouseLeave",this).call(this)}},{key:"MouseMove",value:function(t){return this.OwnerData.Style.Cursor=pe,f()(F()(i.prototype),"MouseMove",this).call(this,t)}},{key:"MouseDown",value:function(t){return this.Enabled&&this.ClientRect().pointInAt(t.x,t.y)&&(this.FDown=t.button===ae),f()(F()(i.prototype),"MouseDown",this).call(this,t)}},{key:"MouseUp",value:function(t){return this.FDown=!1,f()(F()(i.prototype),"MouseUp",this).call(this,t)}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){this.IsSelectComplate?a.brush.color=t.SelColor:this.FDown?a.brush.color=Yl.clHighlight:this.FMouseIn?a.brush.color=Yl.clBtnFace:a.brush.color=Yl.clMedGray,a.fillRect(e),f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l)}}]),i}(function(t){m()(i,t);var e=Fl(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,n)).StyleNo=oo.Label,s.FText=o,s}return l()(i,[{key:"GetText",value:function(){return this.FText}},{key:"SetText",value:function(t){this.FText=t,f()(F()(i.prototype),"SetText",this).call(this,t)}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){t.TextStyles[this.TextStyleNo].ApplyStyle(r,a.ScaleY/a.Zoom);var l=r.textMetric(this.FText);r.textOut(e.left+Math.trunc((e.width-l.width)/2),e.top+Math.trunc((e.height-l.height)/2),this.FText)}},{key:"FormatToDrawItem",value:function(t,e){if(this.AutoSize){t.Style.ApplyTempStyle(this.TextStyleNo);var i=t.Style.TempCanvas.textMetric(this.FText);this.Width=this.FPaddingLeft+this.FPaddingRight+i.width,this.Height=this.FPaddingTop+this.FPaddingBottom+i.height}this.Width<this.FMinWidth&&(this.Width=this.FMinWidth),this.Height<this.FMinHeight&&(this.Height=this.FMinHeight)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FText=t.Text}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.FText)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FText=Yl.HCLoadTextFromStream(t,n)}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t)}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.Text&&(this.FText=t.Text)}}]),i}(cs));function gl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Cl=function(t){m()(i,t);var e=gl(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).StyleNo=oo.Bullet,o.FBulletStyle=ah.Symbol,o.FText="●",o.FPrefix="",o.FSuffix="",o.Width=n.Style.TextStyles[o.TextStyleNo].FontHeight,o.Height=o.Width,o}return l()(i,[{key:"GetText",value:function(){return this.FText}},{key:"SetText",value:function(t){this.FText=t}},{key:"FormatToDrawItem",value:function(t,e){t.Style.ApplyTempStyle(this.TextStyleNo);var i=t.Style.TempCanvas.textMetric(this.FText);this.Width=i.width+5,this.Height=i.height}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){this.IsSelectComplate&&(r.brush.color=t.SelColor,r.fillRect(e)),r.brush.style=Mt.Clear,t.TextStyles[this.TextStyleNo].ApplyStyle(r,a.ScaleY/a.Zoom),r.textOut(e.left,e.top+Math.trunc((e.bottom-e.top-this.Height)/2),this.FText)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FText=t.Text}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),t.writeByte(this.FBulletStyle),Yl.HCSaveTextToStream(t,this.FText)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FBulletStyle=t.readByte(),this.FText=Yl.HCLoadTextFromStream(t,n)}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t)}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t)}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.Text&&(this.FText=t.Text)}},{key:"SetOrderNumber",value:function(t){switch(this.FBulletStyle){case ah.OrderCustom:this.FText=this.FPrefix+t.toString()+this.FSuffix;break;case ah.hbsOrderRoman:this.FText=this.FPrefix+Yl.ROMANUMBER[t-1]+this.FSuffix;break;case ah.hbsOrderCustomCircle:this.FText=this.FPrefix+Yl.CIRCLENUMBER[t-1]+this.FSuffix;break;default:this.FText=t.toString()}}},{key:"BulletStyle",get:function(){return this.FBulletStyle},set:function(t){this.FBulletStyle=t}},{key:"Prefix",get:function(){return this.FPrefix},set:function(t){this.FPrefix=t}},{key:"Suffix",get:function(){return this.FSuffix},set:function(t){this.FSuffix=t}}]),i}(hs);function wl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Al=function(t){m()(i,t);var e=wl(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FLeft=0,o.FTop=0,o.FLock=!1,o.FPageIndex=-1,o.FDrawRect=new nt,o.FMousePt=new et,o}return l()(i,[{key:"PointInClient",value:function(t,e){return nt.CreateByBounds(0,0,this.Width,this.Height).pointInAt(t,e)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FLeft=t.Left,this.FTop=t.Top,this.Width=t.Width,this.Height=t.Height}},{key:"MouseDown",value:function(t){if(this.FLock)return this.Active;var e=f()(F()(i.prototype),"MouseDown",this).call(this,t);return this.Resizing||this.FMousePt.reset(t.x,t.y),e}},{key:"MouseMove",value:function(t){if(this.FLock)return this.Active;var e=f()(F()(i.prototype),"MouseMove",this).call(this,t);return this.Resizing||t.button!=ae||this.hcl.keyDownStates[Ge]||(this.FLeft+=t.x-this.FMousePt.x,this.FTop+=t.y-this.FMousePt.y),e}},{key:"MouseUp",value:function(t){if(this.FLock)return!1;var e=!1;if(this.Resizing){if(this.Resizing=!1,this.ResizeWidth<1||this.ResizeHeight<1)return e;this.Width=this.ResizeWidth,this.Height=this.ResizeHeight,e=!0}return e}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l),this.Active&&a.rectangleRect(this.FDrawRect)}},{key:"SaveToStreamRange",value:function(t,e,i){t.writeInt32(this.StyleNo),t.writeInt32(this.FLeft),t.writeInt32(this.FTop),t.writeInt32(this.Width),t.writeInt32(this.Height),t.writeInt32(this.FPageIndex),t.writeBoolean(this.FLock)}},{key:"LoadFromStream",value:function(t,e,i){this.FLeft=t.readInt32(),this.FTop=t.readInt32(),this.Width=t.readInt32(),this.Height=t.readInt32(),i>28&&(this.FPageIndex=t.readInt32()),this.FLock=i>37&&t.readBoolean()}},{key:"ToXml",value:function(t){t.SetAttribute("sno",this.StyleNo.toString()),t.SetAttribute("left",this.FLeft.toString()),t.SetAttribute("top",this.FTop.toString()),t.SetAttribute("width",this.Width.toString()),t.SetAttribute("height",this.Height.toString()),t.SetAttribute("pageindex",this.FPageIndex.toString()),this.FLock&&t.SetAttribute("lock",this.FLock.toString())}},{key:"ParseXml",value:function(t){}},{key:"DrawRect",get:function(){return this.FDrawRect},set:function(t){this.FDrawRect=t}},{key:"Left",get:function(){return this.FLeft},set:function(t){this.FLeft=t}},{key:"Top",get:function(){return this.FTop},set:function(t){this.FTop=t}},{key:"PageIndex",get:function(){return this.FPageIndex},set:function(t){this.FPageIndex=t}},{key:"Lock",get:function(){return this.FLock},set:function(t){this.FLock=t}}]),i}(Is),Dl=function(t){m()(i,t);var e=wl(i);function i(){var t;return r()(this,i),(t=e.call(this)).OnInsertItem=null,t.OnRemoveItem=null,t}return l()(i,[{key:"doAdded_",value:function(t){f()(F()(i.prototype),"doAdded_",this).call(this,t),null!=this.OnInsertItem&&this.OnInsertItem(t)}},{key:"doRemoved_",value:function(t){f()(F()(i.prototype),"doRemoved_",this).call(this,t),null!=this.OnRemoveItem&&this.OnRemoveItem(t)}}]),i}(ot);function Pl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var kl=function(t){m()(i,t);var e=Pl(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).StyleNo=oo.FloatLine,o.Width=100,o.Height=70,o.FLeftTop=null,o.FShapeLine=Hr.Create(t,et.Create(0,0),et.Create(o.Width,o.Height)),o}return l()(i,[{key:"GetShapeLeftTop",value:function(){var t=new et;return this.FShapeLine.StartPt.x<this.FShapeLine.EndPt.x?t.x=this.FShapeLine.StartPt.x:t.x=this.FShapeLine.EndPt.x,this.FShapeLine.StartPt.y<this.FShapeLine.EndPt.y?t.y=this.FShapeLine.StartPt.y:t.y=this.FShapeLine.EndPt.y,t}},{key:"SetActive",value:function(t){f()(F()(i.prototype),"SetActive",this).call(this,t),this.FShapeLine.Active=this.Active}},{key:"PointInClient",value:function(t,e){return this.FShapeLine.PointInClient(t,e)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FShapeLine.Assign(t.FShapeLine)}},{key:"MouseDown",value:function(t){var e=this.FShapeLine.MouseDown(t);return this.Active=this.FShapeLine.ActiveObj!=_r,this.Active&&t.button==ae&&(this.Resizing=this.FShapeLine.ActiveObj==Mr||this.FShapeLine.ActiveObj==Lr,this.Resizing?(this.FResizeX=t.x,this.FResizeY=t.y,this.FLeftTop=this.GetShapeLeftTop()):this.FShapeLine.ActiveObj==Er&&(this.FLeftTop=this.GetShapeLeftTop())),e}},{key:"MouseMove",value:function(t){var e=this.FShapeLine.MouseMove(t);return this.Active&&this.Resizing&&(this.FResizeX=t.x,this.FResizeY=t.y),e&&(this.OwnerData.Style.Cursor=this.FShapeLine.Cursor),e}},{key:"_CalcNewLeftTop",value:function(){var t=this.GetShapeLeftTop();this.Left=this.Left+t.x-this.FLeftTop.x,this.Top=this.Top+t.y-this.FLeftTop.y,this.FShapeLine.StartPt.reset(this.FShapeLine.StartPt.x-t.x,this.FShapeLine.StartPt.y-t.y),this.FShapeLine.EndPt.reset(this.FShapeLine.EndPt.x-t.x,this.FShapeLine.EndPt.y-t.y)}},{key:"MouseUp",value:function(t){return this.Resizing?(this.Resizing=!1,this._CalcNewLeftTop(),this.Width=Math.abs(this.FShapeLine.EndPt.x-this.FShapeLine.StartPt.x),this.Height=Math.abs(this.FShapeLine.EndPt.y-this.FShapeLine.StartPt.y)):this.FShapeLine.ActiveObj==Er&&this._CalcNewLeftTop(),this.FShapeLine.MouseUp(t)}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){this.FShapeLine.PaintTo(r,e,a)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),this.FShapeLine.SaveToStream(t)}},{key:"LoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),n>26)this.FShapeLine.LoadFromStream(t);else{this.FShapeLine.Width=1,this.FShapeLine.Color=Ft.Black;var o=t.readInt32(),s=t.readInt32();this.FShapeLine.StartPt.reset(o,s),o=t.readInt32(),s=t.readInt32(),this.FShapeLine.EndPt.reset(o,s)}}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t)}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t)}},{key:"Line",get:function(){return this.FShapeLine}}]),i}(Al);function xl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Rl=function(t){m()(i,t);var e=xl(i);function i(t,n){var o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"123456";return r()(this,i),(o=e.call(this,t,n)).StyleNo=oo.FloatBarCode,o.FAutoSize=!0,o.FCode128=new sl(s),o.FCode128.onWidthChanged=function(){o.doCodeWidthChanged()},o.Width=o.FCode128.Width,o.Height=100,o}return l()(i,[{key:"doCodeWidthChanged",value:function(){this.Width=this.FCode128.Width}},{key:"GetPenWidth",value:function(){return this.FCode128.Zoom}},{key:"SetPenWidth",value:function(t){this.FCode128.Zoom=t}},{key:"GetShowText",value:function(){return this.FCode128.TextVisible}},{key:"SetShowText",value:function(t){this.FCode128.TextVisible=t}},{key:"GetText",value:function(){return this.FCode128.Text}},{key:"SetText",value:function(t){this.FCode128.Text=t,f()(F()(i.prototype),"SetText",this).call(this,t)}},{key:"SetWidth",value:function(t){f()(F()(i.prototype),"SetWidth",this).call(this,this.FCode128.Width)}},{key:"SetHeight",value:function(t){f()(F()(i.prototype),"SetHeight",this).call(this,t),this.FCode128.Height=this.Height}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FCode128.Text=t.Text}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){this.FCode128.PaintTo(a,e),f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.FCode128.Text),t.writeBoolean(this.FAutoSize),t.writeBoolean(this.FCode128.TextVisible),t.writeByte(this.FCode128.Zoom)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FCode128.Text=Yl.HCLoadTextFromStream(t,n),n>34&&(this.FAutoSize=t.readBoolean(),this.FCode128.TextVisible=t.readBoolean(),this.FCode128.Zoom=t.readByte())}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t)}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t)}},{key:"PenWidth",get:function(){return this.GetPenWidth()},set:function(t){this.SetPenWidth(t)}},{key:"AutoSize",get:function(){return this.FAutoSize},set:function(t){this.FAutoSize=t}},{key:"ShowText",get:function(){return this.GetShowText()},set:function(t){this.SetShowText(t)}}]),i}(Al);function Tl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var bl=function(t){m()(i,t);var e=Tl(i);function i(t,n){var o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"http://www.hcview.cn";return r()(this,i),(o=e.call(this,t,n)).StyleNo=oo.FloatQRCode,o.FQRCode=new Ka(t,s,100,100),o.Width=100,o.Height=100,o}return l()(i,[{key:"GetText",value:function(){return this.FQRCode.Text}},{key:"SetText",value:function(t){this.FQRCode.Text=t,f()(F()(i.prototype),"SetText",this).call(this,t)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FText=t.Text}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){a.bitBlt(e.left,e.top,this.Width,this.Height,this.FQRCode.canvas,0,0,this.FQRCode.width,this.FQRCode.height),f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.FQRCode.Text)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FQRCode.Text=Yl.HCLoadTextFromStream(t,n)}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t)}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t)}}]),i}(Al);function Bl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Nl=function(){function t(){r()(this,t),this.Index="",this.Title="",this.Text="",this.TitleRect=new nt,this.Rect=new nt,this.Solve=!1}return l()(t,[{key:"SaveToStream",value:function(t){Yl.HCSaveTextToStream(t,this.Title),Yl.HCSaveTextToStream(t,this.Text),Yl.HCSaveTextToStream(t,this.Index);var e=0;this.Solve&&(e|=128),t.writeByte(e)}},{key:"LoadFromStream",value:function(t,e){if(this.Title=Yl.HCLoadTextFromStream(t,e),this.Text=Yl.HCLoadTextFromStream(t,e),e>66){this.Index=Yl.HCLoadTextFromStream(t,e);var i=t.readByte();this.Solve=L.isOdd(i>>7)}else this.Index="",this.Solve=!1}},{key:"ToXml",value:function(t){}},{key:"ParseXml",value:function(t){}}]),t}(),Ol=function(t){m()(i,t);var e=Bl(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).StyleNo=oo.Annotate,o.FContent=new Nl,o.Replys=new ot,o.ID=0,o.MarkType=ch.Beg,o.Width=0,o.Height=0,o}return l()(i,[{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FContent.Text=t.Content.Text,this.FContent.Title=t.Content.Title,this.ID=t.ID}},{key:"IsBeginMark",value:function(){return this.MarkType===ch.Beg}},{key:"IsEndMark",value:function(){return this.MarkType===ch.End}},{key:"GetOffsetAt",value:function(t){return t>=0&&t<=this.Width?this.MarkType===ch.Beg?Yl.OffsetAfter:Yl.OffsetBefor:f()(F()(i.prototype),"GetOffsetAt",this).call(this,t)}},{key:"JustifySplit",value:function(){return!1}},{key:"FormatToDrawItem",value:function(t,e){this.Width=0,this.Height=0}},{key:"AddReply",value:function(t,e,i){var n=new Nl;n.Index=i,n.Title=t,n.Text=e,this.Replys.add(n)}},{key:"SaveToStreamRange",value:function(t,e,n){if(f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),t.writeUInt32(this.ID),t.writeByte(this.MarkType),this.MarkType===ch.End){this.FContent.SaveToStream(t);var o=this.Replys.count;t.writeUInt32(o);for(var s=0;s<o;s++)this.Replys[s].SaveToStream(t)}}},{key:"LoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.ID=t.readUInt32(),this.MarkType=t.readByte(),this.MarkType===ch.End){this.FContent.LoadFromStream(t,n);var o=t.readUInt32();if(o>0)for(var s=null,r=0;r<o;r++)(s=new Nl).LoadFromStream(t,n),this.Replys.add(s)}}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t)}},{key:"ParseXml",value:function(t){f()(F()(i.prototype),"ParseXml",this).call(this,t)}},{key:"Content",get:function(){return this.FContent}}]),i}(ss);function _l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var El=function(t){m()(i,t);var e=_l(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).StyleNo=oo.FloatImage,o.Image=new Yr(t,n),o.Image.OnImageLoaded=function(t,e){o.DoImageLoaded(t,e)},o.Width=o.Image.Width,o.Height=o.Image.Height,o.OnImageLoaded=null,o}return l()(i,[{key:"DoImageLoaded",value:function(t,e){null!==this.OnImageLoaded&&this.OnImageLoaded(t,e)}},{key:"DoRestrainImageSize",value:function(){this.Image.RestrainSize(this.Width,this.Height)}},{key:"SetWidth",value:function(t){f()(F()(i.prototype),"SetWidth",this).call(this,t),this.Image.RestrainSize(this.Width,this.Height)}},{key:"SetHeight",value:function(t){f()(F()(i.prototype),"SetHeight",this).call(this,t),this.Image.RestrainSize(this.Width,this.Height)}},{key:"Clear",value:function(){this.Image.Clear()}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.Image.Assign(t.Image)}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){this.Image.PaintTo(t,e,n,o,s,r,a,l),f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l)}},{key:"LoadGraphicFile",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.Image.LoadGraphicFile(t,(function(t){t&&(n?(e.Width=e.Image.Image.width,e.Height=e.Image.Image.height):e.DoRestrainImageSize()),e.DoChange(),null!=i&&i(t)}),n)}},{key:"LoadGraphicStream",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:rrue;this.Image.LoadGraphicStream(t,(function(t){t&&(n?(e.Width=e.Image.Image.width,e.Height=e.Image.Image.height):e.DoRestrainImageSize()),e.DoChange(),null!=i&&i(t)}),n)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),this.Image.SaveToStream(t)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),t.readInt32(),this.Image.LoadFromStream(t,e,n)}}]),i}(Al);function Ml(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Ll=function(t){m()(i,t);var e=Ml(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FMouseLBDouble=!1,o.FMouseDownReCaret=!1,o.FMouseDownX=-1,o.FMouseDownY=-1,o.FMouseMoveDrawItemNo=-1,o.FSelectSeekNo=-1,o.FSelectSeekOffset=-1,o.FReadOnly=!1,o.FCheckEmptyItem=!1,o.OnItemResized=null,o.OnItemMouseDown=null,o.OnItemMouseUp=null,o.OnDrawItemMouseMove=null,o.OnCreateItem=null,o.OnAcceptActionBefor=null,o.OnAcceptAction=null,o.OnSelectBound=null,o.OnSelectApplyTextStyle=null,o.InitializeField(),o.SetEmptyData(),o}return l()(i,[{key:"SelectByMouseDownShift",value:function(t,e){var i,n=!0,o=-1,s=-1;return this.SelectExists()?this.IsSelectSeekStart()?t<this.FSelectSeekNo||t===this.FSelectSeekNo&&e<this.FSelectSeekOffset||t>this.FSelectSeekNo&&t<this.SelectInfo.EndItemNo||t===this.FSelectSeekNo&&e>this.FSelectSeekOffset||t===this.SelectInfo.EndItemNo&&e<this.SelectInfo.EndItemOffset?(o=this.SelectInfo.EndItemNo,s=this.SelectInfo.EndItemOffset,t=(i=this.AdjustSelectRange(t,e,o,s)).startItemNo,e=i.startItemOffset,o=i.endItemNo,s=i.endItemOffset):t>this.SelectInfo.EndItemNo||t===this.SelectInfo.EndItemNo&&e>this.SelectInfo.EndItemOffset?(o=this.SelectInfo.EndItemNo,s=this.SelectInfo.EndItemOffset,o=(i=this.AdjustSelectRange(o,s,t,e)).startItemNo,s=i.startItemOffset,t=i.endItemNo,e=i.endItemOffset):n=!1:t>this.FSelectSeekNo||t===this.FSelectSeekNo&&e>this.FSelectSeekOffset||t>this.SelectInfo.StartItemNo&&t<this.FSelectSeekNo||t===this.FSelectSeekNo&&e<this.FSelectSeekOffset||t===this.SelectInfo.StartItemNo&&e>this.SelectInfo.StartItemOffset?(o=this.SelectInfo.StartItemNo,s=this.SelectInfo.StartItemOffset,o=(i=this.AdjustSelectRange(o,s,t,e)).startItemNo,s=i.startItemOffset,t=i.endItemNo,e=i.endItemOffset):t<this.SelectInfo.StartItemNo||t===this.SelectInfo.StartItemNo&&e<this.SelectInfo.StartItemOffset?(o=this.SelectInfo.StartItemNo,s=this.SelectInfo.StartItemOffset,t=(i=this.AdjustSelectRange(t,e,o,s)).startItemNo,e=i.startItemOffset,o=i.endItemNo,s=i.endItemOffset):n=!1:this.SelectInfo.StartItemNo>=0&&(t<this.SelectInfo.StartItemNo||t===this.SelectInfo.StartItemNo&&e<this.SelectInfo.StartItemOffset?(o=this.SelectInfo.StartItemNo,s=this.SelectInfo.StartItemOffset,t=(i=this.AdjustSelectRange(t,e,o,s)).startItemNo,e=i.startItemOffset,o=i.endItemNo,s=i.endItemOffset):t>this.SelectInfo.StartItemNo||t===this.SelectInfo.StartItemNo&&e>this.SelectInfo.StartItemOffset?(o=this.SelectInfo.StartItemNo,s=this.SelectInfo.StartItemOffset,o=(i=this.AdjustSelectRange(o,s,t,e)).startItemNo,s=i.startItemOffset,t=i.endItemNo,e=i.endItemOffset):n=!1),{itemNo:t,offset:e,result:n}}},{key:"SetEmptyData",value:function(){if(0===this.Items.count){var t=this.CreateDefaultTextItem();t.ParaFirst=!0,this.Items.add(t),this.DrawItems.clear(),this.InitializeField(),this.DrawItems.MarkFormatDelete(0,this.DrawItems.count-1),this.FormatInit(),this.NewDrawItem(0,1,0,this.CalcEmptyItemDrawRect(t),!0,!0,-1),this.FFormatHeightChange=!0,this.SetFormatHeightChange(),this.ReSetSelectAndCaretByOffset(0,0)}}},{key:"EmptyDataInsertItem",value:function(t){return!(t.StyleNo>oo.Null&&""===t.Text)&&(t.ParaNo=this.Items[0].ParaNo,this.UndoAction_DeleteItem(0,0),this.Items.clear(),this.DrawItems.clear(),t.ParaFirst=!0,this.Items.add(t),this.UndoAction_InsertItem(0,0),this.SelectInfo.StartItemOffset=this.GetItemOffsetAfter(0),this.SelectInfo.StartRestrain=!0,this.DoItemChange(0,0,rh.ContentChange),this.ReFormat(),!0)}},{key:"SelectPerfect",value:function(){if(this.SelectInfo.EndItemNo>=0)for(var t=this.SelectInfo.StartItemNo;t<=this.SelectInfo.EndItemNo;t++)if(this.Items[t].StyleNo<oo.Null&&this.Items[t].IsSelectPart)return!1;return!0}},{key:"RectItemAction",value:function(t,e){var i=!1,n=-1,o=-1;if(this.Items[t].StyleNo<oo.Null){var s=this.GetFormatRangeByOffset(t,1,n,o);n=s.firstDrawItemNo,o=s.lastItemNo,this.FormatPrepare(n,o),this.Undo_New(),this.Items[t].MangerUndo?this.UndoAction_ItemSelf(t,Yl.OffsetInner):this.UndoAction_ItemMirror(t,Yl.OffsetInner),(i=e(this.Items[t]))&&(this.ReFormatData(n,o,0),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret()),this.InitializeMouseField()}return i}},{key:"TextItemAction",value:function(t,e){var i=!1,n=-1,o=-1;if(this.Items[t].StyleNo>oo.Null){var s=this.GetFormatRange(t,0);n=s.firstDrawItemNo,o=s.lastItemNo,this.FormatPrepare(n,o),this.Undo_New(),this.UndoAction_ItemMirror(t,0),(i=e(this.Items[t]))&&(this.ReFormatData(n,o,0),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret()),this.InitializeMouseField()}return i}},{key:"InitializeMouseField",value:function(){this.FMouseLBDowning=!1,this.FMouseDownItemNo=-1,this.FMouseDownItemOffset=-1,this.FMouseMoveItemNo=-1,this.FMouseMoveItemOffset=-1,this.FMouseMoveDrawItemNo=-1,this.FMouseMoveRestrain=!1,this.FSelecting=!1,this.FDraging=!1}},{key:"DoSelectApplyTextStyle",value:function(t){return null===this.OnSelectApplyTextStyle||this.OnSelectApplyTextStyle(this,t)}},{key:"IsSelectSeekStart",value:function(){return this.FSelectSeekNo===this.SelectInfo.StartItemNo&&this.FSelectSeekOffset===this.SelectInfo.StartItemOffset}},{key:"AdjustSelectRange",value:function(t,e,i,n){var o=!1,s=this.SelectInfo.StartItemNo,r=this.SelectInfo.EndItemNo;if(t<i?(o=!0,this.Items[t].Length>0&&e===this.GetItemOffsetAfter(t)&&t<this.Items.count-1&&!this.Items[t+1].ParaFirst&&(t+=1,e=0),t!==i&&i>=0&&this.Items[i].Length>0&&!this.Items[i].ParaFirst&&(0===n||this.Items[i].StyleNo<oo.Null&&n===Yl.OffsetInner&&!this.Items[i].SelectExists())&&(this.Items[i].DisSelect(),i-=1,n=this.GetItemOffsetAfter(i))):i<t&&(o=!1,t>0&&0===e&&!this.Items[t].ParaFirst&&(t-=1,e=this.GetItemOffsetAfter(t)),t!==i&&(n===this.GetItemOffsetAfter(i)||this.Items[i].StyleNo<oo.Null&&n===Yl.OffsetInner&&!this.Items[i].SelectExists())&&(this.Items[i].DisSelect(),i<this.Items.count-1&&!this.Items[i+1].ParaFirst&&(i+=1,n=0))),t===i?n>e?this.Items[t].StyleNo<oo.Null?(this.SelectInfo.StartItemNo=t,this.SelectInfo.StartItemOffset=e,e===Yl.OffsetBefor&&n===Yl.OffsetAfter?(this.SelectInfo.EndItemNo=i,this.SelectInfo.EndItemOffset=n):(this.SelectInfo.EndItemNo=-1,this.SelectInfo.EndItemOffset=-1)):(this.SelectInfo.StartItemNo=t,this.SelectInfo.StartItemOffset=e,this.SelectInfo.EndItemNo=t,this.SelectInfo.EndItemOffset=n):n<e?this.Items[t].StyleNo<oo.Null?n===Yl.OffsetBefor?(this.SelectInfo.StartItemNo=t,this.SelectInfo.StartItemOffset=n,this.SelectInfo.EndItemNo=t,this.SelectInfo.EndItemOffset=e):(this.SelectInfo.StartItemNo=t,this.SelectInfo.StartItemOffset=e,this.SelectInfo.EndItemNo=-1,this.SelectInfo.EndItemOffset=-1):(this.SelectInfo.StartItemNo=i,this.SelectInfo.StartItemOffset=n,this.SelectInfo.EndItemNo=i,this.SelectInfo.EndItemOffset=e):(this.SelectInfo.EndItemNo>=0&&this.Items[this.SelectInfo.EndItemNo].DisSelect(),this.SelectInfo.StartItemNo>=0&&(0!==e&&e!==this.GetItemOffsetAfter(this.SelectInfo.StartItemNo)||this.Items[this.SelectInfo.StartItemNo].DisSelect()),this.SelectInfo.StartItemNo=t,this.SelectInfo.StartItemOffset=e,this.SelectInfo.EndItemNo=-1,this.SelectInfo.EndItemOffset=-1):o?(this.SelectInfo.StartItemNo=t,this.SelectInfo.StartItemOffset=e,this.SelectInfo.EndItemNo=i,this.SelectInfo.EndItemOffset=n):(this.SelectInfo.StartItemNo=i,this.SelectInfo.StartItemOffset=n,this.SelectInfo.EndItemNo=t,this.SelectInfo.EndItemOffset=e),s>=0)if(s>this.SelectInfo.StartItemNo)for(var a=s;a>=this.SelectInfo.StartItemNo+1;a--)this.Items[a].DisSelect();else for(var l=s;l<=this.SelectInfo.StartItemNo-1;l++)this.Items[l].DisSelect();if(this.SelectInfo.EndItemNo<0)for(var h=r;h>=this.SelectInfo.StartItemNo+1;h--)this.Items[h].DisSelect();else for(var c=r;c>=this.SelectInfo.EndItemNo+1;c--)this.Items[c].DisSelect();return{startItemNo:t,startItemOffset:e,endItemNo:i,endItemOffset:n}}},{key:"DoLoadFromStream",value:function(t,e,n){if(this.FReadOnly=!1,this.Loading||this.CanEdit()){f()(F()(i.prototype),"DoLoadFromStream",this).call(this,t,e,n),this.BeginFormat();try{this.FCheckEmptyItem=!1,this.InsertStream(t,e,n),n>48||n>47&&(t.readBoolean(),this.FReadOnly=!1),this.FCheckEmptyItem&&this.DeleteEmptyItem(),this.ReSetSelectAndCaretByOffset(0,0)}finally{this.EndFormat()}}}},{key:"ReSetSelectAndCaretByOffset",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];f()(F()(i.prototype),"ReSetSelectAndCaretByOffset",this).call(this,t,e,n),this.FSelectSeekNo=this.SelectInfo.StartItemNo,this.FSelectSeekOffset=this.SelectInfo.StartItemOffset,this.InitializeMouseField()}},{key:"DoAcceptActionBefor",value:function(t,e,i){return null!==this.OnAcceptActionBefor&&this.OnAcceptActionBefor(this,t,e,i)}},{key:"DoAcceptAction",value:function(t,e,i){var n=this.Items[t].AcceptAction(e,this.SelectInfo.StartRestrain,i);return n&&null!=this.OnAcceptAction&&(n=this.OnAcceptAction(this,t,e,i)),n}},{key:"DoDrawItemMouseMove",value:function(t,e,i,n,o){null!==this.OnDrawItemMouseMove&&this.OnDrawItemMouseMove(t,e,i,n,o)}},{key:"CheckInsertItemCount",value:function(t,e){return 0}},{key:"DoItemMouseLeave",value:function(t){this.Items[t].MouseLeave()}},{key:"DoItemMouseEnter",value:function(t){this.Items[t].MouseEnter()}},{key:"DoItemResized",value:function(t){this.Change(),null!==this.OnItemResized&&this.OnItemResized(this,t)}},{key:"GetHeight",value:function(){return this.CalcContentHeight()}},{key:"SetReadOnly",value:function(t){this.FReadOnly=t}},{key:"MouseMoveDrawItemNo",get:function(){return this.FMouseMoveDrawItemNo}},{key:"CreateItemByStyle",value:function(t){var e=null;if(t<oo.Null)switch(t){case oo.Image:e=new Yr(this.hcl,this,0,0);break;case oo.Table:e=new Ir(this.hcl,this,1,1,1);break;case oo.Tab:e=new Xr(this.hcl,this,0,0);break;case oo.Line:e=new qr(this.hcl,this,1,1);break;case oo.Express:e=new na(this.hcl,this,"","","","");break;case oo.Domain:e=this.CreateDefaultDomainItem();break;case oo.CheckBox:e=new sa(this.hcl,this,"勾选框",!1);break;case oo.Gif:e=new aa(this.hcl,this,1,1);break;case oo.Edit:e=new ha(this.hcl,this,"");break;case oo.Combobox:e=new fa(this.hcl,this,"");break;case oo.QRCode:e=new Ja(this.hcl,this,"");break;case oo.Button:e=new Il(this.hcl,this,"");break;case oo.BarCode:e=new al(this.hcl,this,"");break;case oo.Fraction:e=new ta(this.hcl,this,"","");break;case oo.Fraction2:e=new ia(this.hcl,this,"","");break;case oo.DateTimePicker:e=new cl(this.hcl,this,lt.Now());break;case oo.RadioGroup:e=new Sl(this.hcl,this);break;case oo.SupSubScript:e=new yl(this.hcl,this,"","");break;case oo.Bullet:e=new Cl(this.hcl,this);break;case oo.Annotate:e=new Ol(this.hcl,this);break;case oo.FloatLine:e=new kl(this.hcl,this);break;case oo.FloatBarCode:e=new Rl(this.hcl,this);break;case oo.FloatQRCode:e=new bl(this.hcl,this);break;case oo.FloatImage:e=new El(this.hcl,this);break;default:throw"HC异常：未找到类型 "+t.toString()+" 对应的创建Item代码！"}else(e=this.CreateDefaultTextItem()).StyleNo=t;return null!=this.OnCreateItem&&this.OnCreateItem(e),e}},{key:"CanEditItem",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.FReadOnly?(n&&this.DoCanNotEditNotify("不可编辑：当前Data只读(ReadOnly)！"),!1):f()(F()(i.prototype),"CanEditItem",this).call(this,t,e,n)}},{key:"Clear",value:function(){this.InitializeField();var t=0,e=0;this.FItems.count>0&&(t=this.Items[0].StyleNo,e=this.Items[0].ParaNo),f()(F()(i.prototype),"Clear",this).call(this),t>oo.Null&&t<this.Style.TextStyles.count&&(this.FCurStyleNo=t),e<this.Style.ParaStyles.count&&(this.FCurParaNo=e),this.SetEmptyData()}},{key:"ApplySameItem",value:function(t,e,i){var n=this.Items[t];if(n.StyleNo<oo.Null)n.MangerUndo?this.UndoAction_ItemSelf(t,Yl.OffsetInner):this.UndoAction_ItemMirror(t,Yl.OffsetInner),n.ApplySelectTextStyle(this.Style,i),n.isClass(hs)?this.CurStyleNo=n.TextStyleNo:n.StyleNo===oo.Domain&&(this.CurStyleNo=n.GetTextStyleNo());else if(this.DoSelectApplyTextStyle(t)){var o=i.GetMatchStyleNo(this.hcl,this.Style,n.StyleNo);if(this.CurStyleNo=o,n.IsSelectComplate){if(this.UndoAction_ItemStyle(t,this.SelectInfo.EndItemOffset,o),n.StyleNo=o,this.MergeItemToNext(t)&&(this.UndoAction_InsertText(t,this.Items[t].Length-this.Items[t+1].Length+1,this.Items[t+1].Text),this.UndoAction_DeleteItem(t+1,0),this.Items.delete(t+1),e--),t>0){var s=this.Items[t-1].Length;this.MergeItemToPrio(t)&&(this.UndoAction_InsertText(t-1,this.Items[t-1].Length-this.Items[t].Length+1,this.Items[t].Text),this.UndoAction_DeleteItem(t,0),this.Items.delete(t),e--,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.SelectInfo.StartItemOffset=s,this.SelectInfo.EndItemNo=this.SelectInfo.StartItemNo,this.SelectInfo.EndItemOffset=s+this.SelectInfo.EndItemOffset)}}else{var r=n.Text,a=r.substr(this.SelectInfo.StartItemOffset+1-1,this.SelectInfo.EndItemOffset-this.SelectInfo.StartItemOffset),l=r.substr(0,this.SelectInfo.StartItemOffset),h=this.Items[t].BreakByOffset(this.SelectInfo.EndItemOffset);if(null!==h){this.UndoAction_DeleteText(t,this.SelectInfo.EndItemOffset+1,h.Text),this.Style.States.Include(oh.InsertBreakItem);try{this.Items.insert(t+1,h)}finally{this.Style.States.Exclude(oh.InsertBreakItem)}this.UndoAction_InsertItem(t+1,0),e++}if(""!==l){this.UndoAction_DeleteText(t,this.SelectInfo.StartItemOffset+1,a),n.Text=l;var c=this.CreateDefaultTextItem();if(c.ParaNo=n.ParaNo,c.StyleNo=o,c.Text=a,null!==h)this.Items.insert(t+1,c),this.UndoAction_InsertItem(t+1,0),e++;else{if(t<this.Items.count-1&&!this.Items[t+1].ParaFirst&&this.MergeItemText(c,this.Items[t+1]))return this.UndoAction_InsertText(t+1,1,a),this.Items[t+1].Text=a+this.Items[t+1].Text,c.dispose(),this.SelectInfo.StartItemNo=t+1,this.SelectInfo.StartItemOffset=0,this.SelectInfo.EndItemNo=t+1,void(this.SelectInfo.EndItemOffset=a.length);this.Items.insert(t+1,c),this.UndoAction_InsertItem(t+1,0),e++}this.SelectInfo.StartItemNo=t+1,this.SelectInfo.StartItemOffset=0,this.SelectInfo.EndItemNo=t+1,this.SelectInfo.EndItemOffset=a.length}else if(this.UndoAction_ItemStyle(t,this.SelectInfo.EndItemOffset,o),n.StyleNo=o,this.MergeItemToPrio(t)){this.UndoAction_InsertText(t-1,this.Items[t-1].Length-this.Items[t].Length+1,this.Items[t].Text),this.UndoAction_DeleteItem(t,0),this.Items.delete(t),e--,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1;var u=this.Items[this.SelectInfo.StartItemNo].Length;this.SelectInfo.StartItemOffset=u-a.length,this.SelectInfo.EndItemNo=this.SelectInfo.StartItemNo,this.SelectInfo.EndItemOffset=u}}}return e}},{key:"ApplyRangeStartItem",value:function(t,e,i){var n=this.Items[t];if(n.StyleNo<oo.Null)n.MangerUndo?this.UndoAction_ItemSelf(t,this.SelectInfo.StartItemOffset):this.UndoAction_ItemMirror(t,this.SelectInfo.StartItemOffset),n.ApplySelectTextStyle(this.Style,i),n.isClass(hs)?this.CurStyleNo=n.TextStyleNo:n.StyleNo===oo.Domain&&(this.CurStyleNo=n.GetTextStyleNo());else if(this.DoSelectApplyTextStyle(t)){var o=i.GetMatchStyleNo(this.hcl,this.Style,n.StyleNo);if(n.StyleNo!==o)if(this.CurStyleNo=o,n.IsSelectComplate)this.UndoAction_ItemStyle(t,0,o),n.StyleNo=o;else{var s=this.Items[t].BreakByOffset(this.SelectInfo.StartItemOffset);this.UndoAction_DeleteText(t,this.SelectInfo.StartItemOffset+1,s.Text),this.Style.States.Include(oh.InsertBreakItem);try{this.Items.insert(t+1,s)}finally{this.Style.States.Exclude(oh.InsertBreakItem)}this.UndoAction_InsertItem(t+1,0),this.UndoAction_ItemStyle(t+1,0,o),s.StyleNo=o,e++,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=0,this.SelectInfo.EndItemNo=this.SelectInfo.EndItemNo+1}}return e}},{key:"ApplyRangeEndItem",value:function(t,e,i){var n=this.Items[t];if(n.StyleNo<oo.Null)n.MangerUndo?this.UndoAction_ItemSelf(t,this.SelectInfo.EndItemOffset):this.UndoAction_ItemMirror(t,this.SelectInfo.EndItemOffset),n.ApplySelectTextStyle(this.Style,i);else if(this.DoSelectApplyTextStyle(t)){var o=i.GetMatchStyleNo(this.hcl,this.Style,n.StyleNo);if(n.StyleNo!=o)if(n.IsSelectComplate)this.UndoAction_ItemStyle(t,this.SelectInfo.EndItemOffset,o),n.StyleNo=o;else{var s=n.Text,r=s.substr(0,this.SelectInfo.EndItemOffset);this.UndoAction_DeleteBackText(t,1,r),n.Text=L.stringDelete(s,0,this.SelectInfo.EndItemOffset);var a=this.CreateDefaultTextItem();a.ParaNo=n.ParaNo,a.StyleNo=o,a.Text=r,a.ParaFirst=n.ParaFirst,n.ParaFirst&&(this.UndoAction_ItemParaFirst(t,0,!1),n.ParaFirst=!1),this.Items.insert(t,a),this.UndoAction_InsertItem(t,0),e++}}return e}},{key:"ApplyRangeNorItem",value:function(t,e){var i=this.Items[t];if(i.StyleNo<oo.Null)i.MangerUndo?this.UndoAction_ItemSelf(t,Yl.OffsetInner):this.UndoAction_ItemMirror(t,Yl.OffsetInner),i.ApplySelectTextStyle(this.Style,e);else if(this.DoSelectApplyTextStyle(t)){var n=e.GetMatchStyleNo(this.hcl,this.Style,i.StyleNo);this.UndoAction_ItemStyle(t,0,n),i.StyleNo=n}}},{key:"ApplySelectTextStyle",value:function(t){if(this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ContentChange)){this.Undo_New(),this.InitializeField();var e,i=0,n=-1,o=-1;if(this.SelectExists()){if(this.SelectInfo.EndItemNo<0)this.Items[this.SelectInfo.StartItemNo].StyleNo<oo.Null&&(this.Items[this.SelectInfo.StartItemNo].MangerUndo?this.UndoAction_ItemSelf(this.SelectInfo.StartItemNo,Yl.OffsetInner):this.UndoAction_ItemMirror(this.SelectInfo.StartItemNo,Yl.OffsetInner),this.Items[this.SelectInfo.StartItemNo].ApplySelectTextStyle(this.Style,t),this.Items[this.SelectInfo.StartItemNo].IsFormatDirty?(n=(e=this.GetFormatRange(n,o)).firstDrawItemNo,o=e.lastItemNo,this.FormatPrepare(n,o),this.ReFormatData(n,o)):this.FormatInit());else{n=(e=this.GetFormatRange(n,o)).firstDrawItemNo,o=e.lastItemNo,this.SelectInfo.StartItemNo!==this.SelectInfo.EndItemNo&&(o=this.GetParaLastItemNo(this.SelectInfo.EndItemNo)),this.FormatPrepare(n,o);for(var s=this.SelectInfo.StartItemNo;s<=this.SelectInfo.EndItemNo;s++){if(this.Items[s].StyleNo>oo.Null){t.Append=!t.StyleHasMatch(this.Style,this.Items[s].StyleNo);break}if(this.Items[s].MatchTextStyle(this.Style,t))break}if(this.SelectInfo.StartItemNo===this.SelectInfo.EndItemNo)i=this.ApplySameItem(this.SelectInfo.StartItemNo,i,t);else{i=this.ApplyRangeEndItem(this.SelectInfo.EndItemNo,i,t);for(var r=this.SelectInfo.EndItemNo-1;r>=this.SelectInfo.StartItemNo+1;r--)this.ApplyRangeNorItem(r,t);i=this.ApplyRangeStartItem(this.SelectInfo.StartItemNo,i,t),this.SelectInfo.EndItemNo<o+i&&this.MergeItemToNext(this.SelectInfo.EndItemNo)&&(this.UndoAction_InsertText(this.SelectInfo.EndItemNo,this.Items[this.SelectInfo.EndItemNo].Length-this.Items[this.SelectInfo.EndItemNo+1].Length+1,this.Items[this.SelectInfo.EndItemNo+1].Text),this.UndoAction_DeleteItem(this.SelectInfo.EndItemNo+1,0),this.Items.delete(this.SelectInfo.EndItemNo+1),i--);for(var a=-1,l=this.SelectInfo.EndItemNo;l>=this.SelectInfo.StartItemNo+1;l--)a=this.Items[l-1].Length,this.MergeItemToPrio(l)&&(this.UndoAction_InsertText(l-1,this.Items[l-1].Length-this.Items[l].Length+1,this.Items[l].Text),this.UndoAction_DeleteItem(l,0),this.Items.delete(l),i--,l===this.SelectInfo.EndItemNo&&(this.SelectInfo.EndItemOffset=this.SelectInfo.EndItemOffset+a),this.SelectInfo.EndItemNo=this.SelectInfo.EndItemNo-1);this.SelectInfo.StartItemNo>0&&!this.Items[this.SelectInfo.StartItemNo].ParaFirst&&(a=this.Items[this.SelectInfo.StartItemNo-1].Length,this.MergeItemToPrio(this.SelectInfo.StartItemNo)&&(this.UndoAction_InsertText(this.SelectInfo.StartItemNo-1,this.Items[this.SelectInfo.StartItemNo-1].Length-this.Items[this.SelectInfo.StartItemNo].Length+1,this.Items[this.SelectInfo.StartItemNo].Text),this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,0),this.Items.delete(this.SelectInfo.StartItemNo),i--,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.SelectInfo.StartItemOffset=a,this.SelectInfo.EndItemNo=this.SelectInfo.EndItemNo-1,this.SelectInfo.StartItemNo==this.SelectInfo.EndItemNo&&(this.SelectInfo.EndItemOffset=this.SelectInfo.EndItemOffset+a)))}this.ReFormatData(n,o+i,i)}this.MatchItemSelectState(),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret()}else if(this.Items[this.SelectInfo.StartItemNo].StyleNo<oo.Null)this.Items[this.SelectInfo.StartItemNo].MangerUndo?this.UndoAction_ItemSelf(this.SelectInfo.StartItemNo,Yl.OffsetInner):this.UndoAction_ItemMirror(this.SelectInfo.StartItemNo,Yl.OffsetInner),this.Items[this.SelectInfo.StartItemNo].ApplySelectTextStyle(this.Style,t),this.Items[this.SelectInfo.StartItemNo].IsFormatDirty?(n=(e=this.GetFormatRange(n,o)).firstDrawItemNo,o=e.lastItemNo,this.FormatPrepare(n,o),this.ReFormatData(n,o)):this.FormatInit(),this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset);else if(this.CurStyleNo>oo.Null){t.Append=!t.StyleHasMatch(this.Style,this.CurStyleNo);var h=t.GetMatchStyleNo(this.hcl,this.Style,this.CurStyleNo);this.Style.UpdateInfoRePaint(),0===this.Items[this.SelectInfo.StartItemNo].Length?(n=(e=this.GetFormatRange(n,o)).firstDrawItemNo,o=e.lastItemNo,this.FormatPrepare(n,o),this.UndoAction_ItemStyle(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,h),this.Items[this.SelectInfo.StartItemNo].StyleNo=h,this.ReFormatData(n,o),this.Style.UpdateInfoReCaret()):(this.Items[this.SelectInfo.StartItemNo].isClass(hs)&&(n=(e=this.GetFormatRange(n,o)).firstDrawItemNo,o=e.lastItemNo,this.FormatPrepare(n,o),this.Items[this.SelectInfo.StartItemNo].TextStyleNo=h,this.ReFormatData(n,o)),this.Style.UpdateInfoReCaret(!1)),this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset),this.Style.WillStyleNo=h,this.CurStyleNo=h}}}},{key:"DoApplyParagraphStyle",value:function(t,e,i){var n,o,s;e instanceof Ms?(n=e.Indent,s=this.Style.ParaStyles[this.GetItemParaStyle(t)],o=En.pixXToMillimeter(this.Width)-s.LeftIndent-s.RightIndent-En.pixXToMillimeter(Yl.TabCharWidth),s.FirstIndent+i>o?e.Indent=o:e.Indent=s.FirstIndent+i):e instanceof Ls?(n=e.Indent,s=this.Style.ParaStyles[this.GetItemParaStyle(t)],o=En.pixXToMillimeter(this.Width)-s.FirstIndent-s.RightIndent-En.pixXToMillimeter(Yl.TabCharWidth),s.LeftIndent>0&&s.LeftIndent+i<0||s.LeftIndent<0&&s.LeftIndent+i>0?e.Indent=0:s.LeftIndent+i>o?e.Indent=o:e.Indent=s.LeftIndent+i):e instanceof Gs&&(n=e.Indent,s=this.Style.ParaStyles[this.GetItemParaStyle(t)],o=En.pixXToMillimeter(this.Width)-s.FirstIndent-s.LeftIndent-En.pixXToMillimeter(Yl.TabCharWidth),s.RightIndent+i>o?e.Indent=o:e.Indent=s.RightIndent+i);var r=e.GetMatchParaNo(this.hcl,this.Style,this.GetItemParaStyle(t));if(this.Items[t].ParaNo!==r){var a=-1,l=-1,h=this.GetParaItemRang(t,a,l);a=h.a,l=h.b,this.UndoAction_ItemParaNo(a,0,r);for(var c=a;c<=l;c++)this.Items[c].ParaNo=r}(e instanceof Ms||e instanceof Ls||e instanceof Gs)&&(e.Indent=n)}},{key:"ApplyParagraphSelecteStyle",value:function(t,e){var i=-1,n=-1,o=this.GetParaItemRang(this.SelectInfo.StartItemNo,i,n);i=o.a,n=o.b,this.DoApplyParagraphStyle(this.SelectInfo.StartItemNo,t,e);for(var s=n+1;s<=this.SelectInfo.EndItemNo;)this.Items[s].ParaFirst&&this.DoApplyParagraphStyle(s,t,e),s++}},{key:"ApplySelectParaStyle",value:function(t){if(!(this.SelectInfo.StartItemNo<0)&&this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ContentChange)){var e=0;t instanceof Ms?e=t.Indent-this.Style.ParaStyles[this.GetItemParaStyle(this.SelectInfo.StartItemNo)].FirstIndent:t instanceof Ls?e=t.Indent-this.Style.ParaStyles[this.GetItemParaStyle(this.SelectInfo.StartItemNo)].LeftIndent:t instanceof Gs&&(e=t.Indent-this.Style.ParaStyles[this.GetItemParaStyle(this.SelectInfo.StartItemNo)].RightIndent);var i=-1,n=-1;this.Undo_New(),this.SelectInfo.EndItemNo>=0?(i=this.Items[this.GetParaFirstItemNo(this.SelectInfo.StartItemNo)].FirstDItemNo,n=this.GetParaLastItemNo(this.SelectInfo.EndItemNo),this.FormatPrepare(i,n),this.ApplyParagraphSelecteStyle(t,e),this.ReFormatData(i,n)):this.GetItemStyle(this.SelectInfo.StartItemNo)<oo.Null&&this.SelectInfo.StartItemOffset===Yl.OffsetInner&&!this.Items[this.SelectInfo.StartItemNo].IsSelectComplateTheory()?(this.Items[this.SelectInfo.StartItemNo].MangerUndo?this.UndoAction_ItemSelf(this.SelectInfo.StartItemNo,Yl.OffsetInner):this.UndoAction_ItemMirror(this.SelectInfo.StartItemNo,Yl.OffsetInner),i=this.GetFormatFirstDrawItem(this.Items[this.SelectInfo.StartItemNo].FirstDItemNo),n=this.GetParaLastItemNo(this.SelectInfo.StartItemNo),this.FormatPrepare(i,n),this.Items[this.SelectInfo.StartItemNo].ApplySelectParaStyle(this.Style,t),this.ReFormatData(i,n)):(i=this.Items[this.GetParaFirstItemNo(this.SelectInfo.StartItemNo)].FirstDItemNo,n=this.GetParaLastItemNo(this.SelectInfo.StartItemNo),this.FormatPrepare(i,n),this.DoApplyParagraphStyle(this.SelectInfo.StartItemNo,t,e),this.ReFormatData(i,n)),this.FSelectSeekNo>=0?this.FCurParaNo=this.Items[this.FSelectSeekNo].ParaNo:this.FCurParaNo=this.Items[this.SelectInfo.StartItemNo].ParaNo,this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret()}}},{key:"ApplyTableCellAlign",value:function(t){this.CanEdit()&&this.RectItemAction(this.GetActiveItemNo(),(function(e){return e.ApplyContentAlign(t),!0}))}},{key:"ParaFirstItemAddBullet_",value:function(t,e,i,n,o,s,r){if(this.Items[t].StyleNo>oo.Null&&""===this.Items[t].Text){this.UndoAction_DeleteItem(t,0),this.Items.removeAt(t);var a=new Cl(this.hcl,this);a.BulletStyle=e,a.Prefix=n,a.Suffix=o,e===ah.Symbol?a.Text=n+i+o:a.SetOrderNumber(r),a.ParaFirst=!0,this.Items.insert(t,a),this.UndoAction_InsertItem(t,0)}else if(rs.IsBeginMark(this.Items[t])){var l=new Cl(this.hcl,this);l.BulletStyle=e,l.Prefix=n,l.Suffix=o,e===ah.Symbol?l.Text=n+i+o:l.SetOrderNumber(r),this.Items.insert(t+1,l),this.UndoAction_InsertItem(t+1,0),s++}else{this.UndoAction_ItemParaFirst(t,0,!1),this.Items[t].ParaFirst=!1;var h=new Cl(this.hcl,this);h.BulletStyle=e,h.Prefix=n,h.Suffix=o,e===ah.Symbol?h.Text=n+i+o:h.SetOrderNumber(r),h.ParaFirst=!0,this.Items.insert(t,h),this.UndoAction_InsertItem(t,0),s++}return e!==ah.Symbol&&r--,{incCount:s,order:r}}},{key:"ApplyBullet",value:function(t,e,i,n){if(!(this.SelectInfo.StartItemNo<0)){var o=this.SelectInfo.StartItemNo,s=this.SelectInfo.EndItemNo,r=0;this.InitializeField(),t!=ah.Symbol&&(r=parseInt(e));var a=0,l=-1,h=-1,c=-1;if(this.Undo_New(),s>=0){l=this.GetParaFirstItemNo(o),h=this.Items[l].FirstDItemNo,c=this.GetParaLastItemNo(s),this.FormatPrepare(h,c);for(var u=l+1;u<=s;u++)this.Items[u].ParaFirst&&r++;for(var f,d=s;d>=l;d--)this.Items[d].ParaFirst&&(a=(f=this.ParaFirstItemAddBullet_(d,t,e,i,n,a,r)).incCount,r=f.order);l<=o&&(this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1),this.SelectInfo.EndItemNo=this.SelectInfo.EndItemNo+a}else o>=0&&(l=this.GetParaFirstItemNo(o),h=this.Items[l].FirstDItemNo,c=this.GetParaLastItemNo(o),this.FormatPrepare(h,c),this.ParaFirstItemAddBullet_(l,t,e,i,n,a,r));this.ReFormatData(h,c+a,a),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret()}}},{key:"DisSelect",value:function(){var t=f()(F()(i.prototype),"DisSelect",this).call(this);return t&&(this.FDraging=!1,this.FSelecting=!1,this.Style.UpdateInfoRePaint()),this.Style.UpdateInfoReCaret(),t}},{key:"DeleteItemSelectComplate",value:function(t,e,i,n,o){var s=this;if(!this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.DeleteItem))return{delCount:t,result:!1};if(this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,0),this.DoDataDeleteItemAction(this.SelectInfo.StartItemNo,(function(){s.Items.delete(s.SelectInfo.StartItemNo)})),t++,this.SelectInfo.StartItemNo>n&&this.SelectInfo.StartItemNo<o){var r=this.Items[this.SelectInfo.StartItemNo-1].Length;this.MergeItemText(this.Items[this.SelectInfo.StartItemNo-1],this.Items[this.SelectInfo.StartItemNo])?(this.UndoAction_InsertText(this.SelectInfo.StartItemNo-1,r+1,this.Items[this.SelectInfo.StartItemNo].Text),this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,0),this.Items.delete(this.SelectInfo.StartItemNo),t++,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.SelectInfo.StartItemOffset=r):(this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.SelectInfo.StartItemOffset=this.GetItemOffsetAfter(this.SelectInfo.StartItemNo))}else if(this.SelectInfo.StartItemNo===e)if(e===i){var a=this.CreateDefaultTextItem();this.CurStyleNo=a.StyleNo,a.ParaFirst=!0,this.Items.insert(this.SelectInfo.StartItemNo,a),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,0),this.SelectInfo.StartItemOffset=0,t--}else this.SelectInfo.StartItemOffset=0,this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo,0,!0),this.Items[this.SelectInfo.StartItemNo].ParaFirst=!0;else if(this.SelectInfo.StartItemNo===i)this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.SelectInfo.StartItemOffset=this.GetItemOffsetAfter(this.SelectInfo.StartItemNo);else if(this.SelectInfo.StartItemNo>0){var l=this.Items[this.SelectInfo.StartItemNo-1].Length;this.MergeItemText(this.Items[this.SelectInfo.StartItemNo-1],this.Items[this.SelectInfo.StartItemNo])&&(this.UndoAction_InsertText(this.SelectInfo.StartItemNo-1,l+1,this.Items[this.SelectInfo.StartItemNo].Text),this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,0),this.Items.delete(this.SelectInfo.StartItemNo),t++,this.SelectInfo.StartItemOffset=l),this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.SelectInfo.StartItemOffset=this.GetItemOffsetAfter(this.SelectInfo.StartItemNo)}return{delCount:t,result:!0}}},{key:"DeleteSelected",value:function(){var t=this;if(this.FStyle.TraceAction=!1,!this.Loading&&!this.CanEdit())return!1;if(!this.SelectPerfect())return this.DisSelect(),!1;if(!this.SelectExists())return!0;if(!this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.DeleteSelected))return!1;var e,n=!0,o=this.IsSelectSeekStart(),s=0,r=-1,a=-1,l=-1,h=-1,c=-1,u=-1;if(this.SelectInfo.EndItemNo<0&&this.Items[this.SelectInfo.StartItemNo].StyleNo<oo.Null){if(r=(e=this.GetFormatRange(r,l)).firstDrawItemNo,l=e.lastItemNo,this.FormatPrepare(r,l),a=this.FormatCount>0?this.SelectInfo.StartItemNo:this.DrawItems[r].ItemNo,this.Undo_New(),this.Items[this.SelectInfo.StartItemNo].IsSelectComplateTheory()){var d=this.GetParaItemRang(this.SelectInfo.StartItemNo,h,c);h=d.a,c=d.b;var m=this.DeleteItemSelectComplate(s,h,c,a,l);s=m.delCount,n=m.result}else this.Items[this.SelectInfo.StartItemNo].MangerUndo?this.UndoAction_ItemSelf(this.SelectInfo.StartItemNo,Yl.OffsetInner):this.UndoAction_ItemMirror(this.SelectInfo.StartItemNo,Yl.OffsetInner),n=this.Items[this.SelectInfo.StartItemNo].DeleteSelected();this.ReFormatData(r,l-s,-s)}else{var S=this.Items[this.SelectInfo.EndItemNo];if(this.SelectInfo.EndItemNo===this.SelectInfo.StartItemNo){if(this.Undo_New(),r=(e=this.GetFormatRange(r,l)).firstDrawItemNo,l=e.lastItemNo,this.FormatPrepare(r,l),a=this.FormatCount>0?this.SelectInfo.StartItemNo:this.DrawItems[r].ItemNo,S.IsSelectComplate){var p=this.GetParaItemRang(this.SelectInfo.StartItemNo,h,c);h=p.a,c=p.b;var y=this.DeleteItemSelectComplate(s,h,c,a,l);s=y.delCount,n=y.result}else if(S.StyleNo<oo.Null)this.Items[this.SelectInfo.StartItemNo].MangerUndo?this.UndoAction_ItemSelf(this.SelectInfo.StartItemNo,Yl.OffsetInner):this.UndoAction_ItemMirror(this.SelectInfo.StartItemNo,Yl.OffsetInner),S.DeleteSelected();else if(this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.BackDeleteText)){var v=S.Text;this.UndoAction_DeleteBackText(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset+1,v.substr(this.SelectInfo.StartItemOffset+1-1,this.SelectInfo.EndItemOffset-this.SelectInfo.StartItemOffset)),S.Text=L.stringDelete(v,this.SelectInfo.StartItemOffset+1-1,this.SelectInfo.EndItemOffset-this.SelectInfo.StartItemOffset),this.DoItemChange(this.SelectInfo.EndItemNo,this.SelectInfo.StartItemNo,rh.ContentChange)}this.ReFormatData(r,l-s,-s)}else{u=this.SelectInfo.EndItemNo,a=this.GetParaFirstItemNo(this.SelectInfo.StartItemNo),r=this.Items[a].FirstDItemNo,l=this.GetParaLastItemNo(this.SelectInfo.EndItemNo),this.FormatPrepare(r,l);var I=this.Items[this.SelectInfo.StartItemNo].ParaFirst,g=this.Items[this.SelectInfo.StartItemNo].IsSelectComplate,C=this.Items[this.SelectInfo.EndItemNo].IsSelectComplate;this.Undo_New();var w=!1,A=!1;if(S.StyleNo<oo.Null)C?this.DoAcceptAction(this.SelectInfo.EndItemNo,this.SelectInfo.EndItemOffset,rh.DeleteItem)?(this.UndoAction_DeleteItem(this.SelectInfo.EndItemNo,Yl.OffsetAfter),this.Items.delete(this.SelectInfo.EndItemNo),A=!0,s++,u--):u=this.SelectInfo.EndItemNo:this.SelectInfo.EndItemOffset===Yl.OffsetInner?S.DeleteSelected():this.Items[this.SelectInfo.EndItemNo].ParaFirst&&(this.UndoAction_ItemParaFirst(this.SelectInfo.EndItemNo,0,!1),this.Items[this.SelectInfo.EndItemNo].ParaFirst=!1);else if(C)this.DoAcceptAction(this.SelectInfo.EndItemNo,this.SelectInfo.EndItemOffset,rh.DeleteItem)?(this.UndoAction_DeleteItem(this.SelectInfo.EndItemNo,S.Length),this.Items.delete(this.SelectInfo.EndItemNo),A=!0,s++,u--):u=this.SelectInfo.EndItemNo;else if(this.DoAcceptAction(this.SelectInfo.EndItemNo,this.SelectInfo.EndItemOffset,rh.BackDeleteText))if(0==this.SelectInfo.EndItemOffset&&this.Items[this.SelectInfo.EndItemNo].ParaFirst)this.UndoAction_ItemParaFirst(this.SelectInfo.EndItemNo,0,!1),this.Items[this.SelectInfo.EndItemNo].ParaFirst=!1;else{this.UndoAction_DeleteBackText(this.SelectInfo.EndItemNo,1,S.Text.substr(0,this.SelectInfo.EndItemOffset));var D=S.SubString(this.SelectInfo.EndItemOffset+1,S.Length-this.SelectInfo.EndItemOffset);S.Text=D}else u=this.SelectInfo.EndItemNo;for(var P=this.SelectInfo.EndItemNo-1;P>=this.SelectInfo.StartItemNo+1;P--)this.DoAcceptAction(P,0,rh.DeleteItem)?(this.UndoAction_DeleteItem(P,0),this.Items.delete(P),s++,u--):u=P;var k=this.Items[this.SelectInfo.StartItemNo];if(k.StyleNo<oo.Null)this.SelectInfo.StartItemOffset===Yl.OffsetBefor?this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.DeleteItem)?(this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,0),this.DoDataDeleteItemAction(this.SelectInfo.StartItemNo,(function(){t.Items.delete(t.SelectInfo.StartItemNo)})),w=!0,s++,u--):u=this.SelectInfo.StartItemNo:this.SelectInfo.StartItemOffset==Yl.OffsetInner&&k.DeleteSelected();else if(g)this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.DeleteItem)?(this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,0),this.DoDataDeleteItemAction(this.SelectInfo.StartItemNo,(function(){t.Items.delete(t.SelectInfo.StartItemNo)})),w=!0,s++,u--):u=this.SelectInfo.StartItemNo;else if(this.SelectInfo.StartItemOffset<k.Length)if(this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.BackDeleteText)){this.UndoAction_DeleteBackText(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset+1,k.Text.substr(this.SelectInfo.StartItemOffset+1-1,k.Length-this.SelectInfo.StartItemOffset));var x=k.SubString(1,this.SelectInfo.StartItemOffset);k.Text=x,this.DoItemChange(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ContentChange)}else u=this.SelectInfo.StartItemNo;if(this.SelectInfo.EndItemNo-this.SelectInfo.StartItemNo+1===s)if(this.SelectInfo.StartItemNo===a)if(this.SelectInfo.EndItemNo===l){var R=this.CreateDefaultTextItem();this.CurStyleNo=R.StyleNo,R.ParaFirst=!0,this.Items.insert(this.SelectInfo.StartItemNo,R),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,R.Length),this.DoItemChange(this.SelectInfo.StartItemNo,0,rh.ContentChange),s--}else this.Items[this.SelectInfo.EndItemNo-s+1].ParaFirst=!0;else if(this.SelectInfo.EndItemNo===l)this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.SelectInfo.StartItemOffset=this.GetItemOffsetAfter(this.SelectInfo.StartItemNo);else{var T=this.Items[this.SelectInfo.StartItemNo-1].Length;this.MergeItemText(this.Items[this.SelectInfo.StartItemNo-1],this.Items[this.SelectInfo.EndItemNo-s+1])?(this.UndoAction_InsertText(this.SelectInfo.StartItemNo-1,this.Items[this.SelectInfo.StartItemNo-1].Length-this.Items[this.SelectInfo.EndItemNo-s+1].Length+1,this.Items[this.SelectInfo.EndItemNo-s+1].Text),this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.SelectInfo.StartItemOffset=T,this.UndoAction_DeleteItem(this.SelectInfo.EndItemNo-s+1,0),this.Items.delete(this.SelectInfo.EndItemNo-s+1),s++):this.Items[this.SelectInfo.EndItemNo-s+1].ParaFirst&&(this.UndoAction_ItemParaFirst(this.SelectInfo.EndItemNo-s+1,0,!1),this.Items[this.SelectInfo.EndItemNo-s+1].ParaFirst=!1)}else w?this.Items[u].ParaFirst!=I&&(this.UndoAction_ItemParaFirst(u,0,I),this.Items[u].ParaFirst=I):A||this.SelectInfo.StartItemNo+1!=this.SelectInfo.EndItemNo-s||(this.MergeItemText(this.Items[this.SelectInfo.StartItemNo],this.Items[this.SelectInfo.EndItemNo-s])?(this.UndoAction_InsertText(this.SelectInfo.StartItemNo,this.Items[this.SelectInfo.StartItemNo].Length-this.Items[this.SelectInfo.EndItemNo-s].Length+1,this.Items[this.SelectInfo.EndItemNo-s].Text),this.UndoAction_DeleteItem(this.SelectInfo.EndItemNo-s,0),this.Items.delete(this.SelectInfo.EndItemNo-s),s++):this.SelectInfo.EndItemNo!==l&&this.Items[this.SelectInfo.EndItemNo-s].ParaFirst&&(this.UndoAction_ItemParaFirst(this.SelectInfo.EndItemNo-s,0,!1),this.Items[this.SelectInfo.EndItemNo-s].ParaFirst=!1));this.ReFormatData(r,l-s,-s)}for(var b=this.SelectInfo.StartItemNo;b<=this.SelectInfo.EndItemNo-s;b++)this.Items[b].DisSelect();this.SelectInfo.EndItemNo=-1,this.SelectInfo.EndItemOffset=-1}return this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),f()(F()(i.prototype),"DeleteSelected",this).call(this),this.InitializeField(),this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,!o),this.FStyle.TraceAction=n,n}},{key:"DeleteItemDirect",value:function(t){var e=this.GetFormatFirstDrawItemByOffset(t,0),n=this.GetParaLastItemNo(t);this.Items[t].ParaFirst&&t<n&&(this.Items[t+1].ParaFirst=!0),this.FormatPrepare(e,n),f()(F()(i.prototype),"DeleteItemDirect",this).call(this,t),0===this.Items.count?this.SetEmptyData():this.ReFormatData(e,n-1,-1)}},{key:"InitializeField",value:function(){this.FSelectSeekNo=-1,this.FSelectSeekOffset=-1,this.InitializeMouseField(),f()(F()(i.prototype),"InitializeField",this).call(this)}},{key:"InsertStream",value:function(t,e,i){var n=this;if(!this.Loading&&!this.CanEdit())return!1;if(!this.DeleteSelected())return!1;if(!this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.InsertItem))return!1;if(!this.SelectPerfect())return!1;var o,s=!1,r=null,a=!1,l=!1,h=0,c=-1,u=-1,f=this.CurParaNo;this.Undo_GroupBegin(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset);try{if(0===this.Items.count)h=0;else if(h=this.SelectInfo.StartItemNo,this.Items[h].StyleNo<oo.Null){if(this.SelectInfo.StartItemOffset===Yl.OffsetInner)return c=(o=this.GetFormatRangeByOffset(this.SelectInfo.StartItemNo,Yl.OffsetInner,c,u)).firstDrawItemNo,u=o.lastItemNo,this.FormatPrepare(c,u),this.Undo_New(),this.Items[h].MangerUndo?this.UndoAction_ItemSelf(this.SelectInfo.StartItemNo,Yl.OffsetInner):this.UndoAction_ItemMirror(this.SelectInfo.StartItemNo,Yl.OffsetInner),s=this.Items[h].InsertStream(t,e,i),this.ReFormatData(c,u),s;this.SelectInfo.StartItemOffset===Yl.OffsetBefor?a=!0:h+=1}else this.SelectInfo.StartItemOffset===this.Items[h].Length?(l=this.IsEmptyLine(h),h+=1):0===this.SelectInfo.StartItemOffset?a=0!==this.Items[h].Length:(this.Undo_New(),this.UndoAction_DeleteBackText(h,this.SelectInfo.StartItemOffset+1,this.Items[h].Text.substr(this.SelectInfo.StartItemOffset+1-1,this.Items[h].Length-this.SelectInfo.StartItemOffset)),r=this.Items[h].BreakByOffset(this.SelectInfo.StartItemOffset),h+=1);c=(o=this.GetFormatRange(c,u)).firstDrawItemNo,u=o.lastItemNo,this.Items.count>0?this.FormatPrepare(c,u):(c=0,u=-1);var d=0,m=0,S=0;if(this.Undo_New(),this.ParseDataStream(t,e,i,(function(t,i,o){if(null!==e&&!n.Loading&&n.Style.States.Contain(oh.Pasting)&&(o.ParaNo=f),o.StyleNo>oo.Null&&""===o.Text&&!o.ParaFirst)return m++,{result:!1,stop:!1};if(0===t)a?(o.ParaFirst=n.Items[h].ParaFirst,n.Items[h].ParaFirst&&(n.UndoAction_ItemParaFirst(h,0,!1),n.Items[h].ParaFirst=!1)):o.ParaFirst=!1;else if(!n.Loading&&!o.ParaFirst&&n.MergeItemText(n.Items[h+t-1-m],o))return m++,{result:!1,stop:!1};return!n.FCheckEmptyItem&&t>0&&!o.ParaFirst&&(o.StyleNo>oo.Null&&0==o.Length&&(n.FCheckEmptyItem=!0),n.Items[h+t-m-1].StyleNo>oo.Null&&0==n.Items[h+t-m-1].Length&&(n.FCheckEmptyItem=!0)),o.StyleNo===oo.Domain&&o.EndMark?(S=n.FItems.count,n.Items.insert(h+t-m,o),n.UndoAction_InsertItem(h+t-m,0),S=n.FItems.count-S-1,m-=S,d+=S):(n.Items.insert(h+t-m,o),n.UndoAction_InsertItem(h+t-m,0)),d++,{result:!0,stop:!1}})),0===d)return;var p=d-this.CheckInsertItemCount(h,h+d-1),y=h+p-1,F=this.GetItemOffsetAfter(y);if(null!==r)if(this.MergeItemText(this.Items[y],r))this.UndoAction_InsertText(y,this.Items[y].Length-r.Length+1,r.Text),r.dispose(),r=null;else{this.Style.States.Include(oh.InsertBreakItem);try{this.Items.insert(y+1,r)}finally{this.Style.States.Exclude(oh.InsertBreakItem)}this.UndoAction_InsertItem(y+1,0),p++}if(h>0){if(l)this.UndoAction_ItemParaFirst(h,0,this.Items[h-1].ParaFirst),this.Items[h].ParaFirst=this.Items[h-1].ParaFirst,this.Items[h-1].PageBreak&&(this.UndoAction_ItemPageBreak(h,0,!0),this.Items[h].PageBreak=!0),this.UndoAction_DeleteItem(h-1,0),this.Items.delete(h-1),p--,y--;else{var v=this.Items[h-1].Length;!this.Items[h].ParaFirst&&this.MergeItemText(this.Items[h-1],this.Items[h])?(this.UndoAction_InsertText(h-1,this.Items[h-1].Length-this.Items[h].Length+1,this.Items[h].Text),this.UndoAction_DeleteItem(h,0),this.Items.delete(h),1==p&&(F=v+F),p--,y--):this.Items[h].StyleNo>oo.Null&&0===this.Items[h].Length&&(this.UndoAction_DeleteItem(h,0),this.Items.delete(h),p--,y--)}y<this.Items.count-1&&!this.Items[y+1].ParaFirst&&this.MergeItemText(this.Items[y],this.Items[y+1])&&(this.UndoAction_InsertText(y,this.Items[y].Length-this.Items[y+1].Length+1,this.Items[y+1].Text),this.UndoAction_DeleteItem(y+1,0),this.Items.delete(y+1),p--)}else if(this.MergeItemText(this.Items[y],this.Items[y+1])){var I=this.Items[y+1];this.UndoAction_InsertText(y,this.Items[y].Length-I.Length+1,I.Text),this.UndoAction_DeleteItem(h+p,0),this.Items.delete(h+p),p--}this.ItemChangeBy(y,0,rh.ContentChange),this.ReFormatData(c,u+p,p),this.ReSetSelectAndCaretByOffset(y,F)}finally{this.Undo_GroupEnd(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset)}return this.InitializeMouseField(),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),this.Style.UpdateInfoReScroll(),!0}},{key:"ParseJSONObject",value:function(t,e,n){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),this.InsertJSONObject(t,e,n)}},{key:"InsertJSONObject",value:function(t,e,i){var n=new ht;this.DataJSONToStream(t.Items,e,n),n.position=0,this.InsertStream(n,this.Style,Yl.HC_FileVersionInt),n=null}},{key:"InsertItem",value:function(t){if(!this.CanEdit())return!1;if(!this.DeleteSelected())return!1;var e=!1;if(t.ParaNo>this.Style.ParaStyles.count-1&&(t.ParaNo=this.CurParaNo),!t.ParaFirst){if(this.IsEmptyData())return this.Undo_New(),e=this.EmptyDataInsertItem(t),this.CurParaNo=t.ParaNo,e;t.ParaNo=this.CurParaNo}var i,n=-1,o=-1,s=this.GetActiveItemNo();if(this.Items[s].StyleNo<oo.Null)this.SelectInfo.StartItemOffset===Yl.OffsetInner?(n=(i=this.GetFormatRange(n,o)).firstDrawItemNo,o=i.lastItemNo,this.FormatPrepare(n,o),this.Undo_New(),this.UndoAction_ItemSelf(s,Yl.OffsetInner),(e=this.Items[s].InsertItem(t))&&this.ReFormatData(n,o,0)):e=this.SelectInfo.StartItemOffset==Yl.OffsetBefor?this.InsertItemEx(this.SelectInfo.StartItemNo,t):this.InsertItemEx(this.SelectInfo.StartItemNo+1,t,!1);else if(this.SelectInfo.StartItemOffset===this.Items[s].Length)e=this.InsertItemEx(this.SelectInfo.StartItemNo+1,t,!1);else if(0===this.SelectInfo.StartItemOffset)e=this.InsertItemEx(this.SelectInfo.StartItemNo,t);else{if(!this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.InsertItem))return this.ReSetSelectAndCaret(s),this.InsertItemEx(this.SelectInfo.StartItemNo+1,t,!1);n=(i=this.GetFormatRange(n,o)).firstDrawItemNo,o=i.lastItemNo,this.FormatPrepare(n,o);var r=this.Items[s].Text,a=r.substr(0,this.SelectInfo.StartItemOffset),l=r.substr(this.SelectInfo.StartItemOffset+1-1,this.Items[s].Length-this.SelectInfo.StartItemOffset);if(this.Undo_New(),this.Items[s].CanConcatItems(t))t.ParaFirst?(this.UndoAction_DeleteBackText(s,this.SelectInfo.StartItemOffset+1,l),this.Items[s].Text=a,t.Text=t.Text+l,s+=1,this.Items.insert(s,t),this.UndoAction_InsertItem(s,0),this.DoItemChange(s,0,rh.ContentChange),this.ReFormatData(n,o+1,1),this.ReSetSelectAndCaret(s)):(this.UndoAction_InsertText(s,this.SelectInfo.StartItemOffset+1,t.Text),a+=t.Text,this.Items[s].Text=a+l,this.DoItemChange(s,0,rh.ContentChange),this.ReFormatData(n,o,0),this.SelectInfo.StartItemNo=s,this.SelectInfo.StartItemOffset=a.length);else{this.UndoAction_DeleteBackText(s,this.SelectInfo.StartItemOffset+1,l);var h=this.Items[s].BreakByOffset(this.SelectInfo.StartItemOffset);s+=1,this.Style.States.Include(oh.InsertBreakItem);try{this.Items.insert(s,h)}finally{this.Style.States.Exclude(oh.InsertBreakItem)}this.UndoAction_InsertItem(s,0),this.Items.insert(s,t),this.UndoAction_InsertItem(s,0),this.DoItemChange(0,0,rh.ContentChange),this.ReFormatData(n,o+2,2),this.ReSetSelectAndCaret(s)}e=!0}return e}},{key:"InsertItemEx",value:function(t,e){var i,n=this,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this.CanEdit())return!1;if(!this.DeleteSelected())return!1;if(!this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.InsertItem))return!1;if(e.ParaNo>this.Style.ParaStyles.count-1&&(e.ParaNo=this.CurParaNo),!e.ParaFirst){if(this.IsEmptyData()){this.Undo_New();var s=this.EmptyDataInsertItem(e);return this.CurParaNo=e.ParaNo,s}e.ParaNo=this.CurParaNo}var r=0,a=-1,l=-1;if(this.Undo_New(),e.StyleNo<oo.Null){var h=t;if(t<this.Items.count?o?(a=(i=this.GetFormatRangeByOffset(t,1,a,l)).firstDrawItemNo,l=i.lastItemNo,this.FormatPrepare(a,l),this.IsEmptyLine(t)?(e.ParaFirst=!0,e.PageBreak=this.Items[t].PageBreak,this.UndoAction_DeleteItem(t,0),this.Items.delete(t),r--):e.ParaFirst||(e.ParaFirst=this.Items[t].ParaFirst,this.Items[t].ParaFirst&&(this.UndoAction_ItemParaFirst(t,0,!1),this.Items[t].ParaFirst=!1,this.Items[t].PageBreak&&(this.UndoAction_ItemPageBreak(t,0,!1),this.Items[t].PageBreak=!1,e.PageBreak=!0)))):t>0&&this.Items[t-1].StyleNo>oo.Null&&""===this.Items[t-1].Text?(a=(i=this.GetFormatRangeByOffset(t-1,1,a,l)).firstDrawItemNo,l=i.lastItemNo,this.FormatPrepare(a,l),e.ParaFirst=!0,e.PageBreak=this.Items[t-1].PageBreak,this.UndoAction_DeleteItem(t-1,0),this.Items.delete(t-1),r--,h--):(a=(i=this.GetFormatRangeByOffset(t-1,this.GetItemLastDrawItemNo(t-1),a,l)).firstDrawItemNo,l=i.lastItemNo,this.FormatPrepare(a,l)):(a=(i=this.GetFormatRangeByOffset(t-1,this.GetItemLastDrawItemNo(t-1),a,l)).firstDrawItemNo,l=i.lastItemNo,this.FormatPrepare(a,l),!e.ParaFirst&&this.Items[t-1].StyleNo>oo.Null&&""===this.Items[t-1].Text&&(e.ParaFirst=!0,e.PageBreak=this.Items[t-1].PageBreak,this.UndoAction_DeleteItem(t-1,0),this.Items.delete(t-1),r--,h--)),e.StyleNo===oo.Domain&&e.MarkType===ch.End){var c=this.Items.count,u=0;if(this.Items.insert(h,e),r+=u=this.Items.count-c,this.UndoAction_InsertItem(h+u-1,Yl.OffsetAfter),e.InnerTextTmp&&""!==e.InnerTextTmp){for(var f,d=Yl.ReplaceUnPreChar(e.InnerTextTmp).split(Yl.sLineBreak),m=!1,S=null,p=0;p<d.length;p++)f=d[p],p===d.length-1&&m&&""===f?(this.UndoAction_ItemParaFirst(h,0,this.Items[h].ParaFirst),this.FItems[h].ParaFirst=!0):(m||""!==f)&&((S=this.CreateDefaultTextItem()).StyleNo=e.GetTextStyleNo(),S.ParaNo=e.ParaNo,S.ParaFirst=m,S.Text=f,this.Items.insert(h,S),this.UndoAction_InsertItem(h,Yl.OffsetAfter),r++,h++),m=!0;delete e.InnerTextTmp,this.DoItemChange(h,0,rh.ContentChange)}}else this.Items.insert(h,e),this.UndoAction_InsertItem(h,Yl.OffsetAfter),this.DoItemChange(h,0,rh.ContentChange),r++;this.ReFormatData(a,l+r,r),this.ReSetSelectAndCaret(h)}else{var y=!1;e.ParaFirst?""===e.Text&&t<this.FItems.count&&!this.FItems[t].ParaFirst&&(a=(i=this.GetFormatRangeByOffset(t,1,a,l)).firstDrawItemNo,l=i.lastItemNo,this.FormatPrepare(a,l),this.UndoAction_ItemParaFirst(t,0,!0),this.FItems[t].ParaFirst=!0,this.ReFormatData(a,l,0),this.ReSetSelectAndCaret(t),y=!0):o?t<this.Items.count&&this.Items[t].CanConcatItems(e)?(a=(i=this.GetFormatRangeByOffset(t,1,a,l)).firstDrawItemNo,l=i.lastItemNo,this.FormatPrepare(a,l),this.UndoAction_InsertText(t,1,e.Text),this.Items[t].Text=e.Text+this.Items[t].Text,this.DoItemChange(t,0,rh.ContentChange),this.ReFormatData(a,l,0),this.ReSetSelectAndCaretByOffset(t,e.Length),y=!0):!this.Items[t].ParaFirst&&t>0&&this.Items[t-1].CanConcatItems(e)&&(a=(i=this.GetFormatRangeByOffset(t-1,this.GetItemOffsetAfter(t-1),a,l)).firstDrawItemNo,l=i.lastItemNo,this.FormatPrepare(a,l),this.UndoAction_InsertText(t-1,this.Items[t-1].Length+1,e.Text),this.Items[t-1].Text=this.Items[t-1].Text+e.Text,this.DoItemChange(t-1,0,rh.ContentChange),this.ReFormatData(a,l,0),this.ReSetSelectAndCaret(t-1),y=!0):this.IsEmptyLine(t-1)?(a=(i=this.GetFormatRangeByOffset(t-1,1,a,l)).firstDrawItemNo,l=i.lastItemNo,this.FormatPrepare(a,l),e.ParaFirst=!0,this.Items.insert(t,e),this.UndoAction_InsertItem(t,0),this.UndoAction_DeleteItem(t-1,0),this.DoDataDeleteItemAction(t-1,(function(){n.Items.delete(t-1)})),this.ReFormatData(a,l,0),this.ReSetSelectAndCaret(t-1),y=!0):this.Items[t-1].CanConcatItems(e)?(a=(i=this.GetFormatRangeByOffset(t-1,this.GetItemOffsetAfter(t-1),a,l)).firstDrawItemNo,l=i.lastItemNo,this.FormatPrepare(a,l),this.UndoAction_InsertText(t-1,this.Items[t-1].Length+1,e.Text),this.Items[t-1].Text=this.Items[t-1].Text+e.Text,this.DoItemChange(t-1,0,rh.ContentChange),this.ReFormatData(a,l,0),this.ReSetSelectAndCaret(t-1),y=!0):t<this.Items.count&&!this.Items[t].ParaFirst&&this.Items[t].CanConcatItems(e)&&(a=(i=this.GetFormatRangeByOffset(t,1,a,l)).firstDrawItemNo,l=i.lastItemNo,this.FormatPrepare(a,l),this.UndoAction_InsertText(t,1,e.Text),this.Items[t].Text=e.Text+this.Items[t].Text,this.DoItemChange(t,0,rh.ContentChange),this.ReFormatData(a,l,0),this.ReSetSelectAndCaretByOffset(t,e.Length),y=!0),y||(o?(a=(i=this.GetFormatRangeByOffset(t,1,a,l)).firstDrawItemNo,l=i.lastItemNo,e.ParaFirst||(e.ParaFirst=this.Items[t].ParaFirst,this.Items[t].ParaFirst&&(this.UndoAction_ItemParaFirst(t,0,!1),this.Items[t].ParaFirst=!1))):(a=(i=this.GetFormatRangeByOffset(t-1,this.GetItemOffsetAfter(t-1),a,l)).firstDrawItemNo,l=i.lastItemNo),this.FormatPrepare(a,l),this.Items.insert(t,e),this.UndoAction_InsertItem(t,0),this.DoItemChange(t,0,rh.ContentChange),this.ReFormatData(a,l+1,1),this.ReSetSelectAndCaret(t))}return!0}},{key:"SetActiveItemText",value:function(t){if(this.CanEdit()&&""!==t){f()(F()(i.prototype),"InitializeField",this).call(this);var e=this.GetActiveItem();if(null!==e){var n,o=-1,s=-1;if(e.StyleNo<oo.Null&&this.SelectInfo.StartItemOffset===Yl.OffsetInner){this.Undo_New();var r=e;r.MangerUndo?this.UndoAction_ItemSelf(this.SelectInfo.StartItemNo,Yl.OffsetInner):this.UndoAction_ItemMirror(this.SelectInfo.StartItemNo,Yl.OffsetInner),r.SetActiveItemText(t),r.IsFormatDirty?(o=(n=this.GetFormatRange(o,s)).firstDrawItemNo,s=n.lastItemNo,this.FormatPrepare(o,s),this.ReFormatData(o,s)):this.FormatInit()}else{if(t.indexOf(Yl.sLineBreak)>=0){this.Undo_GroupBegin(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset);try{this.DeleteItems(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemNo,!0),this.InsertText(t)}finally{this.Undo_GroupEnd(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset)}return}if(!this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.SetItemText))return;this.Undo_New(),this.UndoAction_SetItemText(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,t),this.Items[this.SelectInfo.StartItemNo].Text=t,this.DoItemChange(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ContentChange),o=(n=this.GetFormatRangeByOffset(this.SelectInfo.StartItemNo,0,o,s)).firstDrawItemNo,s=n.lastItemNo,this.FormatPrepare(o,s),this.ReFormatData(o,s),this.SelectInfo.StartItemOffset=t.length,this.SelectInfo.StartRestrain=!1,this.SelectInfo.EndItemNo=-1,this.SelectInfo.EndItemOffset=-1,this.Items[this.SelectInfo.StartItemNo].DisSelect(),this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset)}this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret()}}}},{key:"KillFocus",value:function(){var t=this.GetActiveItemNo();t>0&&this.Items[t].KillFocus()}},{key:"DoItemMouseDown",value:function(t,e,i){if(!(t<0)){var n=this.CoordToItemOffset(i.x,i.y,t,e,-1,-1),o=new fi;o.assign(i),o.x=n.x,o.y=n.y,this.Items[t].MouseDown(o),null!==this.OnItemMouseDown&&this.OnItemMouseDown(this,t,e,o)}}},{key:"MouseDown",value:function(t){this.FSelecting=!1,this.FDraging=!1,this.FMouseLBDouble=!1,this.FMouseDownReCaret=!1,this.FMouseLBDowning=t.button===ae&&!this.hcl.keyDownStates[Ge],this.FMouseDownX=t.x,this.FMouseDownY=t.y;var e=-1,i=-1,n=-1,o=!1,s=this.GetItemAt(t.x,t.y,e,i,n,o);if(e=s.itemNo,i=s.offset,n=s.drawItemNo,o=s.restrain,this.FSelectSeekNo=e,this.FSelectSeekOffset=i,t.button===ae&&this.hcl.keyDownStates[Ge])if(this.FMouseDownItemNo=e,this.FMouseDownItemOffset=i,!o&&this.Items[this.FMouseDownItemNo].StyleNo<oo.Null&&i===Yl.OffsetInner)this.DoItemMouseDown(this.FMouseDownItemNo,this.FMouseDownItemOffset,t);else{var r=this.SelectByMouseDownShift(e,i);e=r.itemNo,i=r.offset,r.result&&(this.MatchItemSelectState(),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),this.FMouseDownItemNo=e,this.FMouseDownItemOffset=i,this.FSelectSeekNo=e,this.FSelectSeekOffset=i)}else this.CoordInSelect(t.x,t.y,e,i,o)?(this.Items[e].StyleNo<oo.Null&&this.DoItemMouseDown(e,i,t),2!==t.clicks&&this.FMouseLBDowning&&!this.SelectedResizing()?(this.FDraging=!0,this.Style.UpdateInfo.DragingSelected=!0):(this.FMouseDownItemNo=e,this.FMouseDownItemOffset=i)):(e===this.FMouseDownItemNo&&i===this.FMouseDownItemOffset&&this.CaretDrawItemNo===n||(this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),this.FMouseDownReCaret=!0,this.SelectExists(!1)?this.DisSelect():this.FMouseDownItemNo>=0&&(e!==this.FMouseDownItemNo||!this.SelectInfo.StartRestrain&&o)&&(this.FItems[this.FMouseDownItemNo].Active=!1),this.FMouseDownItemNo=e,this.FMouseDownItemOffset=i,this.SelectInfo.StartItemNo=this.FMouseDownItemNo,this.SelectInfo.StartItemOffset=this.FMouseDownItemOffset,this.SelectInfo.StartRestrain=o,this.CaretDrawItemNo=n),this.DoItemMouseDown(this.FMouseDownItemNo,this.FMouseDownItemOffset,t))}},{key:"DoItemMouseMove",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!(t<0)){var o=this.CoordToDrawItem(i.x,i.y,this.FMouseMoveDrawItemNo,-1,-1),s=new fi;s.assign(i),s.x=o.x,s.y=o.y,n&&this.DoDrawItemMouseMove(this,t,e,this.FMouseMoveDrawItemNo,s),this.Items[t].MouseMove(s)}}},{key:"MouseMove",value:function(t){if(this.FStyle.Cursor=this.GetDefaultCursor(),this.SelectedResizing())return this.FMouseMoveItemNo=this.FMouseDownItemNo,this.FMouseMoveItemOffset=this.FMouseDownItemOffset,this.FMouseMoveDrawItemNo=this.GetDrawItemNoByOffset(this.FMouseMoveItemNo,this.FMouseMoveItemOffset),this.FMouseMoveRestrain=!1,this.DoItemMouseMove(this.FMouseMoveItemNo,this.FMouseMoveItemOffset,t),void this.Style.UpdateInfoRePaint();var e=-1,i=-1,n=!1,o=this.GetItemAt(t.x,t.y,e,i,this.FMouseMoveDrawItemNo,n);if(e=o.itemNo,i=o.offset,this.FMouseMoveDrawItemNo=o.drawItemNo,n=o.restrain,this.FDraging||this.Style.UpdateInfo.DragingSelected)this.FStyle.Cursor=Fe,this.FMouseMoveItemNo=e,this.FMouseMoveItemOffset=i,this.FMouseMoveRestrain=n,this.CaretDrawItemNo=this.FMouseMoveDrawItemNo,this.Style.UpdateInfoReCaret(),!n&&this.Items[this.FMouseMoveItemNo].StyleNo<oo.Null&&this.DoItemMouseMove(this.FMouseMoveItemNo,this.FMouseMoveItemOffset,t);else if(this.FSelecting){if(this.Items[this.FMouseDownItemNo].StyleNo<oo.Null&&this.FMouseDownItemOffset===Yl.OffsetInner)return this.FMouseMoveItemNo=this.FMouseDownItemNo,this.FMouseMoveItemOffset=this.FMouseDownItemOffset,e===this.FMouseDownItemNo?this.FMouseMoveRestrain=n:this.FMouseMoveRestrain=!0,this.DoItemMouseMove(this.FMouseMoveItemNo,this.FMouseMoveItemOffset,t),this.Style.UpdateInfoRePaint(),void this.Style.UpdateInfoReCaret();this.FMouseMoveItemNo!==e&&e>=0&&this.FItems[e].StyleNo<oo.Null&&this.DoItemMouseMove(e,i,t),this.FMouseMoveItemNo=e,this.FMouseMoveItemOffset=i,this.FMouseMoveRestrain=n,this.Items[this.FMouseMoveItemNo].StyleNo<oo.Null&&this.FMouseMoveItemOffset===Yl.OffsetInner&&this.DoItemMouseMove(this.FMouseMoveItemNo,this.FMouseMoveItemOffset,t);var s=this.AdjustSelectRange(this.FMouseDownItemNo,this.FMouseDownItemOffset,this.FMouseMoveItemNo,this.FMouseMoveItemOffset);this.FMouseDownItemNo=s.startItemNo,this.FMouseDownItemOffset=s.startItemOffset,this.FMouseMoveItemNo=s.endItemNo,this.FMouseMoveItemOffset=s.endItemOffset,this.FSelectSeekNo=this.FMouseMoveItemNo,this.FSelectSeekOffset=this.FMouseMoveItemOffset,this.SelectExists()?this.MatchItemSelectState():this.CaretDrawItemNo=this.FMouseMoveDrawItemNo,this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret()}else!this.FMouseLBDowning||this.FMouseDownX===t.x&&this.FMouseDownY===t.y?(e!==this.FMouseMoveItemNo?(this.FMouseMoveItemNo>=0&&this.DoItemMouseLeave(this.FMouseMoveItemNo),e>=0&&!n&&this.DoItemMouseEnter(e),this.Style.UpdateInfoRePaint()):n!==this.FMouseMoveRestrain&&(!this.FMouseMoveRestrain&&n?this.FMouseMoveItemNo>=0&&this.DoItemMouseLeave(this.FMouseMoveItemNo):this.FMouseMoveRestrain&&!n&&e>=0&&this.DoItemMouseEnter(e),this.Style.UpdateInfoRePaint()),this.FMouseMoveItemNo=e,this.FMouseMoveItemOffset=i,this.FMouseMoveRestrain=n,this.DoItemMouseMove(this.FMouseMoveItemNo,this.FMouseMoveItemOffset,t,!0),this.hcl.keyDownStates[He]&&""!==this.Items[this.FMouseMoveItemNo].HyperLink&&(this.FStyle.Cursor=ve)):(this.FSelecting=!0,this.Style.UpdateInfo.Selecting=!0)}},{key:"DoItemMouseUp",value:function(t,e,i,n){if(!(t<0)){var o=this.CoordToItemOffset(n.x,n.y,t,e,-1,-1),s=new fi;s.assign(n),s.x=o.x,s.y=o.y,this.Items[t].MouseUp(s),i||null===this.OnItemMouseUp||this.OnItemMouseUp(this,t,e,s)}}},{key:"DoNormalMouseUp",value:function(t,e,i,n,o){this.FMouseMoveItemNo<0?(this.SelectInfo.StartItemNo=t,this.SelectInfo.StartItemOffset=e,this.SelectInfo.StartRestrain=n,this.CaretDrawItemNo=i):(this.SelectInfo.StartItemNo=this.FMouseMoveItemNo,this.SelectInfo.StartItemOffset=this.FMouseMoveItemOffset,this.SelectInfo.StartRestrain=n,this.CaretDrawItemNo=this.FMouseMoveDrawItemNo),this.Style.UpdateInfoRePaint(),this.FMouseDownReCaret||this.Style.UpdateInfoReCaret(),this.DoItemMouseUp(t,e,n,o)}},{key:"DoSelectBound",value:function(){this.SelectExists(!1)&&null!==this.OnSelectBound&&this.OnSelectBound(this)}},{key:"MouseUp",value:function(t){this.FMouseLBDowning=!1;var e=-1,i=-1,n=-1,o=null,s=!1;if(this.FMouseLBDouble)return o=this.GetItemAt(t.x,t.y,e,i,n,s),void(this.Items[o.itemNo].StyleNo<oo.Null&&this.DoItemMouseUp(o.itemNo,o.offset,o.restrain,t));if(t.button!==ae||!this.hcl.keyDownStates[Ge]){if(this.SelectedResizing()){this.Undo_New(),this.UndoAction_ItemSelf(this.FMouseDownItemNo,this.FMouseDownItemOffset),this.DoItemMouseUp(this.FMouseDownItemNo,this.FMouseDownItemOffset,s,t),this.DoItemResized(this.FMouseDownItemNo);var r=-1,a=-1,l=this.GetFormatRangeByOffset(this.FMouseDownItemNo,this.FMouseDownItemOffset,r,a);return r=l.firstDrawItemNo,a=l.lastItemNo,this.FormatPrepare(r,a),this.ReFormatData(r,a),void this.Style.UpdateInfoRePaint()}if(e=(o=this.GetItemAt(t.x,t.y,e,i,n,s)).itemNo,i=o.offset,n=o.drawItemNo,s=o.restrain,this.FSelecting||this.Style.UpdateInfo.Selecting)this.FSelecting=!1,this.SelectInfo.EndItemNo<0?this.FMouseDownItemNo>=0&&this.Items[this.FMouseDownItemNo].StyleNo<oo.Null?this.DoItemMouseUp(this.FMouseDownItemNo,Yl.OffsetInner,s,t):this.DoItemMouseUp(e,i,s,t):this.Items[e].StyleNo<oo.Null&&this.DoItemMouseUp(e,i,s,t),this.DoSelectBound();else if(this.FDraging||this.Style.UpdateInfo.DragingSelected){if(this.FDraging=!1,this.SelectInfo.StartItemNo>=0)for(var h=this.SelectInfo.StartItemNo;h<=this.SelectInfo.EndItemNo;h++)this.Items[h].DisSelect();this.FMouseMoveItemNo=e,this.FMouseMoveItemOffset=i,this.FMouseMoveDrawItemNo=n,this.FMouseDownItemNo=e,this.FMouseDownItemOffset=i,this.DoNormalMouseUp(e,i,n,s,t),this.SelectInfo.EndItemNo=-1,this.SelectInfo.EndItemOffset=-1}else t.button===le&&this.CoordInSelect(t.x,t.y,e,i,s)?this.FItems[e].StyleNo<oo.Null&&this.DoItemMouseUp(e,i,s,t):(this.SelectExists(!1)&&this.DisSelect(),this.DoNormalMouseUp(e,i,n,s,t))}}},{key:"MouseLeave",value:function(){this.FMouseMoveItemNo>=0&&(this.DoItemMouseLeave(this.FMouseMoveItemNo),this.FMouseMoveItemNo=-1,this.FMouseMoveItemOffset=-1,this.FMouseMoveDrawItemNo=-1,this.Style.UpdateInfoRePaint())}},{key:"KeyPress",value:function(t){if(this.CanEdit()){if(!this.DeleteSelected())return!1;var e=this.GetActiveItem();if(null!=e)if(e.StyleNo<oo.Null&&this.SelectInfo.StartItemOffset===Yl.OffsetInner){this.Undo_New();var i=e;if(i.MangerUndo?this.UndoAction_ItemSelf(this.SelectInfo.StartItemNo,Yl.OffsetInner):this.UndoAction_ItemMirror(this.SelectInfo.StartItemNo,Yl.OffsetInner),i.KeyPress(t),i.IsFormatDirty){var n=-1,o=-1,s=this.GetFormatRange(n,o);n=s.firstDrawItemNo,o=s.lastItemNo,this.FormatPrepare(n,o),0!==t.keyCode&&this.ReFormatData(n,o),i.IsFormatDirty=!1,this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),this.Style.UpdateInfoReScroll()}else this.FormatInit()}else this.InsertText(String.fromCharCode(t.keyCode))}}},{key:"CheckSelectEndEff",value:function(){var t=this.SelectInfo.StartItemNo,e=this.SelectInfo.StartItemOffset,i=this.SelectInfo.EndItemNo,n=this.SelectInfo.EndItemOffset;console.log(t,e,i,n),this.AdjustSelectRange(t,e,i,n)}},{key:"SetSelectSeekStart",value:function(){this.FSelectSeekNo=this.SelectInfo.StartItemNo,this.FSelectSeekOffset=this.SelectInfo.StartItemOffset}},{key:"SetSelectSeekEnd",value:function(){this.FSelectSeekNo=this.SelectInfo.EndItemNo,this.FSelectSeekOffset=this.SelectInfo.EndItemOffset}},{key:"TABKeyDown",value:function(t,e){if(0===this.SelectInfo.StartItemOffset&&this.Items[this.SelectInfo.StartItemNo].ParaFirst){var i=this.Style.ParaStyles[t.ParaNo],n=this.MatchTextStyleNoAt(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset);n<oo.Null&&(n=this.Style.GetDefaultStyleNo());var o=Yl.TabCharWidth;n>oo.Null&&(this.Style.ApplyTempStyle(n),o=2*this.Style.TempCanvas.textWidth("荆")),this.ApplyParaFirstIndent(i.FirstIndent+En.pixXToMillimeter(o))}else if(t.StyleNo<oo.Null)if(this.SelectInfo.StartItemOffset===Yl.OffsetInner){if(t.WantKeyDown(e)){var s=-1,r=-1,a=this.GetFormatRange(s,r);s=a.firstDrawItemNo,r=a.lastItemNo,this.FormatPrepare(s,r),t.KeyDown(e),this.ReFormatData(s,r)}}else{var l=new Xr(this.hcl,this);this.InsertItem(l)}else{var h=new Xr(this.hcl,this);this.InsertItem(h)}}},{key:"SelectPrio",value:function(t,e){return e>0?this.Items[t].StyleNo<oo.Null?e=this.Items[t].StyleNo===oo.Domain?this.Items[t].GetOffsetAt(0):Yl.OffsetBefor:e-=1:t>0&&(t-=1,e=this.Items[t].StyleNo<oo.Null?this.Items[t].StyleNo===oo.Domain?this.Items[t].GetOffsetAt(0):Yl.OffsetBefor:this.Items[t].Length>0?this.Items[t].Length-1:0),Yl.UNPLACEHOLDERCHAR&&this.Items[t].StyleNo>oo.Null&&this.Items[t].Length>0&&Yl.IsUnPlaceHolderChar(this.Items[t].Text[e+1-1])&&(e=this.GetItemActualOffset(t,e)-1),{itemNo:t,offset:e}}},{key:"SelectStartItemPrio",value:function(){var t=this.SelectPrio(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset);this.SelectInfo.StartItemNo=t.itemNo,this.SelectInfo.StartItemOffset=t.offset}},{key:"SelectEndItemPrio",value:function(){var t=this.SelectPrio(this.SelectInfo.EndItemNo,this.SelectInfo.EndItemOffset);this.SelectInfo.EndItemNo=t.itemNo,this.SelectInfo.EndItemOffset=t.offset}},{key:"LeftKeyDown",value:function(t,e){if(e.shiftState.has(oe))this.SelectInfo.EndItemNo>=0?this.IsSelectSeekStart()?(this.SelectStartItemPrio(),this.CheckSelectEndEff(),this.SetSelectSeekStart()):(this.SelectEndItemPrio(),this.CheckSelectEndEff(),this.SetSelectSeekEnd()):(this.SelectInfo.StartItemNo>0&&0===this.SelectInfo.StartItemOffset&&(this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.SelectInfo.StartItemOffset=this.GetItemOffsetAfter(this.SelectInfo.StartItemNo)),this.SelectInfo.EndItemNo=this.SelectInfo.StartItemNo,this.SelectInfo.EndItemOffset=this.SelectInfo.StartItemOffset,this.SelectStartItemPrio(),this.CheckSelectEndEff(),this.SetSelectSeekStart()),this.MatchItemSelectState(),this.Style.UpdateInfoRePaint(),this.SelectExists(!1)||(this.CaretDrawItemNo=this.GetDrawItemNoByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset));else{if(t){for(var i=this.SelectInfo.StartItemNo;i<=this.SelectInfo.EndItemNo;i++)this.Items[i].DisSelect();this.SelectInfo.EndItemNo=-1,this.SelectInfo.EndItemOffset=-1}else{if(!this.FItems[this.SelectInfo.StartItemNo].Visible)return void(this.SelectInfo.StartItemNo>0&&(this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.SelectInfo.StartItemOffset=this.GetItemOffsetAfter(this.SelectInfo.StartItemNo),this.Style.UpdateInfoRePaint(),this.KeyDown(e)));if(0!==this.SelectInfo.StartItemOffset){if(this.SelectInfo.StartItemOffset=this.SelectInfo.StartItemOffset-1,Yl.UNPLACEHOLDERCHAR){var n=this.Items[this.SelectInfo.StartItemNo].Text[this.SelectInfo.StartItemOffset+1-1];Yl.TibetanVowel.indexOf(n)>=0||Yl.IsUnPlaceHolderChar(n)&&(this.SelectInfo.StartItemOffset=this.GetItemActualOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset)-1)}}else if(this.SelectInfo.StartItemNo>0){if(this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.SelectInfo.StartItemOffset=this.GetItemOffsetAfter(this.SelectInfo.StartItemNo),!this.DrawItems[this.Items[this.SelectInfo.StartItemNo+1].FirstDItemNo].LineFirst)return this.Style.UpdateInfoRePaint(),void this.KeyDown(e)}else e.Handled=!0}if(!e.Handled){var o=this.GetDrawItemNoByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset);o!==this.CaretDrawItemNo?o===this.CaretDrawItemNo-1&&this.DrawItems[o].ItemNo===this.DrawItems[this.CaretDrawItemNo].ItemNo&&this.DrawItems[this.CaretDrawItemNo].LineFirst&&this.SelectInfo.StartItemOffset===this.DrawItems[this.CaretDrawItemNo].CharOffs-1||(this.CaretDrawItemNo=o):this.SelectInfo.StartRestrain&&(this.SelectInfo.StartRestrain=!1,this.Items[this.DrawItems[o].ItemNo].Active=!0),this.Style.UpdateInfoRePaint()}}}},{key:"SelectNext",value:function(t,e){return e===this.GetItemOffsetAfter(t)?t<this.Items.count-1&&(t++,e=this.Items[t].StyleNo<oo.Null?this.Items[t].StyleNo===oo.Domain?this.Items[t].GetOffsetAt(0):Yl.OffsetAfter:this.Items[t].Length>0?1:0):this.Items[t].StyleNo<oo.Null?e=this.Items[t].StyleNo===oo.Domain?this.Items[t].GetOffsetAt(0):Yl.OffsetAfter:e+=1,Yl.UNPLACEHOLDERCHAR&&(e=this.GetItemActualOffset(t,e,!0)),{itemNo:t,offset:e}}},{key:"SelectStartItemNext",value:function(){var t=this.SelectNext(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset);this.SelectInfo.StartItemNo=t.itemNo,this.SelectInfo.StartItemOffset=t.offset}},{key:"SelectEndItemNext",value:function(){var t=this.SelectNext(this.SelectInfo.EndItemNo,this.SelectInfo.EndItemOffset);this.SelectInfo.EndItemNo=t.itemNo,this.SelectInfo.EndItemOffset=t.offset}},{key:"RightKeyDown",value:function(t,e,i){if(i.shiftState.has(oe))this.SelectInfo.EndItemNo>=0?this.IsSelectSeekStart()?(this.SelectStartItemNext(),this.CheckSelectEndEff(),this.SetSelectSeekStart()):(this.SelectEndItemNext(),this.CheckSelectEndEff(),this.SetSelectSeekEnd()):(this.SelectInfo.StartItemNo<this.Items.count-1&&(this.Items[this.SelectInfo.StartItemNo].StyleNo<oo.Null?this.SelectInfo.StartItemOffset===Yl.OffsetAfter&&(this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=0):this.SelectInfo.StartItemOffset===this.Items[this.SelectInfo.StartItemNo].Length&&(this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=0)),this.SelectInfo.EndItemNo=this.SelectInfo.StartItemNo,this.SelectInfo.EndItemOffset=this.SelectInfo.StartItemOffset,this.SelectEndItemNext(),this.CheckSelectEndEff(),this.SetSelectSeekEnd()),this.MatchItemSelectState(),this.Style.UpdateInfoRePaint(),this.SelectExists(!1)||(this.CaretDrawItemNo=this.GetDrawItemNoByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset));else{if(t){for(var n=this.SelectInfo.StartItemNo;n<=this.SelectInfo.EndItemNo;n++)this.Items[n].DisSelect();this.SelectInfo.StartItemNo=this.SelectInfo.EndItemNo,this.SelectInfo.StartItemOffset=this.SelectInfo.EndItemOffset,this.SelectInfo.EndItemNo=-1,this.SelectInfo.EndItemOffset=-1}else{if(!this.FItems[this.SelectInfo.StartItemNo].Visible)return void(this.SelectInfo.StartItemNo<this.Items.count-1&&(this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=0,this.Style.UpdateInfoRePaint(),this.KeyDown(i)));if(this.SelectInfo.StartItemOffset<e.Length)Yl.UNPLACEHOLDERCHAR?this.SelectInfo.StartItemOffset=this.GetItemActualOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset+1,!0):this.SelectInfo.StartItemOffset=this.SelectInfo.StartItemOffset+1;else if(this.SelectInfo.StartItemNo<this.Items.count-1){if(this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=0,!this.DrawItems[this.Items[this.SelectInfo.StartItemNo].FirstDItemNo].LineFirst)return this.Style.UpdateInfoRePaint(),void this.KeyDown(i)}else i.Handled=!0}if(!i.Handled){var o=this.GetDrawItemNoByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset);o===this.CaretDrawItemNo?this.SelectInfo.StartItemOffset===this.DrawItems[o].CharOffsetEnd()&&o<this.DrawItems.count-1&&this.DrawItems[o].ItemNo===this.DrawItems[o+1].ItemNo&&this.DrawItems[o+1].LineFirst&&this.SelectInfo.StartItemOffset===this.DrawItems[o+1].CharOffs-1?this.CaretDrawItemNo=o+1:this.SelectInfo.StartRestrain&&(this.SelectInfo.StartRestrain=!1,this.Items[this.DrawItems[o].ItemNo].Active=!0):this.CaretDrawItemNo=o,this.Style.UpdateInfoRePaint()}}}},{key:"HomeKeyDown",value:function(t,e){if(e.shiftState.has(oe)){for(var i=this.GetDrawItemNoByOffset(this.FSelectSeekNo,this.FSelectSeekOffset);i>0&&!this.DrawItems[i].LineFirst;)i--;this.SelectInfo.EndItemNo>=0?this.IsSelectSeekStart()?(this.SelectInfo.StartItemNo=this.DrawItems[i].ItemNo,this.Items[this.SelectInfo.StartItemNo].StyleNo===oo.Domain?this.SelectInfo.StartItemOffset=this.Items[this.SelectInfo.StartItemNo].GetOffsetAt(0):this.SelectInfo.StartItemOffset=this.DrawItems[i].CharOffs-1,this.CheckSelectEndEff(),this.SetSelectSeekStart()):this.DrawItems[i].ItemNo>this.SelectInfo.StartItemNo?(this.SelectInfo.EndItemNo=this.DrawItems[i].ItemNo,this.Items[this.SelectInfo.EndItemNo].StyleNo===oo.Domain?this.SelectInfo.EndItemOffset=this.Items[this.SelectInfo.EndItemNo].GetOffsetAt(0):this.SelectInfo.EndItemOffset=this.DrawItems[i].CharOffs-1,this.CheckSelectEndEff(),this.SetSelectSeekEnd()):this.DrawItems[i].ItemNo===this.SelectInfo.StartItemNo?this.DrawItems[i].CharOffs-1>this.SelectInfo.StartItemOffset&&(this.SelectInfo.EndItemNo=this.SelectInfo.StartItemNo,this.Items[this.SelectInfo.EndItemNo].StyleNo===oo.Domain?this.SelectInfo.EndItemOffset=this.Items[this.SelectInfo.EndItemNo].GetOffsetAt(0):this.SelectInfo.EndItemOffset=this.DrawItems[i].CharOffs-1,this.CheckSelectEndEff(),this.SetSelectSeekEnd()):(this.SelectInfo.EndItemNo=this.SelectInfo.StartItemNo,this.SelectInfo.EndItemOffset=this.SelectInfo.StartItemOffset,this.SelectInfo.StartItemNo=this.DrawItems[i].ItemNo,this.Items[this.SelectInfo.StartItemNo].StyleNo===oo.Domain?this.SelectInfo.StartItemOffset=this.Items[this.SelectInfo.StartItemNo].GetOffsetAt(0):this.SelectInfo.StartItemOffset=this.DrawItems[i].CharOffs-1,this.CheckSelectEndEff(),this.SetSelectSeekStart()):(this.SelectInfo.EndItemNo=this.SelectInfo.StartItemNo,this.SelectInfo.EndItemOffset=this.SelectInfo.StartItemOffset,this.SelectInfo.StartItemNo=this.DrawItems[i].ItemNo,this.Items[this.SelectInfo.StartItemNo].StyleNo===oo.Domain?this.SelectInfo.StartItemOffset=this.Items[this.SelectInfo.StartItemNo].GetOffsetAt(0):this.SelectInfo.StartItemOffset=this.DrawItems[i].CharOffs-1,this.CheckSelectEndEff(),this.SetSelectSeekStart()),this.MatchItemSelectState(),this.Style.UpdateInfoRePaint(),this.SelectExists(!1)||(this.CaretDrawItemNo=this.GetDrawItemNoByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset))}else{if(t){for(var n=this.SelectInfo.StartItemNo;n<=this.SelectInfo.EndItemNo;n++)this.Items[n].DisSelect();this.SelectInfo.EndItemNo=-1,this.SelectInfo.EndItemOffset=-1}else{var o=this.GetSelectStartDrawItemNo(),s=-1,r=this.GetLineDrawItemRang(o,s);o=r.a,s=r.b,this.SelectInfo.StartItemNo=this.DrawItems[o].ItemNo,this.Items[this.SelectInfo.StartItemNo].StyleNo===oo.Domain?this.SelectInfo.StartItemOffset=this.Items[this.SelectInfo.StartItemNo].GetOffsetAt(0):this.SelectInfo.StartItemOffset=this.DrawItems[o].CharOffs-1}e.Handled||(this.CaretDrawItemNo=this.GetDrawItemNoByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset)),this.Style.UpdateInfoRePaint()}}},{key:"EndKeyDown",value:function(t,e){if(e.shiftState.has(oe)){var i=this.GetDrawItemNoByOffset(this.FSelectSeekNo,this.FSelectSeekOffset);for(i+=1;i<this.DrawItems.count&&!this.DrawItems[i].LineFirst;)i++;i--,this.SelectInfo.EndItemNo>=0?this.IsSelectSeekStart()?this.DrawItems[i].ItemNo>this.SelectInfo.EndItemNo?(this.SelectInfo.StartItemNo=this.DrawItems[i].ItemNo,this.Items[this.SelectInfo.StartItemNo].StyleNo<oo.Null?this.Items[this.SelectInfo.StartItemNo].StyleNo===oo.Domain?this.SelectInfo.StartItemOffset=this.Items[this.SelectInfo.StartItemNo].GetOffsetAt(0):this.SelectInfo.StartItemOffset=Yl.OffsetAfter:this.SelectInfo.StartItemOffset=this.DrawItems[i].CharOffsetEnd(),this.CheckSelectEndEff(),this.SetSelectSeekStart()):this.DrawItems[i].ItemNo==this.SelectInfo.EndItemNo?(this.SelectInfo.StartItemNo=this.SelectInfo.EndItemNo,this.DrawItems[i].CharOffsetEnd()<this.SelectInfo.EndItemOffset?(this.Items[this.SelectInfo.StartItemNo].StyleNo===oo.Domain?this.SelectInfo.StartItemOffset=this.Items[this.SelectInfo.StartItemNo].GetOffsetAt(0):this.SelectInfo.StartItemOffset=this.DrawItems[i].CharOffsetEnd(),this.CheckSelectEndEff(),this.SetSelectSeekStart()):(this.SelectInfo.StartItemOffset=this.SelectInfo.EndItemOffset,this.Items[this.SelectInfo.EndItemNo].StyleNo===oo.Domain?this.SelectInfo.EndItemOffset=this.Items[this.SelectInfo.EndItemNo].GetOffsetAt(0):this.SelectInfo.EndItemOffset=this.DrawItems[i].CharOffsetEnd(),this.CheckSelectEndEff(),this.SetSelectSeekEnd())):(this.SelectInfo.StartItemNo=this.SelectInfo.EndItemNo,this.SelectInfo.StartItemOffset=this.SelectInfo.EndItemOffset,this.SelectInfo.EndItemNo=this.DrawItems[i].ItemNo,this.Items[this.SelectInfo.EndItemNo].StyleNo===oo.Domain?this.SelectInfo.EndItemOffset=this.Items[this.SelectInfo.EndItemNo].GetOffsetAt(0):this.SelectInfo.EndItemOffset=this.DrawItems[i].CharOffsetEnd(),this.CheckSelectEndEff(),this.SetSelectSeekEnd()):(this.SelectInfo.EndItemNo=this.DrawItems[i].ItemNo,this.Items[this.SelectInfo.EndItemNo].StyleNo===oo.Domain?this.SelectInfo.EndItemOffset=this.Items[this.SelectInfo.EndItemNo].GetOffsetAt(0):this.SelectInfo.EndItemOffset=this.DrawItems[i].CharOffsetEnd(),this.CheckSelectEndEff(),this.SetSelectSeekEnd()):(this.SelectInfo.EndItemNo=this.DrawItems[i].ItemNo,this.Items[this.SelectInfo.EndItemNo].StyleNo===oo.Domain?this.SelectInfo.EndItemOffset=this.Items[this.SelectInfo.EndItemNo].GetOffsetAt(0):this.SelectInfo.EndItemOffset=this.DrawItems[i].CharOffsetEnd(),this.CheckSelectEndEff(),this.SelectInfo.EndItemNo<0?this.SetSelectSeekStart():this.SetSelectSeekEnd()),this.MatchItemSelectState(),this.Style.UpdateInfoRePaint(),this.SelectExists(!1)||(this.CaretDrawItemNo=this.GetDrawItemNoByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset))}else{if(t){for(var n=this.SelectInfo.StartItemNo;n<=this.SelectInfo.EndItemNo;n++)this.Items[n].DisSelect();this.SelectInfo.StartItemNo=this.SelectInfo.EndItemNo,this.Items[this.SelectInfo.StartItemNo].StyleNo===oo.Domain?this.SelectInfo.StartItemOffset=this.Items[this.SelectInfo.StartItemNo].GetOffsetAt(0):this.SelectInfo.StartItemOffset=this.SelectInfo.EndItemOffset,this.SelectInfo.EndItemNo=-1,this.SelectInfo.EndItemOffset=-1}else{var o=this.GetSelectStartDrawItemNo(),s=-1,r=this.GetLineDrawItemRang(o,s);o=r.a,s=r.b,this.SelectInfo.StartItemNo=this.DrawItems[s].ItemNo,this.Items[this.SelectInfo.StartItemNo].StyleNo===oo.Domain?this.SelectInfo.StartItemOffset=this.Items[this.SelectInfo.StartItemNo].GetOffsetAt(0):this.SelectInfo.StartItemOffset=this.DrawItems[s].CharOffsetEnd()}e.Handled||(this.CaretDrawItemNo=this.GetDrawItemNoByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset)),this.Style.UpdateInfoRePaint()}}},{key:"GetUpDrawItemNo",value:function(t,e){var i=!1,n=t,o=-1,s=this.GetLineDrawItemRang(n,o);if(n=s.a,o=s.b,n>0){i=!0;var r=this.DrawItems[t].rect.left+this.GetDrawItemOffsetWidth(t,e);n-=1,n=(s=this.GetLineDrawItemRang(n,o)).a,o=s.b;for(var a=n;a<=o;a++)if(this.DrawItems[a].rect.right>r)return{drawItemNo:t=a,drawItemOffset:e=this.Items[this.DrawItems[a].ItemNo].StyleNo===oo.Domain?this.Items[this.DrawItems[a].ItemNo].GetOffsetAt(0):this.Items[this.DrawItems[a].ItemNo].StyleNo<oo.Null?r<this.DrawItems[a].rect.left+this.DrawItems[a].rect.width/2?Yl.OffsetBefor:Yl.OffsetAfter:this.DrawItems[a].CharOffs+this.GetDrawItemOffsetAt(a,r)-1,result:i};t=o,e=this.Items[this.DrawItems[o].ItemNo].StyleNo===oo.Domain?this.Items[this.DrawItems[o].ItemNo].GetOffsetAt(0):this.DrawItems[o].CharOffsetEnd()}return{drawItemNo:t,drawItemOffset:e,result:i}}},{key:"UpKeyDown",value:function(t,e){if(e.shiftState.has(oe)){var i,n=-1,o=-1;this.SelectInfo.EndItemNo>=0?this.IsSelectSeekStart()?(n=this.GetSelectStartDrawItemNo(),o=this.SelectInfo.StartItemOffset-this.DrawItems[n].CharOffs+1,n=(i=this.GetUpDrawItemNo(n,o)).drawItemNo,o=i.drawItemOffset,i.result&&(this.SelectInfo.StartItemNo=this.DrawItems[n].ItemNo,this.SelectInfo.StartItemOffset=o,this.CheckSelectEndEff(),this.SetSelectSeekStart())):(n=this.GetSelectEndDrawItemNo(),o=this.SelectInfo.EndItemOffset-this.DrawItems[n].CharOffs+1,n=(i=this.GetUpDrawItemNo(n,o)).drawItemNo,o=i.drawItemOffset,i.result&&(this.DrawItems[n].ItemNo>this.SelectInfo.StartItemNo?(this.SelectInfo.EndItemNo=this.DrawItems[n].ItemNo,this.SelectInfo.EndItemOffset=o,this.CheckSelectEndEff(),this.SetSelectSeekEnd()):this.DrawItems[n].ItemNo==this.SelectInfo.StartItemNo?(this.SelectInfo.EndItemNo=this.SelectInfo.StartItemNo,o>this.SelectInfo.StartItemOffset?(this.SelectInfo.EndItemOffset=o,this.CheckSelectEndEff(),this.SetSelectSeekEnd()):(this.SelectInfo.EndItemOffset=this.SelectInfo.StartItemOffset,this.SelectInfo.StartItemOffset=o,this.CheckSelectEndEff(),this.SetSelectSeekStart())):(this.SelectInfo.EndItemNo=this.SelectInfo.StartItemNo,this.SelectInfo.EndItemOffset=this.SelectInfo.StartItemOffset,this.SelectInfo.StartItemNo=this.DrawItems[n].ItemNo,this.SelectInfo.StartItemOffset=o,this.CheckSelectEndEff(),this.SetSelectSeekStart()))):(n=this.CaretDrawItemNo,o=this.SelectInfo.StartItemOffset-this.DrawItems[n].CharOffs+1,n=(i=this.GetUpDrawItemNo(n,o)).drawItemNo,o=i.drawItemOffset,i.result&&(this.SelectInfo.EndItemNo=this.SelectInfo.StartItemNo,this.SelectInfo.EndItemOffset=this.SelectInfo.StartItemOffset,this.SelectInfo.StartItemNo=this.DrawItems[n].ItemNo,this.SelectInfo.StartItemOffset=o,this.CheckSelectEndEff(),this.SetSelectSeekStart())),this.MatchItemSelectState(),this.Style.UpdateInfoRePaint(),this.SelectExists(!1)||(this.CaretDrawItemNo=this.GetDrawItemNoByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset))}else if(t)this.SelectInfo.EndItemNo=-1,this.SelectInfo.EndItemOffset=-1;else{var s=this.CaretDrawItemNo,r=this.SelectInfo.StartItemOffset-this.DrawItems[s].CharOffs+1,a=this.GetUpDrawItemNo(s,r);s=a.drawItemNo,r=a.drawItemOffset,a.result?(this.SelectInfo.StartItemNo=this.DrawItems[s].ItemNo,this.SelectInfo.StartItemOffset=r,this.CaretDrawItemNo=s,this.Style.UpdateInfoRePaint()):e.Handled=!0}}},{key:"GetDownDrawItemNo",value:function(t,e){var i=!1,n=t,o=-1,s=this.GetLineDrawItemRang(n,o);if(n=s.a,(o=s.b)<this.DrawItems.count-1){i=!0;var r=this.DrawItems[t].rect.left+this.GetDrawItemOffsetWidth(t,e);n=o+1,n=(s=this.GetLineDrawItemRang(n,o)).a,o=s.b;for(var a=n;a<=o;a++)if(this.DrawItems[a].rect.right>r)return{drawItemNo:t=a,drawItemOffset:e=this.Items[this.DrawItems[a].ItemNo].StyleNo===oo.Domain?this.Items[this.DrawItems[a].ItemNo].GetOffsetAt(0):this.Items[this.DrawItems[a].ItemNo].StyleNo<oo.Null?r<this.DrawItems[a].rect.left+this.DrawItems[a].rect.width/2?Yl.OffsetBefor:Yl.OffsetAfter:this.DrawItems[a].CharOffs+this.GetDrawItemOffsetAt(a,r)-1,result:i};t=o,e=this.Items[this.DrawItems[o].ItemNo].StyleNo===oo.Domain?this.Items[this.DrawItems[o].ItemNo].GetOffsetAt(0):this.DrawItems[o].CharOffsetEnd()}return{drawItemNo:t,drawItemOffset:e,result:i}}},{key:"DownKeyDown",value:function(t,e){if(e.shiftState.has(oe)){var i,n=-1,o=-1;this.SelectInfo.EndItemNo>=0?this.IsSelectSeekStart()?(n=this.GetSelectStartDrawItemNo(),o=this.SelectInfo.StartItemOffset-this.DrawItems[n].CharOffs+1,n=(i=this.GetDownDrawItemNo(n,o)).drawItemNo,o=i.drawItemOffset,i.result&&(this.DrawItems[n].ItemNo<this.SelectInfo.EndItemNo?(this.SelectInfo.StartItemNo=this.SelectInfo.EndItemNo,this.SelectInfo.StartItemOffset=this.SelectInfo.EndItemOffset,this.CheckSelectEndEff(),this.SetSelectSeekStart()):this.DrawItems[n].ItemNo===this.SelectInfo.EndItemNo?(this.SelectInfo.StartItemNo=this.SelectInfo.EndItemNo,o<this.SelectInfo.EndItemOffset?(this.SelectInfo.StartItemOffset=o,this.CheckSelectEndEff(),this.SetSelectSeekStart()):(this.SelectInfo.StartItemOffset=this.SelectInfo.EndItemOffset,this.SelectInfo.EndItemOffset=o,this.CheckSelectEndEff(),this.SetSelectSeekEnd())):(this.SelectInfo.StartItemNo=this.SelectInfo.EndItemNo,this.SelectInfo.StartItemOffset=this.SelectInfo.EndItemOffset,this.SelectInfo.EndItemNo=this.DrawItems[n].ItemNo,this.SelectInfo.EndItemOffset=o,this.CheckSelectEndEff(),this.SetSelectSeekEnd()))):(n=this.GetSelectEndDrawItemNo(),o=this.SelectInfo.EndItemOffset-this.DrawItems[n].CharOffs+1,n=(i=this.GetDownDrawItemNo(n,o)).drawItemNo,o=i.drawItemOffset,i.result&&(this.SelectInfo.EndItemNo=this.DrawItems[n].ItemNo,this.SelectInfo.EndItemOffset=o,this.CheckSelectEndEff(),this.SetSelectSeekEnd())):(n=this.CaretDrawItemNo,o=this.SelectInfo.StartItemOffset-this.DrawItems[n].CharOffs+1,n=(i=this.GetDownDrawItemNo(n,o)).drawItemNo,o=i.drawItemOffset,i.result&&(this.SelectInfo.EndItemNo=this.DrawItems[n].ItemNo,this.SelectInfo.EndItemOffset=o,this.CheckSelectEndEff(),this.SetSelectSeekEnd())),this.MatchItemSelectState(),this.Style.UpdateInfoRePaint(),this.SelectExists(!1)||(this.CaretDrawItemNo=this.GetDrawItemNoByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset))}else if(t)this.SelectInfo.StartItemNo=this.SelectInfo.EndItemNo,this.SelectInfo.StartItemOffset=this.SelectInfo.EndItemOffset,this.SelectInfo.EndItemNo=-1,this.SelectInfo.EndItemOffset=-1;else{var s=this.CaretDrawItemNo,r=this.SelectInfo.StartItemOffset-this.DrawItems[s].CharOffs+1,a=this.GetDownDrawItemNo(s,r);s=a.drawItemNo,r=a.drawItemOffset,a.result?(this.SelectInfo.StartItemNo=this.DrawItems[s].ItemNo,this.SelectInfo.StartItemOffset=r,this.CaretDrawItemNo=s,this.Style.UpdateInfoRePaint()):e.Handled=!0}}},{key:"RectItemKeyDown",value:function(t,e,i,n){var o,s=i.keyCode,r=-1,a=-1,l=e;if(this.SelectInfo.StartItemOffset===Yl.OffsetInner)if(l.WantKeyDown(i))this.Undo_New(),l.MangerUndo?this.UndoAction_ItemSelf(this.SelectInfo.StartItemNo,Yl.OffsetInner):this.UndoAction_ItemMirror(this.SelectInfo.StartItemNo,Yl.OffsetInner),l.KeyDown(i),l.IsFormatDirty?(r=(o=this.GetFormatRange(r,a)).firstDrawItemNo,a=o.lastItemNo,this.FormatPrepare(r,a),this.ReFormatData(r,a)):this.FormatInit();else switch(s){case Ee:this.SelectInfo.StartItemOffset=Yl.OffsetAfter,this.RectItemKeyDown(t,e,i,n);break;case Xe:this.SelectInfo.StartItemOffset=Yl.OffsetBefor,this.RectItemKeyDown(t,e,i,n);break;case Je:this.SelectInfo.StartItemOffset=Yl.OffsetBefor,l.Active=!1,this.Style.UpdateInfoRePaint();break;case Ye:this.SelectInfo.StartItemOffset=Yl.OffsetAfter,l.Active=!1,this.Style.UpdateInfoRePaint();break;default:l.KeyDown(i)}else if(this.SelectInfo.StartItemOffset===Yl.OffsetBefor)switch(s){case Je:this.LeftKeyDown(t,i);break;case Ye:i.shiftState.has(oe)?this.RightKeyDown(t,e,i):(l.WantKeyDown(i)?this.SelectInfo.StartItemOffset=Yl.OffsetInner:l.StyleNo===oo.Domain?this.SelectInfo.StartItemOffset=l.GetOffsetAt(l.Width+1):this.SelectInfo.StartItemOffset=Yl.OffsetAfter,this.CaretDrawItemNo=this.Items[this.SelectInfo.StartItemNo].FirstDItemNo);break;case je:this.UpKeyDown(t,i);break;case Qe:this.DownKeyDown(t,i);break;case ze:this.EndKeyDown(t,i);break;case Ke:this.HomeKeyDown(t,i);break;case Le:if(!this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ReturnItem))return;r=(o=this.GetFormatRange(r,a)).firstDrawItemNo,a=o.lastItemNo,this.FormatPrepare(r,a),e.ParaFirst?((e=this.CreateDefaultTextItem()).ParaFirst=!0,this.Items.insert(this.SelectInfo.StartItemNo,e),this.Undo_New(),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,0),n&&(this.UndoAction_ItemPageBreak(this.SelectInfo.StartItemNo+1,0,!0),this.Items[this.SelectInfo.StartItemNo+1].PageBreak=!0),this.ReFormatData(r,a+1,1),this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset)):(this.Undo_New(),this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo,0,!0),e.ParaFirst=!0,n&&(this.UndoAction_ItemPageBreak(this.SelectInfo.StartItemNo,0,!0),e.PageBreak=!0),this.ReFormatData(r,a));break;case Ee:e.ParaFirst&&!e.KeepParaFirst&&this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.BackDeleteText)?this.Style.ParaStyles[e.ParaNo].FirstIndent>0?this.ApplyParaFirstIndent(Math.max(0,this.Style.ParaStyles[e.ParaNo].FirstIndent-En.pixXToMillimeter(Yl.TabCharWidth))):this.SelectInfo.StartItemNo>0&&(r=this.GetFormatFirstDrawItem(this.SelectInfo.StartItemNo-1,this.GetItemOffsetAfter(this.SelectInfo.StartItemNo-1)),a=this.GetParaLastItemNo(this.SelectInfo.StartItemNo),this.FormatPrepare(r,a),this.Undo_New(),this.IsEmptyLine(this.SelectInfo.StartItemNo-1)?(this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo-1,0),this.Items.delete(this.SelectInfo.StartItemNo-1),this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.ReFormatData(r,a-1,-1),this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo,0)):(this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,!1),e.ParaFirst=!1,e.PageBreak&&(this.UndoAction_ItemPageBreak(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,!1),e.PageBreak=!1),this.ReFormatData(r,a))):(this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.SelectInfo.StartItemOffset=this.GetItemOffsetAfter(this.SelectInfo.StartItemNo),this.KeyDown(i));break;case Xe:if(this.DoAcceptActionBefor(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.DeleteItem))return;if(!this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.DeleteItem))return void(this.SelectInfo.StartItemOffset=Yl.OffsetAfter);if(r=(o=this.GetFormatRange(r,a)).firstDrawItemNo,a=o.lastItemNo,this.FormatPrepare(r,a),e.ParaFirst)this.SelectInfo.StartItemNo!==a?(this.Undo_New(),this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo+1,0,!0),this.Items[this.SelectInfo.StartItemNo+1].ParaFirst=!0,this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,0),this.Items.delete(this.SelectInfo.StartItemNo),this.ReFormatData(r,a-1,-1)):(this.Undo_New(),this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,0),this.Items.delete(this.SelectInfo.StartItemNo),(e=this.CreateDefaultTextItem()).ParaFirst=!0,this.Items.insert(this.SelectInfo.StartItemNo,e),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,0),this.ReFormatData(r,a));else if(this.SelectInfo.StartItemNo<a){var h=this.GetItemOffsetAfter(this.SelectInfo.StartItemNo-1);this.Undo_New(),this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,0),this.Items.delete(this.SelectInfo.StartItemNo),this.MergeItemText(this.Items[this.SelectInfo.StartItemNo-1],this.Items[this.SelectInfo.StartItemNo])?(this.UndoAction_InsertText(this.SelectInfo.StartItemNo-1,this.Items[this.SelectInfo.StartItemNo-1].Length-this.Items[this.SelectInfo.StartItemNo].Length+1,this.Items[this.SelectInfo.StartItemNo].Text),this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,0),this.Items.delete(this.SelectInfo.StartItemNo),this.ReFormatData(r,a-2,-2)):this.ReFormatData(r,a-1,-1),this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.SelectInfo.StartItemOffset=h}else this.Undo_New(),this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,0),this.Items.delete(this.SelectInfo.StartItemNo),this.ReFormatData(r,a-1,-1),this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.SelectInfo.StartItemOffset=this.GetItemOffsetAfter(this.SelectInfo.StartItemNo);this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset);break;case Me:this.TABKeyDown(e,i)}else if(this.SelectInfo.StartItemOffset===Yl.OffsetAfter)switch(s){case Ee:if(this.DoAcceptActionBefor(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.DeleteItem))return;if(!this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.DeleteItem))return void(this.SelectInfo.StartItemOffset=Yl.OffsetBefor);if(r=(o=this.GetFormatRange(r,a)).firstDrawItemNo,a=o.lastItemNo,this.FormatPrepare(r,a),e.ParaFirst)if(this.SelectInfo.StartItemNo>=0&&this.SelectInfo.StartItemNo<this.Items.count-1&&!this.Items[this.SelectInfo.StartItemNo+1].ParaFirst)this.Undo_New(),this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset),this.Items.delete(this.SelectInfo.StartItemNo),this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo,0,!0),this.Items[this.SelectInfo.StartItemNo].ParaFirst=!0,this.ReFormatData(r,a-1,-1),this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo,0);else{this.Undo_New(),this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,0),this.Items.delete(this.SelectInfo.StartItemNo);var c=this.CreateDefaultTextItem();c.ParaFirst=!0,this.Items.insert(this.SelectInfo.StartItemNo,c),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,0),this.ReFormatData(r,a),this.SelectInfo.StartItemOffset=0}else{this.SelectInfo.StartItemOffset=Yl.OffsetBefor;var u=Xe;i.shiftState.has(oe)&&(u|=Ge),i.Alt&&(u|=Ve);var f=new di;f.assign(i),f.keyCode=u,this.RectItemKeyDown(t,e,f,n)}break;case Xe:if(this.SelectInfo.StartItemNo<this.Items.count-1){if(!this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.DeleteText))return this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=0,void this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset);this.Items[this.SelectInfo.StartItemNo+1].ParaFirst&&!this.Items[this.SelectInfo.StartItemNo+1].KeepParaFirst?(r=this.GetFormatFirstDrawItem(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset),a=this.GetParaLastItemNo(this.SelectInfo.StartItemNo+1),this.FormatPrepare(r,a),this.Undo_New(),this.IsEmptyLine(this.SelectInfo.StartItemNo+1)?(this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo+1,0),this.Items.delete(this.SelectInfo.StartItemNo+1),this.ReFormatData(r,a-1,-1)):(this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo+1,0,!1),this.Items[this.SelectInfo.StartItemNo+1].ParaFirst=!1,this.ReFormatData(r,a),this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo+1,0))):(this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=0,this.KeyDown(i))}break;case Je:i.shiftState.has(oe)?this.LeftKeyDown(t,i):(l.WantKeyDown(i)?this.SelectInfo.StartItemOffset=Yl.OffsetInner:l.StyleNo===oo.Domain?this.SelectInfo.StartItemOffset=l.GetOffsetAt(-1):this.SelectInfo.StartItemOffset=Yl.OffsetBefor,this.CaretDrawItemNo=this.Items[this.SelectInfo.StartItemNo].FirstDItemNo);break;case Ye:this.RightKeyDown(t,e,i);break;case je:this.UpKeyDown(t,i);break;case Qe:this.DownKeyDown(t,i);break;case ze:this.EndKeyDown(t,i);break;case Ke:this.HomeKeyDown(t,i);break;case Le:if(!this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ReturnItem))return;r=(o=this.GetFormatRange(r,a)).firstDrawItemNo,a=o.lastItemNo,this.FormatPrepare(r,a),this.Undo_New(),this.SelectInfo.StartItemNo<this.Items.count-1&&!this.Items[this.SelectInfo.StartItemNo+1].ParaFirst?(this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo+1,0,!0),this.Items[this.SelectInfo.StartItemNo+1].ParaFirst=!0,this.ReFormatData(r,a),this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=0,this.CaretDrawItemNo=this.Items[this.SelectInfo.StartItemNo].FirstDItemNo):((e=this.CreateDefaultTextItem()).ParaFirst=!0,e.PageBreak=n,this.Items.insert(this.SelectInfo.StartItemNo+1,e),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo+1,0),this.ReFormatData(r,a+1,1),this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo+1,e.Length));break;case Me:this.TABKeyDown(e,i)}}},{key:"EnterKeyDown",value:function(t,e,i){if(this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ReturnItem)){var n=-1,o=-1,s=this.GetFormatRange(n,o);if(n=s.firstDrawItemNo,o=s.lastItemNo,this.FormatPrepare(n,o),0===this.SelectInfo.StartItemOffset)if(t.ParaFirst)if(i)if(this.Undo_New(),1===this.Items.count){var r=this.CreateDefaultTextItem();r.StyleNo=t.StyleNo,r.ParaNo=t.ParaNo,r.ParaFirst=!0,this.UndoAction_ItemPageBreak(this.SelectInfo.StartItemNo,0,!0),t.PageBreak=!0,this.Items.insert(this.SelectInfo.StartItemNo,r),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,0),this.SelectInfo.StartItemNo++,this.ReFormatData(n,o+1,1)}else this.UndoAction_ItemPageBreak(this.SelectInfo.StartItemNo,0,!0),t.PageBreak=!0,this.ReFormatData(n,o,0,!0);else{var a=this.CreateDefaultTextItem();a.ParaNo=t.ParaNo,a.StyleNo=t.StyleNo,a.ParaFirst=!0,this.Items.insert(this.SelectInfo.StartItemNo,a),this.Undo_New(),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,0),this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.ReFormatData(n,o+1,1)}else this.Undo_New(),this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo,0,!0),t.ParaFirst=!0,i&&(this.UndoAction_ItemPageBreak(this.SelectInfo.StartItemNo,0,!0),t.PageBreak=!0),this.ReFormatData(n,o,0,i);else if(this.SelectInfo.StartItemOffset==t.Length){var l=null;this.SelectInfo.StartItemNo<this.Items.count-1?((l=this.Items[this.SelectInfo.StartItemNo+1]).ParaFirst?((l=this.CreateDefaultTextItem()).ParaNo=t.ParaNo,l.StyleNo=t.StyleNo,l.ParaFirst=!0,i&&(l.PageBreak=!0),this.Items.insert(this.SelectInfo.StartItemNo+1,l),this.Undo_New(),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo+1,0),this.ReFormatData(n,o+1,1,i)):(this.Undo_New(),this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo+1,0,!0),l.ParaFirst=!0,i&&(this.UndoAction_ItemPageBreak(this.SelectInfo.StartItemNo+1,0,!0),l.PageBreak=!0),this.ReFormatData(n,o,0,i)),this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=0):((l=this.CreateDefaultTextItem()).ParaNo=t.ParaNo,l.StyleNo=t.StyleNo,l.ParaFirst=!0,i&&(l.PageBreak=!0),this.Items.insert(this.SelectInfo.StartItemNo+1,l),this.Undo_New(),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo+1,0),this.ReFormatData(n,o+1,1,i),this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=0)}else{var h=t.BreakByOffset(this.SelectInfo.StartItemOffset);this.Undo_New(),this.UndoAction_DeleteText(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset+1,h.Text),h.ParaFirst=!0,i&&(h.PageBreak=!0),this.Style.States.Include(oh.InsertBreakItem);try{this.Items.insert(this.SelectInfo.StartItemNo+1,h)}finally{this.Style.States.Exclude(oh.InsertBreakItem)}this.UndoAction_InsertItem(this.SelectInfo.StartItemNo+1,0),this.ReFormatData(n,o+1,1,i),this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=0}e.Handled||(this.CaretDrawItemNo=this.GetDrawItemNoByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset))}}},{key:"DeleteKeyDown",value:function(t,e){var i=this;if(!t.Visible&&this.SelectInfo.StartItemOffset<this.GetItemOffsetAfter(this.SelectInfo.StartItemNo))return this.SelectInfo.StartItemOffset=this.GetItemOffsetAfter(this.SelectInfo.StartItemNo),void this.KeyDown(e);if(!this.DoAcceptActionBefor(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.DeleteText)){if(!this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.DeleteText))return this.SelectInfo.StartItemOffset=this.Items[this.SelectInfo.StartItemNo].Length,void this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset);var n=0,o=-1,s=-1,r=this.SelectInfo.StartItemNo,a=this.GetFormatRange(o,s);if(o=a.firstDrawItemNo,s=a.lastItemNo,this.SelectInfo.StartItemOffset===t.Length){if(r!==this.Items.count-1){if(!this.Items[r+1].ParaFirst||this.Items[r+1].KeepParaFirst)return this.SelectInfo.StartItemNo=r+1,this.SelectInfo.StartItemOffset=0,this.SelectInfo.StartRestrain=!1,this.CaretDrawItemNo=this.Items[this.SelectInfo.StartItemNo].FirstDItemNo,void this.KeyDown(e);if(s=this.GetParaLastItemNo(r+1),0===t.Length)this.FormatPrepare(o,s),this.Undo_New(),this.UndoAction_DeleteItem(r,0),this.Items.delete(r),this.ReFormatData(o,s-1,-1);else if(this.Items[r+1].StyleNo<oo.Null)s=this.GetParaLastItemNo(r+1),this.FormatPrepare(o,s),this.Undo_New(),this.UndoAction_ItemParaFirst(r+1,0,!1),this.Items[r+1].ParaFirst=!1,this.Items[r+1].PageBreak&&(this.UndoAction_ItemPageBreak(r+1,0,!1),this.Items[r+1].PageBreak=!1),this.ReFormatData(o,s),this.SelectInfo.StartItemNo=r+1,this.SelectInfo.StartItemOffset=Yl.OffsetBefor;else{if(this.FormatPrepare(o,s),0===this.Items[r+1].Length)this.Undo_New(),this.UndoAction_DeleteItem(r+1,0),this.Items.delete(r+1),n++;else{t.CanConcatItems(this.Items[r+1])?(this.Undo_New(),this.UndoAction_InsertText(r,t.Length+1,this.Items[r+1].Text),t.Text=t.Text+this.Items[r+1].Text,this.UndoAction_DeleteItem(r+1,0),this.Items.delete(r+1),n++):this.Items[r+1].ParaFirst=!1;for(var l=this.Items[r].ParaNo,h=r+1;h<=s-n;h++)this.Items[h].ParaNo=l}this.ReFormatData(o,s-n,-n)}}}else{var c,u=this.Items[r].Text;if(Yl.UNPLACEHOLDERCHAR){var f=Yl.GetTextActualOffset(u,this.SelectInfo.StartItemOffset+1,!0)-this.SelectInfo.StartItemOffset;c=u.substr(this.SelectInfo.StartItemOffset+1-1,f),u=L.stringDelete(u,this.SelectInfo.StartItemOffset+1-1,f)}else c=u.substr(this.SelectInfo.StartItemOffset+1-1,1),t.Text=L.stringDelete(u,this.SelectInfo.StartItemOffset+1-1,1);if(""===u)if(this.DrawItems[this.Items[r].FirstDItemNo].LineFirst)if(r!==s)this.FormatPrepare(o,s),this.SelectInfo.StartItemOffset=0,this.Undo_New(),this.UndoAction_ItemParaFirst(r+1,0,this.Items[r].ParaFirst),this.Items[r+1].ParaFirst=this.Items[r].ParaFirst,this.Undo_New(),this.UndoAction_DeleteItem(r,0),this.Items.delete(r),this.DoItemChange(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ContentChange),this.ReFormatData(o,s-1,-1);else{this.FormatPrepare(o);var d=t.PageBreak;this.Undo_New(),this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,0),this.Items.delete(this.SelectInfo.StartItemNo);var m=this.CreateDefaultTextItem();m.ParaFirst=!0,m.PageBreak=d,this.Items.insert(this.SelectInfo.StartItemNo,m),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,0),this.SelectInfo.StartItemOffset=0,this.DoItemChange(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ContentChange),this.ReFormatData(o)}else if(r<this.Items.count-1){var S=-1;this.MergeItemText(this.Items[r-1],this.Items[r+1])?(S=this.Items[r+1].Length,this.Undo_New(),this.UndoAction_InsertText(r-1,this.Items[r-1].Length-S+1,this.Items[r+1].Text),o=(a=this.GetFormatRangeByOffset(r-1,S,o,s)).firstDrawItemNo,s=a.lastItemNo,this.FormatPrepare(o,s),this.UndoAction_DeleteItem(r,0),this.Items.delete(r),this.UndoAction_DeleteItem(r,0),this.Items.delete(r),this.ReFormatData(o,s-2,-2)):(S=0,this.FormatPrepare(o,s),this.Undo_New(),this.UndoAction_DeleteItem(r,0),this.DoDataDeleteItemAction(r,(function(){i.Items.delete(r)})),this.ReFormatData(o,s-1,-1)),this.SelectInfo.StartItemNo=r-1,this.GetItemStyle(this.SelectInfo.StartItemNo)<oo.Null?this.SelectInfo.StartItemOffset=Yl.OffsetAfter:this.SelectInfo.StartItemOffset=this.Items[this.SelectInfo.StartItemNo].Length-S}else this.FormatPrepare(o,s),this.Undo_New(),this.UndoAction_DeleteItem(r,0),this.Items.delete(r),this.SelectInfo.StartItemNo=r-1,this.SelectInfo.StartItemOffset=this.GetItemOffsetAfter(this.SelectInfo.StartItemNo),this.ReFormatData(o,s-1,-1);else t.Text=u,this.DoItemChange(r,this.SelectInfo.StartItemOffset,rh.ContentChange),this.Undo_New(),this.UndoAction_DeleteText(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset+1,c),this.FormatPrepare(o,s),this.ReFormatData(o,s)}e.Handled||(this.SelectInfo.StartRestrain=!1,this.CaretDrawItemNo=this.GetDrawItemNoByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset))}}},{key:"BackspaceKeyDown",value:function(t,e,i){var n=this;if(!t.Visible&&this.SelectInfo.StartItemOffset>0)return this.SelectInfo.StartItemOffset=0,void this.KeyDown(i);if(!this.DoAcceptActionBefor(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.BackDeleteText)){if(!this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.BackDeleteText))return this.SelectInfo.StartItemOffset>0?this.SelectInfo.StartItemOffset=0:this.SelectInfo.StartItemNo>0&&(this.SelectInfo.StartItemNo--,this.SelectInfo.StartItemOffset=this.GetItemOffsetAfter(this.SelectInfo.StartItemNo)),void this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset);var o,s=-1,r=-1,a=-1,l=-1,h=-1,c=!1;if(0===this.SelectInfo.StartItemOffset){var u=this.Style.ParaStyles[t.ParaNo];if(""===t.Text&&u.AlignHorz!==Ln.Left&&u.AlignHorz!==Ln.Justify)this.ApplyParaAlignHorz(Ln.Justify);else if(t.ParaFirst&&u.FirstIndent>0)this.ApplyParaFirstIndent(Math.max(0,u.FirstIndent-En.pixXToMillimeter(Yl.TabCharWidth)));else if(t.PageBreak)a=(o=this.GetFormatRange(a,l)).firstDrawItemNo,l=o.lastItemNo,this.FormatPrepare(a,l),this.Undo_New(),this.UndoAction_ItemPageBreak(this.SelectInfo.StartItemNo,0,!1),t.PageBreak=!1,this.ReFormatData(a,l,0,!0);else if(0!==this.SelectInfo.StartItemNo){if(!t.ParaFirst||t.KeepParaFirst)return this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.SelectInfo.StartItemOffset=this.GetItemOffsetAfter(this.SelectInfo.StartItemNo),this.SelectInfo.StartRestrain=!1,this.CaretDrawItemNo=this.Items[this.SelectInfo.StartItemNo].FirstDItemNo,void this.KeyDown(i);if(r=this.Items[this.SelectInfo.StartItemNo-1].Length,t.CanConcatItems(this.Items[this.SelectInfo.StartItemNo-1])){if(a=this.GetFormatFirstDrawItem(this.SelectInfo.StartItemNo-1,r),l=this.GetParaLastItemNo(this.SelectInfo.StartItemNo),this.FormatPrepare(a,l),this.Undo_New(),this.UndoAction_InsertText(this.SelectInfo.StartItemNo-1,this.Items[this.SelectInfo.StartItemNo-1].Length+1,this.Items[this.SelectInfo.StartItemNo].Text),this.Items[this.SelectInfo.StartItemNo-1].Text=this.Items[this.SelectInfo.StartItemNo-1].Text+this.Items[this.SelectInfo.StartItemNo].Text,this.DoItemChange(this.SelectInfo.StartItemNo-1,this.Items[this.SelectInfo.StartItemNo-1].Length,rh.ContentChange),this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset),this.Items.delete(this.SelectInfo.StartItemNo),(h=this.Items[this.SelectInfo.StartItemNo-1].ParaNo)!==t.ParaNo)for(var f=this.SelectInfo.StartItemNo;f<=l-1;f++)this.Items[f].ParaNo=h;this.ReFormatData(a,l-1,-1),this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo-1,r)}else if(this.IsEmptyLine(this.SelectInfo.StartItemNo-1))a=this.GetFormatFirstDrawItem(this.SelectInfo.StartItemNo-1,r),l=this.GetParaLastItemNo(this.SelectInfo.StartItemNo),this.FormatPrepare(a,l),this.Undo_New(),this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo-1,0),this.Items.delete(this.SelectInfo.StartItemNo-1),this.ReFormatData(a,l-1,-1),this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo-1,0);else if(0===t.Length)a=this.GetFormatFirstDrawItem(this.SelectInfo.StartItemNo-1,r),this.FormatPrepare(a,this.SelectInfo.StartItemNo),this.Undo_New(),this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset),this.Items.delete(this.SelectInfo.StartItemNo),this.ReFormatData(a,this.SelectInfo.StartItemNo-1,-1),this.ReSetSelectAndCaret(this.SelectInfo.StartItemNo-1);else{if(a=this.GetFormatFirstDrawItem(this.SelectInfo.StartItemNo-1,this.GetItemOffsetAfter(this.SelectInfo.StartItemNo-1)),l=this.GetParaLastItemNo(this.SelectInfo.StartItemNo),this.FormatPrepare(a,l),this.Undo_New(),this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,!1),t.ParaFirst=!1,(h=this.Items[this.SelectInfo.StartItemNo-1].ParaNo)!==t.ParaNo)for(var d=this.SelectInfo.StartItemNo;d<=l;d++)this.Items[d].ParaNo=h;this.ReFormatData(a,l),this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo,0)}}}else if(1===t.Length)if(s=this.SelectInfo.StartItemNo,this.DrawItems[this.Items[s].FirstDItemNo].LineFirst)if(this.Items[s].ParaFirst)if(a=(o=this.GetFormatRange(a,l)).firstDrawItemNo,l=o.lastItemNo,this.FormatPrepare(a,l),s<l)this.Undo_New(),c=!0,this.UndoAction_DeleteItem(s,this.Items[s].Length),this.Items.delete(s),c&&(this.UndoAction_ItemParaFirst(s,0,c),this.Items[s].ParaFirst=c),this.DoItemChange(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ContentChange),this.ReFormatData(a,l-1,-1),this.ReSetSelectAndCaretByOffset(s,0);else{var m=t.PageBreak;this.Undo_New(),this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,0),this.Items.delete(this.SelectInfo.StartItemNo);var S=this.CreateDefaultTextItem();S.ParaFirst=!0,S.PageBreak=m,this.Items.insert(this.SelectInfo.StartItemNo,S),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,0),this.SelectInfo.StartItemOffset=0,this.DoItemChange(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ContentChange),this.ReFormatData(a,l)}else this.Undo_New(),s<this.GetParaLastItemNo(s)?(r=this.Items[s-1].Length,this.MergeItemText(this.Items[s-1],this.Items[s+1])?(this.DoItemChange(s-1,this.Items[s-1].Length,rh.ContentChange),this.UndoAction_InsertText(s-1,this.Items[s-1].Length-this.Items[s+1].Length+1,this.Items[s+1].Text),a=(o=this.GetFormatRangeByOffset(s-1,this.GetItemOffsetAfter(s-1),a,l)).firstDrawItemNo,l=o.lastItemNo,this.FormatPrepare(a,l),this.UndoAction_DeleteItem(s,this.Items[s].Length),this.Items.delete(s),this.UndoAction_DeleteItem(s,this.Items[s].Length),this.Items.delete(s),this.ReFormatData(a,l-2,-2),this.ReSetSelectAndCaretByOffset(s-1,r)):(a=(o=this.GetFormatRange(a,l)).firstDrawItemNo,l=o.lastItemNo,this.FormatPrepare(a,l),this.UndoAction_DeleteItem(s,this.Items[s].Length),this.Items.delete(s),this.ReFormatData(a,l-1,-1),this.ReSetSelectAndCaret(s-1))):(a=(o=this.GetFormatRange(a,l)).firstDrawItemNo,l=o.lastItemNo,this.FormatPrepare(a,l),this.UndoAction_DeleteItem(s,this.Items[s].Length),this.Items.delete(s),this.ReFormatData(a,l-1,-1),this.ReSetSelectAndCaret(s-1));else r=this.Items[s-1].Length,s>0&&s<e&&this.MergeItemText(this.Items[s-1],this.Items[s+1])?(this.DoItemChange(s-1,this.Items[s-1].Length,rh.ContentChange),this.Undo_New(),this.UndoAction_InsertText(s-1,this.Items[s-1].Length-this.Items[s+1].Length+1,this.Items[s+1].Text),a=(o=this.GetFormatRangeByOffset(s-1,r,a,l)).firstDrawItemNo,l=o.lastItemNo,this.FormatPrepare(a,l),this.UndoAction_DeleteItem(s,this.Items[s].Length),this.Items.delete(s),this.UndoAction_DeleteItem(s,0),this.Items.delete(s),this.ReFormatData(a,l-2,-2),this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo-1,r)):this.SelectInfo.StartItemNo===e?(a=(o=this.GetFormatRange(a,l)).firstDrawItemNo,l=o.lastItemNo,this.FormatPrepare(a,l),this.Undo_New(),this.UndoAction_DeleteItem(s,this.SelectInfo.StartItemOffset),this.DoDataDeleteItemAction(s,(function(){n.Items.delete(s)})),this.ReFormatData(a,l-1,-1),this.ReSetSelectAndCaret(s-1)):(a=(o=this.GetFormatRange(a,l)).firstDrawItemNo,l=o.lastItemNo,this.FormatPrepare(a,l),this.Undo_New(),this.UndoAction_DeleteItem(s,this.Items[s].Length),this.DoDataDeleteItemAction(s,(function(){n.Items.delete(s)})),this.ReFormatData(a,l-1,-1),this.ReSetSelectAndCaret(s-1));else{a=(o=this.GetFormatRange(a,l)).firstDrawItemNo,l=o.lastItemNo,this.FormatPrepare(a,l);var p=t.Text;this.Undo_New(),this.UndoAction_DeleteBackText(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,p.substr(this.SelectInfo.StartItemOffset-1,1)),t.Text=L.stringDelete(p,this.SelectInfo.StartItemOffset-1,1),this.DoItemChange(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ContentChange),this.ReFormatData(a,l),this.SelectInfo.StartItemOffset=this.SelectInfo.StartItemOffset-1,this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset)}this.SelectInfo.StartRestrain=!1}}},{key:"KeyDown",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Yl.IsKeyDownEdit(t.keyCode)||this.CanEdit()){var i=t.keyCode;i!==Ee&&i!==Xe&&i!==Le&&i!==Me||this.InitializeMouseField();var n=this.GetActiveItem();if(null!==n){var o=this.SelectExists();if(o&&(i===Ee||i===Xe||i===Le||i===Me)){if(!this.DeleteSelected())return;if(i===Ee||i===Xe)return;n=this.GetActiveItem()}var s=-1,r=-1,a=this.GetParaItemRang(this.SelectInfo.StartItemNo,s,r);if(s=a.a,r=a.b,n.StyleNo<oo.Null)this.RectItemKeyDown(o,n,t,e);else switch(i){case Ee:this.BackspaceKeyDown(n,r,t);break;case Le:this.EnterKeyDown(n,t,e);break;case Je:this.LeftKeyDown(o,t);break;case Ye:this.RightKeyDown(o,n,t);break;case Xe:this.DeleteKeyDown(n,t);break;case Ke:this.HomeKeyDown(o,t);break;case ze:this.EndKeyDown(o,t);break;case je:this.UpKeyDown(o,t);break;case Qe:this.DownKeyDown(o,t);break;case Me:this.TABKeyDown(n,t)}switch(i){case Ee:case Xe:case Le:case Me:this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),this.Style.UpdateInfoReScroll();break;case Je:case Ye:case je:case Qe:case Ke:case ze:o&&this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),this.Style.UpdateInfoReScroll()}}}}},{key:"KeyUp",value:function(t){!Yl.IsKeyDownEdit(t.keyCode)||this.CanEdit()}},{key:"DoInsertTextBefor",value:function(t,e,i){return""!=i}},{key:"DblClick",value:function(t,e){this.FMouseLBDouble=!0;var i=-1,n=-1,o=-1,s=!1,r=this.GetItemAt(t,e,i,n,o,s);if(i=r.itemNo,n=r.offset,o=r.drawItemNo,s=r.restrain,!(i<0)){if(this.Items[i].StyleNo<oo.Null){var a=this.CoordToItemOffset(t,e,i,n,-1,-1);this.Items[i].DblClick(a.x,a.y)}else if(this.Items[i].Length>0){var l=0,h=0;if((r=this.Items[i].AdjustWordByOffset(n)).result)l=r.startOffset,h=r.endOffset;else{var c,u=this.GetDrawItemText(o);c=(n=n-this.DrawItems[o].CharOffs+1)>0?this.GetUnicodeCharType(u[n-1]):this.GetUnicodeCharType(u[0]);for(var f=n-1;f>=1;f--)if(this.GetUnicodeCharType(u[f-1])!=c){l=f;break}h=u.length;for(var d=n+1;d<=u.length;d++)if(this.GetUnicodeCharType(u[d-1])!=c){h=d-1;break}}this.SelectInfo.StartItemNo=i,this.SelectInfo.StartItemOffset=l+this.DrawItems[o].CharOffs-1,l!==h&&(this.SelectInfo.EndItemNo=i,this.SelectInfo.EndItemOffset=h+this.DrawItems[o].CharOffs-1,this.MatchItemSelectState(),this.DoSelectBound())}this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(!1)}}},{key:"DeleteItems",value:function(t,e,i){if(this.CanEdit()&&!(e<t)){this.InitializeField();var n=-1,o=-1,s=this.GetFormatRangeByOffset(t,0,n,o);n=s.firstDrawItemNo,o=s.lastItemNo;o=(s=!i&&e<this.Items.count-1&&this.Items[e+1].ParaFirst?this.GetFormatRangeByOffset(e+1,this.GetItemOffsetAfter(e+1),0,o):this.GetFormatRangeByOffset(e,this.GetItemOffsetAfter(e),0,o)).lastItemNo,this.Items[t].ParaFirst&&n>0&&(n--,n=this.GetFormatFirstDrawItem(n)),this.FormatPrepare(n,o);var r=this.Items[t].ParaFirst,a=e-t+1;this.Undo_New();for(var l=e;l>=t;l--)this.UndoAction_DeleteItem(l,0),this.Items.delete(l);if(0==this.Items.count){var h=this.CreateDefaultTextItem();this.CurStyleNo=h.StyleNo,h.ParaFirst=!0,this.Items.add(h),a--,this.UndoAction_InsertItem(0,0)}else if(r)if(t<this.Items.count-1&&!this.Items[t].ParaFirst)this.UndoAction_ItemParaFirst(t,0,!0),this.Items[t].ParaFirst=!0;else if(i){var c=this.CreateDefaultTextItem();this.CurStyleNo=c.StyleNo,c.ParaFirst=!0,this.Items.insert(t,c),a--,this.UndoAction_InsertItem(t,0)}this.ReFormatData(n,o-a,-a),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),r&&i?this.ReSetSelectAndCaretByOffset(t,0):t>0?this.ReSetSelectAndCaret(t-1):this.ReSetSelectAndCaretByOffset(0,0)}}},{key:"DeleteActiveDataItems",value:function(t,e,i){if(!(t<0||t>this.Items.count-1)){var n=this.GetActiveItem();if(n.StyleNo<oo.Null&&this.SelectInfo.StartItemOffset==Yl.OffsetInner){this.Undo_New();var o=n;if(o.MangerUndo?this.UndoAction_ItemSelf(this.SelectInfo.StartItemNo,Yl.OffsetInner):this.UndoAction_ItemMirror(this.SelectInfo.StartItemNo,Yl.OffsetInner),o.DeleteActiveDataItems(t,e,i),o.IsFormatDirty){var s=-1,r=-1,a=this.GetFormatRange(s,r);s=a.firstDrawItemNo,r=a.lastItemNo,this.FormatPrepare(s,r),this.ReFormatData(s,r)}else this.FormatInit()}else this.DeleteItems(t,e,i)}}},{key:"ParseDataStream",value:function(t,e,i,n){if(null!=n&&0!==t.readInt64()){var o=t.readInt32();if(0!=o)for(var s=null,r=-1,a=null,l=0;l<o&&(r=t.readInt32(),(a=this.CreateItemByStyle(r)).LoadFromStream(t,e,i),this.Style.MergeStyle&&(null!=e?(a.StyleNo>oo.Null&&(a.StyleNo=this.Style.GetStyleNo(e.TextStyles[a.StyleNo],!0)),a.ParaNo=this.Style.GetParaNo(e.ParaStyles[a.ParaNo],!0)):(a.StyleNo>oo.Null&&(this.CurStyleNo<oo.Null?a.StyleNo=this.Style.GetDefaultStyleNo():a.StyleNo=this.CurStyleNo),a.ParaNo=this.CurParaNo)),(s=n(l,o,a)).result||(a.dispose(),a=null),!s.stop);l++);}}},{key:"AddData",value:function(t){this.InitializeField();var e=0;this.IsEmptyData()?this.Items.clear():this.Items.count>0&&this.Items[this.Items.count-1].CanConcatItems(t.Items[0])&&(this.Items[this.Items.count-1].Text=this.Items[this.Items.count-1].Text+t.Items[0].Text,e=1);for(var i=e;i<t.Items.count;i++){var n=this.CreateItemByStyle(t.Items[i].StyleNo);n.Assign(t.Items[i]),n.Active=!1,n.DisSelect(),this.Items.add(n)}}},{key:"InsertBreak",value:function(){if(!this.CanEdit())return!1;var t=new di;return t.key="Enter",t.keyCode=Le,this.KeyDown(t),this.InitializeMouseField(),!0}},{key:"DoTextItemInsert",value:function(t,e,i){var n=!1,o=this.Items[this.SelectInfo.StartItemNo];if(o.StyleNo===this.CurStyleNo){var s=0;if(0===this.SelectInfo.StartItemOffset&&o.Length>0)if(s=t.length,e||""===t)if(""===t){if(e)if(o.ParaFirst){this.CancelCaretDrawItem();var r=this.CreateDefaultTextItem();r.Text=t,r.ParaFirst=!0,this.Items.insert(this.SelectInfo.StartItemNo,r),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,0),this.DoItemChange(this.SelectInfo.StartItemNo,0,rh.ContentChange),i++}else this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo,0,!0),o.ParaFirst=!0}else{this.CancelCaretDrawItem();var a=this.CreateDefaultTextItem();a.Text=t,a.ParaFirst=!0,this.Items.insert(this.SelectInfo.StartItemNo,a),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,0),this.DoItemChange(this.SelectInfo.StartItemNo,0,rh.ContentChange),i++}else if(o.AcceptAction(0,this.SelectInfo.StartRestrain,rh.ConcatText))this.UndoAction_InsertText(this.SelectInfo.StartItemNo,1,t),o.Text=t+o.Text,this.DoItemChange(this.SelectInfo.StartItemNo,1,rh.ContentChange);else if(o.ParaFirst){this.CancelCaretDrawItem();var l=this.CreateDefaultTextItem();l.Text=t,l.ParaFirst=!0,this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo,0,!1),o.ParaFirst=!1,this.Items.insert(this.SelectInfo.StartItemNo,l),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,0),this.DoItemChange(this.SelectInfo.StartItemNo,0,rh.ContentChange),i++}else if(this.Items[this.SelectInfo.StartItemNo-1].StyleNo>oo.Null)if((o=this.Items[this.SelectInfo.StartItemNo-1]).AcceptAction(o.Length,!0,rh.ConcatText))this.UndoAction_InsertText(this.SelectInfo.StartItemNo-1,o.Length+1,t),o.Text=o.Text+t,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,s=o.Length,this.DoItemChange(this.SelectInfo.StartItemNo,s,rh.ContentChange);else{this.CancelCaretDrawItem();var h=this.CreateDefaultTextItem();h.Text=t,this.Items.insert(this.SelectInfo.StartItemNo,h),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,0),this.DoItemChange(this.SelectInfo.StartItemNo,0,rh.ContentChange),i++}else{this.CancelCaretDrawItem();var c=this.CreateDefaultTextItem();c.Text=t,this.Items.insert(this.SelectInfo.StartItemNo,c),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,0),this.DoItemChange(this.SelectInfo.StartItemNo,0,rh.ContentChange),i++}else if(this.SelectInfo.StartItemOffset===o.Length)if(e||""===t)if(""===t){if(e)if(this.SelectInfo.StartItemNo<this.Items.count-1&&!this.Items[this.SelectInfo.StartItemNo+1].ParaFirst)this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo+1,0,!0),this.Items[this.SelectInfo.StartItemNo+1].ParaFirst=!0,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,s=0;else{var u=this.CreateDefaultTextItem();u.Text=t,u.ParaFirst=!0,this.Items.insert(this.SelectInfo.StartItemNo+1,u),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo+1,0),this.DoItemChange(this.SelectInfo.StartItemNo+1,0,rh.ContentChange),i++,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,s=u.Length}}else{var f=this.CreateDefaultTextItem();f.Text=t,f.ParaFirst=!0,this.Items.insert(this.SelectInfo.StartItemNo+1,f),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo+1,0),this.DoItemChange(this.SelectInfo.StartItemNo+1,0,rh.ContentChange),i++,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,s=f.Length}else if(o.AcceptAction(this.SelectInfo.StartItemOffset,this.SelectInfo.StartRestrain,rh.ConcatText))this.UndoAction_InsertText(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset+1,t),o.Text=o.Text+t,s=o.Length,this.DoItemChange(this.SelectInfo.StartItemNo,s,rh.ContentChange);else if(this.IsParaLastItem(this.SelectInfo.StartItemNo)){var d=this.CreateDefaultTextItem();d.Text=t,this.Items.insert(this.SelectInfo.StartItemNo+1,d),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo+1,0),i++,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,s=t.length,this.DoItemChange(this.SelectInfo.StartItemNo,s,rh.ContentChange)}else if(this.Items[this.SelectInfo.StartItemNo+1].StyleNo>oo.Null)if((o=this.Items[this.SelectInfo.StartItemNo+1]).AcceptAction(0,!0,rh.ConcatText))this.UndoAction_InsertText(this.SelectInfo.StartItemNo+1,1,t),o.Text=t+o.Text,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,s=t.length,this.DoItemChange(this.SelectInfo.StartItemNo,s,rh.ContentChange);else{var m=this.CreateDefaultTextItem();m.Text=t,this.Items.insert(this.SelectInfo.StartItemNo+1,m),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo+1,0),i++,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,s=t.length,this.DoItemChange(this.SelectInfo.StartItemNo,s,rh.ContentChange)}else{var S=this.CreateDefaultTextItem();S.Text=t,this.Items.insert(this.SelectInfo.StartItemNo+1,S),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo+1,0),i++,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,s=t.length,this.DoItemChange(this.SelectInfo.StartItemNo,s,rh.ContentChange)}else if(e){var p=o.SubString(this.SelectInfo.StartItemOffset+1-1,o.Length-this.SelectInfo.StartItemOffset);this.UndoAction_DeleteText(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset+1,p);var y=o.BreakByOffset(this.SelectInfo.StartItemOffset);y.Text=t+y.Text,y.ParaFirst=!0,this.Style.States.Include(oh.InsertBreakItem);try{this.Items.insert(this.SelectInfo.StartItemNo+1,y)}finally{this.Style.States.Exclude(oh.InsertBreakItem)}this.UndoAction_InsertItem(this.SelectInfo.StartItemNo+1,0),i++,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,s=t.length,this.DoItemChange(this.SelectInfo.StartItemNo,s,rh.ContentChange)}else if(""!==t){s=this.SelectInfo.StartItemOffset+t.length;var F=o.Text;F=L.stringInsert(F,this.SelectInfo.StartItemOffset,t),this.UndoAction_InsertText(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset+1,t),o.Text=F,this.DoItemChange(this.SelectInfo.StartItemNo,s,rh.ContentChange)}else s=this.SelectInfo.StartItemOffset;this.SelectInfo.StartItemOffset=s,n=!0}else{var v=this.CreateDefaultTextItem();if(v.Text=t,v.ParaFirst=e||""===t,0===this.SelectInfo.StartItemOffset)this.CancelCaretDrawItem(),!v.ParaFirst&&o.ParaFirst&&(v.ParaFirst=!0,0===o.Length?(this.UndoAction_DeleteItem(this.SelectInfo.StartItemNo,0),this.Items.delete(this.SelectInfo.StartItemNo),i--):(this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo,0,!1),o.ParaFirst=!1)),this.Items.insert(this.SelectInfo.StartItemNo,v),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,0),i++,this.SelectInfo.StartItemOffset=v.Length,this.DoItemChange(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ContentChange);else if(this.SelectInfo.StartItemOffset===o.Length)this.Items.insert(this.SelectInfo.StartItemNo+1,v),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo+1,0),i++,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=v.Length,this.DoItemChange(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ContentChange);else{var I=o.SubString(this.SelectInfo.StartItemOffset+1,o.Length-this.SelectInfo.StartItemOffset);this.UndoAction_DeleteText(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset+1,I);var g=o.BreakByOffset(this.SelectInfo.StartItemOffset);g.ParaFirst=!1,this.Items.insert(this.SelectInfo.StartItemNo+1,v),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo+1,0),i++,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=v.Length,this.DoItemChange(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ContentChange),this.Style.States.Include(oh.InsertBreakItem);try{this.Items.insert(this.SelectInfo.StartItemNo+1,g)}finally{this.Style.States.Exclude(oh.InsertBreakItem)}this.UndoAction_InsertItem(this.SelectInfo.StartItemNo+1,0),i++}}return this.CurStyleNo=this.Items[this.SelectInfo.StartItemNo].StyleNo,{addCount:i,result:n}}},{key:"DoInsertTextEx",value:function(t,e,i){var n=this.Items[this.SelectInfo.StartItemNo];n.StyleNo<oo.Null?this.SelectInfo.StartItemOffset===Yl.OffsetAfter?this.SelectInfo.StartItemNo<this.Items.count-1&&this.Items[this.SelectInfo.StartItemNo+1].StyleNo>oo.Null&&!this.Items[this.SelectInfo.StartItemNo+1].ParaFirst?(this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=0,this.CurStyleNo=this.Items[this.SelectInfo.StartItemNo].StyleNo,i=this.DoInsertTextEx(t,e,i)):""===t?e&&(this.SelectInfo.StartItemNo<this.Items.count-1&&!this.Items[this.SelectInfo.StartItemNo+1].ParaFirst?(this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo+1,0,!0),this.Items[this.SelectInfo.StartItemNo+1].ParaFirst=!0,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=0):((n=this.CreateDefaultTextItem()).Text=t,n.ParaFirst=!0,this.Items.insert(this.SelectInfo.StartItemNo+1,n),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo+1,0),i++,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=n.Length,this.DoItemChange(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ContentChange),this.CurStyleNo=n.StyleNo)):((n=this.CreateDefaultTextItem()).Text=t,n.ParaFirst=e,this.Items.insert(this.SelectInfo.StartItemNo+1,n),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo+1,0),i++,this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo+1,this.SelectInfo.StartItemOffset=n.Length,this.DoItemChange(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ContentChange),this.CurStyleNo=n.StyleNo):this.SelectInfo.StartItemNo>0&&this.Items[this.SelectInfo.StartItemNo-1].StyleNo>oo.Null&&!n.ParaFirst?(this.SelectInfo.StartItemNo=this.SelectInfo.StartItemNo-1,this.SelectInfo.StartItemOffset=this.Items[this.SelectInfo.StartItemNo].Length,this.CurStyleNo=this.Items[this.SelectInfo.StartItemNo].StyleNo,i=this.DoInsertTextEx(t,e,i)):""===t?e&&(n.ParaFirst?(this.CancelCaretDrawItem(),(n=this.CreateDefaultTextItem()).Text=t,n.ParaFirst=!0,this.Items[this.SelectInfo.StartItemNo].isClass(hs)?n.StyleNo=this.Items[this.SelectInfo.StartItemNo].TextStyleNo:this.Items[this.SelectInfo.StartItemNo].StyleNo===oo.Domain&&(n.StyleNo=this.Items[this.SelectInfo.StartItemNo].GetTextStyleNo()),this.Items.insert(this.SelectInfo.StartItemNo,n),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,0),i++,this.SelectInfo.StartItemOffset=n.Length,this.DoItemChange(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ContentChange),this.CurStyleNo=n.StyleNo):(this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo,0,!0),n.ParaFirst=!0)):(this.CancelCaretDrawItem(),(n=this.CreateDefaultTextItem()).Text=t,n.ParaFirst=e,(e||""===t)&&(n.ParaFirst=!0),this.Items[this.SelectInfo.StartItemNo].isClass(hs)?n.StyleNo=this.Items[this.SelectInfo.StartItemNo].TextStyleNo:this.Items[this.SelectInfo.StartItemNo].StyleNo===oo.Domain&&(n.StyleNo=this.Items[this.SelectInfo.StartItemNo].GetTextStyleNo()),this.Items[this.SelectInfo.StartItemNo].ParaFirst&&(this.UndoAction_ItemParaFirst(this.SelectInfo.StartItemNo,0,!1),this.Items[this.SelectInfo.StartItemNo].ParaFirst=!1,n.ParaFirst=!0),this.Items.insert(this.SelectInfo.StartItemNo,n),this.UndoAction_InsertItem(this.SelectInfo.StartItemNo,0),i++,this.SelectInfo.StartItemOffset=n.Length,this.DoItemChange(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.ContentChange),this.CurStyleNo=n.StyleNo):i=this.DoTextItemInsert(t,e,i).addCount;return i}},{key:"InsertText",value:function(t){if(!this.CanEdit())return!1;if(!this.DeleteSelected())return!1;if(!this.DoAcceptAction(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,rh.InsertText))return!1;if(!this.DoInsertTextBefor(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,t))return!1;var e=!1;this.Undo_GroupBegin(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset);try{var i;this.Undo_New();var n=-1,o=-1;if(this.Items[this.SelectInfo.StartItemNo].StyleNo<oo.Null&&this.SelectInfo.StartItemOffset===Yl.OffsetInner){var s=this.Items[this.SelectInfo.StartItemNo];s.MangerUndo?this.UndoAction_ItemSelf(this.SelectInfo.StartItemNo,Yl.OffsetInner):this.UndoAction_ItemMirror(this.SelectInfo.StartItemNo,Yl.OffsetInner),e=s.InsertText(t),s.IsFormatDirty?(n=(i=this.GetFormatRange(n,o)).firstDrawItemNo,o=i.lastItemNo,this.FormatPrepare(n,o),this.ReFormatData(n,o)):this.FormatInit()}else{var r=!1,a=0;this.Style.WillStyleNo>oo.Null?this.CurStyleNo=this.Style.WillStyleNo:this.CurStyleNo=this.MatchTextStyleNoAt(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset),n=(i=this.GetFormatRange(n,o)).firstDrawItemNo,o=i.lastItemNo,this.FormatPrepare(n,o);for(var l,h=Yl.ReplaceUnPreChar(t).split(Yl.sLineBreak),c=0;c<h.length;c++)l=h[c],(r||""!=l)&&(a=this.DoInsertTextEx(l,r,a)),r=!0;this.ReFormatData(n,o+a,a),e=!0}this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset)}finally{this.Undo_GroupEnd(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset)}return this.InitializeMouseField(),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),this.Style.UpdateInfoReScroll(),e}},{key:"InsertTable",value:function(t,e){if(!this.CanEdit())return!1;var i,n=this.GetTopLevelData(),o=new Ir(this.hcl,n,t,e,n.Width);return i=this.InsertItem(o),this.InitializeMouseField(),i}},{key:"InsertImage",value:function(t){if(!this.CanEdit())return!1;var e,i=this.GetTopLevelData(),n=new Yr(this.hcl,i);return n.Image=t,n.width=t.width,n.height=t.height,n.RestrainSize(i.Width,n.height),e=this.InsertItem(n),this.InitializeMouseField(),e}},{key:"InsertGifImage",value:function(t){if(!this.CanEdit())return!1;var e,i=this.GetTopLevelData(),n=new aa(this.hcl,i);return n.LoadFromFile(t),e=this.InsertItem(n),this.InitializeMouseField(),e}},{key:"InsertLine",value:function(t,e){if(!this.CanEdit())return!1;var i,n=new qr(this.hcl,this,this.Width,t,e);return i=this.InsertItem(n),this.InitializeMouseField(),i}},{key:"SetActiveImage",value:function(t){return!!this.CanEdit()&&this.RectItemAction(this.GetActiveItemNo(),(function(e){return e.Image.loadFromStream(t),!0}))}},{key:"ActiveTableResetRowCol",value:function(t,e){var i=this;return!!this.CanEdit()&&this.RectItemAction(this.GetActiveItemNo(),(function(n){var o=n.GetActiveData();return null!==o&&o.GetActiveItem().StyleNo===oo.Table&&o.SelectInfo.StartItemOffset===Yl.OffsetInner?o.ActiveTableResetRowCol(t,e):n.ResetRowCol(i.Width,t,e)}))}},{key:"TableInsertRowAfter",value:function(t){return!!this.CanEdit()&&this.RectItemAction(this.GetActiveItemNo(),(function(e){var i=e.GetActiveData();return null!==i&&i.GetActiveItem().StyleNo===oo.Table&&i.SelectInfo.StartItemOffset===Yl.OffsetInner?i.TableInsertRowAfter(t):e.InsertRowAfter(t)}))}},{key:"TableInsertRowBefor",value:function(t){return!!this.CanEdit()&&this.RectItemAction(this.GetActiveItemNo(),(function(e){var i=e.GetActiveData();return null!==i&&i.GetActiveItem().StyleNo===oo.Table&&i.SelectInfo.StartItemOffset===Yl.OffsetInner?i.TableInsertRowBefor(t):e.InsertRowBefor(t)}))}},{key:"ActiveTableDeleteCurRow",value:function(){return!!this.CanEdit()&&this.RectItemAction(this.GetActiveItemNo(),(function(t){var e=t.GetActiveData();return null!==e&&e.GetActiveItem().StyleNo===oo.Table&&e.SelectInfo.StartItemOffset===Yl.OffsetInner?e.ActiveTableDeleteCurRow():t.DeleteCurRow()}))}},{key:"ActiveTableDeleteRowFrom",value:function(t,e){return!!this.CanEdit()&&this.RectItemAction(this.GetActiveItemNo(),(function(i){var n=i.GetActiveData();return null!==n&&n.GetActiveItem().StyleNo===oo.Table&&n.SelectInfo.StartItemOffset===Yl.OffsetInner?n.ActiveTableDeleteRowFrom(t,e):i.DeleteRowFrom(t,e)}))}},{key:"ActiveTableSplitCurRow",value:function(){return!!this.CanEdit()&&this.RectItemAction(this.GetActiveItemNo(),(function(t){var e=t.GetActiveData();return null!==e&&e.GetActiveItem().StyleNo===oo.Table&&e.SelectInfo.StartItemOffset===Yl.OffsetInner?e.ActiveTableSplitCurRow():t.SplitCurRow()}))}},{key:"ActiveTableSplitCurCol",value:function(){return!!this.CanEdit()&&this.RectItemAction(this.GetActiveItemNo(),(function(t){var e=t.GetActiveData();return null!==e&&e.GetActiveItem().StyleNo===oo.Table&&e.SelectInfo.StartItemOffset===Yl.OffsetInner?e.ActiveTableSplitCurCol():t.SplitCurCol()}))}},{key:"TableInsertColAfter",value:function(t){return!!this.CanEdit()&&this.RectItemAction(this.GetActiveItemNo(),(function(e){var i=e.GetActiveData();return null!==i&&i.GetActiveItem().StyleNo===oo.Table&&i.SelectInfo.StartItemOffset===Yl.OffsetInner?i.TableInsertColAfter(t):e.InsertColAfter(t)}))}},{key:"TableInsertColBefor",value:function(t){return!!this.CanEdit()&&this.RectItemAction(this.GetActiveItemNo(),(function(e){var i=e.GetActiveData();return null!==i&&i.GetActiveItem().StyleNo===oo.Table&&i.SelectInfo.StartItemOffset===Yl.OffsetInner?i.TableInsertColBefor(t):e.InsertColBefor(t)}))}},{key:"ActiveTableDeleteCurCol",value:function(){return!!this.CanEdit()&&this.RectItemAction(this.GetActiveItemNo(),(function(t){var e=t.GetActiveData();return null!==e&&e.GetActiveItem().StyleNo===oo.Table&&e.SelectInfo.StartItemOffset===Yl.OffsetInner?e.ActiveTableDeleteCurCol():t.DeleteCurCol()}))}},{key:"MergeTableSelectCells",value:function(){return!!this.CanEdit()&&this.RectItemAction(this.GetActiveItemNo(),(function(t){return t.MergeSelectCells()}))}},{key:"TableApplyContentAlign",value:function(t){return!!this.CanEdit()&&this.RectItemAction(this.GetActiveItemNo(),(function(e){return e.ApplyContentAlign(t),!0}))}},{key:"ActiveItemReAdaptEnvironment",value:function(){if(this.CanEdit()){this.InitializeField();var t=this.GetActiveItem();if(null!=t){var e,i=-1,n=-1;if(t.StyleNo<oo.Null&&this.SelectInfo.StartItemOffset==Yl.OffsetInner){this.Undo_New();var o=t;o.MangerUndo?this.UndoAction_ItemSelf(this.SelectInfo.StartItemNo,Yl.OffsetInner):this.UndoAction_ItemMirror(this.SelectInfo.StartItemNo,Yl.OffsetInner),o.ActiveItemReAdaptEnvironment(),o.IsFormatDirty?(i=(e=this.GetFormatRange(i,n)).firstDrawItemNo,n=e.lastItemNo,this.FormatPrepare(i,n),this.ReFormatData(i,n)):this.FormatInit()}else{var s=0;i=(e=this.GetFormatRange(i,n)).firstDrawItemNo,n=e.lastItemNo,this.FormatPrepare(i,n),this.Undo_New();var r=this.SelectInfo.StartItemNo;if(this.MergeItemToNext(r)&&(this.UndoAction_InsertText(r,this.Items[r].Length-this.Items[r+1].Length+1,this.Items[r+1].Text),this.UndoAction_DeleteItem(r+1,0),this.Items.delete(r+1),s--),r>0){var a=this.Items[r-1].Length;this.MergeItemToPrio(r)&&(this.UndoAction_InsertText(r-1,this.Items[r-1].Length-this.Items[r].Length+1,this.Items[r].Text),this.UndoAction_DeleteItem(r,0),this.Items.delete(r),s--,this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo-1,a+this.SelectInfo.StartItemOffset))}0!=s&&(this.ReFormatData(i,n+s,s),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret())}}}}},{key:"DisActive",value:function(){if(this.InitializeField(),this.Items.count>0){var t=this.GetActiveItem();null!=t&&(t.Active=!1)}}},{key:"GetHint",value:function(){return!this.FMouseMoveRestrain&&this.FMouseMoveItemNo>=0?this.Items[this.FMouseMoveItemNo].GetHint():""}},{key:"PasteRectPart",value:function(t,e,i,n){var o=!1,s=this.GetActiveItemNo();if(this.Items[s].StyleNo<oo.Null&&this.SelectInfo.StartItemOffset===Yl.OffsetInner){var r=-1,a=-1,l=this.GetFormatRange(r,a);r=l.firstDrawItemNo,a=l.lastItemNo,this.FormatPrepare(r,a),this.Undo_GroupBegin(s,Yl.OffsetInner);try{if(this.Undo_New(),this.Items[s].MangerUndo?this.UndoAction_ItemSelf(s,Yl.OffsetInner):this.UndoAction_ItemMirror(s,Yl.OffsetInner),o=this.Items[s].PasteRectPart(t,e,i,n))return this.ReFormatData(r,a,0),o}finally{this.Undo_GroupEnd(s,Yl.OffsetInner)}}switch(t){case lh.Table:var h=e.readInt32(),c=this.CreateItemByStyle(h);return c.LoadFromPartStream(e,i,n),c.ParaFirst=!1,this.InsertItem(c);default:return!1}}},{key:"MouseDownItemNo",get:function(){return this.FMouseDownItemNo}},{key:"MouseDownItemOffset",get:function(){return this.FMouseDownItemOffset}},{key:"MouseMoveItemNo",get:function(){return this.FMouseMoveItemNo}},{key:"MouseMoveItemOffset",get:function(){return this.FMouseMoveItemOffset}},{key:"MouseMoveRestrain",get:function(){return this.FMouseMoveRestrain}},{key:"HotDrawItemNo",get:function(){return this.FMouseMoveDrawItemNo}},{key:"height",get:function(){return this.GetHeight()}},{key:"Height",get:function(){return this.GetHeight()}},{key:"ReadOnly",get:function(){return this.FReadOnly},set:function(t){this.SetReadOnly(t)}},{key:"Selecting",get:function(){return this.FSelecting}}]),i}(wr);function Gl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Hl=function(t){m()(i,t);var e=Gl(i);function i(){var t;return r()(this,i),(t=e.call(this)).ID,t.Title,t.Text,t}return l()(i,[{key:"LoadFromStream",value:function(t,e){t.readInt32(),t.readInt32(),t.readInt32(),t.readInt32(),this.ID=t.readInt32(),this.Title=Yl.HCLoadTextFromStream(t,e),this.Text=Yl.HCLoadTextFromStream(t,e)}}]),i}(Js),Vl=function(t){m()(i,t);var e=Gl(i);function i(){return r()(this,i),e.call(this)}return l()(i)}(Ws);function Ul(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}function Wl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var zl=function(t){m()(i,t);var e=Wl(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FLevel=0,o.Scripts=new rt,o.FDomainStartDeletes=new ot,o.FCaretItemChanged=!1,o.FHotDomainRGN=new Zs,o.FActiveDomainRGN=new Zs,o.PrintInvisible=!1,o.hcl.hc.DOMAINPAINTEVENT&&(o.FPaintDomainStack=new st,o.OnDomainDrawItemPaintBefor=null,o.OnDomainDrawItemPaintAfter=null),o}return l()(i,[{key:"createBefor",value:function(){f()(F()(i.prototype),"createBefor",this).call(this),this.FHotDomain=new Ws,this.FHotDomain.Data=this,this.FActiveDomain=new Ws,this.FActiveDomain.Data=this,this.FDomainCount=0,this.OnCreateItemByStyle=null,this.OnInsertTextBefor=null,this.OnDomainSwitch=null,this.OnDomainChange=null,this.OnCaretItemChanged=null,this.OnPaintDomainRegion=null,this.OnMatchTextStyleNoAt=null,this.OnGetScreenCoord=null,this.OnCheckInsertItemCount=null}},{key:"DoDomainDrawItemPaintBefor",value:function(t,e,i,n,o,s,r){null!=this.OnDomainDrawItemPaintBefor&&this.OnDomainDrawItemPaintBefor(t,e,i,n,o,s,r)}},{key:"DoDomainDrawItemPaintAfter",value:function(t,e,i,n,o,s,r){null!=this.OnDomainDrawItemPaintAfter&&this.OnDomainDrawItemPaintAfter(t,e,i,n,o,s,r)}},{key:"DoDomainChange",value:function(t,e,i){this.FStyle.States.Contain(oh.Loading)||null!==this.OnDomainChange&&this.OnDomainChange(this,t,e,i)}},{key:"DoItemChange",value:function(t,e,n){if(!this.FStyle.States.Contain(oh.Loading)){f()(F()(i.prototype),"DoItemChange",this).call(this,t,e,n);var o=this.GetItemBelongDomain(t);o>=0&&this.DoDomainChange(o,t,n)}}},{key:"DoDataDeleteItemAction",value:function(t,e){var n=this.GetItemBelongDomain(t);f()(F()(i.prototype),"DoDataDeleteItemAction",this).call(this,t,e),n>=0&&this.DoDomainChange(n,-1,rh.ContentChange)}},{key:"DoAcceptAction",value:function(t,e,n){if(this.Style.States.Contain(oh.Loading)||this.Style.States.Contain(oh.Undoing)||this.Style.States.Contain(oh.Redoing)||this.Style.States.Contain(oh.DomainWholeReplace))return!0;var o=!0;if(n==rh.DeleteItem&&this.Items[t].StyleNo==oo.Domain)if(this.Items[t].MarkType==ch.End){var s=this.GetDomainAnother(t);(o=s==this.SelectInfo.StartItemNo?this.SelectInfo.StartItemOffset==Yl.OffsetBefor:s>=this.SelectInfo.StartItemNo&&s<=this.SelectInfo.EndItemNo)&&this.FDomainStartDeletes.add(s)}else o=this.FDomainStartDeletes.indexOf(t)>=0;return o&&(o=f()(F()(i.prototype),"DoAcceptAction",this).call(this,t,e,n)),o&&this.FActiveDomain.EndNo>0&&n===rh.DeleteItem&&(this.FActiveDomain.BeginNo===t?this.FActiveDomain.Clear():(t<this.FActiveDomain.BeginNo&&(this.FActiveDomain.BeginNo=this.FActiveDomain.BeginNo-1),t<this.FActiveDomain.EndNo&&(this.FActiveDomain.EndNo=this.FActiveDomain.EndNo-1))),o}},{key:"DoSaveItem",value:function(t){var e=f()(F()(i.prototype),"DoSaveItem",this).call(this,t);if(e&&this.Style.States.Contain(oh.Copying)&&this.Items[t].StyleNo==oo.Domain){var n=this.GetDomainAnother(t);e=n>=this.SelectInfo.StartItemNo&&n<=this.SelectInfo.EndItemNo}return e}},{key:"CheckInsertItemCount",value:function(t,e){var n=f()(F()(i.prototype),"CheckInsertItemCount",this).call(this,t,e);return null!==this.OnCheckInsertItemCount&&(n+=this.OnCheckInsertItemCount(this,t,e)),this.Loading||this.Style.States.Contain(oh.DomainWholeReplace)&&(!this.Items[t].ParaFirst&&t>0&&this.Items[t-1].StyleNo===oo.Domain&&this.Items[t-1].ParaFirst&&(this.Items[t-1].ParaNo=this.Items[t].ParaNo),this.IsParaLastItem(e+1)&&this.Items[e+1].StyleNo===oo.Domain&&(this.Items[e+1].ParaNo=this.Items[e].ParaNo)),n}},{key:"ReSetSelectAndCaretByOffset",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];f()(F()(i.prototype),"ReSetSelectAndCaretByOffset",this).call(this,t,e,n),this.Style.States.Contain(oh.BatchInsert)||this.GetActiveDomain()}},{key:"DoCaretItemChanged",value:function(){this.FCaretItemChanged=!0}},{key:"DoInsertItem",value:function(t){t.StyleNo===oo.Domain&&(t.MarkType===ch.Beg?(this.FDomainCount++,this.Style.States.Contain(oh.BatchInsert)&&(this.FLevel++,t.Level=this.FLevel)):this.Style.States.Contain(oh.BatchInsert)&&(t.Level=this.FLevel,this.FLevel--)),this.FHotDomain.Clear(),f()(F()(i.prototype),"DoInsertItem",this).call(this,t)}},{key:"DoRemoveItem",value:function(t){rs.IsBeginMark(t)&&this.FDomainCount--,this.FHotDomain.Clear(),f()(F()(i.prototype),"DoRemoveItem",this).call(this,t)}},{key:"DoDrawItemPaintBefor",value:function(t,e,n,o,s,r,a,l,h,c,u,d){if(this.hcl.hc.DOMAINPAINTEVENT)if(t.Items[e].StyleNo===oo.Domain)if(t.Items[e].MarkType===ch.Beg){var m=new Ws;m.Data=t,m.BeginNo=e,this.FPaintDomainStack.push(m)}else this.FPaintDomainStack.length>0&&this.FPaintDomainStack.pop();else if(this.FPaintDomainStack.length>0){var S=this.FPaintDomainStack.peek();this.DoDomainDrawItemPaintBefor(t,S.BeginNo,n,o,s,u,d)}if(f()(F()(i.prototype),"DoDrawItemPaintBefor",this).call(this,t,e,n,o,s,r,a,l,h,c,u,d),!(d.Print||d.ReadOnly&&d.ReadOnlyViewPrint)){var p=!1,y=!1;this.Style.DrawHotDomainRegion&&this.FHotDomain.BeginNo>=0&&(p=this.FHotDomain.Contain(e)),this.Style.DrawActiveDomainRegion&&this.FActiveDomain.BeginNo>=0&&(y=this.FActiveDomain.Contain(e)),(p||y)&&(this.FStyle.DomainBorderRelax&&(t.Items[e].StyleNo!==oo.Domain||t.Items[e].MarkType!==ch.End)&&e<this.FItems.count-1&&this.FItems[e+1].ParaFirst?o.right=o.left-this.FDrawItems[n].rect.left+this.Width:o.left===o.right&&this.FItems[e].ParaFirst&&(o.right+=3),p&&this.FHotDomainRGN.combineRect(o),y&&this.FActiveDomainRGN.combineRect(o))}}},{key:"SelectOffsetAfter_",value:function(t,e){var i=this.Items[t].IsSelectComplate;return!i&&this.Items[t].StyleNo>oo.Null&&this.SelectInfo.EndItemNo>=0&&(t==this.SelectInfo.EndItemNo?this.SelectInfo.EndItemOffset==this.DrawItems[e].CharOffsetEnd()&&(i=!0):t==this.SelectInfo.StartItemNo&&(i=!0)),i}},{key:"DrawLineLastMrak",value:function(t,e,i,n,o,s){this.SelectOffsetAfter_(n,o)&&(t.brush.color=this.Style.SelColor,t.fillRect(nt.Create(e.right,e.top,e.right+10,e.bottom))),t.pen.width=1,t.pen.style=_t.Solid,t.pen.color=Yl.clActiveBorder,t.beginPath();try{t.moveTo(i.right+4,i.bottom-8),t.lineTo(i.right+6,i.bottom-8),t.moveTo(i.right+6,i.bottom-8),t.lineTo(i.right+6,i.bottom-3),t.moveTo(i.right,i.bottom-3),t.lineTo(i.right+6,i.bottom-3),t.moveTo(i.right+1,i.bottom-4),t.lineTo(i.right+1,i.bottom-1),t.moveTo(i.right+2,i.bottom-5),t.lineTo(i.right+2,i.bottom)}finally{t.paintPath()}}},{key:"DrawDisvisibleItem",value:function(t,e){e.pen.width=1,e.pen.style=_t.Solid,e.pen.color=Yl.clActiveBorder,e.beginPath();try{e.moveTo(t.left-1,t.top-2),e.lineTo(t.left+1,t.top-2),e.moveTo(t.left,t.top-1),e.lineTo(t.left+1,t.top-1)}finally{e.paintPath()}}},{key:"DoDrawItemPaintAfter",value:function(t,e,n,o,s,r,a,l,h,c,u,d){if(this.hcl.hc.DOMAINPAINTEVENT&&t.Items[e].StyleNo!==oo.Domain&&this.FPaintDomainStack.length>0){var m=this.FPaintDomainStack.peek();this.DoDomainDrawItemPaintAfter(t,m.BeginNo,n,o,s,u,d)}d.Print||d.ReadOnly&&d.ReadOnlyViewPrint||(t.Items[e].Visible||this.DrawDisvisibleItem(s,u),t.Style.ShowParaLastMark&&this.IsParaLastDrawItemEx(n)&&!this.InvisiblePara(e)&&this.DrawLineLastMrak(u,o,s,e,n,d)),f()(F()(i.prototype),"DoDrawItemPaintAfter",this).call(this,t,e,n,o,s,r,a,l,h,c,u,d)}},{key:"doAskIsWantDomain",value:function(t,e){return!t||t(this.Items[e])}},{key:"DoPaintDomainRegion",value:function(t){return!(t<0)&&(null==this.OnPaintDomainRegion||this.OnPaintDomainRegion(this,t))}},{key:"GetActiveDomain",value:function(){this.FDomainCount>0?this.GetDomainFrom(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,this.FActiveDomain):this.FActiveDomain.Clear()}},{key:"MatchTextStyleNoAt",value:function(t,e){if(null!==this.OnMatchTextStyleNoAt){var n=this.OnMatchTextStyleNoAt(this,t,e);if(n!==oo.Null)return n}return f()(F()(i.prototype),"MatchTextStyleNoAt",this).call(this,t,e)}},{key:"CreateItemByStyle",value:function(t){var e=null;return null!=this.OnCreateItemByStyle&&(e=this.OnCreateItemByStyle(this,t)),null==e&&(e=f()(F()(i.prototype),"CreateItemByStyle",this).call(this,t)),e}},{key:"PaintDataRange",value:function(t,e,n,o,s,r,a,l,h,c,u){if(u.Print||u.ReadOnly&&u.ReadOnlyViewPrint||(this.Style.DrawHotDomainRegion&&this.FHotDomainRGN.clear(),this.Style.DrawActiveDomainRegion&&this.FActiveDomainRGN.clear()),this.hcl.hc.DOMAINPAINTEVENT){if(l>0){var d=this.GetItemBelongDomain(this.DrawItems[l].ItemNo);if(d>=0){var m=new Ws;m.Data=this,m.BeginNo=d,this.FPaintDomainStack.push(m)}}f()(F()(i.prototype),"PaintDataRange",this).call(this,t,e,n,o,s,r,a,l,h,c,u),this.FPaintDomainStack.clear()}else f()(F()(i.prototype),"PaintDataRange",this).call(this,t,e,n,o,s,r,a,l,h,c,u);if(!(u.Print||u.ReadOnly&&u.ReadOnlyViewPrint)){var S=c.pen.color;try{this.Style.DrawHotDomainRegion&&this.DoPaintDomainRegion(this.FHotDomain.BeginNo)&&(c.pen.color=this.Style.DomainHotBorderColor,c.pen.style=_t.Solid,this.FHotDomainRGN.frameRgn(c)),this.Style.DrawActiveDomainRegion&&this.DoPaintDomainRegion(this.FActiveDomain.BeginNo)&&(c.pen.color=this.Style.DomainActiveBorderColor,c.pen.style=_t.Solid,this.FActiveDomainRGN.frameRgn(c))}finally{c.pen.color=S}}}},{key:"InitializeField",value:function(){f()(F()(i.prototype),"InitializeField",this).call(this),null!=this.FActiveDomain&&this.FActiveDomain.Clear(),null!=this.FHotDomain&&this.FHotDomain.Clear()}},{key:"GetCaretInfo",value:function(t,e,n){f()(F()(i.prototype),"GetCaretInfo",this).call(this,t,e,n);var o=!1,s=this.FActiveDomain.BeginNo;this.SelectInfo.StartItemNo>=0?this.GetActiveDomain():this.Style.DrawActiveDomainRegion&&this.FActiveDomain.BeginNo>=0&&(this.FActiveDomain.Clear(),o=!0),this.FCaretItemChanged&&(this.FCaretItemChanged=!1,null!=this.OnCaretItemChanged&&this.OnCaretItemChanged(this,this.Items[this.SelectInfo.StartItemNo])),s!==this.FActiveDomain.BeginNo&&(o=!0,s>=0&&null!==this.OnDomainSwitch&&this.OnDomainSwitch(this,s,!1),this.FActiveDomain.BeginNo>=0&&null!==this.OnDomainSwitch&&this.OnDomainSwitch(this,this.FActiveDomain.BeginNo,!0)),o&&this.Style.UpdateInfoRePaint()}},{key:"GetScreenCoord",value:function(t,e){return null!=this.OnGetScreenCoord?this.OnGetScreenCoord(t,e):et.Create(0,0)}},{key:"DeleteSelected",value:function(){var t=f()(F()(i.prototype),"DeleteSelected",this).call(this);return this.FDomainStartDeletes.clear(),t}},{key:"DeleteActiveDomain",value:function(){if(this.SelectExists())return!1;var t=!1;if(this.FActiveDomain.BeginNo>=0)t=this.DeleteDomain(this.FActiveDomain);else if(this.Items[this.SelectInfo.StartItemNo].StyleNo<oo.Null&&(t=this.Items[this.SelectInfo.StartItemNo].DeleteActiveDomain())){var e=-1,i=-1,n=this.GetFormatRange(e,i);e=n.firstDrawItemNo,i=n.lastItemNo,this.FormatPrepare(e,i),this.ReFormatData(e,i),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret()}return t}},{key:"DeleteDomain",value:function(t){return this.DeleteDomainByItemNo(t.BeginNo,t.EndNo)}},{key:"DeleteDomainByItemNo",value:function(t,e){if(t<0)return!1;this.Undo_New();var i=this.GetFormatFirstDrawItem(this.Items[t].FirstDItemNo),n=this.GetParaLastItemNo(e);this.Items[t].ParaFirst&&(e==n?t>0&&(i=this.GetFormatFirstDrawItem(this.Items[t].FirstDItemNo-1)):(this.UndoAction_ItemParaFirst(e+1,0,!0),this.Items[e+1].ParaFirst=!0)),this.FormatPrepare(i,n);for(var o=0,s=this.Items[t].PageBreak,r=e;r>=t;r--)this.UndoAction_DeleteItem(r,0),this.Items.delete(r),o++;if(this.FActiveDomain.Clear(),0==t){var a=this.CreateDefaultTextItem();a.ParaFirst=!0,a.PageBreak=s,this.Items.insert(t,a),this.UndoAction_InsertItem(t,0),o--}return this.ReFormatData(i,n-o,-o),this.InitializeField(),t>this.Items.count-1?this.ReSetSelectAndCaret(t-1):this.ReSetSelectAndCaretByOffset(t,0),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),!0}},{key:"MouseLeave",value:function(){f()(F()(i.prototype),"MouseLeave",this).call(this),this.FHotDomain.Clear()}},{key:"MouseMove",value:function(t){var e=this.Style.DrawHotDomainRegion&&this.FHotDomain.BeginNo>=0;f()(F()(i.prototype),"MouseMove",this).call(this,t),this.FDomainCount>0?this.GetDomainFrom(this.MouseMoveItemNo,this.MouseMoveItemOffset,this.FHotDomain):this.FHotDomain.Clear();var n=this.GetTopLevelDataAt(t.x,t.y);(n==this||n.HotDomain.BeginNo<0)&&this.Style.DrawHotDomainRegion&&this.FHotDomain.BeginNo>=0&&(e=!0),e&&this.Style.UpdateInfoRePaint()}},{key:"InsertStream",value:function(t,e,n){this.Style.States.Include(oh.BatchInsert);try{return this.ActiveDomain.BeginNo<0?this.FLevel=0:this.FLevel=this.FItems[this.ActiveDomain.BeginNo].Level,f()(F()(i.prototype),"InsertStream",this).call(this,t,e,n)}finally{this.Style.States.Exclude(oh.BatchInsert)}}},{key:"InsertItem",value:function(t){var e=f()(F()(i.prototype),"InsertItem",this).call(this,t);return e&&(this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),this.Style.UpdateInfoReScroll()),e}},{key:"InsertItemEx",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=f()(F()(i.prototype),"InsertItemEx",this).call(this,t,e,n);return o&&(this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),this.Style.UpdateInfoReScroll()),o}},{key:"CanEditItem",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return f()(F()(i.prototype),"CanEditItem",this).call(this,t,e,n)}},{key:"DoInsertTextBefor",value:function(t,e,n){var o=f()(F()(i.prototype),"DoInsertTextBefor",this).call(this,t,e,n);return o&&null!==this.OnInsertTextBefor&&(o=this.OnInsertTextBefor(this,t,e,n)),o}},{key:"OffsetInSelect",value:function(t,e){return!(this.Items[t].StyleNo!==oo.Domain||!this.Items[t].IsSelectComplate)||f()(F()(i.prototype),"OffsetInSelect",this).call(this,t,e)}},{key:"DoLoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"DoLoadFromStream",this).call(this,t,e,n),this.Scripts.clear(),n>42){var o=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(o,this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator):this.Script=o}if(n>63){var s=t.readByte();this.PrintInvisible=L.isOdd(s>>7)}else this.PrintInvisible=!1}},{key:"SaveToStream",value:function(t){f()(F()(i.prototype),"SaveToStream",this).call(this,t),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator));var e=0;this.PrintInvisible&&(e|=128),t.writeByte(e)}},{key:"ItemRangeToJSONString",value:function(t,e){for(var i,n,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r="",a=t;a<=e;a++)(n=this.FItems[a]).StyleNo>oo.Null?""!==(i=n.ToJSONString(o))&&(r+="{"+i+"},"):n.StyleNo===oo.Domain?n.BeginMark()?(r+="{"+n.ToJSONString(o),s&&(r+=',"InnerText":'+JSON.stringify(this.GetDomainText(n))),r+=',"Items":['):(","===r[r.length-1]&&(r=r.substring(0,r.length-1)),r+="]},"):n.isClass(Cs)?(i=n.ToJSONString(o,s),o?""!==i&&(r+=i+","):r+="{"+i+"},"):r+="{"+n.ToJSONString(o)+"},";return","===r[r.length-1]&&(r=r.substring(0,r.length-1)),r}},{key:"GetDomainJSONStringBy",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.GetDomainAnother(t),o=-1;n<t?(o=n,n=t):o=t;var s=this.FItems[o].ToJSONString(e);return i&&(s+=',"InnerText":'+JSON.stringify(this.GetDomainTextBy(o,n))),s+","+this.ToJSONStringRange(o+1,n-1,e,i)}},{key:"GetDomainJSONObjectBy",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.GetDomainJSONStringBy(t,e,i);return JSON.parse("{"+n+"}")}},{key:"ReFormatActiveDomain",value:function(){if(this.SelectInfo.StartItemNo>=0&&this.Items[this.SelectInfo.StartItemNo].StyleNo<oo.Null)if(this.Items[this.SelectInfo.StartItemNo].ReFormatActiveDomain(),this.FActiveDomain.BeginNo>=0)this.ReFormatDomain(this.FActiveDomain);else{var t=-1,e=-1,i=this.GetFormatRange(t,e);t=i.firstDrawItemNo,e=i.lastItemNo,this.FormatPrepare(t,e),this.ReFormatData(t,e),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),this.SelectInfo.StartItemOffset>this.Items[this.SelectInfo.StartItemNo].Length&&this.ReSetSelectAndCaret(this.SelectInfo.StartItemNo)}else this.FActiveDomain.BeginNo>=0&&this.ReFormatDomain(this.FActiveDomain)}},{key:"ReFormatDomainBy",value:function(t,e){var i=this.GetFormatFirstDrawItem(this.Items[t].FirstDItemNo);this.FormatPrepare(i,e),this.ReFormatData(i,e),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),this.ReSetSelectAndCaret(this.SelectInfo.StartItemNo)}},{key:"ReFormatDomain",value:function(t){this.ReFormatDomainBy(t.BeginNo,t.EndNo)}},{key:"InsertDomain",value:function(t){if(!this.CanEdit(!0))return!1;var e=!1,i=null;this.Undo_GroupBegin(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset);try{this.Style.States.Include(oh.BatchInsert);try{this.ActiveDomain.BeginNo<0?this.FLevel=0:this.FLevel=this.FItems[this.ActiveDomain.BeginNo].Level,i=this.CreateDefaultDomainItem(),null!=t&&i.Assign(t),i.MarkType=ch.Beg,(e=this.InsertItem(i))&&(i=this.CreateDefaultDomainItem(),null!=t&&(i.Assign(t),t.InnerTextTmp&&(i.InnerTextTmp=t.InnerTextTmp)),i.MarkType=ch.End,e=this.InsertItem(i))}finally{this.Style.States.Exclude(oh.BatchInsert)}}finally{this.Undo_GroupEnd(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset)}return e}},{key:"SelectToDomain",value:function(t){if(!this.CanEdit(!0))return!1;return!1}},{key:"SetDomainVisible",value:function(t,e){var i=this.GetItemDomain(t);this.SetDomainRangeVisible(i.beginNo,i.endNo,e),i=null}},{key:"SetDomainRangeVisible",value:function(t,e,i){for(var n=t;n<=e;n++)this.FItems[n].Visible=i}},{key:"GetItemDomain",value:function(t){var e=new Ws;return this.GetDomainFrom(t,0,e,null),{beginNo:e.BeginNo,endNo:e.EndNo}}},{key:"GetItemBelongDomain",value:function(t){var e=0;if(this.FItems[t].StyleNo===oo.Domain&&this.FItems[t].MarkType===ch.End){for(var i=t+1;i<this.FItems.count;i++)if(this.FItems[i].StyleNo===oo.Domain)if(this.FItems[i].MarkType===ch.End){if(0===e)return i;e--}else e++}else for(var n=t-1;n>=0;n--)if(this.FItems[n].StyleNo===oo.Domain)if(this.FItems[n].MarkType===ch.Beg){if(0===e)return n;e--}else e++;return-1}},{key:"GetDomainFrom",value:function(t,e,i,n){if(i.Clear(),!(t<0||e<0)){var o=0,s=0,r=t,a=t;if(this.Items[t].StyleNo===oo.Domain&&this.doAskIsWantDomain(n,t))if(this.Items[t].MarkType===ch.Beg)if(e===Yl.OffsetAfter)i.Data=this,i.BeginNo=t,s=this.Items[t].Level,a=t+1;else{if(!(t>0))return;r=t-1}else if(e===Yl.OffsetAfter){if(!(t<this.Items.count-1))return;a=t+1}else i.EndNo=t,r=t-1;if(i.BeginNo<0)if(r<Math.trunc(this.Items.count/2)){o=0;for(var l=r;l>=0;l--)if(this.Items[l].StyleNo===oo.Domain&&this.doAskIsWantDomain(n,l))if(this.Items[l].MarkType===ch.Beg){if(!(o>0)){i.Data=this,i.BeginNo=l,s=this.Items[l].Level;break}o--}else o++;if(i.BeginNo>=0&&i.EndNo<0){o=0;for(var h=a;h<=this.Items.count-1;h++)if(this.Items[h].StyleNo===oo.Domain&&this.doAskIsWantDomain(n,h))if(this.Items[h].MarkType===ch.End)if(o>0)o--;else{if(this.Items[h].Level===s){i.EndNo=h;break}this.hcl.exception("异常：获取域结束位置出错，Level不匹配01！")}else o++;i.EndNo<0&&this.hcl.exception("异常：获取域结束位置出错01！")}}else{o=0;for(var c=a;c<this.Items.count;c++)if(this.Items[c].StyleNo===oo.Domain&&this.doAskIsWantDomain(n,c))if(this.Items[c].MarkType===ch.End){if(!(o>0)){i.EndNo=c,s=this.Items[c].Level;break}o--}else o++;if(i.EndNo>=0&&i.BeginNo<0){o=0;for(var u=r;u>=0;u--)if(this.Items[u].StyleNo===oo.Domain&&this.doAskIsWantDomain(n,u))if(this.Items[u].MarkType===ch.Beg)if(o>0)o--;else{if(this.Items[u].Level===s){i.Data=this,i.BeginNo=u;break}this.hcl.exception("异常：获取域起始位置出错，Level不匹配01！")}else o++;i.BeginNo<0&&this.hcl.exception("异常：获取域起始位置出错01！")}}else if(i.EndNo<0){o=0;for(var f=a;f<this.Items.count;f++)if(this.Items[f].StyleNo===oo.Domain&&this.doAskIsWantDomain(n,f))if(this.Items[f].MarkType===ch.End)if(o>0)o--;else{if(this.Items[f].Level===s){i.EndNo=f;break}this.hcl.exception("异常：获取域结束位置出错，Level不匹配02！")}else o++;i.EndNo<0&&this.hcl.exception("异常：获取域结束位置出错02！")}}}},{key:"ClearDomainBy",value:function(t){if(this.FItems[t].StyleNo===oo.Domain){var e=this.GetDomainAnother(t);t<e?this.FItems.removeRangeTo(t+1,e-1):this.FItems.removeRangeTo(e+1,t-1)}}},{key:"SetSelectBound",value:function(t,e,i,n){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=-1,r=-1,a=-1,l=-1;i<0?(s=t,a=e,r=-1,l=-1):i>=t?(s=t,r=i,i==t?n>=e?(a=e,l=n):(a=n,l=e):(a=e,l=n)):(s=i,r=t,l=a=n),this.AdjustSelectRange(s,a,r,l),this.MatchItemSelectState(),o?(this.GetActiveDomain(),this.FCurStyleNo=this.Items[this.SelectInfo.StartItemNo].StyleNo,this.FCurParaNo=this.Items[this.SelectInfo.StartItemNo].ParaNo):(this.ReSetSelectAndCaretByOffset(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,!0),this.Style.UpdateInfoRePaint())}},{key:"SelectItem",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.SetSelectBound(t,0,t,this.GetItemOffsetAfter(t),e)}},{key:"SelectDomain",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.GetDomainAnother(t);t<i?e?this.SetSelectBound(t,Yl.OffsetAfter,i,Yl.OffsetBefor):this.SetSelectBound(t,0,i,Yl.OffsetAfter):e?this.SetSelectBound(i,Yl.OffsetAfter,t,Yl.OffsetBefor):this.SetSelectBound(i,0,t,Yl.OffsetAfter)}},{key:"SelectItemAfterWithCaret",value:function(t){this.ReSetSelectAndCaret(t)}},{key:"SelectLastItemAfterWithCaret",value:function(){this.SelectItemAfterWithCaret(this.Items.count-1)}},{key:"SelectFirstItemBeforWithCaret",value:function(){this.ReSetSelectAndCaretByOffset(0,0)}},{key:"GetDomainAnother",value:function(t){var e=-1,i=this.Items[t];if(i.MarkType===ch.End){for(var n=t-1;n>=0;n--)if(this.Items[n].StyleNo===oo.Domain&&this.Items[n].MarkType===ch.Beg&&this.Items[n].Level===i.Level){e=n;break}}else for(var o=t+1,s=this.Items.count;o<s;o++)if(this.Items[o].StyleNo==oo.Domain&&this.Items[o].MarkType===ch.End&&this.Items[o].Level===i.Level){e=o;break}return e}},{key:"GetDomainAnotherRange",value:function(t){var e=this.GetDomainAnother(t);return e<t?{beginNo:e,endNo:t}:{beginNo:t,endNo:e}}},{key:"ReversePos",value:function(t,e){var i=e.lastIndexOf(t);return i<0?0:i+1}},{key:"DoSearchByOffset",value:function(t,e,i,n,o,s){if(!this.Items[o].Visible)return!1;var r,a,l,h=-1,c=-1,u=!1;if(this.Items[o].StyleNo<oo.Null)(u=this.Items[o].Search(t,i,n))&&(this.SelectInfo.StartItemNo=o,this.SelectInfo.StartItemOffset=Yl.OffsetInner,this.SelectInfo.EndItemNo=-1,this.SelectInfo.EndItemOffset=-1);else if(i?(r=this.Items[o].SubString(1,s),n||(r=r.toUpperCase()),h=this.ReversePos(e,r)):(r=this.Items[o].SubString(s+1,this.Items[o].Length-s),n||(r=r.toUpperCase()),h=r.indexOf(e)+1),h>0)this.SelectInfo.StartItemNo=o,this.SelectInfo.StartItemOffset=i?h-1:s+h-1,this.SelectInfo.EndItemNo=o,this.SelectInfo.EndItemOffset=this.SelectInfo.StartItemOffset+e.length,u=!0;else if(""!=r&&e.length>1)if(i)for(c=o,a=r,l="";c>0&&!this.Items[c].ParaFirst&&this.Items[c-1].StyleNo>oo.Null;)if(this.Items[c-1].Visible){if(r.length>e.length-1&&(r=this.Items[c-1].TextEffective().substr(e.length-1,this.Items[c-1].Text.length-e.length+1)),l+=r,a=r+a,n||(a=a.toUpperCase()),(h=a.indexOf(e)+1)>0){for(this.SelectInfo.StartItemNo=c-1,this.SelectInfo.StartItemOffset=this.Items[c-1].Length-(r.length-h)-1,this.SelectInfo.EndItemNo=o,this.SelectInfo.EndItemOffset=h+e.length-1-r.length;c<o;)this.Items[c].Visible&&(this.SelectInfo.EndItemOffset=this.SelectInfo.EndItemOffset-this.Items[c].TextEffective().length),c++;u=!0;break}if(l.length>=e.length-1)break;c--}else c--;else for(c=o,a=r,l="";c<this.Items.count-1&&!this.Items[c+1].ParaFirst&&this.Items[c+1].StyleNo>oo.Null;)if(this.Items[c+1].Visible){if(r.length>e.length-1&&(r=this.Items[c+1].TextEffective().substr(0,e.length-1)),l+=r,a+=r,n||(a=a.toUpperCase()),(h=a.indexOf(e)+1)>0){for(this.SelectInfo.StartItemNo=o,this.SelectInfo.StartItemOffset=s+h-1,this.SelectInfo.EndItemNo=c+1,this.SelectInfo.EndItemOffset=h+e.length-1-(this.Items[o].Length-s);c>=o+1;)this.Items[c].Visible||(this.SelectInfo.EndItemOffset=this.SelectInfo.EndItemOffset-this.Items[c].TextEffective().length),c--;u=!0;break}if(l.length>=e.length-1)break;c++}else c++;return u}},{key:"Search",value:function(t,e,i){var n=!1,o="";o=i?t:t.toUpperCase();var s=-1,r=-1;if(this.SelectInfo.StartItemNo<0?(s=0,r=0):this.SelectInfo.EndItemNo>=0?(e?(s=this.SelectInfo.StartItemNo,r=this.SelectInfo.StartItemOffset):(s=this.SelectInfo.EndItemNo,r=this.SelectInfo.EndItemOffset),this.DisSelect()):(s=this.SelectInfo.StartItemNo,r=this.SelectInfo.StartItemOffset),!(n=this.DoSearchByOffset(t,o,e,i,s,r)))if(e){for(var a=s-1;a>=0;a--)if(this.DoSearchByOffset(t,o,e,i,a,this.GetItemOffsetAfter(a))){n=!0;break}}else for(var l=s+1;l<=this.Items.count-1;l++)if(this.DoSearchByOffset(t,o,e,i,l,0)){n=!0;break}return n?(s=this.SelectInfo.StartItemNo,r=this.SelectInfo.StartItemOffset,this.SelectInfo.EndItemNo>=0?this.ReSetSelectAndCaretByOffset(this.SelectInfo.EndItemNo,this.SelectInfo.EndItemOffset,!e):this.ReSetSelectAndCaretByOffset(s,r,!e),this.SelectInfo.StartItemNo=s,this.SelectInfo.StartItemOffset=r,this.MatchItemSelectState()):this.SelectInfo.EndItemNo>=0?(e?(s=this.SelectInfo.StartItemNo,r=this.SelectInfo.StartItemOffset):(s=this.SelectInfo.EndItemNo,r=this.SelectInfo.EndItemOffset),this.DisSelect(),this.SelectInfo.StartItemNo=s,this.SelectInfo.StartItemOffset=r):this.SelectInfo.StartItemNo<0&&(this.SelectInfo.StartItemNo=s,this.SelectInfo.StartItemOffset=r),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),n}},{key:"Replace",value:function(t){return this.InsertText(t)}},{key:"ReplaceDomainByStream",value:function(t,e,i,n,o){var s=this,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.DisSelect(),this.UndoAction_ItemParaFirst(o,0,this.Items[o].ParaFirst),this.FItems[o].ParaFirst=!1,this.FItems.removeRange(n+1,o-n-1),this.FStyle.States.Include(oh.BatchInsert);try{this.FLevel=this.FItems[n].Level;var a=null,l=n,h="";this.ParseDataStream(t,e,i,(function(t,e,i){if(r){if(h=i.TextEffective(),0===t){if(""===h)return i.ParaFirst&&(s.UndoAction_ItemParaFirst(l+1,0,s.Items[l+1].ParaFirst),s.FItems[l+1].ParaFirst=!0),{result:!1,stop:!1};i.ParaFirst=!1}else if(t===e-1){if(""===h&&i.ParaFirst&&!s.FItems[l+1].ParaFirst)return s.UndoAction_ItemParaFirst(l+1,0,s.Items[l+1].ParaFirst),s.FItems[l+1].ParaFirst=!0,{result:!1,stop:!1}}else if(""===h&&!i.ParaFirst)return{result:!1,stop:!1};return a=s.CreateDefaultTextItem(),i.StyleNo>oo.Null?a.StyleNo=i.StyleNo:a.StyleNo=s.FItems[n].GetTextStyleNo(),a.FormatDirection=i.FormatDirection,a.Text=h,a.ParaNo=s.FItems[n].ParaNo,a.ParaFirst=i.ParaFirst,t>0&&!a.ParaFirst&&s.MergeItemText(s.FItems[l],a)?(s.UndoAction_InsertText(l,s.Items[l].Length-a.Length+1,a.Text),a=null):(l++,s.FItems.insert(l,a),s.UndoAction_InsertItem(l,0)),{result:!1,stop:!1}}if(0===t){if(i.StyleNo>oo.Null&&""===i.TextEffective())return i.ParaFirst&&(s.UndoAction_ItemParaFirst(l+1,0,s.Items[l+1].ParaFirst),s.FItems[l+1].ParaFirst=!0),{result:!1,stop:!1};i.ParaFirst=!1}else if(t===e-1&&i.StyleNo>oo.Null&&""===i.TextEffective()&&i.ParaFirst&&!s.FItems[l+1].ParaFirst)return s.UndoAction_ItemParaFirst(l+1,0,s.Items[l+1].ParaFirst),s.FItems[l+1].ParaFirst=!0,{result:!1,stop:!1};if(l++,i.ParaNo=s.FItems[n].ParaNo,i.StyleNo===oo.Domain&&i.EndMark){var o=s.FItems.count;s.FItems.insert(l,i),s.UndoAction_InsertItem(l,0),o=s.FItems.count-o-1,l+=o}else s.FItems.insert(l,i),s.UndoAction_InsertItem(l,0);return{result:!0,stop:!1}}))}finally{this.FStyle.States.Exclude(oh.BatchInsert)}this.InitializeField(),this.Change(),this.DoDomainChange(n,-1,rh.ContentChange)}},{key:"ReplaceDomainByText",value:function(t,e,i){this.DisSelect(),this.FItems.removeRange(t+1,e-t-1);for(var n,o=Yl.ReplaceUnPreChar(i).split(Yl.sLineBreak),s=!1,r=null,a=t,l=0;l<o.length;l++)n=o[l],l===o.length-1&&s&&""===n?(this.UndoAction_ItemParaFirst(a+1,0,this.Items[a+1].ParaFirst),this.FItems[a+1].ParaFirst=!0):(s||""!==n)&&((r=this.CreateDefaultTextItem()).StyleNo=this.FItems[t].GetTextStyleNo(),r.ParaNo=this.FItems[t].ParaNo,r.ParaFirst=s,r.Text=n,a++,this.FItems.insert(a,r),this.UndoAction_InsertItem(a,0)),s=!0;this.InitializeField(),this.Change(),this.DoDomainChange(t,-1,rh.ContentChange)}},{key:"ReplaceItemByStream",value:function(t,e,i,n){var o=this,s=0,r=this.FItems[t].ParaNo;this.FStyle.States.Include(oh.BatchInsert);try{var a=this.GetItemBelongDomain(t);this.FLevel=a<0?0:this.FItems[a].Level,this.ParseDataStream(e,i,n,(function(e,i,n){if(0===e)if(o.UndoAction_DeleteItem(t,0),o.Items.delete(t),t>0){if(o.MergeItemText(o.Items[t-1],n))return o.UndoAction_InsertText(t-1,o.Items[t-1].Length-n.Length+1,n.Text),s++,{result:!1,stop:!1}}else n.ParaFirst=!0;else if(e===i-1&&t+e-s<o.Items.count&&!o.Items[t+e-s].ParaFirst)if(o.MergeItemText(n,o.Items[t+e-s]))o.UndoAction_DeleteItem(t+e-s,0),o.Items.delete(t+e-s);else if(n.StyleNo>oo.Null&&""===n.Text&&n.ParaFirst)return o.UndoAction_ItemParaFirst(t+e-s,0,o.Items[t+e-s].ParaFirst),o.Items[t+e-s].ParaFirst=!0,s++,{result:!1,stop:!1};if(n.ParaNo=r,n.StyleNo===oo.Domain&&n.EndMark){var a=o.FItems.count;o.Items.insert(t+e-s,n),o.UndoAction_InsertItem(t+e-s,0),a=o.FItems.count-a-1,s-=a}else o.Items.insert(t+e-s,n),o.UndoAction_InsertItem(t+e-s,0);return{result:!0,stop:!1}}))}finally{this.FStyle.States.Exclude(oh.BatchInsert)}this.InitializeField(),this.Change()}},{key:"ReplaceItemByItem",value:function(t,e){return e.StyleNo!==oo.Domain&&this.Items[t].StyleNo!==oo.Domain&&(e.ParaFirst=this.Items[t].ParaFirst,e.PageBreak=this.Items[t].PageBreak,t>0&&e.StyleNo>oo.Null&&!e.ParaFirst&&this.MergeItemText(this.Items[t-1],e)?(this.Items.delete(t),!1):t<this.Items.count-1&&e.StyleNo>oo.Null&&!this.Items[t+1].ParaFirst&&e.CanConcatItems(this.Items[t+1])?(this.Items[t+1].Text=e.Text+this.Items[t+1].Text,this.Items.delete(t),!1):(this.InitializeField(),e.ParaNo=this.Items[t].ParaNo,this.Items.delete(t),this.Change(),this.Items.insert(t,e)))}},{key:"GetDomainText",value:function(t){var e=this.FItems.indexOf(t);return e>=0?this.GetDomainTextBy(e):""}},{key:"GetDomainTextBy",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=e,n=-1;return i<0&&(i=this.GetDomainAnother(t)),i<t?(n=i,i=t):n=t,this.SaveToTextRange(n+1,0,i-1,this.GetItemOffsetAfter(i-1))}},{key:"SetDomainText",value:function(t,e){var i=this.FItems.indexOf(t);if(i>=0){var n=this.GetDomainAnother(i),o=-1;n<i?(o=n,n=i):o=i,this.ReplaceDomainByText(o,n,e)}}},{key:"ActiveDomainBeginItem",value:function(){return this.FActiveDomain.BeginNo>=0?this.Items[this.FActiveDomain.BeginNo]:null}},{key:"GetCaretInfoCur",value:function(t){this.Style.UpdateInfo.DragingSelected?this.GetCaretInfo(this.MouseMoveItemNo,this.MouseMoveItemOffset,t):this.GetCaretInfo(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,t)}},{key:"TraverseItemExecute",value:function(t,e){if(this.Items[t].Visible||e.Invisible){var i;if(this.Items[t].StyleNo==oo.Domain)e.ReverseOrder?rs.IsEndMark(this.Items[t])?((i=(i=e.DomainStack.peek()).AppendChild()).Data=this,i.EndNo=t,e.DomainStack.push(i)):(i=e.DomainStack.pop()).BeginNo=t:rs.IsBeginMark(this.Items[t])?((i=(i=e.DomainStack.peek()).AppendChild()).Data=this,i.BeginNo=t,e.DomainStack.push(i)):(i=e.DomainStack.pop()).EndNo=t;e.ReverseOrder&&this.Items[t].StyleNo<oo.Null&&this.Items[t].TraverseItem(e),e.Stop=e.Process(this,t,e.Tag,e.DomainStack,e.Stop),!e.ReverseOrder&&!e.Stop&&this.Items[t].StyleNo<oo.Null&&this.Items[t].TraverseItem(e)}}},{key:"TraverseItem",value:function(t){if(null!=t)if(t.ReverseOrder)for(var e=this.Items.count-1;e>=0&&!t.Stop;e--)this.TraverseItemExecute(e,t);else for(var i=0;i<this.Items.count&&!t.Stop;i++)this.TraverseItemExecute(i,t)}},{key:"ExecuteScript",value:function(t){return!1}},{key:"HotDomain",get:function(){return this.FHotDomain}},{key:"ActiveDomain",get:function(){return this.FActiveDomain}},{key:"DomainCount",get:function(){return this.FDomainCount}},{key:"Script",get:function(){return Yl.HCGetProperty(this.Scripts,Yl.JAVASCRIPT)},set:function(t){Yl.HCSetProperty(this.Scripts,Yl.JAVASCRIPT,t,!1)}}]),i}(function(t){m()(i,t);var e=Ul(i);function i(t,n){return r()(this,i),e.call(this,t,n)}return l()(i)}(function(t){m()(i,t);var e=Gl(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FAnnotateCount=0,o.FPaintAnnotateID=-1,o.FIDStrack=new st,o.FPaintStack=new st,o.FHotAnnotate=new Vl,o.FHotAnnotate.Data=Jt()(o),o.FActiveAnnotate=new Vl,o.FActiveAnnotate.Data=Jt()(o),o.OnDrawItemAnnotate=null,o.OnInsertAnnotate=null,o.OnRemoveAnnotate=null,o.OnRequestAnnotateID=null,o}return l()(i,[{key:"GetActiveAnnotateItem",value:function(){return this.FActiveAnnotate.EndNo>0?this.Items[this.FActiveAnnotate.EndNo]:null}},{key:"DoLoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"DoLoadFromStream",this).call(this,t,e,n),n>22&&n<55){var o=t.readUInt16();if(o>0)for(var s=0;s<o;s++)(new Hl).LoadFromStream(t,n)}n>66||n>54&&t.readUInt32()}},{key:"DoInsertItem",value:function(t){t.StyleNo===oo.Annotate&&t.MarkType===ch.Beg&&(this.FAnnotateCount++,null!=this.OnInsertAnnotate&&this.OnInsertAnnotate(this,t)),f()(F()(i.prototype),"DoInsertItem",this).call(this,t)}},{key:"DoRemoveItem",value:function(t){t.StyleNo===oo.Annotate&&t.MarkType===ch.Beg&&(this.FAnnotateCount--,null!=this.OnRemoveAnnotate&&this.OnRemoveAnnotate(this,t)),f()(F()(i.prototype),"DoRemoveItem",this).call(this,t)}},{key:"DoAcceptAction",value:function(t,e,n){if(this.Style.States.Contain(oh.Loading)||this.Style.States.Contain(oh.Undoing)||this.Style.States.Contain(oh.Redoing))return!0;var o=!0;return n===rh.DeleteItem&&this.Items[t].StyleNo===oo.Annotate&&(o=!1),o&&(o=f()(F()(i.prototype),"DoAcceptAction",this).call(this,t,e,n)),o}},{key:"DoDrawItemPaintBefor",value:function(t,e,n,o,s,r,a,l,h,c,u,d){f()(F()(i.prototype),"DoDrawItemPaintBefor",this).call(this,t,e,n,o,s,r,a,l,h,c,u,d)}},{key:"DoDrawItemPaintContent",value:function(t,e,n,o,s,r,a,l,h,c,u,d,m){if(!m.Print){var S=t.Items[e];S.StyleNo===oo.Annotate&&(d.pen.width=1,d.pen.style=_t.Solid,d.pen.color=this.Style.AnnotateLineColor,d.drawLineDriect(o.left-1,o.top,o.left-1,o.bottom),S.IsBeginMark()?(this.FPaintAnnotateID=S.ID,this.FPaintStack.push(this.FPaintAnnotateID)):(this.FPaintStack.count>0&&this.FPaintStack.pop(),this.FPaintStack.count>0?this.FPaintAnnotateID=this.FPaintStack.peek():this.FPaintAnnotateID=0),null!==this.OnDrawItemAnnotate&&S.MarkType===ch.End&&this.OnDrawItemAnnotate(t,n,o,S)),this.FActiveAnnotate.Contain(e)?(d.brush.color=this.Style.AnnotateBKActiveColor,d.fillRect(o)):this.FHotAnnotate.Contain(e)?(d.brush.color=this.Style.AnnotateBKHotColor,d.fillRect(o)):this.FPaintAnnotateID>0&&!S.Selected()&&(d.brush.color=this.Style.AnnotateBKColor,d.fillRect(o))}f()(F()(i.prototype),"DoDrawItemPaintContent",this).call(this,t,e,n,o,s,r,a,l,h,c,u,d,m)}},{key:"CanEditItem",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!!(this.ReadOnly&&this.Style.ReadOnlyProcessAnnotate&&this.Style.States.Contain(oh.ProcessAnnotate))||f()(F()(i.prototype),"CanEditItem",this).call(this,t,e,n)}},{key:"GetCaretInfo",value:function(t,e,n){(this.FActiveAnnotate.Clear(),this.FAnnotateCount>0&&this.SelectInfo.StartItemNo>=0)&&(this.GetTopLevelData()==this&&this.GetAnnotateFrom(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset,this.FActiveAnnotate));f()(F()(i.prototype),"GetCaretInfo",this).call(this,t,e,n)}},{key:"PaintDataRange",value:function(t,e,n,o,s,r,a,l,h,c,u){if(!u.Print&&(this.FPaintAnnotateID=0,this.FPaintStack.clear(),l>0)){var d=new Vl;try{this.GetAnnotateFrom(this.FDrawItems[l-1].ItemNo,this.FDrawItems[l-1].CharOffsetEnd(),d),d.BeginNo>=0&&(this.FPaintAnnotateID=this.FItems[d.BeginNo].ID,this.FPaintStack.push(this.FPaintAnnotateID))}finally{d=null}}f()(F()(i.prototype),"PaintDataRange",this).call(this,t,e,n,o,s,r,a,l,h,c,u)}},{key:"MouseLeave",value:function(){this.FHotAnnotate.Clear(),f()(F()(i.prototype),"MouseLeave",this).call(this)}},{key:"MouseMove",value:function(t){f()(F()(i.prototype),"MouseMove",this).call(this,t),this.FAnnotateCount>0?this.GetAnnotateFrom(this.MouseMoveItemNo,this.MouseMoveItemOffset,this.FHotAnnotate):this.FHotAnnotate.Clear();var e=this.GetTopLevelDataAt(t.x,t.y);(e===this||e.HotAnnotate.BeginNo<0)&&this.FHotAnnotate.BeginNo>=0&&this.Style.UpdateInfoRePaint()}},{key:"InitializeField",value:function(){f()(F()(i.prototype),"InitializeField",this).call(this),null!=this.FHotAnnotate&&this.FHotAnnotate.Clear(),null!=this.FActiveAnnotate&&this.FActiveAnnotate.Clear()}},{key:"SaveToStream",value:function(t){f()(F()(i.prototype),"SaveToStream",this).call(this,t)}},{key:"GetAnnotateBeginBefor",value:function(t,e){for(var i=t;i>=0;i--)if(this.Items[i].StyleNo===oo.Annotate&&this.Items[i].MarkType===ch.Beg&&this.Items[i].ID===e)return i;return-1}},{key:"GetAnnotateEndAfter",value:function(t,e){for(var i=t;i<this.Items.count;i++)if(this.Items[i].StyleNo===oo.Annotate&&this.Items[i].MarkType===ch.End&&this.Items[i].ID===e)return i;return-1}},{key:"GetAnnotateFrom",value:function(t,e,i){if(i.Clear(),this.FIDStrack.clear(),!(t<0||e<0)){var n=null,o=0;if(this.Items[t].StyleNo===oo.Annotate)if((n=this.Items[t]).MarkType===ch.Beg){if(e===Yl.OffsetAfter)return i.Data=this,i.BeginNo=t,o=n.ID,void(i.EndNo=this.GetAnnotateEndAfter(t+1,o))}else if(e===Yl.OffsetBefor)return i.Data=this,i.EndNo=t,o=n.ID,void(i.BeginNo=this.GetAnnotateBeginBefor(t-1,o));for(var s=t;s>=0;s--)if(this.Items[s].StyleNo===oo.Annotate)if((n=this.Items[s]).MarkType===ch.End)this.FIDStrack.push(n.ID);else{if(!(this.FIDStrack.count>0)){i.Data=this,i.BeginNo=s,o=n.ID;break}if(o=this.FIDStrack.peek(),n.ID!==o){i.Data=this,i.BeginNo=s,o=n.ID;break}this.FIDStrack.pop()}i.BeginNo>=0&&(i.EndNo=this.GetAnnotateEndAfter(t+1,o))}}},{key:"RequestAnnotateID",value:function(){return this.OnRequestAnnotateID()}},{key:"SetActiveAnnotateByID",value:function(t){if(this.FActiveAnnotate.Clear(),t>0)for(var e=0;e<this.FItems.count;e++)if(this.FItems[e].StyleNo===oo.Annotate&&this.FItems[e].IsEndMark()&&this.FItems[e].ID===t){this.GetAnnotateFrom(e,Yl.OffsetBefor,this.FActiveAnnotate),this.ItemSetCaretRequest(e,Yl.OffsetBefor);break}this.Style.UpdateInfoReCaret(),this.Style.UpdateInfoRePaint()}},{key:"SetHotAnnotateByID",value:function(t){if(this.FHotAnnotate.Clear(),t>0)for(var e=0;e<this.FItems.count;e++)if(this.FItems[e].StyleNo===oo.Annotate&&this.FItems[e].IsBeginMark()&&this.FItems[e].ID===t){this.GetAnnotateFrom(e,Yl.OffsetAfter,this.FHotAnnotate);break}this.Style.UpdateInfoRePaint()}},{key:"InsertAnnotateByOffset",value:function(t,e,i){var n=0;if(i===Yl.OffsetBefor)t.ParaFirst=this.Items[e].ParaFirst,t.PageBreak=this.Items[e].PageBreak,this.Items[e].StyleNo>oo.Null&&""===this.Items[e].Text?(this.UndoAction_DeleteItem(e,0),this.Items.delete(e),n--):(this.Items[e].ParaFirst&&(this.UndoAction_ItemParaFirst(e,0,!1),this.Items[e].ParaFirst=!1),this.Items[e].PageBreak&&(this.UndoAction_ItemPageBreak(e,0,!1),this.Items[e].PageBreak=!1)),this.Items.insert(e,t),this.UndoAction_InsertItem(e,Yl.OffsetBefor),n++,t.MarkType==ch.Beg&&(this.SelectInfo.StartItemNo+=n,this.SelectInfo.EndItemNo+=n);else if(i===this.GetItemOffsetAfter(e))this.Items.insert(e+1,t),this.UndoAction_InsertItem(e+1,Yl.OffsetBefor),n++;else if(this.IsRectItem(e))this.Items.insert(e+1,t),this.UndoAction_InsertItem(e+1,Yl.OffsetBefor),n++;else{var o=this.Items[e].SubString(i+1,this.Items[e].Length-i);this.UndoAction_DeleteText(e,i+1,o);var s=this.Items[e].BreakByOffset(i);this.Style.States.Include(oh.InsertBreakItem);try{this.Items.insert(e+1,s)}finally{this.Style.States.Exclude(oh.InsertBreakItem)}this.UndoAction_InsertItem(e+1,0),n++,this.Items.insert(e+1,t),this.UndoAction_InsertItem(e+1,Yl.OffsetBefor),n++,t.MarkType==ch.Beg&&(this.SelectInfo.StartItemNo+=n,this.SelectInfo.EndItemNo+=n,this.SelectInfo.StartItemNo==this.SelectInfo.EndItemNo&&(this.SelectInfo.EndItemOffset=this.SelectInfo.EndItemOffset-this.SelectInfo.StartItemOffset),this.SelectInfo.StartItemOffset=0)}return n}},{key:"InsertAnnotate",value:function(t,e,i){var n=!1;if(this.Items[this.SelectInfo.StartItemNo].StyleNo<oo.Null&&this.SelectInfo.StartItemOffset===Yl.OffsetInner){this.Undo_New();var o=this.Items[this.SelectInfo.StartItemNo];o.MangerUndo?this.UndoAction_ItemSelf(this.SelectInfo.StartItemNo,Yl.OffsetInner):this.UndoAction_ItemMirror(this.SelectInfo.StartItemNo,Yl.OffsetInner),n=this.Items[this.SelectInfo.StartItemNo].InsertAnnotate(t,e,i);if(o.IsFormatDirty){var s=this.GetFormatRange(-1,-1);this.FormatPrepare(s.firstDrawItemNo,s.lastItemNo),this.ReFormatData(s.firstDrawItemNo,s.lastItemNo)}else this.FormatInit();return n}if(!this.CanEdit())return!1;this.Style.States.Include(oh.BatchInsert);try{var r=0,a=-1,l=-1;if(this.Undo_New(),this.SelectExists())a=this.GetFormatFirstDrawItem(this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset),l=this.GetParaLastItemNo(this.SelectInfo.EndItemNo);else{var h=this.GetFormatRangeByOffset(this.SelectInfo.StartItemNo,1,a,l);a=h.firstDrawItemNo,l=h.lastItemNo}this.FormatPrepare(a,l);var c=this.RequestAnnotateID(),u=new Ol(this.hcl,this);u.MarkType=ch.End,u.ID=c,u.Content.Index=i,u.Content.Title=t,u.Content.Text=e,r=this.SelectInfo.EndItemNo>=0?this.InsertAnnotateByOffset(u,this.SelectInfo.EndItemNo,this.SelectInfo.EndItemOffset):this.InsertAnnotateByOffset(u,this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset),(u=new Ol(this.hcl,this)).MarkType=ch.Beg,u.ID=c,r+=this.InsertAnnotateByOffset(u,this.SelectInfo.StartItemNo,this.SelectInfo.StartItemOffset),this.ReFormatData(a,l+r,r)}finally{this.Style.States.Exclude(oh.BatchInsert)}return this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),this.ReSetSelectAndCaret(this.SelectInfo.StartItemNo),!0}},{key:"DeleteAnnotate",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this.CanEdit())return!1;if(e<t)return!1;this.InitializeField();var n=-1,o=-1,s=-1,r=this.GetFormatRangeByOffset(t,0,n,s);n=r.firstDrawItemNo,s=r.lastItemNo,s=(r=!i&&e<this.Items.count-1&&this.Items[e+1].ParaFirst?this.GetFormatRangeByOffset(e+1,this.GetItemOffsetAfter(e+1),o,s):this.GetFormatRangeByOffset(e,this.GetItemOffsetAfter(e),o,s)).lastItemNo,this.Items[t].ParaFirst&&n>0&&(n--,n=this.GetFormatFirstDrawItem(n)),this.FormatPrepare(n,s);var a=this.Items[t].ParaFirst,l=2;if(this.Undo_New(),this.UndoAction_DeleteItem(e,0),this.Items.delete(e),this.UndoAction_DeleteItem(t,0),this.Items.delete(t),0===this.Items.count){var h=this.CreateDefaultTextItem();this.CurStyleNo=h.StyleNo,h.ParaFirst=!0,this.Items.add(h),l--,this.UndoAction_InsertItem(0,0)}else if(a)if(t<this.Items.count-1&&!this.Items[t].ParaFirst)this.UndoAction_ItemParaFirst(t,0,!0),this.Items[t].ParaFirst=!0;else if(i){var c=this.CreateDefaultTextItem();this.CurStyleNo=c.StyleNo,c.ParaFirst=!0,this.Items.insert(t,c),l--,this.UndoAction_InsertItem(t,0)}return this.ReFormatData(n,s-l,-l),this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret(),a&&i?this.ReSetSelectAndCaretByOffset(t,0):t>0?this.ReSetSelectAndCaret(t-1):this.ReSetSelectAndCaretByOffset(0,0),!0}},{key:"DeleteActiveAnnotate",value:function(){if(this.SelectExists())return!1;var t=!1;if(this.FActiveAnnotate.BeginNo>=0)t=this.DeleteAnnotate(this.FActiveAnnotate.BeginNo,this.FActiveAnnotate.EndNo);else if(this.Items[this.SelectInfo.StartItemNo].StyleNo<oo.Null&&this.SelectInfo.StartItemOffset===Yl.OffsetInner){this.Undo_New();var e=this.Items[this.SelectInfo.StartItemNo];if(e.MangerUndo?this.UndoAction_ItemSelf(this.SelectInfo.StartItemNo,Yl.OffsetInner):this.UndoAction_ItemMirror(this.SelectInfo.StartItemNo,Yl.OffsetInner),t=this.Items[this.SelectInfo.StartItemNo].DeleteActiveAnnotate(),e.IsFormatDirty){var i=this.GetFormatRange(-1,-1);this.FormatPrepare(i.firstDrawItemNo,i.lastItemNo),this.ReFormatData(i.firstDrawItemNo,i.lastItemNo)}else this.FormatInit()}return t}},{key:"HotAnnotate",get:function(){return this.FHotAnnotate}},{key:"ActiveAnnotate",get:function(){return this.FActiveAnnotate}},{key:"ActiveAnnotateItem",get:function(){return this.GetActiveAnnotateItem()}}]),i}(Ll)));function Kl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Jl=function(t){m()(i,t);var e=Kl(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FActive=!1,o.FCellSelectedAll=!1,o.FCellHeight=20,o.OnSetFormatHeightChange=null,o.FOnGetRootData=null,o.OnGetFormatCoord=null,o}return l()(i,[{key:"PointInCellRect",value:function(t){return nt.CreateByBounds(0,0,this.Width,this.FCellHeight).pointIn(t)}},{key:"GetHeight",value:function(){var t=f()(F()(i.prototype),"GetHeight",this).call(this);return this.DrawItems.count>0&&(t+=this.DrawItems[0].rect.top),t}},{key:"DoLoadFromStream",value:function(t,e,n){this.BeginFormat();try{f()(F()(i.prototype),"DoLoadFromStream",this).call(this,t,e,n)}finally{this.EndFormat(!1)}}},{key:"ReSetSelectAndCaretByOffset",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.FActive?f()(F()(i.prototype),"ReSetSelectAndCaretByOffset",this).call(this,t,e,n):(this.SelectInfo.Initialize(),this.SelectInfo.StartItemNo=t,this.SelectInfo.StartItemOffset=e,this.GetActiveDomain())}},{key:"ReFormat",value:function(){this.Style.SkipFormat||f()(F()(i.prototype),"ReFormat",this).call(this)}},{key:"ReFormatData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];f()(F()(i.prototype),"ReFormatData",this).call(this,t,e,n,o),this.FormatChange=!1,this.FormatHeightChange&&(this.SetFormatHeightChange(),this.DoFormatDirty())}},{key:"DoSetFormatHeightChange",value:function(){null!=this.OnSetFormatHeightChange&&this.OnSetFormatHeightChange()}},{key:"DisSelect",value:function(){var t=f()(F()(i.prototype),"DisSelect",this).call(this);return this.FCellSelectedAll=!1,t}},{key:"DeleteSelected",value:function(){var t=f()(F()(i.prototype),"DeleteSelected",this).call(this);return this.FCellSelectedAll=!1,t}},{key:"DeleteItemDirect",value:function(t){f()(F()(i.prototype),"DeleteItemDirect",this).call(this,t),this.DoFormatDirty()}},{key:"SetFormatHeightChange",value:function(){this.FormatChange=!1,this.DoSetFormatHeightChange()}},{key:"ReplaceDomainByStream",value:function(t,e,n,o,s){var r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];f()(F()(i.prototype),"ReplaceDomainByStream",this).call(this,t,e,n,o,s,r),this.DoFormatDirty()}},{key:"ReplaceDomainByText",value:function(t,e,n){f()(F()(i.prototype),"ReplaceDomainByText",this).call(this,t,e,n),this.DoFormatDirty()}},{key:"ReplaceItemByStream",value:function(t,e,n,o){f()(F()(i.prototype),"ReplaceItemByStream",this).call(this,t,e,n,o),this.DoFormatDirty()}},{key:"ReplaceItemByItem",value:function(t,e){return this.DoFormatDirty(),f()(F()(i.prototype),"ReplaceItemByItem",this).call(this,t,e)}},{key:"SetDomainText",value:function(t,e){f()(F()(i.prototype),"SetDomainText",this).call(this,t,e),this.DoFormatDirty()}},{key:"SetActive",value:function(t){this.FActive!==t&&(this.FActive=t),this.FActive||(this.FActiveDomain.BeginNo>=0&&null!==this.OnDomainSwitch&&this.OnDomainSwitch(this,this.FActiveDomain.BeginNo,!1),this.DisSelect(),this.InitializeField(),this.Style.UpdateInfoRePaint())}},{key:"GetFormatCoord",value:function(){return null!==this.OnGetFormatCoord?this.OnGetFormatCoord(this):et.Create(0,0)}},{key:"ApplySelectTextStyle",value:function(t){this.FCellSelectedAll&&(this.CurStyleNo=this.Items[0].StyleNo),f()(F()(i.prototype),"ApplySelectTextStyle",this).call(this,t)}},{key:"ApplySelectParaStyle",value:function(t){this.FCellSelectedAll&&(this.CurParaNo=this.Items[0].ParaNo),f()(F()(i.prototype),"ApplySelectParaStyle",this).call(this,t)}},{key:"GetDrawItemFormatCoord",value:function(t){var e=f()(F()(i.prototype),"GetDrawItemFormatCoord",this).call(this,t),n=this.GetFormatCoord();return e.x+=n.x,e.y+=n.y,e}},{key:"SelectAll",value:function(){f()(F()(i.prototype),"SelectAll",this).call(this),this.FCellSelectedAll=!0}},{key:"CoordInSelect",value:function(t,e,n,o,s){return this.FCellSelectedAll?this.PointInCellRect(et.Create(t,e)):f()(F()(i.prototype),"CoordInSelect",this).call(this,t,e,n,o,s)}},{key:"GetItemAt",value:function(t,e,n,o,s,r){var a=f()(F()(i.prototype),"GetItemAt",this).call(this,t,e,n,o,s,r);return this.FCellSelectedAll&&(a.restrain=!this.PointInCellRect(et.Create(t,e))),a}},{key:"GetRootData",value:function(){return null!==this.FOnGetRootData?this.FOnGetRootData():f()(F()(i.prototype),"GetRootData",this).call(this)}},{key:"SelectFirstItemOffsetBefor",value:function(){return!this.SelectExists()&&0===this.SelectInfo.StartItemNo&&0===this.SelectInfo.StartItemOffset}},{key:"SelectLastItemOffsetAfter",value:function(){return!this.SelectExists()&&this.SelectInfo.StartItemNo===this.Items.count-1&&this.SelectInfo.StartItemOffset===this.GetItemOffsetAfter(this.SelectInfo.StartItemNo)}},{key:"SelectFirstLine",value:function(){return 0===this.GetParaFirstItemNo(this.SelectInfo.StartItemNo)}},{key:"SelectLastLine",value:function(){return this.GetParaLastItemNo(this.SelectInfo.StartItemNo)===this.Items.count-1}},{key:"SetDomainRangeVisible",value:function(t,e,n){f()(F()(i.prototype),"SetDomainRangeVisible",this).call(this,t,e,n),this.DoFormatDirty()}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?f()(F()(i.prototype),"ItemRangeToJSONString",this).call(this,0,this.FItems.count-1,t,e):f()(F()(i.prototype),"ToJSONString",this).call(this,t,e)}},{key:"CellSelectedAll",get:function(){return this.FCellSelectedAll},set:function(t){this.FCellSelectedAll=t}},{key:"CellHeight",get:function(){return this.FCellHeight},set:function(t){this.FCellHeight=t}},{key:"Active",get:function(){return this.FActive},set:function(t){this.SetActive(t)}},{key:"OnGetRootData",get:function(){return this.FOnGetRootData},set:function(t){this.FOnGetRootData=t}}]),i}(zl);function jl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Yl=function(){function t(){r()(this,t),this.CHECKNULLITEM=!0,this.USESCRIPT=!1,this.USESAVEITEMEVENT=!1,this.DOMAINPAINTEVENT=!1,this.PAINTTEXTEVENT=!1}return l()(t,[{key:"GetNorAlignCharOffsetAtVertical",value:function(e,i,n){var o;if(n<0)o=0;else{var s=i.length,r=new Array(s);if(t.GetTextExtentExPointVertical(e,i,e.textHeight("H"),r),0===r.length||n>r[s-1])o=s;else for(var a=1;a<=s;){if(t.UNPLACEHOLDERCHAR&&(a=t.GetTextActualOffset(i,a,!0)),n===vCharWArr[a-1]){o=a;break}if(!(n>vCharWArr[a-1])){o=t.UNPLACEHOLDERCHAR&&x>t.GetCharHalfFarfromUN(i,a,vCharWArr)||!t.UNPLACEHOLDERCHAR&&t.GetCharHalfFarfrom(a,vCharWArr)?a:t.UNPLACEHOLDERCHAR?t.GetTextActualOffset(i,a)-1:a-1;break}a++}}return o}}],[{key:"IsKeyPressWant",value:function(e){return t.UNPLACEHOLDERCHAR?e.keyCode>=32&&e.keyCode<=126||e.keyCode>=3840&&e.keyCode<=4095||e.keyCode>=6144&&e.keyCode<=6319:e.keyCode>=32&&e.keyCode<=126}},{key:"IsKeyDownWant",value:function(t){return t==Ee||t==Xe||t==Je||t==Ye||t==je||t==Qe||t==Le||t==Ke||t==ze||t==Me}},{key:"IsKeyDownEdit",value:function(t){return t==Ee||t==Xe||t==Le||t==Me}},{key:"IsDirectionKey",value:function(t){return t==Je||t==je||t==Ye||t==Qe}},{key:"PosCharHC",value:function(t,e){for(var i=0,n=1;n<=e.length;n++)if(t==e[n-1])return i=n;return i}},{key:"IsUnPlaceHolderChar",value:function(e){return t.UnPlaceholderChar.indexOf(e)>=0}},{key:"GetTextActualOffset",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=i,s=e.length;if(n)for(;o<s&&t.UnPlaceholderChar.indexOf(e[o+1-1])>=0;)o++;else for(;o>1&&t.UnPlaceholderChar.indexOf(e[o-1])>=0;)o--;return o}},{key:"GetCharHalfFarfromUN",value:function(e,i,n){var o=t.GetTextActualOffset(e,i,!0),s=t.GetTextActualOffset(e,i)-1;return s>0?o==s?s>1?n[s-2]+Math.trunc((n[o-1]-n[s-2])/2):Math.trunc(n[s-1]/2):n[s-1]+Math.trunc((n[o-1]-n[s-1])/2):Math.trunc(n[o-1]/2)}},{key:"GetCharHalfFarfrom",value:function(t,e){var i=0;return t>1?i=e[t-2]+Math.trunc((e[t-1]-e[t-2])/2):1==t&&(i=Math.trunc(e[t-1]/2)),i}},{key:"GetNorAlignCharOffsetAtHorizontal",value:function(e,i,n){var o;if(n<0)o=0;else{var s=i.length,r=e.getTextExtentExPoint(i,s);if(0===r.length||n>r[r.length-1])o=s;else for(var a=1;a<=s;){if(t.UNPLACEHOLDERCHAR&&(a=t.GetTextActualOffset(i,a,!0)),n===r[a-1]){o=a;break}if(!(n>r[a-1])){o=t.UNPLACEHOLDERCHAR&&n>t.GetCharHalfFarfromUN(i,a,r)||!t.UNPLACEHOLDERCHAR&&t.GetCharHalfFarfrom(a,r)?a:t.UNPLACEHOLDERCHAR?t.GetTextActualOffset(i,a)-1:a-1;break}a++}}return o}},{key:"GetNorAlignCharOffsetAt",value:function(e,i,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:$l.Horizontal;return o===$l.Horizontal?t.GetNorAlignCharOffsetAtHorizontal(e,i,n):t.GetNorAlignCharOffsetAtVertical(e,i,n)}},{key:"GetPaperSizeInfo",value:function(e){var i;switch(e){case hh.A3:i='{"Name":"A3", "Width":297, "Height":420}';break;case hh.A4:i='{"Name":"A4", "Width":210, "Height":297}';break;case hh.A5:i='{"Name":"A5", "Width":148, "Height":210}';break;case hh.B5:i='{"Name":"B5", "Width":182, "Height":257}';break;case t.DMPAPER_HC_16K:i='{"Name":"16K", "Width":195, "Height":271}';break;default:i='{"Name":"自定义", "Width":210, "Height":297}'}return JSON.parse(i)}},{key:"GetPaperSizeName",value:function(e){return t.GetPaperSizeInfo(e).Name}},{key:"GetPaperSizeByName",value:function(e){switch(e){case"A3":return hh.A3;case"A4":return hh.A4;case"A5":return hh.A5;case"B5":return hh.B5;case"16K":return t.DMPAPER_HC_16K;default:return hh.Custom}}},{key:"GetVersionAsInteger",value:function(t){return t.replace(/[^0-9]/gi,"")}},{key:"HCSaveTextToStream",value:function(e,i){var n=J.getBytes(i),o=n.length;if(o>Y.max)throw t.HCS_EXCEPTION_TEXTOVER;e.writeUInt16(o),o>0&&e.writeBuffer(n)}},{key:"HCLoadTextFromStream",value:function(t,e){var i=t.readUInt16();if(i>0){var n=t.readBuffer(i);return J.getString(n)}return""}},{key:"GetPropertyString",value:function(e){for(var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"=",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.sLineBreak,s="",r=0;r<e.count;r++)""!=(i=e[r]).key&&""!=i.val&&(s+=i.key+n+i.val+o);return s}},{key:"GetPropertyJSONString",value:function(t){for(var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n="",o=0;o<t.count;o++)if(""!==(e=t[o]).key){if(i.indexOf(e.key)>=0)continue;if(""!==n&&(n+=","),e.val.length>0)if("{"===e.val[0])try{JSON.parse(e.val),n+='"'+e.key+'":'+e.val;continue}catch(t){}else{if("["===e.val[0]){n+='"'+e.key+'":'+JSON.stringify(e.val);continue}if("true"===e.val){n+='"'+e.key+'":'+e.val;continue}if("false"===e.val){n+='"'+e.key+'":'+e.val;continue}if(L.isNumberStrict(e.val)){n+='"'+e.key+'":'+e.val;continue}}n+=JSON.stringify(e.key)+":"+JSON.stringify(e.val)}return n}},{key:"ConvertToJSONValue",value:function(t){return t.replace(/(\r\n)/g,"\\r\\n").replace(/(\")/g,'\\"')}},{key:"GetPropertyJSON",value:function(e){return JSON.parse("{"+t.GetPropertyJSONString(e)+"}")}},{key:"SetPropertyJSON",value:function(t,e){for(var i in t.clear(),e)""==i&&""==e[i]||t.add(i,e[i])}},{key:"SetPropertyString",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"=",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.sLineBreak;if(i.clear(),""!=e){e.indexOf(t.RecordSeparator)>=0&&(n=t.RecordSeparator,o=t.UnitSeparator);for(var s,r=e.split(o),a=0;a<r.length;a++)if(""!=r[a]){if(2!==(s=r[a].split(n)).length){console.log("%cHCL警告：不正确的属性(SetPropertyString)","color:#ff6600;",s);continue}""!=s[0]&&("="===n?i.add(s[0].replace(new RegExp("\r","g"),""),s[1].replace(new RegExp("\r","g"),"")):i.add(s[0],s[1]))}}}},{key:"SetItemPropertyString",value:function(e,i){if(""!=e)for(var n,o=e.split(t.sLineBreak),s=0;s<o.length;s++)"Text"!=o[s]?""!=o[s].trim()&&""!=(n=o[s].split("="))[0]&&i.SetValue(n[0],n[1]):console.log("不支持Text属性")}},{key:"SetItemPropertyJSON",value:function(t,e){for(var i in t)"Text"!=i?""==i&&""==t[i]||e.SetValue(i,t[i]):console.log("不支持Text属性")}},{key:"HCGetProperty",value:function(t,e){var i=t.valueByKey(e);return null!==i?i:""}},{key:"HCSetProperty",value:function(t,e,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(null!=i&&null!=e&&""!==e){if(i=i.toString(),n&&i.indexOf("=")>=0)throw"HCSetProperty属性值中不允许有=号";""!==i?t.setValue(e,i):t.remove(e)}}},{key:"HCRemoveProperty",value:function(t,e){t.remove(e)}},{key:"_SaveFileFormatAndVersion",value:function(e){var i=J.getBytes(t.HC_EXT);e.writeBuffer(i),i=J.getBytes(t.HC_FileVersion),e.writeBuffer(i),e.writeByte(t.HC_PROGRAMLANGUAGE)}},{key:"_LoadFileFormatAndVersion",value:function(e){var i=e.readBuffer(J.getByteCount(this.HC_EXT)),n=J.getString(i,0,i.length);i=e.readBuffer(J.getByteCount(this.HC_FileVersion));var o=J.getString(i,0,i.length),s=t.GetVersionAsInteger(o),r=0;return s>19&&(r=e.readByte()),{fileExt:n,fileVersion:s,lang:r}}},{key:"HCSaveColorToStream",value:function(t,e,i){var n=t.colorToRGBA(i);e.writeByte(n.a),e.writeByte(n.r),e.writeByte(n.g),e.writeByte(n.b)}},{key:"HCLoadColorFromStream",value:function(t){var e=t.readByte();return"rgba("+t.readByte()+", "+t.readByte()+", "+t.readByte()+", "+e+")"}},{key:"HCColorToHtml",value:function(t,e){var i=t.colorToRGBA(e),n=i.r.toString(16);1===n.length&&(n="0"+n);var o=i.g.toString(16);1===o.length&&(o="0"+o);var s=i.b.toString(16);return 1===s.length&&(s="0"+s),L.stringFormat("#{0}{1}{2}",n,o,s)}},{key:"HCRGBStringToColor",value:function(e,i){var n=i.split(",");return n.length>3?"0"==n[0]?t.HCTransparentColor:e.rgbaToColor(n[1],n[2],n[3]):e.rgbaToColor(n[0],n[1],n[2])}},{key:"HCColorToRGBString",value:function(e,i){if(i==t.HCTransparentColor)return"0,255,255,255";var n=e.colorToRGBA(i);return L.stringFormat("255,{0},{1},{2}",n.r,n.g,n.b)}},{key:"HCSaveImageToStream",value:function(t,e){if(e&&""!=e.src){var i=e.src.split(","),n=U.fromBase64(i[1]);t.writeUInt32(n.length),n.length>0&&t.writeBuffer(n)}else t.writeUInt32(0)}},{key:"HCLoadImageFromStream",value:function(t,e){var i=null,n=e.readUInt32();if(n>0){var o=e.readBuffer(n);(i=new Wi(t)).src="data:image/png;base64,"+U.fromBuffer(o).toBase64()}return i}},{key:"GetXmlRN",value:function(t){return t.replace(new RegExp("\n","g"),"\r\n")}},{key:"SetBorderSideByPro",value:function(t,e){}},{key:"GetBorderSidePro",value:function(t){}},{key:"GraphicToBase64",value:function(t,e){}},{key:"Base64ToGraphic",value:function(t){}},{key:"HCDeleteBreak",value:function(t){return t.replace(new RegExp(this.sLineBreak,"g"),"")}},{key:"ReplaceUnPreChar",value:function(t){return t.replace(/\u2002/g," ").replace(/\u2003/g," ").replace(/\u0009/g,"")}},{key:"LineCountWithWidth",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=i.getTextExtentExPoint(t),s=0,r=0,a=1,l=o.length;if(o[l-1]>e){for(var h=l-1;h>0;h--)o[h]=o[h]-o[h-1];for(var c=0;c<l;c++)r+o[c]>e?(s==c?(r=0,null!==n&&n.add(t.substr(s,1))):(r=o[c],null!==n&&n.add(t.substr(s,c-s))),s=c,a++):r+=o[c];null!==n&&s<l&&n.add(t.substr(s,l-s))}else null!==n&&n.add(t);return a}},{key:"HCDrawArrow",value:function(t,e,i,n,o){switch(o){case 0:t.pen.color=e,t.beginPath();try{t.moveTo(i,n),t.lineTo(i+1,n),t.moveTo(i-1,n+1),t.lineTo(i+2,n+1),t.moveTo(i-2,n+2),t.lineTo(i+3,n+2),t.moveTo(i-3,n+3),t.lineTo(i+4,n+3),t.moveTo(i-4,n+4),t.lineTo(i+5,n+4)}finally{t.paintPath()}break;case 1:t.pen.color=e,t.beginPath();try{t.moveTo(i,n),t.lineTo(i+1,n),t.moveTo(i-1,n-1),t.lineTo(i+2,n-1),t.moveTo(i-2,n-2),t.lineTo(i+3,n-2),t.moveTo(i-3,n-3),t.lineTo(i+4,n-3),t.moveTo(i-4,n-4),t.lineTo(i+5,n-4)}finally{t.paintPath()}}}},{key:"HCDrawWave",value:function(e,i){t.HCDrawWaveBy(e,i.left,i.bottom,i.right)}},{key:"HCDrawWaveBy",value:function(t,e,i,n){var o=!1,s=e;for(t.beginPath(),t.moveTo(s,i);s<n;)(s+=2)>n&&(s=n),o?(t.lineTo(s,i),t.lineTo(s+1,i),s+=1):(t.lineTo(s,i+2),t.lineTo(s+2,i+2),s+=2),o=!o;t.paintPath()}},{key:"HCDrawScriptMark",value:function(e,i,n){e.pen.width=1,e.pen.color=t.ScriptMarkColor,e.pen.style=_t.Solid,e.beginPath();try{e.moveTo(i+5,n),e.lineTo(i,n),e.moveTo(i+4,n+1),e.lineTo(i,n+1),e.moveTo(i+3,n+2),e.lineTo(i,n+2),e.moveTo(i+2,n+3),e.lineTo(i,n+3),e.moveTo(i+1,n+4),e.lineTo(i,n+4),e.moveTo(i,n+5),e.lineTo(i,n+5)}finally{e.paintPath()}}},{key:"HCReplaceInvalidChar",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\r\n";return t.replace(/(\r(?!\n))|((?<!\r)\n)/g,e)}},{key:"HCBackDeleteChar",value:function(t,e){return e>0&&(t=L.stringDelete(t,e-1,1),e--),{text:t,offset:e}}},{key:"HCDeleteChar",value:function(t,e){return e<t.length&&(t=L.stringDelete(t,e+1-1,1)),{text:t,offset:e}}}]),t}();Yl.TableCellData=Jl,Yl.AnnotationWidth=200,Yl.HCExtFormat=0,Yl.OffsetBefor=0,Yl.OffsetInner=1,Yl.OffsetAfter=2,Yl.MinRowHeight=10,Yl.MinColWidth=10,Yl.clNone="rgba(255, 255, 255, 31)",Yl.clActiveBorder="rgb(180, 180, 180)",Yl.clBtnFace="rgb(240, 240, 240)",Yl.clMedGray="rgb(160, 160, 164)",Yl.clMenu="rgb(240, 240, 240)",Yl.clWindow="rgb(255, 255, 255)",Yl.clHighlight="rgb(51, 153, 255)",Yl.clInfoBk="rgb(255, 255, 225)",Yl.HyperTextColor="rgb(5, 99, 193)",Yl.HCTransparentColor="rgba(255, 255, 255, 0)",Yl.ScriptMarkColor="#008000",Yl.HCFormatVersion=4,Yl.HC_TEXTMAXSIZE=4294967295,Yl.HC_PROGRAMLANGUAGE=4,Yl.TabCharWidth=28,Yl.DefaultColWidth=50,Yl.PMSLineHeight=24,Yl.AnnotationWidth=300,Yl.DMPAPER_HC_16K=-1e3,Yl.ROMANUMBER=["Ⅰ","Ⅱ","Ⅲ","Ⅳ","Ⅴ","Ⅵ","Ⅶ","Ⅷ","Ⅸ","Ⅹ","Ⅺ","Ⅻ"],Yl.CIRCLENUMBER=["①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩","⑪","⑫","⑬","⑭","⑮","⑯","⑰","⑱","⑲","⑳"],Yl.HC_EXCEPTION="HC异常：",Yl.HCS_EXCEPTION_NULLTEXT=Yl.HC_EXCEPTION+"文本Item的内容出现为空的情况！",Yl.HCS_EXCEPTION_TEXTOVER=Yl.HC_EXCEPTION+"TextItem的内容超出允许的最大字节数4294967295！",Yl.HCS_EXCEPTION_MEMORYLESS=Yl.HC_EXCEPTION+"复制时没有申请到足够的内存",Yl.HCS_EXCEPTION_VOIDSOURCECELL=Yl.HC_EXCEPTION+"源单元格无法再获取源单元格！",Yl.HCS_EXCEPTION_TIMERRESOURCEOUTOF=Yl.HC_EXCEPTION+"安装计时器的资源不足！",Yl.PROCSERIES=!0,Yl.UNPLACEHOLDERCHAR=!0,Yl.RESETTABLEUSEFIRSTROWHEIGHT=!0,Yl.TibetanVowel="ེོིུ",Yl.TibetanOther="ྸཾ༷༵ྃཿྷྺྕྖཻླྲྟྱྭྀཽྥྩྪྫྰྶྡྦྔྨ྄ྒྒྮྯྴྐྑྤྣྠྗྙྼྻཱ༙༾༿྇྆ྲྀཷླྀཹཱིྚཱཱིུྜ࿆ྵྐྵྂྞྛ",Yl.UnPlaceholderChar=Yl.TibetanVowel+Yl.TibetanOther,Yl.DontLineFirstChar='`-=[]\\;,./~!@#$%^&*()_+{}|:""<>?·－＝【】＼；’，。、～！＠＃￥％……＆×（）——＋｛｝｜：”《》？°་༌།'+Yl.UnPlaceholderChar,Yl.DontLineLastCharLessV3="/\\＼“‘",Yl.LineSqueezeCharLessV3="，。；、？“”",Yl.DontLineLastCharV3="/\\＼“\"‘'",Yl.LineSqueezeCharV3="，。；、？”’",Yl.SQUEEZEWIDTH=3,Yl.sLineBreak="\r\n",Yl.RecordSeparator="",Yl.UnitSeparator="",Yl.HC_EXT=".hcf",Yl.HC_EXT_RECTPART=".hcrpf",Yl.HC_EXT_DOCX=".docx",Yl.HC_STREAM_VIEW=0,Yl.HC_STREAM_LITE=1,Yl.HC_STREAM_ITEM=2,Yl.HC_STREAM_GRID=3,Yl.HC_FileVersion="6.8",Yl.HC_FileVersionInt=68,Yl.HCExtFormat=0,Yl.JAVASCRIPT="JavaScript",Yl.SQL="SQL";var Ql={Portrait:0,Landscape:1},Xl={None:0,Left:1,Top:2,Right:3,Bottom:4},Zl={Left:1,Top:2,Right:4,Bottom:8,LTRB:16,RTLB:32},ql={Header:1,Page:2,Footer:4},$l={Horizontal:0,VerticalLeftToRight:1,VerticalRightToLeft:2},th={TopBottom:0,LeftRight:1},eh={None:0,Prev:1},ih={TopLeft:0,TopCenter:1,TopRight:2,CenterLeft:3,CenterCenter:4,CenterRight:5,BottomLeft:6,BottomCenter:7,BottomRight:8},nh={Tile:0,Stretch:1,LeftTop:2,CenterCenter:3},oh={Loading:0,Saving:1,Cutting:2,Copying:3,Pasting:4,Clearing:5,DomainWholeReplace:6,Undoing:7,Redoing:8,InsertBreakItem:9,BatchInsert:10,Destroying:11,FormatBrushing:12,MoveItem:13,UserInteraction:14,ProcessAnnotate:15},sh={Break:0,HZ:1,ZM:2,SZ:3,FH:4,ZW:5},rh={BackDeleteText:0,DeleteText:1,ReturnItem:2,InsertText:3,SetItemText:4,DeleteItem:5,InsertItem:6,ItemProperty:7,ItemSelf:8,ItemMirror:9,ConcatText:10,DeleteSelected:11,DeleteDrag:12,ContentChange:13},ah={Symbol:0,OrderCustom:1,OrderRoman:2,OrderCustomCircle:3},lh={Custom:0,Table:1},hh={Custom:0,Letter:1,LetterSmall:2,Tabloid:3,Ledger:4,Legal:5,Statement:6,Executive:7,A3:8,A4:9,A4Small:10,A5:11,B4:12,B5:13,Folio:14,Quarto:15,Standard10x14:16,Standard11x17:17,Note:18,Number9Envelope:19,Number10Envelope:20,Number11Envelope:21,Number12Envelope:22,Number14Envelope:23,CSheet:24,DSheet:25,ESheet:26,DLEnvelope:27,C5Envelope:28,C3Envelope:29,C4Envelope:30,C6Envelope:31,C65Envelope:32,B4Envelope:33,B5Envelope:34,B6Envelope:35,ItalyEnvelope:36,MonarchEnvelope:37,PersonalEnvelope:38,USStandardFanfold:39,GermanStandardFanfold:40,GermanLegalFanfold:41,JapanesePostcard:43,Standard9x11:44,Standard10x11:45,Standard15x11:46,InviteEnvelope:47,LetterExtra:50,LegalExtra:51,TabloidExtra:52,A4Extra:53,LetterTransverse:54,A4Transverse:55,LetterExtraTransverse:56,APlus:57,BPlus:58,LetterPlus:59,A4Plus:60,A5Transverse:61,B5Transverse:62,A3Extra:63,A5Extra:64,B5Extra:65,A2:66,A3Transverse:67,A3ExtraTransverse:68,JapaneseDoublePostcard:69,A6:70,JapaneseEnvelopeKakuNumber2:71,JapaneseEnvelopeKakuNumber3:72,JapaneseEnvelopeChouNumber3:73,JapaneseEnvelopeChouNumber4:74,LetterRotated:75,A3Rotated:76,A4Rotated:77,A5Rotated:78,B4JisRotated:79,B5JisRotated:80,JapanesePostcardRotated:81,JapaneseDoublePostcardRotated:82,A6Rotated:83,JapaneseEnvelopeKakuNumber2Rotated:84,JapaneseEnvelopeKakuNumber3Rotated:85,JapaneseEnvelopeChouNumber3Rotated:86,JapaneseEnvelopeChouNumber4Rotated:87,B6Jis:88,B6JisRotated:89,Standard12x11:90,JapaneseEnvelopeYouNumber4:91,JapaneseEnvelopeYouNumber4Rotated:92,Prc16K:93,Prc32K:94,Prc32KBig:95,PrcEnvelopeNumber1:96,PrcEnvelopeNumber2:97,PrcEnvelopeNumber3:98,PrcEnvelopeNumber4:99,PrcEnvelopeNumber5:100,PrcEnvelopeNumber6:101,PrcEnvelopeNumber7:102,PrcEnvelopeNumber8:103,PrcEnvelopeNumber9:104,PrcEnvelopeNumber10:105,Prc16KRotated:106,Prc32KRotated:107,Prc32KBigRotated:108,PrcEnvelopeNumber1Rotated:109,PrcEnvelopeNumber2Rotated:110,PrcEnvelopeNumber3Rotated:111,PrcEnvelopeNumber4Rotated:112,PrcEnvelopeNumber5Rotated:113,PrcEnvelopeNumber6Rotated:114,PrcEnvelopeNumber7Rotated:115,PrcEnvelopeNumber8Rotated:116,PrcEnvelopeNumber9Rotated:117,PrcEnvelopeNumber10Rotated:118},ch={Beg:0,End:1},uh=function(t){m()(i,t);var e=jl(i);function i(){return r()(this,i),e.call(this)}return l()(i)}(q),fh=function(){function t(){r()(this,t),this.Init()}return l()(t,[{key:"Init",value:function(){this.X=0,this.Y=0,this.Width=2,this.Height=20,this.PageIndex=-1,this.Visible=!0,this.Landscape=!1}}]),t}(),dh=function(t){m()(i,t);var e=jl(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t)).FReCreate=!1,o.FDisFocus=!1,o.VScroll=!1,o.HScroll=!1,o.control=n,o.FWidth=0,o.FHeight=0,o.FX=0,o.FY=0,o.Visible=!1,o}return l()(i,[{key:"setX_",value:function(t){this.FX!=t&&(this.FX=t,this.Show())}},{key:"setY_",value:function(t){this.FY!=t&&(this.FY=t,this.Show())}},{key:"setHeight_",value:function(t){this.FHeight!=t&&(this.FHeight=t,this.FReCreate=!0)}},{key:"setWidth_",value:function(t){this.FWidth!=t&&(this.FWidth=t,this.FReCreate=!0)}},{key:"ReCreate",value:function(){this.hcl.application.destroyCaret(this.control),this.hcl.application.createCaret(this.control,null,this.FWidth,this.FHeight)}},{key:"ShowAt",value:function(t,e){this.FDisFocus=!1,this.FReCreate&&this.ReCreate(),this.Visible=!0,this.hcl.ime.updatePosition(t,e),this.hcl.application.setCaretPos(t,e),this.hcl.application.showCaret(this.control)}},{key:"Show",value:function(){this.ShowAt(this.FX,this.FY)}},{key:"Hide",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.FDisFocus=t,this.Visible=!1,this.hcl.application.hideCaret(this.control)}},{key:"Height",get:function(){return this.FHeight},set:function(t){this.setHeight_(t)}},{key:"Width",get:function(){return this.FWidth},set:function(t){this.setWidth_(t)}},{key:"X",get:function(){return this.FX},set:function(t){this.setX_(t)}},{key:"Y",get:function(){return this.FY},set:function(t){this.setY_(t)}},{key:"DisFocus",get:function(){return this.FDisFocus}}]),i}(tt),mh=function(){function t(){r()(this,t)}return l()(t,null,[{key:"IsEmrExpressItem",value:function(e){switch(e){case oo.Fraction:case oo.Fraction2:return!0;default:return e>=t.EMRSTYLE_PAMERTOOTH&&e<=t.EMRSTYLE_TOOTH}}}]),t}();mh.EMRSTYLE_TOOTH=-1001,mh.EMRSTYLE_FANGJIAO=-1002,mh.EMRSTYLE_YUEJING=-1003,mh.EMRSTYLE_CHINESEMED=-1005,mh.EMRSTYLE_GESTATIONWEEK=-1006,mh.EMRSTYLE_PUPIL=-1007,mh.EMRSTYLE_LIGHTPERCEPTION=-1008,mh.EMRSTYLE_FETALHEART=-1009,mh.EMRSTYLE_PAMERTOOTH=-1010;var Sh=function(){function t(e){r()(this,t),this.hcl=e,this.ServerURL="http://127.0.0.1:12860/",this.Version="",this.resURL="",this.ToHtmlUseTrace=!1,this.G_SaveTrace=!0,this.MultItemOrdSpliter="、",this.MultItemSpliter="；",this.MultipleSingleBtn=!1,this.CustomBtn=!1,this.CheckBoxValue=!1}return l()(t,[{key:"ResIcon",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAZ0lEQVR42mNkoBAwMsjF/gezHi1mhItiE0MWhwGgPPEGoGsmyQBcLkLxAjZAXwMo9gJNAxGXIWADKAQQF4BswkYjByZMHNk1cC/gMgCLBtIMQI8JLOpIdwGGAejOwxUG2AwBByKFAABR+58RTKKfkwAAAABJRU5ErkJggg==":this.hcl.homePath+"image/hcview.png"}},{key:"ResBold",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA1UlEQVR42t2SIRLCMBBFNy5yJbISGYmMROYKvQFHKjeIxDUSR46QusrF1ZWfZoojhcEwZGZF/m7e/t2Joi+P+i0A73h+UXdHnBBeRpEawLDmmzGGwjUQihU0y8w9dEpjaqF11RFQPLujI3/xJCJqdWYPlkIIA7RmG+AA8AWAuwWgOEhwIO84ACDGmB/k7nmUnDrnPQAgdYDmGZDcnWSCA82WNPVLcqIWWrcNaABIBfDUipMBWmUHmiyKe7NvKGAEdFSrtuxAUgut6mDzHyDqO/j0/AHgAULGbhFfHun7AAAAAElFTkSuQmCC":this.hcl.homePath+"image/bold.png"}},{key:"ResItalic",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAi0lEQVR42mNkoBAwDm4DDAwM/qOLXbhwgZFoAxwcHBSA1H0oV/HAgQMPSHJBgEdAAJBaD8SBG3Zs2ECyFxIiEsBeWLBiAU51OCUSEhJgticuAAKSDVCQUADb/uDFA7yuZMShGWZ7IdCACSQZANSswIAIeUOgAReINkBBQeE/NkUPHjwgPRCJBcPAAAA6qCkRorpAvAAAAABJRU5ErkJggg==":this.hcl.homePath+"image/italic.png"}},{key:"ResUnderline",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAo0lEQVR42mNkoBAwDi4DBCQE/iPzP7z4wIhNDKcBDkAgICCwH6zwwwfHA0CATQyvFwI8AsA2btixgRGfGG4DAqCKNyAZgEUMtwERUMUrkAzAIobTAKB//0P9y4hPDLcBHFDFP5AMwCKGz4ADDBwM9gw/GByBGg4A+Q5A/n4g/yKQb0DQAKBiBSDZAMTxSKILwWI/GB4QNoBEgG7Af1L1DHxmAgD8/VERaYWXDgAAAABJRU5ErkJggg==":this.hcl.homePath+"image/underline.png"}},{key:"ResStrikeout",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAnElEQVR42mNkoBAwDi4DBCQE/iPzP7z4wIhNDKcBDkAgICCwH6zwwwfHA0CATQyvFwI8AsA2btixgRGfGG4DAqCKNyAZgEUMmwH/GYgHjNgMgASkACTQgP5lxCeG2wAOqOIfSAZgEcNnwAEGDgZ7hh8MjkANB4B8ByB/P5B/Ecg3IGgAULECkGwA4ngk0YVgsR8MDwgbQCIYBgYAAEKkSRGqwEIIAAAAAElFTkSuQmCC":this.hcl.homePath+"image/strikeout.png"}},{key:"ResSave",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABj0lEQVR42qWTLXuDMBSFT10dyDmQOJCT/IT8BGRdcZsrbnONW92Qc0NWZg6ZusrUVQbHFLv5gLI+D6oRkATum3vOvVnhwbEyj+aoB7vq/S69tZn32r3v9/ya82zlAI0ewjCAlMB2u3xa9wsUxQ9Ch0D9xe4AbYftS7AYjL4DKyS0qhEnDM0IqL/0ED8FEOKC3S5aDDYS2EaAJRnkWdDBhQfUBIgD8uKC/Vu0GKwp86IUyJMYSskZ4KCGOIlo44T9Pl0M1mSgA2TQ1xmAczVkWURSTvj8SBeDjfOsNBJiBziWHvDuAMbbhiC2UL5st7krqQ22UAkxAqrKAcywp+luqvkYPIe4/lAzwKskQOrJHURb/S/DGgjXVH2d35qrpwxE5QClASTpdLKUFUnhyPKcDG4sgB84lMx8VxqxagYoHUARwHyUZ/qZTMqfGcpN4QE1BYTUhbBehUZCOwI2kspI5pABdUv9fOVkrJNhUrcAWivNpnsRgiS0fAIwUvZtAC49TKnq2Xy6bK421Poe8Mj4A/8QJyB9fiLAAAAAAElFTkSuQmCC":this.hcl.homePath+"image/save.png"}},{key:"ResSavedis",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB0UlEQVR42qWTP8hxURzHv0/KQMqojDZC8Q6y2ozGdzGy0buYFIOykAwySamTiIGUyCSlpJRFSkmZpEjkT/Te37nPPR7DnZ5T5/7O757z/Zxf53vOF37ZvugzHo8ZxefzCSVer1fRqb1eL5Hf73eeR6PRvxwwGo2Y0WjEer2G3+9X3Y3EyWRS5Ol0+hOwWCwQCARUxbfbDYlEArPZDC6XC9lsVgYMBgNmMpkwmUwQDAZVxRTj8Tg8Hg+m0ykKhYIM6PV6zGw2YzgcIhQKqYrP5zNSqRQcDgeWy+Ub0Gq1mMViQb/fRyQSURWfTicOcLvd2Gw2b0CtVmM2mw3tdhuxWExVTO7QGSiAUqkkA6rVKrNarXg8Huh2u1yg2EZjEhKAchJT3G63qFQqMqBcLnMANRIcj0fhuSL+CaG+3+/fgGKxyJxOJ58gcaPR+DhIjUYDg8EAvV7/AajX6zIgn88zu90udu50OkSH1+vlkQDSGlwuF3E+VKkA5HI5DtjtdnxSuhdYrVbw+XwIh8McIFXJrdNqtfwq07pmsykDMpkMt/FwOHDxfD6na8p3o9IJQLlOpxPvgiqQXBOAP9KPfwRQHo9SKjmjjJXHRv++HZMBv2n/ATG8eSAIi2UkAAAAAElFTkSuQmCC":this.hcl.homePath+"image/savedis.png"}},{key:"ResFile",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABOElEQVR42qWTIXaEMBCGB7eOPQJH4AjpCYrELb0BciV1lZGVkZWRKyPXNXLlSOSsw9FMMrC0S7evD94LmUz4vz+ZhAw2PtlmgD+1JVLxuTL3VNWt+xNgP/SoVAH5LiWu/CIEx9IdvVZ11z0GGD2uTRC/hjm6nyd6aY/aRMBzVa7JA4BSPEgc2lVibQG6oM9MABwigOYt5EAiEBgFofScQ/RgL0oA7914qNW6K0yuMg4ACvXBHsF6BdrYG4Ad8uVyV8Q8ptAQEcxZgbEM0AHQlDf3b+JFbgHwSGBcCda5BKjqMrnPe/8hFgBJzvehiKcC3NlnmX7rxqZhAD4Wg9QgAvbxFPwFGdCOTVgBkAfqGYJxzzRMjmn10/HSsI95bbkWlAD8QRSQtF766P77LUQKgP/+PHdXeSvgCzutCiAfJ43DAAAAAElFTkSuQmCC":this.hcl.homePath+"image/file.png"}},{key:"ResPrint",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABc0lEQVR42p2TLVTDMBCAr24yEjmJrERG4jg516DALTjcOjdH6iYjJ1M3WTkZHLjihgtuU+WS7Od1ZHt7nMhLLpfvfpNBQkpluqReYnaqy84BJuOHnu7xZQpalf8EbAnwegUAEUsYwCS/E3AAbHcREMCtLYCDyiyNPAfQw5thwW55EsDoddu2tTEGDwA6eNqbP9Dl33w2x63brWzA4m7jppme6654KoKiqirAe4RLoo0GKWMGUpaQKaU68SyCJ4oG8jy/CGhWDYhRtJflDsA5j4CGAMM+wMCxGziowa4scIz2emEIMFOd98oYSwKoKz3ZA9zagVk2EbC/bNeJIiaEOkUFjPYhBe+dKgpGm2CQI4IUCHbDDl0wcwUt5e8l1CzUw0aAD9O3hjoSLvjID1IB799+Kr9ACNYD4Ch2yn5QBPRIOefG/uB8CgTLOQZA/flzLCYBXGtDRIxSiE6hPvMXdOcBp5N49WeSM91RVOTN9YcoAfgFp+7HmnPQVM0AAAAASUVORK5CYII=":this.hcl.homePath+"image/print.png"}},{key:"ResUndo",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABfElEQVR42qWSoXICMRCGF4dj5bmuxDVvQOqQ1zeIxJU65OGQeYOeRKaujvQNInFdHK577hzdHAMDzJTSYWeSSTbZb//dpAd3Wu/aof8QBy047ANBH1hdCdVdWuQ/AdVSIoiMBKBRSDZBBFSYTmjceA85Atwi7qjAp8qZ6BYpqmskLTSylYHGQl5jYcAO9aQVqSaGjgAfGFPibyxwIwJBs7ywphbd5OzSyqdmJ3U8IFkwJBtNRBcK0g76qlGHBjeyjoNON8BrqktfVoF4LQnJgCmQ/VQXp4CyUgDkIvMAiMv6HQryGhwPd+wk5iSNGSpgcgmYpR23qjNrLTrZea09wXMAUqPikwLsGcBOs4KuQV1w1/mWIYVpd8e4QFreFxakZcq8npnq6jOGKKjvLYc9jb0lU65Iy6tndIy7+pFOTeXnBj6CpHlY2OpmgPNCzGwR6Q2Em+AN3vyV981lq8+yki2DbNNzWrrwL4AqcLxlEmaflqVcnt/cg9/sbsAPRX+2EV4/gXgAAAAASUVORK5CYII=":this.hcl.homePath+"image/undo.png"}},{key:"ResUndoDis",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABv0lEQVR42qVSz4sBURx/iEQxEcnBvhxc18kR+x9YV6U5ysG2N6U0blJqcpCTdXKUVY4ye3VyUW77OEgOdkaRFLPf74Z2ttbavJrmve9738+P7/erIzcu3aXLXq/H7/d73mw2U4PBwCA0NBqNYigUYn8CdDodabPZRHa7nXI4HDAkWywWDsAIx3HBcDjMNADlcln1eDwPiURCqlQqEoQi2+1WWS6XdgAhuPf5fMTv9+NeTiaT9AzQ7Xa50Wj04XQ6J+v1ug0sT7IsE/yQfbVavVmtVgp3d4FAgLhcrgkQUY0CYFVRns1mw0RlPB7bMQ7sz9VqVRQEgU6n0yGllIASxvN8UANQKpVUk8mE/gh4Ja1W69XhcIiQLJ3eZLNZJFHABgMLWoBisaiCN5RHwArKJm63+yEWi2kAgEDxer1DAIhqAECiin8EweSjd9JsNr/epNNpCvbeodBEr9cXMpmMcLGNg8GAg37Lp3M8Ho/CuY8WU6nUOe/iIH1fIB8LeL9YLAr5fF64GqDRaFDGWBRq84LdyeVy3NWjfBywKMxAfz6fE2jjY71eb/8LABTwkEhns5lYq9Xkn/dX1+C3dTPAJ9IVzxHJFZU+AAAAAElFTkSuQmCC":this.hcl.homePath+"image/undodis.png"}},{key:"ResRedo",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABbElEQVR42qWSrXbDMAyFFVYWlY3Vj2BYaDg2P0LKyupHyFhhYGHgoGGh4VgFC1UWNpWFbXJ62vUsZz9dBRL52PezruQC7ozinMQkRn9BACz0YKSHWgRiXaH8CshiFiEVgAoHAU4wJ4gKVUj7I6CJzCrERAroSMVQwgSPxtic56iaJcY2iW0j71JjixEg7XHGFAEf8KCVMGQrAKW1Lh85KjrgRGoimVXeTqvHk7UBEFpJtBerALFz42Lt2VYxQC+19qM0c39Ucak5cCcwquAKQLwN7rypEAcdB+f9k/TaEzlZTBv3BbDhxB1Yfo1C22DOm40WpLfuqINBrI0G7HkMqGpqdGvFe8o3TDnVgz8X6F1tDAe1yfk75NT6UQWoc3iT3D2mhdq4jE1HjN59/xYuJBdSo2NfSccHevEG/hjF9cItY347pZb7bB4wxrWlmwDWt4hoCCYw0+VCm9XeBPi0QyE/5bg2zb8At8TdgA/d9cwRN81VnwAAAABJRU5ErkJggg==":this.hcl.homePath+"image/redo.png"}},{key:"ResRedoDis",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABp0lEQVR42qWSP6hBURzHz6Vk4V5J2dzJqDvJJLPlGY3XanFjkem+zWiSUSYZZGFgsShZ3FGUuEpKcQwk4r3vUVdet/fH86vT+Z17zu/z+57vuRx5MTgjGQwGIiblfD5Ll8tFPB6P6uFwaMRiMforgBWv12ttv98TFN4KnE4nOZ1Ogs1mUwAp/whoNpszFAqTyYTouk7sdjuPsfP7/SxnR+R4PN7o9XpSp9MZqqrKmQCLxcIHJcTtds+hZIbPEgYfDAbZkR3UKFarVUUTXzQadYXDYXoH1Gq17nQ6lQCggUAggg6zZDKpMB+u1ysfCoV2FouFR05WqxUxKXgAaPV6PWJsAhLZbDYKOr6xYuYRlJJ8Pv8VUKlUujgo9ft9Wq1WRWOz3W5LKByyrqwYRjOTzYACAlNqNBoxE12tVut2P0j9YAUs2AwfbnmxWDQpEJbL5ZZSSsbjcQLXuD8briXAyG//hTspl8sV8OYpyJ2XSiWR/DG4x0U6naaA8JD77vV6G9lsVnsKIMuy4PF4NLy3D8sEzCo/BTAC5ikOh4NkMpnCvwDPxMuAT7DU7BGQU7oMAAAAAElFTkSuQmCC":this.hcl.homePath+"image/redodis.png"}},{key:"ResSuperscript",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA30lEQVR42t2QIRLCMBBFNw4ZiYxE5giVyMUhlxOQI/QI1OHSG9AjRCIjkSsrV9aVtNMydIYpTJlBsG535r+8fAVfjvopAHNuoREQ4SKc0S0ywDyScPShJLXEAKWOl2SxS4BqAnDOtSICfONDuIayu9GeSBrxIYSkLQpdaKVmkIYhVvnUwFpLWmuvV7pbD7CCLtSH+x2gfFui2RiyxnpIjGQCMcbZ8MsOsm12klqOQ7jofjfXywSAiPSkPc5nBrhFYmEfr/3Lu+F8eQd5AMzatJwaHsLVyH2CqFnA0vkDwB2wVmoRsb6U1gAAAABJRU5ErkJggg==":this.hcl.homePath+"image/superscript.png"}},{key:"ResSubscript",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA4UlEQVR42u2RLRLCMBCFtw4ZiYxE5gjIysUhlxOQI/QI1OHSG9AjRCIjkSsrV9aVbYcOZYYpf5bnNsn78nY3gx+V/QF3gPe+ExHgC+/iOVb9GW2JpJUQYwS9y2YBzjkyxgSzMH25gwX0psE81ADVyxbsypKzLoAyNAmklGbNT2ewztcHaWR/M5d9d28PERFpEnvUewkwR2LhkM7Dz5vb8WkKwYI7aEVnw2U8on8A2KXtuOHRXI/cCWR4i0Ui4RRiRdnTGcxJE6A06aQpNgqoPwf42ImmlFY3VBefJ3i5hW90BYPxahG5VaChAAAAAElFTkSuQmCC":this.hcl.homePath+"image/subscript.png"}},{key:"ResFormatbrush",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABiUlEQVR42qWTr1IDMRDGvyrOdVHgiKwjEhmJbJ+g9wa0Dse9QSPrCK6OyDoiK4OrDK5ycYeCTfpnpp0WpkNmdjZ3l9+Xb5O9Dv45OucCdhoMWniJLnManCVgbaglPQMKaRllGk87cM71ieh1+5xWGIMxQaUQhU3LAFTx86iAd40B6TetNXjFoGtCCAHcCrygHQxwvScQfEM5SdyqnkZcAubOIKYERQQ3c5CpRCpwCN534sLpXB5aVtzyjb7T6HapCH58sOzMMMYI7KGVKiIEenHe1eUW0sJ9yxvcyEdcHNTyxXiPCd4zlHzPTmSjkvPmGwHrUGFI1wrdK9qBck345C0ghzpLRUTsy4FyXnUZ5p6LioiMuMVE9UREat2COTjHai3i5XSYCzwQ2O81Upg3jaQnpaTCau1gC0vDlOwEUT0zsFPrj3ain46cOBkak0vZh+1MrrOisQ/R/trKzo5sSvzQv8ef8FGBjYiLyzRUxFJ3OgmfFMijeaxH4qQRF8HPY//UurP/xsPxA1nH70DKWxl8AAAAAElFTkSuQmCC":this.hcl.homePath+"image/formatbrush.png"}},{key:"ResRightindent",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAq0lEQVR42mNkwA/+AzEjPgWMDBQCZAP+Y5H7T4oB5LsgoOHBhw8/GD4wcDAkHGhQOIDHVdgNSOj44PDhx4f9QEMYGH48mMjw48OEAzMCHhBlQEDHA4gioOYPDy4wfPjxAMy+sKGAKO+BFTkUbDBgePHhPNAVIO5DoFcKLqwo2IDHBYyoBiRsuAC0GaQbpPECEWHAiMGgKBZw2EbHdECECxiJMYBiF2ADtM+NANFzQw3SYtDGAAAAAElFTkSuQmCC":this.hcl.homePath+"image/rightindent.png"}},{key:"ResLeftindent",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAArElEQVR42mNkwA/+AzEjPgWMDBQCZAP+Y5H7T4oBlLkgoOOBAJBqYHjxwGDDBAcHHK7CNCCh4YMCgwBQ4w+G+A8/HjB8ePFA8cCMgAdEGwC0+T9QMwPDjw8gzUAaaAiQf2FDAVHeYwwoOKDw4ceHAqAB+R8+fGAQEBAwPLAg4QIBFzBiMBwyFggwfGBoAHrD4cKGBgOSDaA4FhgGPB0QcAEjMQZQ7AJsgPa5EQAeeUENZw5QkQAAAABJRU5ErkJggg==":this.hcl.homePath+"image/leftindent.png"}},{key:"ResLeft",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAI0lEQVR42mNkoBAwUsuA/+Tqp7sLGAkKjIbBaBhQ4oKBMwAArDsGETPBMRoAAAAASUVORK5CYII=":this.hcl.homePath+"image/left.png"}},{key:"ResCenter",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAJ0lEQVR42mNkoBAwUsuA/+Tqp5oLYIBYlzDiMmA0DEbDgCouoL8BAJQ7BhHonmkEAAAAAElFTkSuQmCC":this.hcl.homePath+"image/center.png"}},{key:"ResRight",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAJElEQVR42mNkoBAwUsuA/+Tqp5oL0AGxLqKeC0bDYDQMBtYAAHw7BhHVhvi6AAAAAElFTkSuQmCC":this.hcl.homePath+"image/right.png"}},{key:"ResJustify",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAHUlEQVR42mNkoBAwUsuA/+TqH3XBqAuGmQsGzgAArAsGETv0t0UAAAAASUVORK5CYII=":this.hcl.homePath+"image/justify.png"}},{key:"ResScatter",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABNElEQVR42p2QoVrEMAyAUze5RziJ7DkcOYesRFaeo3KOysniTlbOUYm7vQGTOIo7GTlXkg34bg6airRp+uf/qsIpFXc0CjiMzztOtm3oKXZ6qf2E6XNpOcdu91v3IRYlgJFwDzMEALrjDDTnwxhwvAbYnpBmOhPfw5yfYaaAO/pQQpkI1y6+zO9x3TctyJK87Ju1RpcsA5Ze1AAr4KL3TLdA9EiUpfkwDm5jgC5puNAb98nxExpweAMvyvex+M6q76aWJySm6ym5dgOwaeLJ8tpNg5uk5jpflPOhBO82H/bXsE4AHQP6BVD++V7ZoxOAZ4CvM7AMEI0YfJWBebBl0YinUGVgjABYI8ZQZYDGlEUjDbHKAO8FwBopxToDxKKEMr6mKgN9KwBkwJiqDLTWpWrydXwBO6GtMst1kfsAAAAASUVORK5CYII=":this.hcl.homePath+"image/scatter.png"}},{key:"ResLinespace",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABA0lEQVR42qWTsXHDMAxFoU4lM0E0AjVB6A3oLdyJpUuWKpkNXLrkBqYnMEt3Rjp3QalO+Up8LnyXmLzgjncqiAeAeGroFnYUTZOccPo46kyF0dwBXhKRvInwewrGVQHsyIom+sQhuaK4opcUrJQDPAe0PizJIshr6Zj3ztzuzE8BxqUEgJMrn1RLK5ko5uhU1Rssoa2fc/RNSeIvgACAewT8NUJTVe1pB/8GWJ/n6HXNCA+Akee47eofER6IahXMkQNc6Elol3ZWFwPMlhn7f12+5ZyQL6Ui/WzBeDbQ+EDfJvJiYg9A0Q91nxc2BrQ/APQBF7rqLZhN7KDyBdXXqB5LAV9dlHwPxk1S/AAAAABJRU5ErkJggg==":this.hcl.homePath+"image/linespace.png"}},{key:"ResDegroup",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAgklEQVR42mNkoBAwovH/g8QKOg78x6Z4QoUDIz4D/mMxkCQXwA2guwv+oxuGzQUffnxgWNAQAFPPyICuiUQXwNUSDAOQzTAAdQFhA8h1AVwC5AJkmxl+QF3QEYBuIemhTsgFYJDQsOE/ss3wMOjAHwZUdEHFBqwpEeoCnOmALECxAQC0VDkQT59XbAAAAABJRU5ErkJggg==":this.hcl.homePath+"image/degroup.png"}},{key:"ResRereference",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABt0lEQVR42qWTr27DMBDGHVYWw7J6T7CMFXqsbBkbm2Gh32B5BI8Vpm9QWDbDsnms8MoKryxs+85ru6VRpUmzFF10ue93f3wp1D9P8dfAelZ77rjGK6lO+biJPABorSuYBgEtgj3erfittUEY8IvoFt92KSXTA0DsYLwaKbEtM0fJVPuoedNIxibDppYBKAEozgCIJdMKj1Qg5ACfJ6J4SmBnuQoLqAH8AjA2ELMAEgLERgS5o1Bn//ep4JeYySWAVcdN7nOECliF+qlucRj9i/8FoiUrzKXDEJUatCDTlRJbPdI1etR6rCP6bdEGknIrw8OzA0AqKpFoCYi7eo3OOQnUqIJyKz5J+REJbFxUp5b61+gXFMLc+MEONKTRIllryhCkGHVDa08DgAv0iXbug9PxB8qS+d1OJyptD4q2CTYXcAdI6gGsj60xFWZSNsEVdARwIiptZRTBI2LeyydWABR9wDxaDOcNkA8ZKoaJZWLWozzcB4IwbSHu+BHi1aAFVCBLIqv8bIyR65VMB8nIey5pn9f/ldbuPKfBLVi30sgsS+Ty3nMWHfJPpLCdaxd/x//5b7x2vgCatvMRVxsXzAAAAABJRU5ErkJggg==":this.hcl.homePath+"image/rereference.png"}},{key:"ResReference",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAzElEQVR42mNkoBAwQmkFIL6PxP8PxIpA/ICgAQYGBg4XLlzYj6YBbKCBhUHghRMXNhBywX8HD4fEAzsOLECWcHBwSDhw4MB8JFfhcIGFQQDQlvXYXADEhkB8gdwwIKgZ2QAQEADiD1jYRBtAFkA24AAo7Cgx4AE0LGBhgO46BQZEIMO9iKzIAIgbgNgfiwUgufMMWBIarjCAu4BQQiMmEEEJrRCY0CYgCwYAwYYNG9YTNABfQgtIaEgkNhrBGpDDICCiIXDDioYNFKcDAETLSYhcnnPHAAAAAElFTkSuQmCC":this.hcl.homePath+"image/reference.png"}},{key:"ResDeitem",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAZ0lEQVR42rWT2w7AIAhD6Z/vzztnJHFeIEjkBSX2SIlCSpCU00BGXAG6eEojLcMSjOegRU+4An2aq4BxOIgAKPN+mlkFOO27XViA/lZuAYaFXrC3cAuw8h8GmPEDaKHl2FNOf6Ys4AX98EYDTgXRSAAAAABJRU5ErkJggg==":this.hcl.homePath+"image/deitem.png"}},{key:"ResConstruct",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/UlEQVR42q2QoZLCMBBAtwei4hh2BnHInTlzMrIyEllZGYmsREYi4+5kZGVmziArkXwCn8AfLEkLXOF6BTK3ajc7+3bzEjgFCckyk4CI7UMKgGnID6BXZQJ/xKWBc2JtnB861QHg552rwawfASAyIF0uaLb7XBCB/dL3Ad0oV4aHtt4FqFKzNfr/AEEwzdvvEVHj5iy2H7DUDOlP7SoLQTDhb7G9gFyV7Kzp9rjZ/iE8oL3EVWYAUHhAZeId5IXyABvvQOaKu/VuWz/nQC4U1xsb70DInHe1i3cgMg/YungHlMkrB4f9/jkHt/EyGvPrZArvwcHsDUL+XX02s0cjumoRLfWwgwAAAABJRU5ErkJggg==":this.hcl.homePath+"image/construct.png"}},{key:"ResScript",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABKUlEQVR42rVToVYDMRDMucrgkIur4/6gfMLhcJzENbKO4CojKyMr0z8IrnJlHZGVizsHs+09TB+9u8dj1GZfMrOz81KZP6IauuC9J2amlFKeTBBjZN4zhRhxEjadeRhNEAAoL0FyZ2Y2oVVMJ814gk0Q55xAlSbtwK9Drue0gLoJ62BEm51UowkUUA5pm5blWN6Uc9IEival5biJ9yhvdHtu5UhECL3cNA3lfbZyxFKvTCDYoZbWrTzTrdVHoRyKgbX2tFBzTuRyB+fcP5D7u15qn9paMATifC6lfCrpVQtQ91B/Rfnjv57XmQ+8QLmz1jrYKb8SQDHHbaxVCSjSiUYZlfukPrM4C10QIPcvzvyIx3o59OrU+x1OAWMmjKn+uFcbhcHP9O8E33MWlBF0nZYCAAAAAElFTkSuQmCC":this.hcl.homePath+"image/script.png"}},{key:"ResTableProp",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB4klEQVR42n2TIZQTMRCG/1Wcu8iTkbiurNugrm4Xd64Ph1xcHcGdI7h1BFcUqSsu55CR4LKuuKwrapkkpbt9x+u819fJNPNl5p9pobZ+BFk4Itsx++EYJv8Uj+bp4HVZnG6jkJoAxwkQv8WSkXeLyYazJzsHvxUToO1yBfmFcFnJrKJ/5g/hEqD3blzfL9Kh/93DuoBG5LP3A5xzEKsqgfxhgNYKWsnngP5Xn1401qF9qOF8n152PxyaJp6HBLF7TYB2BjB2ZDeMLoTUwrx0zhn4HelxsLM4tRnwgZX8PSgvAdZUYpTJ/ezPFSRFwgDvNIkaJhEIoA0DW5YA8wTY2rFpKuqXSiaBwBglhnQRwaVkubGQjyLH4ufgID0BODIgnNRtlhxlucDtC2D39VNOlnRZlhmy4RAPBjw+Ijj4S2pBEcBZS4klBTjqKk8gAuze4uPnb3j35jVky9C8JS3uBKzRhdgIx26wKDAzs7djfV/NQxj+ZEFl+4oAmlpRBFDTFOaXk6B1hd33J0TQl91TVp80aeJoSWT1KFMF/wdQO+umOi/vfAMjKAHUFYDSZmxWIvUuVjWM2eUNDCFVIeg33akrgM6MJc2XxCFjl//I6FNMd/I6wHtPI/Vx23DavWc2B/wFrw8vEwsDRYgAAAAASUVORK5CYII=":this.hcl.homePath+"image/tableprop.png"}},{key:"ResHideborder",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAM0lEQVR42mNkoBAwDioD/kP5xNJEueA/ITWMpCjGpm7wuYCkABymYUAVF1A1JRIEFBsAAHFdHREdTv+uAAAAAElFTkSuQmCC":this.hcl.homePath+"image/hideborder.png"}},{key:"ResDeletecol",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABbUlEQVR42q3SIXDCMBQA0F+HoxJHJI7MzZGp3VQ7tTmKm6MSRyUyyClah+zUKiNxpA6ZucrE4bqfcHTHdlt723KXS9PfvP78xIM/Nu/fgLwQdXA7OU/LLHsZ0+sAtJ0dAeLFDPavmyZ+dTcbyyL1GiDdinr64IDSeuvnbEnZ1C1WlQHO4zPg4ggsLwCe5vV8GrigA9bZ3gLaAspAmjqgiSOw/wJIqfBvCrTWEDIGJ8AgoCHfJkBHFOfaxW2/AD63ZMVrQiOXgVT248Qt+LaI9SJU7sUqJ3aMkxNABxp4gdvYdQOGtkiIUAvElMBQSbhRmMmhFYh8exjYA9MD6A8wkYOEErOIdhRTaAEaKA45DnPAYpUsgkRgYZXbXUfgiQmo9MQCZsTA5+mPt/VjC4/UbsEuHr/5xN1Agkcq8DkshNcOMIKV0hvT86Hfg3tPqFwNwCY/ZBV0AoiplNAI4FEwT2qlCRB1BE4rCFuB37Z3ADXOES2VoYQAAAAASUVORK5CYII=":this.hcl.homePath+"image/deletecol.png"}},{key:"ResDeleterow",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABX0lEQVR42rWSq3LDMBBF77KwCIbFsDB/EMOwun9gWBbBshoGqixQYYEOC1T+wGWGCjOUmYvUld24zqOZznS6Mzt6jO7Rvgh/NMr3xoeNawa3X3vXOMg0If+S2PbxKo+GYm+tIs92i1x/AGq9QyZ7wJT9nSGzVrzXBqWdXwGCMETgeMm3O8jnAEgFHzX7Yz0CxhMOpCyAODn0gKHwlIJab6CylPqQZaJ4WYJTQyIPtEhiUjo/T6EVO1zVhe211AdUbh4A9UMMoTSRaziCpnt88u5cd+fAYkGyl5jaAkcRtfiosjC8J1t534tdJ7wERkWOpZGoRwLjEZ7I2NxOYLmyUzKl97aqBwCcAYIJjiDrin/kVsRUOOsiRLaBotkivdnGSxNCwGwVXd7fnIO2I6FvoY08SHcn8QzAwhrf7dR6w4OU/g5w+rVvHa+ZeoNeyfuAn2oQcg6er7P7gN8U8F8Bn0MA1iMUJLJ3AAAAAElFTkSuQmCC":this.hcl.homePath+"image/deleterow.png"}},{key:"ResBottomright",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABAUlEQVR42qWRrxKCQBDG95qRaPQNHJ/A6JigaRObDaKRaCQaLxIvGolGHuGica8dCZc/BwcjI+jOcMfc3P6+79tj8GcxLtICFk53ossF+7d0veHgTuh7jABZcXLXs5U3+zNkD06ABwF2EwB5valS+6XAu4QNYKqDvG4u7SP2ACkBtqN9KjeZFaBuAPT5oQEkBDjMA0ikAV6jzwDG2Nc06VNCGDWAmADB0IGdV6v6CXX3nPKFEN0MgIsiOLmTlE3R4CG+x31Am7dStgbWOql8VP+ZROB8ABgOa7V0Rh3EPAOeWAD/6IKUJitaiiY7tm6MMyEsAE/E5Px2VYCfOq36G/AGDLG5EWfr6aEAAAAASUVORK5CYII=":this.hcl.homePath+"image/bottomright.png"}},{key:"ResBottomcenter",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABA0lEQVR42qWRLxOCQBDF95qRb+L4CYyOCZo2sNkgGolGovEi8SKRaCQaLxL32pFw+XNw4Dii7gwcw9z+9r23DP4sxkVew8oZ/+jmhdNbujtwdicKPEaAovbd9deTN/sTFBknQEaA3QJA1R2qmV0q8M5RD1iqoOqaG/mIE0BOgO3bPlUZzwpQ9wB6gsgAUgIcvgNIpAAv8SuAMfbRSfFAskCAuAckBAjnCmy/WnUr1OM6ZYkQXw2Aizr03UXTTVHwkNySKWDw2062AhuUtDra70IicD4DmLAc572S/C5boKQceGoBgqMLUhqvaE003nFQY5QJYQF4Khb7n2ykAfzUadXfgCcVZr0RhRPfAwAAAABJRU5ErkJggg==":this.hcl.homePath+"image/bottomcenter.png"}},{key:"ResBottomleft",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABAUlEQVR42qWSrw7CMBDGW4fkTQhPgCSozYHbcDgmkZPISWTlZOXkHmESWYm8uk6Na7tuLQmhwCX9k6b3u++7lpI/gzLeDmSxnE+UniC8pewCL3eKPKUI6IYsWX1deb07kq5hCGgQsI0A9HaRuvZDkvRUjIBYBb1N1vIBAkCLgM3bPNk7z5KAGgE48sIBagTsvwMIwAZeyhBAKf3oQggwENCAcgRUCDi/KvD9KmmfUM3PKR5AyqsDMD6csyRKgQtsPKluVQiY/JrKXsMmJUaH2XdohbEqXkHb6UT7D/Us7gioPUB+SLBBzit4FZ13mNQ4ZZx7AFbzaP9+GMBPmV78DXgC6ti+EZW5QPIAAAAASUVORK5CYII=":this.hcl.homePath+"image/bottomleft.png"}},{key:"ResCenterright",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABB0lEQVR42qWSoRLCMAyGU4fkTTieAMmhhgPHcDgmkZPISWTlZCVyEjmJrJxMXadGSlfWDjgGRLS5XvLlT1IGfxrjomhgNO5etDkwjNL2wl5MEi8ZAcpmE02+rjxdbKE8cwKcCTAfAKjtpUztSsFyl7SAoQpqm2zkIwaAggCzbiiMfWSVV4Q4cYCcAKvZ22BVu6EpQG19iTTAQxoChlR2VlwkJGkLyAiw7yvw+9XKrlB365QVQnp0AC6a/SZ6Sh6P3iuiwUN2yp4Bql0V6K5ffCi567j7pUTgvAd4NawgWdt/aE5JW+C5B4jXEUjpekWvopfcAh1cCA/AczF4A8F/MICfMj37G3ADj2G9ET5g060AAAAASUVORK5CYII=":this.hcl.homePath+"image/centerright.png"}},{key:"ResCentercenter",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABCUlEQVR42qWSLxvCIBDGoRn9Jj5+AqOPaTZtzmZz0bhoXDQSF4mLi8ZFI3HxaCzNA8bG5r+pF4CHh/d3791ByZ9BGc9rMpl2N0ov0H+l7AaDN1G4pggo6l0w+zrzfLUnRcYQkCFgOQJQ2U3q3KUk60PUAMY6qKxY2wfoAXIELGxDKP3IEQIIICSMHCBFwGbxUiAr1zRphPosABt4ivuAMdld5FdBorgBJAg4Dh349SppR6i6cYoSSHx2AMbr4y5ote+c5IX+CWD6kFySR4BsRkVUVy+0TowPcy4QwNgA8KxZPbGy/1Cv4oaA1AOE2wBtuVrBy+iJG6CDc+4BWMpHT8APA/hJ6cXfgDu58cERaODm7QAAAABJRU5ErkJggg==":this.hcl.homePath+"image/centercenter.png"}},{key:"ResCenterleft",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABB0lEQVR42qWSrxeCMBDHt2b0P/H5FxB9JmzaxGaDaCQaicZF4qKRaCQaF4lbGwnvGJON5w+Ue49t8Pb93PfuoGRiUMaLhszm/ReNi/RvabPJwZ0k2lAAlM0+XPycebk+kPLKAHAFwGoEoDabwtyVIptj0gHGOqiNGO1L6QEKAASEUvqVISppAPBEiQXkANgGb0Wqtk1TrRDPQkIDT6kPGOPARnETJEk7QAaAeOjArVcrM0LdjxNLSc8WwHgT78OPDkrR147zF/CeXTIf8Ky3zdzXK59OjBjPCGRsAHjVLE+szX+Iq7gDIHcA0S4EW7ZW164j7oAWzrkDYDkfPQGvNwj4S+nEZMADQ03FEWHruZQAAAAASUVORK5CYII=":this.hcl.homePath+"image/centerleft.png"}},{key:"ResTopright",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABAklEQVR42qWSrxeCMBDHb43of+LzLzD6TNi0gc0m0Ug0Eo2LxEUi0Ug0LhpvbSa8ySZDRVEvbHt79/3cTwZ/GuOirCEYtT/aHNj10s2FDz5JvGAEqOooHH8deTJfQ1VwAhQEmLUAxthHsZQIi01iAUMzuAAomz6i8gElAaaDIjurTghx4gA5AZbTXmd1cU1TgLp5S6QG7tI3ABKxoD+j8ighSS0gI8D2BeBer1bNCHU7TnlGSPcOwEW9jcJBYrTzN1PIDtkz4FbvTdzWi9AVm3dFAM4fAK+a1RHrZg/NKWkKPPcA8SqktFy66EX0xBbo4EJ4AJ6LwTvQ2QcD+Enp2d+AK8m5xhFGJcPrAAAAAElFTkSuQmCC":this.hcl.homePath+"image/topright.png"}},{key:"ResTopcenter",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABAElEQVR42qWSoRbCMAxFU4fkT4AvQAJqOHAbDrdJ5CRyElk5WYnkEyaRlcjUFTVS2rJuwGFARNezk3fzkpTBn8G4ONUwGDZ/tDmwnaXtBzs5WbJkBKjqOBp9XXmy2EB15AQ4EmBmAYyxXmIpEZbbzAH6OrgCKGcfUYWAEwGmvav7GM8TBygJsJq+TVRXPzQFqO1dIg1wl78GfHJSnZFaIEDuAAUB0q6DsF+t7Ap1s055Qcj3HsBFncZRLzG6/ZstFIfiGXDv9y5u+kVoi829IgDnHcCrYbXE2r5Dc0qaAy8DQLKOyJa3i0HFQOyAHi5EAOCl+OoNPDZiAD8pg/gbcAMczMURkh/HbwAAAABJRU5ErkJggg==":this.hcl.homePath+"image/topcenter.png"}},{key:"ResTopleft",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABB0lEQVR42qWSoRLCMAyGU4fkTXY8AZJDDQeO4XBMIieRk8jKyUokjzCJrESmrqiSruutHXAbENH1dvm//GnC4M9gXFwNTKbdH20PjLO0+2AvJ89WjAC12abJ15Vnyx3UF06ACwEWCTDGBkVGG1C29l3Bap+3gLEOHtCIrX3ECHAlwHyUAx/1DSHLPaAiwHr+MVk9/KMpQO3uEukBj0UMGHIg7+jsNy0QoGgBJQEOfQdhv1q5EepunBZWnDyAC3PYpqPE2M5fSoTyXL4Cmn4bcdcvQiy295oAnPcA7x4rEmu3h/aUNAVeBYBsk5ItbxeDioG4BXq4EAGAV2L0DkT7YAE/KYP4G/AEs+rPEZPBSisAAAAASUVORK5CYII=":this.hcl.homePath+"image/topleft.png"}},{key:"ResMerge",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABOUlEQVR42q2Sr1fDMBDHrw65/4S3vwCmBipFMVRaxUP1TU7BFA+1TqKWurplbrJzyOAmg6sMrq5cmmRbF4rYyHvp/Wi+n7tcG8CZK2C8qOGit89U+qHapypj1FGsMwgQNSWXTTh938Dz45VXJZ5ksHilXr5/GyNgjYChBcwRkPiAu3EGy1kXADuQpWraUmCs8bXFjIvt1Q7jHggzA0pM1fHbCq5viD8pN4Nqn9I+S3UHOQLuLWCKgJB4wpbYdqfKL+D5SxsQT1YQjsifVd07iYCCIyBFQLIDZBCGtLPqzte7/IRinSKA8VpsddIciUa0s6pyVn0jQID4YAaQUNP24ClrAL9WPRA3X6eUIMQxIJ5DFCXdrTuxBcgtbwP6DxaAA/KvgCJl/xd9XdxSFgbAcg6nruBk5X8BfgDkQdcEQI824wAAAABJRU5ErkJggg==":this.hcl.homePath+"image/merge.png"}},{key:"ResColright",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABO0lEQVR42qWTr3aDMBSHL24SOTfkXHkDkHPEra6pWl15gzI5h0RGIjNXGdzc6BuAmwyujl1CgPDvVBB1Q3K++/0uJxZsXNZmAOOi7nd3AKnLvHBGF10778+iE7FGgEPgqU12K8Hbvaj6+FWC+2qrmnMBPAlUA39/hPzKlgHf2Q0CbzcCSGwrRAuQfxWQUzgHmOpNT6kjmADitzYsZRNAigbvHlQVHl4zoKS1CWM0cBBwf2AQI+CMgBIBfAJwDICYAGgY177vfipApz2NYAIoRmj0u2U/2dqA8fp8CBYjKEAzg5+5gU/CmlKS9YDVCHqIgq3NAAGNzmKE58GAvq38hThBgw8dgRsGSQm2BuRdBLlgECHgQjEC6jGRw2XvqTpK5Qjwy9o7iwDO+eyROG4IRVEMH+RwZwTY+hr/AcbCAH+x1duFAAAAAElFTkSuQmCC":this.hcl.homePath+"image/colright.png"}},{key:"ResColleft",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABO0lEQVR42q2ToXaDMBSGL28QObfIukXOgawDN9xSV5k3KHYOiVtkZebmGtxc6RtQN5k5HLsJUMhGu55tMfznnpsv/3/vIYA/nuBfAVLp1okGQNfUa2S0dnVoDJhLgMc4dHr1dAS2IE4rpWH3HDtdHmz91sGidPUFsEXAgw8w+JzWI+ClPEB0fwfm/QOStfgOsF9rscIIUwBfktF6M/RLH5AjgCehaxAFOqB4qekAqoj7mCXYnpMDtuSMLehe5lkwAOylDAF0AtDnAHydtVVdexPnnLsIU4A4FwEdRKh31asMcqnQQfeSGBzYGbxdcODNwALS2I/QD1HLawCFagkhpy3Qm9GBSK7ZQtE5GCKQHlDNRTAzDjIEbHgMR7SXbY0H2MuuLnUFmzR0ehaglHKaMgH1dDtG/fwz/eZ8Ak926OzHEXH8AAAAAElFTkSuQmCC":this.hcl.homePath+"image/colleft.png"}},{key:"ResRowbottom",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABHklEQVR42pWToXLDMAyGFTa2PUJhYfYECSyL2MrqsbLlDRZY6LFCj2VMMNBlg4aDhoMe25DnJO3Odu3d5Sf5z5I+W9KlACdB0oKvbwDz503yvNtjMX6LC2DXVFPg9e0Eu4d//A/APT6CGkQa8OIS2aaabqIh4c0X4L6NAL20q/XKBQ3oTwNZnVugXoQA7gBP3lMRZ08UefeC25tECz5gauFcJCjyuRbYQVtYoLFVOpQhoFzfpdeYOJODBNXjNcB4VcYrjAHqPQHQHyp8ZnR7rADAj2QZa+Zh9W5Y2yrtMbOFzgHabTNNmKQCrMupaJw2Hfm8xuj8CkBESxYRAnIqN8xeEnPKBlnLrdZ6XhvxYjHA/WCdEPTMGJ4Y1nUu7xc8d8cR2LMbuwAAAABJRU5ErkJggg==":this.hcl.homePath+"image/rowbottom.png"}},{key:"ResRowtop",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABK0lEQVR42pWSLVvDMBDHrw4HH2ESmTlch5tr3OoW3Bz9CJWTxeEIrriTlcHNETkZiQxurtySsjVtw/P01L93ud+9NYGIsbVgbLH40sY86kaq2LskFhBF2eqjcZoAyWxA10X7X/IFIFG17uvknbYLSilB5BymYuWOJwFgm6Uu8P7xCZx7veJPoOo3gBsARPKvU7glvST/X2ceUBNg45NeCCDo4bkSNhPa/gDfFSFA7E0LM8xaC7hnIYDd311fnK6zTvlUo0DXfAywvSzbSxwC9GECYI46bHNQfWgBoKIlPm/GV3Cb7+vYFSpJgG3vCl2SxIGOXaF6xZY9MLdd820hat0esJYhoCRAITJfqaZKeTqteWQEB8gz1x4qDXzF/NwRPRrhDEDEOf/SBfALGwrHEWDp4Q8AAAAASUVORK5CYII=":this.hcl.homePath+"image/rowtop.png"}},{key:"ResParagraph",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAASklEQVR42mNkoBAw0suA/7j0EmPAfzRN/5H1DTIDGhoaMPwKFGNEMgS3AciaQZpAfKhmZJcMZgOQDcFhAFaAoQCmcQgbQCqg2AAAwSpLEVgNUmAAAAAASUVORK5CYII=":this.hcl.homePath+"image/paragraph.png"}},{key:"ResFraction1",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAlElEQVR42mNkwA30gHgRELsD8UtcihhxiIsC8Sog1gJiHSB+TaoBDFDNIEMcyTUA5Ir9lBgAc0EYEF+jJAyuQQ15TawBomg0A5rm1/gMgNksyoAdvEZ3DT4XILOJdgF6IE6FsrNxBSS+QARpboDyp+IKSELpANkwkg2g2AuroF54jYRJMmA/Eh8j+ojxgjgaH2uWBgD/ASURJO9RsAAAAABJRU5ErkJggg==":this.hcl.homePath+"image/fraction1.png"}},{key:"ResFraction2",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAArklEQVR42mNkwATiQPySCDEwYETjawHxVCAOA+LXUDFRIF6FJobVAJhCkCE6SIqxGYrXBSBDHKGKYYZmA/E1YrwA0rAfzQBkPlFhAPPvNULOxxcG16DOnorP+bi8gAzwOh+bAYTCgwHdMHwGIPtfFMpmQPcSLgOQo+81VHMDVA4lUPEZgM35osQagB59MD5RXkBPfTB+A9QwGCZoAMx2mHdg4DUxXkDPvuJo8nA5AAOEPBEId/kHAAAAAElFTkSuQmCC":this.hcl.homePath+"image/fraction2.png"}},{key:"ResCopy",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABjklEQVR42qWSoXLCQBCG/zxBeQOQOKiqTFDUJVXUQV0dqWpdU1fX4KhqcOCCi1xc666OusMh71xR6V4uQJkOlBl25uYum9tv9989Byeak5LM7VHZ7ZtPZi3lVXgbpEcBfLe64xxNZyAhId7pXGSJ+AcgGNDYcQ4mMzRrFSRjgpiLgxAnzRjQbmD2ZUuvVTSICLW6V8gpxJWyjAmpWklYow0gSSnv+q79WgG6uKz5IuBfnO1ke5pocMXm2BJDjyxgzICOi9EHByrNwYp3FBK67i7g7lXDawJRTBYyDsiJGdBngF6ZCehNuWKu0G1XMZjaYK+uEWeKGytKWQoy7TlOnKR579rnn4sisx2l4l5U0O9sp2MSmArlEpBSIuK+bgGBD8k/TWDRLF40Bx671UK3UtavygyBkTFkQFYCkvHf9+Jdhnjp2/FqZpsEJt4uUQJCx9k3396zyN/uG7gZLDaZ1xbUlZVwCBA8UJ5ELtLs85dX2afOp9hUQAcAXki5WqpNx9fNtbuFSYr2A461kwE/CTLzEeV9zQ0AAAAASUVORK5CYII=":this.hcl.homePath+"image/copy.png"}},{key:"ResCopyAdd",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABpUlEQVR42qWToVLDQBCG9xyOvEEj61oUKpOgqEtQ4BocrocCR+pwpK4oDhfc4SK3EwPucOCurvLiigqbXGmn02npDDuTyd3ezbf77+4x+KcxibqyS2N/c1rV30yf8atI7gUI/daa8/l1Aqg0qDc8UrlQfwAUATprztHLBLquAyJDUJ9qJ4TJnACnHZh82dRdpwREBLcdNHIacQtZtSltTgR3cQkQEqt+6NvdN0BJFx1nWMg37oXHh2vRhi8lUMb18kSNA7SAjADnPjy/UxRTUiQDSSQKgdzr++uA68cSgi5AkqKFZBGylAADApQU3TkYFr+XRR57/dMWjF7tPmiXkOaGCqsWsgxoGTOWClnFFyEdTikDezmNRZFmsTc4X3VnEYC6w0FrDQnVdQWIQtCUPhC1LlbQFUUiYu+u32p0G2P9gguIkgiiWsaYAPkCILLNeQl6HB4Gtr2MDTfO3Z5DAM7Ytv7G96p6uunA5WjaZFCbTKTNoG2shF2A6BYrkfgg848VlCZbZEEz9GktAXcAAo6VmZllxRubr95L/XY0JtsB+9q/AT/7PugR3jLEkQAAAABJRU5ErkJggg==":this.hcl.homePath+"image/copyadd.png"}},{key:"ResPaste",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABr0lEQVR42qWSoVfkMBDGp3/BIU9WnqPnkMWt28pz1B2OSByROIJD5tzK4HAEtzLnTo6snHU9Vb5JdsvCY98K5r2+JNPJb77JTEVftOozZwx20lUE+5h+Oh/SQUBYOYP1bueQIVH3qy17EJwLVNcNTifqUfe5uXZxHzC1i5q+4bBBQFgpoCF7Hf72fXOqZxIm0wMyRrKrhqCoegdYAqB2/xCobRtkLNn1YkqARqH2B1NzwuTXHbnVPsAD0NVZ3j2USVYpJOM2QtdRqP7O1NZM7qkl/xTfAB6ACwUgaDOWrJz82yttATszKCGu0x7gwU5dBnAJ1JUjefH5smwBkveSfd6ZD4AFXnhMpW8KgAo/eLr6vSxR//HA4yZDjHUZErytCsApQMuOswIZBAoC3Vwt6c/jy1xKc4buAGAuO7K3DvPiq8rd2qlfyBbAWYVmUgU35mLOnJuCBA4XSynlA8BMvc7NXLPkYAVY06GFaVag/2r0mJmzK2AGK2cBOAvE//jdiLrBAdDPmWnvEdV44BmA/PLMLHl4dl/dGjIAxBjpkGXAoZ/dpZ1k7emYVUcjjtgrL1ggG+aSiooAAAAASUVORK5CYII=":this.hcl.homePath+"image/paste.png"}},{key:"ResNonetool",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABS0lEQVR42pXSrXfCMBAA8Ot/UDkZiaO4OYIarqkajsg5InFEIiORkZUnkZGTTM4Ft6m1rqjs0vF4j9HycSbNveaXyyUJ/Au73QWesYI9pQh3RNIFxPFepBMQzwzw3UdkQoh7GJi/DKE+1IBbD4KzSZr2I5cAEpAP2++6riNISNZbSQfgCBif5vtvQkoHcsZHhOxuAqZ0YfE6Pst9fO5bREk+YYy564DFsJjnf5MDHeOY934PZoOglRgRsusF9AbDSuanhdDUoLQlIK5JIU0B0JqkHzAY1Ft+3NGCXqp2lDNRZAN28S4uALW2QU457WqADVhcSFVU1AMEa3RyG9A2+C9PDRNF1UCGW7dSUoJeGzBa0fnPb6IDMIF+bPNVU6VqaX9iFd57umIEV5rkKtDxLgxVsRBTAdZacPggEIPPVICGGqxkwXmGDwPX4heV3KQRAiQITgAAAABJRU5ErkJggg==":this.hcl.homePath+"image/nonetool.png"}},{key:"ResLine",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAU0lEQVR42qXSSwoAIAgE0Lz/oQuiFpmfGXUjwfCkUkaz5PSpzjRQRnSYRqwghXghGIkCEJJNSBHkniGCvraLMH9uIuzmfQi9uhqpAA9SBS7SAnYtgtAOEZBR3KsAAAAASUVORK5CYII=":this.hcl.homePath+"image/line.png"}},{key:"ResRectangle",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAJUlEQVR42mNkoBAwUsOA/9QwgFyX/B81YNQAqhpANqBKZqIIAADcphYF758/6gAAAABJRU5ErkJggg==":this.hcl.homePath+"image/rectangle.png"}},{key:"ResEllipse",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAQ0lEQVR42mNkoBAwDkoD/pOihxGLRkKuQlHHiCRIqnfAeqhiADma4YZQxYCBDwNkAQYiDMIajdgU4AI4ExJZYOANAAC9WxIP1BFMFwAAAABJRU5ErkJggg==":this.hcl.homePath+"image/ellipse.png"}},{key:"ResRegion",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAW0lEQVR42mNkoBAwYhH7T0AeRQ1eAxwKDmDVfWCCA41cALTxP9B0XJqwqmEk0kacFhBjAF55qhhAyO8UG0AwDIg2AJtakmIBm7dQDMCV8tABekqk2AUUAYoNAADy8DYLd/0VXAAAAABJRU5ErkJggg==":this.hcl.homePath+"image/region.png"}},{key:"ResText",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA4UlEQVR42rWQPRKCMBCFobMMN4gd5dJRxhtgZ8kNvIo3oLXMDUhJ55Z0cgMp6fAFHUDldxh3BjKbzX7v7brOxnD/BlAIY0w6JzJVrO0vOkVHfdV6FQDiAuqPJUJjhbqfENGRmfUqAIXkccazLn4uVahik5nE1gBRgKRvFwe4MEscWPUAjTwwjjsJQKNE431sYVLKfYGYctCoSV8GOIRwhE1Lzvk21tMmUBd2aeRjeTmXH858uuDuPAoYsN4+gpu4yIvkaxQPk5QdgEg4lSPL6iWMIvcATQ1fFzv7pAfYEpsBT+39XhHBy++VAAAAAElFTkSuQmCC":this.hcl.homePath+"image/text.png"}},{key:"ResInVisible",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAYAAAAmL5yKAAAC3ElEQVR42p1TXUiaYRQ+X9oPTRPdtFCcw4a0IovaJCYZbAXRgmJtGpTYUqaT6sJuRmOxETFG4WCsRRBzeSdp2taNRhcxpM0xozRLZ1CtHyJWKFSmkTufbRe77Vy933m/85znh5cArGQyCRct4t8wQRBJiUTSXVFRYaTRaJCdnQ0mkwk4bA4IrgkgJycH9vb2IBqNAo/LA1mVDOh0+jlAV1cXbO9s37RZbd/Ly8v17e3tw5FIJGNoaAj4fH68pKQEMjMziXA4TE1LS0swmUyQyWQpUEKj0cDh4SHEYjHAS4nNZvtWV1d3v6CgwG40GmNILkMoFI5g78nW1tadlZUVWm1t7afi4uIUS0Kv18PJyQmMjY29rqmpmWez2S6z2fwbz7eRImViYuILKRH73t7nvVU9z3qC+fn5b/r6+gbPzs6A6OjogNnZ2U6fz/eWy+V219fXGw8ODm6Nj497WltbhYlE4pLFYvGRIEqlUo5SIqOjo06806nV6hFCLBYrFxcXzWgiFBYWcpeWlhwNDQ0vsrKyQjgYbmlp4R0fH/ORyVdk8amyslKL5x0SEFkqCRxqCwQCJrKBBl5BAAv6cbe5uVl0enqaYbVa/SqV6vLm5ua9ubk5PQ49nJyc/PUXoI0gE5ienu5eXl4eLCsrkx4dHYnQqBQgbr+K32y73f6jsbGxSCqVBlDu06mpqVdyubxTo9a8S3kQCoVgZmamn8FgKKqrq8UOh2M+Ho+LSBCFQnEDPbnucrk+GwwGCi56vLq6KhoYGDCQyRFarRb8fj/s7u6SaTxAI3fS09PdXq/3I25XoTfRpqYmxsbGxiOPx/MBNxeh7ACFQgH8DwidTgdoIqyvr0NeXh6QugUCQSIYDCb39/cBU6CjeQlMJ+Z2u3sQpB9ZiZgs5s/h98PnABghrK2tAYvFAiqVCrm5uYA+ADJIvRMOhwOlpaXA4/HA6XS+XFhY6MU+8d9buGj9AWQzUGmPTlZPAAAAAElFTkSuQmCC":this.hcl.homePath+"image/invisible.png"}},{key:"ResDel",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABjElEQVR42qWSsUoDQRRFbzAgGJCQYEBQWLCxEBIQUkr8gmxlYbWlhaB+gZsvMIKFnbGxSOMKFhaC0dIqiB+QNAoJiCkUG9GzzhjWuCsEH8zO7Az3zH3vTUrEoVRiqjP8DamlMSIVfk4kLy0dsRw8sQYSJAkOJCcnuevmQgNoImJyp6TqKwsgNSB+VHgrZTs45SwAEKwZzRDgyIxtRjXc60lnTN6m9HyOuC81Mpwh3p8Avsr+EBCNpoHsWcjxrLHqvUtbM4iB+GUrjgVYSFjUBikVEQzCvYwprhcVJwLCuJIq4UTOwnZ3GujyiDgRcEk9EAQvOAj/mcV/d8XU6W8ANzsZ08biG4WcJ2cAPkWssr9Ttu2LBdyYHn+JEVxTQDdnz3oG4gEpAen8AlzQqjnoPCj30eTq0qq2FWdpne4oJJ1oLZlO/QTcI4B+2je/tQVg+ZGi8ZicSQA4qxSsiyHgAYvcvtsz1r18xGY0eFR1UmgUrLuog9IiQqwGPJp2OqZl3/FBSqmklzhu/BvwCcjoZRGi0ILlAAAAAElFTkSuQmCC":this.hcl.homePath+"image/del.png"}},{key:"ResTable",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABI0lEQVR42qWSLXaEMBDHhxN0ZV1XrmNc68BVIis5wl6hR4hcGbmSdSuDa91wg+0NUkdVdkISEqD0vT5GZD4SfvnPkAw2WmYXcdYmLWq79Ox7lw3e567mciX22QjYPT5EQHIoxLr/jjV2RDegE2YLBfF2HW9M/HhOayDpAfJKpn7Nx822+4Iif4r5ZwfFM+//AFgdSnXwLgTQVXpAw4BqHXBpO6he8uFjq6JRLYiTTAHK4GE/6d03M6u51oa2J4CzMvVbsZRsjWVfWHLJCsJ8lFUgE4BgwPE3QNIzMiAMkz7mANmYEtHJ64P4pez0N8o54FhXk6GV4UZwkhFZIb8F9wboD8BKz2gV+qHeSPHcmikAD7GFNdkudtECYAv/tRGwxTYD7nFD6REDXBtHAAAAAElFTkSuQmCC":this.hcl.homePath+"image/table.png"}},{key:"ResImage",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABeUlEQVR42qWTIXvCQAyGP9Rwq5wDh+zc5jaJa//B9g+Ym+0cEtzcisPt6pgrbqhdXeXVMRdcUSy5HAws5HnuuVybvEm/XDu40DrGmN3FgCRJzkouiuIfMFtVQDcCESHqAnbNqwaIA+WMVn0+Qbyf1/gUMF02cDc9ZAOl2y0vp0sAJNld9Z1t8DnqnQLevio83sc+ILrioE1IlpqRQm97uperBk93x4BhgqWr8DCIUYXvo6227dtnixnKTDg5/DaIIwYsBDBnQKqAPgP2JkWvee2BfagGk9kUxPp8vIxQGAbk83yXpimcI8QD7XFzpLRAGu7GfC/h1iVc7bweZjwBdx8Aw9SrTzwFU1v2I9+say36IpoktcQAtx8F7HsJsxBArh1kJocTtTkokpFJGT/W0Ao/w5r8JIh3y/HaQQDYml/yGIk2XAm+IrVBUPFJd38fuEg5Tk8B2bw8KC7Bbl86XCIFhS9gUJk9B8C7As6xA+D8X4l/pkuSxf4A78jri7tILL4AAAAASUVORK5CYII=":this.hcl.homePath+"image/image.png"}},{key:"ResFloat",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABnUlEQVR42qVTLW/DMBC9sMHAwcDBwEHDshmGzWOVBuKyQGuo0LDQsNBjhR4rzB/Y1LFCj6VNmuzipE7TrtOkWbJ8Pp/ee/fhAP65Aql046wCwPZnb/3J5wDS5OEqw9e5oxhMkjx1AOFtNA4orGex/d3xFWMQs9Y/K/iNtRPeRdCEjxVYayH0QWMFWknIcwNcaP+eOwULVMA6BTMxA7MywKYMGEs9s169AkuoV7DZdilRhgoEAkTRUAO73QBnFEEExPcEWXPIjXbsZMLQR4/9cP5ASNXw6eMox/AmcGccxw7gnPlYUJYwBJirJsJA32OsA2fkop1xTLBtfJiDtgsrBQFHAMEfL/I16xyklKCXyvnlQgGldGhlWwO8B1zIps31qEDOOVbXgFTGMW3QVgsBPEOgMBwrWEoEyGQjsrQfjDcQGQesC8R3kW+XFMKBKm1GadEJgYAhACGDAluczLyfPOvt0xS0EgjAUYFIu/k7eRw+zPXVEgfJ80vz/vHpHHV9gPpQwaEqce+h3BdQ7gqoyh1UeHcx+N7U7QfuPvE3Cv37b6wVNzAAAAAASUVORK5CYII=":this.hcl.homePath+"image/float.png"}},{key:"ResEdit",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABq0lEQVR42qWTrVfDMBTF71wdkTgqkZXIyDkikZU4ur9gnZsjKHBkDkfm5ugcMrjJzA0X3FDwXvqxDtg5cKhoX5P3frk3eRngn8/AVv6jDsP+zLY3uu3Nb3cpoQVYa3vJ+4nhwL8aSkgpGeAIUOH++uqwznfgbQ8CuNUL0mNRAwwBHn8AzGbzqCq/ON9Jp295dwN5JpGmLeDB4vF2/A0wmtwghABdjrtiXl2bBnCaEmDBCmrA+vUNVVUhyzKSd0LxEmZRwUzHdXGnYEL+FbIOQAqMLlBODYRgfx7FZY6wCREgEq4UyJWK4A6QEcAQwDYATwUiESimmpIlyQfswtKOK3jvo508v0KpJ/UpkNKBsazA4MlcY/68hHv2cN4RgBV4VM6hLMawZIftcVzqERSpaQBVtMArOkfSi5ys6LiqW7moqmxWBaujuJiOoh0pW4Cx5FnR7lrymJJcR0eUxo33PsSYz1yeKbJ4hEL3AQ+1AksW3GodiwTvZK9puDtFcrLX2m6zhGoB7FNRWyL53T1ox9WQAJoAGcttigW/kl0zse9u/OscX6Y/3d0fnk/QBwRipmBJBAAAAABJRU5ErkJggg==":this.hcl.homePath+"image/edit.png"}},{key:"ResBarCode",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVR42qWSvRGEIBBGoRNLsARLILzQ8EJDQ0NDQ0NDQ0qgBEqwBEIyjuV32fNmbkaSFUbefm8HzvwS6+WgyrnjYknfS8dZWmLW8Wztw9kwKccsY2ofOL8HGA/oG4CxhqltiIC3Cv+3ABu7iiV1Q4DQES40AA/cRQKg2AFga9x7gIwKRwOIsakvdQ77UTrjq66AGvsWgJyh9h7AvgApNh0YdS4A/78+MwB1pb7UOQBeMgD1Of4JQM4RcEQFDMix6cCocwGAgkwA3JUOjDqHvUgJfgPqwKjzLeDJKk8TPxKYNsQGZ/CFzrgr1E5s7pITbwD5co6dnXNserkkeLI+oBEJII3t3dIAAAAASUVORK5CYII=":this.hcl.homePath+"image/barcode.png"}},{key:"ResQRCode",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA4ElEQVR42qVT0Q2CQAxtScBZFL/VARQdQI0yhdE5dA1FdAA3cCVDcvhqSnLBOyXQ5KU9en28tjlm5qiEEVFBLYyBsG1xRVBZ6cjlGq88+bBOcNJ4rxcmen468hGLtSVAaa9TCy4Cl9kE9OnZUi3b49rlo8YH9Q/1cyAFdlZbG6BoSrDAj+9AjHhqjBlX6pu0IKpTqH2JV+VnF4FriDcl2CqB+Ev9km+NURCQSI2NoQTFOYr7OA/swXoJZE3M5UgJZvAZMAQSHeTvFoRAe5XvS/VrTV99Q/zaM/15aNylWOwNP0hdNv5FQXUAAAAASUVORK5CYII=":this.hcl.homePath+"image/qrcode.png"}},{key:"ResButton",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAnUlEQVR42t2SoRGAMAxF042QSEaADRmBFXDI4JDBISNxpUkPaKEIrgpq/iWX/5JcaiDzmZ8AeLX2jamqGsChMxGAl9mpC1YGn3PKXn1eQlZt2y4BoPkoUHOkHiyKEzkz3gFEoxbvxtB0wEAAYqYEYBrPMTnoDjFIAfgASI9+dpeYngCIve6mJggAANEkusYVUJT1qzMqJARkf6RvAzbuxq8RvpsvTwAAAABJRU5ErkJggg==":this.hcl.homePath+"image/button.png"}},{key:"ResCheckBox",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABTklEQVR42qWSq3aDQBCGf1wcyLgiI1dW8gjISGRdkHXJGwCqOHDFsXGp6vIEJS4SXCU4qtIZEg6XXAxzzjLszvzfmZldDTNN449UxfmyrfpIMzlpxjFnbWkjgJSyF3ByB+iEDccq2JYFi5cwh4CcAAqRt3le7x+wV0cYS+MWEBMgfQIoy5KEL1APAYlE+rG9K86+MuzCmMoXMFcWTNOAWA0Bhysg2qKua+i63ouzDO67S0NzYK83UPkRYgqICSAJEPsuJe84CMdxoA4KfujDtu1WzINUp3sAyRXE+P70EAQB+EZY1PlOXNHKTxmEEAwZAlTbAgPYGOJTz+6bMxKzz4uMBih4DhNATIDUa6+q5rMwuBGzL34J8EqA5RCQqLNPLfwkUSueioa+BVh3ACrP21fW2aMnzDt7CvAJIEzzkrQAjKvHwuj/JzYCzLHZgH/S18sRXJBepgAAAABJRU5ErkJggg==":this.hcl.homePath+"image/checkbox.png"}},{key:"ResRadio",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABl0lEQVR42q2TIVMDMRCFX925iwN3kbhG4hpHXfMTKnFU4jj+QfkHxVWmrjI4cDmHTN3JnKuDt9fCTNupYGhm9jJzN/vt2913A/zzDC4OmC+D4VUzrALK/mWBjs+gClW7sYlnAUyeSnJKqcopIeUMJkFfM7SGvtEb+e6sWZwA9pV9jLFSUt4aWGOkOmJMCDFCKQUjkEKRoeMxwLPyBKw6u3eoquqgtc2mg18HKKoxWq+M0e4YkGMIpXMWk7sRmqaBD7t27a1h5SGVNIhtEmUdlagDwGIZvhbew89rlFclnl9eQUUiqJ9BPXvgTDqEEGDHRlQMTgAicTGfoSx3AOk950SARv34hNwS8BngrOVQ1RHAs4X3WLqxxWg0xNsHW/CBgMyBWrYwQmplCQmGLVCVOgb43OZJ3mZMnePEaYEtkCWyREdAlFVKSyvG4RD9OhquTDZRSSKHxIlrZqL3Q9+K7v0gMhwBh2vsISFOVUEjtbkSJZIsPpAhCox3byTep0b6OSEmo8TKBSyjZOqvlffJ5618kZ/pr+cbrN3EEfk2JvoAAAAASUVORK5CYII=":this.hcl.homePath+"image/radio.png"}},{key:"ResCombobox",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABaUlEQVR42pWSoXaDMBSGf96gshJZN96gzM2NN1jl3CIrI5GZq7xzlcxNIiuDm0xcZXCr6m4CobSj6+k9h3MJN/fLn5+bUKWPCOEwGT8AfWnOo3r/7jgnHvDy/HAqHoA2FNvAdAwQJYVSVa66Y7hxJVQE1AxYDv3toTvVA3yzMQaK6lBL54BcFZCKoPm7jwFgre1lRYDrM6C2dSd7JD1GAFy7e9xY1WZyi9trJHERlDwtJzc+vr539x9UufAISX8Bn7tmaEwXbO7eQqgKJIvgB/F18jzDbD6DLOm6grbP+tuyaQxYF+y8hNmb4IVSKph5AmwZUIwUsNQ0TeGcgdzUUCIPhp6Zu5kAxLD93zCmCYDbJo4V9CdkixSGFSgG3DbxUoHrhtsr8ABvIm0rXjtordlAcW4iD8vxjQEfdTOcki0yzp0Cb6KfPrGWEELwVM7OTYyAxtiTzFjjv6AY8K+JHkBEuDeSuzsu4hevJCC5R9/eDAAAAABJRU5ErkJggg==":this.hcl.homePath+"image/combobox.png"}},{key:"ResDateTime",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABZ0lEQVR42qWToXKDQBCGlycoMpI3AFlHZF1xjQuudeENQlzkydZdHfJk5MVVgos83mBxVNHdOwghyTCT6T/DsLcs3/27HJ5UZQdWCLNqAaTSF2sEpMtjwPo1HB/8AjSMa5sJszQGhNSg9qlL08vJR84ATYAY6rp2Plq3G9P5PojzotAQLADyNIFcSAu1gKHIYNQX49n2ubm2v+O45si7bDOX2Pn+k3MxUTMBDlCtTXMDGHafQNpxfc5zDs3UwTAP1u67gu06tEPdFX3c59OXEIypIMvFDODrCNs0tuaFpPh9zKdJDOWpgnx/B2DQd98YEfxFMBsrJa8ABTl4G1vIVqHtVShn29YcKkiW1AI7EGIGQFazVWynLQtnmweoDkcCxHYGdwGm/UcLdNK6DTvoJ39tm6V0BcvngBzQ0b52QGe925DtivpTPwjLyLe2yxNCFPj9P4EQcMyz+bwBqE4WCh6R91D1Hf0BdQcFUom0K78AAAAASUVORK5CYII=":this.hcl.homePath+"image/datetime.png"}},{key:"ResPageBreak",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABWUlEQVR42q2ToXLDMAyG/z5BC8ditrEajrVssGGDHRxrHqGP4LJCl3XMY4UuC3RZx+w3cFiGMrnJ0mTxCnbTXXynO+mTfkkZoTGlbYWBeaCkt7w4m5eUZz8jRl3AYpYgZru3I4SUyF6zAaQDMASYRgEbAnA2QbYWA8gVcCDAUxywe6cOtrL1zUGOBgBJgOUvgG8ZvvSQe3UbcPpwmN4ncM4hSZKLz1gCax19Hmsh4gAhVZXOOQUzmLMFf2CUYGvfkM8ZpNIXKVHAX623hdBBaJPRxNvqTTc6N5g/cvB5CqNVZAZKVyEw6C+KAuPx+Kr/7DC5m0AFCXQPNo8B9rpaPs967RGHJl+016hzDSlpCzo2RAKsOoDikx5K9r5ODis0xhBAxiWELayWix7A+6Y6UQLEnAkQtpDfABxPrk4IpdH8SKVvwWIraAY6DghX1rNOYu3XUqzR/3cHX8Ww4hFUAfk/AAAAAElFTkSuQmCC":this.hcl.homePath+"image/pagebreak.png"}},{key:"ResSecBreak",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAiklEQVR42mNkAAIDj4T/57fPZwCDnwwMHxmQwA8E8wOUH5CQyHBhxwJGEJcR2YCJCzcyEAIBHv64DSDGdrAhWA3YAHTBCmJc4AA0oAC7ATht/4Es8RG7AQStRgMoBlACqGrAfyifWJr6LiDfAIpjASUvgACOFEmHvIBuO9bUiCMl4stMH1AMQzUAACHddhFTMImBAAAAAElFTkSuQmCC":this.hcl.homePath+"image/secbreak.png"}},{key:"ResSymbol",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABeUlEQVR42q2SIZLjMBBFO8wsDRfqCDqCjqAjCA40DPQRfIMxXGi4sKFhLwtsaPjDwma/DZLMZKZqa2dV5VKVJL/+3f8f5Jvr8N8A5RTKTUW1Sse9kww5JpELBOIChFz33X3i1SOgDqE8adJp0XMkufKxiPEDRLP80IKkipWvzjHJKmMsBTcAqxdWnnRx0Q799LPOH6XmFx/5R5EzVK8x+NKmO2CAAciJ4mar/Vf9phefJVAUYQTUGyCfNlmolD/YUse/AMwEtLuCPioCIyIQXvOXgJNDlpAk6M0eWsjNE1aZOLIsHVrYpzNoUHlV89+0q9nS/J2NuVqJTmelTfGrlCdA704XUlqjsrp9GqTUfJNVNKK5VXuoXpgL9s/hzbU+BUlHQD3q7j9DQxWc8v0hqxtDlGWl3dzRyWvM9XAHDAG6IISwTWyJBKecHgD7/RYrXHHk0SWs6Q2QqjntUYZoOzxSrri1+3yave2AfeFCFeB9eprBv6xvA/4ASdnkEeDFANUAAAAASUVORK5CYII=":this.hcl.homePath+"image/symbol.png"}},{key:"ResFormula",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/UlEQVR42p1SwQqCQBCdRbRDgtKln+nUD0SQQV+TfY8E0d3+pw6lYIcU2d6KE9uymjkwPFfnvZl5qyAiDymRFY0IMYY0WCAMQzUZZVl2AqwtJe5PAZB9RIEwa101QK9AEASyrmsC+Ybj3PjsmStMkU+9Ap0lyDPg3TLBl8ACeUTukBddQCHIZ8AGWRm+bBsBx3EKjBoDY6BvM6ttVpq+CN41z/MDcA8U3EVKScoDDhAmqHmpGhyvyhergKUzR2n6IrTrEowaYYl3Ke/b+lJqvqy6rtFlw9S++u1EUURJknwKRQe5MaxdrfdfsX30zH3x/BgloDyASMr7DhX4K96jDpItemp94wAAAABJRU5ErkJggg==":this.hcl.homePath+"image/formula.png"}},{key:"ResFangJiao",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAfklEQVR42mNkoBAwUtsAUSB+TYoYI5rgVCBuAOJrSGKrgDgMyRAtqJpskBi6C2CSMENABuwHYkeoAejyWMMAWdFrJBeIomvGZYAomuLXWPivcRkgisXGqVD/orvoNS4DkP1sD9UMMuQgFnnqu4DiMKA4FihKB1RJiRTlBbIAAH0BRBFVxfApAAAAAElFTkSuQmCC":this.hcl.homePath+"image/fangjiao.png"}},{key:"ResTooth",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAXUlEQVR42mNkoBAwDgkDRIH4NTEGwBQi0yCwCojDoGx0+deMSJpBCrOBeCoaDTNgKhb5CKoaQI4X3oIMEAfiFUga0IE2EF/FIfeHKi4YHIFIcTrAB4hOiWQBig0AABKIOWu0bOp0AAAAAElFTkSuQmCC":this.hcl.homePath+"image/tooth.png"}},{key:"ResPamer",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAcUlEQVR42mNkoBAwDgkDRIH4NTEGiOLQPBWIw3DoZ2JEUrgfzUZk2hGIV2GRf45sAEhBAxYMc8FULHL5yAZgs5kBajDMC+jyb0EGiAPxChxhAALaQHwVh9wfdBeQGogsgycQcdlMKBBfUzUlkgUoNgAACeItOb7yZpUAAAAASUVORK5CYII=":this.hcl.homePath+"image/pamer.png"}},{key:"ResMedicine",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA5UlEQVR42qVTyw3CMAxt2AF1hzBFlugQ9MCdUw9sgLoDCkN0CiJ2yAocsCU/9GoFDiXSkxx/Xp7tNnR/nrCxbi+oLYJPwNk+JwsGjQdyKmbBaD7YTFItbxEkEPSCmwUOgocls43iwewVARREwUQKckNBaSngviZKyo3+E5GvZhDNyYMb3EAzXvVb0BlcBXfB0VSgldoaHEtiBSgsdp+tELIXp6BrrbHSCyDxk8e69Zz8GqtJL0RciWwkpRo7cwsoGKl//4EV8inJ5ZcCTB79JqdGCZ48A/7iui9+kEa7v7b8jT3Zuzee4Uwms6L7iAAAAABJRU5ErkJggg==":this.hcl.homePath+"image/medicine.png"}},{key:"ResGestational",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAmElEQVR42mNkoBAwDlkDRIH4NboBokjs11jEYWJaQDwViLOB+BojkqJVSCaDJZEUM0DFXkPVOQDxASCOwOYCUSQbYDQDlB2GJn8NPQxE8RgAstkR6gqcYbAKym4A4oNIXoAZrIMWPgz4XBCGZJsW1NAwfAagh0EYEr8Biq+hxye+WICFOCwGMDTjcgFynKOnAbwGkAUG3gAAwJQoKAez0JkAAAAASUVORK5CYII=":this.hcl.homePath+"image/gestational.png"}},{key:"ResPupil",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAWElEQVR42mNkoBAwovFFofRrHOox5BnRJPdD2Y5YDMEqj27AFShbB4cBGPJUdQHFYYBNASE+Xi8wEOATDEQGAnyCgUiyCygOA4pjYZikRHEo/RJHGGDIAwAm6jIRIbfR/gAAAABJRU5ErkJggg==":this.hcl.homePath+"image/pupil.png"}},{key:"ResLightperception",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAQUlEQVR42mNkoBAwovFFofRrIvkoBoAk90PZjlAaH/81NgOuQNk6UBofH6sBFLmA4jAYDcTRQKRaIIpD6ZdE8hkAjwM2EeWgxAIAAAAASUVORK5CYII=":this.hcl.homePath+"image/lightperception.png"}},{key:"ResFetalheart",get:function(){return this.hcl.embResources?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAj0lEQVR42mNkoBAwovFFofRrJP5rHHIYBoAU7IeyHaH0KiAOg7KR5V7jMuAKlK2DpAlmGLIcTgPQXbAfjY3XBej+FEUy4DUDEWFAtgHiQPwPizNFkQLxNRbvgQ0DGXABiN8DcTaaoqlA7ADEB3DIgUAEVVww8IGIrJmidECTlEhSXmCAxggIvETiv8QhBwYAXOVBKOeCDE0AAAAASUVORK5CYII=":this.hcl.homePath+"image/fetalheart.png"}}]),t}();function ph(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var yh=0,Fh=1,vh=2,Ih=3,gh=4,Ch=0,wh=1,Ah=function(t){m()(i,t);var e=ph(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t))._modalOkEvent=null,s.visible_=!1,s.width_=n,s.height_=o,s.keyPreview=!1,s.closeFree=!0,s.showState=yh,s.modalResult=Ch,s.onClose=null,s}return l()(i,[{key:"doKeyDown_",value:function(t){this.keyPreview&&(this.onKeyDown(t),t.keyCode===_e)||f()(F()(i.prototype),"doKeyDown_",this).call(this,t)}},{key:"doKeyPress_",value:function(t){this.keyPreview&&(this.onKeyPress(t),t.keyCode===_e)||f()(F()(i.prototype),"doKeyPress_",this).call(this,t)}},{key:"doKeyUp_",value:function(t){this.keyPreview&&(this.onKeyUp(t),t.keyCode===_e)||f()(F()(i.prototype),"doKeyUp_",this).call(this,t)}},{key:"doSetBounds_",value:function(){null!=this.parent&&this.parent.isClass(Bi)&&f()(F()(i.prototype),"doSetBounds_",this).call(this)}},{key:"doPaintBorder_",value:function(t){t.brush.color="#909090",this.paddingLeft>0&&t.fillBounds(0,0,this.paddingLeft,this.height),this.paddingTop&&t.fillBounds(0,0,this.width,this.paddingTop),this.paddingRight>0&&t.fillBounds(this.width-this.paddingRight,0,this.paddingRight,this.height),this.paddingBottom>0&&t.fillBounds(0,this.height-this.paddingBottom,this.width,this.paddingBottom)}},{key:"_checkParent",value:function(){null==this.parent&&this.hcl.application.addForm(this)}},{key:"doVisibleChange_",value:function(t){t||this.showState==gh||(this.showState=Fh),f()(F()(i.prototype),"doVisibleChange_",this).call(this,t)}},{key:"doCloseQuery",value:function(){return null==this.onCloseQuery||this.onCloseQuery()}},{key:"doClose_",value:function(){this.doCloseQuery()&&(this.visible=!1,this.showState=yh,null!==this.onClose&&this.onClose(),this.modalResult===wh&&null!==this._modalOkEvent&&this._modalOkEvent(this),this.modalResult=Ch,this.closeFree&&this.dispose())}},{key:"hide",value:function(){this.visible=!1}},{key:"show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vh;this.visible_||(this._checkParent(),this.showState=t,this.visible=!0)}},{key:"showNoActive",value:function(){this.show(Ih)}},{key:"showModal",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._modalOkEvent=t,this.modalResult=Ch,this.show(gh)}},{key:"moveCenter",value:function(){this.left=Math.trunc((this.hcl.width-this.width)/2),this.top=Math.trunc((this.hcl.height-this.height)/2)}},{key:"close",value:function(){this.doClose_()}}]),i}(Bi),Dh=function(t){m()(i,t);var e=ph(i);function i(t,n,o){var s,a,l;return r()(this,i),(l=e.call(this,t,n,o)).canFocus=!1,l.captionBar=new tn(t),l.captionBar.transparent=!0,l.captionBar.align=Xt,l.captionBar.paddingLeft=5,l.captionBar.paddingRight=5,l.captionBar.width=n,l.lblCaption=new Ki(t,"form"+(l.hcl.application.forms.count+1).toString()),l.lblCaption.align=Qt,l.captionBar.addControl(l.lblCaption),l.btnClose=new ji(t,"关闭"),l.btnClose.autoWidth=!0,l.btnClose.align=Zt,l.btnClose.image.src=l.hcl.theme.closeImage.src,l.btnClose.hint="点击关闭窗体",l.btnClose.onClick=function(){l.close()},l.captionBar.addControl(l.btnClose),f()((s=Jt()(l),F()(i.prototype)),"addControl",s).call(s,l.captionBar),l.clientArea=new qi(t),l.clientArea.borderVisible=!1,l.clientArea.transparent=!0,l.clientArea.align=$t,l.clientArea.onPaint=function(t){l.doClientPaint_(t)},f()((a=Jt()(l),F()(i.prototype)),"addControl",a).call(a,l.clientArea),l}return l()(i,[{key:"doClientPaint_",value:function(t){}},{key:"doGetPopupMenu",value:function(){return this.clientArea.popupMenu}},{key:"doSetPopupMenu",value:function(t){this.clientArea.popupMenu=t}},{key:"doSetColor_",value:function(){this.clientArea.color=this.color}},{key:"insertControl",value:function(t,e){this.clientArea.insertControl(t,e)}},{key:"addControl",value:function(t){this.clientArea.addControl(t)}},{key:"langText",value:function(t){return this.hcl.langText(t)}},{key:"caption",get:function(){return this.lblCaption.text},set:function(t){this.lblCaption.text=t}}]),i}(Ah),Ph=function(t){m()(i,t);var e=ph(i);function i(t){var n;return r()(this,i),(n=e.call(this,t,200,120)).onExecute=null,n.moveCenter(),n}return l()(i,[{key:"doPaintBackground_",value:function(t){t.brush.color=this.hcl.theme.backgroundStaticColor,t.fillRectShadow(this.clientRect(),this.hcl.theme.shadow)}},{key:"doExecute",value:function(){null!==this.onExecute&&this.onExecute()}}]),i}(Dh),kh=function(t){m()(i,t);var e=ph(i);function i(t){var n;return r()(this,i),(n=e.call(this,t))._reset(),n}return l()(i,[{key:"_reset",value:function(){this._fileName="",this._firstFile=null,this._files=null}},{key:"execute",value:function(t){var e=this;this._reset();var i=document.createElement("input");i.setAttribute("type","file"),i.setAttribute("style","visibility:hidden"),i.setAttribute("accept",null!=t?t:""),i.onchange=function(t){i.files.length>0&&(e._fileName=i.value,e._firstFile=i.files[0],e._files=i.files,e.doExecute())},document.body.appendChild(i);try{i.click()}finally{document.body.removeChild(i)}}},{key:"fileName",get:function(){return this._fileName}},{key:"firstFile",get:function(){return this._firstFile}},{key:"files",get:function(){return this._files}}],[{key:"execute",value:function(t,e,n){var o=new i(t);o.onExecute=function(){n(o)},o.execute(e)}}]),i}(Ph),xh=4,Rh=1,Th=2,bh=4,Bh=8,Nh=16,Oh=32,_h=64,Eh=128,Mh=256,Lh=512,Gh=function(t){m()(i,t);var e=ph(i);function i(t,n,o){var s,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];r()(this,i),(s=e.call(this,t)).caption=n,s.text=o,s.dlgBtn=null,s.dlgBtnWidth=60;for(var l=o.split(s.hcl.system.lineBreak),h=0,c=0,u=0;u<l.length;u++)c<(h=t.textWidth(null,l[u])+40)&&(c=h);s.contentHeight=l.length*(s.hcl.defaultFont.height+5),s.height=Math.max(s.height_,s.contentHeight+40),s.width=Math.max(s.width_,c),s.moveCenter();for(var f,d=Math.trunc((s.width-(a.length*s.dlgBtnWidth+(a.length-1)*s.hcl.theme.marginSpaceDouble))/2),m=function(e){switch(a[e]){case Rh:f=new Ji(t,"是");break;case Th:f=new Ji(t,"否");break;case bh:f=new Ji(t,"确定");break;case Bh:f=new Ji(t,"取消");break;case Nh:f=new Ji(t,"中止");break;case Oh:f=new Ji(t,"重试");break;case _h:f=new Ji(t,"忽略");break;case Eh:f=new Ji(t,"全部");break;case Mh:f=new Ji(t,"全部否");break;case Lh:f=new Ji(t,"全部是");break;default:f=new Ji(t,"确定")}f.onClick=function(){s.dlgBtn=a[e],s.modalResult=wh,s.close()},f.left=d,f.width=s.dlgBtnWidth,d+=f.width+s.hcl.theme.marginSpaceDouble,f.top=s.clientArea.height-10-f.height,s.addControl(f)},S=0;S<a.length;S++)m(S);return s}return l()(i,[{key:"doClientPaint_",value:function(t){f()(F()(i.prototype),"doClientPaint_",this).call(this,t);var e=this.text.split(this.hcl.system.lineBreak),n=Math.trunc((this.clientArea.height-this.contentHeight)/2+5);this.clientArea.controls.count>0&&(n-=this.clientArea.controls[0].height-5);for(var o=0;o<e.length;o++)t.textOut(20,n,e[o]),n+=this.hcl.defaultFont.height+5}},{key:"doCopy_",value:function(t){this.hcl.clipboard.clear(),this.hcl.localStorage.removeClipboardItem(),this.hcl.clipboard.setText(this.text),t&&t.clipboardData.setData(_.TXT,this.text)}},{key:"doCut_",value:function(t){this.doCopy_(t)}},{key:"execute",value:function(){var t=this;this.showModal((function(){t.doExecute()}))}}],[{key:"execute",value:function(t,e,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xh,r=arguments.length>5?arguments[5]:void 0,a=new i(t,e,n,o,s);a.onExecute=function(){r(a)},a.execute()}}]),i}(Ph),Hh=function(t){m()(i,t);var e=ph(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t)).caption=n,s.text=o,s.btn=new Ji(t,"确定"),s.btn.onClick=function(){s.modalResult=wh,s.close()},s.btn.left_=60,s.btn.top_=65,s.addControl(s.btn),s.edit=new on(t),s.edit.left_=20,s.edit.top_=30,s.edit.width_=160,s.addControl(s.edit),s}return l()(i,[{key:"doPaint_",value:function(t){f()(F()(i.prototype),"doPaint_",this).call(this,t),t.textOut(20,30,this.text)}},{key:"inputText",value:function(){return this.edit.text}}],[{key:"Query",value:function(t,e,n,o){new i(t,e,n).showModal(o)}}]),i}(Ph);function Vh(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Uh=function(t){m()(i,t);var e=Vh(i);function i(t){var n;return r()(this,i),(n=e.call(this,t))._height=120,n.caption="插入表格",n.edtRowCount=new hn(t,"行数","2"),n.edtRowCount.left=20,n.edtRowCount.top=20,n.edtRowCount.width=70,n.addControl(n.edtRowCount),n.edtColCount=new hn(t,"列数","2"),n.edtColCount.left=n.edtRowCount.left+n.edtRowCount.width+20,n.edtColCount.top=20,n.edtColCount.width=70,n.addControl(n.edtColCount),n.btnOk=new Ji(t,"确定"),n.btnOk.onClick=function(){n.modalResult=wh,n.close()},n.btnOk.left=Math.trunc((n.width-n.btnOk.width)/2),n.btnOk.top=n.edtColCount.top+n.edtColCount.height+20,n.addControl(n.btnOk),n}return l()(i)}(Ph);function Wh(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var zh=function(t){m()(i,t);var e=Wh(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).popupDownInTextArea_=!1,n.dropDownStyle=!0,n.adjustPosition=!0,n.autoDropDownWidth=!0,n.dropDownCount=8,n.dropDownWidth=100,n.listBox=new dn(t),n.listBox.onUpdate=function(t){n.updateRect(t)},n}return l()(i,[{key:"doPaint_",value:function(t){this.listBox.paintTo(t,0,0)}},{key:"doMouseEnter_",value:function(){this.listBox.mouseEnter()}},{key:"doMouseLeave_",value:function(){this.listBox.mouseLeave()}},{key:"doMouseWheel_",value:function(t){this.listBox.mouseWheel(t)}},{key:"doMouseDown_",value:function(t){this.popupDownInTextArea_=this.listBox.textArea().pointInAt(t.x,t.y),this.listBox.mouseDown(t)}},{key:"doMouseMove_",value:function(t){this.listBox.mouseMove(t)}},{key:"doMouseUp_",value:function(t){this.listBox.mouseUp(t),this.popupDownInTextArea_&&this.listBox.textArea().pointInAt(t.x,t.y)&&this.donePopup()}},{key:"calcSize",value:function(){this.autoDropDownWidth?this.listBox.width=this.listBox.getContentWidth()+this.hcl.theme.marginSpaceDouble+(this.listBox.scrollBarVisible?this.listBox._scrollBar.width:0):this.listBox.width=this.dropDownWidth;var t=this.dropDownCount*(this.listBox.font.height+this.hcl.theme.marginSpaceDouble),e=this.listBox.contentHeight;this.listBox.height=e>t?t:e,this.width=this.listBox.width,this.height=this.listBox.height}},{key:"popup",value:function(t,e,n){this.calcSize(),f()(F()(i.prototype),"popup",this).call(this,t,e,n)}},{key:"popupQuick",value:function(t,e,n){f()(F()(i.prototype),"popup",this).call(this,t,e,n)}},{key:"clear",value:function(){this.listBox.clear()}}]),i}(Si),Kh=function(t){m()(i,t);var e=Wh(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).monthCalendar=new Sn(t),n.monthCalendar.onUpdate=function(t){n.updateRect(t)},n.monthCalendar.onDone=function(){n.donePopup()},n}return l()(i,[{key:"doPaint_",value:function(t){this.monthCalendar.paintTo(t,0,0)}},{key:"doMouseEnter_",value:function(){this.monthCalendar.mouseEnter()}},{key:"doMouseLeave_",value:function(){this.monthCalendar.mouseLeave()}},{key:"doMouseWheel_",value:function(t){this.monthCalendar.mouseWheel(t)}},{key:"doMouseDown_",value:function(t){this.monthCalendar.mouseDown(t)}},{key:"doMouseMove_",value:function(t){this.monthCalendar.mouseMove(t)}},{key:"doMouseUp_",value:function(t){this.monthCalendar.mouseUp(t)}},{key:"calcSize",value:function(){this.width=this.monthCalendar.width,this.height=this.monthCalendar.height}},{key:"popup",value:function(t,e,n){this.calcSize(),f()(F()(i.prototype),"popup",this).call(this,t,e,n)}},{key:"popupQuick",value:function(t,e,n){f()(F()(i.prototype),"popup",this).call(this,t,e,n)}}]),i}(Si);function Jh(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var jh={Del:1,Add:2,Mod:4},Yh={Index:"Index",Code:"Code",Name:"Name",Frmtp:"Frmtp",Unit:"Unit",HideUnit:"HdUnit",Raw:"Raw",CMV:"CMV",CMVVCode:"CMVVCode",CMVVID:"CMVVID",DTFormat:"DTFMT",Trace:"Trace",TraceUser:"TcUser",TraceDT:"TcDT",TraceDel:"TcDel",TraceAdd:"TcAdd",TraceDelLevel:"TcDelL",TraceAddLevel:"TcAddL",TraceLink:"TraceLink",Secret:"Secret",Prompt:"Prompt",UnPrintEmptyRow:"UnPrintEmptyRow"},Qh={Index:"唯一索引",Code:"编码",Name:"名称",Frmtp:"类型",Unit:"单位(多个用英文逗号分隔)",HideUnit:"是否隐藏单位",CMV:"值域",CMVVCode:"值编码",DTFormat:"日期时间格式",TraceDel:"删除痕迹的操作信息",TraceAdd:"添加痕迹的操作信息",TraceDelLevel:"删除痕迹的级别",TraceAddLevel:"添加痕迹的级别",Secret:"是否保密信息",Prompt:"提示信息"},Xh="2",Zh={Radio:"RS",Multiselect:"MS",Number:"N",String:"S",Date:"D",Time:"T",DateTime:"DT"},qh={Radio:"RS(单选)",Multiselect:"MS(多选)",Number:"N(数值)",String:"S(字符串)",Date:"D(日期)",Time:"T(时间)",DateTime:"DT(日期时间)"},$h="ItemMutex",tc="MutexYes",ec="MutexNo",ic=0,nc=1,oc=l()((function t(){r()(this,t),this.Problem=ic,this.Offset=0,this.Length=0}));function sc(t,e){null!=e.ClearProperty&&e.ClearProperty&&t.Propertys.clear(),null!=e.Index&&Yl.HCSetProperty(t.Propertys,Yh.Index,e.Index),null!=e.Name&&Yl.HCSetProperty(t.Propertys,Yh.Name,e.Name),null!=e.Code&&Yl.HCSetProperty(t.Propertys,Yh.Code,e.Code),null!=e.Unit&&Yl.HCSetProperty(t.Propertys,Yh.Unit,e.Unit),null!=e.CMV&&Yl.HCSetProperty(t.Propertys,Yh.CMV,e.CMV),null!=e.CMVVCode&&Yl.HCSetProperty(t.Propertys,Yh.CMVVCode,e.CMVVCode),null!=e.Text&&(t.Text=e.Text),null!=e.DeleteAllow&&(t.DeleteAllow=e.DeleteAllow),null!=e.EditProtect&&(t.EditProtect=e.EditProtect),null!=e.AllocValue&&t.hasOwnProperty("AllocValue")&&(t.AllocValue=e.AllocValue),null!=e.Propertys&&("object"==o()(e.Propertys)?Yl.SetItemPropertyJSON(e.Propertys,t):Yl.SetItemPropertyString(e.Propertys,t)),e.Scripts&&("object"==o()(e.Scripts)?Yl.SetPropertyJSON(t.Scripts,e.Scripts):Yl.SetPropertyString(e.Scripts,t.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}var rc=function(t){m()(i,t);var e=Jh(i);function i(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return r()(this,i),(n=e.call(this,t,o)).FIsElement=!1,n.FEditProtect=!1,n.FDeleteAllow=!0,n.FAllocOnly=!1,n.FCopyProtect=!1,n.FAllocValue=!1,n.FOutOfRang=!1,n.FMouseIn=!1,n.HasFrmtp=!1,n.AllocMust=!1,n.Changed=!1,n.FTraceStyles=new q,n.FPropertys=new rt,n.Scripts=new rt,n}return l()(i,[{key:"HasProp",value:function(t){return this.FPropertys.hasKey(t)}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){e=e.toString(),"Text"===t||("EditProtect"==t?this.FEditProtect=L.parseBooleanDef(e,this.FEditProtect):"DeleteAllow"==t?this.FDeleteAllow=L.parseBooleanDef(e,this.FDeleteAllow):"CopyProtect"==t?this.FCopyProtect=L.parseBooleanDef(e,this.FCopyProtect):"AllocValue"==t?this.FAllocValue=L.parseBooleanDef(e,this.FAllocValue):(Yl.HCSetProperty(this.FPropertys,t,e),this.PropertyChange()))}},{key:"GetScript",value:function(t){return Yl.HCGetProperty(this.Scripts,t)}},{key:"SetScript",value:function(t,e){Yl.HCSetProperty(this.Scripts,t,e,!1)}},{key:"GetDefaultText",value:function(){var t=this.FPropertys.valueByKey(Yh.Prompt)||"";return""===t&&(t=this.FPropertys.valueByKey(Yh.Name)||""),""===t&&(t="未填写"),t}},{key:"SetText",value:function(t){""!=t?f()(F()(i.prototype),"SetText",this).call(this,t):this.IsElement?this.Text=this.GetDefaultText():f()(F()(i.prototype),"SetText",this).call(this,"")}},{key:"SetVisible",value:function(t){f()(F()(i.prototype),"SetVisible",this).call(this,t),this.FMouseIn=!1}},{key:"MouseEnter",value:function(){this.FMouseIn=!0,f()(F()(i.prototype),"MouseEnter",this).call(this)}},{key:"MouseLeave",value:function(){this.FMouseIn=!1,f()(F()(i.prototype),"MouseLeave",this).call(this)}},{key:"SetActive",value:function(t){t||(this.FMouseIn=!1),f()(F()(i.prototype),"SetActive",this).call(this,t)}},{key:"TextEffective",value:function(){return this.FTraceStyles.has(jh.Del)?"":f()(F()(i.prototype),"TextEffective",this).call(this)}},{key:"SubStringEffective",value:function(t,e){return this.FTraceStyles.has(jh.Del)?"":f()(F()(i.prototype),"SubStringEffective",this).call(this,t,e)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FTraceStyles.value=t.TraceStyles.value,this.FEditProtect=t.EditProtect,this.FDeleteAllow=t.DeleteAllow,this.FCopyProtect=t.CopyProtect,this.FAllocOnly=t.AllocOnly,this.FAllocValue=t.AllocValue,this.FOutOfRang=t.OutOfRang,this.FPropertys.assign(t.Propertys),this.PropertyChange(),this.Scripts.assign(t.Scripts)}},{key:"CanConcatItems",value:function(t){var e=f()(F()(i.prototype),"CanConcatItems",this).call(this,t);return e&&(e=this.GetValue(Yh.Index)===t.GetValue(Yh.Index)&&this.FTraceStyles.value===t.TraceStyles.value&&this.FEditProtect===t.FEditProtect&&this.FDeleteAllow===t.DeleteAllow&&this.FCopyProtect===t.CopyProtect&&this.GetValue(Yh.TraceDel)===t.GetValue(Yh.TraceDel)&&this.GetValue(Yh.TraceAdd)===t.GetValue(Yh.TraceAdd)&&this.GetValue(Yh.TraceDelLevel)===t.GetValue(Yh.TraceDelLevel)&&this.GetValue(Yh.TraceAddLevel)===t.GetValue(Yh.TraceAddLevel)),e}},{key:"GetTraceHint",value:function(){var t="";this.FTraceStyles.has(jh.Add)&&""===(t=this.GetValue(Yh.TraceAdd))&&(t="未设置添加痕迹信息");var e="";return this.FTraceStyles.has(jh.Del)&&""===(e=this.GetValue(Yh.TraceDel))&&(e="未设置删除痕迹信息"),t+"\r\n"+e}},{key:"GetHint",value:function(){if(0===this.FTraceStyles.value)return this.GetValue(Yh.Name);var t=this.GetTraceHint();return""!==t?t:"未设置痕迹信息"}},{key:"DeleteProperty",value:function(t){Yl.HCRemoveProperty(this.FPropertys,t)}},{key:"CanInputFree",value:function(){return!this.FEditProtect&&!this.FAllocOnly&&(!this.IsElement||!this.HasFrmtp)}},{key:"AcceptAction",value:function(t,e,n){var o=f()(F()(i.prototype),"AcceptAction",this).call(this,t,e,n);if(o)switch(n){case rh.InsertItem:case rh.InsertText:(this.FEditProtect||this.FAllocOnly)&&(o=0===t||t===this.Length);break;case rh.ConcatText:if(this.FEditProtect)return!1;if(this.IsElement)return!this.FAllocOnly&&(!e&&!this.HasFrmtp);if(0!==this.FTraceStyles.value)return!1;break;case rh.BackDeleteText:(this.FEditProtect||this.FAllocOnly)&&(o=0==t);break;case rh.DeleteText:(this.FEditProtect||this.FAllocOnly)&&(o=t==this.Length);break;case rh.ReturnItem:if(this.Length>1&&(this.FIsElement||this.FEditProtect)&&t>0&&t<this.Length)return!1;break;case rh.DeleteItem:return!this.FEditProtect}return o}},{key:"AdjustWordByOffset",value:function(t){return this.IsElement?{result:!0,startOffset:0,endOffset:this.Length}:f()(F()(i.prototype),"AdjustWordByOffset",this).call(this,t)}},{key:"PaintTextBefor",value:function(t,e,i,n,o){this.FIsElement&&!this.FAllocValue&&(n.font.styles.value=t.PromptFontStyles.value,n.font.color=t.PromptFontColor)}},{key:"PaintTextAfter",value:function(t,e,i,n,o){this.FIsElement&&!this.FAllocValue&&(n.font.styles.value=t.TextStyles[this.StyleNo].FontStyles.value,n.font.color=t.TextStyles[this.StyleNo].Color)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FEditProtect&&(o|=128),this.FOutOfRang&&(o|=64),this.FCopyProtect&&(o|=32),this.FAllocValue&&(o|=16),this.FDeleteAllow&&(o|=8),this.FAllocOnly&&(o|=4),this.AllocMust&&(o|=2),t.writeByte(o),this.hcl.emrCommon.G_SaveTrace?t.writeByte(this.FTraceStyles.value):t.writeByte(0),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator)),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n);var o=t.readByte();this.FEditProtect=L.isOdd(o>>7),this.FOutOfRang=L.isOdd(o>>6),this.FCopyProtect=L.isOdd(o>>5),this.FAllocValue=L.isOdd(o>>4),this.FDeleteAllow=!(n>34)||L.isOdd(o>>3),this.FAllocOnly=L.isOdd(o>>2),this.AllocMust=L.isOdd(o>>1),o=t.readByte(),this.FTraceStyles.value=n>46?o:0===o?0:1===o?jh.Del:jh.Add;var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.FPropertys),n<=46&&""!==this.GetValue(Yh.Trace)&&(0===o||(1===o?this.SetValue(Yh.TraceDel,this.GetValue(Yh.Trace)):this.SetValue(Yh.TraceAdd,this.GetValue(Yh.Trace))),this.SetValue(Yh.Trace,"")),this.PropertyChange(),n>57&&(s=Yl.HCLoadTextFromStream(t,n),Yl.SetPropertyString(s,this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"ToHtml",value:function(){if(this.hcl.emrCommon.ToHtmlUseTrace){var t="",e='<a class="fs'+this.StyleNo.toString()+'"';return this.FTraceStyles.has(jh.Add)&&(t+=" underline"),this.FTraceStyles.has(jh.Del)&&(t+=" line-through"),""!==t&&(t+=' style="text-decoration:'+t+'"'),e+t+">"+this.Text+"</a>"}return this.FTraceStyles.has(jh.Del)?"":f()(F()(i.prototype),"ToHtml",this).call(this)}},{key:"ToXml",value:function(t){f()(F()(i.prototype),"ToXml",this).call(this,t),this.FEditProtect&&t.SetAttribute("editprotect","1"),this.FOutOfRang&&t.SetAttribute("outofrang","1"),this.FCopyProtect&&t.SetAttribute("copyprotect","1"),this.FAllocValue&&t.SetAttribute("allocvalue","1"),this.FDeleteAllow&&t.SetAttribute("deleteallow","1"),this.FAllocOnly&&t.SetAttribute("alloconly","1"),t.SetAttribute("tracestyles",this.FTraceStyles.value.toString());var e=Yl.GetPropertyString(this.FPropertys);""!=e&&t.SetAttribute("property",e)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.IsElement&&!this.FTraceStyles.has(jh.Del)?f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"EditProtect":'+(this.EditProtect?"true":"false")+',"CopyProtect":'+(this.CopyProtect?"true":"false")+',"DeleteAllow":'+(this.DeleteAllow?"true":"false")+',"AllocValue":'+(this.AllocValue?"true":"false")+',"AllocOnly":'+(this.AllocOnly?"true":"false")+',"AllocMust":'+(this.AllocMust?"true":"false")+',"OutOfRang":'+(this.OutOfRang?"true":"false")+',"Propertys":{'+Yl.GetPropertyJSONString(this.FPropertys)+"}":""}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.ClearProperty&&t.ClearProperty&&this.FPropertys.clear(),t.Index&&Yl.HCSetProperty(this.FPropertys,Yh.Index,t.Index),t.Name&&Yl.HCSetProperty(this.FPropertys,Yh.Name,t.Name),t.Code&&Yl.HCSetProperty(this.FPropertys,Yh.Code,t.Code),t.Unit&&Yl.HCSetProperty(this.FPropertys,Yh.Unit,t.Unit),t.Frmtp&&Yl.HCSetProperty(this.FPropertys,Yh.Frmtp,t.Frmtp),t.ItemMutex&&Yl.HCSetProperty(this.FPropertys,$h,t.ItemMutex),t.MutexYes&&Yl.HCSetProperty(this.FPropertys,tc,t.MutexYes),t.MutexNo&&Yl.HCSetProperty(this.FPropertys,ec,t.MutexNo),t.CMV&&Yl.HCSetProperty(this.FPropertys,Yh.CMV,t.CMV),t.CMVVCode&&Yl.HCSetProperty(this.FPropertys,Yh.CMVVCode,t.CMVVCode),t.CMVVID&&Yl.HCSetProperty(this.FPropertys,Yh.CMVVID,t.CMVVID),t.Prompt&&Yl.HCSetProperty(this.FPropertys,Yh.Prompt,t.Prompt),t.Propertys&&("object"==o()(t.Propertys)?Yl.SetItemPropertyJSON(t.Propertys,this):Yl.SetItemPropertyString(t.Propertys,this)),t.Scripts&&("object"==o()(t.Scripts)?Yl.SetPropertyJSON(this.Scripts,t.Scripts):Yl.SetPropertyString(t.Scripts,this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator)),null!=t.AllocValue&&(!0===t.AllocValue||"1"===t.AllocValue?this.AllocValue=!0:this.AllocValue=!1),null!=t.AllocOnly&&(this.FAllocOnly=t.AllocOnly),null!=t.AllocMust&&(this.AllocMust=t.AllocMust),null!=t.DeleteAllow&&(this.FDeleteAllow=t.DeleteAllow),null!=t.EditProtect&&(this.FEditProtect=t.EditProtect),null!=t.CopyProtect&&(this.FCopyProtect=t.CopyProtect),null!=t.OutOfRang&&(this.FOutOfRang=t.OutOfRang),this.PropertyChange()}},{key:"SetPropertyJSON",value:function(t){this.ParseJSONObject(t)}},{key:"SetValueDomain",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.Text=t,"string"==typeof e&&Yl.HCSetProperty(this.FPropertys,Yh.CMVVCode,e),"string"==typeof i&&Yl.HCSetProperty(this.FPropertys,Yh.Unit,i),this.FAllocValue=n}},{key:"SetValueDomainObj",value:function(t){t.Text&&"string"==typeof t.Text&&(this.Text=t.Text),t.CMVVCode&&"string"==typeof t.CMVVCode&&Yl.HCSetProperty(this.FPropertys,Yh.CMVVCode,t.CMVVCode),t.CMVVID&&"string"==typeof t.CMVVID&&Yl.HCSetProperty(this.FPropertys,Yh.CMVVID,t.CMVVID),t.Unit&&"string"==typeof t.Unit&&Yl.HCSetProperty(this.FPropertys,Yh.Unit,t.Unit),this.FAllocOnly=!0}},{key:"Reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Yl.HCRemoveProperty(this.FPropertys,Yh.CMVVCode),Yl.HCRemoveProperty(this.FPropertys,Yh.Unit),this.ClearTrace(),this.FAllocValue=!1,null!==t?(""==t.Text&&(t.Text=this.Name||this.Text),this.ParseJSONObject(t)):this.Text=this.GetDefaultText()}},{key:"ClearTrace",value:function(){Yl.HCRemoveProperty(this.FPropertys,Yh.TraceAdd),Yl.HCRemoveProperty(this.FPropertys,Yh.TraceAddLevel),Yl.HCRemoveProperty(this.FPropertys,Yh.Trace),Yl.HCRemoveProperty(this.FPropertys,Yh.TraceDel),Yl.HCRemoveProperty(this.FPropertys,Yh.TraceDelLevel),Yl.HCRemoveProperty(this.FPropertys,Yh.Trace),this.FTraceStyles.value=0}},{key:"CheckHasFrmtp",value:function(t){for(var e in Zh)if(t===Zh[e])return!0;return!1}},{key:"PropertyChange",value:function(){this.FIsElement=null!=this.FPropertys.valueByKey(Yh.Index),this.HasFrmtp=this.CheckHasFrmtp(this.GetValue(Yh.Frmtp))}},{key:"IsElement",get:function(){return this.FIsElement}},{key:"MouseIn",get:function(){return this.FMouseIn}},{key:"TraceStyles",get:function(){return this.FTraceStyles},set:function(t){this.FTraceStyles=t}},{key:"EditProtect",get:function(){return this.FEditProtect},set:function(t){this.FEditProtect=t}},{key:"DeleteAllow",get:function(){return this.FDeleteAllow},set:function(t){this.FDeleteAllow=t}},{key:"CopyProtect",get:function(){return this.FCopyProtect},set:function(t){this.FCopyProtect=t}},{key:"AllocOnly",get:function(){return this.FAllocOnly},set:function(t){this.FAllocOnly=t}},{key:"AllocValue",get:function(){return this.FAllocValue},set:function(t){this.FAllocValue=t}},{key:"OutOfRang",get:function(){return this.FOutOfRang},set:function(t){this.FOutOfRang=t}},{key:"Propertys",get:function(){return this.FPropertys}},{key:"Index",get:function(){return this.GetValue(Yh.Index)}},{key:"Code",get:function(){return this.GetValue(Yh.Code)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.Code):this.SetValue(Yh.Code,t)}},{key:"Name",get:function(){return this.GetValue(Yh.Name)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.Name):this.SetValue(Yh.Name,t)}},{key:"CMVVCode",get:function(){return this.GetValue(Yh.CMVVCode)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.CMVVCode):this.SetValue(Yh.CMVVCode,t)}},{key:"Frmtp",get:function(){return this.GetValue(Yh.Frmtp)}}],[{key:"GetSecretRange",value:function(t){if(""==t)return{low:-1,hi:-1};var e=-1,i=-1,n=t.indexOf("-"),o="";return n<0?e=parseInt(t):0===n?(e=1,null!=(o=t.substr(n+1,t.length-n-1))&&""!=o&&(i=parseInt(o))):(o=t.substr(0,n),e=parseInt(o),t.length-n>1&&null!=(o=t.substr(n+1,t.length-n-1))&&""!=o&&(i=parseInt(o))),{low:e,hi:i}}}]),i}(function(t){m()(i,t);var e=Jh(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FSyntaxs=null,o}return l()(i,[{key:"SyntaxAdd",value:function(t,e,i){var n=new oc;n.Offset=t,n.Length=e,n.Problem=i,null==this.FSyntaxs&&(this.FSyntaxs=new ot),this.FSyntaxs.add(n)}},{key:"SyntaxClear",value:function(){null!=this.FSyntaxs&&this.FSyntaxs.clear()}},{key:"SyntaxCount",value:function(){return null!=this.FSyntaxs?this.FSyntaxs.count:0}},{key:"Syntaxs",get:function(){return this.FSyntaxs}}]),i}(Vs)),ac=function(t){m()(i,t);var e=Jh(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,n,o)).FEditProtect=!1,s.FDeleteAllow=!0,s.FPropertys=new rt,s.IsDynamic=!1,s}return l()(i,[{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){e=e.toString(),"EditProtect"==t?this.FEditProtect=L.parseBooleanDef(e,this.FEditProtect):"DeleteAllow"==t?this.FDeleteAllow=L.parseBooleanDef(e,this.FDeleteAllow):Yl.HCSetProperty(this.FPropertys,t,e)}},{key:"DoCreateCell",value:function(t){return new lc(this.hcl,t)}},{key:"Assign",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.FEditProtect=t.EditProtect,e||this.FPropertys.assign(t.Propertys),f()(F()(i.prototype),"Assign",this).call(this,t,e)}},{key:"SaveToStream",value:function(t){f()(F()(i.prototype),"SaveToStream",this).call(this,t);var e=0;this.FEditProtect&&(e|=128),this.IsDynamic&&(e|=64),this.FDeleteAllow&&(e|=32),t.writeByte(e),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e),e>53){if(e>59){var n=t.readByte();this.FEditProtect=L.isOdd(n>>7),this.IsDynamic=L.isOdd(n>>6),e>61&&(this.FDeleteAllow=L.isOdd(n>>5))}var o=Yl.HCLoadTextFromStream(t,e);e>64?Yl.SetPropertyString(o,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(o,this.FPropertys)}}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return f()(F()(i.prototype),"ToJSONString",this).call(this,t,e)}},{key:"EditProtect",get:function(){return this.FEditProtect}},{key:"Propertys",get:function(){return this.FPropertys}}]),i}(mr),lc=function(t){m()(i,t);var e=Jh(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FEditProtect=!1,o.FDeleteAllow=!0,o.FPropertys=new rt,o}return l()(i,[{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"===t?this.FEditProtect=L.parseBooleanDef(e,this.FEditProtect):"DeleteAllow"===t?this.FDeleteAllow=L.parseBooleanDef(e,this.FDeleteAllow):Yl.HCSetProperty(this.FPropertys,t,e)}},{key:"SetEditProtect",value:function(t){this.FEditProtect=t,null!=this.CellData&&(this.CellData.ReadOnly=this.FEditProtect)}},{key:"Assign",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.FEditProtect=t.EditProtect,e||this.FPropertys.assign(t.Propertys),f()(F()(i.prototype),"Assign",this).call(this,t,e)}},{key:"DataAsNumber",value:function(){if(null!==this.CellData){var t=this.CellData.SaveToText();return L.parseIntDef(t,0)}return 0}},{key:"SaveToStream",value:function(t){f()(F()(i.prototype),"SaveToStream",this).call(this,t);var e=0;this.FEditProtect&&(e|=128),this.FDeleteAllow&&(e|=64),t.writeByte(e),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),n>53){if(n>56){var o=t.readByte();this.FEditProtect=L.isOdd(o>>7),n>61&&(this.FDeleteAllow=L.isOdd(o>>6))}var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.FPropertys)}}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return f()(F()(i.prototype),"ToJSONString",this).call(this,t,e)}},{key:"Propertys",get:function(){return this.FPropertys}},{key:"EditProtect",get:function(){return this.FEditProtect},set:function(t){this.SetEditProtect(t)}}]),i}(fr),hc=function(t){m()(i,t);var e=Jh(i);function i(){var t;return r()(this,i),(t=e.call(this)).colIndex=0,t}return l()(i)}(Bn),cc=function(t){m()(i,t);var e=Jh(i);function i(){return r()(this,i),e.call(this)}return l()(i,[{key:"addColumn",value:function(t,e,i,n,o,s){var r=new hc;return r.colIndex=t,r.fieldName=e,r.fieldTitle=o,r.fieldProp=s,r.fieldTypeParse(i),r.inputStyleParse(n),r.static=!1,this.add(r),r}}]),i}(ot),uc=function(t){m()(i,t);var e=Jh(i);function i(t,n,o,s,a){var l;return r()(this,i),(l=e.call(this,t,n,o,s,a)).FDrawRect=new nt,l.FEditProtect=!1,l.FDeleteAllow=!0,l.FPropertys=new rt,l.Scripts=new rt,l.FAutoLineCol=-1,l.FPaintCellCol=-1,l.FAutoFillPage=!1,l.FLightEditRow=!1,l.FLightEditCol=!1,l.UseToolButton=!1,l.Columns=new cc,l.OnSelectCellChange=null,l.OnScript_SelectCellChange=null,l.OnScript_CellItemChange=null,l.OnCellPopup=null,l}return l()(i,[{key:"GetLastVersion",value:function(){return 2}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"==t?this.FEditProtect=L.parseBooleanDef(e,this.FEditProtect):"DeleteAllow"==t?this.FDeleteAllow=L.parseBooleanDef(e,this.FDeleteAllow):(Yl.HCSetProperty(this.FPropertys,t,e),this.PropertyChange())}},{key:"GetScript",value:function(t){return Yl.HCGetProperty(this.Scripts,t)}},{key:"SetScript",value:function(t,e){Yl.HCSetProperty(this.Scripts,t,e,!1)}},{key:"CellChangeByAction",value:function(t,e,n){f()(F()(i.prototype),"CellChangeByAction",this).call(this,t,e,n)}},{key:"DoSelectCellChange",value:function(t,e,n,o){0===this.Scripts.count?(f()(F()(i.prototype),"DoSelectCellChange",this).call(this,t,e,n,o),null!==this.OnSelectCellChange&&this.OnSelectCellChange(this,t,e,n,o)):this.FEditProtect||null===this.OnScript_SelectCellChange||this.OnScript_SelectCellChange(this,t,e,n,o)}},{key:"DoCellDataItemChange",value:function(t,e,n,o){if(null!==this.OnScript_CellItemChange){var s=this.GetRowColByCellData(t);this.OnScript_CellItemChange(this,s.row,s.col,t,e,n,o)}return f()(F()(i.prototype),"DoCellDataItemChange",this).call(this,t,e,n,o)}},{key:"DoCreateRow",value:function(t,e){return new ac(this.hcl,t,e)}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){this.FDrawRect.resetRect(e),f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l)}},{key:"TakeColumn",value:function(t,e,i){if(this.Columns.count>0&&t>this.GetFixRowLast()&&e>this.GetFixColLast()){var n=this.GetColumn(e);null!==n&&i(n)}}},{key:"DoCellMouseMove",value:function(t,e,n){var o=this;f()(F()(i.prototype),"DoCellMouseMove",this).call(this,t,e,n),this.TakeColumn(e,n,(function(i){switch(i.inputStyle){case Tn.Edit:break;case Tn.Combobox:case Tn.DateTime:t.x>o.GetCellWidth(e,n)-16&&(o.OwnerData.Style.Cursor=pe)}}))}},{key:"DoPopupDateTime",value:function(t,e,i,n){var o=this;null==this._datetimePopup&&(this._datetimePopup=new Kh(this.hcl),this._datetimePopup.onClose=function(){o._datetimePopup=null},this._datetimePopup.onDone=function(){o.setCellText(t,e,o._datetimePopup.monthCalendar.dateTime.format("yyyy-MM-dd hh:mm:ss")),o.ReFormatRequest()}),this._datetimePopup.calcSize(),this._datetimePopup.popupQuick(i+this.GetCellWidth(t,e)-this._datetimePopup.width,n,!0)}},{key:"DoPopupCombobox",value:function(t,e,i,n,o){var s=this;if(null!=o){if(null==this._comboboxPopup&&(this._comboboxPopup=new zh(this.hcl),this._comboboxPopup.onClose=function(){s._comboboxPopup=null},this._comboboxPopup.onDone=function(){s.setCellText(t,e,s._comboboxPopup.listBox.text),s.ReFormatRequest()}),this._comboboxPopup.listBox.clear(),null!=o.cv)for(var r=0,a=o.cv.length;r<a;r++)this._comboboxPopup.listBox.addItem(o.cv[r].text);this._comboboxPopup.listBox.itemIndex=this._comboboxPopup.listBox.itemIndexOf(this.getCellText(t,e)),this._comboboxPopup.calcSize(),this._comboboxPopup.popupQuick(i+this.GetCellWidth(t,e)-this._comboboxPopup.width,n,!0)}}},{key:"GetCellLeftBottomScreenCoord",value:function(t,e){var i=this.GetCellRect(t,e).leftBottom;return i=this.OwnerData.GetScreenCoord(this.FDrawRect.left+i.x+(this.FBorderVisible?this.FBorderWidthPix:0),this.FDrawRect.top+i.y+(this.FBorderVisible?this.FBorderWidthPix:0))}},{key:"DoCellMouseUp",value:function(t,e,n){var o=this;f()(F()(i.prototype),"DoCellMouseUp",this).call(this,t,e,n),this.TakeColumn(e,n,(function(i){switch(i.inputStyle){case Tn.Edit:break;case Tn.Combobox:if(t.x>o.GetCellWidth(e,n)-16&&null!==o.OnCellPopup){var s=o.GetCellLeftBottomScreenCoord(e,n),r=o.OnCellPopup(o,e,n,s.x,s.y,i,o.FRows[e][n].CellData.Items[0].Text);null!=r&&o.DoPopupCombobox(e,n,s.x,s.y,r)}break;case Tn.CheckBox:break;case Tn.DateTime:if(t.x>o.GetCellWidth(e,n)-16&&null!==o.OnCellPopup){var a=o.GetCellLeftBottomScreenCoord(e,n);null==o.OnCellPopup(o,e,n,a.x,a.y,i,o.FRows[e][n].CellData.Items[0].Text)&&o.DoPopupDateTime(e,n,a.x,a.y,o.FRows[e][n].CellData.Items[0].Text)}}}))}},{key:"PaintStyleEdit",value:function(t,e,i,n){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(o){var s=nt.CreateByBounds(i.right-16,i.top+Math.trunc((i.height-16)/2),16,16);(t===this.FMouseMoveRow&&e===this.FMouseMoveCol||this.IsEditCell(t,e))&&(n.brush.color=this.hcl.theme.backgroundStaticColor,n.fillRect(s),n.pen.width=1,n.pen.style=_t.Solid,n.pen.color=this.hcl.theme.borderColor,n.rectangleRect(s)),this.hcl.theme.drawDropDown(n,s)}}},{key:"DoCellPaintDataBefor",value:function(t,e,i,n,o){this.FPaintCellCol=e}},{key:"DoCellPaintDataAfter",value:function(t,e,i,n,o){var s=this;o.Print||(null!==this.FRows[t][e].CellData&&this.FRows[t][e].CellData.Scripts.count>0&&Yl.HCDrawScriptMark(n,i.left,i.top),this.TakeColumn(t,e,(function(o){switch(o.inputStyle){case Tn.Edit:s.PaintStyleEdit(t,e,i,n,!1);break;case Tn.Combobox:s.PaintStyleEdit(t,e,i,n,!0);break;case Tn.CheckBox:break;case Tn.DateTime:s.PaintStyleEdit(t,e,i,n,!0)}})))}},{key:"DoCellDataDrawItemPaintAfter",value:function(t,e,n,o,s,r,a,l,h,c,u,d){f()(F()(i.prototype),"DoCellDataDrawItemPaintAfter",this).call(this,t,e,n,o,s,r,a,l,h,c,u,d),this.FPaintCellCol===this.FAutoLineCol&&n<t.DrawItems.count-1&&t.DrawItems[n+1].LineFirst&&(u.pen.width=this.BorderWidthPix,u.pen.color=Ft.Black,d.Print?u.pen.style=_t.Solid:u.pen.style=_t.Dot,u.drawLineDriect(this.FDrawRect.left,o.bottom,this.FDrawRect.right,o.bottom))}},{key:"DoPaintCellBorderSides",value:function(t,e,i,n,o,s,r){if(this.FLightEditRow&&e==this.SelectCellRang.StartRow){var a=t.pen.width;t.pen.width++;var l=t.pen.color;t.pen.color=Ft.Blue,t.drawLineDriect(n,o,s,o),t.drawLineDriect(n,r-1,s,r-1),t.pen.width=a,t.pen.color=l}if(this.FLightEditCol&&i==this.SelectCellRang.StartCol){var h=t.pen.width;t.pen.width++;var c=t.pen.color;t.pen.color=Ft.Blue,t.drawLineDriect(n,o,n,r),t.drawLineDriect(s-1,o,s-1,r),t.pen.width=h,t.pen.color=c}}},{key:"DoFormatToDrawItem",value:function(){if(this.FAutoFillPage){var t=this.RowCount-1,e=1,i=!1;this.FixRow>=0&&(e=this.FixRow+this.FixRowCount);for(var n=this.RowCount-1;n>=e&&!i;n--){if(!this.Rows[n].IsDynamic){t=n,i=!0;break}for(var o=this.Rows[n].ColCount,s=0;s<o;s++){if(null==this.Rows[n][s].CellData){t=n,i=!0;break}if(!this.Rows[n][s].CellData.IsEmptyData()){t=n,i=!0;break}}}i||(t=e);var r=this.GetEditCellWith();r.row>=0&&t<r.row?t=r.row:this.SelectCellRang.SelectExists()&&t<this.SelectCellRang.EndRow&&(t=this.SelectCellRang.EndRow);for(var a=this.RowCount-1;a>t;a--)this.Rows.delete(a)}}},{key:"DoCellDataCanEditItem",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!this.FEditProtect&&f()(F()(i.prototype),"DoCellDataCanEditItem",this).call(this,t,e,n)}},{key:"DoCreateRowDynamic",value:function(t,e){var n=f()(F()(i.prototype),"DoCreateRowDynamic",this).call(this,t,e);return n.Assign(this.Rows.last,!0),n.IsDynamic=!0,n}},{key:"CalcDynamicRowHeight",value:function(){var t=0;return t=this.Rows.last[0].CellData.Items[0].StyleNo>oo.Null?this.Rows.last[0].CellData.DrawItems[0].rect.height:this.OwnerData.CalculateLineHeight(this.OwnerData.Style.DefaultTextStyle,this.OwnerData.Style.ParaStyles[0]),t+=this.CellVPaddingPix+this.CellVPaddingPix}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FEditProtect=t.EditProtect,this.FDeleteAllow=t.DeleteAllow,this.FPropertys.assign(t.Propertys),this.PropertyChange(),this.Scripts.assign(t.Scripts)}},{key:"CheckPageSurplus",value:function(t){if(this.FAutoFillPage){var e=this.CalcDynamicRowHeight()+this.BorderWidthPix,n=Math.floor(t/e);return n>0?(this.AppendRowDynamic(n),n*e):0}return f()(F()(i.prototype),"CheckPageSurplus",this).call(this,t)}},{key:"Change",value:function(){this.DoChange()}},{key:"EmptyContentRow",value:function(t){for(var e,i,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=0;o<this.Rows[t].ColCount;o++)if(null!==(e=this.Rows[t][o].CellData))for(var s=0;s<e.Items.count;s++)if((i=e.Items[s]).StyleNo>oo.Null){if(i.IsElement){if(i.AllocValue){if(""!==i.Text)return!1}else if(n);else if(""!==i.Text)return!1}else if(""!==i.Text)return!1}else if(i.StyleNo!==oo.Domain)return!1;return!0}},{key:"PropertyChange",value:function(){var t=this.GetValue(i.AutoLineColProp);this.FAutoLineCol=""!==t?parseInt(t):-1,t=this.GetValue(i.AutoFillPageProp),this.FAutoFillPage="1"===t,t=this.GetValue(i.LightEditRowProp),this.FLightEditRow="1"===t,t=this.GetValue(i.LightEditColProp),this.FLightEditCol="1"===t,this.UseToolButton="1"===this.GetValue(i.UseToolButton)}},{key:"MergeCellQuick",value:function(t,e,i,n){return this.MergeCells(t,e,i,n)}},{key:"ClearCells",value:function(t,e,i,n){for(var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=null,r=i;r>=t;r--)for(var a=n;a>=e;a--)null!==(s=this.Rows[r][a].CellData)&&s.Clear();this.SelectCellRang.Initialize(),o?this.ReFormatRequest():this.FormatDirty()}},{key:"ClearRow",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.ClearCells(t,0,e,this.ColCount-1,i)}},{key:"GetDataRowFirst",value:function(){var t=this.GetFixRowLast();return t<0?t=0:t++,t}},{key:"GetDataColFirst",value:function(){this.GetFixColLast();return 0}},{key:"ClearDataRow",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.GetDataRowFirst(),n=this.GetDataColFirst();t>=0&&this.DeleteRowFrom(i+t,this.RowCount-1),this.ClearCells(i,n,this.RowCount-1,this.ColCount-1,e)}},{key:"SetRowReadOnly",value:function(t,e){for(var i=this.Rows[t].ColCount,n=0;n<i;n++)null!=this.Rows[t][n].CellData&&(this.Rows[t][n].CellData.ReadOnly=e)}},{key:"SetCellReadOnly",value:function(t,e,i){null!=this.Rows[t][e].CellData&&(this.Rows[t][e].CellData.ReadOnly=i)}},{key:"InsertRowWith",value:function(t,e,i){var n=this.GetEditCell();if(null!==n&&n.CellData.InitializeField,t<0&&(t=this.RowCount),this.InsertRow(t,e),t>0)for(var o=null,s=null,r=this.GetFixRowLast(),a=null,l=0;l<e;l++)for(var h=0;h<this.ColCount;h++)null!==this.FRows[t-1][h].CellData&&(i?this.FRows[t+l][h].CellData.Clone(this.FRows[t-1][h].CellData):(this.FRows[t+l][h].CellData.Items[0].ParaNo=this.FRows[t-1][h].CellData.Items[0].ParaNo,this.Rows[t-1][h].CellData.Items[0].StyleNo>oo.Null&&(this.Rows[t+l][h].CellData.Items[0].StyleNo=this.Rows[t-1][h].CellData.Items[0].StyleNo)),null!==(o=this.GetColumn(h))&&o.fieldType===bn.Number&&o.inputStyle===Tn.Increment&&(s=this.FRows[t+l][h].CellData.Items[0]).StyleNo>oo.Null&&(t+l>0&&t+l>r?null!==this.FRows[t+l-1][h].CellData&&(""!==this.FRows[t+l-1][h].CellData.Items[0].Text?(a=L.tryParseInt(this.FRows[t+l-1][h].CellData.Items[0].Text)).ok&&(s.Text=(a.value+1).toString()):s.Text="1"):s.Text="1"));return!0}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FEditProtect&&(o|=128),this.FDeleteAllow&&(o|=64),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator)),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator)),o=this.Columns.count,t.writeByte(o);for(var s=0;s<o;s++)Yl.HCSaveTextToStream(t,this.Columns[s].fieldName),Yl.HCSaveTextToStream(t,this.Columns[s].fieldTitle),Yl.HCSaveTextToStream(t,this.Columns[s].fieldProp),t.writeByte(this.Columns[s].fieldType),t.writeByte(this.Columns[s].inputStyle),t.writeBoolean(this.Columns[s].static),t.writeByte(this.Columns[s].colIndex)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n);var o=t.readByte();this.FEditProtect=L.isOdd(o>>7),this.FDeleteAllow=!(n>34)||L.isOdd(o>>6);var s=Yl.HCLoadTextFromStream(t,n);if(n>64?Yl.SetPropertyString(s,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.FPropertys),this.PropertyChange(),n>57&&(s=Yl.HCLoadTextFromStream(t,n),Yl.SetPropertyString(s,this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator)),this.Columns.clear(),this.FVersion>0){o=t.readByte();for(var r=0;r<o;r++){var a=new hc;a.fieldName=Yl.HCLoadTextFromStream(t,n),this.FVersion>1&&(a.fieldTitle=Yl.HCLoadTextFromStream(t,n),a.fieldProp=Yl.HCLoadTextFromStream(t,n)),a.fieldType=t.readByte(),a.inputStyle=t.readByte(),a.static=t.readBoolean(),a.colIndex=t.readByte(),this.Columns.add(a)}}}},{key:"SumSelectCells",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.SumCells(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,this.FSelectCellRang.EndRow,this.FSelectCellRang.EndCol,t)}},{key:"SumCells",value:function(t,e,i,n){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s=0,r=NaN,a=null,l=t;l<=i;l++)for(var h=e;h<=n;h++)if(null!==this.Rows[l][h].CellData)if(a=this.Rows[l][h].CellData,""!==o)for(var c=0;c<a.Items.count;c++)a.Items[c].GetValue&&(r=Number(a.Items[c].GetValue(o)),isNaN(r)||(s+=r));else r=Number(this.Rows[l][h].CellData.SaveToText()),isNaN(r)||(s+=r);return s}},{key:"AverageSelectCells",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.AverageCells(this.FSelectCellRang.StartRow,this.FSelectCellRang.StartCol,this.FSelectCellRang.EndRow,this.FSelectCellRang.EndCol,t)}},{key:"AverageCells",value:function(t,e,i,n){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s=0,r=t;r<=i;r++)for(var a=e;a<=n;a++)null!==this.Rows[r][a].CellData&&s++;return 0!==s?this.SumCells(t,e,i,n,o)/s:0}},{key:"CheckBoxSummary",value:function(t,e){for(var i=null,n=null,o=null,s=null,r=!1,a=0,l=0;l<this.RowCount;l++)for(var h=0;h<this.ColCount;h++)if(null!=(i=this.Rows[l][h].CellData))for(var c=0;c<i.Items.count;c++)(s=i.Items[c]).StyleNo===oo.CheckBox?s.Checked&&(r=!0,0===s.Index.indexOf(t)&&(a+=s.CheckedAsNumber())):s.StyleNo>oo.Null&&s.Index==e&&(o=s,n=i);null!==o&&(r?(o.Text=a.toString(),o.AllocValue=!0):o.Reset(),n.ReFormat())}},{key:"GetCellText",value:function(t,e){return null!==this.Rows[t][e].CellData?this.Rows[t][e].CellData.SaveToText():""}},{key:"SetCellText",value:function(t,e,i){null!==this.Rows[t][e].CellData&&(this.Rows[t][e].CellData.Clear(),this.Rows[t][e].CellData.Items[0].Text=i)}},{key:"GetCellValue",value:function(t,e){if(null!==this.Rows[t][e].CellData){for(var i="",n=null,o=this.Rows[t][e].CellData,s=0;s<o.Items.count;s++)if((n=o.Items[s]).Visible){if(!(n.StyleNo>oo.Null))break;if(!n.TraceStyles.has(jh.Del))break}if(null!=n)if(n.StyleNo>oo.Null)i=this.GetCellText(t,e);else if(n.StyleNo===oo.Combobox){var r=n.ItemIndex;i=n.Items[r].Value}else if(n.StyleNo===oo.CheckBox)n.Checked&&(i=n.GetValue("CheckedValue"));else if(n.StyleNo===oo.RadioGroup){i=n.TextValueAsNumber().toString()}return i}return""}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=f()(F()(i.prototype),"ToJSONString",this).call(this,t,e);return t||""===n?n:n+',"Propertys":{'+Yl.GetPropertyJSONString(this.FPropertys)+"}"}},{key:"ParseJSONObject",value:function(t){if(f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t),t.Rows)for(var e=Math.min(this.RowCount,t.Rows.length),n=0,o=0;o<e;o++)if(t.Rows[o].Propertys&&Yl.SetItemPropertyJSON(t.Rows[o].Propertys,this.Rows[o]),t.Rows[o].Cells){n=Math.min(this.ColCount,t.Rows[o].Cells.length);for(var s=0;s<n;s++)t.Rows[o].Cells[s].Propertys&&Yl.SetItemPropertyJSON(t.Rows[o].Cells[s].Propertys,this.Rows[o][s])}this.PropertyChange(),t.Columns}},{key:"InsertRowContent",value:function(t){var e=this.GetSelfUndoList();e&&e.clear();var n=0;n=null!=t.RowIndex?Math.min(t.RowIndex,this.RowCount):this.RowCount,f()(F()(i.prototype),"InsertRow",this).call(this,n,t.Rows.length);for(var o=0,s=0;s<t.Rows.length;s++)if(t.Rows[s].Cells){o=Math.min(this.ColCount,t.Rows[s].Cells.length);for(var r=0;r<o;r++)t.Rows[s].Cells[r].CellData&&this.Rows[n+s][r].CellData&&this.Rows[n+s][r].CellData.ParseJSONObject(t.Rows[s].Cells[r].CellData,null,Yl.HC_FileVersionInt),t.Rows[s].Cells[r].Align&&this.ApplyCellAlign_(this.Rows[n+s][r],t.Rows[s].Cells[r].Align)}this.ReFormatRequest()}},{key:"GetColumn",value:function(t){for(var e=0;e<this.Columns.count;e++)if(this.Columns[e].colIndex===t)return this.Columns[e];return null}},{key:"ToJSONDataSource",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=null,i="",n=new Array;t<0&&(t=this.FFixRow>=0?this.FFixRow+this.FFixRowCount-1:0);for(var o=t;o<this.RowCount;o++){for(var s={},r=null,a=0;a<this.FColWidths.length;a++)if(null!==(r=this.GetColumn(a))&&""!==r.fieldName&&null!==(e=this.Rows[o][a]).CellData){switch(i="",r.fieldType){case bn.Image:e.CellData.Items[0].StyleNo===oo.Image&&(i=e.CellData.Items[0].Image.src);break;case bn.Number:i=e.CellData.SaveToText(),i=L.isNumber(i)?L.parseFloatDef(i,0):"NaN";break;default:i=e.CellData.SaveToText()}s[r.fieldName]=i}n.push(s)}return{RowCount:this.RowCount-t,ColCount:this.FColWidths.length,DataArray:n}}},{key:"ParseJSONDataSource",value:function(t){var e=this,i=this.RowCount-1;if(null!=t.RowIndex&&(i=parseInt(t.RowIndex)),null!=t.DataArray){var n=t.DataArray.length;i+n>this.RowCount&&this.InsertRow(this.RowCount,i+n-this.RowCount);for(var o=0,s=null,r=null,a="",l=0,h=!1,c=0;c<n;c++)for(o=0;o<this.FColWidths.length;o++)if(null!==(r=this.GetColumn(o))&&null!==(s=this.Rows[i+c][o]).CellData&&(0===c&&r.fieldTitle&&null!==this.Rows[0][o].CellData&&(this.Rows[0][o].CellData.Items[0].Text=r.fieldTitle),""!==r.fieldName&&null!=(a=t.DataArray[c][r.fieldName])))switch(r.fieldType){case bn.Image:var u=new wc(this.hcl,s.CellData);u.ParaFirst=!0,s.CellData.Items.clear(),s.CellData.Items.add(u),l++,u.LoadFromBase64(a,"png",(function(){0!==--l||h||e.ReFormatRequest()}));break;case bn.Number:L.isNumber(a)?s.CellData.Items[0].Text=String(a):s.CellData.Items[0].Text="NaN";break;default:s.CellData.Items[0].Text=String(a)}0===l&&(this.ReFormatRequest(),h=!0)}}},{key:"EditProtect",get:function(){return this.FEditProtect},set:function(t){this.FEditProtect=t}},{key:"DeleteAllow",get:function(){return this.FDeleteAllow},set:function(t){this.FDeleteAllow=t}},{key:"Propertys",get:function(){return this.FPropertys}},{key:"AutoLineCol",get:function(){return this.FAutoLineCol}},{key:"AutoFillPage",get:function(){return this.FAutoFillPage}},{key:"LightEditRow",get:function(){return this.FLightEditRow}},{key:"LightEditCol",get:function(){return this.FLightEditCol}},{key:"Index",get:function(){return this.GetValue(Yh.Index)}},{key:"Code",get:function(){return this.GetValue(Yh.Code)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.Code):this.SetValue(Yh.Code,t)}}]),i}(Ir);uc.AutoLineColProp="AutoLineCol",uc.AutoFillPageProp="AutoFillPage",uc.LightEditRowProp="LightEditRow",uc.LightEditColProp="LightEditCol",uc.UseToolButton="UseToolButton";var fc=function(t){m()(i,t);var e=Jh(i);function i(t,n,o,s){var a;return r()(this,i),(a=e.call(this,t,n,o,s)).FDeleteAllow=!0,a.FEditProtect=!1,a.AllocValue=!1,a.FPropertys=new rt,a.Scripts=new rt,a.OnScript_SetItemChecked=null,a}return l()(i,[{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"==t?this.FEditProtect=L.parseBooleanDef(e,this.FEditProtect):"DeleteAllow"==t?this.FDeleteAllow=L.parseBooleanDef(e,this.FDeleteAllow):"AllocValue"==t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.FPropertys,t,e)}},{key:"GetScript",value:function(t){return Yl.HCGetProperty(this.Scripts,t)}},{key:"SetScript",value:function(t,e){Yl.HCSetProperty(this.Scripts,t,e,!1)}},{key:"CheckedAsNumber",value:function(){if(this.Checked){var t=this.GetValue("CheckedValue");return L.parseIntDef(t,0)}return 0}},{key:"DoSetChecked",value:function(t){this.EditProtect||(f()(F()(i.prototype),"DoSetChecked",this).call(this,t),this.AllocValue=!0,null!=this.OnScript_CheckChanged&&this.OnScript_CheckChanged(this))}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FEditProtect=t.EditProtect,this.FDeleteAllow=t.DeleteAllow,this.AllocValue=t.AllocValue,this.FPropertys.assign(t.Propertys),this.Scripts.assign(t.Scripts)}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l),!l.Print&&this.FMouseIn&&this.Scripts.count>0&&Yl.HCDrawScriptMark(a,e.left,e.top),this.hcl.emrCommon.CheckBoxValue&&this.GetValue("CheckedValue")&&(a.font.size=8,a.font.color="#ff0000",a.font.styles.value=0,a.textOut(e.left+4,e.top+2,this.GetValue("CheckedValue")))}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FEditProtect&&(o|=128),this.FDeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator)),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n);var o=t.readByte();this.FEditProtect=L.isOdd(o>>7),this.FDeleteAllow=!(n>34)||L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4);var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.FPropertys),n>57&&(s=Yl.HCLoadTextFromStream(t,n),Yl.SetPropertyString(s,this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Propertys":{'+Yl.GetPropertyJSONString(this.FPropertys)+"}"}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t)}},{key:"EditProtect",get:function(){return this.FEditProtect},set:function(t){this.FEditProtect=t}},{key:"DeleteAllow",get:function(){return this.FDeleteAllow},set:function(t){this.FDeleteAllow=t}},{key:"Propertys",get:function(){return this.FPropertys}},{key:"Index",get:function(){return this.GetValue(Yh.Index)}},{key:"Code",get:function(){return this.GetValue(Yh.Code)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.Code):this.SetValue(Yh.Code,t)}},{key:"CMVVCode",get:function(){return this.GetValue(Yh.CMVVCode)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.CMVVCode):this.SetValue(Yh.CMVVCode,t)}}]),i}(sa),dc=function(t){m()(i,t);var e=Jh(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,n,o)).FDeleteAllow=!0,s.FEditProtect=!1,s.FPropertys=new rt,s.Scripts=new rt,s.OnScript_Click=null,s}return l()(i,[{key:"DoClick",value:function(){f()(F()(i.prototype),"DoClick",this).call(this),null!=this.OnScript_Click&&this.OnScript_Click(this)}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"GetScript",value:function(t){return Yl.HCGetProperty(this.Scripts,t)}},{key:"SetScript",value:function(t,e){Yl.HCSetProperty(this.Scripts,t,e,!1)}},{key:"SetValue",value:function(t,e){"EditProtect"==t?this.FEditProtect=L.parseBooleanDef(e,this.FEditProtect):"DeleteAllow"==t?this.FDeleteAllow=L.parseBooleanDef(e,this.FDeleteAllow):Yl.HCSetProperty(this.FPropertys,t,e)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FEditProtect=t.EditProtect,this.FDeleteAllow=t.DeleteAllow,this.FPropertys.assign(t.Propertys),this.Scripts.assign(t.Scripts)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FEditProtect&&(o|=128),this.FDeleteAllow&&(o|=64),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator)),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n);var o=t.readByte();this.FEditProtect=L.isOdd(o>>7),this.FDeleteAllow=!(n>34)||L.isOdd(o>>6);var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.FPropertys),n>57&&(s=Yl.HCLoadTextFromStream(t,n),Yl.SetPropertyString(s,this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Propertys":{'+Yl.GetPropertyJSONString(this.FPropertys)+"}"}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t)}},{key:"EditProtect",get:function(){return this.FEditProtect},set:function(t){this.FEditProtect=t}},{key:"DeleteAllow",get:function(){return this.FDeleteAllow},set:function(t){this.FDeleteAllow=t}},{key:"Propertys",get:function(){return this.FPropertys}},{key:"Index",get:function(){return this.GetValue(Yh.Index)}},{key:"Code",get:function(){return this.GetValue(Yh.Code)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.Code):this.SetValue(Yh.Code,t)}}]),i}(Il),mc=function(t){m()(i,t);var e=Jh(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,n,o)).FDeleteAllow=!0,s.FEditProtect=!1,s.AllocValue=!1,s.FPropertys=new rt,s.Scripts=new rt,s}return l()(i,[{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.AllocValue=!0}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"==t?this.FEditProtect=L.parseBooleanDef(e,this.FEditProtect):"DeleteAllow"==t?this.FDeleteAllow=L.parseBooleanDef(e,this.FDeleteAllow):"AllocValue"==t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.FPropertys,t,e)}},{key:"GetScript",value:function(t){return Yl.HCGetProperty(this.Scripts,t)}},{key:"SetScript",value:function(t,e){Yl.HCSetProperty(this.Scripts,t,e,!1)}},{key:"KeyDown",value:function(t){this.FEditProtect||f()(F()(i.prototype),"KeyDown",this).call(this,t)}},{key:"KeyPress",value:function(t){this.FEditProtect||f()(F()(i.prototype),"KeyPress",this).call(this,t)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FEditProtect=t.EditProtect,this.FDeleteAllow=t.DeleteAllow,this.AllocValue=t.AllocValue,this.FPropertys.assign(t.Propertys),this.Scripts.assign(t.Scripts)}},{key:"InsertText",value:function(t){return!this.FEditProtect&&f()(F()(i.prototype),"InsertText",this).call(this,t)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FEditProtect&&(o|=128),this.FDeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator)),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n);var o=t.readByte();this.FEditProtect=L.isOdd(o>>7),this.FDeleteAllow=!(n>34)||L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4);var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.FPropertys),n>57&&(s=Yl.HCLoadTextFromStream(t,n),Yl.SetPropertyString(s,this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"TextAsNumber",value:function(){return L.isNumber(this.Text)?L.parseFloatDef(this.Text,0):NaN}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Propertys":{'+Yl.GetPropertyJSONString(this.FPropertys)+"}"}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t)}},{key:"EditProtect",get:function(){return this.FEditProtect},set:function(t){this.FEditProtect=t}},{key:"DeleteAllow",get:function(){return this.FDeleteAllow},set:function(t){this.FDeleteAllow=t}},{key:"Propertys",get:function(){return this.FPropertys}},{key:"Index",get:function(){return this.GetValue(Yh.Index)}},{key:"Code",get:function(){return this.GetValue(Yh.Code)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.Code):this.SetValue(Yh.Code,t)}},{key:"CMVVCode",get:function(){return this.GetValue(Yh.CMVVCode)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.CMVVCode):this.SetValue(Yh.CMVVCode,t)}}]),i}(ha),Sc=function(t){m()(i,t);var e=Jh(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,n,o)).FDeleteAllow=!0,s.FEditProtect=!1,s.AllocValue=!1,s.FPropertys=new rt,s.Scripts=new rt,s.SaveItem=!1,s}return l()(i,[{key:"DoItemIndexChanged",value:function(){f()(F()(i.prototype),"DoItemIndexChanged",this).call(this),this.FItemIndex>=0&&this.FItemIndex<this.Items.count?(this.CMVVCode=this.Items[this.FItemIndex].Code,this.AllocValue=!0):(this.CMVVCode="",this.AllocValue=!1)}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"==t?this.FEditProtect=L.parseBooleanDef(e,this.FEditProtect):"DeleteAllow"==t?this.FDeleteAllow=L.parseBooleanDef(e,this.FDeleteAllow):"AllocValue"==t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.FPropertys,t,e)}},{key:"GetScript",value:function(t){return Yl.HCGetProperty(this.Scripts,t)}},{key:"SetScript",value:function(t,e){Yl.HCSetProperty(this.Scripts,t,e,!1)}},{key:"KeyDown",value:function(t){this.FEditProtect||f()(F()(i.prototype),"KeyDown",this).call(this,t)}},{key:"KeyPress",value:function(t){this.FEditProtect||f()(F()(i.prototype),"KeyPress",this).call(this,t)}},{key:"DoPopup",value:function(){this.FEditProtect||f()(F()(i.prototype),"DoPopup",this).call(this)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FEditProtect=t.EditProtect,this.FDeleteAllow=t.DeleteAllow,this.AllocValue=t.AllocValue,this.FPropertys.assign(t.Propertys),this.Scripts.assign(t.Scripts)}},{key:"InsertText",value:function(t){return!this.FEditProtect&&f()(F()(i.prototype),"InsertText",this).call(this,t)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FEditProtect&&(o|=128),this.FDeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator)),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n);var o=t.readByte();this.FEditProtect=L.isOdd(o>>7),this.FDeleteAllow=!(n>34)||L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4);var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.FPropertys),n>57&&(s=Yl.HCLoadTextFromStream(t,n),Yl.SetPropertyString(s,this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Propertys":{'+Yl.GetPropertyJSONString(this.FPropertys)+"}"}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t)}},{key:"EditProtect",get:function(){return this.FEditProtect},set:function(t){this.FEditProtect=t}},{key:"DeleteAllow",get:function(){return this.FDeleteAllow},set:function(t){this.FDeleteAllow=t}},{key:"Propertys",get:function(){return this.FPropertys}},{key:"Index",get:function(){return this.GetValue(Yh.Index)}},{key:"Code",get:function(){return this.GetValue(Yh.Code)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.Code):this.SetValue(Yh.Code,t)}},{key:"CMVVCode",get:function(){return this.GetValue(Yh.CMVVCode)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.CMVVCode):this.SetValue(Yh.CMVVCode,t)}}]),i}(fa),pc=function(t){m()(i,t);var e=Jh(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,n,o)).FDeleteAllow=!0,s.FEditProtect=!1,s.AllocValue=!1,s.FPropertys=new rt,s.Scripts=new rt,s.AreaUnderLine=!1,s.InvalidDateTime=!1,s}return l()(i,[{key:"SetDateTime",value:function(t){f()(F()(i.prototype),"SetDateTime",this).call(this,t),this.AllocValue=!0}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"==t?this.FEditProtect=L.parseBooleanDef(e,this.FEditProtect):"DeleteAllow"==t?this.FDeleteAllow=L.parseBooleanDef(e,this.FDeleteAllow):"AllocValue"==t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.FPropertys,t,e)}},{key:"GetScript",value:function(t){return Yl.HCGetProperty(this.Scripts,t)}},{key:"SetScript",value:function(t,e){Yl.HCSetProperty(this.Scripts,t,e,!1)}},{key:"DoPopup",value:function(){this.FEditProtect||f()(F()(i.prototype),"DoPopup",this).call(this)}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){if(f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l),this.AreaUnderLine){a.pen.style=_t.Solid,a.pen.color=Ft.Black;var h=this.GetAreaRect(hl.Year);h.offset(e.left,e.top),a.drawLineDriect(h.left,h.bottom,h.right,h.bottom),(h=this.GetAreaRect(hl.Month)).offset(e.left,e.top),a.drawLineDriect(h.left,h.bottom,h.right,h.bottom),(h=this.GetAreaRect(hl.Day)).offset(e.left,e.top),a.drawLineDriect(h.left,h.bottom,h.right,h.bottom),(h=this.GetAreaRect(hl.Hour)).offset(e.left,e.top),a.drawLineDriect(h.left,h.bottom,h.right,h.bottom),(h=this.GetAreaRect(hl.Minute)).offset(e.left,e.top),a.drawLineDriect(h.left,h.bottom,h.right,h.bottom),(h=this.GetAreaRect(hl.Second)).offset(e.left,e.top),a.drawLineDriect(h.left,h.bottom,h.right,h.bottom)}if(this.InvalidDateTime&&!this.Active){a.brush.color=Ft.White;var c=this.GetAreaRect(hl.Year);c.offset(e.left,e.top),a.fillRect(c),(c=this.GetAreaRect(hl.Month)).offset(e.left,e.top),a.fillRect(c),(c=this.GetAreaRect(hl.Day)).offset(e.left,e.top),a.fillRect(c),(c=this.GetAreaRect(hl.Hour)).offset(e.left,e.top),a.fillRect(c),(c=this.GetAreaRect(hl.Minute)).offset(e.left,e.top),a.fillRect(c),(c=this.GetAreaRect(hl.Second)).offset(e.left,e.top),a.fillRect(c)}}},{key:"KeyDown",value:function(t){this.FEditProtect||f()(F()(i.prototype),"KeyDown",this).call(this,t)}},{key:"KeyPress",value:function(t){this.FEditProtect||f()(F()(i.prototype),"KeyPress",this).call(this,t)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FEditProtect=t.EditProtect,this.FDeleteAllow=t.DeleteAllow,this.AllocValue=t.AllocValue,this.FPropertys.assign(t.Propertys),this.Scripts.assign(t.Scripts)}},{key:"InsertText",value:function(t){return!this.FEditProtect&&f()(F()(i.prototype),"InsertText",this).call(this,t)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FEditProtect&&(o|=128),this.FDeleteAllow&&(o|=64),this.AreaUnderLine&&(o|=32),this.InvalidDateTime&&(o|=16),this.AllocValue&&(o|=8),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator)),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n);var o=t.readByte();this.FEditProtect=L.isOdd(o>>7),this.FDeleteAllow=!(n>34)||L.isOdd(o>>6),this.AreaUnderLine=L.isOdd(o>>5),this.InvalidDateTime=L.isOdd(o>>4),this.AllocValue=L.isOdd(o>>3);var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.FPropertys),n>57&&(s=Yl.HCLoadTextFromStream(t,n),Yl.SetPropertyString(s,this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Propertys":{'+Yl.GetPropertyJSONString(this.FPropertys)+"}"}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t)}},{key:"EditProtect",get:function(){return this.FEditProtect},set:function(t){this.FEditProtect=t}},{key:"DeleteAllow",get:function(){return this.FDeleteAllow},set:function(t){this.FDeleteAllow=t}},{key:"Propertys",get:function(){return this.FPropertys}},{key:"Index",get:function(){return this.GetValue(Yh.Index)}},{key:"Code",get:function(){return this.GetValue(Yh.Code)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.Code):this.SetValue(Yh.Code,t)}},{key:"CMVVCode",get:function(){return this.GetValue(Yh.CMVVCode)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.CMVVCode):this.SetValue(Yh.CMVVCode,t)}}]),i}(cl),yc=function(t){m()(i,t);var e=Jh(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FDeleteAllow=!0,o.FEditProtect=!1,o.AllocValue=!1,o.CheckNone=!1,o.FPropertys=new rt,o.Scripts=new rt,o.OnScript_SetItemChecked=null,o}return l()(i,[{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"==t?this.FEditProtect=L.parseBooleanDef(e,this.FEditProtect):"DeleteAllow"==t?this.FDeleteAllow=L.parseBooleanDef(e,this.FDeleteAllow):"AllocValue"==t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.FPropertys,t,e)}},{key:"GetScript",value:function(t){return Yl.HCGetProperty(this.Scripts,t)}},{key:"SetScript",value:function(t,e){Yl.HCSetProperty(this.Scripts,t,e,!1)}},{key:"ValueAsNumber",value:function(){return this.TextValueAsNumber()}},{key:"TextValueAsNumber",value:function(){for(var t=0,e=0;e<this.Items.count;e++)this.Items[e].Checked&&(t+=L.parseFloatDef(this.Items[e].TextValue,0));return t}},{key:"DoSetItemChecked",value:function(t,e){if(!this.FEditProtect){if(!this.CheckNone&&this.Items[t].Checked&&!e){for(var n=!1,o=0;o<this.Items.count;o++)if(o!==t&&this.Items[o].Checked){n=!0;break}if(!n)return}f()(F()(i.prototype),"DoSetItemChecked",this).call(this,t,e),this.AllocValue=!0,null!=this.OnScript_SetItemChecked&&this.OnScript_SetItemChecked(this,t,e)}}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FEditProtect=t.EditProtect,this.FDeleteAllow=t.DeleteAllow,this.AllocValue=t.AllocValue,this.CheckNone=t.CheckNone,this.FPropertys.assign(t.Propertys),this.Scripts.assign(t.Scripts)}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l),!l.Print&&this.FMouseIn&&this.Scripts.count>0&&Yl.HCDrawScriptMark(a,e.left,e.top)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FEditProtect&&(o|=128),this.FDeleteAllow&&(o|=64),this.AllocValue&&(o|=16),this.CheckNone&&(o|=4),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator)),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n);var o=t.readByte();this.FEditProtect=L.isOdd(o>>7),this.FDeleteAllow=!(n>34)||L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4),this.CheckNone=L.isOdd(o>>2);var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.FPropertys),n>57&&(s=Yl.HCLoadTextFromStream(t,n),Yl.SetPropertyString(s,this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Propertys":{'+Yl.GetPropertyJSONString(this.FPropertys)+"}"}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.CheckNone&&(this.CheckNone=t.CheckNone),sc(this,t)}},{key:"EditProtect",get:function(){return this.FEditProtect},set:function(t){this.FEditProtect=t}},{key:"DeleteAllow",get:function(){return this.FDeleteAllow},set:function(t){this.FDeleteAllow=t}},{key:"Propertys",get:function(){return this.FPropertys}},{key:"Index",get:function(){return this.GetValue(Yh.Index)}},{key:"Code",get:function(){return this.GetValue(Yh.Code)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.Code):this.SetValue(Yh.Code,t)}},{key:"CMVVCode",get:function(){return this.GetValue(Yh.CMVVCode)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.CMVVCode):this.SetValue(Yh.CMVVCode,t)}}]),i}(Sl),Fc=function(t){m()(i,t);var e=Jh(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,n,o)).FDeleteAllow=!0,s.FEditProtect=!1,s.FPropertys=new rt,s.AllocValue=!1,s}return l()(i,[{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.AllocValue=!0}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"==t?this.FEditProtect=L.parseBooleanDef(e,this.FEditProtect):"DeleteAllow"==t?this.FDeleteAllow=L.parseBooleanDef(e,this.FDeleteAllow):"AllocValue"==t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.FPropertys,t,e)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FEditProtect=t.EditProtect,this.FDeleteAllow=t.DeleteAllow,this.FPropertys.assign(t.Propertys),this.AllocValue=t.AllocValue}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FEditProtect&&(o|=128),this.FDeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),n>60){var o=t.readByte();this.FEditProtect=L.isOdd(o>>7),this.FDeleteAllow=L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4);var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.FPropertys)}}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Propertys":{'+Yl.GetPropertyJSONString(this.FPropertys)+"}"}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t)}},{key:"EditProtect",get:function(){return this.FEditProtect},set:function(t){this.FEditProtect=t}},{key:"DeleteAllow",get:function(){return this.FDeleteAllow},set:function(t){this.FDeleteAllow=t}},{key:"Propertys",get:function(){return this.FPropertys}},{key:"Index",get:function(){return this.GetValue(Yh.Index)}},{key:"Code",get:function(){return this.GetValue(Yh.Code)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.Code):this.SetValue(Yh.Code,t)}}]),i}(al),vc=function(t){m()(i,t);var e=Jh(i);function i(t,n,o){var s;return r()(this,i),(s=e.call(this,t,n,o)).FDeleteAllow=!0,s.FEditProtect=!1,s.FPropertys=new rt,s.AllocValue=!1,s}return l()(i,[{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.AllocValue=!0}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"==t?this.FEditProtect=L.parseBooleanDef(e,this.FEditProtect):"DeleteAllow"==t?this.FDeleteAllow=L.parseBooleanDef(e,this.FDeleteAllow):"AllocValue"==t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.FPropertys,t,e)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FEditProtect=t.EditProtect,this.FDeleteAllow=t.DeleteAllow,this.FPropertys.assign(t.Propertys),this.AllocValue=t.AllocValue}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FEditProtect&&(o|=128),this.FDeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),n>60){var o=t.readByte();this.FEditProtect=L.isOdd(o>>7),this.FDeleteAllow=L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4);var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.FPropertys)}}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Propertys":{'+Yl.GetPropertyJSONString(this.FPropertys)+"}"}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t)}},{key:"EditProtect",get:function(){return this.FEditProtect},set:function(t){this.FEditProtect=t}},{key:"DeleteAllow",get:function(){return this.FDeleteAllow},set:function(t){this.FDeleteAllow=t}},{key:"Propertys",get:function(){return this.FPropertys}},{key:"Index",get:function(){return this.GetValue(Yh.Index)}},{key:"Code",get:function(){return this.GetValue(Yh.Code)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.Code):this.SetValue(Yh.Code,t)}}]),i}(Ja),Ic=function(t){m()(i,t);var e=Jh(i);function i(t,n){var o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"123456";return r()(this,i),(o=e.call(this,t,n,s)).FDeleteAllow=!0,o.FEditProtect=!1,o.FPropertys=new rt,o.AllocValue=!1,o}return l()(i,[{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.AllocValue=!0}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"==t?this.FEditProtect=L.parseBooleanDef(e,this.FEditProtect):"DeleteAllow"==t?this.FDeleteAllow=L.parseBooleanDef(e,this.FDeleteAllow):"AllocValue"==t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.FPropertys,t,e)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FEditProtect=t.EditProtect,this.FDeleteAllow=t.DeleteAllow,this.FPropertys.assign(t.Propertys),this.AllocValue=t.AllocValue}},{key:"AcceptAction",value:function(t,e,n){return!!this.FDeleteAllow&&f()(F()(i.prototype),"AcceptAction",this).call(this,t,e,n)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FEditProtect&&(o|=128),this.FDeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n);var o=t.readByte();this.FEditProtect=L.isOdd(o>>7),this.FDeleteAllow=!(n>34)||L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4);var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.FPropertys)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Propertys":{'+Yl.GetPropertyJSONString(this.FPropertys)+"}"}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t)}},{key:"EditProtect",get:function(){return this.FEditProtect},set:function(t){this.FEditProtect=t}},{key:"DeleteAllow",get:function(){return this.FDeleteAllow},set:function(t){this.FDeleteAllow=t}},{key:"Propertys",get:function(){return this.FPropertys}},{key:"Index",get:function(){return this.GetValue(Yh.Index)}},{key:"Code",get:function(){return this.GetValue(Yh.Code)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.Code):this.SetValue(Yh.Code,t)}}]),i}(Rl),gc=function(t){m()(i,t);var e=Jh(i);function i(t,n){var o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"http://www.hcview.cn";return r()(this,i),(o=e.call(this,t,n,s)).FDeleteAllow=!0,o.FEditProtect=!1,o.FPropertys=new rt,o.AllocValue=!1,o}return l()(i,[{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.AllocValue=!0}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"==t?this.FEditProtect=L.parseBooleanDef(e,this.FEditProtect):"DeleteAllow"==t?this.FDeleteAllow=L.parseBooleanDef(e,this.FDeleteAllow):"AllocValue"==t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.FPropertys,t,e)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FEditProtect=t.EditProtect,this.FDeleteAllow=t.DeleteAllow,this.FPropertys.assign(t.Propertys),this.AllocValue=t.AllocValue}},{key:"AcceptAction",value:function(t,e,n){return!!this.FDeleteAllow&&f()(F()(i.prototype),"AcceptAction",this).call(this,t,e,n)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FEditProtect&&(o|=128),this.FDeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n);var o=t.readByte();this.FEditProtect=L.isOdd(o>>7),this.FDeleteAllow=L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4);var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.FPropertys)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Propertys":{'+Yl.GetPropertyJSONString(this.FPropertys)+"}"}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t)}},{key:"EditProtect",get:function(){return this.FEditProtect},set:function(t){this.FEditProtect=t}},{key:"DeleteAllow",get:function(){return this.FDeleteAllow},set:function(t){this.FDeleteAllow=t}},{key:"Propertys",get:function(){return this.FPropertys}},{key:"Index",get:function(){return this.GetValue(Yh.Index)}},{key:"Code",get:function(){return this.GetValue(Yh.Code)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.Code):this.SetValue(Yh.Code,t)}}]),i}(bl),Cc=function(t){m()(i,t);var e=Jh(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FDeleteAllow=!0,o.FEditProtect=!1,o.FPropertys=new rt,o.AllocValue=!1,o}return l()(i,[{key:"DoImageLoaded",value:function(){f()(F()(i.prototype),"DoImageLoaded",this).call(this),this.AllocValue=!0}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"==t?this.FEditProtect=L.parseBooleanDef(e,this.FEditProtect):"DeleteAllow"==t?this.FDeleteAllow=L.parseBooleanDef(e,this.FDeleteAllow):"AllocValue"==t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.FPropertys,t,e)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FEditProtect=t.EditProtect,this.FDeleteAllow=t.DeleteAllow,this.FPropertys.assign(t.Propertys),this.AllocValue=t.AllocValue}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FEditProtect&&(o|=128),this.FDeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n);var o=t.readByte();this.FEditProtect=L.isOdd(o>>7),this.FDeleteAllow=L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4);var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.FPropertys)}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.EditProtect&&(this.EditProtect=t.EditProtect),null!=t.DeleteAllow&&(this.DeleteAllow=t.DeleteAllow),null!=t.AllocValue&&(this.AllocValue=t.AllocValue)}},{key:"EditProtect",get:function(){return this.FEditProtect},set:function(t){this.FEditProtect=t}},{key:"DeleteAllow",get:function(){return this.FDeleteAllow},set:function(t){this.FDeleteAllow=t}},{key:"Propertys",get:function(){return this.FPropertys}}]),i}(El),wc=function(t){m()(i,t);var e=Jh(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FDeleteAllow=!0,o.FEditProtect=!1,o.FPropertys=new rt,o.Scripts=new rt,o.AllocValue=!1,o.CopyProtect=!1,o.ResNO=0,o}return l()(i,[{key:"GetLastVersion",value:function(){return 1}},{key:"DoImageLoaded",value:function(){f()(F()(i.prototype),"DoImageLoaded",this).call(this),this.AllocValue=!1}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"===t?this.FEditProtect=L.parseBooleanDef(e,this.FEditProtect):"DeleteAllow"===t?this.FDeleteAllow=L.parseBooleanDef(e,this.FDeleteAllow):"AllocValue"===t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):"CopyProtect"===t?this.CopyProtect=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.FPropertys,t,e)}},{key:"GetScript",value:function(t){return Yl.HCGetProperty(this.Scripts,t)}},{key:"SetScript",value:function(t,e){Yl.HCSetProperty(this.Scripts,t,e,!1)}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l),this.Empty&&this.Active&&!l.Print&&(a.font.size=10,a.font.styles.add(Ct),a.textOut(e.left+2,e.top+2,this.GetValue(Yh.Name)))}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FEditProtect=t.EditProtect,this.FDeleteAllow=t.DeleteAllow,this.FPropertys.assign(t.Propertys),this.Scripts.assign(t.Scripts),this.AllocValue=t.AllocValue,this.CopyProtect=t.CopyProtect}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.FEditProtect&&(o|=128),this.FDeleteAllow&&(o|=64),this.CopyProtect&&(o|=32),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator)),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator)),t.writeInt32(this.ResNO)}},{key:"LoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),!(n<33)){var o=t.readByte();this.FEditProtect=L.isOdd(o>>7),this.FDeleteAllow=!(n>34)||L.isOdd(o>>6),this.CopyProtect=L.isOdd(o>>5),this.AllocValue=L.isOdd(o>>4);var s=Yl.HCLoadTextFromStream(t,n);if(n>64?Yl.SetPropertyString(s,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.FPropertys),n>57&&(s=Yl.HCLoadTextFromStream(t,n),Yl.SetPropertyString(s,this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator)),this.FVersion>0){var r=t.readInt32();this.OwnerData.Style.SetResWaiteObj(r,this)}}}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"EditProtect":'+(this.EditProtect?"true":"false")+',"CopyProtect":'+(this.CopyProtect?"true":"false")+',"DeleteAllow":'+(this.DeleteAllow?"true":"false")+',"AllocValue":'+(this.AllocValue?"true":"false")+',"Propertys":{'+Yl.GetPropertyJSONString(this.FPropertys)+"}"}},{key:"ParseJSONObject",value:function(t){var e=this;f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t),null!=t.CopyProtect&&(this.CopyProtect=t.CopyProtect),null!=t.Base64&&null!=t.ImageType&&(this.OwnerData.Style.UseResWaite>0?this.ResNO=this.OwnerData.Style.NewResWaite():this.ResNO=0,this.LoadFromBase64(t.Base64,t.ImageType,(function(i,n){i&&(null!=t.AutoSize&&t.AutoSize||(null!=t.Width&&t.Width>5&&(e.Width=t.Width),null!=t.Height&&t.Height>5&&(e.Height=t.Height))),t.LoadedEvent&&t.LoadedEvent(i,n),e.RestrainSize(e.OwnerData.Width,e.Height),e.ReFormatRequest(),e.ResNO>0&&e.OwnerData.Style.SetResWaiteOrgobj(e.ResNO,e)})))}},{key:"EditProtect",get:function(){return this.FEditProtect},set:function(t){this.FEditProtect=t}},{key:"DeleteAllow",get:function(){return this.FDeleteAllow},set:function(t){this.FDeleteAllow=t}},{key:"Propertys",get:function(){return this.FPropertys}},{key:"Index",get:function(){return this.GetValue(Yh.Index)}},{key:"Code",get:function(){return this.GetValue(Yh.Code)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.Code):this.SetValue(Yh.Code,t)}}]),i}(Yr),Ac=function(t){m()(i,t);var e=Jh(i);function i(t,n,o,s){var a;return r()(this,i),(a=e.call(this,t,n,o,s)).Propertys=new rt,a.DeleteAllow=!0,a.EditProtect=!1,a.AllocValue=!1,a}return l()(i,[{key:"GetLastVersion",value:function(){return 2}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.Propertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"==t?this.EditProtect=L.parseBooleanDef(e,this.EditProtect):"DeleteAllow"==t?this.DeleteAllow=L.parseBooleanDef(e,this.DeleteAllow):"AllocValue"==t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.Propertys,t,e)}},{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.AllocValue=!0}},{key:"MouseDown",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseDown",this).call(this,t)}},{key:"MouseMove",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseMove",this).call(this,t)}},{key:"MouseUp",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseUp",this).call(this,t)}},{key:"KeyDown",value:function(t){this.EditProtect||f()(F()(i.prototype),"KeyDown",this).call(this,t)}},{key:"KeyPress",value:function(t){this.EditProtect?t.keyCode=0:f()(F()(i.prototype),"KeyPress",this).call(this,t)}},{key:"InsertText",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"InsertText",this).call(this,t)}},{key:"AcceptAction",value:function(t,e,n){return!(n===rh.DeleteItem&&!this.DeleteAllow)&&f()(F()(i.prototype),"AcceptAction",this).call(this,t,e,n)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.DeleteAllow=t.DeleteAllow,this.EditProtect=t.EditProtect,this.AllocValue=t.AllocValue,this.Propertys.assign(t.Propertys)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.EditProtect&&(o|=128),this.DeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FVersion>0){var o=t.readByte();this.EditProtect=L.isOdd(o>>7),this.DeleteAllow=L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4)}else this.EditProtect=!1,this.DeleteAllow=!0,this.AllocValue=!1;if(this.FVersion>1){var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.Propertys)}}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t)}}]),i}(ta),Dc=function(t){m()(i,t);var e=Jh(i);function i(t,n,o,s){var a;return r()(this,i),(a=e.call(this,t,n,o,s)).Propertys=new rt,a.DeleteAllow=!0,a.EditProtect=!1,a.AllocValue=!1,a}return l()(i,[{key:"GetLastVersion",value:function(){return 2}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.Propertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"==t?this.EditProtect=L.parseBooleanDef(e,this.EditProtect):"DeleteAllow"==t?this.DeleteAllow=L.parseBooleanDef(e,this.DeleteAllow):"AllocValue"==t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.Propertys,t,e)}},{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.AllocValue=!0}},{key:"MouseDown",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseDown",this).call(this,t)}},{key:"MouseMove",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseMove",this).call(this,t)}},{key:"MouseUp",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseUp",this).call(this,t)}},{key:"KeyDown",value:function(t){this.EditProtect||f()(F()(i.prototype),"KeyDown",this).call(this,t)}},{key:"KeyPress",value:function(t){this.EditProtect?t.keyCode=0:f()(F()(i.prototype),"KeyPress",this).call(this,t)}},{key:"InsertText",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"InsertText",this).call(this,t)}},{key:"AcceptAction",value:function(t,e,n){return!(n===rh.DeleteItem&&!this.DeleteAllow)&&f()(F()(i.prototype),"AcceptAction",this).call(this,t,e,n)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.DeleteAllow=t.DeleteAllow,this.EditProtect=t.EditProtect,this.AllocValue=t.AllocValue,this.Propertys.assign(t.Propertys)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.EditProtect&&(o|=128),this.DeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FVersion>0){var o=t.readByte();this.EditProtect=L.isOdd(o>>7),this.DeleteAllow=L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4)}else this.EditProtect=!1,this.DeleteAllow=!0,this.AllocValue=!1;if(this.FVersion>1){var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.Propertys)}}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t)}}]),i}(ia);function Pc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var kc=function(t){m()(i,t);var e=Pc(i);function i(t){var n;r()(this,i),(n=e.call(this,t)).visible=!1,n.headerVisible=!1,n.drawShadow=!0,n.dropDownStyle=!0,n.beginUpdate();try{n.FPageDomain=n.addPage("pgDomain"),n._initDomainPage(),n.FPageNumber=n.addPage("pgNumber"),n._initNumberPage(),n.FPageMemo=n.addPage("pgMemo"),n._initMemoPage(),n.FPageDateTime=n.addPage("pgDateTime"),n._initDateTimePage()}finally{n.endUpdate()}return n.FMultSelect=!1,n.FFrmtp="",n.FDeItem=null,n.FDeItemHeight=0,n.FPopupData=null,n.FDomainItems=null,n.FSelectAll=0,n.FDomainMinH=100,n.NoDomainInit=!1,n.OnSetActiveItemExtra=null,n.OnSetPopupItemText=null,n.OnPopupGetDeItemInfoLib=null,n.OnPopupGetDeItemDomainLib=null,n.OnPopupGetDeItemDomainLibAsync=null,n.OnPopupGetDomainItemExtraLib=null,n.OnItemPopupSetCloseLib=null,n}return l()(i,[{key:"_initDB",value:function(){var t=this;this.FDB.onUpgradeneeded=function(){if(!t.FDB.db.objectStoreNames.contains("Comm_DataElement"))t.FDB.db.createObjectStore("Comm_DataElement",{keyPath:"deid"})},this.FDB.onOpen=function(){t._initCache()},this.FDB.open("clt",1)}},{key:"_initCache",value:function(){var t=null;window.XMLHttpRequest?t=new XMLHttpRequest:window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLHTTP")),null!==t?(t.onreadystatechange=function(){4===t.readyState&&t.status},t.open("GET","url",!0),t.send(null)):this.hcl.exception("浏览器不支持XMLHttpRequest！")}},{key:"_initDomainPage",value:function(){var t=this;this.pnlDomain=new qi(this.hcl),this.pnlDomain.transparent=!0,this.pnlDomain.borderVisible=!1,this.pnlDomain.height=54;var e=new Ki(this.hcl,"检索");e.top=10,e.left=2,this.pnlDomain.addControl(e),this.edtFilter=new on(this.hcl),this.edtFilter.top=5,this.edtFilter.left=e.right+5,this.edtFilter.width=60,this.edtFilter.textPrompt="拼音、值",this.edtFilter.onChange=function(){t._filterDomainItem(t.edtFilter.text)},this.edtFilter.onKeyDown=function(e){e.keyCode!==Qe&&e.keyCode!==je&&e.keyCode!==Le||(t.FGridDomain.focused||t.FGridDomain.setFocus(),t.FGridDomain.keyDown(e))},this.pnlDomain.addControl(this.edtFilter),this.btnCustom=new Ji(this.hcl,"自定义"),this.btnCustom.top=5,this.btnCustom.left=this.edtFilter.right+5,this.btnCustom.width=48,this.btnCustom.onClick=function(){t._trunStringPage(t.FDeItem.AllocValue?t.FDeItem.Text:""),t.memo.setFocus()},this.pnlDomain.addControl(this.btnCustom),this.btnRM=new Ji(this.hcl,"多选"),this.btnRM.top=5,this.btnRM.left=this.btnCustom.right+5,this.btnRM.width=40,this.btnRM.onClick=function(){t.MultSelect=!t.FMultSelect},this.pnlDomain.addControl(this.btnRM);var i=new Ji(this.hcl,"确定");i.top=5,i.left=this.btnRM.right+5,i.width=50,i.onClick=function(){t.btnDomainOKClick()},this.pnlDomain.addControl(i),this.chkItemOrd=new en(this.hcl,"序号"),this.chkItemOrd.left=e.left,this.chkItemOrd.top=i.bottom+8,this.pnlDomain.addControl(this.chkItemOrd);var n=new Ki(this.hcl,"间隔");n.left=this.chkItemOrd.right,n.top=this.chkItemOrd.top+2,this.pnlDomain.addControl(n),this.cbbOrdSplit=new mn(this.hcl,"、"),this.cbbOrdSplit.addItem("."),this.cbbOrdSplit.addItem("、"),this.cbbOrdSplit.addItem(""),this.cbbOrdSplit.left=n.right,this.cbbOrdSplit.top=this.chkItemOrd.top-2,this.cbbOrdSplit.width=34,this.cbbOrdSplit.dropDownWidth=34,this.pnlDomain.addControl(this.cbbOrdSplit);var o=new Ki(this.hcl,"选项间隔");o.left=this.cbbOrdSplit.right+5,o.top=this.chkItemOrd.top+2,this.pnlDomain.addControl(o),this.cbbItemSplit=new mn(this.hcl,"；"),this.cbbItemSplit.addItem("、"),this.cbbItemSplit.addItem("；"),this.cbbItemSplit.addItem(""),this.cbbItemSplit.left=o.right+2,this.cbbItemSplit.top=this.cbbOrdSplit.top,this.cbbItemSplit.width=34,this.cbbItemSplit.dropDownWidth=34,this.pnlDomain.addControl(this.cbbItemSplit),this.chkItemMutex=new en(this.hcl,"排斥"),this.chkItemMutex.left=this.cbbItemSplit.right+2,this.chkItemMutex.top=this.chkItemOrd.top,this.pnlDomain.addControl(this.chkItemMutex),this.pnlDomain.align=Xt,this.FPageDomain.addControl(this.pnlDomain),this.FPopupDomainShowCustom=!1,this.edtDirCustom=new on(this.hcl,""),this.edtDirCustom.align=Qt,this.edtDirCustom.onKeyDown=function(e){e.keyCode===Le?t.doMemoOK(t.edtDirCustom.text):e.keyCode!==Qe&&e.keyCode!==je||(t.FGridDomain.focused||t.FGridDomain.setFocus(),t.FGridDomain.keyDown(e))},this.btnDirCustom=new Ji(this.hcl,"自定义"),this.btnDirCustom.width=50,this.btnDirCustom.align=Zt,this.btnDirCustom.onClick=function(){t.doMemoOK(t.edtDirCustom.text)},this.pnlDirCustom=new qi(this.hcl),this.pnlDirCustom.height=26,this.pnlDirCustom.align=qt,this.pnlDirCustom.addControl(this.btnDirCustom),this.pnlDirCustom.addControl(this.edtDirCustom),this.FPageDomain.addControl(this.pnlDirCustom),this.pnlDirCustom.onResize=function(){t.edtDirCustom.width=t.width-55},this.pnlDirCustom.visible=this.FPopupDomainShowCustom,this.FGridDomain=new Rn(this.hcl,3,6),this.FGridDomain.readOnly=!0,this.FGridDomain.onMouseUp=function(e){t.doGridDomainMouseUp(e)},this.FGridDomain.onDblClick=function(){!t.FMultSelect&&t.FGridDomain.row>0&&t.FGridDomain.col>0&&t.btnDomainOKClick()},this.FGridDomain.onKeyDown=function(e){t.doGridDomainKeyDown(e)},this.FGridDomain.onCellPaint=function(e,i,n,o){return t.DomainCellPaint(e,i,n,o)},this.FGridDomain.borderVisible=!1,this.FGridDomain.setColWidth(0,0),this.SetDomainDlg(this.hcl.emrCommon.domainDlg),this.FGridDomain.transparent=!0,this.FGridDomain.align=$t,this.FPageDomain.addControl(this.FGridDomain),this.FGridDomain.rows[0][0].value="",this.FGridDomain.rows[0][1].value="值",this.FGridDomain.rows[0][2].value="编码",this.FGridDomain.rows[0][3].value="ID",this.FGridDomain.rows[0][4].value="拼音",this.FGridDomain.rows[0][5].value="扩展",this.FGridDomain.fixRowCount=1,this.FPageDomain.addControl(this.FGridDomain),this.lblWait=new Ki(this.hcl,"正在加载..."),this.lblWait.left=this.FGridDomain.left,this.lblWait.top=this.FGridDomain.top,this.lblWait.width=100,this.FPageDomain.addControl(this.lblWait)}},{key:"_initNumberPage",value:function(){var t=this,e=new Ki(this.hcl,"数值");e.left=5,e.top=10,this.FPageNumber.addControl(e);var i=new Ki(this.hcl,"单位");i.left=5,i.top=35,this.FPageNumber.addControl(i),this.edtValue=new an(this.hcl),this.edtValue.valueMask=rn,this.edtValue.top=5,this.edtValue.left=e.right+5,this.edtValue.width=60,this.edtValue.onKeyDown=function(e){t.doNumberValueKeyDonw(e)},this.FPageNumber.addControl(this.edtValue),this.cbbUnit=new mn(this.hcl),this.cbbUnit.left=i.right+5,this.cbbUnit.top=30,this.cbbUnit.width=60,this.FPageNumber.addControl(this.cbbUnit),this.chkHideUnit=new en(this.hcl,"隐藏单位"),this.chkHideUnit.top=this.cbbUnit.bottom+5,this.chkHideUnit.left=5,this.FPageNumber.addControl(this.chkHideUnit);var n=new Ji(this.hcl,"确定");n.left=this.edtValue.right+5,n.top=5,n.onClick=function(){t.doNumberOk()},this.FPageNumber.addControl(n)}},{key:"_initMemoPage",value:function(){var t=this;this.memo=new on(this.hcl),this.memo.top=5,this.memo.left=5,this.memo.width=190,this.memo.onKeyDown=function(e){t.doMemoValueKeyDown(e)};var e=new Ji(this.hcl,"确定");e.left=this.memo.left,e.top=this.memo.bottom+5,e.onClick=function(){t.doMemoOK(t.memo.text)},this.FPageMemo.addControl(this.memo),this.FPageMemo.addControl(e)}},{key:"_initDateTimePage",value:function(){var t=this;this.dtpDateTime=new yn(this.hcl,lt.Now()),this.dtpDateTime.top=5,this.dtpDateTime.left=5,this.dtpDateTime.width=190,this.dtpDateTime.onKeyDown=function(e){e.keyCode===Le&&t.btnDateTimeOkClick()},this.FPageDateTime.addControl(this.dtpDateTime);var e=new Ki(this.hcl,"格式：");e.left=this.dtpDateTime.left,e.top=this.dtpDateTime.bottom+8,this.FPageDateTime.addControl(e),this.cbbDTFmt=new mn(this.hcl,"yyyy-MM-dd hh:mm"),this.cbbDTFmt.left=e.right,this.cbbDTFmt.top=this.dtpDateTime.bottom+5,this.cbbDTFmt.width=this.dtpDateTime.width-e.width,this.cbbDTFmt.dropDownWidth=this.dtpDateTime.width,this.cbbDTFmt.addItem("yyyy-MM-dd hh:mm"),this.cbbDTFmt.addItem("yyyy-MM-dd hh:mm:ss"),this.cbbDTFmt.addItem("yyyy年MM月dd日 hh时mm分"),this.cbbDTFmt.addItem("yyyy-MM-dd"),this.cbbDTFmt.addItem("yyyy年MM月dd日"),this.cbbDTFmt.onSelectedIndexChange=function(){t.dtpDateTime.format=t.cbbDTFmt.text,t.dtpDateTime.dateTime=lt.CreateByDateTime(t.dtCalc.dateTime)},this.FPageDateTime.addControl(this.cbbDTFmt),this.dtCalc=new Sn(this.hcl,lt.Now()),this.dtCalc.left=5,this.dtCalc.top=this.cbbDTFmt.bottom+5,this.dtCalc.width=190,this.dtCalc.btnDone.visible_=!1,this.dtCalc.onChange=function(){t.dtpDateTime.dateTime=lt.CreateByDateTime(t.dtCalc.dateTime)},this.FPageDateTime.addControl(this.dtCalc);var i=new Ji(this.hcl,"当前日期时间");i.autoWidth=!0,i.left=35,i.top=this.dtCalc.bottom+5,i.onClick=function(){t.dtpDateTime.dateTime=lt.Now(),t.dtCalc.dateTime=lt.CreateByDateTime(t.dtpDateTime.dateTime)},this.FPageDateTime.addControl(i);var n=new Ji(this.hcl,"确定");n.width=56,n.left=i.right+10,n.top=i.top,n.onClick=function(){t.btnDateTimeOkClick()},this.FPageDateTime.addControl(n)}},{key:"_filterDomainItem",value:function(t){var e=this.FDomainItems.cv;if(""===t){this.FDomainItems.visibleCount=this.FDomainItems.cv.length;for(var i=0;i<e.length;i++)e[i].visible=!0}else{for(var n=!1,o=0;o<t.length;o++)if(t.charCodeAt(o)>255){n=!0;break}for(var s=0,r=t.toUpperCase(),a=0;a<e.length;a++)(n?e[a].value.indexOf(t)>=0:e[a].py.toUpperCase().indexOf(r)>=0)?(e[a].visible=!0,s++):e[a].visible=!1;this.FDomainItems.visibleCount=s}this._iniDomainItems()}},{key:"_iniDomainItems",value:function(){var t=this.FDomainItems.cv;this.FSelectAll=1,this.FGridDomain.beginUpdate();try{this.FGridDomain.rowCount=this.FDomainItems.visibleCount+1,this.FGridDomain.fixRowCount=1,this.FGridDomain.row=-1;for(var e=1,i=0,n=this.FDomainItems.count;i<n;i++)t[i].visible&&(1!==t[i].chk_&&(this.FSelectAll=0),this.FGridDomain.rows[e][1].value=t[i].value,this.FGridDomain.rows[e][2].value=t[i].code,this.FGridDomain.rows[e][3].value=null!=t[i].id?t[i].id:"",this.FGridDomain.rows[e][4].value=null!=t[i].py?t[i].py:"",this.FGridDomain.rows[e][5].value=null!=t[i].content?t[i].content:"",this.FGridDomain.rows[e].obj=t[i],e++);if(this.FGridDomain.rowCount>13)this.height=300,this._popupShow(this.left,this.top);else{var o=this.pnlDomain.height+this.FGridDomain.contentHeight;this.FGridDomain.HScroll_.visible&&(o+=this.FGridDomain.HScroll_.height),this.FPopupDomainShowCustom?this.height=(o<this.FDomainMinH?this.FDomainMinH:o)+this.pnlDirCustom.height:this.height=o<this.FDomainMinH?this.FDomainMinH:o}this.FGridDomain.scrollToRow(this.FGridDomain.row),this.lblWait.visible=!1,this.FGridDomain.visible=!0}finally{this.FGridDomain.endUpdate()}}},{key:"IniDomainUIByJSON",value:function(t){this.FMultSelect?this.pnlDomain.height=54:this.pnlDomain.height=30,this.FDeItem.GetValue($h)?this.chkItemMutex.checked=!0:this.chkItemMutex.checked=!1,this.FGridDomain.beginUpdate();try{if(this.FGridDomain.rowCount=1,null==t)return this.FDomainItems=JSON.parse('{"count": 0, "cv": []}'),this.lblWait.visible=!1,this.FGridDomain.visible=!0,void(this.height=this.FDomainMinH)}finally{this.FGridDomain.endUpdate()}var e="",i="";this.FDeItem.AllocValue&&(""!==this.FDeItem.GetValue(Yh.CMVVCode)&&(e=","+this.FDeItem.GetValue(Yh.CMVVCode)+","),""!==this.FDeItem.GetValue(Yh.CMVVID)&&(i=","+this.FDeItem.GetValue(Yh.CMVVID)+",")),this.FDomainItems=t,this.FDomainItems.count=this.FDomainItems.cv.length,this.FDomainItems.visibleCount=this.FDomainItems.count;for(var n=0,o=this.FDomainItems.cv.length;n<o;n++)this.FDomainItems.cv[n].visible=!0,""!==i?i.indexOf(","+this.FDomainItems.cv[n].id+",")>=0?this.FDomainItems.cv[n].chk_=1:this.FDomainItems.cv[n].chk_=0:e.indexOf(","+this.FDomainItems.cv[n].code+",")>=0?this.FDomainItems.cv[n].chk_=1:this.FDomainItems.cv[n].chk_=0;this._iniDomainItems(),this.FPopupDomainShowCustom&&this.edtDirCustom.update()}},{key:"SetDomainDlg",value:function(t){if(this.FGridDomain.setColWidth(1,110),this.FGridDomain.setColWidth(2,35),this.FGridDomain.setColWidth(3,25),this.FGridDomain.setColWidth(4,30),this.FGridDomain.setColWidth(5,30),null!=t){var e=t.colWs;null!=e&&(this.FGridDomain.setColWidth(1,null!=e.val?e.val:110),this.FGridDomain.setColWidth(2,null!=e.code?e.code:35),this.FGridDomain.setColWidth(3,null!=e.id?e.id:25),this.FGridDomain.setColWidth(4,null!=e.py?e.py:30),this.FGridDomain.setColWidth(5,null!=e.extra?e.extra:30)),t.clickOnce&&(this.FGridDomain.onClick=this.FGridDomain.onDblClick)}else null!=this.hcl.emrCommon.domainPopupGridItemColWidth&&this.FGridDomain.setColWidth(1,this.hcl.emrCommon.domainPopupGridItemColWidth)}},{key:"DomainCellPaint",value:function(t,e,i,n){if(this.FMultSelect&&0===n){var o=0===i?this.FSelectAll:this.FGridDomain.rows[i].obj.chk_;return 1===o?this.hcl.theme.drawFrameControl(t,e,new Set([Pi]),bi):2===o?this.hcl.theme.drawFrameControl(t,e,new Set([ki]),bi):this.hcl.theme.drawFrameControl(t,e,new Set([]),bi),!0}return!1}},{key:"doGridDomainMouseUp",value:function(t){var e=this.FGridDomain.getCellAt(t.x,t.y);if(this.FMultSelect&&this.FGridDomain.col<2){this.FGridDomain.beginUpdate();try{if(0===e.fixrow){if(0===e.fixcol){this.chkItemMutex.state===ki?0===this.FSelectAll?this.FSelectAll=1:1===this.FSelectAll?this.FSelectAll=2:2===this.FSelectAll&&(this.FSelectAll=0):this.FSelectAll=0===this.FSelectAll?1:0;for(var i=0;i<this.FDomainItems.cv.length;i++)this.FDomainItems.cv[i].visible&&(this.FDomainItems.cv[i].chk_=this.FSelectAll)}}else if(e.row>=0){var n=this.FGridDomain.rows[e.row].obj;this.chkItemMutex.state===ki?0===n.chk_?n.chk_=1:1===n.chk_?n.chk_=2:2===n.chk_&&(n.chk_=0):n.chk_=0===n.chk_?1:0;for(var o=0;o<this.FDomainItems.cv.length;o++)if(this.FDomainItems.cv[o].chk_!==n.chk_)return void(this.FSelectAll=0);this.FSelectAll=n.chk_}}finally{this.FGridDomain.endUpdate()}}}},{key:"doItemPopupSetClose",value:function(){null!==this.OnItemPopupSetCloseLib&&this.OnItemPopupSetCloseLib()}},{key:"doNumberOk",value:function(){var t=this.edtValue.text;""!==t&&(this.chkHideUnit.checked||(t+=this.cbbUnit.text),this.SetDeItemValue(t)||(this.FDeItem.SetValue(Yh.Unit,this.cbbUnit.text),this.chkHideUnit.checked?this.FDeItem.SetValue(Yh.HideUnit,"1"):this.FDeItem.DeleteProperty(Yh.HideUnit),this.visible=!1,this.doItemPopupSetClose()))}},{key:"doMemoOK",value:function(t){""!==t&&(this.SetDeItemValue(t)||(this.FDeItem.Propertys.remove($h),this.FDeItem.Propertys.remove(Yh.CMVVCode),this.FDeItem.Propertys.remove(Yh.CMVVID),this.visible=!1,this.doItemPopupSetClose()))}},{key:"btnDomainOKClick",value:function(){var t=!1;if(this.FMultSelect){for(var e="",i="",n="",o="",s=0,r=0;r<this.FDomainItems.cv.length;r++)this.chkItemMutex.state!==xi?1===this.FDomainItems.cv[r].chk_?(n=n+this.FDomainItems.cv[r].code+",",o+=this.FDomainItems.cv[r].id+",",e+=this.FDomainItems.cv[r].value+this.cbbItemSplit.text):this.chkItemMutex.state===ki&&0===!this.FDomainItems.cv[r].chk_||(i+=this.FDomainItems.cv[r].value+this.cbbItemSplit.text):1===this.FDomainItems.cv[r].chk_&&(s++,n=n+this.FDomainItems.cv[r].code+",",o+=this.FDomainItems.cv[r].id+",",this.chkItemOrd.checked&&(e+=s.toString()+this.cbbOrdSplit.text),e+=this.FDomainItems.cv[r].value+this.cbbItemSplit.text);if(n=L.stringDelete(n,n.length-1,1),o=L.stringDelete(o,o.length-1,1),this.chkItemMutex.state!==xi)""!==e&&(""!==this.cbbItemSplit.text&&(e=L.stringDelete(e,e.length-1,1)),e=""!==this.FDeItem.GetValue(tc)?this.FDeItem.GetValue(tc)+e:"有"+e),""!==i&&(""!==this.cbbItemSplit.text&&(i=L.stringDelete(i,i.length-1,1)),i=""!==this.FDeItem.GetValue(ec)?this.FDeItem.GetValue(ec)+i:"无"+i),(t=""===e?this.SetDeItemValue(i):""===i?this.SetDeItemValue(e):this.SetDeItemValue(e+"，"+i))||(this.FDeItem.SetValue(Yh.CMVVCode,n),this.FDeItem.SetValue(Yh.CMVVID,o),this.FDeItem.SetValue($h,"1"));else if(""!==e)e=L.stringDelete(e,e.length-1,1),(t=this.SetDeItemValue(e))||(this.FDeItem.SetValue(Yh.CMVVCode,n),this.FDeItem.SetValue(Yh.CMVVID,o),this.FDeItem.Propertys.remove($h));else{if(!this.NoDomainInit)return;t=this._initDEText()}}else if(this.FGridDomain.row_>=0){var a=this.FGridDomain.row,l={data:this.FPopupData,itemNo:this.FPopupData.GetActiveItemNo(),id:this.FGridDomain.rows[a][3].value,extra:""!=this.FGridDomain.rows[a][5].value,cvobj:this.FGridDomain.rows[a].obj};(t=!l.extra&&this.SetDeItemValue(this.FGridDomain.rows[a][1].value,l))||(this.FDeItem.SetValue(Yh.Frmtp,Zh.Radio),this.FDeItem.SetValue(Yh.CMVVCode,this.FGridDomain.rows[a][2].value),this.FDeItem.SetValue(Yh.CMVVID,this.FGridDomain.rows[a][3].value),l.extra&&this.SetDeItemExtraValue(this.FGridDomain.rows[a][3].value,l))}else{if(!this.NoDomainInit)return;t=this._initDEText()}t||(this.visible=!1,this.doItemPopupSetClose())}},{key:"btnDateTimeOkClick",value:function(){""!==this.dtpDateTime.text&&(this.SetDeItemValue(this.dtpDateTime.text)||(this.visible=!1,this.doItemPopupSetClose()))}},{key:"doNumberValueKeyDonw",value:function(t){t.keyCode===Le&&this.doNumberOk()}},{key:"doMemoValueKeyDown",value:function(t){t.keyCode===Le&&this.doMemoOK(this.memo.text)}},{key:"doGridDomainKeyDown",value:function(t){t.keyCode===Le?this.btnDomainOKClick():t.keyCode===We&&(this.FGridDomain.col=0,this.doGridDomainClick())}},{key:"_trunStringPage",value:function(t){this.pageIndex=2,this.width=200,this.height=60,this.memo.text=t,""!==this.memo.text&&this.memo.select(0,this.memo.text.length)}},{key:"_popupShow",value:function(t,e){t+this.width>this.parent.width&&(t=this.parent.width-this.width),t<0&&(t=0),e+this.height>this.parent.height&&(e=e-this.height-this.FDeItemHeight),e<0&&(e=0),this.left=t,this.top=e,this.visible=!0}},{key:"_showPopupDeItem",value:function(t,e,i){this.FFrmtp=Zh.String,this.FFrmtp=t.GetValue(Yh.Frmtp);var n=t.GetValue(Yh.Unit),o=t.GetValue(Yh.CMV);if(this.FFrmtp===Zh.Number){if(this.FTemplate=!1,this.FTemp=!1,this.FConCalcValue=!1,""!==this.FDeItem.GetValue(Yh.Unit)?this.edtValue.text=this.FDeItem.Text.replace(new RegExp(this.FDeItem.GetValue(Yh.Unit),"g"),""):this.edtValue.text=this.FDeItem.Text,""!=this.edtValue.text&&this.edtValue.selectAll(),this.cbbUnit.items.clear(),n)for(var s=n.split(","),r=0;r<s.length;r++)""!=s[r]&&this.cbbUnit.items.add(s[r]);else console.log(this.FDeItem.Index+" 数值元素缺少单位！");this.cbbUnit.items.count>0?(this.cbbUnit.itemIndex=this.cbbUnit.items.indexOf(this.FDeItem.GetValue(Yh.Unit)),this.cbbUnit.itemIndex<0&&(this.cbbUnit.itemIndex=0)):this.cbbUnit.text=this.FDeItem.GetValue(Yh.Unit),this.chkHideUnit.checked="1"==this.FDeItem.GetValue(Yh.HideUnit),this.pageIndex=1,this.width=185,this.height=100}else if(this.FFrmtp===Zh.Date||this.FFrmtp===Zh.Time||this.FFrmtp===Zh.DateTime){this.pageIndex=3,this.dtpDateTime.dateTime=lt.CreateByString(this.FDeItem.Text),this.dtCalc.dateTime=lt.CreateByString(this.FDeItem.Text),this.width=200,this.height=275,this.hcl.emrCommon.disPopupDateTimeFormat?this.cbbDTFmt.enabled=!1:this.cbbDTFmt.enabled=!0;var a=this.FDeItem.GetValue(Yh.DTFormat);""!==a?this.cbbDTFmt.text=a:this.FFrmtp===Zh.Date?this.cbbDTFmt.text=this.hcl.emrCommon.dateFormatDef:this.FFrmtp===Zh.Time?this.cbbDTFmt.text=this.hcl.emrCommon.timeFormatDef:this.cbbDTFmt.text=this.hcl.emrCommon.dateFormatDef+" "+this.hcl.emrCommon.timeFormatDef,this.dtpDateTime.format=this.cbbDTFmt.text}else if(this.FFrmtp===Zh.Radio||this.FFrmtp===Zh.Multiselect){this.beginUpdate();try{this.pageIndex=0,this.width=250,this.height=this.FDomainMinH,this.btnCustom.visible=this.hcl.emrCommon.CustomBtn,this.btnRM.visible=this.hcl.emrCommon.MultipleSingleBtn,this.lblWait.visible_=!0,this.FGridDomain.visible_=!1,this._popupShow(e.x,e.y)}finally{this.endUpdate()}this.beginUpdate();try{if(this.MultSelect=this.FFrmtp===Zh.Multiselect,this.edtFilter.clear(),this.FGridDomain.rowCount>1&&(this.FGridDomain.rowCount=1),""!==o)if(null!==this.OnPopupGetDeItemDomainLibAsync)this.OnPopupGetDeItemDomainLibAsync(o,e.x,e.y,t);else{if(null!==this.OnPopupGetDeItemDomainLib){var l=this.OnPopupGetDeItemDomainLib(o,t);return this.PopupSetDeItemDomain(l,e.x,e.y),!0}this.lblWait.visible_=!1}}finally{this.endUpdate()}}else{if(this.FFrmtp!==Zh.String)return!1;this._trunStringPage(this.FDeItem.AllocValue?this.FDeItem.Text:"")}return this._popupShow(e.x,e.y),this.FFrmtp===Zh.Number?this.edtValue.setFocus():this.FFrmtp===Zh.Radio||this.FFrmtp===Zh.Multiselect?this.FPopupDomainShowCustom?(this.edtDirCustom.setFocus(),this.edtDirCustom.text=this.FDeItem.Text,this.edtDirCustom.select(this.edtDirCustom.text.length)):this.edtFilter.setFocus():this.FFrmtp===Zh.Date||this.FFrmtp===Zh.Time||this.FFrmtp===Zh.DateTime?this.dtpDateTime.setFocus():this.FFrmtp===Zh.String&&(this.memo.setFocus(),i>=0&&i<=this.memo.text.length?this.memo.select(i):this.memo.select(0,this.memo.text.length)),!0}},{key:"PopupSetDeItemDomain",value:function(t,e,i){null!==t&&(this.IniDomainUIByJSON(t),this.height!==this.FDomainMinH&&this._popupShow(e,i))}},{key:"PopupDeItem",value:function(t,e,i,n,o){this.MultSelect=!1,this.FDeItem=t,this.FPopupData=o,this.FFrmtp="",this.FDeItemHeight=i;return null!==this.OnPopupGetDeItemInfoLib&&this.OnPopupGetDeItemInfoLib(t),this._showPopupDeItem(t,e,n)}},{key:"SetDeItemValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!==this.OnSetPopupItemText&&this.OnSetPopupItemText(this.FDeItem,t,e)}},{key:"SetDeItemExtraValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null!==this.OnPopupGetDomainItemExtraLib)this.OnPopupGetDomainItemExtraLib(this.FDeItem,t,e);else if(null!==this.OnSetActiveItemExtra&&(this.FDBDomain.select("id="+t),this.FDBDomain.count>0)){var i=new ht;this.FDBDomain[0].fieldByName("content").saveToStream(i),i.position=0,this.OnSetActiveItemExtra(this.FDeItem,i)}}},{key:"_initDEText",value:function(){var t=this.FDeItem.GetDefaultText();this.FDeItem.Propertys.remove(Yh.CMVVCode),this.FDeItem.Propertys.remove(Yh.CMVVID);var e=this.SetDeItemValue(t);return this.FDeItem.AllocValue=!1,e}},{key:"SetMultSelect",value:function(t){if(this.FMultSelect!==t){this.beginUpdate();try{this.FMultSelect=t,this.FMultSelect?(this.cbbOrdSplit.text=this.hcl.emrCommon.MultItemOrdSpliter,this.cbbItemSplit.text=this.hcl.emrCommon.MultItemSpliter,this.FGridDomain.setColWidth(0,20),this.pnlDomain.height=54,this.height+=24,this.btnRM.text="单选"):(this.FGridDomain.setColWidth(0,0),this.pnlDomain.height=30,this.height-=24,this.btnRM.text="多选"),this.FGridDomain.setFocus()}finally{this.endUpdate()}}}},{key:"MultSelect",get:function(){return this.FMultSelect},set:function(t){this.SetMultSelect(t)}},{key:"PopupDomainShowCustom",get:function(){return this.FPopupDomainShowCustom},set:function(t){this.FPopupDomainShowCustom!==t&&(this.FPopupDomainShowCustom=t,this.pnlDirCustom.visible=this.FPopupDomainShowCustom)}}]),i}(Dn);function xc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Rc=function(t){m()(i,t);var e=xc(i);function i(t,n,o,s,a,l){var h;return r()(this,i),(h=e.call(this,t,n,o,s,a,l)).StyleNo=mh.EMRSTYLE_FANGJIAO,h.Propertys=new rt,h.DeleteAllow=!0,h.EditProtect=!1,h.AllocValue=!1,h}return l()(i,[{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.AllocValue=!0}},{key:"GetLastVersion",value:function(){return 2}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.Propertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"===t?this.EditProtect=L.parseBooleanDef(e,this.EditProtect):"DeleteAllow"===t?this.DeleteAllow=L.parseBooleanDef(e,this.DeleteAllow):"AllocValue"===t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.Propertys,t,e)}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){if(!this.Active&&!this.FMouseIn||a.Print||(r.brush.color=Yl.clBtnFace,r.fillRect(e)),t.TextStyles[this.TextStyleNo].ApplyStyle(r,a.ScaleY/a.Zoom),r.textOut(e.left+this.LeftRect.left,e.top+this.LeftRect.top,this.LeftText),r.textOut(e.left+this.TopRect.left,e.top+this.TopRect.top,this.TopText),r.textOut(e.left+this.RightRect.left,e.top+this.RightRect.top,this.RightText),r.textOut(e.left+this.BottomRect.left,e.top+this.BottomRect.top,this.BottomText),r.pen.color=Ft.Black,r.drawLineDriect(e.left,e.top,e.right,e.bottom),r.drawLineDriect(e.right,e.top,e.left,e.bottom),!a.Print&&!this.EditProtect){var l=new nt;if(this.FMouseIn&&(r.pen.color=Ft.Gray,l.resetRect(this.LeftRect),l.offset(e.left,e.top),l.inFlate(2,2),r.rectangleRect(l),l.resetRect(this.TopRect),l.offset(e.left,e.top),l.inFlate(2,2),r.rectangleRect(l),l.resetRect(this.RightRect),l.offset(e.left,e.top),l.inFlate(2,2),r.rectangleRect(l),l.resetRect(this.BottomRect),l.offset(e.left,e.top),l.inFlate(2,2),r.rectangleRect(l)),this.FActiveArea!=Xl.None){switch(this.FActiveArea){case Xl.Left:l.resetRect(this.LeftRect);break;case Xl.Top:l.resetRect(this.TopRect);break;case Xl.Right:l.resetRect(this.RightRect);break;default:l.resetRect(this.BottomRect)}l.offset(e.left,e.top),l.inFlate(2,2),r.pen.color=Ft.Blue,r.rectangleRect(l)}}}},{key:"MouseDown",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseDown",this).call(this,t)}},{key:"MouseMove",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseMove",this).call(this,t)}},{key:"MouseUp",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseUp",this).call(this,t)}},{key:"KeyDown",value:function(t){this.EditProtect||f()(F()(i.prototype),"KeyDown",this).call(this,t)}},{key:"KeyPress",value:function(t){this.EditProtect?t.keyCode=0:f()(F()(i.prototype),"KeyPress",this).call(this,t)}},{key:"AcceptAction",value:function(t,e,n){return!(n===rh.DeleteItem&&!this.DeleteAllow)&&f()(F()(i.prototype),"AcceptAction",this).call(this,t,e,n)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.DeleteAllow=t.DeleteAllow,this.EditProtect=t.EditProtect,this.AllocValue=t.AllocValue,this.Propertys.assign(t.Propertys)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.EditProtect&&(o|=128),this.DeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FVersion>0){var o=t.readByte();this.EditProtect=L.isOdd(o>>7),this.DeleteAllow=L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4)}else this.EditProtect=!1,this.DeleteAllow=!0,this.AllocValue=!1;if(this.FVersion>1){var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.Propertys)}}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)}}]),i}(na);function Tc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var bc=l()((function t(){r()(this,t)}));bc.Index="Index",bc.Code="Code",bc.Name="Name",bc.SubType="RT",bc.Prompt="Prompt",bc.Title="Title",bc.Propertys="Propertys",bc.EndRestrain="EndRestrain",bc.BeginRestrain="BeginRestrain",bc.OutOfRang="OutOfRang",bc.BlankPrintHideTitle="BlankPrintHideTitle";var Bc=l()((function t(){r()(this,t)}));Bc.Proc="P";var Nc=function(t){m()(i,t);var e=Tc(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FChanged=!1,o.FReadOnly=!1,o.EditProtect=!1,o.OutOfRang=!1,o.FVersion=1,o.FTitle="",o.FPrompt="",o.FTextStyleNo=n.Style.GetDefaultStyleNo(),o.FTitleStyleNo=o.FTextStyleNo,o.FEndRestrain=!1,o.FBeginRestrain=!1,Yl.PROCSERIES&&(o.FIsProc=!1),o.TitleWidth=0,o.DeleteAllow=!0,o.AllocMust=!1,o.BlankPrintHideTitle=!1,o.FPropertys=new rt,o.Scripts=new rt,o}return l()(i,[{key:"GetLastVersion",value:function(){return 1}},{key:"GetValue",value:function(t){var e=this.FPropertys.valueByKey(t);return null!=e?e:""}},{key:"SetValue",value:function(t,e){(e=e.toString()).indexOf("=")>=0?this.hcl.exception("属性值中不允许有=号"):(Yl.HCSetProperty(this.FPropertys,t,e),this.PropertyChange())}},{key:"DeleteProperty",value:function(t){Yl.HCRemoveProperty(this.FPropertys,t)}},{key:"GetAllocValue",value:function(){return!this.Empty}},{key:"GetIsProcBegin",value:function(){return this.MarkType==ch.Beg&&this.FIsProc}},{key:"GetIsProcEnd",value:function(){return this.MarkType==ch.End&&this.FIsProc}},{key:"DoPaint",value:function(t,e,n,o,s,r,a,l){f()(F()(i.prototype),"DoPaint",this).call(this,t,e,n,o,s,r,a,l),this.MarkType==ch.Beg&&(""!=this.FTitle&&(this.Selected()||(a.brush.style=Mt.Clear),t.TextStyles[this.FTitleStyleNo].ApplyStyle(a,l.ScaleY/l.Zoom),a.textOut(e.left,e.top+Math.trunc((e.height-t.TextStyles[this.FTitleStyleNo].FontHeight)/2),this.FTitle)),!l.Print&&this.Empty&&""!=this.FPrompt&&(this.Selected()||(this.Active?(a.brush.color=t.SelColor,a.fillBounds(e.left+this.TitleWidth,e.top,e.width-this.TitleWidth,e.height)):a.brush.style=Mt.Clear),t.TextStyles[this.FTextStyleNo].ApplyStyle(a,l.ScaleY/l.Zoom),a.font.styles.value=t.PromptFontStyles.value,a.font.color=t.PromptFontColor,a.textOut(e.left+this.TitleWidth,e.top+Math.trunc((e.height-t.TextStyles[this.FTextStyleNo].FontHeight)/2),this.FPrompt)))}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.EditProtect&&(o|=128),this.OutOfRang&&(o|=64),this.Empty&&(o|=16),this.DeleteAllow&&(o|=8),this.AllocMust&&(o|=2),t.writeByte(o),t.writeInt32(this.FTextStyleNo),t.writeInt32(this.FTitleStyleNo),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator)),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),n>58){var o=t.readByte();this.Empty=L.isOdd(o>>4),this.AllocMust=L.isOdd(o>>1),this.DeleteAllow=L.isOdd(o>>3),this.OutOfRang=L.isOdd(o>>6),this.EditProtect=L.isOdd(o>>7)}else null!=this.hcl.deGroupDeleteAllowDefaultLow59?this.DeleteAllow=this.hcl.deGroupDeleteAllowDefaultLow59:this.DeleteAllow=!0;if(n>51)this.FTextStyleNo=t.readInt32(),this.FVersion>0?this.FTitleStyleNo=t.readInt32():this.FTitleStyleNo=this.FTextStyleNo,this.OwnerData.Style.MergeStyle&&(null!=e?(this.FTextStyleNo=this.OwnerData.Style.GetStyleNo(e.TextStyles[this.FTextStyleNo],!0),this.FTitleStyleNo=this.OwnerData.Style.GetStyleNo(e.TextStyles[this.FTitleStyleNo],!0)):(this.FTextStyleNo=this.OwnerData.Style.GetDefaultStyleNo(),this.FTitleStyleNo=this.FTextStyleNo));else{var s=new zn(this.hcl);this.FTextStyleNo=this.OwnerData.Style.GetStyleNo(s,!0),this.FTitleStyleNo=this.FTextStyleNo,s=null}var r=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(r,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(r,this.FPropertys),this.PropertyChange(),n>57&&(r=Yl.HCLoadTextFromStream(t,n),Yl.SetPropertyString(r,this.Scripts,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FReadOnly=t.ReadOnly,this.DeleteAllow=t.DeleteAllow,this.EditProtect=t.EditProtect,this.OutOfRang=t.OutOfRang,this.AllocMust=t.AllocMust,this.FPropertys.assign(t.Propertys),this.FTitleStyleNo=t.TitleStyleNo,this.FTextStyleNo=t.TextStyleNo,this.PropertyChange(),this.Scripts.assign(t.Scripts)}},{key:"MatchTextStyle",value:function(t,e){return e.Append=!e.StyleHasMatch(t,this.FTextStyleNo),!0}},{key:"ApplySelectTextStyle",value:function(t,e){this.FTextStyleNo=e.GetMatchStyleNo(this.hcl,t,this.FTextStyleNo)}},{key:"MarkStyleUsed",value:function(t){t?(this.OwnerData.Style.TextStyles[this.FTitleStyleNo].CheckSaveUsed=!0,this.OwnerData.Style.TextStyles[this.FTextStyleNo].CheckSaveUsed=!0):(this.FTitleStyleNo=this.OwnerData.Style.TextStyles[this.FTitleStyleNo].TempNo,this.FTextStyleNo=this.OwnerData.Style.TextStyles[this.FTextStyleNo].TempNo)}},{key:"FormatToDrawItem",value:function(t,e){this.Width=t.Style.DomainFormatWidth,t.Style.ApplyTempStyle(this.FTextStyleNo),this.Height=t.CalculateLineHeight(t.Style.TextStyles[this.FTextStyleNo],t.Style.ParaStyles[this.ParaNo])-t.Style.LineSpaceMin,this.Empty=!1;var i=null,n=-1;if(this.MarkType===ch.Beg){if(e<t.Items.count-1){for(n=e+1;n<t.Items.count;){if(t.Items[n].Visible){i=t.Items[n];break}n++}null!==i&&(i.StyleNo===this.StyleNo&&i.MarkType===ch.End?(this.Width=10,this.Empty=!0):i.ParaFirst&&(this.Width=10))}else this.Width=10;""!==this.FTitle?(t.Style.ApplyTempStyle(this.FTitleStyleNo),this.TitleWidth=t.Style.TempCanvas.textMetric(this.FTitle).width):this.TitleWidth=0;var o=0;if(this.Empty&&""!==this.FPrompt){this.Width=0;var s=t.Style.TempCanvas.font.styles.value;try{t.Style.TempCanvas.font.styles.value=t.Style.PromptFontStyles.value,o=t.Style.TempCanvas.textMetric(this.FPrompt).width}finally{t.Style.TempCanvas.font.styles.value=s}}0!==(o+=this.TitleWidth+this.Width)&&(this.Width=o)}else{for(n=e-1;n>=0;){if(t.Items[n].Visible){i=t.Items[n];break}n--}null!==i&&(i.StyleNo===this.StyleNo&&i.MarkType===ch.Beg?(this.Width=10,this.Empty=!0):this.ParaFirst&&(this.Width=10))}}},{key:"PaintTop",value:function(t,e){t.pen.width=1,t.pen.style=_t.Solid,t.pen.color=this.OwnerData.Style.DomainMarkColor,this.MarkType==ch.Beg?(t.beginPath(),t.moveTo(e.left+this.TitleWidth+3,e.top),t.lineTo(e.left+this.TitleWidth,e.top),t.moveTo(e.left+this.TitleWidth,e.top),t.lineTo(e.left+this.TitleWidth,e.bottom),t.moveTo(e.left+this.TitleWidth,e.bottom),t.lineTo(e.left+this.TitleWidth+3,e.bottom),t.paintPath()):(t.beginPath(),t.moveTo(e.right-4,e.top),t.lineTo(e.right-1,e.top),t.moveTo(e.right-1,e.top),t.lineTo(e.right-1,e.bottom),t.moveTo(e.right,e.bottom),t.lineTo(e.right-4,e.bottom),t.paintPath(),this.Empty&&this.AllocMust&&(t.brush.color=this.OwnerData.Style.AllocMustColor,t.fillRegion([{x:e.right-1,y:e.bottom-5},{x:e.right-1,y:e.bottom},{x:e.right-6,y:e.bottom}])))}},{key:"GetOffsetAt",value:function(t){return this.FBeginRestrain&&this.MarkType==ch.Beg?Yl.OffsetAfter:this.FEndRestrain&&this.MarkType==ch.End?Yl.OffsetBefor:Yl.PROCSERIES?this.GetIsProcEnd()?Yl.OffsetBefor:this.GetIsProcBegin()?Yl.OffsetAfter:f()(F()(i.prototype),"GetOffsetAt",this).call(this,t):f()(F()(i.prototype),"GetOffsetAt",this).call(this,t)}},{key:"GetTextStyleNo",value:function(){return this.FTextStyleNo}},{key:"FormatOffset",value:function(){return""===this.FTitle&&this.MarkType===ch.Beg?this.OwnerData.Style.DomainFormatWidth:f()(F()(i.prototype),"FormatOffset",this).call(this)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Index":"'+this.Index+'","EditProtect":'+(this.EditProtect?"true":"false")+',"DeleteAllow":'+(this.DeleteAllow?"true":"false")+',"AllocMust":'+(this.AllocMust?"true":"false")+',"OutOfRang":'+(this.OutOfRang?"true":"false")+',"Propertys":{'+Yl.GetPropertyJSONString(this.FPropertys)+"}";return this.FIsProc&&(e+=',"ProcIndex":"'+this.Index+'"'),e}},{key:"ParseJSONObject",value:function(t){if(f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),null!=t.ClearProperty&&t.ClearProperty&&this.FPropertys.clear(),t.Index&&Yl.HCSetProperty(this.FPropertys,bc.Index,t.Index),t.Code&&Yl.HCSetProperty(this.FPropertys,bc.Code,t.Code),t.Name&&Yl.HCSetProperty(this.FPropertys,bc.Name,t.Name),t.SubType&&Yl.HCSetProperty(this.FPropertys,bc.SubType,t.SubType),t.Prompt&&Yl.HCSetProperty(this.FPropertys,bc.Prompt,t.Prompt),t.Title&&Yl.HCSetProperty(this.FPropertys,bc.Title,t.Title),t.Frmtp&&Yl.HCSetProperty(this.FPropertys,Yh.Frmtp,t.Frmtp),t.CMV&&(t.Frmtp||Yl.HCSetProperty(this.FPropertys,Yh.Frmtp,Zh.Radio),Yl.HCSetProperty(this.FPropertys,Yh.CMV,t.CMV)),t.BeginRestrain&&Yl.HCSetProperty(this.FPropertys,bc.BeginRestrain,t.BeginRestrain),t.EndRestrain&&Yl.HCSetProperty(this.FPropertys,bc.EndRestrain,t.EndRestrain),t.Propertys&&("object"==o()(t.Propertys)?Yl.SetItemPropertyJSON(t.Propertys,this):Yl.SetItemPropertyString(t.Propertys,this)),null!=t.EditProtect&&(this.EditProtect=t.EditProtect),null!=t.AllocMust&&(this.AllocMust=t.AllocMust),null!=t.DeleteAllow&&(this.DeleteAllow=t.DeleteAllow),null!=t.ReadOnly&&(this.ReadOnly=t.ReadOnly),null!=t.OutOfRang&&(this.OutOfRang=t.OutOfRang),null!=t.TextStyle){var e=new zn(this.hcl);try{e.AssignEx(this.OwnerData.Style.TextStyles[this.FTextStyleNo]),e.ParseJSON(t.TextStyle),this.FTextStyleNo=this.OwnerData.Style.GetStyleNo(e,!0)}finally{e.dispose(),e=null}}if(null!=t.TitleStyle){var n=new zn(this.hcl);try{n.AssignEx(this.OwnerData.Style.TextStyles[this.FTitleStyleNo]),n.ParseJSON(t.TitleStyle),this.FTitleStyleNo=this.OwnerData.Style.GetStyleNo(n,!0)}finally{n.dispose(),n=null}}this.PropertyChange()}},{key:"PropertyChange",value:function(){this.FBeginRestrain="1"==this.GetValue(bc.BeginRestrain),this.FEndRestrain="1"==this.GetValue(bc.EndRestrain),this.FTitle=this.GetValue(bc.Title),this.FPrompt=this.GetValue(bc.Prompt),this.BlankPrintHideTitle="1"==this.GetValue(bc.BlankPrintHideTitle),Yl.PROCSERIES&&(this.FIsProc=this.GetValue(bc.SubType)==Bc.Proc)}},{key:"GetProperty",value:function(t){return"object"===t?this.ToJSONObject():"objstr"===t?this.ToJSONString():t==bc.OutOfRang?!!this.OutOfRang:this.GetValue(t)}},{key:"Index",get:function(){return this.GetValue(bc.Index)}},{key:"Code",get:function(){return this.GetValue(bc.Code)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,bc.Code):this.SetValue(Yh.Code,t)}},{key:"Name",get:function(){return this.GetValue(Yh.Name)},set:function(t){""==t?Yl.HCRemoveProperty(this.FPropertys,Yh.Name):this.SetValue(Yh.Name,t)}},{key:"TitleStyleNo",get:function(){return this.FTitleStyleNo},set:function(t){this.FTitleStyleNo=t}},{key:"TextStyleNo",get:function(){return this.FTextStyleNo},set:function(t){this.FTextStyleNo=t}},{key:"Propertys",get:function(){return this.FPropertys}},{key:"ReadOnly",get:function(){return this.FReadOnly},set:function(t){this.FReadOnly=t}},{key:"Changed",get:function(){return this.FChanged},set:function(t){this.FChanged=t}},{key:"AllocValue",get:function(){return this.GetAllocValue()}},{key:"IsProc",get:function(){return this.FIsProc}},{key:"IsProcBegin",get:function(){return this.GetIsProcBegin()}},{key:"IsProcEnd",get:function(){return this.GetIsProcEnd()}}]),i}(rs),Oc=function(t){m()(i,t);var e=Tc(i);function i(){var t;return r()(this,i),(t=e.call(this)).Clear(),t}return l()(i,[{key:"Clear",value:function(){this.Index="",this.SectionIndex=-1,f()(F()(i.prototype),"Clear",this).call(this)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.Index=t.Index,this.SectionIndex=t.SectionIndex}}]),i}(Ws);function _c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Ec=0,Mc=1,Lc=2,Gc=3,Hc=4,Vc=function(t){m()(i,t);var e=_c(i);function i(t,n,o,s,a,l){var h;return r()(this,i),(h=e.call(this,t,n)).StyleNo=mh.EMRSTYLE_TOOTH,h.DeleteAllow=!0,h.EditProtect=!1,h.AllocValue=!1,h.Propertys=new rt,h.FPadding=2,h.FActiveArea=Ec,h.FMouseMoveArea=Ec,h.FCaretOffset=-1,h.FEmptyLower=!0,h.AreaMinSize=5,h.FLeftTopText=o,h.FLeftBottomText=a,h.FRightTopText=s,h.FRightBottomText=l,h.FLeftTopRect=new nt,h.FLeftBottomRect=new nt,h.FRightTopRect=new nt,h.FRightBottomRect=new nt,h}return l()(i,[{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.AllocValue=!0}},{key:"GetLastVersion",value:function(){return 1}},{key:"HasProp",value:function(t){return this.Propertys.hasKey(t)}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.Propertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"==t?this.EditProtect=L.parseBooleanDef(e,this.EditProtect):"DeleteAllow"==t?this.DeleteAllow=L.parseBooleanDef(e,this.DeleteAllow):Yl.HCSetProperty(this.Propertys,t,e)}},{key:"GetToothArea",value:function(t,e){return this.FLeftTopRect.pointInAt(t,e)?Mc:this.FLeftBottomRect.pointInAt(t,e)?Gc:this.FRightTopRect.pointInAt(t,e)?Lc:this.FRightBottomRect.pointInAt(t,e)?Hc:Ec}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){if(!this.Active&&!this.FMouseIn||a.Print||(r.brush.color=Yl.clBtnFace,r.fillRect(e)),t.TextStyles[this.TextStyleNo].ApplyStyle(r,a.ScaleY/a.Zoom),""!=this.FLeftTopText&&r.textOut(e.left+this.FLeftTopRect.left,e.top+this.FLeftTopRect.top,this.FLeftTopText),""!=this.FLeftBottomText&&r.textOut(e.left+this.FLeftBottomRect.left,e.top+this.FLeftBottomRect.top,this.FLeftBottomText),""!=this.FRightTopText&&r.textOut(e.left+this.FRightTopRect.left,e.top+this.FRightTopRect.top,this.FRightTopText),""!=this.FRightBottomText&&r.textOut(e.left+this.FRightBottomRect.left,e.top+this.FRightBottomRect.top,this.FRightBottomText),r.pen.color=Ft.Black,r.pen.width=1,""==this.FLeftTopText&&""==this.FLeftBottomText?r.drawLineDriect(e.left+this.FLeftTopRect.right+this.FPadding,e.top+this.FLeftTopRect.bottom+this.FPadding,e.right,e.top+this.FLeftTopRect.bottom+this.FPadding):""==this.FRightTopText&&""==this.FRightBottomText?r.drawLineDriect(e.left,e.top+this.FLeftTopRect.bottom+this.FPadding,e.left+this.FLeftTopRect.right+this.FPadding,e.top+this.FLeftTopRect.bottom+this.FPadding):r.drawLineDriect(e.left,e.top+this.FLeftTopRect.bottom+this.FPadding,e.right,e.top+this.FLeftTopRect.bottom+this.FPadding),""==this.FLeftTopText&&""==this.FRightTopText?r.drawLineDriect(e.left+this.FLeftTopRect.right+this.FPadding,e.top+this.FLeftTopRect.bottom+this.FPadding,e.left+this.FLeftTopRect.right+this.FPadding,e.bottom):""==this.FLeftBottomText&&""==this.FRightBottomText?r.drawLineDriect(e.left+this.FLeftTopRect.right+this.FPadding,e.top,e.left+this.FLeftTopRect.right+this.FPadding,e.top+this.FLeftTopRect.bottom+this.FPadding+1):r.drawLineDriect(e.left+this.FLeftTopRect.right+this.FPadding,e.top,e.left+this.FLeftTopRect.right+this.FPadding,e.bottom),!a.Print){var l=new nt;if(this.FActiveArea!=Ec){switch(this.FActiveArea){case Mc:l.resetRect(this.FLeftTopRect);break;case Gc:l.resetRect(this.FLeftBottomRect);break;case Lc:l.resetRect(this.FRightTopRect);break;case Hc:l.resetRect(this.FRightBottomRect)}l.offset(e.left,e.top),l.inFlate(2,2),r.pen.color=Ft.Blue,r.rectangleRect(l)}if(this.FMouseMoveArea!=Ec&&this.FMouseMoveArea!=this.FActiveArea){switch(this.FMouseMoveArea){case Mc:l.resetRect(this.FLeftTopRect);break;case Gc:l.resetRect(this.FLeftBottomRect);break;case Lc:l.resetRect(this.FRightTopRect);break;case Hc:l.resetRect(this.FRightBottomRect)}l.offset(e.left,e.top),l.inFlate(2,2),r.pen.color=Ft.LightGray,r.rectangleRect(l)}}}},{key:"SetActive",value:function(t){f()(F()(i.prototype),"SetActive",this).call(this,t),t||(this.FActiveArea=Ec,this.FCaretOffset=-1)}},{key:"FormatToDrawItem",value:function(t,e){var i=t.Style;i.ApplyTempStyle(this.TextStyleNo);var n=i.TextStyles[this.TextStyleNo].FontHeight,o=Math.max(i.TempCanvas.textWidth(this.FLeftTopText),this.FPadding),s=Math.max(i.TempCanvas.textWidth(this.FLeftBottomText),this.FPadding),r=Math.max(i.TempCanvas.textWidth(this.FRightTopText),this.FPadding),a=Math.max(i.TempCanvas.textWidth(this.FRightBottomText),this.FPadding),l=4*this.FPadding;l+=o>s?o:s,l+=r>a?r:a,this.Width=l,this.Height=2*n+4*this.FPadding,o>s?(this.FLeftTopRect.resetBounds(this.FPadding,this.FPadding,o,n),this.FLeftBottomRect.resetBounds(this.FPadding,this.Height-this.FPadding-n,o,n)):(this.FLeftTopRect.resetBounds(this.FPadding,this.FPadding,s,n),this.FLeftBottomRect.resetBounds(this.FPadding,this.Height-this.FPadding-n,s,n)),r>a?(this.FRightTopRect.resetBounds(this.FLeftTopRect.right+this.FPadding+this.FPadding,this.FPadding,r,n),this.FRightBottomRect.resetBounds(this.FLeftTopRect.right+this.FPadding+this.FPadding,this.Height-this.FPadding-n,r,n)):(this.FRightTopRect.resetBounds(this.FLeftTopRect.right+this.FPadding+this.FPadding,this.FPadding,a,n),this.FRightBottomRect.resetBounds(this.FLeftTopRect.right+this.FPadding+this.FPadding,this.Height-this.FPadding-n,a,n)),this.FEmptyLower&&(n=0,""==this.FLeftTopText&&""==this.FRightTopText&&(n=this.FLeftTopRect.height-this.AreaMinSize,this.FLeftTopRect.height=this.AreaMinSize,this.FRightTopRect.height=this.AreaMinSize,this.FLeftBottomRect.offset(0,-n),this.FRightBottomRect.offset(0,-n)),""==this.FLeftBottomText&&""==this.FRightBottomText&&(n=n+this.FLeftBottomRect.height-this.AreaMinSize,this.FLeftBottomRect.height=this.AreaMinSize,this.FRightBottomRect.height=this.AreaMinSize),this.Height=this.Height-n)}},{key:"AcceptAction",value:function(t,e,n){return!(n===rh.DeleteItem&&!this.DeleteAllow)&&f()(F()(i.prototype),"AcceptAction",this).call(this,t,e,n)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.Propertys.assign(t.Propertys),this.DeleteAllow=t.DeleteAllow,this.EditProtect=t.EditProtect,this.AllocValue=t.AllocValue,this.FLeftTopText=t.LeftTopText,this.FLeftBottomText=t.LeftBottomText,this.FRightTopText=t.RightTopText,this.FRightBottomText=t.RightBottomText}},{key:"MouseLeave",value:function(){this.FMouseMoveArea=Ec,f()(F()(i.prototype),"MouseLeave",this).call(this)}},{key:"MouseDown",value:function(t){if(this.EditProtect)return!1;var e=f()(F()(i.prototype),"MouseDown",this).call(this,t);this.FMouseMoveArea!=this.FActiveArea&&(this.FActiveArea=this.FMouseMoveArea,this.OwnerData.Style.UpdateInfoReCaret());var n="",o=-1;switch(this.FActiveArea){case Mc:n=this.FLeftTopText,o=t.x-this.FLeftTopRect.left;break;case Gc:n=this.FLeftBottomText,o=t.x-this.FLeftBottomRect.left;break;case Lc:n=this.FRightTopText,o=t.x-this.FRightTopRect.left;break;case Hc:n=this.FRightBottomText,o=t.x-this.FRightBottomRect.left}var s=0;return this.FActiveArea!=Ec?(this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo),s=Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,n,o)):s=-1,s!=this.FCaretOffset&&(this.FCaretOffset=s,this.OwnerData.Style.UpdateInfoReCaret()),e}},{key:"MouseMove",value:function(t){if(this.EditProtect)return!1;var e=f()(F()(i.prototype),"MouseMove",this).call(this,t);if(this.FOutSelectInto)this.FMouseMoveArea=Ec;else{var n=this.GetToothArea(t.x,t.y);n!=this.FMouseMoveArea&&(this.FMouseMoveArea=n,this.OwnerData.Style.UpdateInfoRePaint())}return e}},{key:"MouseUp",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseUp",this).call(this,t)}},{key:"WantKeyDown",value:function(t){if(this.EditProtect)return!1;var e=!1;return t.keyCode===Je?this.FActiveArea===Mc&&0===this.FCaretOffset?e=!1:this.FActiveArea===Ec?(this.FActiveArea=Hc,this.FCaretOffset=this.FRightBottomText.length,e=!0):e=!0:t.keyCode===Ye?this.FActiveArea===Hc&&this.FCaretOffset===this.FRightBottomText.length?e=!1:this.FActiveArea===Ec?(this.FActiveArea=Mc,this.FCaretOffset=0,e=!0):e=!0:e=!0,e}},{key:"BackDeleteChar",value:function(t){return this.FCaretOffset>0&&(t=L.stringDelete(t,this.FCaretOffset-1,1),this.FCaretOffset--),t}},{key:"BackspaceKeyDown",value:function(){switch(this.FActiveArea){case Mc:this.LeftTopText=this.BackDeleteChar(this.FLeftTopText);break;case Gc:this.LeftBottomText=this.BackDeleteChar(this.FLeftBottomText);break;case Lc:this.RightTopText=this.BackDeleteChar(this.FRightTopText);break;case Hc:this.RightBottomText=this.BackDeleteChar(this.FRightBottomText)}this.FormatDirty()}},{key:"LeftKeyDown",value:function(){if(this.FCaretOffset>0)this.FCaretOffset--;else if(this.FActiveArea>Mc){var t=this.FActiveArea-1;if(this.FActiveArea!=t){switch(this.FActiveArea=t,this.FActiveArea){case Mc:this.FCaretOffset=this.FLeftTopText.length;break;case Gc:this.FCaretOffset=this.FLeftBottomText.length;break;case Lc:this.FCaretOffset=this.FRightTopText.length;break;case Hc:this.FCaretOffset=this.FRightBottomText.length}this.OwnerData.Style.UpdateInfoRePaint()}}}},{key:"RightKeyDown",value:function(){var t="";switch(this.FActiveArea){case Mc:t=this.FLeftTopText;break;case Gc:t=this.FLeftBottomText;break;case Lc:t=this.FRightTopText;break;case Hc:t=this.FRightBottomText}if(this.FCaretOffset<t.length)this.FCaretOffset++;else if(this.FActiveArea<Hc){var e=this.FActiveArea+1;this.FActiveArea!=e&&(this.FActiveArea=e,this.FCaretOffset=0,this.OwnerData.Style.UpdateInfoRePaint())}}},{key:"UpKeyDown",value:function(){this.FActiveArea==Gc?(this.FActiveArea=Mc,this.FCaretOffset=0,this.OwnerData.Style.UpdateInfoRePaint()):this.FActiveArea==Hc&&(this.FActiveArea=Lc,this.FCaretOffset=0,this.OwnerData.Style.UpdateInfoRePaint())}},{key:"DownKeyDown",value:function(){this.FActiveArea==Mc?(this.FActiveArea=Gc,this.FCaretOffset=0,this.OwnerData.Style.UpdateInfoRePaint()):this.FActiveArea==Lc&&(this.FActiveArea=Hc,this.FCaretOffset=0,this.OwnerData.Style.UpdateInfoRePaint())}},{key:"DeleteChar",value:function(t){return this.FCaretOffset<t.length&&(t=L.stringDelete(t,this.FCaretOffset+1-1,1)),t}},{key:"DeleteKeyDown",value:function(){switch(this.FActiveArea){case Mc:this.LeftTopText=this.DeleteChar(this.FLeftTopText);break;case Gc:this.LeftBottomText=this.DeleteChar(this.FLeftBottomText);break;case Lc:this.RightTopText=this.DeleteChar(this.FRightTopText);break;case Hc:this.RightBottomText=this.DeleteChar(this.FRightBottomText)}this.FormatDirty()}},{key:"HomeKeyDown",value:function(){this.FCaretOffset=0}},{key:"EndKeyDown",value:function(){var t="";switch(this.FActiveArea){case Mc:t=this.FLeftTopText;break;case Gc:t=this.FLeftBottomText;break;case Lc:t=this.FRightTopText;break;case Hc:t=this.RightBottomText}this.FCaretOffset=t.length}},{key:"KeyDown",value:function(t){if(!this.EditProtect)switch(t.keyCode){case Ee:this.BackspaceKeyDown();break;case Je:this.LeftKeyDown();break;case Ye:this.RightKeyDown();break;case je:this.UpKeyDown();break;case Qe:this.DownKeyDown();break;case Xe:this.DeleteKeyDown();break;case Ke:this.HomeKeyDown();break;case ze:this.EndKeyDown()}}},{key:"KeyPress",value:function(t){this.EditProtect||(this.FActiveArea!==Ec?this.InsertText(String.fromCharCode(t.keyCode)):t.keyCode=0)}},{key:"InsertText",value:function(t){if(this.EditProtect)return!1;if(this.FActiveArea!=Ec){switch(this.FActiveArea){case Mc:this.LeftTopText=L.stringInsert(this.FLeftTopText,this.FCaretOffset+1-1,t);break;case Gc:this.LeftBottomText=L.stringInsert(this.FLeftBottomText,this.FCaretOffset+1-1,t);break;case Lc:this.RightTopText=L.stringInsert(this.FRightTopText,this.FCaretOffset+1-1,t);break;case Hc:this.RightBottomText=L.stringInsert(this.FRightBottomText,this.FCaretOffset+1-1,t)}return this.FCaretOffset+=t.length,this.FormatDirty(),!0}return!1}},{key:"GetCaretInfo",value:function(t){if(this.FActiveArea!=Ec)switch(this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo),this.FActiveArea){case Mc:t.Height=this.FLeftTopRect.bottom-this.FLeftTopRect.top,""!=this.FLeftTopText?t.X=this.FLeftTopRect.left+this.OwnerData.Style.TempCanvas.textWidth(this.FLeftTopText.substr(0,this.FCaretOffset)):t.X=this.FLeftTopRect.left,t.Y=this.FLeftTopRect.top;break;case Gc:t.Height=this.FLeftBottomRect.bottom-this.FLeftBottomRect.top,""!=this.FLeftBottomText?t.X=this.FLeftBottomRect.left+this.OwnerData.Style.TempCanvas.textWidth(this.FLeftBottomText.substr(0,this.FCaretOffset)):t.X=this.FLeftBottomRect.left,t.Y=this.FLeftBottomRect.top;break;case Lc:t.Height=this.FRightTopRect.bottom-this.FRightTopRect.top,""!=this.FRightTopText?t.X=this.FRightTopRect.left+this.OwnerData.Style.TempCanvas.textWidth(this.FRightTopText.substr(0,this.FCaretOffset)):t.X=this.FRightTopRect.left,t.Y=this.FRightTopRect.top;break;case Hc:t.Height=this.FRightBottomRect.bottom-this.FRightBottomRect.top,""!=this.FRightBottomText?t.X=this.FRightBottomRect.left+this.OwnerData.Style.TempCanvas.textWidth(this.FRightBottomText.substr(0,this.FCaretOffset)):t.X=this.FRightBottomRect.left,t.Y=this.FRightBottomRect.top}else t.Visible=!1}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.FLeftTopText),Yl.HCSaveTextToStream(t,this.FLeftBottomText),Yl.HCSaveTextToStream(t,this.FRightTopText),Yl.HCSaveTextToStream(t,this.FRightBottomText),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator));var o=0;this.EditProtect&&(o|=128),this.DeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o)}},{key:"LoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FLeftTopText=Yl.HCLoadTextFromStream(t,n),this.FLeftBottomText=Yl.HCLoadTextFromStream(t,n),this.FRightTopText=Yl.HCLoadTextFromStream(t,n),this.FRightBottomText=Yl.HCLoadTextFromStream(t,n),this.FVersion>0){var o=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(o,this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(o,this.Propertys);var s=t.readByte();this.EditProtect=L.isOdd(s>>7),this.DeleteAllow=L.isOdd(s>>6),this.AllocValue=L.isOdd(s>>4)}else this.EditProtect=!1,this.DeleteAllow=!0,this.AllocValue=!1}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t),null!=t.LeftTopText&&(this.FLeftTopText=t.LeftTopText),null!=t.LeftBottomText&&(this.FLeftBottomText=t.LeftBottomText),null!=t.RightTopText&&(this.FRightTopText=t.RightTopText),null!=t.RightBottomText&&(this.FRightBottomText=t.RightBottomText)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"LeftTopText":"'+this.LeftTopText+'","LeftBottomText":"'+this.LeftBottomText+'","RightTopText":"'+this.RightTopText+'","RightBottomText":"'+this.RightBottomText+'"'}},{key:"LeftTopText",get:function(){return this.FLeftTopText},set:function(t){this.FLeftTopText=t,this.DoChange()}},{key:"LeftBottomText",get:function(){return this.FLeftBottomText},set:function(t){this.FLeftBottomText=t,this.DoChange()}},{key:"RightTopText",get:function(){return this.FRightTopText},set:function(t){this.FRightTopText=t,this.DoChange()}},{key:"RightBottomText",get:function(){return this.FRightBottomText},set:function(t){this.FRightBottomText=t,this.DoChange()}}]),i}(hs);function Uc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Wc=l()((function t(){r()(this,t),this.tag=0,this.position=0,this.height=0})),zc=function(t){m()(i,t);var e=Uc(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).rightBlank_=40,n.FAreaMarks=new ot,n.OnPageUpClick=null,n.OnPageDownClick=null,n}return l()(i,[{key:"_getAreaMarkByTag",value:function(t){for(var e=-1,i=0;i<this.FAreaMarks.count;i++)if(this.FAreaMarks[i].tag==t){e=i;break}return e}},{key:"_getAreaMarkRect",value:function(t){var e=new nt;if(this.orientation==ee){var i=this.leftBlank_+this.buttonSize+L.Round(this.FAreaMarks[t].position*this.precent_),n=L.Round(this.FAreaMarks[t].height*this.precent_);n<2&&(n=2),e.resetBounds(0,i,this.width,n)}return e}},{key:"doDrawThumBefor_",value:function(t,e){if(this.orientation==ee&&this.FAreaMarks.count>0){var i;t.brush.color="rgb(82, 89, 107)";for(var n=0;n<this.FAreaMarks.count;n++)(i=this._getAreaMarkRect(n)).bottom>this.leftBlank_+this.buttonSize&&i.top<this.height-this.rightBlank_-this.buttonSize&&t.fillRect(i)}}},{key:"doMouseDown_",value:function(t){if(f()(F()(i.prototype),"doMouseDown_",this).call(this,t),!this.thumRect_.pointIn(this.mouseDownPt_)&&this.orientation==ee&&this.FAreaMarks.count>0)for(var e,n=0;n<this.FAreaMarks.count;n++)if((e=this._getAreaMarkRect(n)).pointIn(this.mouseDownPt_)){this.position=this.FAreaMarks[n].position-e.top;break}}},{key:"doMouseUp_",value:function(t){f()(F()(i.prototype),"doMouseUp_",this).call(this,t),this.orientation==ee&&(nt.CreateByBounds(2,this.height-this.rightBlank_+2,16,16).pointInAt(t.x,t.y)?null!=this.OnPageUpClick&&this.OnPageUpClick(this):nt.CreateByBounds(2,this.height-this.rightBlank_+2+16+2,16,16).pointInAt(t.x,t.y)&&null!=this.OnPageDownClick&&this.OnPageDownClick(this))}},{key:"paintToEx",value:function(t){if(f()(F()(i.prototype),"paintToEx",this).call(this,t),this.orientation==ee&&this.rightBlank_>0){t.brush.color="#52596b",t.fillRect(nt.Create(2,this.height-this.rightBlank_+2,this.width-2,this.height-2)),t.pen.color="#aaabb3";var e=Math.trunc((this.width-5)/2),n=this.height-this.rightBlank_+2+this.buttonSize-9;t.beginPath(),t.drawLine(e,n,e+5,n),t.drawLine(e+1,n-1,e+4,n-1),t.drawLine(e+2,n-2,e+3,n-2),n-=3,t.drawLine(e,n,e+5,n),t.drawLine(e+1,n-1,e+4,n-1),t.drawLine(e+2,n-2,e+3,n-2),n=this.height-this.rightBlank_+2+this.buttonSize+2+3,t.drawLine(e,n,e+5,n),t.drawLine(e+1,n+1,e+4,n+1),t.drawLine(e+2,n+2,e+3,n+2),n+=3,t.drawLine(e,n,e+5,n),t.drawLine(e+1,n+1,e+4,n+1),t.drawLine(e+2,n+2,e+3,n+2),t.paintPath()}}},{key:"SetAreaPos",value:function(t,e,i){null==this.FAreaMarks&&(this.FAreaMarks=new ot);var n=this._getAreaMarkByTag(t);if(n<0){var o=new Wc;o.tag=t,o.position=e,o.height=i,this.FAreaMarks.add(o);var s=this._getAreaMarkRect(this.FAreaMarks.count-1);this.updateRect(s)}else if(this.FAreaMarks[n].position!=e||this.FAreaMarks[n].height!=i){var r=this._getAreaMarkRect(n);this.FAreaMarks[n].position=e,this.FAreaMarks[n].height=i,this.updateRect(r),r=this._getAreaMarkRect(n),this.updateRect(r)}}}]),i}(Di);function Kc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Jc=function(){function t(){r()(this,t),this.FSize=hh.A4,this.FWidth=0,this.FHeight=0,this.FWidthPix=0,this.FHeightPix=0,this.FMarginTop=0,this.FMarginLeft=0,this.FMarginRight=0,this.FMarginBottom=0,this.FMarginTopPix=0,this.FMarginLeftPix=0,this.FMarginRightPix=0,this.FMarginBottomPix=0,this.MarginLeft=25,this.MarginTop=25,this.MarginRight=20,this.MarginBottom=20,this.setSize_(hh.A4),this.setWidth_(210),this.setHeight_(297)}return l()(t,[{key:"setSize_",value:function(t){this.FSize!=t&&(this.FSize=t)}},{key:"setWidth_",value:function(t){this.FWidth=t,this.FWidthPix=En.millimeterToPixX(this.FWidth)}},{key:"setHeight_",value:function(t){this.FHeight=t,this.FHeightPix=En.millimeterToPixY(this.FHeight)}},{key:"setMarginTop_",value:function(t){this.FMarginTop=t,this.FMarginTopPix=En.millimeterToPixY(this.FMarginTop)}},{key:"setMarginLeft_",value:function(t){this.FMarginLeft=t,this.FMarginLeftPix=En.millimeterToPixX(this.FMarginLeft)}},{key:"setMarginRight_",value:function(t){this.FMarginRight=t,this.FMarginRightPix=En.millimeterToPixX(this.FMarginRight)}},{key:"setMarginBottom_",value:function(t){this.FMarginBottom=t,this.FMarginBottomPix=En.millimeterToPixY(this.FMarginBottom)}},{key:"Assign",value:function(t){this.Size=t.Size,this.Width=t.Width,this.Height=t.Height,this.MarginTop=t.MarginTop,this.MarginLeft=t.MarginLeft,this.MarginRight=t.MarginRight,this.MarginBottom=t.MarginBottom}},{key:"SaveToStream",value:function(t){var e=t.position;t.writeUInt64(e),t.writeInt32(this.FSize),t.writeSingle(this.FWidth),t.writeSingle(this.FHeight),t.writeSingle(this.FMarginLeft),t.writeSingle(this.FMarginTop),t.writeSingle(this.FMarginRight),t.writeSingle(this.FMarginBottom);var i=t.position;t.position=e,e=i-e-8,t.writeUInt64(e),t.position=i}},{key:"LoadFromStream",value:function(t,e){t.readInt64(),this.Size=t.readInt32(),this.Width=t.readSingle(),this.Height=t.readSingle(),this.MarginLeft=t.readSingle(),this.MarginTop=t.readSingle(),this.MarginRight=t.readSingle(),this.MarginBottom=t.readSingle()}},{key:"GetPageWidthPix",value:function(){return this.FWidthPix-this.FMarginLeftPix-this.FMarginRightPix}},{key:"Size",get:function(){return this.FSize},set:function(t){this.setSize_(t)}},{key:"Width",get:function(){return this.FWidth},set:function(t){this.setWidth_(t)}},{key:"Height",get:function(){return this.FHeight},set:function(t){this.setHeight_(t)}},{key:"MarginTop",get:function(){return this.FMarginTop},set:function(t){this.setMarginTop_(t)}},{key:"MarginLeft",get:function(){return this.FMarginLeft},set:function(t){this.setMarginLeft_(t)}},{key:"MarginRight",get:function(){return this.FMarginRight},set:function(t){this.setMarginRight_(t)}},{key:"MarginBottom",get:function(){return this.FMarginBottom},set:function(t){this.setMarginBottom_(t)}},{key:"WidthPix",get:function(){return this.FWidthPix}},{key:"HeightPix",get:function(){return this.FHeightPix}},{key:"MarginTopPix",get:function(){return this.FMarginTopPix}},{key:"MarginLeftPix",get:function(){return this.FMarginLeftPix}},{key:"MarginRightPix",get:function(){return this.FMarginRightPix}},{key:"MarginBottomPix",get:function(){return this.FMarginBottomPix}}]),t}(),jc=function(){function t(){r()(this,t),this.FilmLeft=0,this.FilmTop=0,this.Clear()}return l()(t,[{key:"Assign",value:function(t){this.FStartDrawItemNo=t.StartDrawItemNo,this.FEndDrawItemNo=t.EndDrawItemNo}},{key:"Clear",value:function(){this.FStartDrawItemNo=0,this.FEndDrawItemNo=0}},{key:"StartDrawItemNo",get:function(){return this.FStartDrawItemNo},set:function(t){this.FStartDrawItemNo=t}},{key:"EndDrawItemNo",get:function(){return this.FEndDrawItemNo},set:function(t){this.FEndDrawItemNo=t}}]),t}(),Yc=function(t){m()(i,t);var e=Kc(i);function i(){return r()(this,i),e.call(this)}return l()(i,[{key:"ClearEx",value:function(){this.removeRange(1,this.count-1),this[0].Clear()}}]),i}(ot);function Qc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Xc=function(t){m()(i,t);var e=Qc(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FFloatItems=new Dl,o.FFloatItems.OnInsertItem=function(t){o.DoInsertFloatItem(t)},o.FFloatItemIndex=-1,o.FMouseDownIndex=-1,o.FMouseMoveIndex=-1,o.OnReadOnlySwitch=null,o.OnFloatItemPaintAfter=null,o}return l()(i,[{key:"GetFloatItemAt",value:function(t,e){for(var i=-1,n=null,o=0;o<=this.FFloatItems.count-1;o++)if((n=this.FFloatItems[o]).PointInClient(t-n.Left,e-n.Top)){i=o;break}return i}},{key:"DoInsertFloatItem",value:function(t){this.DoInsertItem(t)}},{key:"SetReadOnly",value:function(t){this.ReadOnly!=t&&(f()(F()(i.prototype),"SetReadOnly",this).call(this,t),null!=this.OnReadOnlySwitch&&this.OnReadOnlySwitch(this,null))}},{key:"DoLoadFromStream",value:function(t,e,n){if(n>42&&t.readInt64(),f()(F()(i.prototype),"DoLoadFromStream",this).call(this,t,e,n),n>12)for(var o=t.readInt32();o>0;){var s=null,r=oo.Null;r=t.readInt32(),(s=n<28&&r==Pr?new kl(this.hcl,this):this.CreateItemByStyle(r)).LoadFromStream(t,e,n),this.FFloatItems.add(s),o--}}},{key:"UndoAction_FloatItemMirror",value:function(t){}},{key:"DoFloatItemPaintAfter",value:function(t,e,i){if(null!==this.OnFloatItemPaintAfter){e.save();try{this.OnFloatItemPaintAfter(this,t,e,i)}finally{e.restore()}}}},{key:"MouseDownFloatItem",value:function(t){var e=!1;this.FMouseDownIndex=this.GetFloatItemAt(t.x,t.y);var i=this.FFloatItemIndex;if(this.FFloatItemIndex!=this.FMouseDownIndex&&(this.FFloatItemIndex>=0&&(this.FFloatItems[this.FFloatItemIndex].Active=!1),this.FFloatItemIndex=this.FMouseDownIndex,this.Style.UpdateInfoRePaint(),this.Style.UpdateInfoReCaret()),this.FFloatItemIndex>=0){if(this.ReadOnly)return!0;if(2==t.clicks)return this.FFloatItems[this.FFloatItemIndex].DblClick(t.x-this.FFloatItems[this.FFloatItemIndex].Left,t.y-this.FFloatItems[this.FFloatItemIndex].Top),!0;var n=new fi;n.assign(t),n.x=t.x-this.FFloatItems[this.FFloatItemIndex].Left,n.y=t.y-this.FFloatItems[this.FFloatItemIndex].Top,e=this.FFloatItems[this.FFloatItemIndex].MouseDown(n)}return this.FMouseDownIndex<0&&i<0&&(e=!1),e}},{key:"MouseMoveFloatItem",value:function(t){var e=!1;if(t.button!=ae||this.hcl.keyDownStates[Ge]){var i=this.GetFloatItemAt(t.x,t.y);if(this.FMouseMoveIndex!=i&&(this.FMouseMoveIndex>=0&&this.FFloatItems[this.FMouseMoveIndex].MouseLeave(),this.FMouseMoveIndex=i,this.FMouseMoveIndex>=0&&this.FFloatItems[this.FMouseMoveIndex].MouseEnter()),i>=0){var n=this.FFloatItems[i],o=new fi;o.assign(t),o.x=t.x-n.Left,o.y=t.y-n.Top,e=n.MouseMove(o)}}else{if(this.ReadOnly)return e;if(this.FMouseDownIndex>=0){var s=this.FFloatItems[this.FMouseDownIndex],r=new fi;r.assign(t),r.x=t.x-s.Left,r.y=t.y-s.Top,(e=s.MouseMove(r))&&this.Style.UpdateInfoRePaint()}}return e}},{key:"MouseUpFloatItem",value:function(t){var e=!1;if(this.FMouseDownIndex>=0){if(this.ReadOnly)return!0;this.Undo_New(),this.UndoAction_FloatItemMirror(this.FMouseDownIndex);var i=this.FFloatItems[this.FMouseDownIndex],n=new fi;n.assign(t),n.x=t.x-i.Left,n.y=t.y-i.Top,(e=i.MouseUp(n))&&this.Style.UpdateInfoRePaint()}return e}},{key:"KeyDownFloatItem",value:function(t){if(this.ReadOnly)return!0;var e=!0;if(this.FFloatItemIndex>=0&&!this.FFloatItems[this.FFloatItemIndex].Lock)switch(t.keyCode){case Ee:case Xe:this.FFloatItems[this.FFloatItemIndex].AcceptAction(Yl.OffsetInner,!1,rh.DeleteItem)?(this.FFloatItems.delete(this.FFloatItemIndex),this.FFloatItemIndex=-1,this.FMouseMoveIndex=-1,this.FMouseDownIndex=-1):e=!1;break;case Je:this.FFloatItems[this.FFloatItemIndex].Left-=1;break;case Ye:this.FFloatItems[this.FFloatItemIndex].Left+=1;break;case je:this.FFloatItems[this.FFloatItemIndex].Left-=1;break;case Qe:this.FFloatItems[this.FFloatItemIndex].Left+=1;break;default:e=!1}else e=!1;return e&&this.Style.UpdateInfoRePaint(),e}},{key:"Clear",value:function(){this.FFloatItems.clear(),f()(F()(i.prototype),"Clear",this).call(this)}},{key:"GetCaretInfo",value:function(t,e,n){this.FFloatItemIndex>=0?n.Visible=!1:f()(F()(i.prototype),"GetCaretInfo",this).call(this,t,e,n)}},{key:"TraverseFloatItem",value:function(t){if(null!=t)for(var e=0;e<this.FFloatItems.count;e++){if(t.Stop)return;t.Process(this,e,t.Tag,t.DomainStack,t.Stop)}}},{key:"GetActiveItemNo",value:function(){return this.FFloatItemIndex<0?f()(F()(i.prototype),"GetActiveItemNo",this).call(this):-1}},{key:"GetActiveItem",value:function(){return this.FFloatItemIndex<0?f()(F()(i.prototype),"GetActiveItem",this).call(this):null}},{key:"GetActiveFloatItem",value:function(){return this.FFloatItemIndex<0?null:this.FFloatItems[this.FFloatItemIndex]}},{key:"InsertFloatItem",value:function(t){var e=this.SelectInfo.StartItemNo,i=this.SelectInfo.StartItemOffset,n=this.GetDrawItemNoByOffset(e,i);return t.Left=this.DrawItems[n].rect.left+this.GetDrawItemOffsetWidth(n,this.SelectInfo.StartItemOffset-this.DrawItems[n].CharOffs+1),t.Top=this.DrawItems[n].rect.top,this.FloatItems.add(t),this.FFloatItemIndex=this.FloatItems.count-1,t.Active=!0,this.DisSelect()||this.Style.UpdateInfoRePaint(),!0}},{key:"MarkStyleUsed",value:function(t){for(var e=null,n=0;n<this.FFloatItems.count-1;n++)e=this.FFloatItems[n],t?(this.Style.ParaStyles[e.ParaNo].CheckSaveUsed=!0,e.StyleNo<oo.Null?e.MarkStyleUsed(t):this.Style.TextStyles[e.StyleNo].CheckSaveUsed=!0):(e.ParaNo=this.Style.ParaStyles[e.ParaNo].TempNo,e.StyleNo<oo.Null?e.MarkStyleUsed(t):e.StyleNo=Style.TextStyles[e.StyleNo].TempNo);f()(F()(i.prototype),"MarkStyleUsed",this).call(this,t)}},{key:"SaveToStream",value:function(t){var e=t.position;t.writeUInt64(e),f()(F()(i.prototype),"SaveToStream",this).call(this,t),t.writeInt32(this.FFloatItems.count);for(var n=0;n<=this.FFloatItems.count-1;n++)this.FFloatItems[n].SaveToStream(t);var o=t.position;t.position=e,e=o-e-8,t.writeUInt64(e),t.position=o}},{key:"ApplyTextFontSize",value:function(t){if(this.FFloatItemIndex>=0){var e=new ks(this.hcl);e.FontSize=t,this.FFloatItems[this.FFloatItemIndex].ApplySelectTextStyle(this.Style,e)}else f()(F()(i.prototype),"ApplyTextFontSize",this).call(this,t)}},{key:"PaintFloatItems",value:function(t,e,i,n,o,s){for(var r=null,a=0;a<this.FFloatItems.count;a++)(r=this.FFloatItems[a]).DrawRect.resetBounds(r.Left,r.Top,r.Width,r.Height),r.DrawRect.offset(e,i-n),r.PaintTo(this.Style,r.DrawRect,i,0,0,0,o,s),this.DoFloatItemPaintAfter(r,o,s)}},{key:"FloatItemIndex",get:function(){return this.FFloatItemIndex}},{key:"ActiveFloatItem",get:function(){return this.GetActiveFloatItem()}},{key:"FloatItems",get:function(){return this.FFloatItems}}]),i}(zl),Zc=function(t){m()(i,t);var e=Qc(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).SectionArea=ql.Header,o}return l()(i)}(Xc),qc=function(t){m()(i,t);var e=Qc(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).SectionArea=ql.Footer,o}return l()(i)}(Xc),$c=function(t){m()(i,t);var e=Qc(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).SectionArea=ql.Page,o.FShowLineActiveMark=!1,o.FShowUnderLine=!1,o.FShowLineNo=!1,o.ShowBorder=!1,o.LineColor=Ft.Black,o.LineStyle=_t.Solid,o}return l()(i,[{key:"InitializeMouseField",value:function(){this.FFloatItemIndex=-1,this.FMouseDownIndex=-1,this.FMouseMoveIndex=-1,f()(F()(i.prototype),"InitializeMouseField",this).call(this)}},{key:"DoLoadFromStream",value:function(t,e,n){if(n>63){var o=t.readByte();this.FShowUnderLine=L.isOdd(o>>7),this.ShowBorder=L.isOdd(o>>6),this.LineStyle=t.readByte(),this.LineColor=Yl.HCLoadColorFromStream(t)}else this.FShowUnderLine=t.readBoolean(),this.ShowBorder=!1,this.LineStyle=_t.Solid,this.LineColor=Ft.Black;f()(F()(i.prototype),"DoLoadFromStream",this).call(this,t,e,n)}},{key:"PaintDataAfter",value:function(t,e,i,n,o,s,r,a,l,h,c,u,f){var d=0;if(!f.Print){if(this.FShowLineActiveMark){var m=this.GetSelectStartDrawItemNo();if(m>=a&&m<=l&&(d=e+this.DrawItems[m].rect.top-r+Math.trunc(this.DrawItems[m].height/2))+6>=0&&d<=s){u.pen.color="blue",u.pen.style=_t.Solid,u.beginPath();try{u.moveTo(t-10,d),u.lineTo(t-11,d),u.moveTo(t-11,d-1),u.lineTo(t-11,d+2),u.moveTo(t-12,d-2),u.lineTo(t-12,d+3),u.moveTo(t-13,d-3),u.lineTo(t-13,d+4),u.moveTo(t-14,d-4),u.lineTo(t-14,d+5),u.moveTo(t-15,d-2),u.lineTo(t-15,d+3),u.moveTo(t-16,d-2),u.lineTo(t-16,d+3)}finally{u.paintPath()}}}if(this.FShowLineNo){for(var S=0,p=0;p<=a;p++)this.DrawItems[p].LineFirst&&S++;u.font.size=10,u.font.name="Courier New",u.font.color="rgb(180, 180, 180)";for(var y=a;y<=l;y++)this.DrawItems[y].LineFirst&&((d=e+this.DrawItems[y].rect.top-r+Math.trunc((this.DrawItems[y].height-16)/2))+16>=0&&d<=s&&u.textOut(t-50,d,S.toString()),S++)}}if(this.ShowBorder&&(u.pen.color=this.LineColor,u.pen.style=this.LineStyle,u.beginPath(),u.moveTo(t,e),u.lineTo(i,e),u.lineTo(i,n),u.lineTo(t,n),u.lineTo(t,e),u.paintPath()),this.FShowUnderLine){u.pen.color=this.LineColor,u.pen.style=this.LineStyle,u.beginPath();for(var F=e-r,v=a;v<=l;v++)this.DrawItems[v].LineFirst&&(d=this.DrawItems[v].rect.top+F)>=0&&d<=s&&(u.moveTo(t,d),u.lineTo(t+this.Width,d));if((d=this.DrawItems[l].rect.bottom+F)>=0&&d<=s&&(u.moveTo(t,d),u.lineTo(t+this.Width,d)),h===c-1){var I=n-e-(this.DrawItems[l].rect.bottom-r),g=this.CalculateLineHeight(this.Style.DefaultTextStyle,this.Style.ParaStyles[this.Items.last.ParaNo]);if(I>=g)for(d=e+this.DrawItems[l].rect.bottom-r;d<=s;)d+=g,u.moveTo(t,d),u.lineTo(t+this.Width,d)}u.paintPath()}}},{key:"MouseDown",value:function(t){if(this.FShowLineActiveMark){var e=this.MouseDownItemNo,n=this.MouseDownItemOffset;f()(F()(i.prototype),"MouseDown",this).call(this,t),e==this.MouseDownItemNo&&n==this.MouseDownItemOffset||this.Style.UpdateInfoRePaint()}else f()(F()(i.prototype),"MouseDown",this).call(this,t)}},{key:"SaveToStream",value:function(t){var e=0;this.FShowUnderLine&&(e|=128),this.ShowBorder&&(e|=64),t.writeByte(e),t.writeByte(this.LineStyle),Yl.HCSaveColorToStream(this.hcl,t,this.LineColor),f()(F()(i.prototype),"SaveToStream",this).call(this,t)}},{key:"InsertStream",value:function(t,e,n){return f()(F()(i.prototype),"InsertStream",this).call(this,t,e,n)}},{key:"PaintFloatItems",value:function(t,e,i,n,o,s){for(var r=null,a=0;a<this.FloatItems.count;a++)(r=this.FloatItems[a]).PageIndex==t&&(r.DrawRect.resetBounds(r.Left+e,r.Top+i-n,r.Width,r.Height),r.PaintTo(this.Style,r.DrawRect,i,0,0,0,o,s),this.DoFloatItemPaintAfter(r,o,s))}},{key:"InsertPageBreak",value:function(){if(this.SelectExists())return!1;if(this.Items[this.SelectInfo.StartItemNo].StyleNo<oo.Null&&this.SelectInfo.StartItemOffset==Yl.OffsetInner)return!1;var t=new di;return t.keyCode=Le,this.KeyDown(t,!0),!0}},{key:"ShowLineActiveMark",get:function(){return this.FShowLineActiveMark},set:function(t){this.FShowLineActiveMark=t}},{key:"ShowLineNo",get:function(){return this.FShowLineNo},set:function(t){this.FShowLineNo=t}},{key:"ShowUnderLine",get:function(){return this.FShowUnderLine},set:function(t){this.FShowUnderLine=t}}]),i}(Xc);function tu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var eu=function(t){m()(i,t);var e=tu(i);function i(){var t;return r()(this,i),(t=e.call(this)).SectionIndex=-1,t.PageIndex=-1,t.pageDataFmtTop=0,t}return l()(i)}(go),iu=function(t){m()(i,t);var e=tu(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).FPropertys=new rt,o}return l()(i,[{key:"DoSaveToStream",value:function(t){f()(F()(i.prototype),"DoSaveToStream",this).call(this,t),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"DoLoadFromStream",value:function(t,e){f()(F()(i.prototype),"DoLoadFromStream",this).call(this,t,e);var n=Yl.HCLoadTextFromStream(t,e);e>64?Yl.SetPropertyString(n,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(n,this.FPropertys)}},{key:"AssignPaper",value:function(t){this.PaperSize=t.PaperSize,this.PaperWidth=t.PaperWidth,this.PaperHeight=t.PaperHeight,this.PaperMarginTop=t.PaperMarginTop,this.PaperMarginLeft=t.PaperMarginLeft,this.PaperMarginRight=t.PaperMarginRight,this.PaperMarginBottom=t.PaperMarginBottom,this.PaperOrientation=t.PaperOrientation,this.HeaderOffset=t.HeaderOffset,this.ResetMargin()}},{key:"Search",value:function(t,e,i){var n=this.ActiveData.Search(t,e,i);return this.DoActiveDataCheckUpdateInfo(),n}},{key:"Replace",value:function(t){var e=this;return this.DoSectionDataAction(this.ActiveData,(function(){return e.ActiveData.Replace(t)}))}},{key:"ParseHtml",value:function(t){return this.DoSectionDataAction(this.ActiveData,(function(){return!0})),!0}},{key:"InsertFloatItem",value:function(t){if(!this.ActiveData.CanEdit())return!1;t.PageIndex=this.ActivePageIndex;var e=this.ActiveData.InsertFloatItem(t);return this.DoDataChanged(this),e}},{key:"SeekStreamToArea",value:function(t,e,i,n,o){var s=t.readInt64();(i>41&&Yl.HCLoadTextFromStream(t,i),t.readBoolean(),i>11&&(t.readByte(),t.readBoolean()),i>45&&(t.readInt32(),Yl.HCLoadTextFromStream(t,i)),o)?this.FPaper.LoadFromStream(t,i):(new Jc).LoadFromStream(t,i);var r=new Set([]);if(t.readBoolean()&&r.add(ql.Header),t.readBoolean()&&r.add(ql.Footer),t.readBoolean()&&r.add(ql.Page),r.has(ql.Header)){if(t.readInt32(),n===ql.Header)return!0;s=t.readInt64(),t.position+=s}return n===ql.Header||(n===ql.Footer||(r.has(ql.Footer)&&(s=t.readInt64(),t.position+=s),n===ql.Page&&(i>63?(t.readByte(),t.readByte(),t.readByte(),t.readByte(),t.readByte(),t.readByte(),t.readInt64(),t.readByte()):(t.readBoolean(),t.readInt64()),!0)))}},{key:"ToHtml",value:function(){return'<div style="margin:0 auto; width:'+this.FPaper.WidthPix+"px; background-color:"+Yl.HCColorToHtml(this.hcl,this.FStyle.BackgroundColor)+'"><div style="position: relative;left:'+this.FPaper.MarginLeftPix+"px;width:"+this.FPaper.GetPageWidthPix()+'px;">'+this.Header.ToHtml()+this.Page.ToHtml()+this.Footer.ToHtml()+"</div></div>"}},{key:"ToXml",value:function(t){t.SetAttribute("symmargin",this.FSymmetryMargin.toString()),t.SetAttribute("ori",this.FPaperOrientation.toString()),t.SetAttribute("pagenovisible",this.FPageNoVisible.toString()),t.SetAttribute("pagenofrom",this.FPageNoFrom.toString()),t.SetAttribute("pagenoformat",this.FPageNoFormat),t.SetAttribute("pagesize",this.PaperSize.toString()+","+L.stringFormatFloat(1,this.PaperWidth)+","+L.stringFormatFloat(1,this.PaperHeight)),t.SetAttribute("margin",L.stringFormatFloat(1,this.PaperMarginLeft)+","+L.stringFormatFloat(1,this.PaperMarginTop)+","+L.stringFormatFloat(1,this.PaperMarginRight)+","+L.stringFormatFloat(1,this.PaperMarginBottom)),t.SetAttribute("property",Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator));var e=jn.Create("header");e.SetAttribute("offset",this.HeaderOffset.toString()),this.Header.ToXml(e),t.AppendChild(e),e=jn.Create("footer"),this.Footer.ToXml(e),t.AppendChild(e),e=jn.Create("page"),this.Page.ToXml(e),t.AppendChild(e)}},{key:"Propertys",get:function(){return this.FPropertys}}]),i}(function(t){m()(i,t);var e=tu(i);function i(t,n){var o;r()(this,i),(o=e.call(this,t)).FStyle=n,o.FPaper=new Jc,o.FPaperOrientation=Ql.Portrait,o.FViewModel=fo.Film,o.FMoveData=null,o.FPageNoVisible=!0,o.FPageNoFormat="{0}/{1}",o.FPagePadding=20,o.FLineCount=0,o.FPageNoFrom=1,o.FActivePageIndex=0,o.FMousePageIndex=0,o.FDisplayFirstPageIndex=-1,o.FDisplayLastPageIndex=-1,o.FHeaderOffset=20,o.PageNoOffset=0,o.PageNoHorAlign=as.Center,o.FHeaderVerAlign=ls.Center;var s=o.GetPageWidth();return o.FPage=new $c(t,n),o.FPage.Width=s,o.SetDataEvent(o.FPage),o.FHeader=new Zc(t,n),o.FHeader.Width=s,o.SetDataEvent(o.FHeader),o.FFooter=new qc(t,n),o.FFooter.Width=s,o.SetDataEvent(o.FFooter),o.FActiveArea=ql.Page,o.FActiveData=o.FPage,o.FSymmetryMargin=!0,o.FPages=new Yc,o.NewEmptyPage(),o.FPages[0].StartDrawItemNo=0,o.FPages[0].EndDrawItemNo=0,o.OnDataChange=null,o.OnDataSetChange=null,o.OnCheckUpdateInfo=null,o.OnReadOnlySwitch=null,o.OnChangeTopLevelData=null,o.OnGetScreenCoord=null,o.OnCheckInsertItemCount=null,o.OnPaintHeaderBefor=null,o.OnPaintHeaderAfter=null,o.OnPaintFooterBefor=null,o.OnPaintFooterAfter=null,o.OnPaintPageBefor=null,o.OnPaintPageAfter=null,o.OnPaintPaperBefor=null,o.OnPaintPaperAfter=null,o.OnDrawItemPaintBefor=null,o.OnDrawItemPaintAfter=null,o.OnInsertAnnotate=null,o.OnRemoveAnnotate=null,o.OnDrawItemAnnotate=null,o.OnDrawItemPaintContent=null,o.OnInsertItem=null,o.OnRemoveItem=null,o.OnSaveItem=null,o.OnPaintDomainRegion=null,o.OnMatchTextStyleNoAt=null,o.OnDataAcceptActionBefor=null,o.OnDataAcceptAction=null,o.OnDataItemChange=null,o.OnDataDomainChange=null,o.OnItemMouseDown=null,o.OnItemMouseUp=null,o.OnDrawItemMouseMove=null,o.OnItemResize=null,o.OnCreateItem=null,o.OnFloatItemPaintAfter=null,o.OnCaretItemChanged=null,o.OnDataDomainSwitch=null,o.OnCurParaNoChange=null,o.OnActivePageChange=null,o.OnCreateItemByStyle=null,o.OnCanEditDataItem=null,o.OnCanNotEditNotify=null,o.OnInsertTextBefor=null,o.OnGetUndoList=null,o.OnDomainDrawItemPaintBefor=null,o.OnDomainDrawItemPaintAfter=null,o.OnDataSelectBound=null,o.OnSetActiveDataBefor=null,o.OnDataSelectApplyTextStyle=null,o.OnRequestAnnotateID=null,o}return l()(i,[{key:"GetPageIndexByFilm",value:function(t,e){if(this.FViewModel==fo.Film){if(this.FStyle.MultiplePage){for(var i=this.FPages.count-1,n=0;n<=i;n++)if(this.FPages[n].FilmTop+this.FPagePadding+this.FPaper.HeightPix>=e&&this.FPages[n].FilmLeft+this.FPagePadding+this.FPaper.WidthPix>=t){i=n;break}return i}for(var o=-1,s=0,r=this.FPages.count,a=0;a<r;a++)if((s+=this.FPagePadding+this.FPaper.HeightPix)>=e){o=a;break}return o<0&&e>s&&(o=r-1),o}return this.GetPageIndexByFormat(e)}},{key:"DoActiveDataCheckUpdateInfo",value:function(){null!=this.OnCheckUpdateInfo&&this.OnCheckUpdateInfo(this)}},{key:"DoDataReadOnlySwitch",value:function(t){null!=this.OnReadOnlySwitch&&this.OnReadOnlySwitch(this)}},{key:"DoGetScreenCoordEvent",value:function(t,e){return null!=this.OnGetScreenCoord?this.OnGetScreenCoord(t,e):et.Create(0,0)}},{key:"DoCheckInsertItemCount",value:function(t,e,i){return null!==this.OnCheckInsertItemCount?this.OnCheckInsertItemCount(t,e,i):0}},{key:"DoDataDrawItemPaintBefor",value:function(t,e,i,n,o,s,r,a,l,h,c,u){null!=this.OnDrawItemPaintBefor&&this.OnDrawItemPaintBefor(this,t,e,i,n,o,s,r,a,l,h,c,u)}},{key:"DoDataDrawItemPaintContent",value:function(t,e,i,n,o,s,r,a,l,h,c,u,f){null!=this.OnDrawItemPaintContent&&this.OnDrawItemPaintContent(t,e,i,n,o,s,r,a,l,h,c,u,f)}},{key:"DoDataDrawItemPaintAfter",value:function(t,e,i,n,o,s,r,a,l,h,c,u){null!=this.OnDrawItemPaintAfter&&this.OnDrawItemPaintAfter(this,t,e,i,n,o,s,r,a,l,h,c,u)}},{key:"DoDataInsertAnnotate",value:function(t,e){null!=this.OnInsertAnnotate&&this.OnInsertAnnotate(this,t,e)}},{key:"DoDataRemoveAnnotate",value:function(t,e){null!=this.OnRemoveAnnotate&&this.OnRemoveAnnotate(this,t,e)}},{key:"DoDataRequestAnnotateID",value:function(){return this.OnRequestAnnotateID()}},{key:"DoDataDrawItemAnnotate",value:function(t,e,i,n){null!=this.OnDrawItemAnnotate&&this.OnDrawItemAnnotate(this,t,e,i,n)}},{key:"DoDataInsertItem",value:function(t,e){null!=this.OnInsertItem&&this.OnInsertItem(this,t,e)}},{key:"DoDataRemoveItem",value:function(t,e){null!=this.OnRemoveItem&&this.OnRemoveItem(this,t,e)}},{key:"DoDataSaveItem",value:function(t,e){return null==this.OnSaveItem||this.OnSaveItem(this,t,e)}},{key:"DoDataPaintDomainRegion",value:function(t,e){return null==this.OnPaintDomainRegion||this.OnPaintDomainRegion(this,t,e)}},{key:"DoMatchTextStyleNoAt",value:function(t,e,i){return null!==this.OnMatchTextStyleNoAt?this.OnMatchTextStyleNoAt(t,e,i):oo.Null}},{key:"DoDataAcceptActionBefor",value:function(t,e,i,n){return null==this.OnDataAcceptActionBefor||this.OnDataAcceptActionBefor(this,t,e,i,n)}},{key:"DoDataAcceptAction",value:function(t,e,i,n){return null==this.OnDataAcceptAction||this.OnDataAcceptAction(this,t,e,i,n)}},{key:"DoDataSelectApplyTextStyle",value:function(t,e){return null===this.OnDataSelectApplyTextStyle||this.OnDataSelectApplyTextStyle(this,t,e)}},{key:"DoDataItemMouseDown",value:function(t,e,i,n){null!=this.OnItemMouseDown&&this.OnItemMouseDown(this,t,e,i,n)}},{key:"DoDataItemMouseUp",value:function(t,e,i,n){null!=this.OnItemMouseUp&&this.OnItemMouseUp(this,t,e,i,n)}},{key:"DoDataDrawItemMouseMove",value:function(t,e,i,n,o){null!=this.OnDrawItemMouseMove&&this.OnDrawItemMouseMove(this,t,e,i,n,o)}},{key:"DoDataChanged",value:function(t){null!=this.OnDataChange&&this.OnDataChange(t,null)}},{key:"DoDataSetChange",value:function(){null!=this.OnDataSetChange&&this.OnDataSetChange()}},{key:"DoDataItemChange",value:function(t,e,i,n){return null!==this.OnDataItemChange&&this.OnDataItemChange(this,t,e,i,n)}},{key:"DoDataDomainChange",value:function(t,e,i,n){return null!==this.OnDataDomainChange&&this.OnDataDomainChange(this,t,e,i,n)}},{key:"DoDataFloatItemPaintAfter",value:function(t,e,i,n){null!==this.OnFloatItemPaintAfter&&this.OnFloatItemPaintAfter(this,t,e,i,n)}},{key:"DoDomainDrawItemPaintBefor",value:function(t,e,i,n,o,s,r){null!=this.OnDomainDrawItemPaintBefor&&this.OnDomainDrawItemPaintBefor(this,t,e,i,n,o,s,r)}},{key:"DoDomainDrawItemPaintAfter",value:function(t,e,i,n,o,s,r){null!=this.OnDomainDrawItemPaintAfter&&this.OnDomainDrawItemPaintAfter(this,t,e,i,n,o,s,r)}},{key:"DoDataItemReFormatRequest",value:function(t,e){this.DoSectionDataAction(t,(function(){return t.ItemReFormatResponse(e),!0}))}},{key:"DoDataItemSetCaretRequest",value:function(t,e,i){this.DoActiveDataCheckUpdateInfo()}},{key:"DoDataItemResized",value:function(t,e){var i=t.Items[e],n=this.GetPageWidth(),o=0,s=t.GetRootData();o=s==this.FHeader?this.GetHeaderAreaHeight(this.FActivePageIndex):s==this.FFooter?GetFooterAreaHeight(FActivePageIndex):this.GetPageHeight(this.FActivePageIndex),i.RestrainSize(n,o),null!=this.OnItemResize&&this.OnItemResize(t,e)}},{key:"DoDataCreateStyleItem",value:function(t,e){return null!=this.OnCreateItemByStyle?this.OnCreateItemByStyle(t,e):null}},{key:"DoDataCanEditItem",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return null==this.OnCanEditDataItem||this.OnCanEditDataItem(t,e,i)}},{key:"DoDataCanNotEditNotify",value:function(t){null!=this.OnCanNotEditNotify&&this.OnCanNotEditNotify(t)}},{key:"DoDataInsertTextBefor",value:function(t,e,i,n){return null==this.OnInsertTextBefor||this.OnInsertTextBefor(t,e,i,n)}},{key:"DoDataCreateItem",value:function(t){null!=this.OnCreateItem&&this.OnCreateItem(t,null)}},{key:"DoDataCurParaNoChange",value:function(t){null!=this.OnCurParaNoChange&&this.OnCurParaNoChange(t)}},{key:"DoDataCaretItemChanged",value:function(t,e){null!=this.OnCaretItemChanged&&this.OnCaretItemChanged(this,t,e)}},{key:"DoDataDomainSwitch",value:function(t,e,i){null!==this.OnDataDomainSwitch&&this.OnDataDomainSwitch(this,t,e,i)}},{key:"DoDataGetUndoList",value:function(){return null!=this.OnGetUndoList?this.OnGetUndoList():null}},{key:"GetPageIndexByPageDataDrawItem",value:function(t){if(t<0)return 0;for(var e=this.FPages.count-1,i=0;i<=this.FPages.count-1;i++)if(this.FPages[i].EndDrawItemNo>=t){e=i;break}return e}},{key:"PaperCoordToData",value:function(t,e,i,n){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this.FViewModel==fo.Edit)return{x:i,y:n};var s=this.GetPageMarginLeft(t);if(i-=s,this.FViewModel==fo.Page)return{x:i,y:n};var r=-1;if(e===this.GetHeader(t))n-=this.GetHeaderPageDrawTop(t),o&&(n<0?n=1:n>(r=this.GetHeader(t).Height)&&(n=r-1));else if(e===this.GetFooter(t)){var a=this.GetFooterAreaHeight(t);n=n-this.FPaper.HeightPix+a,o&&(n<0?n=1:n>a&&(n=a-1))}else e==this.FPage&&(n-=this.GetHeaderAreaHeight(t),o&&(n<0?n=1:n>=(r=this.GetPageHeight(t))&&(n=r-1)));return{x:i,y:n}}},{key:"GetReadOnly",value:function(){return this.FHeader.ReadOnly&&this.FFooter.ReadOnly&&this.FPage.ReadOnly}},{key:"SetReadOnly",value:function(t){this.FHeader.ReadOnly=t,this.FFooter.ReadOnly=t,this.FPage.ReadOnly=t}},{key:"SetActivePageIndex",value:function(t){this.FActivePageIndex!=t&&(this.FActivePageIndex=t,null!=this.OnActivePageChange&&this.OnActivePageChange(this,null))}},{key:"GetCurStyleNo",value:function(){return this.FActiveData.GetTopLevelData().CurStyleNo}},{key:"GetCurParaNo",value:function(){return this.FActiveData.GetTopLevelData().CurParaNo}},{key:"KillFocus",value:function(){this.FActiveData.KillFocus()}},{key:"GetPaperSize",value:function(){return this.FPaper.Size}},{key:"SetPaperSize",value:function(t){this.FPaper.Size=t}},{key:"GetPaperWidth",value:function(){return this.FPaper.Width}},{key:"GetPaperHeight",value:function(){return this.FPaper.Height}},{key:"GetPaperMarginTop",value:function(){return this.FPaper.MarginTop}},{key:"GetPaperMarginLeft",value:function(){return this.FPaper.MarginLeft}},{key:"GetPaperMarginRight",value:function(){return this.FPaper.MarginRight}},{key:"GetPaperMarginBottom",value:function(){return this.FPaper.MarginBottom}},{key:"SetPaperWidth",value:function(t){this.FPaper.Width=t}},{key:"SetPaperHeight",value:function(t){this.FPaper.Height=t}},{key:"SetPaperMarginTop",value:function(t){this.FPaper.MarginTop=t}},{key:"SetPaperMarginLeft",value:function(t){this.FPaper.MarginLeft=t}},{key:"SetPaperMarginRight",value:function(t){this.FPaper.MarginRight=t}},{key:"SetPaperMarginBottom",value:function(t){this.FPaper.MarginBottom=t}},{key:"GetPaperWidthPix",value:function(){return this.FPaper.WidthPix}},{key:"GetPaperHeightPix",value:function(){return this.FPaper.HeightPix}},{key:"GetPaperMarginTopPix",value:function(){return this.FPaper.MarginTopPix}},{key:"GetPaperMarginLeftPix",value:function(){return this.FPaper.MarginLeftPix}},{key:"GetPaperMarginRightPix",value:function(){return this.FPaper.MarginRightPix}},{key:"GetPaperMarginBottomPix",value:function(){return this.FPaper.MarginBottomPix}},{key:"SetHeaderVerAlign",value:function(t){this.FHeaderVerAlign!==t&&(this.FHeaderVerAlign=t,this.FStyle.UpdateInfoRePaint(),this.FActiveArea===ql.Header&&this.FStyle.UpdateInfoReCaret(),this.DoActiveDataCheckUpdateInfo())}},{key:"SetHeaderOffset",value:function(t){this.FHeaderOffset!=t&&(this.FHeaderOffset=t,this.BuildSectionPages(0),this.DoDataChanged(this))}},{key:"NewEmptyPage",value:function(){var t=new jc;return this.FPages.add(t),t}},{key:"GetPageCount",value:function(){return this.FPages.count}},{key:"GetSectionDataAt",value:function(t,e){return t<0||t>this.FPaper.WidthPix||e<0||e>this.FPaper.HeightPix?{data:this.FActiveData,area:this.FActiveArea}:e>=this.FPaper.HeightPix-this.GetFooterAreaHeight(this.FActivePageIndex)?{data:this.GetFooter(this.FActivePageIndex),area:ql.Footer}:e<this.GetHeaderAreaHeight(this.FActivePageIndex)?{data:this.GetHeader(this.FActivePageIndex),area:ql.Header}:{data:this.FPage,area:ql.Page}}},{key:"SetActiveData",value:function(t){this.FViewModel!==fo.Film&&t!==this.FPage||this.FActiveData!==t&&(null!=this.FActiveData&&(this.FActiveData.DisSelect(),this.FActiveData.DisActive()),this.FActiveData=t,this.FActiveData.isClass(Zc)?this.FActiveArea=ql.Header:this.FActiveData.isClass(qc)?this.FActiveArea=ql.Footer:this.FActiveArea=ql.Page,this.FStyle.UpdateInfoReScroll())}},{key:"SetLineCount",value:function(t){this.FLineCount!==t&&(this.FLineCount=t,this.BuildSectionPages(0))}},{key:"DoSectionDataAction",value:function(t,e){var i=e();return t.FormatChange&&(t.FormatChange=!1,t===this.FPage?this.BuildSectionPages(t.FormatStartDrawItemNo):this.BuildSectionPages(0)),this.DoDataChanged(this),i}},{key:"DoSaveToStream",value:function(t){}},{key:"DoLoadFromStream",value:function(t,e){}},{key:"GetHeaderOffset",value:function(){return this.FHeaderOffset}},{key:"GetHeader",value:function(){return this.FHeader}},{key:"GetFooter",value:function(){return this.FFooter}},{key:"CalcDataFormatSize",value:function(){this.FPage.Width=this.GetPageWidth(),this.FHeader.Width=this.FPage.Width,this.FFooter.Width=this.FPage.Width}},{key:"Style",get:function(){return this.FStyle}},{key:"dispose",value:function(){this.FHeader.dispose(),this.FFooter.dispose(),this.FPage.dispose(),f()(F()(i.prototype),"dispose",this).call(this)}},{key:"ResetMargin",value:function(){this.CalcDataFormatSize(),this.FormatData(),this.BuildSectionPages(0),this.FStyle.UpdateInfoRePaint(),this.FStyle.UpdateInfoReCaret(!1),this.DoDataChanged(this)}},{key:"ActiveItemReAdaptEnvironment",value:function(){var t=this;this.DoSectionDataAction(this.FActiveData,(function(){return t.FActiveData.ActiveItemReAdaptEnvironment(),!0}))}},{key:"DisActive",value:function(){this.FActiveData.DisSelect(),this.FHeader.InitializeField(),this.FFooter.InitializeField(),this.FPage.InitializeField(),this.FActiveData=this.FPage}},{key:"SelectExists",value:function(){return this.FActiveData.SelectExists()}},{key:"SelectAll",value:function(){this.FActiveData.SelectAll()}},{key:"GetHint",value:function(){return this.FActiveData.GetTopLevelData().GetHint()}},{key:"GetActiveItem",value:function(){return this.FActiveData.GetActiveItem()}},{key:"GetActiveRectItem",value:function(){return this.FActiveData.GetActiveRectItem()}},{key:"GetTopLevelItem",value:function(){return this.FActiveData.GetTopLevelItem()}},{key:"GetTopLevelDrawItem",value:function(){return this.FActiveData.GetTopLevelDrawItem()}},{key:"GetTopLevelDrawItemCoord",value:function(){return this.FActiveData.GetTopLevelDrawItemCoord()}},{key:"GetTopLevelRectItem",value:function(){return this.FActiveData.GetTopLevelRectItem()}},{key:"GetTopLevelRectDrawItemCoord",value:function(){return this.FActiveData.GetTopLevelRectDrawItemCoord()}},{key:"PageDataFormtToFilmCoord",value:function(t){for(var e=0,i=0,n=0,o=0,s=0;s<=this.FPages.count-1;s++){if((i+=n=this.GetPageHeight(s))>=t){i=t-(i-n),o=s;break}e=e+this.FPagePadding+this.FPaper.HeightPix}return e+this.FPagePadding+this.GetHeaderAreaHeight(o)+i}},{key:"GetPageNoOffset",value:function(){return this.PageNoOffset}},{key:"GetPageIndexByCurrent",value:function(){var t=-1,e=-1;if(this.FActiveData!=this.FPage)t=this.FActivePageIndex;else{e=this.FPage.CaretDrawItemNo<0?this.FPage.GetDrawItemNoByOffset(this.FPage.SelectInfo.StartItemNo,this.FPage.SelectInfo.StartItemOffset):this.FPage.CaretDrawItemNo;for(var i=new fh,n=0;n<=this.FPages.count-1;n++)if(this.FPages[n].EndDrawItemNo>=e){n<this.FPages.count-1&&this.FPages[n+1].StartDrawItemNo==e?this.FPage.SelectInfo.StartItemNo>=0?(i.Y=0,this.FPage.GetCaretInfo(this.FPage.SelectInfo.StartItemNo,this.FPage.SelectInfo.StartItemOffset,i),t=this.GetPageIndexByFormat(i.Y)):t=this.GetPageIndexByPageDataDrawItem(e):t=n;break}}return t}},{key:"GetPageIndexByFormat",value:function(t){for(var e=-1,i=0,n=this.FPages.count,o=0;o<n;o++)if((i+=this.GetPageHeight(o))>t){e=o;break}return e<0&&t>i&&(e=n-1),e}},{key:"SetActiveItemText",value:function(t){var e=this;this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.SetActiveItemText(t),!0}))}},{key:"PaintDisplayPaper",value:function(t,e,i,n){if(this.FStyle.MultiplePage&&n.ViewModel===fo.Film)for(var o=0,s=this.FDisplayFirstPageIndex;s<=this.FDisplayLastPageIndex;s++)n.PageIndex=s,o=this.FPages[s].FilmTop-this.FPages[0].FilmTop+this.FPagePadding-e,this.paintPaper(s,this.FPages[s].FilmLeft,o,i,n);else for(var r=this.FDisplayFirstPageIndex;r<=this.FDisplayLastPageIndex;r++){n.PageIndex=r;var a=0;a=n.ViewModel==fo.Film?this.GetPageTopFilm(r):this.GetPageDataFmtTop(r),this.paintPaper(r,t,a-e,i,n)}}},{key:"KeyPress",value:function(t){var e=this;Yl.IsKeyPressWant(t)?this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.KeyPress(t),!0})):t.keyCode=0}},{key:"KeyDown",value:function(t){var e=this;if(this.FActiveData.KeyDownFloatItem(t))this.DoActiveDataCheckUpdateInfo();else{var i=t.keyCode;if(Yl.IsKeyDownWant(i))switch(i){case Ee:case Xe:case Le:case Me:this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.KeyDown(t),!0}));break;case Je:case Ye:case je:case Qe:case Ke:case ze:this.FActiveData.KeyDown(t),this.SetActivePageIndex(this.GetPageIndexByCurrent()),this.DoActiveDataCheckUpdateInfo()}else this.FActiveData.KeyDown(t)}}},{key:"KeyUp",value:function(t){this.FActiveData.KeyUp(t)}},{key:"ApplyTextStyle",value:function(t){var e=this;this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.ApplyTextStyle(t),!0}))}},{key:"ApplyTextStyleNo",value:function(t){var e=this;this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.ApplyTextStyleNo(t),!0}))}},{key:"ApplyTextFontName",value:function(t){var e=this;this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.ApplyTextFontName(t),!0}))}},{key:"ApplyTextFontSize",value:function(t){var e=this;this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.ApplyTextFontSize(t),!0}))}},{key:"ApplyTextColor",value:function(t){var e=this;this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.ApplyTextColor(t),!0}))}},{key:"ApplyTextBackColor",value:function(t){var e=this;this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.ApplyTextBackColor(t),!0}))}},{key:"ApplyTableCellAlign",value:function(t){var e=this;this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.ApplyTableCellAlign(t),!0}))}},{key:"InsertJSONObject",value:function(t){var e=this;return this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.InsertJSONObject(t)}))}},{key:"InsertText",value:function(t){var e=this;return this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.InsertText(t)}))}},{key:"InsertTable",value:function(t,e){var i=this;return this.DoSectionDataAction(this.FActiveData,(function(){return i.FActiveData.InsertTable(t,e)}))}},{key:"InsertImage",value:function(t){var e=this;return this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.InsertImage(t)}))}},{key:"InsertGifImage",value:function(t){var e=this;return this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.InsertGifImage(t)}))}},{key:"InsertLine",value:function(t,e){var i=this;return this.DoSectionDataAction(this.FActiveData,(function(){return i.FActiveData.InsertLine(t,e)}))}},{key:"InsertItem",value:function(t){var e=this;return this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.InsertItem(t)}))}},{key:"InsertItemEx",value:function(t,e){var i=this;return this.DoSectionDataAction(this.FActiveData,(function(){return i.FActiveData.InsertItemEx(t,e)}))}},{key:"InsertBreak",value:function(){var t=this;return this.DoSectionDataAction(this.FActiveData,(function(){return t.FActiveData.InsertBreak()}))}},{key:"InsertPageBreak",value:function(){var t=this;return this.DoSectionDataAction(this.FActiveData,(function(){return t.FPage.InsertPageBreak()}))}},{key:"InsertDomain",value:function(t){var e=this;return this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.InsertDomain(t)}))}},{key:"SelectToDomain",value:function(t){var e=this;return this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.SelectToDomain(t)}))}},{key:"InsertAnnotate",value:function(t,e,i){var n=this;return this.DoSectionDataAction(this.FActiveData,(function(){return n.FActiveData.InsertAnnotate(t,e,i)}))}},{key:"SetActiveImage",value:function(t){var e=this;return this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.SetActiveImage(t)}))}},{key:"PasteRectPart",value:function(t,e,i,n){var o=this;return this.DoSectionDataAction(this.FActiveData,(function(){return o.FActiveData.PasteRectPart(t,e,i,n)}))}},{key:"ActiveTableResetRowCol",value:function(t,e){var i=this;return this.DoSectionDataAction(this.FActiveData,(function(){return i.FActiveData.ActiveTableResetRowCol(t,e)}))}},{key:"ActiveTableInsertRowAfter",value:function(t){var e=this;return this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.TableInsertRowAfter(t)}))}},{key:"ActiveTableInsertRowBefor",value:function(t){var e=this;return this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.TableInsertRowBefor(t)}))}},{key:"ActiveTableDeleteCurRow",value:function(){var t=this;return this.DoSectionDataAction(this.FActiveData,(function(){return t.FActiveData.ActiveTableDeleteCurRow()}))}},{key:"ActiveTableDeleteRowFrom",value:function(t,e){var i=this;return this.DoSectionDataAction(this.FActiveData,(function(){return i.FActiveData.ActiveTableDeleteRowFrom(t,e)}))}},{key:"ActiveTableSplitCurRow",value:function(){var t=this;return this.DoSectionDataAction(this.FActiveData,(function(){return t.FActiveData.ActiveTableSplitCurRow()}))}},{key:"ActiveTableSplitCurCol",value:function(){var t=this;return this.DoSectionDataAction(this.FActiveData,(function(){return t.FActiveData.ActiveTableSplitCurCol()}))}},{key:"ActiveTableInsertColAfter",value:function(t){var e=this;return this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.TableInsertColAfter(t)}))}},{key:"ActiveTableInsertColBefor",value:function(t){var e=this;return this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.TableInsertColBefor(t)}))}},{key:"ActiveTableDeleteCurCol",value:function(){var t=this;return this.DoSectionDataAction(this.FActiveData,(function(){return t.FActiveData.ActiveTableDeleteCurCol()}))}},{key:"SectionCoordToPaper",value:function(t,e,i,n,o){if(this.FStyle.MultiplePage)return{x:e-this.FPages[t].FilmLeft,y:i-this.FPages[t].FilmTop-this.FPagePadding};return{x:e,y:i-(this.FViewModel==fo.Film?this.GetPageTopFilm(t):this.GetPageDataFmtTop(t))}}},{key:"ApplyParaAlignHorz",value:function(t){var e=this;this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.ApplyParaAlignHorz(t),!0}))}},{key:"ApplyParaAlignVert",value:function(t){var e=this;this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.ApplyParaAlignVert(t),!0}))}},{key:"ApplyParaBackColor",value:function(t){var e=this;this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.ApplyParaBackColor(t),!0}))}},{key:"ApplyParaBreakRough",value:function(t){var e=this;this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.ApplyParaBreakRough(t),!0}))}},{key:"ApplyParaLineSpace",value:function(t,e){var i=this;this.DoSectionDataAction(this.FActiveData,(function(){return i.FActiveData.ApplyParaLineSpace(t,e),!0}))}},{key:"ApplyParaLeftIndent",value:function(t){var e=this;this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.ApplyParaLeftIndent(t),!0}))}},{key:"ApplyParaRightIndent",value:function(t){var e=this;this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.ApplyParaRightIndent(t),!0}))}},{key:"ApplyParaFirstIndent",value:function(t){var e=this;this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.ApplyParaFirstIndent(t),!0}))}},{key:"ApplyParaFirstIndentCharCount",value:function(t){var e=this;this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.ApplyParaFirstIndentCharCount(t),!0}))}},{key:"ApplyBullet",value:function(t,e,i,n){var o=this;this.DoSectionDataAction(this.FActiveData,(function(){return o.FActiveData.ApplyBullet(t,e,i,n),!0}))}},{key:"DataAction",value:function(t,e){return this.DoSectionDataAction(t,e)}},{key:"GetPageCaretInfo",value:function(t){var e=-1,i=-1;i=this.FStyle.UpdateInfo.DragingSelected?this.FMousePageIndex:this.FActivePageIndex,this.FActiveData.SelectInfo.StartItemNo<0||i<0?t.Visible=!1:(t.PageIndex=i,this.FActiveData.GetCaretInfoCur(t),t.Visible&&(this.FActiveData===this.FPage&&i!=(e=this.GetPageIndexByFormat(t.Y))&&(i=e,this.SetActivePageIndex(i)),this.FViewModel==fo.Film?(this.FStyle.MultiplePage?(e=this.GetPageMarginLeft(i),t.X+=this.FPages[i].FilmLeft+e,t.Y+=this.FPages[i].FilmTop+this.FPagePadding):(e=this.GetPageMarginLeft(i),t.X+=e,t.Y+=this.GetPageTopFilm(i)),this.FActiveData.equal(this.GetHeader(i))?t.Y+=this.GetHeaderPageDrawTop(i):this.FActiveData.equal(this.FPage)?t.Y+=this.GetHeaderAreaHeight(i)-this.GetPageDataFmtTop(i):this.FActiveData.equal(this.GetFooter(i))&&(t.Y+=this.FPaper.HeightPix-this.GetFooterAreaHeight(i))):this.FViewModel===fo.Page&&(t.X+=this.FPaper.MarginLeftPix)))}},{key:"PaintHeader",value:function(t,e,i,n,o,s,r,a,l,h){var c=r+t;t>0&&(c=t+r);var u=t+this.GetHeaderPageDrawTop(a);if(null!=this.OnPaintHeaderBefor){l.save();try{this.OnPaintHeaderBefor(this,a,new nt(i,u,n,e),l,h)}finally{l.restore()}}if(this.GetHeader(a).PaintData(i,u,n,e,Math.max(u,0),c,0,l,h),null!=this.OnPaintHeaderAfter){l.save();try{this.OnPaintHeaderAfter(this,a,nt.Create(i,u,n,e),l,h)}finally{l.restore()}}}},{key:"PaintFooter",value:function(t,e,i,n,o,s,r,a,l){var h=l.WindowHeight-n;if(h=h>this.GetFooterAreaHeight(r)?t:l.WindowHeight,null!=this.OnPaintFooterBefor){a.save();try{this.OnPaintFooterBefor(this,r,nt.Create(e,n,i,t),a,l)}finally{a.restore()}}if(this.GetFooter(r).PaintData(e,n,i,t,Math.max(n,0),t+h,0,a,l),null!=this.OnPaintFooterAfter){a.save();try{this.OnPaintFooterAfter(this,r,nt.Create(e,n,i,t),a,l)}finally{a.restore()}}}},{key:"PaintPage",value:function(t,e,i,n,o,s,r,a,l,h,c,u){if(!(this.FPages[h].StartDrawItemNo<0||this.FPages[h].EndDrawItemNo<0)){if(null!=this.OnPaintPageBefor){c.save();try{this.OnPaintPageBefor(this,h,nt.Create(t,e,i,n),c,u)}finally{c.restore()}}if(this.FPage.PaintData(t,e,i,n,a,l,u.PageDataFmtTop,c,u),this.FPage.ShowUnderLine){var f=this.FPage.CalculateLineHeight(this.Style.DefaultTextStyle,this.Style.ParaStyles[this.FPage.Items.last.ParaNo]),d=e-u.PageDataFmtTop+this.FPage.DrawItems.last.rect.bottom;if(d+f<=l){for(c.pen.color=Ft.Black,c.pen.style=_t.Solid,c.beginPath();d+f<=l;)(d+=f)+f>=0&&(c.moveTo(t,d),c.lineTo(t+this.FPage.Width,d));c.paintPath()}}if(this.FPage.PaintDataAfter(t,e,i,n,a,l,u.PageDataFmtTop,this.FPages[h].StartDrawItemNo,this.FPages[h].EndDrawItemNo,h,this.FPages.count,c,u),null!=this.OnPaintPageAfter){c.save();try{this.OnPaintPageAfter(this,h,nt.Create(t,e,i,n),c,u)}finally{c.restore()}}}}},{key:"paintPaper",value:function(t,e,i,n,o){var s,r,a,l,h,c=L.Round(o.WindowWidth/o.ScaleX),u=L.Round(o.WindowHeight/o.ScaleY),f=e,d=i,m=0,S=0,p=0,y=0;if(o.ViewModel==fo.Film){s=f+this.FPaper.WidthPix,r=d+this.FPaper.HeightPix;var F=this.GetPageMarginLeftAndRight(t);S=F.left,p=F.right,l=d+(y=this.GetHeaderAreaHeight(t)),m=r-this.GetFooterAreaHeight(t)}else o.ViewModel==fo.Page?(s=f+this.FPaper.WidthPix,r=d+this.GetPageHeight(t),S=this.FPaper.MarginLeftPix,p=this.FPaper.MarginRightPix):(s=f+this.GetPageWidth(),r=d+this.GetPageHeight(t),S=0,p=0),y=0,l=d,m=r-1;a=f+S,h=s-p;var v=Math.max(l,0),I=Math.min(m,u);o.PageDataFmtTop=this.GetPageDataFmtTop(t),n.save();try{if(o.Print||(n.brush.color=this.FStyle.BackgroundColor,n.fillRect(nt.Create(f,d,Math.min(s,c),Math.min(r,u)))),null!=this.OnPaintPaperBefor){n.save();try{this.OnPaintPaperBefor(this,t,nt.Create(f,d,s,r),n,o)}finally{n.restore()}}o.Print||(o.ViewModel==fo.Film?(l>0&&(y>this.FPaper.MarginTopPix&&(n.pen.style=_t.Dot,n.pen.color="#d3d3d3",o.drawNoScaleLine(n,[et.Create(a,l-1),et.Create(h,l-1)])),this.FActiveData===this.FHeader?(n.pen.width=1,n.pen.color="#0000ff",n.pen.style=_t.Solid,n.drawLineByPointsDriect([et.Create(a,l),et.Create(a,d+this.FHeaderOffset),et.Create(h,d+this.FHeaderOffset),et.Create(h,l),et.Create(a,l)]),n.brush.color="#d8e8f5",n.fillRect(nt.Create(a-40,l,a,l+20)),n.font.size=10,n.font.name=L.DefaultFont,n.font.styles.clear(),n.font.color="#15428b",n.textOut(a-32,l+4,"页眉")):(n.pen.width=1,n.pen.color="#808080",n.pen.style=_t.Solid),o.drawNoScaleLine(n,[et.Create(a-Yl.PMSLineHeight,i+this.FPaper.MarginTopPix),et.Create(a,i+this.FPaper.MarginTopPix),et.Create(a,i+this.FPaper.MarginTopPix-Yl.PMSLineHeight)]),o.drawNoScaleLine(n,[et.Create(h+Yl.PMSLineHeight,i+this.FPaper.MarginTopPix),et.Create(h,i+this.FPaper.MarginTopPix),et.Create(h,i+this.FPaper.MarginTopPix-Yl.PMSLineHeight)])),m<o.WindowHeight/o.ScaleY&&(this.FActiveData==this.FFooter?(n.pen.width=1,n.pen.color="#0000ff",n.pen.style=_t.Solid,n.drawLine(a,m,h,m),n.brush.color="#d8e8f5",n.fillRect(nt.Create(a-40,m,a,m-20)),n.font.size=10,n.font.family=L.DefaultFont,n.font.styles.clear(),n.font.color="#15428b",n.textOut(a-32,m-16,"页脚")):(n.pen.width=1,n.pen.color="#808080",n.pen.style=_t.Solid),o.drawNoScaleLine(n,[et.Create(a-Yl.PMSLineHeight,m),et.Create(a,m),et.Create(a,m+Yl.PMSLineHeight)]),o.drawNoScaleLine(n,[et.Create(h+Yl.PMSLineHeight,m),et.Create(h,m),et.Create(h,m+Yl.PMSLineHeight)]))):(l>0&&(n.pen.width=1,n.pen.color="#808080",n.pen.style=_t.DashDot,n.drawLine(f,l,s,l)),m<o.WindowHeight&&(n.pen.width=1,n.pen.color="#808080",n.pen.style=_t.DashDot,n.drawLine(f,m,s,m))));var g=new nt;if(o.ViewModel==fo.Film){if(l>0){g.reset(f,Math.max(d+this.FHeaderOffset,0),s,Math.min(l,o.WindowHeight/o.ScaleY)),n.save();try{n.clipRect(g),this.PaintHeader(d,l,a,h,S,p,y,t,n,o)}finally{n.restore()}}if(m<o.WindowHeight/o.ScaleY){g.reset(f,Math.max(m,0),s,Math.min(r,o.WindowHeight/o.ScaleY)),n.save();try{n.clipRect(g),this.PaintFooter(r,a,h,m,S,p,t,n,o)}finally{n.restore()}}}if(I>v){g.reset(f,Math.max(l,v),s,Math.min(m,I)+1),n.save();try{n.clipRect(g),this.PaintPage(a,l,h,m,S,p,y,v,I,t,n,o)}finally{n.restore()}}g.reset(f,d,s,r),n.save();try{n.clipRect(g),this.GetHeader(t).PaintFloatItems(t,a,d+this.GetHeaderPageDrawTop(t),0,n,o),this.GetFooter(t).PaintFloatItems(t,a,m,0,n,o),this.FPage.PaintFloatItems(t,a,l,this.GetPageDataFmtTop(t),n,o)}finally{n.restore()}}finally{n.restore()}if(null!=this.OnPaintPaperAfter){n.save();try{this.OnPaintPaperAfter(this,t,nt.Create(f,d,s,r),n,o)}finally{n.restore()}}}},{key:"Clear",value:function(){this.FHeader.Clear(),this.FFooter.Clear(),this.FPage.Clear(),this.FPages.ClearEx(),this.FActivePageIndex=0,this.FHeader.FormatChange=!1,this.FFooter.FormatChange=!1,this.FPage.FormatChange=!1}},{key:"MouseDown",value:function(t){var e=!1,i=this.FActiveData,n=this.FActiveData.GetTopLevelData(),o=this.GetPageIndexByFilm(t.x,t.y);this.FActivePageIndex!=o&&(this.FActivePageIndex=o);var s=this.SectionCoordToPaper(this.FActivePageIndex,t.x,t.y,-1,-1),r=s.x,a=s.y,l=this.FActiveData;if(this.FViewModel===fo.Film){var h=this.GetSectionDataAt(r,a);if(l=h.data,this.FActiveArea!=h.area&&2==t.clicks||this.FActiveArea==h.area&&i!==l){var c=!0;null!==this.OnSetActiveDataBefor&&(c=this.OnSetActiveDataBefor(this,h.area,l)),c&&(this.SetActiveData(l),e=!0)}}if(this.FActiveData.FloatItems.count>0){var u=this.PaperCoordToData(this.FActivePageIndex,this.FActiveData,r,a,!1);this.FActiveData==this.FPage&&(u.y=u.y+this.GetPageDataFmtTop(this.FActivePageIndex));var f=new fi;if(f.assign(t),f.x=u.x,f.y=u.y,this.FActiveData.MouseDownFloatItem(f))return}r=(s=this.PaperCoordToData(this.FActivePageIndex,this.FActiveData,r,a,!this.FActiveData.SelectExists())).x,a=s.y,this.FActiveData==this.FPage&&(a+=this.GetPageDataFmtTop(this.FActivePageIndex));var d=new fi;d.assign(t),d.x=r,d.y=a,this.FActiveData.MouseDown(d),2!==t.clicks||e||this.FActiveData.DblClick(r,a),n!=this.FActiveData.GetTopLevelData()&&null!=this.OnChangeTopLevelData&&this.OnChangeTopLevelData(this,null)}},{key:"MouseMove",value:function(t){this.FMousePageIndex=this.GetPageIndexByFilm(t.x,t.y);var e,i=-1,n=-1;if(this.FActiveData.FloatItems.count>0){t.button==ae&&!this.hcl.keyDownStates[Ge]&&this.FActiveData.FloatItemIndex>=0&&(this.FActiveData.ActiveFloatItem.Resizing||(this.FActiveData.ActiveFloatItem.PageIndex=this.FMousePageIndex)),this.FActiveData==this.FPage?this.FActiveData.FloatItemIndex>=0&&this.FActiveData.ActiveFloatItem.Resizing?(e=this.SectionCoordToPaper(this.FActiveData.ActiveFloatItem.PageIndex,t.x,t.y,i,n),i=(e=this.PaperCoordToData(this.FActiveData.ActiveFloatItem.PageIndex,this.FActiveData,e.x,e.y,!1)).x,n=e.y+this.GetPageDataFmtTop(this.FActiveData.ActiveFloatItem.PageIndex)):(e=this.SectionCoordToPaper(this.FMousePageIndex,t.x,t.y,i,n),i=(e=this.PaperCoordToData(this.FMousePageIndex,this.FActiveData,e.x,e.y,!1)).x,n=e.y+this.GetPageDataFmtTop(this.FMousePageIndex)):this.FActiveData.FloatItemIndex>=0&&this.FActiveData.ActiveFloatItem.Resizing?(e=this.SectionCoordToPaper(this.FActivePageIndex,t.x,t.y,i,n),i=(e=this.PaperCoordToData(this.FActivePageIndex,this.FActiveData,e.x,e.y,!1)).x,n=e.y):(e=this.SectionCoordToPaper(this.FMousePageIndex,t.x,t.y,i,n),i=(e=this.PaperCoordToData(this.FMousePageIndex,this.FActiveData,e.x,e.y,!1)).x,n=e.y);var o=new fi;if(o.assign(t),o.x=i,o.y=n,this.FActiveData.MouseMoveFloatItem(o))return}i=(e=this.SectionCoordToPaper(this.FMousePageIndex,t.x,t.y,i,n)).x,n=e.y;var s=null;if(i<0||i>this.FPaper.WidthPix||n<0||n>this.FPaper.HeightPix);else if(this.FViewModel===fo.Film){s=this.GetSectionDataAt(i,n).data}else s=this.FActiveData;if(s!==this.FMoveData&&(null!=this.FMoveData?this.FMoveData.SelectedResizing()||(this.FMoveData.MouseLeave(),this.FMoveData=s):this.FMoveData=s),this.FMoveData===this.FActiveData||this.FStyle.UpdateInfo.Selecting||this.FStyle.UpdateInfo.DragingSelected){var r,a=n;r=(e=this.PaperCoordToData(this.FMousePageIndex,this.FActiveData,i,n,0!=t.button)).x,a=e.y,this.FActiveData==this.FPage&&(a+=this.GetPageDataFmtTop(this.FMousePageIndex));var l=new fi;l.assign(t),l.x=r,l.y=a,this.FActiveData.MouseMove(l)}else;var h=this.GetPageMarginLeftAndRight(this.FMousePageIndex),c=h.left,u=h.right;(i<c||i>this.FPaper.WidthPix-u||this.FMoveData!==this.FActiveData)&&(this.FStyle.Cursor=Se)}},{key:"MouseUp",value:function(t){var e,i=this,n=this.GetPageIndexByFilm(t.x,t.y),o=-1,s=-1,r=null;if(!(this.FActiveData.FloatItems.count>0&&this.FActiveData.FloatItemIndex>=0&&(this.FActiveData==this.FPage?(e=this.SectionCoordToPaper(this.FActiveData.ActiveFloatItem.PageIndex,t.x,t.y,o,s),e=this.PaperCoordToData(this.FActiveData.ActiveFloatItem.PageIndex,this.FActiveData,e.x,e.y,!1),o=e.x,s=e.y+this.GetPageDataFmtTop(this.FActiveData.ActiveFloatItem.PageIndex)):(e=this.SectionCoordToPaper(n,t.x,t.y,o,s),e=this.PaperCoordToData(n,this.FActiveData,e.x,e.y,!1),o=e.x,s=e.y),(r=new fi).assign(t),r.x=o,r.y=s,this.FActiveData.MouseUpFloatItem(r))))if(e=this.SectionCoordToPaper(n,t.x,t.y,o,s),e=this.PaperCoordToData(n,this.FActiveData,e.x,e.y),o=e.x,s=e.y,this.FActiveData==this.FPage&&(s+=this.GetPageDataFmtTop(n)),this.FActiveData.SelectedResizing())this.DoSectionDataAction(this.FActiveData,(function(){var e=new fi;return e.assign(t),e.x=o,e.y=s,i.FActiveData.MouseUp(e),!0}));else{var a=new fi;a.assign(t),a.x=o,a.y=s,this.FActiveData.MouseUp(a)}}},{key:"GetPageTopFilm",value:function(t){if(this.FViewModel==fo.Film){if(this.FStyle.MultiplePage)return this.FPages[t].FilmTop+this.FPagePadding;for(var e=this.FPagePadding,i=0;i<t;i++)e+=this.FPaper.HeightPix+this.FPagePadding;return e}for(var n=0,o=0;o<t;o++)n+=this.GetPageHeight(o);return n}},{key:"GetPageDataFmtTop",value:function(t){for(var e=0,i=0;i<t;i++)e+=this.GetPageHeight(i);return e}},{key:"GetHeaderPageDrawTop",value:function(){var t=this.FHeaderOffset,e=this.FHeader.Height;if(e<this.FPaper.MarginTopPix-this.FHeaderOffset)switch(this.FHeaderVerAlign){case ls.Top:break;case ls.Center:t+=Math.trunc((this.FPaper.MarginTopPix-this.FHeaderOffset-e)/2);break;case ls.Bottom:t+=this.FPaper.MarginTopPix-this.FHeaderOffset-e}return t}},{key:"GetPageDataHeight",value:function(t){return this.Page.DrawItems[this.FPages[t].EndDrawItemNo].rect.bottom-this.Page.DrawItems[this.FPages[t].StartDrawItemNo].rect.top}},{key:"GetPageMarginLeft",value:function(t){return this.GetPageMarginLeftAndRight(t).left}},{key:"GetPageMarginLeftAndRight",value:function(t){return this.FSymmetryMargin&&L.isOdd(t)?{left:this.FPaper.MarginRightPix,right:this.FPaper.MarginLeftPix}:{left:this.FPaper.MarginLeftPix,right:this.FPaper.MarginRightPix}}},{key:"_FormatNewPage",value:function(t,e,i,n,o){this.FPages[t].EndDrawItemNo=e;var s=new jc;return s.StartDrawItemNo=i,this.FPages.insert(t+1,s),{pageIndex:++t,pageDataFmtTop:n=o,pageDataFmtBottom:o=n+this.GetPageHeight(t)}}},{key:"_RectItemCheckPage",value:function(t,e,i,n,o,s,r,a,l,h){var c=0,u=0;if(this.FPage.DrawItems[t].rect.bottom>h){if(this.FPages[s].StartDrawItemNo===t&&0===i&&!o.CanPageBreak)return a+=c=h-this.FPage.DrawItems[t].rect.bottom,this.FPage.DrawItems[t].rect.bottom=this.FPage.DrawItems[t].rect.bottom+c,o.Height=o.Height+c,{pageIndex:s,breakSeat:r,suplus:a,pageFmtTop:l,pageFmtBottom:h};var f=nt.CreateByRect(this.FPage.DrawItems[t].rect);if(!o.CanPageBreak){if((u+=h-f.top)>=n)return;a+=u;for(var d=e;d<=t;d++)this.FPage.DrawItems[d].rect.offset(0,u);var m=this._FormatNewPage(s,e-1,e,l,h);return s=m.pageIndex,l=m.pageDataFmtTop,h=m.pageDataFmtBottom,this._RectItemCheckPage(t,e,i,n,o,s,r,a,l,h)}f.inFlate(0,-Math.trunc(this.FPage.GetLineBlankSpace(t)/2));var S=o.CheckFormatPageBreak(this.FPages.count-1,f.top,f.bottom,l,h,i,r,u,c);if(r=S.breakSeat,u=S.fmtOffset,c=S.fmtHeightInc,!(r<0)){if(0!==u||f.top===h){if((u+=Math.trunc(this.FPage.GetLineBlankSpace(t)/2))>=n)return;a=a+u+c;for(var p=e;p<=t;p++)this.FPage.DrawItems[p].rect.offset(0,u);var y=this._FormatNewPage(s,e-1,e,l,h);return s=y.pageIndex,l=y.pageDataFmtTop,h=y.pageDataFmtBottom,this._RectItemCheckPage(t,e,i,n,o,s,r,a,l,h)}a+=c,this.FPage.DrawItems[t].rect.bottom+=c,o.Height=o.Height+c;var F=this._FormatNewPage(s,t,t,l,h);return s=F.pageIndex,l=F.pageDataFmtTop,h=F.pageDataFmtBottom,this._RectItemCheckPage(t,e,i,n,o,s,r,a,l,h)}if(u<0&&this.FStyle.FormatVersion>3)return a+=u,this.FPage.DrawItems[t].rect.bottom+=u,o.Height+=u,this._RectItemCheckPage(t,e,i,n,o,s,r,a,l,h);a=a+h-f.bottom}else(c=t===this.FPage.DrawItems.count-1?o.CheckPageSurplus(h-this.FPage.DrawItems[t].rect.bottom+Math.trunc(this.FPage.GetLineBlankSpace(t)/2)):o.CheckPageSurplus(h-this.FPage.DrawItems.last.rect.bottom-a))>0&&(a+=c,this.FPage.DrawItems[t].rect.bottom+=c,o.Height=o.Height+c);return{pageIndex:s,breakSeat:r,suplus:a,pageFmtTop:l,pageFmtBottom:h}}},{key:"_FormatRectItemCheckPageBreak",value:function(t,e,i,n,o,s){var r=0,a=0,l=this.FPage.Items[this.FPage.DrawItems[t].ItemNo];l.CheckFormatPageBreakBefor();var h=this._RectItemCheckPage(t,e,0,i,l,n,a,r,o,s);if(n=h.pageIndex,a=h.breakSeat,r=h.suplus,o=h.pageFmtTop,s=h.pageFmtBottom,0!==r){var c=-1;if(l.PageBreakCount>0){for(var u=t+1;u<this.FPage.DrawItems.count;u++)if(this.FPage.DrawItems[u].LineFirst){c=u;break}}else c=t+1;if(c>0)for(var f=c;f<this.FPage.DrawItems.count;f++)this.FPage.DrawItems[f].rect.offset(0,r)}return{pageIndex:n,pageFmtTop:o,pageFmtBottom:s}}},{key:"_FormatTextItemCheckPageBreak",value:function(t,e,i,n,o){if(this.FPage.DrawItems[t].rect.bottom>n){for(var s=n-this.FPage.DrawItems[t].rect.top,r=e;r<this.FPage.DrawItems.count;r++)this.FPage.DrawItems[r].rect.offset(0,s);var a=this._FormatNewPage(o,e-1,e,i,n);o=a.pageIndex,i=a.pageDataFmtTop,n=a.pageDataFmtBottom}return{pageFmtTop:i,pageFmtBottom:n,pageIndex:o}}},{key:"BuildSectionPages",value:function(t){if(!(this.FPage.FormatCount>0)){for(var e=t,i=null;e>0&&!this.FPage.DrawItems[e].LineFirst;)e--;var n=0;if(--e>0)for(var o=this.FPages.count-1;o>=0;o--)if(e>=(i=this.FPages[o]).StartDrawItemNo&&e<=i.EndDrawItemNo){n=o;break}this.FPages.removeRange(n+1,this.FPages.count-n-1),0==this.FPages.count&&((i=new jc).StartDrawItemNo=0,this.FPages.add(i),n=0);var s=this.GetPageDataFmtTop(n),r=this.GetPageHeight(n);if(!(r<=0)){this.FLineCount>0&&(Math.trunc(r/this.FLineCount),r%this.FLineCount);for(var a=s+r,l=0,h=null,c=null,u=e+1,f=0;u<this.FPage.DrawItems.count;){if(this.FPage.DrawItems[u].LineFirst){for(f=u;u<this.FPage.DrawItems.count&&!this.FPage.Items[this.FPage.DrawItems[u].ItemNo].Visible;)u++;if(u===this.FPage.DrawItems.count)break;if((h=this.FPage.Items[this.FPage.DrawItems[f].ItemNo]).PageBreak&&h.FirstDItemNo===f&&this.FPages[n].StartDrawItemNo!==f){if((l=a-this.FPage.DrawItems[f].rect.top)>0)for(var d=f;d<this.FPage.DrawItems.count;d++)this.FPage.DrawItems[d].rect.offset(0,l);n=(c=this._FormatNewPage(n,f-1,f,s,a)).pageIndex,s=c.pageDataFmtTop,a=c.pageDataFmtBottom}if((h=this.FPage.Items[this.FPage.DrawItems[u].ItemNo]).StyleNo<oo.Null){var m=this._FormatRectItemCheckPageBreak(u,f,r,n,s,a);n=m.pageIndex,s=m.pageFmtTop,a=m.pageFmtBottom}else{var S=this._FormatTextItemCheckPageBreak(u,f,s,a,n);n=S.pageIndex,s=S.pageFmtTop,a=S.pageFmtBottom}}u++}this.FPages[n].EndDrawItemNo=this.FPage.DrawItems.count-1,this.SetActivePageIndex(this.GetPageIndexByCurrent());for(var p=this.FPage.FloatItems.count-1;p>=0;p--)this.FPage.FloatItems[p].PageIndex>this.FPages.count-1&&this.FPage.FloatItems.delete(p);this.FHeader.FormatChange=!1,this.FFooter.FormatChange=!1,this.FPage.FormatChange=!1}}}},{key:"DeleteSelected",value:function(){var t=this;return this.DoSectionDataAction(this.FActiveData,(function(){return t.FActiveData.DeleteSelected()}))}},{key:"DisSelect",value:function(){this.FActiveData.DisSelect()}},{key:"DeleteActiveAnnotate",value:function(){var t=this;return this.DoSectionDataAction(this.FActiveData,(function(){return t.FActiveData.DeleteActiveAnnotate()}))}},{key:"DeleteActiveDomain",value:function(){var t=this;return this.DoSectionDataAction(this.FActiveData,(function(){return t.FActiveData.DeleteActiveDomain()}))}},{key:"DeleteActiveDataItems",value:function(t,e,i){var n=this;return this.DoSectionDataAction(this.FActiveData,(function(){return n.FActiveData.DeleteActiveDataItems(t,e,i),!0}))}},{key:"MergeTableSelectCells",value:function(){var t=this;return this.DoSectionDataAction(this.FActiveData,(function(){return t.FActiveData.MergeTableSelectCells()}))}},{key:"TableApplyContentAlign",value:function(t){var e=this;return this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.TableApplyContentAlign(t)}))}},{key:"ReFormatActiveParagraph",value:function(){var t=this;this.DoSectionDataAction(this.FActiveData,(function(){return t.FActiveData.ReFormatActiveParagraph(),!0}))}},{key:"ReFormatActiveDomain",value:function(){var t=this;this.DoSectionDataAction(this.FActiveData,(function(){return t.FActiveData.ReFormatActiveDomain(),!0}))}},{key:"ReFormatActiveItem",value:function(){var t=this;this.DoSectionDataAction(this.FActiveData,(function(){return t.FActiveData.ReFormatActiveItem(),!0}))}},{key:"SetDataEvent",value:function(t){var e=this;t.OnInsertItem=function(t,i){e.DoDataInsertItem(t,i)},t.OnRemoveItem=function(t,i){e.DoDataRemoveItem(t,i)},t.OnSaveItem=function(t,i){return e.DoDataSaveItem(t,i)},t.OnAcceptActionBefor=function(t,i,n,o){return e.DoDataAcceptActionBefor(t,i,n,o)},t.OnAcceptAction=function(t,i,n,o){return e.DoDataAcceptAction(t,i,n,o)},t.OnSelectApplyTextStyle=function(t,i){return e.DoDataSelectApplyTextStyle(t,i)},t.OnItemResized=function(t,i){e.DoDataItemResized(t,i)},t.OnItemMouseDown=function(t,i,n,o){e.DoDataItemMouseDown(t,i,n,o)},t.OnItemMouseUp=function(t,i,n,o){e.DoDataItemMouseUp(t,i,n,o)},t.OnDrawItemMouseMove=function(t,i,n,o,s){e.DoDataDrawItemMouseMove(t,i,n,o,s)},t.OnItemReFormatRequest=function(t,i){e.DoDataItemReFormatRequest(t,i)},t.OnItemSetCaretRequest=function(t,i,n){e.DoDataItemSetCaretRequest(t,i,n)},t.OnCreateItemByStyle=function(t,i){return e.DoDataCreateStyleItem(t,i)},t.OnPaintDomainRegion=function(t,i){return e.DoDataPaintDomainRegion(t,i)},t.OnMatchTextStyleNoAt=function(t,i,n){return e.DoMatchTextStyleNoAt(t,i,n)},t.OnCanEditItem=function(t,i,n){return e.DoDataCanEditItem(t,i,n)},t.OnCanNotEditNotify=function(t){e.DoDataCanNotEditNotify(t)},t.OnInsertTextBefor=function(t,i,n,o){return e.DoDataInsertTextBefor(t,i,n,o)},t.OnCreateItem=function(t){e.DoDataCreateItem(t)},t.OnReadOnlySwitch=function(t){e.DoDataReadOnlySwitch(t)},t.OnGetScreenCoord=function(t,i){return e.DoGetScreenCoordEvent(t,i)},t.OnCheckInsertItemCount=function(t,i,n){return e.DoCheckInsertItemCount(t,i,n)},t.OnDrawItemPaintBefor=function(t,i,n,o,s,r,a,l,h,c,u,f){e.DoDataDrawItemPaintBefor(t,i,n,o,s,r,a,l,h,c,u,f)},t.OnDrawItemPaintAfter=function(t,i,n,o,s,r,a,l,h,c,u,f){e.DoDataDrawItemPaintAfter(t,i,n,o,s,r,a,l,h,c,u,f)},t.OnDrawItemPaintContent=function(t,i,n,o,s,r,a,l,h,c,u,f,d){e.DoDataDrawItemPaintContent(t,i,n,o,s,r,a,l,h,c,u,f,d)},t.OnInsertAnnotate=function(t,i){e.DoDataInsertAnnotate(t,i)},t.OnRemoveAnnotate=function(t,i){e.DoDataRemoveAnnotate(t,i)},t.OnRequestAnnotateID=function(){return e.DoDataRequestAnnotateID()},t.OnDrawItemAnnotate=function(t,i,n,o){e.DoDataDrawItemAnnotate(t,i,n,o)},t.OnGetUndoList=function(){return e.DoDataGetUndoList()},t.OnCurParaNoChange=function(t){e.DoDataCurParaNoChange(t)},t.OnCaretItemChanged=function(t,i){e.DoDataCaretItemChanged(t,i)},t.OnDomainSwitch=function(t,i,n){e.DoDataDomainSwitch(t,i,n)},t.OnChange=function(){e.DoDataSetChange()},t.OnItemChange=function(t,i,n,o){return e.DoDataItemChange(t,i,n,o)},t.OnDomainChange=function(t,i,n,o){return e.DoDataDomainChange(t,i,n,o)},t.OnFloatItemPaintAfter=function(t,i,n,o){e.DoDataFloatItemPaintAfter(t,i,n,o)},t.OnSelectBound=function(t){null!=e.OnDataSelectBound&&e.OnDataSelectBound(e,t)},this.hcl.hc.DOMAINPAINTEVENT&&(t.OnDomainDrawItemPaintBefor=function(t,i,n,o,s,r,a){e.DoDomainDrawItemPaintBefor(t,i,n,o,s,r,a)},t.OnDomainDrawItemPaintAfter=function(t,i,n,o,s,r,a){e.DoDomainDrawItemPaintAfter(t,i,n,o,s,r,a)})}},{key:"GetHeaderAreaHeight",value:function(){var t=this.FHeaderOffset+this.FHeader.height;return t<this.FPaper.MarginTopPix&&(t=this.FPaper.MarginTopPix),t}},{key:"GetFooterAreaHeight",value:function(){return this.FPaper.MarginBottomPix}},{key:"GetPageHeight",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return this.FPaper.HeightPix-this.GetHeaderAreaHeight(t)-this.GetFooterAreaHeight(t)}},{key:"GetPageWidth",value:function(){return this.FPaper.WidthPix-this.FPaper.MarginLeftPix-this.FPaper.MarginRightPix}},{key:"GetPageInfo",value:function(t){return this.FPages[t]}},{key:"GetFilmHeight",value:function(){if(this.FViewModel==fo.Film)return this.FPages.count*(this.FPagePadding+this.FPaper.HeightPix);for(var t=0,e=0;e<this.FPages.count;e++)t+=this.GetPageHeight(e);return t}},{key:"GetFilmWidth",value:function(){return this.FPages.count*(this.FPagePadding+this.FPaper.WidthPix)}},{key:"MarkStyleUsed",value:function(t,e){e.has(ql.Header)&&this.FHeader.MarkStyleUsed(t),e.has(ql.Footer)&&this.FFooter.MarkStyleUsed(t),e.has(ql.Page)&&this.FPage.MarkStyleUsed(t)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s="";return i&&(s+='"Header":{'+this.Header.ToJSONString(t,e)+"},"),o&&(s+='"Page":{'+this.FPage.ToJSONString(t,e)+"},"),n&&(s+='"Footer":{'+this.Footer.ToJSONString(t,e)+"}"),","===s[s.length-1]&&(s=s.substring(0,s.length-1)),s}},{key:"SaveToStream",value:function(t,e){var i=t.position;if(t.writeUInt64(i),this.DoSaveToStream(t),e.size>0){t.writeBoolean(this.FSymmetryMargin),t.writeByte(this.FPaperOrientation),t.writeBoolean(this.FPageNoVisible),t.writeInt32(this.FPageNoFrom),Yl.HCSaveTextToStream(t,this.FPageNoFormat),this.FPaper.SaveToStream(t);var n=e.has(ql.Header);t.writeBoolean(n),n=e.has(ql.Footer),t.writeBoolean(n),n=e.has(ql.Page),t.writeBoolean(n),e.has(ql.Header)&&(t.writeInt32(this.FHeaderOffset),this.FHeader.SaveToStream(t)),e.has(ql.Footer)&&this.FFooter.SaveToStream(t),e.has(ql.Page)&&this.FPage.SaveToStream(t)}t.writeByte(this.FHeaderVerAlign),t.writeByte(this.PageNoHorAlign),t.writeInt32(this.PageNoOffset),t.writeByte(this.FLineCount);var o=t.position;t.position=i,i=o-i-8,t.writeUInt64(i),t.position=o}},{key:"SaveToText",value:function(){return this.FPage.SaveToText()}},{key:"LoadFromStream",value:function(t,e,i){t.readInt64(),i>41&&this.DoLoadFromStream(t,i),this.FSymmetryMargin=t.readBoolean(),i>11&&(this.FPaperOrientation=t.readByte(),this.FPageNoVisible=t.readBoolean()),i>45&&(this.FPageNoFrom=t.readInt32(),this.FPageNoFormat=Yl.HCLoadTextFromStream(t,i),this.FPageNoFormat=this.FPageNoFormat.replace("%d","{0}"),this.FPageNoFormat=this.FPageNoFormat.replace("%d","{1}")),this.FPaper.LoadFromStream(t,i),this.FPage.Width=this.GetPageWidth();var n=new Set([]);t.readBoolean()&&n.add(ql.Header),t.readBoolean()&&n.add(ql.Footer),t.readBoolean()&&n.add(ql.Page),n.has(ql.Header)&&(this.FHeaderOffset=t.readInt32(),this.FHeader.Width=this.FPage.Width,this.FHeader.LoadFromStream(t,e,i)),n.has(ql.Footer)&&(this.FFooter.Width=this.FPage.Width,this.FFooter.LoadFromStream(t,e,i)),n.has(ql.Page)&&this.FPage.LoadFromStream(t,e,i),this.FHeaderVerAlign=i>65?t.readByte():ls.Center,i>58?(this.PageNoHorAlign=t.readByte(),this.PageNoOffset=t.readInt32()):(this.PageNoHorAlign=as.Center,this.PageNoOffset=this.FFooter.Height),this.FLineCount=i>61?t.readByte():0,this.BuildSectionPages(0)}},{key:"InsertStream",value:function(t,e,i){var n=this;return this.DoSectionDataAction(this.FActiveData,(function(){return n.FActiveData.InsertStream(t,e,i)}))}},{key:"FormatData",value:function(){this.FHeader.ReFormat(),this.Footer.ReFormat(),this.FPage.ReFormat()}},{key:"SetPageFilmLeftTop",value:function(t,e,i){this.FPages[t].FilmLeft=e,this.FPages[t].FilmTop=i}},{key:"ActiveDataSetSelectBound",value:function(t,e,i,n){this.FActiveData.SetSelectBound(t,e,i,n,!1),this.FStyle.UpdateInfoRePaint(),this.FStyle.UpdateInfoReCaret(),this.FStyle.UpdateInfoReScroll(),this.DoActiveDataCheckUpdateInfo()}},{key:"Undo",value:function(t){var e=this;this.DoDataGetUndoList().GroupWorking?t.Data.Undo(t):(this.FActiveData!=t.Data&&this.SetActiveData(t.Data),this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.Undo(t),!0})))}},{key:"Redo",value:function(t){var e=this;this.DoDataGetUndoList().GroupWorking?t.Data.Redo(t):(this.FActiveData!=t.Data&&this.SetActiveData(t.Data),this.DoSectionDataAction(this.FActiveData,(function(){return e.FActiveData.Redo(t),!0})))}},{key:"Paper",get:function(){return this.FPaper}},{key:"PaperSize",get:function(){return this.GetPaperSize()},set:function(t){this.SetPaperSize(t)}},{key:"PaperWidth",get:function(){return this.GetPaperWidth()},set:function(t){this.SetPaperWidth(t)}},{key:"PaperHeight",get:function(){return this.GetPaperHeight()},set:function(t){this.SetPaperHeight(t)}},{key:"PaperMarginTop",get:function(){return this.GetPaperMarginTop()},set:function(t){this.SetPaperMarginTop(t)}},{key:"PaperMarginLeft",get:function(){return this.GetPaperMarginLeft()},set:function(t){this.SetPaperMarginLeft(t)}},{key:"PaperMarginRight",get:function(){return this.GetPaperMarginRight()},set:function(t){this.SetPaperMarginRight(t)}},{key:"PaperMarginBottom",get:function(){return this.GetPaperMarginBottom()},set:function(t){this.SetPaperMarginBottom(t)}},{key:"PaperOrientation",get:function(){return this.FPaperOrientation},set:function(t){this.FPaperOrientation=t}},{key:"PaperWidthPix",get:function(){return this.GetPaperWidthPix()}},{key:"PaperHeightPix",get:function(){return this.GetPaperHeightPix()}},{key:"PaperMarginTopPix",get:function(){return this.GetPaperMarginTopPix()}},{key:"PaperMarginLeftPix",get:function(){return this.GetPaperMarginLeftPix()}},{key:"PaperMarginRightPix",get:function(){return this.GetPaperMarginRightPix()}},{key:"PaperMarginBottomPix",get:function(){return this.GetPaperMarginBottomPix()}},{key:"HeaderVerAlign",get:function(){return this.FHeaderVerAlign},set:function(t){this.SetHeaderVerAlign(t)}},{key:"HeaderOffset",get:function(){return this.FHeaderOffset},set:function(t){this.SetHeaderOffset(t)}},{key:"Header",get:function(){return this.FHeader}},{key:"Footer",get:function(){return this.FFooter}},{key:"Page",get:function(){return this.FPage}},{key:"Pages",get:function(){return this.FPages}},{key:"CurStyleNo",get:function(){return this.GetCurStyleNo()}},{key:"CurParaNo",get:function(){return this.GetCurParaNo()}},{key:"ActiveData",get:function(){return this.FActiveData},set:function(t){this.SetActiveData(t)}},{key:"ActiveArea",get:function(){return this.FActiveArea}},{key:"ActivePageIndex",get:function(){return this.FActivePageIndex}},{key:"ViewModel",get:function(){return this.FViewModel},set:function(t){this.FViewModel!=t&&(this.FViewModel=t,this.SetActiveData(this.FPage))}},{key:"SymmetryMargin",get:function(){return this.FSymmetryMargin},set:function(t){this.FSymmetryMargin=t}},{key:"DisplayFirstPageIndex",get:function(){return this.FDisplayFirstPageIndex},set:function(t){this.FDisplayFirstPageIndex=t}},{key:"DisplayLastPageIndex",get:function(){return this.FDisplayLastPageIndex},set:function(t){this.FDisplayLastPageIndex=t}},{key:"PageCount",get:function(){return this.GetPageCount()}},{key:"PageNoVisible",get:function(){return this.FPageNoVisible},set:function(t){this.FPageNoVisible=t}},{key:"PageNoFrom",get:function(){return this.FPageNoFrom},set:function(t){this.FPageNoFrom=t}},{key:"PageNoFormat",get:function(){return this.FPageNoFormat},set:function(t){this.FPageNoFormat!=t&&(this.FPageNoFormat=t,this.DoActiveDataCheckUpdateInfo())}},{key:"PagePadding",get:function(){return this.FPagePadding},set:function(t){this.FPagePadding=t}},{key:"LineCount",get:function(){return this.FLineCount},set:function(t){this.SetLineCount(t)}},{key:"ReadOnly",get:function(){return this.GetReadOnly()},set:function(t){this.SetReadOnly(t)}}]),i}(tt));function nu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var ou=function(){function t(){r()(this,t),this.FWidth=100,this.FText="",this.onChange=null}return l()(t,[{key:"setWidth",value:function(t){this.FWidth!=t&&(this.FWidth=t,this.doChange())}},{key:"setText",value:function(t){this.FText!=t&&(this.FText=t,this.doChange())}},{key:"doChange",value:function(){null!=this.onChange&&this.onChange(this)}},{key:"width",get:function(){return this.FWidth},set:function(t){this.setWidth(t)}},{key:"text",get:function(){return this.FText},set:function(t){this.setText(t)}}]),t}(),su=function(t){m()(i,t);var e=nu(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).FStatuses=new ot(!0),n}return l()(i,[{key:"DoStatusChange",value:function(t){this.update()}},{key:"paintToEx",value:function(t){if(f()(F()(i.prototype),"paintToEx",this).call(this,t),this.orientation==te&&this.FStatuses.count>0){t.brush.color="#52596b",t.fillRect(nt.Create(2,2,this.leftBtnRect_.left,this.height-2)),t.font.size=8,t.font.color="#d0d1d5",t.font.name=L.DefaultFont,t.font.styles.clear();for(var e=2,n=Math.trunc((this.height-t.font.height)/2),o="",s=0,r=this.FStatuses.count;s<r;s++)o=this.FStatuses[s].text,t.textOut(e,n,o),e+=this.FStatuses[s].width+2}}},{key:"addStatus",value:function(t){var e=this,i=new ou;i.onChange=function(){e.DoStatusChange()},i.width=t,this.FStatuses.add(i);for(var n=0,o=0,s=this.FStatuses.count;o<s;o++)n+=this.FStatuses[o].width;this.leftBlank_=n,this.update()}},{key:"Statuses",get:function(){return this.FStatuses}}]),i}(Di),ru={AnsiText:1,UnicodeText:2,Bitmap:3,JPEG:4,PNG:5,Wave:6,RTF:7,HTML:8,Custom:100},au=function(){function t(){r()(this,t),this._customFormatID=ru.Custom,this._opening=!1,this._formats=new ot,this._datas=new ot}return l()(t,[{key:"_getFormatIndex",value:function(t){for(var e=0;e<this._formats.count;e++)if(this._formats[e]==t)return e;return-1}},{key:"setFormatData",value:function(t,e){var i=this._getFormatIndex(t);i<0?(this._formats.add(t),this._datas.add(e)):(this._formats[i]=t,this._datas[i]=e)}},{key:"removeFormat",value:function(t){var e=this._getFormatIndex(t);e>=0&&(this._formats.delete(e),this._datas.delete(e))}},{key:"hasFormat",value:function(t){return this._getFormatIndex(t)>=0}},{key:"clear",value:function(){this._formats.clear(),this._datas.clear()}},{key:"registerFormat",value:function(){return this._customFormatID++}},{key:"getData",value:function(t){var e=this._getFormatIndex(t);return e>=0?this._datas[e]:null}},{key:"getAnsiText",value:function(){var t=this._getFormatIndex(ru.AnsiText);return t>=0?z.getString(this._datas[t]):null}},{key:"getUnicodeText",value:function(){var t=this._getFormatIndex(ru.UnicodeText);return t>=0?J.getString(this._datas[t]):null}},{key:"getText",value:function(){var t=this.getUnicodeText();return null==t&&(t=this.getAnsiText()),t}},{key:"setText",value:function(t){this.setFormatData(ru.UnicodeText,J.getBytes(t))}},{key:"setEncodeText",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.Utf16;e==R.Ansi?this.setFormatData(ru.AnsiText,z.getBytes(t)):this.setFormatData(ru.UnicodeText,J.getBytes(t))}},{key:"getEncodeText",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.Utf16;switch(t){case R.Ansi:return this.getAnsiText();case R.Unicode:return this.getUnicodeText();default:var e=this._getFormatIndex(ru.UnicodeText);return K.getString(this._datas[e])}}},{key:"toBrowerClipboard",value:function(t){var e=document.createElement("input");try{document.body.appendChild(e),e.setAttribute("value",t),e.setAttribute("readonly","readonly"),e.select(),document.execCommand("copy")}finally{document.body.removeChild(e)}}},{key:"fromBrowerClipboard",value:function(){}}]),t}(),lu=function(){function t(){r()(this,t)}return l()(t,[{key:"removeItem",value:function(t){localStorage.removeItem(t)}},{key:"removeClipboardItem",value:function(){for(var t in E)this.removeItem(E[t])}},{key:"setString",value:function(t,e){localStorage.setItem(t,e)}},{key:"getString",value:function(t){return localStorage.getItem(t)}},{key:"setStream",value:function(t,e){this.setString(t,e.buffer.toString())}},{key:"getStream",value:function(t){for(var e=this.getString(t).split(","),i=new ht,n=0,o=e.length;n<o;n++)i.writeByte(e[n]);return i.position=0,i}},{key:"getBytes",value:function(t){return this.getStream(t).buffer}},{key:"removeKey",value:function(t){localStorage.removeItem(t)}},{key:"hasKey",value:function(t){for(var e=0;e<localStorage.length;e++)if(localStorage.key(e)==t)return!0;return!1}},{key:"clear",value:function(){this.removeClipboardItem()}}]),t}();function hu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var cu=function(t){m()(i,t);var e=hu(i);function i(t,n){var o;r()(this,i),o=e.call(this,t,300,155);var s=new Ki(t,"查找");s.left=20,s.top=10,o.cbbKey=new mn(t,""),o.cbbKey.left=20,o.cbbKey.top=s.bottom+5,o.cbbKey.width=100,o.chkCase=new en(t,"区分大小写"),o.chkCase.left=o.cbbKey.right+5,o.chkCase.top=o.cbbKey.top,o.btnSchPrev=new Ji(t,"查找上一处"),o.btnSchPrev.left=o.cbbKey.left,o.btnSchPrev.top=o.cbbKey.bottom+5,o.btnSchPrev.onClick=function(){n.Search(o.cbbKey.text,!0,o.chkCase.checked)||o.hcl.showMessage("向前查找完成，未到关键字！")},o.btnSchNext=new Ji(t,"查找下一处"),o.btnSchNext.left=o.btnSchPrev.right+10,o.btnSchNext.top=o.btnSchPrev.top,o.btnSchNext.onClick=function(){n.Search(o.cbbKey.text,!1,o.chkCase.checked)||o.hcl.showMessage("向后查找完成，未找到关键字！")};var a=new Ki(t,"替换为");a.left=20,a.top=o.btnSchPrev.bottom+10,o.edtReplace=new on(t,""),o.edtReplace.left=20,o.edtReplace.top=a.bottom+5,o.edtReplace.width=100,o.btnReplace=new Ji(t,"替  换"),o.btnReplace.left=o.edtReplace.right+5,o.btnReplace.top=o.edtReplace.top,o.btnReplace.onClick=function(){""!=o.edtReplace.text?(n.ActiveSection.SelectExists()&&n.Replace(o.edtReplace.text),n.Search(o.cbbKey.text,!1,o.chkCase.checked)||o.hcl.showMessage("向后查找完成，未到关键字！")):o.hcl.showMessage("不能替换为空内容！")},o.beginUpdate();try{o.caption="查找",o.addControl(s),o.addControl(o.cbbKey),o.addControl(o.chkCase),o.addControl(o.btnSchPrev),o.addControl(o.btnSchNext),o.addControl(a),o.addControl(o.edtReplace),o.addControl(o.btnReplace)}finally{o.endUpdate()}return o}return l()(i,[{key:"doPaintBackground_",value:function(t){t.brush.color=this.hcl.theme.backgroundStaticColor,t.fillRectShadow(this.clientRect(),this.hcl.theme.shadow)}},{key:"show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vh;f()(F()(i.prototype),"show",this).call(this,t),this.cbbKey.setFocus()}}]),i}(Dh);function uu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var fu=l()((function t(){r()(this,t),this.DrawRect=new nt,this.AnnotateItem=null,this.Data=null,this.TitleRect=new nt,this.rect=new nt})),du=function(t){m()(i,t);var e=uu(i);function i(){var t;return r()(this,i),(t=e.call(this)).Title,t.Text,t}return l()(i)}(fu),mu=function(){function t(){r()(this,t),this.FDrawAnnotates=new ot,this.FCount=0,this.FMouseIn=!1,this.FActiveReplyIndex=-1,this.FHotAnnotateItem=null,this.FDrawRect=new nt,this.FBtnRect=new nt,this.FOnUpdateView=null,this.OnButtonClick=null}return l()(t,[{key:"GetDrawCount",value:function(){return this.FDrawAnnotates.count}},{key:"GetDrawAnnotateAt",value:function(t,e){return this.GetDrawAnnotateByPt(et.Create(t,e))}},{key:"GetDrawAnnotateByPt",value:function(t){for(var e=0;e<this.FDrawAnnotates.count;e++)if(this.FDrawAnnotates[e].rect.pointIn(t))return e;return-1}},{key:"DoUpdateView",value:function(){null!=this.FOnUpdateView&&this.FOnUpdateView(this)}},{key:"SetActiveDrawAnnotate",value:function(t){if(t>=0){var e=this.FDrawAnnotates[t].AnnotateItem;null!==e&&e.OwnerData.SetActiveAnnotateByID(e.ID)}}},{key:"SetHotDrawAnnotateIndex",value:function(t){var e=null;t>=0&&(e=this.FDrawAnnotates[t].AnnotateItem),this.FHotAnnotateItem!==e&&(null!==this.FHotAnnotateItem&&this.FHotAnnotateItem.OwnerData.SetHotAnnotateByID(0),this.FHotAnnotateItem=e,null!==this.FHotAnnotateItem&&this.FHotAnnotateItem.OwnerData.SetHotAnnotateByID(this.FHotAnnotateItem.ID))}},{key:"PaintDrawAnnotate",value:function(t,e,i,n){if(this.FDrawRect.reset(e.right,e.top,e.right+Yl.AnnotationWidth,e.bottom),n.Print||(this.FMouseIn?i.brush.color="#d0d1d5":i.brush.color="#f4f4f4",i.fillRect(this.FDrawRect)),0!==this.FDrawAnnotates.count){this.FBtnRect.left=-1,this.FBtnRect.right=-1;for(var o=-1,s=-1,r=null,a="",l="",h=t,c=h.GetHeaderAreaHeight(n.PageIndex),u=e.top+c-n.PageDataFmtTop,f=n.PageDataFmtTop-c+u,d=f+h.PaperHeightPix,m=0;m<this.FDrawAnnotates.count&&!((r=this.FDrawAnnotates[m]).DrawRect.top>d);m++)r.DrawRect.bottom>f&&(s=m,o<0&&(o=m));if(!(o<0)){var S;i.font.size=10,i.font.name=L.DefaultFont;var p=new nt,y=new nt;f=this.FDrawAnnotates[o].DrawRect.top;for(var F=o;F<=s;F++){if((r=this.FDrawAnnotates[F]).DrawRect.top>f&&(f=r.DrawRect.top),r instanceof du?(a=r.Title,l=r.Text):(a=r.AnnotateItem.Content.Title,l=r.AnnotateItem.Content.Text),i.font.styles.value=gt,p.reset(0,0,Yl.AnnotationWidth-5-35,0),i.getTextRect(a,p),p.right<Yl.AnnotationWidth-5-35&&(p.right=Yl.AnnotationWidth-5-35),r.TitleRect.resetRect(p),i.font.styles.value=0,y.reset(0,0,Yl.AnnotationWidth-5,0),i.getTextRect(l,y),y.bottom+=p.height,y.right<Yl.AnnotationWidth-5&&(y.right=Yl.AnnotationWidth-5),y.offset(e.right,f),null!==r.AnnotateItem&&r.AnnotateItem.Replys.count>0)for(var v=0;v<r.AnnotateItem.Replys.count;v++)S=r.AnnotateItem.Replys[v],i.font.styles.value=gt,S.TitleRect.reset(y.left+20,y.bottom+5,y.right,0),i.getTextRect(S.Title,S.TitleRect),i.font.styles.value=0,S.Rect.reset(y.left+20,y.bottom+5,y.right,0),i.getTextRect(S.Text,S.Rect),S.Rect.bottom+=S.TitleRect.height,y.bottom=S.Rect.bottom;y.inFlate(0,5),r.rect.resetRect(y),f=r.rect.bottom+10}if(this.FDrawAnnotates[s].rect.bottom>e.bottom){u=this.FDrawAnnotates[s].rect.bottom-e.bottom+5;var I=0,g=-1;f=this.FDrawAnnotates[s].rect.top;for(var C=s;C>=o;C--){if((u-=I=f-this.FDrawAnnotates[C].rect.bottom-5)<=0){g=C+1,u<0&&(I+=u);break}f=this.FDrawAnnotates[C].rect.top}g<0&&(g=o,(I=this.FDrawAnnotates[o].rect.top-e.top-5)>u&&(I=u)),this.FDrawAnnotates[g].rect.offset(0,-I),f=this.FDrawAnnotates[g].rect.bottom+5;for(var w=g+1;w<=s;w++){if(u=f-this.FDrawAnnotates[w].rect.top,this.FDrawAnnotates[w].rect.offset(0,u),null!==this.FDrawAnnotates[w].AnnotateItem)for(var A=0;A<this.FDrawAnnotates[w].AnnotateItem.Replys.count;A++)this.FDrawAnnotates[w].AnnotateItem.Replys[A].Rect.offset(0,u);f=this.FDrawAnnotates[w].rect.bottom+5}}var D=null,P=!1;i.pen.color=h.Page.Style.AnnotateLineColor;for(var k=o;k<=s;k++){if(P=!1,(r=this.FDrawAnnotates[k])instanceof du?(a=r.Title,l=r.Text,D=null,i.pen.style=_t.Dot,i.pen.width=1,i.brush.color=h.Page.Style.BackgroundColor):(a=r.AnnotateItem.Content.Title,l=r.AnnotateItem.Content.Text,(D=r.Data).ActiveAnnotate.EndNo>=0&&r.AnnotateItem==D.ActiveAnnotate.Data.Items[D.ActiveAnnotate.EndNo]?(P=!0,i.pen.style=_t.Solid,i.pen.width=1,r.AnnotateItem.Content.Solve?i.brush.color=h.Page.Style.AnnotateBKActiveSolveColor:i.brush.color=h.Page.Style.AnnotateBKActiveColor):D.HotAnnotate.EndNo>=0&&r.AnnotateItem==D.HotAnnotate.Data.Items[D.HotAnnotate.EndNo]?(P=!1,i.pen.style=_t.Solid,i.pen.width=1,r.AnnotateItem.Content.Solve?i.brush.color=h.Page.Style.AnnotateBKHotSolveColor:i.brush.color=h.Page.Style.AnnotateBKHotColor):(i.pen.style=_t.Dot,i.pen.width=1,r.AnnotateItem.Content.Solve?i.brush.color=h.Page.Style.AnnotateBKSolveColor:i.brush.color=h.Page.Style.AnnotateBKColor)),n.Print&&(i.brush.style=Mt.Clear),i.fillRect(r.rect),i.rectangleRect(r.rect),y.resetRect(r.rect),y.inFlate(-5,-5),i.font.styles.value=gt,i.font.color=Ft.Black,p.resetRect(r.TitleRect),p.offset(y.left,y.top),i.textOutRect(a,p),!P||D.ReadOnly&&!D.Style.ReadOnlyProcessAnnotate||(this.FBtnRect.resetBounds(y.right-24,y.top,24,16),i.font.styles.value=0,i.font.color=Ft.Blue,i.textOut(this.FBtnRect.left,this.FBtnRect.top,"操作"),i.brush.style=Mt.Clear),i.font.styles.value=0,i.font.color="#363636",y.top+=p.height,i.textOutRect(l,y),null!==r.AnnotateItem&&r.AnnotateItem.Replys.count>0)for(var x=new nt,R=0;R<r.AnnotateItem.Replys.count;R++)S=r.AnnotateItem.Replys[R],x.resetRect(S.Rect),i.font.styles.value=gt,i.font.color=Ft.Black,i.textOutRect(S.Title,S.TitleRect),i.font.styles.value=0,i.font.color="#363636",x.top+=S.TitleRect.height,i.textOutRect(S.Text,x);i.brush.style=Mt.Clear,i.beginPath();try{i.moveTo(r.DrawRect.right,r.DrawRect.bottom),i.lineTo(e.right-h.PaperMarginRightPix,r.DrawRect.bottom),i.lineTo(r.rect.left,y.top-p.height)}finally{i.paintPath()}}}}}},{key:"InsertDataAnnotate",value:function(t){this.FCount++}},{key:"RemoveDataAnnotate",value:function(t){this.FCount--}},{key:"AddDrawAnnotate",value:function(t){this.FDrawAnnotates.add(t)}},{key:"ClearDrawAnnotate",value:function(){this.FDrawAnnotates.clear()}},{key:"MouseDown",value:function(t,e,i){if(this.FActiveDrawAnnotateIndex=-1,this.FActiveReplyIndex=-1,this.FMouseIn){var n,o=this.GetDrawAnnotateAt(e,i);if(this.SetActiveDrawAnnotate(o),this.FBtnRect.pointInAt(e,i))null!==this.OnButtonClick&&null!==(n=this.FDrawAnnotates[o]).AnnotateItem&&this.OnButtonClick(n.Data,n.AnnotateItem,t);else if(o>=0){if(null!==(n=this.FDrawAnnotates[o]).AnnotateItem)for(var s=0;s<n.AnnotateItem.Replys.count;s++)if(n.AnnotateItem.Replys[s].Rect.pointInAt(e,i)){this.FActiveReplyIndex=s;break}}}}},{key:"MouseMove",value:function(t,e){this.MouseIn=this.FDrawRect.left<=t&&this.FDrawRect.right>=t;var i=this.GetDrawAnnotateAt(t,e);this.SetHotDrawAnnotateIndex(i)}},{key:"DrawCount",get:function(){return this.GetDrawCount()}},{key:"DrawAnnotates",get:function(){return this.FDrawAnnotates}},{key:"Count",get:function(){return this.FCount}},{key:"DrawRect",get:function(){return this.FDrawRect}},{key:"MouseIn",get:function(){return this.FMouseIn},set:function(t){this.FMouseIn!=t&&(this.FMouseIn=t,this.DoUpdateView())}},{key:"ActiveDrawAnnotateIndex",get:function(){return this.FActiveDrawAnnotateIndex}},{key:"OnUpdateView",get:function(){return this.FOnUpdateView},set:function(t){this.FOnUpdateView=t}}]),t}(),Su={Left:0,Center:1,Right:2},pu=function(t){m()(o,t);var e,i,n=uu(o);function o(t){var e;return r()(this,o),(e=n.call(this,t)).width_=500,e.height_=500,e.color_=t.rgbaToColor(82,89,107),e.canFocus=!0,e.cursor=Ce,e._canvas=document.createElement("canvas"),e._context=e._canvas.getContext("2d"),e.FDataBmpCanvas=new zt(t,e._context),e.FDataBmpCanvas.prepareConext(e.hcl._scale),En.Initialization(t),0==Yl.HCExtFormat&&(Yl.HCExtFormat=e.hcl.clipboard.registerFormat()),e.FUndoList=new ns,e.FUndoList.OnUndo=function(t){e.DoUndo(t)},e.FUndoList.OnRedo=function(t){e.DoRedo(t)},e.FUndoList.OnUndoNew=function(){return e.DoUndoNew()},e.FUndoList.OnUndoGroupStart=function(t,i){return e.DoUndoGroupBegin(t,i)},e.FUndoList.OnUndoGroupEnd=function(t,i){return e.DoUndoGroupEnd(t,i)},e.FUndoList.OnUndoDestroy=function(t){e.DoUndoDestroy(t)},e.FUndoList.OnSeek=function(t){e.DoUnRedoSeek(t)},e.FAnnotatePre=new mu,e.FAnnotatePre.OnUpdateView=function(t){e.DoAnnotatePreUpdateView(t)},e.FAnnotatePre.OnButtonClick=function(t,i,n){e.DoAnnotateButtonClick(t,i,n)},e.FNextAnnotateID=0,e.BKCanvas=document.createElement("canvas"),e.BKContext=e.BKCanvas.getContext("2d"),e.BKImage=null,e.FBKImageVisible=!1,e.BKImagePrintVisible=!1,e.FBKImageLayout=nh.LeftTop,e.FViewAlign=Su.Center,e.FUpdateCount=0,e.FFormatCount=0,e.FFileName="",e.FViewWidth=0,e.FViewHeight=0,e.FViewAdj=!1,e.UseViewAdjData=!0,e.FViewAdjData=null,e.PasteAsTexting=!1,e.FMultiplePage=!1,e.FIsChanged=!1,e.FCanEditChecked=!1,e.FCanEditSnapShot=!1,e.FZoom=1,e.FAutoZoom=!1,e.FPrintView=!1,e.FViewModel=fo.Film,e.FHScrollBarAutoVisible=!1,e.FPagePadding=20,e.ExtrnalCP=!0,e.FStyle=new oo(e.hcl,!0,!0),e.FStyle.OnInvalidateRect=function(t){e.DoStyleInvalidateRect(t)},e.FStyle.MultiplePage=e.FMultiplePage,e.FSections=new ot,e.FSections.add(e.NewDefaultSection()),e.FActiveSectionIndex=0,e.FDisplayFirstSection=0,e.FDisplayLastSection=0,e.FAutoScrolTimer=null,e.FVScrollBar=new zc(t),e.FVScrollBar.orientation=ee,e.FVScrollBar.align=Yt,e.FVScrollBar.onScroll=function(t,i,n){e.DoVerScroll(t,i,n)},e.FVScrollBar.OnPageUpClick=function(t){e.DoPageUp(t)},e.FVScrollBar.OnPageDownClick=function(t){e.DoPageDown(t)},e.FHScrollBar=new su(t),e.FHScrollBar.orientation=te,e.FHScrollBar.addStatus(100),e.FHScrollBar.align=Yt,e.FHScrollBar.onScroll=function(t,i,n){e.DoHorScroll(t,i,n)},e.controls.add(e.FHScrollBar),e.controls.add(e.FVScrollBar),e.btnInfo=new ji(t,""),e.btnInfo.textVisible=!1,e.btnInfo.image.src=e.hcl.application.icon.src,e.btnInfo.onClick=function(){null!=e.ShowCopyRight?e.ShowCopyRight():e.hcl.showMessage("欢迎使用HCView！")},e.controls.add(e.btnInfo),e.handle_=e.hcl.handleAllocate(),e.FCaret=new dh(t),e.FCaret.Width=2,e.FCaret.control=Jt()(e),e.imeMode=_i,e.FFrmSearch=null,e.CopyAdd=!1,e.CopyMark="",e.OnCaretChange=null,e.OnVerScroll=null,e.OnHorScroll=null,e.OnSectionCreateItem=null,e.OnSectionReadOnlySwitch=null,e.OnSectionCurParaNoChange=null,e.OnSectionActivePageChange=null,e.OnSectionCreateStyleItem=null,e.OnSectionCaretItemChanged=null,e.OnSectionDataDomainSwitch=null,e.OnSectionCanEditDataItem=null,e.OnCanNotEditNotify=null,e.OnSectionInsertTextBefor=null,e.OnSectionInsertItem=null,e.OnSectionRemoveItem=null,e.OnSectionDrawItemMouseMove=null,e.OnSectionSaveItem=null,e.OnSectionAcceptActionBefor=null,e.OnSectionAcceptAction=null,e.OnSectionDataItemChange=null,e.OnSectionDataDomainChange=null,e.OnSectionDrawItemPaintAfter=null,e.OnSectionDrawItemPaintBefor=null,e.OnSectionFloatItemPaintAfter=null,e.OnSectionDomainDrawItemPaintBefor=null,e.OnSectionDomainDrawItemPaintAfter=null,e.OnSectionDataSelectApplyTextStyle=null,e.OnSectionPaintHeaderBefor=null,e.OnSectionPaintHeaderAfter=null,e.OnSectionPaintFooterBefor=null,e.OnSectionPaintFooterAfter=null,e.OnSectionPaintPageBefor=null,e.OnSectionPaintPageAfter=null,e.OnSectionPaintPaperBefor=null,e.OnSectionPaintPaperAfter=null,e.OnSectionDataSelectBound=null,e.OnSectionSetActiveDataBefor=null,e.OnPaintViewBefor=null,e.OnPaintViewAfter=null,e.OnChange=null,e.OnChangedSwitch=null,e.OnZoomChanged=null,e.OnViewResize=null,e.OnSectionCheckInsertItemCount=null,e.OnStyleLoaded=null,e.OnCalcScrollRange=null,e.OnMouseUp=null,e.OnSectionItemMouseUp=null,e.OnAnnotateButtonClick=null,e.OnUnRedoSeek=null,e.CalcScrollRang(),e}return l()(o,[{key:"dispose",value:function(){this.FStyle.States.Include(oh.Destroying),f()(F()(o.prototype),"dispose",this).call(this)}},{key:"SetPrintBySectionInfo",value:function(t,e){}},{key:"GetViewWidth",value:function(){this.FVScrollBar.visible?this.FViewWidth=this.width-this.FVScrollBar.width:this.FViewWidth=this.width}},{key:"GetViewHeight",value:function(){this.FHScrollBar.visible?this.FViewHeight=this.height-this.FHScrollBar.height:this.FViewHeight=this.height}},{key:"GetSymmetryMargin",value:function(){return this.ActiveSection.SymmetryMargin}},{key:"SetSymmetryMargin",value:function(t){this.ActiveSection.SymmetryMargin!=t&&(this.ActiveSection.SymmetryMargin=t,this.FStyle.UpdateInfoRePaint(),this.FStyle.UpdateInfoReCaret(!1),this.DoMapChanged(),this.DoViewResize())}},{key:"SetViewAlign",value:function(t){this.FViewAlign!==t&&(this.FViewAlign=t,this.FStyle.UpdateInfoRePaint(),this.FStyle.UpdateInfoReCaret(!1),this.DoMapChanged(),this.DoViewResize())}},{key:"SetBKImage",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"png";t.Base64&&(null===this.BKImage&&(this.BKImage=new Wi(this.hcl)),this.BKImage.onImageLoaded=function(t,i){e.UpdateView()},0!=t.Base64.indexOf("data:")?this.BKImage.src="data:image/"+i+";base64,"+t.Base64:this.BKImage.src=t.Base64)}},{key:"SetBKImageVisible",value:function(t){this.FBKImageVisible!=t&&(this.FBKImageVisible=t,this.UpdateView())}},{key:"SetBKImageLayout",value:function(t){this.FBKImageLayout!=t&&(this.FBKImageLayout=t,this.UpdateView())}},{key:"DoCalcScrollRange",value:function(t,e,i,n){null!==this.OnCalcScrollRange&&this.OnCalcScrollRange(t,e,i,n)}},{key:"DoVerScroll",value:function(t,e,i){this.FStyle.UpdateInfoRePaint(),this.FStyle.UpdateInfoReCaret(!1),this.CheckUpdateInfo(),this.GetPagesAndActive(),null!=this.OnVerScroll&&this.OnVerScroll(this),this.DoCalcScrollRange(-1,this.FVScrollBar.position,-1,-1)}},{key:"DoHorScroll",value:function(t,e,i){this.FStyle.UpdateInfoRePaint(),this.FStyle.UpdateInfoReCaret(!1),this.CheckUpdateInfo(),null!=this.OnHorScroll&&this.OnHorScroll(this),this.DoCalcScrollRange(-1,-1,-1,this.FHScrollBar.position)}},{key:"DoSectionDataChange",value:function(t){this.DoChange()}},{key:"DoSetChange",value:function(){this.FCanEditChecked=!1,this.SetIsChanged(!0),null!=this.OnChange&&this.OnChange(this)}},{key:"DoSectionChangeTopLevelData",value:function(t){this.DoViewResize()}},{key:"DoSectionDataCheckUpdateInfo",value:function(t){this.CheckUpdateInfo()}},{key:"DoLoadFromStream",value:function(t,e,i,n){var o=this;e.position=0;var s=Yl._LoadFileFormatAndVersion(e),r=s.fileExt,a=s.fileVersion;if(r!=Yl.HC_EXT&&this.hcl.exception("加载失败，仅支持"+Yl.HC_EXT+"文件！实际为"+r+"文件"),a>Yl.HC_FileVersionInt&&this.hcl.exception("加载失败，当前编辑器最高支持版本为"+Yl.HC_FileVersionInt.toString()+"的文件，无法打开版本为"+a.toString()+"的文件！"),a>59&&e.readByte()!=Yl.HC_STREAM_VIEW)this.hcl.exception("加载失败，调用DoLoadFromStream时传递的数据不是VIEW类型！");else{if(this.DoLoadStreamBefor(e,a),i.LoadFromStream(e,a),this.DoLoadMutMargin(e,i,a),null!=this.OnStyleLoaded&&this.OnStyleLoaded(i,a),a>55){var l=e.readByte();this.FBKImageVisible=L.isOdd(l>>7),this.BKImagePrintVisible=L.isOdd(l>>6),this.FBKImageLayout=e.readByte(),this.BKImage=Yl.HCLoadImageFromStream(this.hcl,e),null!=this.BKImage&&(this.BKImage.onImageLoaded=function(t,e){o.UpdateView()})}else this.BKImage=null;this.FNextAnnotateID=a>66?e.readUInt32():100,t&&(this.FStyle.MergeStyle=!0);try{n(a,s.lang)}finally{t&&(this.FStyle.MergeStyle=!1)}this.DoLoadStreamAfter(e,a),this.DoLoadFinish(),this.DoMapChanged()}}},{key:"DoUndoNew",value:function(){var t=new Xo;return t.SectionIndex=this.FActiveSectionIndex,t.HScrollPos=this.FHScrollBar.position,t.VScrollPos=this.FVScrollBar.position,t.Data=this.ActiveSection.ActiveData,t}},{key:"DoUndoGroupBegin",value:function(t,e){var i=new $o;return i.SectionIndex=this.FActiveSectionIndex,i.HScrollPos=this.FHScrollBar.position,i.VScrollPos=this.FVScrollBar.position,i.Data=this.ActiveSection.ActiveData,i.CaretDrawItemNo=this.ActiveSection.ActiveData.CaretDrawItemNo,i}},{key:"DoUndoGroupEnd",value:function(t,e){var i=new is;return i.SectionIndex=this.FActiveSectionIndex,i.HScrollPos=this.FHScrollBar.position,i.VScrollPos=this.FVScrollBar.position,i.Data=this.ActiveSection.ActiveData,i.CaretDrawItemNo=this.ActiveSection.ActiveData.CaretDrawItemNo,i}},{key:"DoUnRedoSeek",value:function(t){null!==this.OnUnRedoSeek&&this.OnUnRedoSeek(t,this.FUndoList.count)}},{key:"DoUndo",value:function(t){(t instanceof Xo||t instanceof $o)&&(this.FActiveSectionIndex!=t.SectionIndex&&this.SetActiveSectionIndex(t.SectionIndex),this.FHScrollBar.position=t.HScrollPos,this.FVScrollBar.position=t.VScrollPos),this.ActiveSection.Undo(t)}},{key:"DoRedo",value:function(t){(t instanceof Xo||t instanceof is)&&(this.FActiveSectionIndex!=t.SectionIndex&&this.SetActiveSectionIndex(t.SectionIndex),this.FHScrollBar.position=t.HScrollPos,this.FVScrollBar.position=t.VScrollPos),this.ActiveSection.Redo(t)}},{key:"DoUndoDestroy",value:function(t){}},{key:"DoViewResize",value:function(){null!=this.OnViewResize&&this.OnViewResize(this)}},{key:"DoMapChanged",value:function(){0==this.FUpdateCount&&(this.CalcScrollRang(),this.CheckUpdateInfo())}},{key:"DoSectionReadOnlySwitch",value:function(t){null!=this.OnSectionReadOnlySwitch&&this.OnSectionReadOnlySwitch(this)}},{key:"DoSectionGetScreenCoord",value:function(t,e){var i=this.clientToScreen(et.Create(t,e));return et.Create(this.ZoomIn(i.x),this.ZoomIn(i.y))}},{key:"DoSectionCheckInsertItemCount",value:function(t,e,i){return null!==this.OnSectionCheckInsertItemCount?this.OnSectionCheckInsertItemCount(t,e,i):0}},{key:"DoSectionItemResize",value:function(t,e){this.DoViewResize()}},{key:"DoSectionDrawItemAnnotate",value:function(t,e,i,n,o){if(this.AnnotateVisible){var s=new fu;s.Data=e,s.DrawRect.resetRect(n),s.AnnotateItem=o,this.FAnnotatePre.AddDrawAnnotate(s)}}},{key:"DoSectionGetUndoList",value:function(){return this.FUndoList}},{key:"DoSectionInsertAnnotate",value:function(t,e,i){this.FAnnotatePre.InsertDataAnnotate(i)}},{key:"DoSectionRemoveAnnotate",value:function(t,e,i){this.FAnnotatePre.RemoveDataAnnotate(i)}},{key:"DoSectionCurParaNoChange",value:function(t){null!=this.OnSectionCurParaNoChange&&this.OnSectionCurParaNoChange(t)}},{key:"DoSectionActivePageChange",value:function(t){null!=this.OnSectionActivePageChange&&this.OnSectionActivePageChange(t)}},{key:"DoStyleInvalidateRect",value:function(t){t?this.UpdateViewRect(t):this.UpdateView()}},{key:"DoAnnotateButtonClick",value:function(t,e,i){null!==this.OnAnnotateButtonClick&&this.OnAnnotateButtonClick(t,e,i)}},{key:"DoAnnotatePreUpdateView",value:function(t){this.AnnotateDisplay()?(this.FStyle.UpdateInfoRePaint(),this.DoMapChanged()):this.UpdateView()}},{key:"NewDefaultSection",value:function(){var t=this,e=this.DoCreateSection();return e.OnDataChange=function(e){t.DoSectionDataChange(e)},e.OnDataSetChange=function(){t.DoSetChange()},e.OnDataItemChange=function(e,i,n,o,s){return t.DoSectionDataItemChange(e,i,n,o,s)},e.OnDataDomainChange=function(e,i,n,o,s){return t.DoSectionDataDomainChange(e,i,n,o,s)},e.OnDataSelectApplyTextStyle=function(e,i,n){return t.DoSectionDataSelectApplyTextStyle(e,i,n)},e.OnChangeTopLevelData=function(e){t.DoSectionChangeTopLevelData(e)},e.OnCheckUpdateInfo=function(e){t.DoSectionDataCheckUpdateInfo(e)},e.OnCreateItem=function(e){t.DoSectionCreateItem(e)},e.OnDataAcceptActionBefor=function(e,i,n,o,s){return t.DoSectionAcceptActionBefor(e,i,n,o,s)},e.OnDataAcceptAction=function(e,i,n,o,s){return t.DoSectionAcceptAction(e,i,n,o,s)},e.OnCreateItemByStyle=function(e,i){return t.DoSectionCreateStyleItem(e,i)},e.OnPaintDomainRegion=function(e,i,n){return t.DoSectionPaintDomainRegion(e,i,n)},e.OnMatchTextStyleNoAt=function(e,i,n){return t.DoSectionMatchTextStyleNoAt(e,i,n)},e.OnCanEditDataItem=function(e,i,n){return t.DoSectionCanEditDataItem(e,i,n)},e.OnCanNotEditNotify=function(e){t.DoSectionCanNotEditNotify(e)},e.OnInsertTextBefor=function(e,i,n,o){return t.DoSectionInsertTextBefor(e,i,n,o)},e.OnInsertItem=function(e,i,n){t.DoSectionInsertItem(e,i,n)},e.OnRemoveItem=function(e,i,n){t.DoSectionRemoveItem(e,i,n)},e.OnSaveItem=function(e,i,n){return t.DoSectionSaveItem(e,i,n)},e.OnItemMouseUp=function(e,i,n,o,s){t.DoSectionItemMouseUp(e,i,n,o,s)},e.OnItemMouseDown=function(e,i,n,o,s){t.DoSectionItemMouseDown(e,i,n,o,s)},e.OnDrawItemMouseMove=function(e,i,n,o,s,r){t.DoSectionDrawItemMouseMove(e,i,n,o,s,r)},e.OnItemResize=function(e,i){t.DoSectionItemResize(e,i)},e.OnReadOnlySwitch=function(e){t.DoSectionReadOnlySwitch(e)},e.OnGetScreenCoord=function(e,i){return t.DoSectionGetScreenCoord(e,i)},e.OnCheckInsertItemCount=function(e,i,n){return t.DoSectionCheckInsertItemCount(e,i,n)},e.OnDrawItemPaintAfter=function(e,i,n,o,s,r,a,l,h,c,u,f,d){t.DoSectionDrawItemPaintAfter(e,i,n,o,s,r,a,l,h,c,u,f,d)},e.OnDrawItemPaintBefor=function(e,i,n,o,s,r,a,l,h,c,u,f,d){t.DoSectionDrawItemPaintBefor(e,i,n,o,s,r,a,l,h,c,u,f,d)},e.OnPaintHeaderBefor=function(e,i,n,o,s){t.DoSectionPaintHeaderBefor(e,i,n,o,s)},e.OnPaintHeaderAfter=function(e,i,n,o,s){t.DoSectionPaintHeaderAfter(e,i,n,o,s)},e.OnPaintFooterBefor=function(e,i,n,o,s){t.DoSectionPaintFooterBefor(e,i,n,o,s)},e.OnPaintFooterAfter=function(e,i,n,o,s){t.DoSectionPaintFooterAfter(e,i,n,o,s)},e.OnPaintPageBefor=function(e,i,n,o,s){t.DoSectionPaintPageBefor(e,i,n,o,s)},e.OnPaintPageAfter=function(e,i,n,o,s){t.DoSectionPaintPageAfter(e,i,n,o,s)},e.OnPaintPaperBefor=function(e,i,n,o,s){t.DoSectionPaintPaperBefor(e,i,n,o,s)},e.OnPaintPaperAfter=function(e,i,n,o,s){t.DoSectionPaintPaperAfter(e,i,n,o,s)},e.OnInsertAnnotate=function(e,i,n){t.DoSectionInsertAnnotate(e,i,n)},e.OnRemoveAnnotate=function(e,i,n){t.DoSectionRemoveAnnotate(e,i,n)},e.OnDrawItemAnnotate=function(e,i,n,o,s){t.DoSectionDrawItemAnnotate(e,i,n,o,s)},e.OnRequestAnnotateID=function(){return t.GetNextAnnotateID()},e.OnGetUndoList=function(){return t.DoSectionGetUndoList()},e.OnCurParaNoChange=function(e){t.DoSectionCurParaNoChange(e)},e.OnCaretItemChanged=function(e,i,n){t.DoSectionCaretItemChanged(e,i,n)},e.OnDataDomainSwitch=function(e,i,n,o){t.DoSectionDataDomainSwitch(e,i,n,o)},e.OnActivePageChange=function(e){t.DoSectionActivePageChange(e)},e.OnFloatItemPaintAfter=function(e,i,n,o,s){t.DoSectionFloatItemPaintAfter(e,i,n,o,s)},e.OnDataSelectBound=function(e,i){null!==t.OnSectionDataSelectBound&&t.OnSectionDataSelectBound(e,i)},e.OnSetActiveDataBefor=function(e,i,n){return null===t.OnSectionSetActiveDataBefor||t.OnSectionSetActiveDataBefor(e,i,n)},this.hcl.hc.DOMAINPAINTEVENT&&(e.OnDomainDrawItemPaintBefor=function(e,i,n,o,s,r,a){t.DoSectionDomainDrawItemPaintBefor(e,i,n,o,s,r,a)},e.OnDomainDrawItemPaintAfter=function(e,i,n,o,s,r,a){t.DoSectionDomainDrawItemPaintAfter(e,i,n,o,s,r,a)}),e}},{key:"GetViewRect",value:function(){return nt.CreateByBounds(0,0,this.FViewWidth,this.FViewHeight)}},{key:"ZoomResize",value:function(t){t&&(this.AnnotateDisplay()?this.FZoom=(this.FViewWidth-2*this.FPagePadding)/(this.ActiveSection.PaperWidthPix+Yl.AnnotationWidth):this.FZoom=(this.FViewWidth-2*this.FPagePadding)/this.ActiveSection.PaperWidthPix),this.FZoom<0&&(this.FZoom=1),null!==this.OnZoomChanged&&this.OnZoomChanged(this),this.CalcScrollRang(),this.FStyle.UpdateInfoRePaint(),null!=this.FCaret&&this.FStyle.UpdateInfoReCaret(!1),this.CheckUpdateInfo()}},{key:"GetPageIndexFilmTop",value:function(t){var e=this.GetSectionPageIndexByPageIndex(t,-1),i=e.pageIndex,n=e.result,o=this.GetSectionTopFilm(n);if(i>0)if(this.FSections[n].ViewModel==fo.Film)o+=i*(this.FPagePadding+this.FSections[n].PaperHeightPix);else for(var s=0;s<i;s++)o+=this.FSections[n].GetPageHeight(s);return o}},{key:"DoPageUp",value:function(t){var e=this.GetPagePreviewFirst();this.FVScrollBar.position=e>0?this.GetPageIndexFilmTop(e-1):0}},{key:"DoPageDown",value:function(t){var e=this.GetPagePreviewFirst();e<this.GetPageCount()-1?this.FVScrollBar.position=this.GetPageIndexFilmTop(e+1):this.FVScrollBar.position=this.FVScrollBar.max}},{key:"ReBuildCaret",value:function(){if(null!=this.FCaret){if(!this.FStyle.UpdateInfo.DragingSelected&&this.ActiveSection.SelectExists()){if(this.ActiveSectionTopLevelData().SelectRectItemTheory()){var t=new fh;t.Init(),this.ActiveSection.GetPageCaretInfo(t)}return this.FCaret.Hide(),void this.DoCaretChange()}var e=new fh;if(e.Init(),this.ActiveSection.GetPageCaretInfo(e),this.FStyle.UpdateInfo.DragingSelected);else if(!this.focused||!e.Visible)return void this.FCaret.Hide();if(this.FMultiplePage?(this.FVScrollBar.SetAreaPos(-1,e.Y,e.Height),this.FCaret.X=this.ZoomIn(e.X)-this.FHScrollBar.position,this.FCaret.Y=this.ZoomIn(e.Y)-this.FVScrollBar.position):(e.Y+=this.GetSectionTopFilm(this.FActiveSectionIndex),this.FVScrollBar.SetAreaPos(-1,e.Y,e.Height),this.FCaret.X=this.ZoomIn(this.GetSectionDrawLeft(this.FActiveSectionIndex)+e.X)-this.FHScrollBar.position,this.FCaret.Y=this.ZoomIn(e.Y)-this.FVScrollBar.position),this.FCaret.Height=this.ZoomIn(e.Height),this.FStyle.UpdateInfo.ReScroll){if(this.FCaret.Height<this.FViewHeight){if(!this.FCaret.VScroll){this.FCaret.VScroll=!0;try{this.FCaret.Y<0?this.FVScrollBar.position=this.FVScrollBar.position+this.FCaret.Y-this.FPagePadding:this.FCaret.Y+this.FCaret.Height+this.FPagePadding>this.FViewHeight&&(this.FVScrollBar.position=this.FVScrollBar.position+this.FCaret.Y+this.FCaret.Height+this.FPagePadding-this.FViewHeight)}finally{this.FCaret.VScroll=!1}}if(!this.FCaret.HScroll){this.FCaret.HScroll=!0;try{this.FCaret.X<0?this.FHScrollBar.position=this.FHScrollBar.position+this.FCaret.X-this.FPagePadding:this.FCaret.X+this.FPagePadding>this.FViewWidth&&(this.FHScrollBar.position=this.FHScrollBar.position+this.FCaret.X+this.FPagePadding-this.FViewWidth)}finally{this.FCaret.HScroll=!1}}}}else{if(this.FCaret.X<0||this.FCaret.X>this.FViewWidth)return void this.FCaret.Hide();if(this.FCaret.Y+this.FCaret.Height<0||this.FCaret.Y>this.FViewHeight)return void this.FCaret.Hide()}this.FCaret.VScroll||this.FCaret.HScroll||(this.FCaret.Y+this.FCaret.Height>this.FViewHeight&&(this.FCaret.Height=this.FViewHeight-this.FCaret.Y),this.FCaret.Show(),this.DoCaretChange())}}},{key:"GetSectionByCrood",value:function(t,e,i){i=-1;var n=0;if(this.FMultiplePage&&this.FViewModel===fo.Film){var o=0,s=0;i=this.FSections.count-1;for(var r=0;r<this.FSections.count;r++){o=this.ZoomIn(this.FPagePadding+this.FSections[r].PaperWidthPix),s=this.ZoomIn(this.FPagePadding+this.FSections[r].PaperHeightPix);for(var a=0;a<this.FSections[r].PageCount;a++)if(this.FSections[r].Pages[a].FilmLeft+o>t&&this.FSections[r].Pages[a].FilmTop+s>e){i=r;break}if(i>=0)break}return i}for(var l=0;l<=this.FSections.count-1;l++)if((n+=this.FSections[l].GetFilmHeight())>e){i=l;break}return i<0&&n+this.FPagePadding>=e&&(i=this.FSections.count-1),i<0&&(i=0),i}},{key:"SetZoom",value:function(t){var e=t;e<.25?e=.25:e>5&&(e=5),this.FZoom!=e&&(this.FZoom=e,this.ZoomResize(!1),this.DoViewResize())}},{key:"GetHScrollValue",value:function(){return this.FHScrollBar.position}},{key:"GetCurStyleNo",value:function(){return this.ActiveSection.CurStyleNo}},{key:"GetCurParaNo",value:function(){return this.ActiveSection.CurParaNo}},{key:"GetShowLineActiveMark",value:function(){return this.FSections[0].Page.ShowLineActiveMark}},{key:"SetShowLineActiveMark",value:function(t){for(var e=0;e<=this.FSections.count-1;e++)this.FSections[e].Page.ShowLineActiveMark=t;this.UpdateView()}},{key:"GetShowLineNo",value:function(){return this.FSections[0].Page.ShowLineNo}},{key:"SetShowLineNo",value:function(t){for(var e=0;e<=this.FSections.count-1;e++)this.FSections[e].Page.ShowLineNo=t;this.UpdateView()}},{key:"GetShowUnderLine",value:function(){return this.FSections[0].Page.ShowUnderLine}},{key:"SetShowUnderLine",value:function(t){for(var e=0;e<=this.FSections.count-1;e++)this.FSections[e].Page.ShowUnderLine=t;this.UpdateView()}},{key:"GetReadOnly",value:function(){for(var t=0;t<=this.FSections.count-1;t++)if(!this.FSections[t].ReadOnly)return!1;return!0}},{key:"SetReadOnly",value:function(t){for(var e=0;e<=this.FSections.count-1;e++)this.FSections[e].ReadOnly=t;this.UpdateView()}},{key:"SetViewModel",value:function(t){if(this.FViewModel!=t){this.FViewModel=t;for(var e=0;e<=this.FSections.count-1;e++)this.FSections[e].ViewModel=t;this.PagePadding=t==fo.Film?20:0}}},{key:"SetMultiplePage",value:function(t){this.FMultiplePage!==t&&(this.FMultiplePage=t,this.FStyle.MultiplePage=t,this.FStyle.UpdateInfoRePaint(),this.FStyle.UpdateInfoReCaret(!1),this.DoMapChanged(),this.DoViewResize())}},{key:"SetPrintView",value:function(t){this.FPrintView!=t&&(this.FPrintView=t,t&&!this.ReadOnly&&(this.ReadOnly=!0),this.UpdateView())}},{key:"SetActiveSectionIndex",value:function(t){this.FActiveSectionIndex!=t&&(this.FActiveSectionIndex>=0&&this.FSections[this.FActiveSectionIndex].DisActive(),this.FActiveSectionIndex=t,this.DoViewResize())}},{key:"SetIsChanged",value:function(t){this.FIsChanged!=t&&(this.FIsChanged=t,null!=this.OnChangedSwitch&&this.OnChangedSwitch(this))}},{key:"SetPagePadding",value:function(t){if(this.FPagePadding!=t){this.FPagePadding=t;for(var e=0;e<=this.FSections.count-1;e++)this.FSections[e].PagePadding=this.FPagePadding;this.FStyle.UpdateInfoRePaint(),this.FStyle.UpdateInfoReCaret(!1),this.DoMapChanged(),this.DoViewResize()}}},{key:"SetAutoZoom",value:function(t){this.FAutoZoom!==t&&(this.FAutoZoom=t,this.ZoomResize(t))}},{key:"GetActiveSection",value:function(){return this.FSections[this.FActiveSectionIndex]}},{key:"AutoScrollTimer",value:function(t){var e=this;t?(null===this.FAutoScrolTimer&&(this.FAutoScrolTimer=new ct(200),this.FAutoScrolTimer.onTimer=function(){var t=et.CreateByPoint(e.hcl.cursorPos);(t=e.screenToClient(t)).y>e.height-(e.FHScrollBar.visible?e.FHScrollBar.height:0)?e.FVScrollBar.position+=60:t.y<0&&(e.FVScrollBar.position-=60),t.x>e.width-(e.FVScrollBar.visible?e.FVScrollBar.width:0)?e.FHScrollBar.position+=60:t.x<0&&(e.FHScrollBar.position-=60)}),this.FAutoScrolTimer.enabled=!0):null!==this.FAutoScrolTimer&&(this.FAutoScrolTimer.enabled=!1)}},{key:"GetPagesAndActive",value:function(){this.FHScrollBar.Statuses[0].text="预览"+(this.PagePreviewFirst+1).toString()+" 光标"+(this.ActivePageIndex+1).toString()+"/"+this.PageCount.toString()+"页"}},{key:"ResetCanEditShot",value:function(){this.FCanEditChecked=!1,this.FCanEditSnapShot=!1}},{key:"GetNextAnnotateID",value:function(){return this.FNextAnnotateID++,this.FNextAnnotateID}},{key:"doContextMenu_",value:function(t,e){if(this.popupMenu){var i=this.clientToScreen(new et(0,0));this.popupMenu.popup(i.x+t,i.y+e)}}},{key:"controlVisible_",value:function(t,e){f()(F()(o.prototype),"controlVisible_",this).call(this,t,e),t!==this.FHScrollBar&&t!==this.FVScrollBar||this.doResize_()}},{key:"doPaint_",value:function(t){if(this.UseViewAdjData)if(this.FViewAdj){this.FViewAdjData=this._context.getImageData(0,0,this._canvas.width,this._canvas.height);var e=this.clientToScreenAt(0,0);t.h5context.putImageData(this.FViewAdjData,e.x*this.hcl.dprScale,e.y*this.hcl.dprScale)}else t.h5context.drawImage(this._canvas,0,0,this.FViewWidth*this.hcl.dprScale,this.FViewHeight*this.hcl.dprScale,0,0,this.FViewWidth,this.FViewHeight);else t.h5context.drawImage(this._canvas,0,0,this.FViewWidth*this.hcl.dprScale,this.FViewHeight*this.hcl.dprScale,0,0,this.FViewWidth,this.FViewHeight);t.brush.color=this.color,t.fillBounds(this.FVScrollBar.left,this.FHScrollBar.top,this.FVScrollBar.width,this.FHScrollBar.height),f()(F()(o.prototype),"doPaint_",this).call(this,t)}},{key:"doSetBounds_",value:function(){this.FHScrollBar.top=this.height-this.FHScrollBar.height,this.FHScrollBar.width=this.width-this.FVScrollBar.width,this.FHScrollBarAutoVisible&&(this.FHScrollBar.visible=this.FHScrollBar.pageSize<this.FHScrollBar.range),this.FVScrollBar.left=this.width-this.FVScrollBar.width,this.FVScrollBar.height=this.height-this.FHScrollBar.height,this.btnInfo.left=this.FVScrollBar.left,this.btnInfo.top=this.FHScrollBar.top,f()(F()(o.prototype),"doSetBounds_",this).call(this)}},{key:"broadcast",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;f()(F()(o.prototype),"broadcast",this).call(this,t,e,i),t===hi&&this.doResize_()}},{key:"doResize_",value:function(){if(f()(F()(o.prototype),"doResize_",this).call(this),this.GetViewWidth(),this.GetViewHeight(),this.FViewAdj=!1,this.FViewWidth>0&&this.FViewHeight>0){var t=this.FViewWidth*this.hcl.dprScale;parseInt(t)!==parseFloat(t)&&(this.FViewAdj=!0),t=this.FViewHeight*this.hcl.dprScale,parseInt(t)!==parseFloat(t)&&(this.FViewAdj=!0),this._canvas.style.width=this.FViewWidth+"px",this._canvas.style.height=this.FViewHeight+"px",this._canvas.width=this.FViewWidth*this.hcl.dprScale,this._canvas.height=this.FViewHeight*this.hcl.dprScale,this._context=this._canvas.getContext("2d"),this.FDataBmpCanvas=new zt(this.hcl,this._context),this.FDataBmpCanvas.prepareConext(this.hcl._scale,this.hcl.dprScale)}this.ZoomResize(this.FAutoZoom),this.DoViewResize()}},{key:"doKillFocus_",value:function(){f()(F()(o.prototype),"doKillFocus_",this).call(this),this.DoKillFocus()}},{key:"DoChange",value:function(){this.DoMapChanged(),this.DoSetChange()}},{key:"DoCaretChange",value:function(){this.GetPagesAndActive(),null!==this.OnCaretChange&&this.OnCaretChange(this,null)}},{key:"DoKillFocus",value:function(){null!==this.FCaret&&(this.FCaret.Hide(!0),this.UpdateViewRect(nt.CreateByBounds(this.FCaret.X-1,this.FCaret.Y,this.FCaret.Width+1,this.FCaret.Height)))}},{key:"DoSectionCreateItem",value:function(t){null!=this.OnSectionCreateItem&&this.OnSectionCreateItem(this)}},{key:"DoSectionAcceptActionBefor",value:function(t,e,i,n,o){return null!=this.OnSectionAcceptActionBefor&&this.OnSectionAcceptActionBefor(t,e,i,n,o)}},{key:"DoSectionAcceptAction",value:function(t,e,i,n,o){return null==this.OnSectionAcceptAction||this.OnSectionAcceptAction(t,e,i,n,o)}},{key:"DoSectionDataItemChange",value:function(t,e,i,n,o){return null!==this.OnSectionDataItemChange&&this.OnSectionDataItemChange(t,e,i,n,o)}},{key:"DoSectionDataDomainChange",value:function(t,e,i,n,o){return null!==this.OnSectionDataDomainChange&&this.OnSectionDataDomainChange(t,e,i,n,o)}},{key:"DoSectionDataSelectApplyTextStyle",value:function(t,e,i){return null===this.OnSectionDataSelectApplyTextStyle||this.OnSectionDataSelectApplyTextStyle(t,e,i)}},{key:"DoSectionCreateStyleItem",value:function(t,e){return null!=this.OnSectionCreateStyleItem?this.OnSectionCreateStyleItem(t,e):null}},{key:"DoSectionPaintDomainRegion",value:function(t,e,i){return!0}},{key:"DoSectionMatchTextStyleNoAt",value:function(t,e,i){return oo.Null}},{key:"DoSectionCaretItemChanged",value:function(t,e,i){null!==this.OnSectionCaretItemChanged&&this.OnSectionCaretItemChanged(t,e,i)}},{key:"DoSectionDataDomainSwitch",value:function(t,e,i,n){null!==this.OnSectionDataDomainSwitch&&this.OnSectionDataDomainSwitch(t,e,i,n)}},{key:"DoSectionCreateFloatStyleItem",value:function(t,e){return null!=this.FOnSectionCreateFloatStyleItem?this.FOnSectionCreateFloatStyleItem(t,e):null}},{key:"DoSectionInsertItem",value:function(t,e,i){null!=this.OnSectionInsertItem&&this.OnSectionInsertItem(t,e,i)}},{key:"DoSectionRemoveItem",value:function(t,e,i){null!=this.OnSectionRemoveItem&&this.OnSectionRemoveItem(t,e,i)}},{key:"DoSectionSaveItem",value:function(t,e,i){return!(this.FStyle.States.Contain(oh.Copying)&&!e.Items[i].Visible)&&(null==this.OnSectionSaveItem||this.OnSectionSaveItem(t,e,i))}},{key:"DoSectionItemMouseDown",value:function(t,e,i,n,o){}},{key:"DoSectionItemMouseUp",value:function(t,e,i,n,o){null!==this.OnSectionItemMouseUp&&this.OnSectionItemMouseUp(t,e,i,n,o)}},{key:"DoSectionDrawItemMouseMove",value:function(t,e,i,n,o,s){null!=this.OnSectionDrawItemMouseMove&&this.OnSectionDrawItemMouseMove(t,e,i,n,o,s)}},{key:"DoSectionCanEditDataItem",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!0;return this.Style.States.Contain(oh.Loading)||null==this.OnSectionCanEditDataItem||(n=this.OnSectionCanEditDataItem(t,e,i)),this.FCanEditChecked=!0,this.FCanEditSnapShot=n,n}},{key:"DoSectionInsertTextBefor",value:function(t,e,i,n){return null===this.OnSectionInsertTextBefor||this.OnSectionInsertTextBefor(t,e,i,n)}},{key:"DoSectionPaintHeaderBefor",value:function(t,e,i,n,o){null!=this.OnSectionPaintHeaderBefor&&this.OnSectionPaintHeaderBefor(t,e,i,n,o)}},{key:"DoSectionPaintHeaderAfter",value:function(t,e,i,n,o){null!=this.OnSectionPaintHeaderAfter&&this.OnSectionPaintHeaderAfter(t,e,i,n,o)}},{key:"DoSectionPaintFooterBefor",value:function(t,e,i,n,o){null!=this.OnSectionPaintFooterBefor&&this.OnSectionPaintFooterBefor(t,e,i,n,o)}},{key:"DoSectionPaintFooterAfter",value:function(t,e,i,n,o){var s=t;if(s.PageNoVisible){var r=0;r=s.PageNoFrom+s.PageCount-1;var a=L.stringFormat(s.PageNoFormat,0+s.PageNoFrom+e,r);n.font.size=10,n.font.name=L.DefaultFont,n.font.color=Ft.Black,n.font.styles.clear();var l=0;switch(s.PageNoHorAlign){case as.Center:l=i.left+Math.trunc((i.width-n.textWidth(a))/2);break;case as.Right:l=i.right-n.textWidth(a);break;default:l=i.left}n.textOut(l,i.top+s.GetPageNoOffset(e),a)}null!=this.OnSectionPaintFooterAfter&&this.OnSectionPaintFooterAfter(s,e,i,n,o)}},{key:"DoSectionPaintPageBefor",value:function(t,e,i,n,o){null!=this.OnSectionPaintPageBefor&&this.OnSectionPaintPageBefor(t,e,i,n,o)}},{key:"DoSectionPaintPageAfter",value:function(t,e,i,n,o){null!=this.OnSectionPaintPageAfter&&this.OnSectionPaintPageAfter(t,e,i,n,o)}},{key:"DoSectionPaintPaperBefor",value:function(t,e,i,n,o){if(o.Print&&this.FAnnotatePre.DrawCount>0&&this.FAnnotatePre.ClearDrawAnnotate(),null!==this.BKImage&&this.BKImage.loaded){if(o.Print?this.BKImagePrintVisible:this.FBKImageVisible)switch(this.FBKImageLayout){case nh.LeftTop:n.drawImage(i.left,i.top,this.BKImage.image);break;case nh.CenterCenter:n.drawImage(i.left+Math.trunc((i.width-this.BKImage.width)/2),i.top+Math.trunc((i.height-this.BKImage.height)/2),this.BKImage.image);break;case nh.Tile:this.BKCanvas.width=i.width,this.BKCanvas.height=i.height,this.BKContext.fillStyle=this.BKContext.createPattern(this.BKImage.image,"repeat"),this.BKContext.fillRect(0,0,i.width,i.height),n.h5context.drawImage(this.BKCanvas,0,0,i.width,i.height,i.left,i.top,i.width,i.height);break;case nh.Stretch:n.drawImageRect(i,this.BKImage.image)}}null!=this.OnSectionPaintPaperBefor&&this.OnSectionPaintPaperBefor(t,e,i,n,o)}},{key:"DoSectionPaintPaperAfter",value:function(t,e,i,n,o){!o.Print&&this.FViewModel==fo.Film&&t.PagePadding>10&&(n.font.size=10,n.font.name=L.DefaultFont,n.font.color="#d0d1d5",n.font.styles.clear(),this.copyRight?n.textOut(i.left,i.bottom+4,this.copyRight):n.textOut(i.left,i.bottom+4,"编辑器由 HCView 提供 未授权")),this.AnnotateDisplay()&&!o.Print&&this.FAnnotatePre.PaintDrawAnnotate(t,i,n,o),null!=this.OnSectionPaintPaperAfter&&this.OnSectionPaintPaperAfter(t,e,i,n,o)}},{key:"DoSectionDrawItemPaintBefor",value:function(t,e,i,n,o,s,r,a,l,h,c,u,f){null!=this.OnSectionDrawItemPaintBefor&&this.OnSectionDrawItemPaintBefor(t,e,i,n,o,s,r,a,l,h,c,u,f)}},{key:"DoSectionDrawItemPaintAfter",value:function(t,e,i,n,o,s,r,a,l,h,c,u,f){""!=e.Items[i].HyperLink&&(u.pen.style=_t.Solid,u.pen.color="rgb(0, 0, 255)",u.pen.width=1,u.drawLineDriect(o.left,o.bottom,o.right,o.bottom)),null!=this.OnSectionDrawItemPaintAfter&&this.OnSectionDrawItemPaintAfter(t,e,i,n,o,s,r,a,l,h,c,u,f)}},{key:"DoSectionDrawItemPaintContent",value:function(t,e,i,n,o,s,r,a,l,h,c,u,f){}},{key:"DoSectionFloatItemPaintAfter",value:function(t,e,i,n,o){null!==this.OnSectionFloatItemPaintAfter&&this.OnSectionFloatItemPaintAfter(t,e,i,n,o)}},{key:"DoSectionDomainDrawItemPaintBefor",value:function(t,e,i,n,o,s,r,a){null!=this.OnSectionDomainDrawItemPaintBefor&&this.OnSectionDomainDrawItemPaintBefor(t,e,i,n,o,s,r,a)}},{key:"DoSectionDomainDrawItemPaintAfter",value:function(t,e,i,n,o,s,r,a){null!=this.OnSectionDomainDrawItemPaintAfter&&this.OnSectionDomainDrawItemPaintAfter(t,e,i,n,o,s,r,a)}},{key:"DoInsertJSONObject",value:function(t){return this.ActiveSection.InsertJSONObject(t)}},{key:"DoInsertText",value:function(t){return this.ActiveSection.InsertText(t)}},{key:"DoCopyRequest",value:function(t){var e=this.ActiveSection.GetTopLevelItem();return!e.isClass(ha)||!e.SelectTextExists()||t==ru.UnicodeText}},{key:"DoPasteRequest",value:function(t,e){var i=this.ActiveSectionTopLevelData();return i.GetActiveItem().styleNo!==oo.Edit||i.SelectInfo.StartItemOffset!==Yl.OffsetInner||t===ru.UnicodeText}},{key:"DoPasteFormatStream",value:function(t){return!0}},{key:"DoCopyAsStream",value:function(t){}},{key:"DoPaintViewBefor",value:function(t,e){null!=this.OnPaintViewBefor&&this.OnPaintViewBefor(t,e)}},{key:"DoPaintViewAfter",value:function(t,e){null!=this.OnPaintViewAfter&&this.OnPaintViewAfter(t,e)}},{key:"DoCreateSection",value:function(){return new iu(this.hcl,this.FStyle)}},{key:"DoSaveMutMargin",value:function(t){t.writeByte(0)}},{key:"DoLoadMutMargin",value:function(t,e,i){i>61&&t.readByte()}},{key:"DoSaveStreamBefor",value:function(t){}},{key:"DoSaveStreamAfter",value:function(t){}},{key:"DoLoadStreamBefor",value:function(t,e){this.ResetCanEditShot()}},{key:"DoLoadStreamAfter",value:function(t,e){}},{key:"DoLoadFinish",value:function(){this.FSections[0].ActiveData=this.FSections[0].Page}},{key:"DoSaveXmlDocument",value:function(t){}},{key:"DoLoadXmlDocument",value:function(t){this.ResetCanEditShot()}},{key:"setFocus",value:function(){f()(F()(o.prototype),"setFocus",this).call(this),this.focused&&this.imeMode===_i&&this.hcl.ime.control!==this&&this.hcl.ime.setControl(this)}},{key:"imeActive",value:function(){this.FCaret.Visible&&this.FCaret.Show()}},{key:"doMouseDown_",value:function(t){f()(F()(o.prototype),"doMouseDown_",this).call(this,t);var e=this.GetSectionByCrood(this.ZoomOut(this.FHScrollBar.position+t.x),this.ZoomOut(this.FVScrollBar.position+t.y),-1);if(e!=this.FActiveSectionIndex&&this.SetActiveSectionIndex(e),!(this.FActiveSectionIndex<0)){if(this.FAnnotatePre.DrawCount>0&&t.x>this.FAnnotatePre.DrawRect.left)this.FAnnotatePre.MouseDown(t,this.ZoomOut(t.x),this.ZoomOut(t.y));else{var i=new fi;if(i.assign(t),this.FMultiplePage)i.x=this.ZoomOut(this.FHScrollBar.position+t.x),i.y=this.ZoomOut(this.FVScrollBar.position+t.y);else{var n=this.GetSectionDrawLeft(this.FActiveSectionIndex),s=new et;s.x=this.ZoomOut(this.FHScrollBar.position+t.x)-n,s.y=this.ZoomOut(this.FVScrollBar.position+t.y)-this.GetSectionTopFilm(this.FActiveSectionIndex),i.x=s.x,i.y=s.y}this.FSections[this.FActiveSectionIndex].MouseDown(i)}this.CheckUpdateInfo()}}},{key:"doMouseMove_",value:function(t){if(f()(F()(o.prototype),"doMouseMove_",this).call(this,t),!this.FPrintView){if(this.FActiveSectionIndex>=0){var e=new fi;e.assign(t),this.FMultiplePage?(e.x=this.ZoomOut(this.FHScrollBar.position+t.x),e.y=this.ZoomOut(this.FVScrollBar.position+t.y)):(e.x=this.ZoomOut(this.FHScrollBar.position+t.x)-this.GetSectionDrawLeft(this.FActiveSectionIndex),e.y=this.ZoomOut(this.FVScrollBar.position+t.y)-this.GetSectionTopFilm(this.FActiveSectionIndex)),this.FSections[this.FActiveSectionIndex].MouseMove(e)}this.FAnnotatePre.DrawCount>0&&this.FAnnotatePre.MouseMove(this.ZoomOut(t.x),this.ZoomOut(t.y)),this.CheckUpdateInfo(),this.cursor=this.FStyle.Cursor}}},{key:"doMouseUp_",value:function(t){if(f()(F()(o.prototype),"doMouseUp_",this).call(this,t),this.AutoScrollTimer(!1),t.button!==le||null===this.popupMenu){if(!(this.FAnnotatePre.DrawCount>0&&t.x>this.FAnnotatePre.DrawRect.left)){if(this.FActiveSectionIndex>=0){var e=new fi;e.assign(t),this.FMultiplePage?(e.x=this.ZoomOut(this.FHScrollBar.position+t.x),e.y=this.ZoomOut(this.FVScrollBar.position+t.y)):(e.x=this.ZoomOut(this.FHScrollBar.position+t.x)-this.GetSectionDrawLeft(this.FActiveSectionIndex),e.y=this.ZoomOut(this.FVScrollBar.position+t.y)-this.GetSectionTopFilm(this.FActiveSectionIndex)),this.FSections[this.FActiveSectionIndex].MouseUp(e)}this.FStyle.UpdateInfo.DragingSelected&&(this.FStyle.Cursor=Se),this.cursor=this.FStyle.Cursor,this.imeMode===_i&&this.hcl.ime.setControl(this),this.FStyle.UpdateInfo.DragingSelected=!1,this.CheckUpdateInfo(),this.FStyle.UpdateInfo.Selecting&&(this.FStyle.UpdateInfo.Selecting=!1,this.FStyle.States.Contain(oh.FormatBrushing)&&this.ApplyTextStyleNo(this.FStyle.FormatBrushStyleNo)),this.FStyle.States.Contain(oh.FormatBrushing)&&this.FStyle.States.Exclude(oh.FormatBrushing),null!==this.OnMouseUp&&this.OnMouseUp(t)}}else this.FStyle.States.Contain(oh.FormatBrushing)&&this.FStyle.States.Exclude(oh.FormatBrushing)}},{key:"doMouseWheel_",value:function(t){this.hcl.keyDownStates[He]?t.delta>0?this.FZoom<.5?this.Zoom=.5:this.FZoom<.75?this.Zoom=.75:this.FZoom<1?this.Zoom=1:this.FZoom<1.25?this.Zoom=1.25:this.FZoom<1.5?this.Zoom=1.5:this.FZoom<2?this.Zoom=2:this.FZoom<3?this.Zoom=3:this.FZoom<5&&(this.Zoom=5):this.FZoom>3?this.Zoom=3:this.FZoom>2?this.Zoom=2:this.FZoom>1.25?this.Zoom=1.25:this.FZoom>1?this.Zoom=1:this.FZoom>.75?this.Zoom=.75:this.FZoom>.5?this.Zoom=.5:this.FZoom>.25&&(this.Zoom=.25):this.hcl.keyDownStates[Ge]?this.FHScrollBar.position-=t.delta:this.FVScrollBar.position-=t.delta}},{key:"doMouseLeave_",value:function(){this.FStyle.UpdateInfo.Selecting&&this.AutoScrollTimer(!0),f()(F()(o.prototype),"doMouseLeave_",this).call(this)}},{key:"doDragenter_",value:function(t){this.FStyle.UpdateInfo.DragingSelected=!0,this.mouseMove(t)}},{key:"doDragleave_",value:function(t){this.FStyle.UpdateInfo.DragingSelected=!1}},{key:"doDragover_",value:function(t){this.dragX===t.x&&this.dragY===t.y||this.mouseMove(t)}},{key:"doDrop_",value:function(t){this.mouseUp(t),this.FStyle.UpdateInfo.DragingSelected=!1;var e=t.dataTransfer.getData("text/plain");e&&this.InsertText(e)}},{key:"doKeyDown_",value:function(t){this.FStyle.States.Include(oh.UserInteraction);try{this.hcl.keyDownStates[He]&&t.keyCode===Ze?(this.SelectAll(),t.keyCode=0):this.hcl.keyDownStates[He]&&t.keyCode===ei?(this.Undo(),t.keyCode=0):this.hcl.keyDownStates[He]&&t.keyCode===ti?(this.Redo(),t.keyCode=0):this.ActiveSection.KeyDown(t)}finally{this.FStyle.States.Exclude(oh.UserInteraction)}f()(F()(o.prototype),"doKeyDown_",this).call(this,t)}},{key:"doKeyUp_",value:function(t){f()(F()(o.prototype),"doKeyUp_",this).call(this,t),this.ActiveSection.KeyUp(t)}},{key:"doKeyPress_",value:function(t){if(f()(F()(o.prototype),"doKeyPress_",this).call(this,t),!this.hcl.keyDownStates[He]){this.FStyle.States.Include(oh.UserInteraction);try{this.ActiveSection.KeyPress(t)}finally{this.FStyle.States.Exclude(oh.UserInteraction)}}}},{key:"imeInput",value:function(t){if(""!=t){this.FStyle.States.Include(oh.UserInteraction);try{this.InsertText(t)}finally{this.FStyle.States.Exclude(oh.UserInteraction)}}}},{key:"DataSaveLiteStream",value:function(t,e){Yl._SaveFileFormatAndVersion(t),t.writeByte(Yl.HC_STREAM_LITE),this.FStyle.SaveToStream(t),e()}},{key:"DataLoadLiteStream",value:function(t,e,i){var n=Yl._LoadFileFormatAndVersion(e);if(n.fileVersion>59&&e.readByte()!=Yl.HC_STREAM_LITE)this.hcl.errorLog("调用DataLoadLiteStream时传递的数据不是LITE类型！");else{var o=new oo(this.hcl);o.LoadFromStream(e,n.fileVersion),t&&(this.FStyle.MergeStyle=!0);try{i(n.fileVersion,o)}finally{t&&(this.FStyle.MergeStyle=!1)}}}},{key:"CalcScrollRang",value:function(){var t=0,e=0,i=0;if(this.FViewModel===fo.Film)if(this.FMultiplePage){var n=0,o=0,s=0;e=this.FSections[0].PaperWidthPix;for(var r=0,a=0,l=this.FPagePadding+this.FSections[0].PaperHeightPix,h=0;h<this.FSections.count;h++){(i=this.FPagePadding+this.FSections[h].PaperWidthPix)>e&&(e=i),a=this.FPagePadding+this.FSections[h].PaperHeightPix,r>0&&(l=Math.max(a,l));for(var c=0;c<this.FSections[h].PageCount;c++)r+i>this.FViewWidth&&(c>0?this.SetMultiplePageLine(r,s,n,o,h,c-1):h>0?this.SetMultiplePageLine(r,s,n,o,h-1,this.FSections[h-1].PageCount-1):this.SetMultiplePageLine(r,s,n,o,h,c),0===h&&0===c||(s+=l),r=0,l=a,n=h,o=c),r+=i}this.SetMultiplePageLine(r,s,n,o,this.FSections.count-1,this.FSections[this.FSections.count-1].PageCount-1),t=s+l}else{e=this.FSections[0].PaperWidthPix;for(var u=0;u<this.FSections.count;u++)t+=this.FSections[u].GetFilmHeight(),(i=this.FSections[u].PaperWidthPix)>e&&(e=i)}else if(this.FViewModel===fo.Film){e=this.FSections[0].PaperWidthPix;for(var f=0;f<this.FSections.count;f++)t+=this.FSections[f].GetFilmHeight(),(i=this.FSections[f].PaperWidthPix)>e&&(e=i)}else{e=this.FSections[0].GetPageWidth();for(var d=0;d<this.FSections.count;d++)t+=this.FSections[d].GetFilmHeight(),(i=this.FSections[d].GetPageWidth())>e&&(e=i)}this.AnnotateDisplay()&&(e+=Yl.AnnotationWidth),t=this.ZoomIn(t+this.FPagePadding),e=this.ZoomIn(e+this.FPagePadding+this.FPagePadding);var m=null!==this.OnCalcScrollRange?{vMax:this.FVScrollBar.max,vPos:this.FVScrollBar.position,hMax:this.FHScrollBar.max,hPos:this.FHScrollBar.position}:null;this.FHScrollBar.visible?this.FVScrollBar.pageSize=this.FVScrollBar.height:this.FVScrollBar.pageSize=this.height,this.FVScrollBar.max=t,this.FHScrollBar.max=e,m&&this.DoCalcScrollRange(m.vMax!==this.FVScrollBar.max?this.FVScrollBar.max:-1,m.vPos!==this.FVScrollBar.position?this.FVScrollBar.position:-1,m.hMax!==this.FHScrollBar.max?this.FHScrollBar.max:-1,m.hPos!==this.FHScrollBar.position?this.FHScrollBar.position:-1)}},{key:"DoSectionCanNotEditNotify",value:function(t){null!=this.OnCanNotEditNotify?this.OnCanNotEditNotify(t):console.log(t)}},{key:"CheckUpdateInfo",value:function(){this.FUpdateCount>0||(null!=this.FCaret&&this.FStyle.UpdateInfo.ReCaret&&(this.ReBuildCaret(),this.FStyle.UpdateInfo.ReCaret=!1,this.FStyle.UpdateInfo.ReStyle=!1,this.FStyle.UpdateInfo.ReScroll=!1),this.FStyle.UpdateInfo.RePaint&&(this.FStyle.UpdateInfo.RePaint=!1,this.UpdateView()))}},{key:"InitializeComponent",value:function(){this.SuspendLayout(),this.Name="HCView",this.ResumeLayout(!1)}},{key:"Caret",get:function(){return this.FCaret}},{key:"DeleteUnUsedStyle",value:function(t,e,i){t.TextStyles[0].CheckSaveUsed=!0,t.TextStyles[0].TempNo=0;for(var n=1;n<t.TextStyles.count;n++)t.TextStyles[n].CheckSaveUsed=!1,t.TextStyles[n].TempNo=oo.Null;for(var o=0;o<t.ParaStyles.count;o++)t.ParaStyles[o].CheckSaveUsed=!1,t.ParaStyles[o].TempNo=oo.Null;for(var s=0;s<e.count;s++)e[s].MarkStyleUsed(!0,i);for(var r=0,a=1;a<t.TextStyles.count;a++)t.TextStyles[a].CheckSaveUsed?t.TextStyles[a].TempNo=a-r:r++;r=0;for(var l=0;l<t.ParaStyles.count;l++)t.ParaStyles[l].CheckSaveUsed?t.ParaStyles[l].TempNo=l-r:r++;for(var h=null,c=0;c<e.count;c++)e[c].MarkStyleUsed(!1,i),(h=e[c].ActiveData.GetTopLevelData()).CurStyleNo>oo.Null&&(h.CurStyleNo=t.TextStyles[h.CurStyleNo].TempNo),h.CurParaNo>oo.Null&&(h.CurParaNo=t.ParaStyles[h.CurParaNo].TempNo);for(var u=t.TextStyles.count-1;u>=1;u--)t.TextStyles[u].CheckSaveUsed||t.TextStyles.delete(u);for(var f=t.ParaStyles.count-1;f>=0;f--)t.ParaStyles[f].CheckSaveUsed||t.ParaStyles.delete(f)}},{key:"ResetActiveSectionMargin",value:function(){this.ActiveSection.ResetMargin(),this.DoViewResize()}},{key:"ActiveItemReAdaptEnvironment",value:function(){this.ActiveSection.ActiveItemReAdaptEnvironment(),this.UpdateView()}},{key:"Clear",value:function(){this.BeginUpdate();try{this.FStyle.States.Include(oh.Clearing);try{this.FStyle.Initialize(),this.FSections.removeRange(1,this.FSections.count-1),this.FActiveSectionIndex=0,this.FDisplayFirstSection=-1,this.FDisplayLastSection=-1,this.FNextAnnotateID=0,this.FUndoList.SaveState();try{this.FUndoList.Enable=!1;for(var t=0;t<this.FSections.count;t++)this.FSections[t].Clear();this.FUndoList.clear()}finally{this.FUndoList.RestoreState()}}finally{this.FStyle.States.Exclude(oh.Clearing)}this.FHScrollBar.position=0,this.FVScrollBar.position=0,this.FStyle.UpdateInfoRePaint(),this.FStyle.UpdateInfoReCaret(),this.DoMapChanged(),this.DoViewResize()}finally{this.EndUpdate()}}},{key:"ClearUndo",value:function(){this.FUndoList.clear()}},{key:"EnableUndo",value:function(){this.FUndoList.Enable=!0}},{key:"DisableUndo",value:function(){this.FUndoList.Enable=!1}},{key:"DisSelect",value:function(){this.ActiveSection.DisSelect(),this.CheckUpdateInfo()}},{key:"DeleteSelected",value:function(){this.ActiveSection.DeleteSelected()}},{key:"DeleteActiveDomain",value:function(){return this.ActiveSection.DeleteActiveDomain()}},{key:"DeleteActiveAnnotate",value:function(){this.FStyle.States.Include(oh.ProcessAnnotate);try{return this.ActiveSection.DeleteActiveAnnotate()}finally{this.FStyle.States.Exclude(oh.ProcessAnnotate)}}},{key:"DeleteActiveItem",value:function(){var t=this.ActiveSection.ActiveData,e=t.GetActiveItemNo();t.Items[e].StyleNo===oo.Table&&t.SetSelectBound(e,Yl.OffsetAfter,e,Yl.OffsetAfter),this.DeleteActiveDataItems(e)}},{key:"DeleteActiveDataItems",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e<t?this.ActiveSection.DeleteActiveDataItems(t,t,i):this.ActiveSection.DeleteActiveDataItems(t,e,i)}},{key:"DeleteActiveSection",value:function(){!this.ReadOnly&&this.FActiveSectionIndex>0&&(this.FSections.delete(this.FActiveSectionIndex),this.FActiveSectionIndex=this.FActiveSectionIndex-1,this.FDisplayFirstSection=-1,this.FDisplayLastSection=-1,this.FStyle.UpdateInfoRePaint(),this.FStyle.UpdateInfoReCaret(),this.DoChange())}},{key:"DeleteEmptySection",value:function(){this.FActiveSectionIndex=0,this.FDisplayFirstSection=-1,this.FDisplayLastSection=-1;for(var t=this.FSections.count-1;t>0;t--)this.FSections[t].Page.IsEmptyData()&&this.FSections.removeAt(t);this.FSections.Count>1&&this.FSections[0].Page.IsEmptyData()&&this.FSections.removeAt(0),this.FStyle.UpdateInfoRePaint(),this.FStyle.UpdateInfoReCaret(),this.DoChange()}},{key:"DoFormatData",value:function(){for(var t=0;t<this.FSections.count;t++)this.FSections[t].FormatData(),this.FSections[t].BuildSectionPages(0)}},{key:"FormatData",value:function(){this.FFormatCount>0||(this.DoFormatData(),this.FStyle.UpdateInfoRePaint(),this.FStyle.UpdateInfoReCaret(),this.DoMapChanged())}},{key:"BuildPages",value:function(){if(!(this.FFormatCount>0)){for(var t=0;t<this.FSections.count;t++)this.FSections[t].Page.ClearFormatExtraHeight(),this.FSections[t].BuildSectionPages(0);this.FStyle.UpdateInfoRePaint(),this.FStyle.UpdateInfoReCaret(),this.DoMapChanged()}}},{key:"InsertStream",value:function(t){var e=this,i=!1;this.BeginUpdate();try{var n=new oo(this.hcl);this.DoLoadFromStream(!0,t,n,(function(o,s){if(t.readByte(),o>42)e.ActiveSection.SeekStreamToArea(t,n,o,ql.Page)&&(i=e.ActiveSection.InsertStream(t,n,o));else{var r=new iu(e.hcl,n);r.OnCreateItemByStyle=function(t,i){return e.DoSectionCreateStyleItem(t,i)};var a=new ht;r.LoadFromStream(t,n,o),r.Page.SaveToStream(a),a.position=0,a.readBoolean(),a.readInt64(),i=e.ActiveSection.InsertStream(a,n,Yl.HC_FileVersionInt)}}))}finally{this.EndUpdate()}return i}},{key:"InsertLiteStream",value:function(t){var e=this,i=!1;return this.DataLoadLiteStream(!0,t,(function(n,o){e.BeginUpdate();try{i=e.ActiveSection.InsertStream(t,o,n)}finally{e.EndUpdate()}})),i}},{key:"AppendStream",value:function(t){return this.ActiveSection.ActiveData.SelectLastItemAfterWithCaret(),this.InsertBreak(),this.ApplyParaAlignHorz(Ln.Left),this.InsertStream(t)}},{key:"LoadHeaderFromStream",value:function(t,e){var i=this,n=!1;this.BeginUpdate();try{var o=new oo(this.hcl);this.DoLoadFromStream(!0,t,o,(function(s,r){if(t.readByte(),s>42){i.ActiveSection.Header.BeginFormat();try{i.ActiveSection.SeekStreamToArea(t,o,s,ql.Header,e),i.ActiveSection.Header.LoadFromStream(t,o,s)}finally{i.ActiveSection.Header.EndFormat(!1)}i.ResetActiveSectionMargin(),n=!0}}))}finally{this.EndUpdate()}return n}},{key:"LoadFooterFromStream",value:function(t,e){var i=this,n=!1;this.BeginUpdate();try{var o=new oo(this.hcl);this.DoLoadFromStream(!0,t,o,(function(s,r){if(t.readByte(),s>42){i.ActiveSection.Footer.BeginFormat();try{i.ActiveSection.SeekStreamToArea(t,o,s,ql.Footer,e),i.ActiveSection.Footer.LoadFromStream(t,o,s)}finally{i.ActiveSection.Footer.EndFormat(!1)}i.ResetActiveSectionMargin(),n=!0}}))}finally{this.EndUpdate()}return n}},{key:"InsertJSONObject",value:function(t){this.BeginUpdate();try{return this.DoInsertJSONObject(t)}finally{this.EndUpdate()}}},{key:"InsertText",value:function(t){this.BeginUpdate();try{return t=Yl.HCReplaceInvalidChar(t),this.DoInsertText(t)}finally{this.EndUpdate()}}},{key:"InsertTable",value:function(t,e){this.BeginUpdate();try{return this.ActiveSection.InsertTable(t,e)}finally{this.EndUpdate()}}},{key:"InsertImageFile",value:function(t){}},{key:"InsertImage",value:function(t){this.BeginUpdate();try{return this.ActiveSection.InsertImage(t)}finally{this.EndUpdate()}}},{key:"InsertGifImage",value:function(t){this.BeginUpdate();try{return this.ActiveSection.InsertGifImage(t)}finally{this.EndUpdate()}}},{key:"InsertLine",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.ActiveSection.InsertLine(t,e)}},{key:"InsertItem",value:function(t){return this.ActiveSection.InsertItem(t)}},{key:"InsertItemEx",value:function(t,e){return this.ActiveSection.InsertItemEx(t,e)}},{key:"InsertFloatItem",value:function(t){return this.ActiveSection.InsertFloatItem(t)}},{key:"InsertAnnotate",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.FStyle.States.Include(oh.ProcessAnnotate);try{return this.ActiveSection.InsertAnnotate(t,e,i)}finally{this.FStyle.States.Exclude(oh.ProcessAnnotate)}}},{key:"GetAnnotateItem",value:function(t){}},{key:"DeleteAnnotateItem",value:function(t){}},{key:"InsertBreak",value:function(){return this.ActiveSection.InsertBreak()}},{key:"InsertPageBreak",value:function(){return this.ActiveSection.InsertPageBreak()}},{key:"InsertSectionBreak",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.ReadOnly)return!1;var i=!1;this.BeginUpdate();try{var n=this.NewDefaultSection();n.PageNoFormat=this.FSections[this.FActiveSectionIndex].PageNoFormat,n.AssignPaper(this.FSections[this.FActiveSectionIndex]),t&&n.Header.Clone(this.FSections[this.FActiveSectionIndex].Header),e&&n.Footer.Clone(this.FSections[this.FActiveSectionIndex].Footer),this.FSections.insert(this.FActiveSectionIndex+1,n),this.FActiveSectionIndex=this.FActiveSectionIndex+1,i=!0,this.FStyle.UpdateInfoRePaint(),this.FStyle.UpdateInfoReCaret(),this.FStyle.UpdateInfoReScroll(),this.DoChange()}finally{this.EndUpdate()}return i}},{key:"InsertDomain",value:function(t){return this.ActiveSection.InsertDomain(t)}},{key:"SelectToDomain",value:function(t){return this.ActiveSection.SelectToDomain(t)}},{key:"SetActiveImage",value:function(t){return this.ActiveSection.SetActiveImage(t)}},{key:"ActiveTableResetRowCol",value:function(t,e){return this.ActiveSection.ActiveTableResetRowCol(t,e)}},{key:"ActiveTableInsertRowAfter",value:function(t){return this.ActiveSection.ActiveTableInsertRowAfter(t)}},{key:"ActiveTableInsertRowBefor",value:function(t){return this.ActiveSection.ActiveTableInsertRowBefor(t)}},{key:"ActiveTableDeleteCurRow",value:function(){return this.ActiveSection.ActiveTableDeleteCurRow()}},{key:"ActiveTableDeleteRowFrom",value:function(t,e){return this.ActiveSection.ActiveTableDeleteRowFrom(t,e)}},{key:"ActiveTableSplitCurRow",value:function(){return this.ActiveSection.ActiveTableSplitCurRow()}},{key:"ActiveTableSplitCurCol",value:function(){return this.ActiveSection.ActiveTableSplitCurCol()}},{key:"ActiveTableInsertColBefor",value:function(t){return this.ActiveSection.ActiveTableInsertColBefor(t)}},{key:"ActiveTableInsertColAfter",value:function(t){return this.ActiveSection.ActiveTableInsertColAfter(t)}},{key:"ActiveTableDeleteCurCol",value:function(){return this.ActiveSection.ActiveTableDeleteCurCol()}},{key:"ApplyParaAlignHorz",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){for(var i=0;i<this.FStyle.ParaStyles.count;i++)this.FStyle.ParaStyles[i].AlignHorz=t;this.FormatData()}else this.ActiveSection.ApplyParaAlignHorz(t)}},{key:"ApplyParaAlignVert",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){for(var i=0;i<this.FStyle.ParaStyles.count;i++)this.FStyle.ParaStyles[i].AlignVert=t;this.FormatData()}else this.ActiveSection.ApplyParaAlignVert(t)}},{key:"ApplyParaBackColor",value:function(t){this.ActiveSection.ApplyParaBackColor(t)}},{key:"ApplyParaBreakRough",value:function(t){this.ActiveSection.ApplyParaBreakRough(t)}},{key:"ApplyParaLineSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(i){for(var n=0;n<this.FStyle.ParaStyles.count;n++)this.FStyle.ParaStyles[n].SpaceMode=t,this.FStyle.ParaStyles[n].Space=e;this.FormatData()}else this.ActiveSection.ApplyParaLineSpace(t,e)}},{key:"ApplyParaLeftIndentAdd",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?this.ActiveSection.ApplyParaLeftIndent(this.FStyle.ParaStyles[this.CurParaNo].LeftIndent+En.pixXToMillimeter(Yl.TabCharWidth)):this.ActiveSection.ApplyParaLeftIndent(Math.max(0,this.FStyle.ParaStyles[this.CurParaNo].LeftIndent-En.pixXToMillimeter(Yl.TabCharWidth)))}},{key:"ApplyParaLeftIndent",value:function(t){this.ActiveSection.ApplyParaLeftIndent(t)}},{key:"ApplyParaRightIndent",value:function(t){this.ActiveSection.ApplyParaRightIndent(t)}},{key:"ApplyParaFirstIndent",value:function(t){this.ActiveSection.ApplyParaFirstIndent(t)}},{key:"ApplyBullet",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.ActiveSection.ApplyBullet(t,e,i,n)}},{key:"ApplyTextStyle",value:function(t){this.ActiveSection.ApplyTextStyle(t)}},{key:"ApplyTextStyleNo",value:function(t){t>oo.Null&&this.ActiveSection.ApplyTextStyleNo(t)}},{key:"ApplyTextFontName",value:function(t){this.ActiveSection.ApplyTextFontName(t)}},{key:"ApplyTextFontSize",value:function(t){this.ActiveSection.ApplyTextFontSize(t)}},{key:"ApplyTextColor",value:function(t){this.ActiveSection.ApplyTextColor(t)}},{key:"ApplyTextBackColor",value:function(t){this.ActiveSection.ApplyTextBackColor(t)}},{key:"ApplyTableCellAlign",value:function(t){this.ActiveSection.ApplyTableCellAlign(t)}},{key:"SelectAll",value:function(){for(var t=0;t<=this.FSections.count-1;t++)this.FSections[t].SelectAll();this.FStyle.UpdateInfoRePaint(),this.CheckUpdateInfo()}},{key:"doCut_",value:function(t){this.FStyle.States.Include(oh.Cutting);try{this.doCopy_(t)&&(this.ActiveSection.DeleteSelected(),this.doCutAfter_())}finally{this.FStyle.States.Exclude(oh.Cutting)}}},{key:"doCutAfter_",value:function(){null!=this.OnCutAfter&&this.OnCutAfter()}},{key:"doCopy_",value:function(t){var e=this,i="";if(this.CopyAdd&&""===i&&this.hcl.localStorage.hasKey(E.Text)&&(i=this.hcl.localStorage.getString(E.Text)),this.hcl.localStorage.removeItem(E.Text),this.CopyMark="",this.FStyle.CopyRectPart=!1,this.ActiveSection.SelectExists()){this.FStyle.States.Include(oh.Copying);try{if(!this.doCopyBefor(this.FStyle.States.Contain(oh.Cutting)))return this.hcl.localStorage.removeItem(Yl.HC_EXT_RECTPART),this.hcl.localStorage.removeItem(Yl.HC_EXT),!1;var n=!1,o=this.ActiveSectionTopLevelData().SaveSelectToText();this.CopyAdd&&(o=i+o),this.DoCopyRequest(ru.UnicodeText)&&""!==o&&(this.hcl.localStorage.setString(E.Text,o),this.ExtrnalCP&&t.clipboardData.setData(_.TXT,o),n=!0);var s=this.DoCopyRequest(Yl.HCExtFormat),r=this.DoCopyRequest(ru.HTML);if(s||r){var a=new ht;this.DoCopyAsStream(a),this.DataSaveLiteStream(a,(function(){e.ActiveSection.ActiveData.SaveSelectToStream(a)}));var l=!0,h="",c="data";if(this.FStyle.CopyRectPart&&(c="rect"),this.CopyAdd){var u=new ht;if(this.hcl.localStorage.hasKey(E.Html)){var f=this.hcl.localStorage.getString(E.Html),d=(new DOMParser).parseFromString(f,"text/xml").getElementsByTagName("hcfml");if(d.length>0){var m=d[0].getAttribute("rect");null!==m&&""!==m&&this.FStyle.CopyRectPart?u.fromString(m):null===(m=d[0].getAttribute("data"))||""===m||this.FStyle.CopyRectPart||u.fromString(m)}}u.size>0&&(u.position=u.size,u.writeBuffer(a.buffer),h="<hcfml copymark='"+this.CopyMark+"' "+c+"='"+u.toString()+"'>"+(r?o:"")+"</hcfml>",l=!1),u=null}l&&(this.hcl.localStorage.removeItem(Yl.HC_EXT_RECTPART),this.hcl.localStorage.removeItem(Yl.HC_EXT),h="<hcfml copymark='"+this.CopyMark+"' "+c+"='"+a.toString()+"'>"+(r?o:"")+"</hcfml>"),this.hcl.localStorage.setString(E.Html,h),this.ExtrnalCP&&t.clipboardData.setData(_.HTML,h),n=!0,a=null}s||(this.hcl.localStorage.removeItem(Yl.HC_EXT_RECTPART),this.hcl.localStorage.removeItem(Yl.HC_EXT)),n&&(r||t.clipboardData.setData(_.HTML,"<hcfml copymark='"+this.CopyMark+"'></hcfml>"),this.doCopyAfter_(this.FStyle.States.Contain(oh.Cutting)))}finally{this.FStyle.States.Exclude(oh.Copying)}return!0}}},{key:"CopyAsText",value:function(){if(this.hcl.localStorage.removeItem(E.Text),this.hcl.localStorage.removeItem(E.Html),this.hcl.localStorage.removeItem(Yl.HC_EXT),this.hcl.localStorage.removeItem(Yl.HC_EXT_RECTPART),this.CopyMark="",this.FStyle.CopyRectPart=!1,this.doCopyBefor(!1)&&this.DoCopyRequest(ru.UnicodeText)){var t=this.ActiveSectionTopLevelData().SaveSelectToText(),e="<hcfml copymark='"+this.CopyMark+"'></hcfml>",i=new Blob([t],{type:"text/plain"}),n=new Blob([e],{type:"text/html"}),o=new ClipboardItem({"text/plain":i,"text/html":n});navigator.clipboard.write([o]).then((function(){}),(function(t){console.error("CopyAsText写入剪切板出错："+t)})),this.hcl.localStorage.setString(E.Text,t),this.hcl.localStorage.setString(E.Html,e),this.doCopyAfter_()}}},{key:"doCopyBefor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null==this.OnCopyBefor||this.OnCopyBefor(t)}},{key:"doCopyAfter_",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null!=this.OnCopyAfter&&this.OnCopyAfter(t)}},{key:"doPasteRectPart_",value:function(t){var e=this;if(this.DoPasteFormatStream(t))for(;t.position<t.size;)this.DataLoadLiteStream(!0,t,(function(i,n){e.BeginUpdate();try{var o=t.readByte();e.ActiveSection.PasteRectPart(o,t,n,i)}finally{e.EndUpdate()}}))}},{key:"doPasteData_",value:function(t){if(this.DoPasteFormatStream(t))for(;t.position<t.size;)this.InsertLiteStream(t)}},{key:"doPaste_",value:function(t){var e=this;if(this.ExtrnalCP){var i=!1,n=null,o="";if(t.clipboardData.types.indexOf(_.HTML)>-1){var s=t.clipboardData.getData(_.HTML),r=(new DOMParser).parseFromString(s,"text/xml").getElementsByTagName("hcfml");r.length>0&&(i=!0,o=(n=r[0]).getAttribute("copymark"))}if(this.doPasteBefor(i,o)){this.FStyle.States.Include(oh.UserInteraction),this.FStyle.States.Include(oh.Pasting);try{if(null!==n&&!this.PasteAsTexting&&this.DoPasteRequest(Yl.HCExtFormat,i,o)){var a=n.getAttribute("data");if(null!==a&&""!==a){var l=new ht;return l.fromString(a),this.doPasteData_(l),void(l=null)}if(null!==(a=n.getAttribute("rect"))&&""!==a){var h=new ht;return h.fromString(a),this.doPasteRectPart_(h),void(h=null)}}if(t.clipboardData.types.indexOf(_.TXT)>-1&&this.DoPasteRequest(ru.UnicodeText,i,o)){var c=t.clipboardData.getData(_.TXT);return void this.InsertText(c)}if(!this.PasteAsTexting){var u=t.clipboardData.types.indexOf("Files");if(u>-1){var f=t.clipboardData.items[u].type;if(f===_.PNG&&this.DoPasteRequest(ru.PNG,i,o)||f===_.JPEG&&this.DoPasteRequest(ru.JPEG,i,o)||f===_.BMP&&this.DoPasteRequest(ru.Bitmap,i,o)){var d=t.clipboardData.items[u].getAsFile();if(d){var m=this.ActiveSectionTopLevelData(),S=m.CreateItemByStyle(oo.Image);S.LoadGraphicFile(d,(function(){S.RestrainSize(m.Width,S.Height),e.InsertItem(S)}))}}}}}finally{this.FStyle.States.Exclude(oh.Pasting),this.FStyle.States.Exclude(oh.UserInteraction)}}}else this.Paste()}},{key:"LocalPaste",value:function(){var t=!1,e=null,i="";if(this.hcl.localStorage.hasKey(E.Html)){var n=this.hcl.localStorage.getString(E.Html),o=(new DOMParser).parseFromString(n,"text/xml").getElementsByTagName("hcfml");o.length>0&&(t=!0,i=(e=o[0]).getAttribute("copymark"))}if(this.doPasteBefor(t,i)){this.FStyle.States.Include(oh.UserInteraction),this.FStyle.States.Include(oh.Pasting);try{if(null!==e&&!this.PasteAsTexting&&this.DoPasteRequest(Yl.HCExtFormat,t,i)){var s=e.getAttribute("data");if(null!==s&&""!==s){var r=new ht;return r.fromString(s),this.doPasteData_(r),void(r=null)}if(null!==(s=e.getAttribute("rect"))&&""!==s){var a=new ht;return a.fromString(s),this.doPasteRectPart_(a),void(a=null)}}if(this.hcl.localStorage.hasKey(E.Text)>-1&&this.DoPasteRequest(ru.UnicodeText,t,i)){var l=this.hcl.localStorage.getString(E.Text);return void this.InsertText(l)}}finally{this.FStyle.States.Exclude(oh.Pasting),this.FStyle.States.Exclude(oh.UserInteraction)}}}},{key:"Paste",value:(i=c()(I.a.mark((function t(){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!navigator.clipboard){t.next=5;break}return t.next=3,yu(this.hcl.parentElement);case 3:t.next=6;break;case 5:this.LocalPaste();case 6:return this.setFocus(),t.abrupt("return");case 12:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"PasteAsText",value:(e=c()(I.a.mark((function t(){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.PasteAsTexting=!0,t.prev=1,t.next=4,this.Paste();case 4:return t.prev=4,this.PasteAsTexting=!1,t.finish(4);case 7:return t.abrupt("return");case 10:if(this.hcl.localStorage.hasKey(E.Text)&&this.DoPasteRequest(ru.UnicodeText)){this.FStyle.States.Include(oh.UserInteraction);try{this.InsertText(this.hcl.localStorage.getString(E.Text))}finally{this.FStyle.States.Exclude(oh.UserInteraction)}}case 11:case"end":return t.stop()}}),t,this,[[1,,4,7]])}))),function(){return e.apply(this,arguments)})},{key:"doPasteBefor",value:function(t,e){return null==this.OnPasteBefor||this.OnPasteBefor(t,e)}},{key:"InsertHtml",value:function(t){return!1}},{key:"ShowSearchForm",value:function(){null==this.FFrmSearch&&(this.FFrmSearch=new cu(this.hcl,this),this.FFrmSearch.closeFree=!1),this.FFrmSearch.cbbKey.text=this.ActiveSectionTopLevelData().SaveSelectToText(),this.FFrmSearch.visible||(this.FFrmSearch.moveCenter(),this.FFrmSearch.show())}},{key:"ZoomIn",value:function(t){return L.Round(t*this.FZoom)}},{key:"ZoomOut",value:function(t){return L.Round(t/this.FZoom)}},{key:"MapChange",value:function(){this.DoMapChanged()}},{key:"SetMultiplePageLine",value:function(t,e,i,n,o,s){var r=0;r=this.FViewAlign===Su.Center?Math.max(Math.trunc((this.FViewWidth-t+this.ZoomIn(this.FPagePadding))/2),this.ZoomIn(this.FPagePadding)):Math.max(this.FViewWidth-t,this.ZoomIn(this.FPagePadding));for(var a=n,l=-1,h=i;h<=o;h++){l=h===o?s:this.FSections[h].PageCount-1;for(var c=a;c<=l;c++)this.FSections[h].SetPageFilmLeftTop(c,r,e),this.AnnotateDisplay()?r+=this.ZoomIn(this.FPagePadding+this.FSections[h].PaperWidthPix+Yl.AnnotationWidth):r+=this.ZoomIn(this.FPagePadding+this.FSections[h].PaperWidthPix);a=0}}},{key:"UpdateView",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.UpdateViewRect(this.GetViewRect(),t)}},{key:"CalcDisplaySectionAndPage",value:function(){if(this.FDisplayFirstSection>=0)for(var t=this.FDisplayFirstSection;t<=this.FDisplayLastSection;t++)this.FSections[t].DisplayFirstPageIndex=-1,this.FSections[t].DisplayLastPageIndex=-1;this.FDisplayFirstSection=-1,this.FDisplayLastSection=-1;var e=-1,i=-1,n=0;if(this.FMultiplePage&&this.FViewModel===fo.Film){for(var o=0,s=0;s<this.FSections.count;s++){o=this.ZoomIn(this.FPagePadding+this.FSections[s].PaperHeightPix);for(var r=0;r<this.FSections[s].PageCount;r++)if(this.FSections[s].Pages[r].FilmTop+o>this.FVScrollBar.position){e=r;break}if(e>=0){this.FDisplayFirstSection=s,this.FSections[this.FDisplayFirstSection].DisplayFirstPageIndex=e;break}}if(this.FDisplayFirstSection>=0){for(var a=!1,l=this.FVScrollBar.position+this.FViewHeight,h=this.FDisplayFirstSection;h<this.FSections.count;h++){for(var c=e;c<this.FSections[h].PageCount;c++)this.FSections[h].Pages[c].FilmTop>=l&&(c>0?(this.FDisplayLastSection=h,this.FSections[this.FDisplayLastSection].DisplayLastPageIndex=c-1):(this.FDisplayLastSection=h-1,this.FSections[this.FDisplayLastSection].DisplayLastPageIndex=this.FSections[h-1].PageCount-1),a=!0);if(a)break;e=0}this.FDisplayLastSection<0&&(this.FDisplayLastSection=this.FSections.count-1,this.FSections[this.FDisplayLastSection].DisplayLastPageIndex=this.FSections[this.FDisplayLastSection].PageCount-1)}this.FDisplayFirstSection>=0&&this.FDisplayLastSection<0&&(this.FDisplayLastSection=this.FSections.count-1,this.FSections[this.FDisplayLastSection].DisplayLastPageIndex=this.FSections[this.FDisplayLastSection].PageCount-1)}else{for(var u=0;u<=this.FSections.count-1;u++){for(var f=0;f<this.FSections[u].PageCount;f++)if(this.FSections[u].ViewModel===fo.Film?n+=this.ZoomIn(this.FPagePadding+this.FSections[u].PaperHeightPix):n+=this.ZoomIn(this.FSections[u].GetPageHeight(f)),n>this.FVScrollBar.position){e=f;break}if(e>=0){this.FDisplayFirstSection=u,this.FSections[this.FDisplayFirstSection].DisplayFirstPageIndex=e;break}}if(this.FDisplayFirstSection>=0){for(var d=this.FVScrollBar.position+this.FViewHeight,m=this.FDisplayFirstSection;m<=this.FSections.count-1;m++){for(var S=e;S<this.FSections[m].PageCount;S++){if(!(n<d)){i=S;break}this.FSections[m].ViewModel===fo.Film?n+=this.ZoomIn(this.FPagePadding+this.FSections[m].PaperHeightPix):n+=this.ZoomIn(this.FSections[m].GetPageHeight(S))}if(i>=0){this.FDisplayLastSection=m,this.FSections[this.FDisplayLastSection].DisplayLastPageIndex=i;break}e=0}this.FDisplayLastSection<0&&(this.FDisplayLastSection=this.FSections.count-1,this.FSections[this.FDisplayLastSection].DisplayLastPageIndex=this.FSections[this.FDisplayLastSection].PageCount-1)}}if(this.FDisplayFirstSection<0||this.FDisplayLastSection<0);else if(this.FDisplayFirstSection!==this.FDisplayLastSection){this.FSections[this.FDisplayFirstSection].DisplayLastPageIndex=this.FSections[this.FDisplayFirstSection].PageCount-1,this.FSections[this.FDisplayLastSection].DisplayFirstPageIndex=0;for(var p=this.FDisplayFirstSection+1;p<this.FDisplayLastSection;p++)this.FSections[p].DisplayFirstPageIndex=0,this.FSections[p].DisplayLastPageIndex=this.FSections[p].PageCount-1}}},{key:"UpdateViewRect",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(this.FStyle.States.Contain(oh.Destroying)||0!==this.FUpdateCount||(this.CalcDisplaySectionAndPage(),this.FDisplayFirstSection<0||this.FStyle.UpdateInfo.DragingSelected))){this.FDataBmpCanvas.save();try{this.FDataBmpCanvas.clipRect(t),this.FViewModel===fo.Film?this.FDataBmpCanvas.brush.color=this.color:this.FDataBmpCanvas.brush.color=this.FStyle.BackgroundColor,this.FDataBmpCanvas.fillBounds(0,0,this.FViewWidth,this.FViewHeight);var i=new eu;try{i.ScaleX=this.FZoom,i.ScaleY=this.FZoom,i.Zoom=this.FZoom,i.ViewModel=this.FViewModel,i.WindowWidth=this.FViewWidth,i.WindowHeight=this.FViewHeight,i.DPI=En.PixelsPerInchX,i.Print=this.FPrintView,i.ReadOnly=this.ReadOnly,i.ReadOnlyViewPrint=this.ReadOnlyViewPrint,i.Animation=e;var n=i.scaleCanvas(this.FDataBmpCanvas);try{this.DoPaintViewBefor(this.FDataBmpCanvas,i),this.FAnnotatePre.DrawCount>0&&this.FAnnotatePre.ClearDrawAnnotate();for(var o=0,s=this.FDisplayFirstSection;s<=this.FDisplayLastSection;s++)i.SectionIndex=s,o=this.ZoomOut(this.FVScrollBar.position)-this.GetSectionTopFilm(s),this.FSections[s].PaintDisplayPaper(this.GetSectionDrawLeft(s)-this.ZoomOut(this.FHScrollBar.position),o,this.FDataBmpCanvas,i);i.PaintTopItems(this.FDataBmpCanvas),this.DoPaintViewAfter(this.FDataBmpCanvas,i),!i.Print&&null!==this.FCaret&&this.FCaret.DisFocus&&(this.FDataBmpCanvas.pen.color="#808080",this.FDataBmpCanvas.pen.style=_t.Solid,this.FDataBmpCanvas.pen.width=this.ZoomOut(this.FCaret.Width),this.FDataBmpCanvas.drawLineDriect(this.ZoomOut(this.FCaret.X),this.ZoomOut(this.FCaret.Y),this.ZoomOut(this.FCaret.X),this.ZoomOut(this.FCaret.Y+this.FCaret.Height)))}finally{i.restoreCanvasScale(this.FDataBmpCanvas,n)}}finally{i=null}}finally{this.FDataBmpCanvas.restore()}this.updateRect(t)}}},{key:"BeginUpdate",value:function(){this.FUpdateCount++}},{key:"EndUpdate",value:function(){this.FUpdateCount>0&&this.FUpdateCount--,0===this.FUpdateCount&&(this.FStyle.UpdateInfoRePaint(),this.DoMapChanged())}},{key:"BeginFormat",value:function(){this.FFormatCount++}},{key:"EndFormat",value:function(){this.FFormatCount>0&&this.FFormatCount--,this.FormatData()}},{key:"UndoGroupBegin",value:function(){if(this.FUndoList.Enable){var t=this.ActiveSection.ActiveData;this.FUndoList.UndoGroupBegin(t.SelectInfo.StartItemNo,t.SelectInfo.StartItemOffset)}}},{key:"UndoGroupEnd",value:function(){if(this.FUndoList.Enable){var t=this.ActiveSection.ActiveData;this.FUndoList.UndoGroupEnd(t.SelectInfo.StartItemNo,t.SelectInfo.StartItemOffset)}}},{key:"GetActiveItem",value:function(){return this.ActiveSection.GetActiveItem()}},{key:"GetTopLevelItem",value:function(){return this.ActiveSection.GetTopLevelItem()}},{key:"GetTopLevelRectItem",value:function(){return this.ActiveSection.GetTopLevelRectItem()}},{key:"GetTopLevelTable",value:function(){for(var t=this.ActiveSection.ActiveData,e=null,i=t.GetActiveItem();i.StyleNo===oo.Table&&i.Active&&null!==(t=(e=i).GetActiveData());)i=t.GetActiveItem();return e}},{key:"GetTopLevelDrawItem",value:function(){return this.ActiveSection.GetTopLevelDrawItem()}},{key:"GetActivePageIndex",value:function(){return this.GetPageIndexBySectionPageIndex(this.FActiveSectionIndex,this.ActiveSection.ActivePageIndex)}},{key:"GetPagePreviewFirst",value:function(){for(var t=0,e=0;e<=this.ActiveSectionIndex-1;e++)t+=this.FSections[e].PageCount;return t+this.FSections[this.FActiveSectionIndex].DisplayFirstPageIndex}},{key:"GetPageCount",value:function(){for(var t=0,e=0;e<=this.FSections.count-1;e++)t+=this.FSections[e].PageCount;return t}},{key:"PageUp",value:function(){this.DoPageUp(this)}},{key:"PageDown",value:function(){this.DoPageDown(this)}},{key:"GetSectionDrawLeft",value:function(t){var e=0;if(this.FViewModel===fo.Film)switch(this.FViewAlign){case Su.Left:e=this.ZoomIn(this.FPagePadding);break;case Su.Center:e=this.FMultiplePage?this.FSections[t].Pages[0].FilmLeft:this.AnnotateDisplay()?Math.max(Math.trunc((this.FViewWidth-this.ZoomIn(this.FSections[t].PaperWidthPix+Yl.AnnotationWidth))/2),this.ZoomIn(this.FPagePadding)):Math.max(Math.trunc((this.FViewWidth-this.ZoomIn(this.FSections[t].PaperWidthPix))/2),this.ZoomIn(this.FPagePadding));break;case Su.Right:e=this.FMultiplePage?this.FSections[t].Pages[0].FilmLeft:this.AnnotateDisplay()?Math.max(this.FViewWidth-this.ZoomIn(this.FSections[t].PaperWidthPix+Yl.AnnotationWidth+this.FPagePadding),this.ZoomIn(this.FPagePadding)):Math.max(this.FViewWidth-this.ZoomIn(this.FSections[t].PaperWidthPix+this.FPagePadding),this.ZoomIn(this.FPagePadding))}else this.FViewModel==fo.Page&&(e=Math.max((this.FViewWidth-this.ZoomIn(this.FSections[t].PaperWidthPix))/2,this.ZoomIn(this.FPagePadding)));return e=this.ZoomOut(e)}},{key:"GetFormatPointToViewCoord",value:function(t){var e=this.ActiveSection,i=e.ActivePageIndex;return e.ActiveData==e.Page&&(i=e.GetPageIndexByFormat(t.y)),this.GetSectionFormatPointToViewCoord(t,this.FActiveSectionIndex,i)}},{key:"GetSectionFormatPointToViewCoord",value:function(t,e,i){var n=et.Create(t.x,t.y),o=this.FSections[e];return this.FMultiplePage&&o.ViewModel===fo.Film?(n.x=this.ZoomIn(o.Pages[i].FilmLeft+o.GetPageMarginLeft(i)+n.x)-this.FHScrollBar.position,o.ActiveData===o.Header?n.y=this.ZoomIn(o.Pages[i].FilmTop+this.FPagePadding+o.GetHeaderPageDrawTop(i)+n.y)-this.FVScrollBar.position:o.ActiveData===o.Footer?n.y=this.ZoomIn(o.Pages[i].FilmTop+this.FPagePadding+o.PaperHeightPix-o.GetFooterAreaHeight(i)+n.y)-this.FVScrollBar.position:n.y=this.ZoomIn(o.Pages[i].FilmTop+this.FPagePadding+o.GetHeaderAreaHeight(i)+n.y-o.GetPageDataFmtTop(i))-this.FVScrollBar.position,n):(n.x=this.ZoomIn(this.GetSectionDrawLeft(e)+(o.GetPageMarginLeft(i)+n.x))-this.FHScrollBar.position,o.ActiveData==o.Header?n.y=this.ZoomIn(this.GetSectionTopFilm(e)+o.GetPageTopFilm(i)+o.GetHeaderPageDrawTop(i)+n.y)-this.FVScrollBar.position:o.ActiveData==o.Footer?n.y=this.ZoomIn(this.GetSectionTopFilm(e)+o.GetPageTopFilm(i)+o.PaperHeightPix-o.GetFooterAreaHeight(i)+n.y)-this.FVScrollBar.position:o.ViewModel==fo.Film?n.y=this.ZoomIn(this.GetSectionTopFilm(e)+o.GetPageTopFilm(i)+o.GetHeaderAreaHeight(i)+n.y-o.GetPageDataFmtTop(i))-this.FVScrollBar.position:n.y=this.ZoomIn(this.GetSectionTopFilm(e)+o.GetPageTopFilm(i)+n.y-o.GetPageDataFmtTop(i))-this.FVScrollBar.position,n)}},{key:"GetTopLevelDrawItemViewCoord",value:function(){var t=this.ActiveSection.GetTopLevelDrawItemCoord();return t=this.GetFormatPointToViewCoord(t)}},{key:"GetTopLevelRectDrawItemViewCoord",value:function(){var t=this.ActiveSection.GetTopLevelRectDrawItemCoord();return t=this.GetFormatPointToViewCoord(t)}},{key:"SetActiveItemText",value:function(t){this.ActiveSection.SetActiveItemText(t)}},{key:"FormatSection",value:function(t){this.FFormatCount>0||(this.FSections[t].FormatData(),this.FSections[t].BuildSectionPages(0),this.FStyle.UpdateInfoRePaint(),this.FStyle.UpdateInfoReCaret(),this.DoMapChanged())}},{key:"ActiveSectionTopLevelData",value:function(){return this.ActiveSection.ActiveData.GetTopLevelData()}},{key:"GetSectionTopFilm",value:function(t){if(this.FMultiplePage&&this.FViewModel===fo.Film)return this.FSections[t].Pages[0].FilmTop;for(var e=0,i=0;i<=t-1;i++)e+=this.FSections[i].GetFilmHeight();return e}},{key:"SaveToFile",value:function(t){}},{key:"LoadFromFile",value:function(t){var e=this,i=!1;return ht.loadFromFile(t,(function(n){(i=e.LoadFromStream(n))&&(e.FFileName=t)})),i}},{key:"SaveToText",value:function(){for(var t=this.FSections[0].SaveToText(),e=1;e<=this.FSections.count-1;e++)t=t+Yl.sLineBreak+this.FSections[e].SaveToText();return t}},{key:"SaveToImage",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=new eu;e.ScaleX=1,e.ScaleY=1,e.Zoom=1,e.Print=!0,e.DPI=En.PixelsPerInchX,e.ViewModel=fo.Film;var i=0,n=0;if(t){for(var o=0;o<this.FSections.count;o++)n+=this.FSections[o].PaperHeightPix*this.FSections[o].PageCount,i<this.FSections[o].PaperWidthPix&&(i=this.FSections[o].PaperWidthPix);e.WindowWidth=i,e.WindowHeight=n;var s=document.createElement("canvas");s.setAttribute("id","hclH5canvas_"+this.hcl.system.Timestamp),s.width=i,s.height=n,s.style.position="absolute",s.style.left="0px",s.style.top="0px",s.style.display="none",document.body.appendChild(s);for(var r,a=new zt(this.hcl,s.getContext("2d")),l=0,h=0,c=0,u=0;u<this.PageCount;u++){l=(r=this.GetSectionPageIndexByPageIndex(u,h)).result,h=r.pageIndex,n=this.FSections[l].PaperHeightPix,a.brush.color=Ft.White,a.fillRect(nt.Create(0,c,i,c+n));var f=e.scaleCanvas(a);try{this.FSections[l].paintPaper(h,0,c,a,e),c+=n}finally{e.restoreCanvasScale(a,f)}}var d=new Array;return d.push({width:i,height:s.height,dataurl:s.toDataURL()}),document.body.removeChild(s),d}var m=document.createElement("canvas");m.setAttribute("id","hclH5SaveImageCanvas_"+this.hcl.system.Timestamp),m.style.position="absolute",m.style.left="0px",m.style.top="0px",m.style.display="none",document.body.appendChild(m);for(var S,p=new Array,y=0,F=0,v=0;v<this.PageCount;v++){y=(S=this.GetSectionPageIndexByPageIndex(v,F)).result,F=S.pageIndex,m.width=this.FSections[y].PaperWidthPix,m.height=this.FSections[y].PaperHeightPix;var I=new zt(this.hcl,m.getContext("2d"));I.brush.color=Ft.White,I.fillRect(nt.Create(0,0,m.width,m.height)),e.WindowWidth=m.width,e.WindowHeight=m.height;var g=e.scaleCanvas(I);try{I.brush.color=Ft.White,I.fillRect(nt.Create(0,0,m.width,m.height)),this.FSections[y].paintPaper(F,0,0,I,e)}finally{e.restoreCanvasScale(I,g)}p.push({width:m.width,height:m.height,dataurl:m.toDataURL()})}return document.body.removeChild(m),p}},{key:"LoadFromText",value:function(t){if(this.Clear(),this.FStyle.Initialize(),""==t)return!1;this.FStyle.States.Include(oh.Saving);try{return this.ActiveSection.InsertText(t)}finally{this.FStyle.States.Exclude(oh.Saving)}}},{key:"SaveToTextFile",value:function(t,e){}},{key:"LoadFromTextFile",value:function(t,e){}},{key:"SaveToTextStream",value:function(t,e){}},{key:"LoadFromTextStream",value:function(t,e){}},{key:"SaveToStream",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.hcl.hc.USESCRIPT&&!e&&this.DisSelect(),this.FStyle.States.Include(oh.Saving);try{Yl._SaveFileFormatAndVersion(t),t.writeByte(Yl.HC_STREAM_VIEW),this.DoSaveStreamBefor(t);var n=i;null==n&&((n=new Set([])).add(ql.Header),n.add(ql.Footer),n.add(ql.Page)),e||(this.FUndoList.clear(),this.DeleteUnUsedStyle(this.FStyle,this.FSections,new Set([ql.Header,ql.Page,ql.Footer]))),this.FStyle.SaveToStream(t),this.DoSaveMutMargin(t);var o=0;this.FBKImageVisible&&(o|=128),this.BKImagePrintVisible&&(o|=64),t.writeByte(o),t.writeByte(this.FBKImageLayout),Yl.HCSaveImageToStream(t,this.BKImage),t.writeUInt32(this.FNextAnnotateID),t.writeByte(this.FSections.count);for(var s=0;s<=this.FSections.count-1;s++)this.FSections[s].SaveToStream(t,n);this.DoSaveStreamAfter(t)}finally{this.FStyle.States.Exclude(oh.Saving)}}},{key:"DoLoadProceDelegate",value:function(t){var e=!1;this.BeginUpdate();try{this.FUndoList.clear(),this.FUndoList.SaveState();try{this.FUndoList.Enable=!1,this.FStyle.States.Include(oh.Loading);try{t()}finally{this.FStyle.States.Exclude(oh.Loading)}e=!0,this.DoViewResize()}finally{this.FUndoList.RestoreState()}}finally{this.EndUpdate()}return e}},{key:"LoadFromStream",value:function(t){var e=this;return this.DoLoadProceDelegate((function(){e.Clear(),t.position=0;e.DoLoadFromStream(!1,t,e.FStyle,(function(i){var n=t.readByte();e.FSections[0].LoadFromStream(t,e.FStyle,i);for(var o=1;o<n;o++){var s=e.NewDefaultSection();s.LoadFromStream(t,e.FStyle,i),e.FSections.add(s)}}))}))}},{key:"InsertSectionFromFileStream",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=function(){t.Position=0;var n=new oo(e.hcl);e.DoLoadFromStream(!0,t,n,(function(o){for(var s=t.readByte(),r=0;r<s;r++){var a=e.NewDefaultSection();a.LoadFromStream(t,n,o),i<0?e.FSections.add(a):e.FSections.insert(i+r,a)}}))};return this.DoLoadProceDelegate(n)}},{key:"SaveToXml",value:function(){this.FUndoList.clear();var t=new Set([]);t.add(ql.Header),t.add(ql.Footer),t.add(ql.Page),this.DeleteUnUsedStyle(this.FStyle,this.FSections,t);var e=new qn,i=e.CreateNode("HCView");i.SetAttribute("EXT",Yl.HC_EXT),i.SetAttribute("ver",Yl.HC_FileVersion),i.SetAttribute("lang",Yl.HC_PROGRAMLANGUAGE.toString()),this.DoSaveXmlDocument(i),e.AppendChild(i);var n,o=e.CreateNode("style");this.FStyle.ToXml(o),i.AppendChild(o),(o=e.CreateNode("sections")).SetAttribute("count",this.FSections.count.toString()),i.AppendChild(o);for(var s=0;s<this.FSections.count;s++)n=e.CreateNode("sc"),this.FSections[s].ToXml(n),o.AppendChild(n);return e.Text}},{key:"SaveToHtml",value:function(){this.FUndoList.clear();var t=new Set([]);t.add(ql.Header),t.add(ql.Footer),t.add(ql.Page),this.DeleteUnUsedStyle(this.FStyle,this.FSections,t);var e=new at;e.append("<!DOCTYPE HTML>"),e.append("<html>"),e.append("<head>"),e.append("<title>"),e.append("</title>"),e.append(this.FStyle.ToCSS()),e.append("</head>"),e.append('<body bgcolor="'+Yl.HCColorToHtml(this.hcl,this.color)+'">');for(var i=0;i<this.FSections.count;i++)e.append(this.FSections[i].ToHtml());return e.append("</body>"),e.append("</html>"),e.text}},{key:"SelectToHtml",value:function(){var t=new at;return t.append("<!DOCTYPE HTML>"),t.append("<html>"),t.append("<head>"),t.append("<title>"),t.append("</title>"),t.append(this.FStyle.ToCSS()),t.append("</head>"),t.append("<body>"),t.append(this.ActiveSection.ActiveData.SelectToHtml()),t.append("</body>"),t.append("</html>"),t.text}},{key:"SectionsToJSONString",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s='"Sections":[',r=0;r<this.FSections.count;r++)s+='{"SecIndex":'+r+","+this.FSections[r].ToJSONString(t,e,i,n,o)+"},";return","===s[s.length-1]&&(s=s.substring(0,s.length-1)),s+"]"}},{key:"SectionsToJSONObject",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=this.SectionsToJSONString(t,e,i,n,o);return JSON.parse("{"+s+"}")}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return this.SectionsToJSONString(t,e,i,n,o)}},{key:"GetSectionPageIndexByPageIndex",value:function(t,e){for(var i=-1,n=0,o=0;o<=this.FSections.count-1;o++){if(n+this.FSections[o].PageCount>t){i=o,e=t-n;break}n+=this.FSections[o].PageCount}return{pageIndex:e,result:i}}},{key:"GetPageIndexBySectionPageIndex",value:function(t,e){for(var i=e,n=0;n<t;n++)i+=this.FSections[n].PageCount;return i}},{key:"Print",value:function(){return this.Print("")}},{key:"PrintCopies",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.PrintRange(t,0,this.PageCount-1,e)}},{key:"PrintRange",value:function(t,e,i,n){for(var o=new Array(i-e+1),s=e;s<=i;s++)o[s-e]=s;return this.PrintPages(t,n,o)}},{key:"PrintPages",value:function(t,e,i){}},{key:"PrintOdd",value:function(t){var e=new Array(0);return this.PrintPages(t,1,e)}},{key:"PrintEven",value:function(t){var e=new Array(0);return this.PrintPages(t,1,e)}},{key:"PrintCurPageByActiveLine",value:function(t,e,i){}},{key:"PrintCurPageByItemRange",value:function(t,e,i,n,o,s,r){}},{key:"PrintCurPageSelected",value:function(t,e,i){return this.ActiveSection.ActiveData.SelectExists(!1)?this.PrintCurPageByItemRange(t,e,i,this.ActiveSection.ActiveData.SelectInfo.StartItemNo,this.ActiveSection.ActiveData.SelectInfo.StartItemOffset,this.ActiveSection.ActiveData.SelectInfo.EndItemNo,this.ActiveSection.ActiveData.SelectInfo.EndItemOffset):TPrintResult.prNoSupport}},{key:"MergeTableSelectCells",value:function(){return this.ActiveSection.MergeTableSelectCells()}},{key:"TableApplyContentAlign",value:function(t){return this.ActiveSection.TableApplyContentAlign(t)}},{key:"Undo",value:function(){this.FStyle.States.Include(oh.Undoing);try{if(this.FUndoList.Enable)try{this.FUndoList.Enable=!1,this.BeginUpdate();try{this.FUndoList.Undo()}finally{this.EndUpdate()}}finally{this.FUndoList.Enable=!0}}finally{this.FStyle.States.Exclude(oh.Undoing)}}},{key:"Redo",value:function(){this.FStyle.States.Include(oh.Redoing);try{if(this.FUndoList.Enable)try{this.FUndoList.Enable=!1,this.BeginUpdate();try{this.FUndoList.Redo()}finally{this.EndUpdate()}}finally{this.FUndoList.Enable=!0}}finally{this.FStyle.States.Exclude(oh.Redoing)}}},{key:"Search",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.ActiveSection.Search(t,e,i);if(n){var o=this.GetTopLevelDrawItemViewCoord(),s=this.ActiveSectionTopLevelData(),r=s.GetDrawItemNoByOffset(s.SelectInfo.StartItemNo,s.SelectInfo.StartItemOffset),a=s.GetDrawItemNoByOffset(s.SelectInfo.EndItemNo,s.SelectInfo.EndItemOffset),l=new nt;r==a?(l.left=o.x+this.ZoomIn(s.GetDrawItemOffsetWidth(r,s.SelectInfo.StartItemOffset-s.DrawItems[r].CharOffs+1)),l.top=o.y,l.right=o.x+this.ZoomIn(s.GetDrawItemOffsetWidth(a,s.SelectInfo.EndItemOffset-s.DrawItems[a].CharOffs+1)),l.bottom=o.y+this.ZoomIn(s.DrawItems[a].rect.height)):e?(l.left=o.x+this.ZoomIn(s.DrawItems[r].rect.left-s.DrawItems[a].rect.left+s.GetDrawItemOffsetWidth(r,s.SelectInfo.StartItemOffset-s.DrawItems[r].CharOffs+1)),l.top=o.y+this.ZoomIn(s.DrawItems[r].rect.top-s.DrawItems[a].rect.top),l.right=o.x+this.ZoomIn(s.DrawItems[r].rect.left-s.DrawItems[a].rect.left+s.DrawItems[r].rect.width),l.bottom=l.top+this.ZoomIn(s.DrawItems[r].rect.height)):(l.left=o.x,l.top=o.y,l.right=o.x+this.ZoomIn(s.GetDrawItemOffsetWidth(a,s.SelectInfo.EndItemOffset-s.DrawItems[a].CharOffs+1)),l.bottom=o.y+this.ZoomIn(s.DrawItems[a].rect.height)),l.top<0?this.FVScrollBar.position=this.FVScrollBar.position+l.top:l.bottom>this.FViewHeight&&(this.FVScrollBar.position=this.FVScrollBar.position+l.bottom-this.FViewHeight),l.left<0?this.FHScrollBar.position=this.FHScrollBar.position+l.left:l.right>this.FViewWidth&&(this.FHScrollBar.position=this.FHScrollBar.position+l.right-this.FViewWidth)}return n}},{key:"Replace",value:function(t){return this.ActiveSection.Replace(t)}},{key:"NumberOfWords",value:function(){return this.SaveToText().length}},{key:"CanEdit",value:function(){return this.ActiveSectionTopLevelData().CanEdit()}},{key:"AnnotateDisplay",value:function(){return this.FAnnotatePre.Count>0&&this.FStyle.AnnotateVisible}},{key:"ConvertToCurVersion",value:function(){this.FStyle.FormatVersion!=Yl.HCFormatVersion&&(this.FStyle.ConvertToCurVersion(),this.FormatData())}},{key:"GetAnnotateVisible",value:function(){return this.FStyle.AnnotateVisible}},{key:"SetAnnotateVisible",value:function(t){this.FStyle.AnnotateVisible!==t&&(this.FStyle.AnnotateVisible=t,this.UpdateView())}},{key:"FileName",get:function(){return this.FFileName},set:function(t){this.FFileName=t}},{key:"Style",get:function(){return this.FStyle}},{key:"SymmetryMargin",get:function(){return this.GetSymmetryMargin()},set:function(t){this.SetSymmetryMargin(t)}},{key:"ActivePageIndex",get:function(){return this.GetActivePageIndex()}},{key:"PagePreviewFirst",get:function(){return this.GetPagePreviewFirst()}},{key:"PageCount",get:function(){return this.GetPageCount()}},{key:"ActiveSectionIndex",get:function(){return this.FActiveSectionIndex},set:function(t){this.SetActiveSectionIndex(t)}},{key:"ActiveSection",get:function(){return this.GetActiveSection()}},{key:"HScrollBar",get:function(){return this.FHScrollBar}},{key:"VScrollBar",get:function(){return this.FVScrollBar}},{key:"HScrollBarAutoVisible",get:function(){return this.FHScrollBarAutoVisible},set:function(t){this.FHScrollBarAutoVisible!=t&&(this.FHScrollBarAutoVisible=t,this.FHScrollBar.visible=!t||this.FHScrollBar.pageSize<this.FHScrollBar.range)}},{key:"CurStyleNo",get:function(){return this.GetCurStyleNo()}},{key:"CurParaNo",get:function(){return this.GetCurParaNo()}},{key:"Zoom",get:function(){return this.FZoom},set:function(t){this.SetZoom(t)}},{key:"Sections",get:function(){return this.FSections}},{key:"ShowLineActiveMark",get:function(){return this.GetShowLineActiveMark()},set:function(t){this.SetShowLineActiveMark(t)}},{key:"ShowLineNo",get:function(){return this.GetShowLineNo()},set:function(t){this.SetShowLineNo(t)}},{key:"ShowUnderLine",get:function(){return this.GetShowUnderLine()},set:function(t){this.SetShowUnderLine(t)}},{key:"IsChanged",get:function(){return this.FIsChanged},set:function(t){this.SetIsChanged(t)}},{key:"PagePadding",get:function(){return this.FPagePadding},set:function(t){this.SetPagePadding(t)}},{key:"AnnotatePre",get:function(){return this.FAnnotatePre}},{key:"ViewWidth",get:function(){return this.FViewWidth}},{key:"ViewHeight",get:function(){return this.FViewHeight}},{key:"ViewAlign",get:function(){return this.FViewAlign},set:function(t){this.SetViewAlign(t)}},{key:"AnnotateVisible",get:function(){return this.GetAnnotateVisible()},set:function(t){this.SetAnnotateVisible(t)}},{key:"ViewModel",get:function(){return this.FViewModel},set:function(t){this.SetViewModel(t)}},{key:"MultiplePage",get:function(){return this.FMultiplePage},set:function(t){this.SetMultiplePage(t)}},{key:"PrintView",get:function(){return this.FPrintView},set:function(t){this.SetPrintView(t)}},{key:"AutoZoom",get:function(){return this.FAutoZoom},set:function(t){this.SetAutoZoom(t)}},{key:"ReadOnly",get:function(){return this.GetReadOnly()},set:function(t){this.SetReadOnly(t)}},{key:"PageNoFormat",get:function(){return this.ActiveSection.PageNoFormat},set:function(t){this.ActiveSection.PageNoFormat=t}},{key:"BKImageVisible",get:function(){return this.FBKImageVisible},set:function(t){this.SetBKImageVisible(t)}},{key:"BKImageLayout",get:function(){return this.FBKImageLayout},set:function(t){this.SetBKImageLayout(t)}}]),o}(Bi);function yu(t){return Fu.apply(this,arguments)}function Fu(){return(Fu=c()(I.a.mark((function t(e){var i,n,o,s,r,a,l,h,c,u,f=arguments;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.length>1&&void 0!==f[1]?f[1]:[],n=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:new DataTransfer}),t.next=4,navigator.clipboard.read();case 4:o=t.sent,s=o[0],r=!1,a=0;case 8:if(!(a<s.types.length)){t.next=34;break}if(l=s.types[a],!(i.length>0)){t.next=22;break}r=!1,h=0;case 13:if(!(h<i.length)){t.next=20;break}if(i[h]!==l){t.next=17;break}return r=!0,t.abrupt("break",20);case 17:h++,t.next=13;break;case 20:t.next=23;break;case 22:r=!0;case 23:if(!r){t.next=31;break}return t.next=26,s.getType(l);case 26:return c=t.sent,t.next=29,vu(c);case 29:u=t.sent,n.clipboardData.items.add(u,l);case 31:a++,t.next=8;break;case 34:n.clipboardData.items.length>0&&e.dispatchEvent(n);case 35:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function vu(t){return new Promise((function(e,i){var n=new FileReader;n.onloadend=function(){e(n.result)},n.onerror=function(){i(n.error)},n.readAsText(t)}))}function Iu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var gu=function(t){m()(i,t);var e=Iu(i);function i(t,n,o,s,a,l){var h;return r()(this,i),(h=e.call(this,t,n,o,s,a,l)).StyleNo=mh.EMRSTYLE_YUEJING,h.DeleteAllow=!0,h.EditProtect=!1,h.AllocValue=!1,h.Propertys=new rt,h}return l()(i,[{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.AllocValue=!0}},{key:"GetLastVersion",value:function(){return 2}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.Propertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"===t?this.EditProtect=L.parseBooleanDef(e,this.EditProtect):"DeleteAllow"===t?this.DeleteAllow=L.parseBooleanDef(e,this.DeleteAllow):"AllocValue"===t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.Propertys,t,e)}},{key:"MouseDown",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseDown",this).call(this,t)}},{key:"MouseMove",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseMove",this).call(this,t)}},{key:"MouseUp",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseUp",this).call(this,t)}},{key:"KeyDown",value:function(t){this.EditProtect||f()(F()(i.prototype),"KeyDown",this).call(this,t)}},{key:"KeyPress",value:function(t){this.EditProtect?t.keyCode=0:f()(F()(i.prototype),"KeyPress",this).call(this,t)}},{key:"AcceptAction",value:function(t,e,n){return!(n===rh.DeleteItem&&!this.DeleteAllow)&&f()(F()(i.prototype),"AcceptAction",this).call(this,t,e,n)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.DeleteAllow=t.DeleteAllow,this.EditProtect=t.EditProtect,this.AllocValue=t.AllocValue,this.Propertys.assign(t.Propertys)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n);var o=0;this.EditProtect&&(o|=128),this.DeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){if(f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FVersion>0){var o=t.readByte();this.EditProtect=L.isOdd(o>>7),this.DeleteAllow=L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4)}else this.EditProtect=!1,this.DeleteAllow=!0,this.AllocValue=!1;if(this.FVersion>1){var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.Propertys)}}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t),null!=t.LeftText&&(this.LeftText=t.LeftText),null!=t.TopText&&(this.TopText=t.TopText),null!=t.RightText&&(this.RightText=t.RightText),null!=t.BottomText&&(this.BottomText=t.BottomText)}},{key:"GetMenarcheAge",value:function(){return this.LeftText}},{key:"SetMenarcheAge",value:function(t){this.LeftText=t}},{key:"GetMenstrualDuration",value:function(){return this.TopText}},{key:"SetMenstrualDuration",value:function(t){this.TopText=t}},{key:"GetMenstrualCycle",value:function(){return this.BottomText}},{key:"SetMenstrualCycle",value:function(t){this.BottomText=t}},{key:"GetMenstrualPause",value:function(){return this.RightText}},{key:"SetMenstrualPause",value:function(t){this.RightText=t}},{key:"ToXmlEmr",value:function(t){}},{key:"ParseXmlEmr",value:function(t){}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"MenarcheAge":"'+this.MenarcheAge+'","MenstrualDuration":"'+this.MenstrualDuration+'","MenstrualCycle":"'+this.MenstrualCycle+'","MenstrualPause":"'+this.MenstrualPause+'"'}},{key:"MenarcheAge",get:function(){return this.GetMenarcheAge()},set:function(t){this.SetMenarcheAge(t)}},{key:"MenstrualDuration",get:function(){return this.GetMenstrualDuration()},set:function(t){this.SetMenstrualDuration(t)}},{key:"MenstrualCycle",get:function(){return this.GetMenstrualCycle()},set:function(t){this.SetMenstrualCycle(t)}},{key:"MenstrualPause",get:function(){return this.GetMenstrualPause()},set:function(t){this.SetMenstrualPause(t)}}]),i}(na);function Cu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var wu=function(t){m()(i,t);var e=Cu(i);function i(t,n,o,s,a){var l;return r()(this,i),(l=e.call(this,t,n,s,a)).StyleNo=mh.EMRSTYLE_CHINESEMED,l.FLeftRect=new nt,l.FLeftText=o,l.DeleteAllow=!0,l.EditProtect=!1,l.AllocValue=!1,l.Propertys=new rt,l}return l()(i,[{key:"GetLastVersion",value:function(){return 2}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.Propertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"===t?this.EditProtect=L.parseBooleanDef(e,this.EditProtect):"DeleteAllow"===t?this.DeleteAllow=L.parseBooleanDef(e,this.DeleteAllow):"AllocValue"===t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.Propertys,t,e)}},{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.AllocValue=!0}},{key:"GetCaretInfo",value:function(t){this.FActiveArea===Xl.Left?(this.OwnerData.Style.TextStyles[this.TextStyleNo].ApplyStyle(this.OwnerData.Style.TempCanvas),t.Height=this.FLeftRect.bottom-this.FLeftRect.top,t.X=this.FLeftRect.left+this.OwnerData.Style.TempCanvas.textWidth(this.FLeftText.substr(0,this.FCaretOffset)),t.Y=this.FLeftRect.top):f()(F()(i.prototype),"GetCaretInfo",this).call(this,t)}},{key:"GetExpressArea",value:function(t,e){var n=f()(F()(i.prototype),"GetExpressArea",this).call(this,t,e);return n===Xl.None&&this.FLeftRect.pointInAt(t,e)&&(n=Xl.Left),n}},{key:"InsertText",value:function(t){return!this.EditProtect&&(this.FActiveArea===Xl.Left?(this.LeftText=L.stringInsert(this.FLeftText,this.FCaretOffset,t),this.FCaretOffset+=t.length,this.FormatDirty(),!0):f()(F()(i.prototype),"InsertText",this).call(this,t))}},{key:"GetAreaOffset",value:function(t,e){return this.FActiveArea===Xl.Left?(this.OwnerData.Style.TextStyles[this.TextStyleNo].ApplyStyle(this.OwnerData.Style.TempCanvas),Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,this.FLeftText,e-this.FLeftRect.left)):f()(F()(i.prototype),"GetAreaOffset",this).call(this,t,e)}},{key:"DoBackspaceKeyDown",value:function(){this.FActiveArea===Xl.Left?(this.LeftText=this.BackDeleteChar(this.FLeftText),this.FormatDirty()):f()(F()(i.prototype),"DoBackspaceKeyDown",this).call(this)}},{key:"DoRightKeyDown",value:function(){this.FActiveArea===Xl.Left?this.FCaretOffset<this.FLeftText.length&&this.FCaretOffset++:f()(F()(i.prototype),"DoRightKeyDown",this).call(this)}},{key:"DoDeleteKeyDown",value:function(){this.FActiveArea===Xl.Left?(this.LeftText=this.DeleteChar(this.FLeftText),this.FormatDirty()):f()(F()(i.prototype),"DoDeleteKeyDown",this).call(this)}},{key:"DoEndKeyDown",value:function(){this.FActiveArea===Xl.Left?this.FCaretOffset=this.FLeftText.length:f()(F()(i.prototype),"DoEndKeyDown",this).call(this)}},{key:"MouseDown",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseDown",this).call(this,t)}},{key:"MouseMove",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseMove",this).call(this,t)}},{key:"MouseUp",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseUp",this).call(this,t)}},{key:"KeyDown",value:function(t){this.EditProtect||f()(F()(i.prototype),"KeyDown",this).call(this,t)}},{key:"KeyPress",value:function(t){this.EditProtect?t.keyCode=0:f()(F()(i.prototype),"KeyPress",this).call(this,t)}},{key:"AcceptAction",value:function(t,e,n){return!(n===rh.DeleteItem&&!this.DeleteAllow)&&f()(F()(i.prototype),"AcceptAction",this).call(this,t,e,n)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FLeftText=t.LeftText,this.DeleteAllow=t.DeleteAllow,this.EditProtect=t.EditProtect,this.AllocValue=t.AllocValue,this.Propertys.assign(t.Propertys)}},{key:"FormatToDrawItem",value:function(t,e){var i=t.Style;i.TextStyles[this.TextStyleNo].ApplyStyle(i.TempCanvas);var n=i.TextStyles[this.TextStyleNo].FontHeight,o=Math.max(i.TempCanvas.textWidth(this.FLeftText),this.FPadding);i.TextStyles[this.TextStyleNo].ApplySupSubStyle(i.TempCanvas);var s=i.TempCanvas.textHeight("H"),r=Math.max(i.TempCanvas.textWidth(this.FSupText),this.FPadding),a=Math.max(i.TempCanvas.textWidth(this.FSubText),this.FPadding);i.ApplyTempStyle(oo.Null),this.Width=r>a?r:a,this.Width+=o,this.Height=2*s,this.FLeftRect.resetBounds(0,Math.trunc((this.Height-n)/2),o,n),this.FSupRect.resetBounds(o,0,r,s),this.FSubRect.resetBounds(o,this.Height-s,a,s)}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){if(!a.Print){(this.Active||this.FMouseIn)&&(r.brush.color=Yl.clBtnFace,r.fillRect(e));var l=new nt;this.FActiveArea!==Xl.None&&(this.FActiveArea===Xl.Left?l.resetRect(this.FLeftRect):this.FActiveArea===Xl.Top?l.resetRect(this.FSupRect):this.FActiveArea===Xl.Bottom&&l.resetRect(this.FSubRect),l.offset(e.left,e.top),l.inFlate(2,2),r.pen.color=Ft.Blue,r.pen.Width=1,r.rectangleRect(l)),this.FMouseMoveArea!==Xl.None&&this.FMouseMoveArea!==this.FActiveArea&&(this.FMouseMoveArea===Xl.Left?l.resetRect(this.FLeftRect):this.FMouseMoveArea===Xl.Top?l.resetRect(this.FSupRect):this.FMouseMoveArea===Xl.Bottom&&l.resetRect(this.FSubRect),l.offset(e.left,e.top),l.inFlate(2,2),r.pen.color=Yl.clMedGray,r.rectangleRect(l))}t.TextStyles[this.TextStyleNo].ApplyStyle(r,a.ScaleY/a.Zoom),r.textOut(e.left+this.FLeftRect.left,e.top+this.FLeftRect.top,this.FLeftText),t.TextStyles[this.TextStyleNo].ApplySupSubStyle(r,a.ScaleY/a.Zoom),r.textOut(e.left+this.FSupRect.left,e.top+this.FSupRect.top,this.FSupText),r.textOut(e.left+this.FSubRect.left,e.top+this.FSubRect.top,this.FSubText)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.FLeftText);var o=0;this.EditProtect&&(o|=128),this.DeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FVersion<1&&(this.FVersion=t.readByte()),this.FLeftText=Yl.HCLoadTextFromStream(t,n);var o=t.readByte();if(this.EditProtect=L.isOdd(o>>7),this.DeleteAllow=L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4),this.FVersion>1){var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.Propertys)}}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t),null!=t.LeftText&&(this.FLeftText=t.LeftText)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"LeftText":"'+this.LeftText+'"'}},{key:"LeftText",get:function(){return this.FLeftText},set:function(t){this.FLeftText=t,this.DoChange()}}]),i}(yl);function Au(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Du=function(t){m()(i,t);var e=Au(i);function i(t,n,o,s){var a;return r()(this,i),(a=e.call(this,t,n)).StyleNo=mh.EMRSTYLE_GESTATIONWEEK,a.FWeekRect=new nt,a.FDayRect=new nt,a.FActiveArea=Xl.None,a.FMouseMoveArea=Xl.None,a.DeleteAllow=!0,a.EditProtect=!1,a.AllocValue=!1,a.Propertys=new rt,a.FWeekText=o,a.FDayText=s,a}return l()(i,[{key:"GetLastVersion",value:function(){return 2}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.Propertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"===t?this.EditProtect=L.parseBooleanDef(e,this.EditProtect):"DeleteAllow"===t?this.DeleteAllow=L.parseBooleanDef(e,this.DeleteAllow):"AllocValue"===t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.Propertys,t,e)}},{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.AllocValue=!0}},{key:"GetCaretInfo",value:function(t){if(this.FActiveArea!==Xl.None)switch(this.FActiveArea){case Xl.Left:this.OwnerData.Style.TextStyles[this.TextStyleNo].ApplyStyle(this.OwnerData.Style.TempCanvas),t.Height=this.FWeekRect.bottom-this.FWeekRect.top,t.X=this.FWeekRect.left+this.OwnerData.Style.TempCanvas.textWidth(this.FWeekText.substr(0,this.FCaretOffset)),t.Y=this.FWeekRect.top;break;case Xl.Right:this.OwnerData.Style.TextStyles[this.TextStyleNo].ApplySupSubStyle(this.OwnerData.Style.TempCanvas),t.Height=this.FDayRect.bottom-this.FDayRect.top,t.X=this.FDayRect.left+this.OwnerData.Style.TempCanvas.textWidth(this.FDayText.substr(0,this.FCaretOffset)),t.Y=this.FDayRect.top}else t.Visible=!1}},{key:"GetExpressArea",value:function(t,e){return this.FDayRect.pointInAt(t,e)?Xl.Right:this.FWeekRect.pointInAt(t,e)?Xl.Left:Xl.None}},{key:"GetAreaOffset",value:function(t,e){var i="",n=0;switch(t){case Xl.Left:i=this.FWeekText,n=e-this.FWeekRect.left;break;case Xl.Right:i=this.FDayText,n=e-this.FDayRect.left}return t!==Xl.None?(this.OwnerData.Style.TextStyles[this.TextStyleNo].ApplySupSubStyle(this.OwnerData.Style.TempCanvas),this.OwnerData.Style.ApplyTempStyle(oo.Null),Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,i,n)):-1}},{key:"SetActive",value:function(t){f()(F()(i.prototype),"SetActive",this).call(this,t),t||(this.FActiveArea=Xl.None)}},{key:"MouseDown",value:function(t){if(this.EditProtect)return!1;var e=f()(F()(i.prototype),"MouseDown",this).call(this,t);this.FMouseMoveArea!==this.FActiveArea&&(this.FActiveArea=this.FMouseMoveArea,this.OwnerData.Style.UpdateInfoReCaret());var n=this.GetAreaOffset(this.FActiveArea,t.x);return n!==this.FCaretOffset&&(this.FCaretOffset=n,this.OwnerData.Style.UpdateInfoReCaret()),e}},{key:"MouseMove",value:function(t){if(this.EditProtect)return!1;var e=f()(F()(i.prototype),"MouseMove",this).call(this,t);if(this.FOutSelectInto)this.FMouseMoveArea=Xl.None;else{var n=this.GetExpressArea(t.x,t.y);n!==this.FMouseMoveArea&&(this.FMouseMoveArea=n,this.OwnerData.Style.UpdateInfoRePaint())}return e}},{key:"MouseUp",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseUp",this).call(this,t)}},{key:"KeyDown",value:function(t){if(!this.EditProtect){var e=null;switch(t.keyCode){case Ee:switch(this.FActiveArea){case Xl.Left:e=Yl.HCBackDeleteChar(this.FWeekText,this.FCaretOffset),this.WeekText=e.text,this.FCaretOffset=e.offset;break;case Xl.Right:e=Yl.HCBackDeleteChar(this.FDayText,this.FCaretOffset),this.DayText=e.text,this.FCaretOffset=e.offset}this.FormatDirty();break;case Je:this.FCaretOffset>0?this.FCaretOffset--:this.FActiveArea===Xl.Right&&(this.FActiveArea=Xl.Left,this.FCaretOffset=this.FWeekText.length,this.OwnerData.Style.UpdateInfoRePaint());break;case Ye:var i="";switch(this.FActiveArea){case Xl.Left:i=this.FWeekText;break;case Xl.Right:i=this.FDayText}this.FCaretOffset<i.length?this.FCaretOffset++:this.FActiveArea===Xl.Left&&this.FCaretOffset===this.FWeekText.length&&(this.FActiveArea=Xl.Right,this.FCaretOffset=0,this.OwnerData.Style.UpdateInfoRePaint());break;case Xe:switch(this.FActiveArea){case Xl.Left:var n=Yl.HCDeleteChar(this.FWeekText,this.FCaretOffset);this.WeekText=n.text,this.FCaretOffset=n.offset;break;case Xl.Right:var o=Yl.HCDeleteChar(this.FDayText,this.FCaretOffset);this.DayText=o.text,this.FCaretOffset=o.offset}this.FormatDirty();break;case Ke:this.FCaretOffset=0;break;case ze:var s="";switch(this.FActiveArea){case Xl.Left:s=this.FWeekText;break;case Xl.Right:s=this.FDayText}this.FCaretOffset=s.length}}}},{key:"KeyPress",value:function(t){this.EditProtect||(0!==this.FActiveArea?this.InsertText(String.fromCharCode(t.keyCode)):t.keyCode=0)}},{key:"InsertText",value:function(t){if(this.EditProtect)return!1;if(this.FActiveArea!==Xl.None){switch(this.FActiveArea){case Xl.Left:this.WeekText=L.stringInsert(this.FWeekText,this.FCaretOffset,t);break;case Xl.Right:this.DayText=L.stringInsert(this.FDayText,this.FCaretOffset,t)}return this.FCaretOffset+=t.length,this.FormatDirty(),!0}return!1}},{key:"AcceptAction",value:function(t,e,n){return!(n===rh.DeleteItem&&!this.DeleteAllow)&&f()(F()(i.prototype),"AcceptAction",this).call(this,t,e,n)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FWeekText=t.WeekText,this.FDayText=t.DayText,this.DeleteAllow=t.DeleteAllow,this.EditProtect=t.EditProtect,this.AllocValue=t.AllocValue,this.Propertys.assign(t.Propertys)}},{key:"WantKeyDown",value:function(t){if(this.EditProtect)return!1;var e=!0;return t.keyCode===Je?this.FActiveArea===Xl.None?(this.FActiveArea=Xl.Right,this.FCaretOffset=this.FDayText.length,this.OwnerData.Style.UpdateInfoRePaint()):this.FActiveArea===Xl.Left&&0===this.FCaretOffset&&(e=!1):t.keyCode===Ye&&(this.FActiveArea===Xl.None?(this.FActiveArea=Xl.Left,this.FCaretOffset=0,this.OwnerData.Style.UpdateInfoRePaint()):this.FActiveArea===Xl.Right&&this.FCaretOffset===this.FDayText.length&&(e=!1)),e}},{key:"FormatToDrawItem",value:function(t,e){var i=t.Style;i.TextStyles[this.TextStyleNo].ApplyStyle(i.TempCanvas);var n=i.TextStyles[this.TextStyleNo].FontHeight,o=4;""!=this.FWeekText&&(o=Math.max(i.TempCanvas.textWidth(this.FWeekText),2)),this.FWeekRect.resetBounds(0,0,o,n),this.Height=n,i.TextStyles[this.TextStyleNo].ApplySupSubStyle(i.TempCanvas),n=i.TempCanvas.textHeight("H");var s=Math.max(i.TempCanvas.textWidth(this.FDayText),2);i.ApplyTempStyle(oo.Null),""!=this.FDayText?(this.FDayRect.resetBounds(this.FWeekRect.right,0,s,L.Round(n/2)),this.Width=o+s):(this.FDayRect.resetBounds(this.FWeekRect.right-2,0,s,L.Round(n/2)),this.Width=o)}},{key:"MouseLeave",value:function(){f()(F()(i.prototype),"MouseLeave",this).call(this),this.FMouseMoveArea=Xl.None}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){if(!a.Print){(this.Active||this.FMouseIn)&&(r.brush.color=Yl.clBtnFace,r.fillRect(e));var l=new nt;this.FActiveArea!==Xl.None&&(this.FActiveArea===Xl.Left?l.resetRect(this.FWeekRect):l.resetRect(this.FDayRect),l.offset(e.left,e.top),l.inFlate(2,2),r.pen.color=Ft.Blue,r.pen.Width=1,r.rectangleRect(l)),this.FMouseMoveArea!==Xl.None&&this.FMouseMoveArea!==this.FActiveArea&&(this.FActiveArea===Xl.Left?l.resetRect(this.FWeekRect):l.resetRect(this.FDayRect),l.offset(e.left,e.top),l.inFlate(2,2),r.pen.color=Yl.clMedGray,r.pen.Width=1,r.rectangleRect(l))}t.TextStyles[this.TextStyleNo].ApplyStyle(r,a.ScaleY/a.Zoom),r.textOut(e.left+this.FWeekRect.left,e.top+this.FWeekRect.top,this.FWeekText),t.TextStyles[this.TextStyleNo].ApplySupSubStyle(r,a.ScaleY/a.Zoom),r.textOut(e.left+this.FDayRect.left,e.top+this.FDayRect.top,this.FDayText)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.FWeekText),Yl.HCSaveTextToStream(t,this.FDayText);var o=0;this.EditProtect&&(o|=128),this.DeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FVersion<1&&(this.FVersion=t.readByte()),this.FWeekText=Yl.HCLoadTextFromStream(t,n),this.FDayText=Yl.HCLoadTextFromStream(t,n);var o=t.readByte();if(this.EditProtect=L.isOdd(o>>7),this.DeleteAllow=L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4),this.FVersion>1){var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.Propertys)}}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t),null!=t.Version&&(this.FVersion=t.Version),null!=t.WeekText&&(this.FWeekText=t.WeekText),null!=t.DayText&&(this.FDayText=t.DayText)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"WeekText":"'+this.WeekText+'","DayText":"'+this.DayText+'"'}},{key:"WeekText",get:function(){return this.FWeekText},set:function(t){this.FWeekText=t,this.DoChange()}},{key:"DayText",get:function(){return this.FDayText},set:function(t){this.FDayText=t,this.DoChange()}}]),i}(hs);function Pu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var ku=function(t){m()(i,t);var e=Pu(i);function i(t,n,o,s,a,l,h,c,u){var f;return r()(this,i),(f=e.call(this,t,n)).StyleNo=mh.EMRSTYLE_PUPIL,f.DeleteAllow=!0,f.EditProtect=!1,f.AllocValue=!1,f.Propertys=new rt,f.FActiveArea=0,f.FMouseMoveArea=0,f.FCaretOffset=0,f.FText1=o,f.FText2=s,f.FText3=a,f.FText4=l,f.FText5=h,f.FText6=c,f.FText7=u,f.FW1=0,f.FW2=0,f.FW3=0,f.FW4=0,f.FW5=0,f.FW6=0,f.FW7=0,f.FCharH=0,f}return l()(i,[{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.AllocValue=!0}},{key:"GetLastVersion",value:function(){return 2}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.Propertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"===t?this.EditProtect=L.parseBooleanDef(e,this.EditProtect):"DeleteAllow"===t?this.DeleteAllow=L.parseBooleanDef(e,this.DeleteAllow):"AllocValue"===t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.Propertys,t,e)}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){if(!a.Print){(this.Active||this.FMouseIn)&&(r.brush.color=Yl.clBtnFace,r.fillRect(e));var l=null;if(0!==this.FActiveArea){switch((l=this.GetAreaRect(this.FActiveArea)).offset(e.left,e.top),this.FActiveArea){case 1:l.right+=2;break;case 2:l.left-=2;break;case 3:l.right+=2;break;case 4:l.inFlate(2,2);break;case 5:l.left-=2;break;case 6:l.right+=2;break;case 7:l.left-=2}r.pen.color=Ft.Blue,r.pen.Width=1,r.rectangleRect(l)}if(0!==this.FMouseMoveArea&&this.FMouseMoveArea!==this.FActiveArea){switch((l=this.GetAreaRect(this.FMouseMoveArea)).offset(e.left,e.top),this.FMouseMoveArea){case 1:l.right+=2;break;case 2:l.left-=2;break;case 3:l.right+=2;break;case 4:l.inFlate(2,2);break;case 5:l.left-=2;break;case 6:l.right+=2;break;case 7:l.left-=2}r.pen.color=Yl.clMedGray,r.pen.Width=1,r.rectangleRect(l)}}t.TextStyles[this.TextStyleNo].ApplyStyle(r,a.ScaleY/a.Zoom);var h=Math.max(this.FW1,this.FW3,this.FW6);r.textOut(e.left+h-this.FW1,e.top,this.FText1),r.textOut(e.left+h-this.FW3,e.top+this.FCharH+5,this.FText3),r.textOut(e.left+h-this.FW6,e.top+this.FCharH+this.FCharH+10,this.FText6),r.textOut(e.left+h+5,e.top+this.FCharH+5,this.FText4),r.textOut(e.left+h+this.FW4+10,e.top,this.FText2),r.textOut(e.left+h+this.FW4+10,e.top+this.FCharH+5,this.FText5),r.textOut(e.left+h+this.FW4+10,e.top+this.FCharH+this.FCharH+10,this.FText7)}},{key:"GetCaretInfo",value:function(t){if(0!==this.FActiveArea){var e=0;switch(t.Height=this.FCharH,this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo),this.FActiveArea){case 1:case 3:case 6:e=Math.max(this.FW1,this.FW3,this.FW6),1===this.FActiveArea?(t.X=e-this.FW1+this.OwnerData.Style.TempCanvas.textWidth(this.FText1.substr(0,this.FCaretOffset)),t.Y=0):3===this.FActiveArea?(t.X=e-this.FW3+this.OwnerData.Style.TempCanvas.textWidth(this.FText3.substr(0,this.FCaretOffset)),t.Y=this.FCharH+5):(t.X=e-this.FW6+this.OwnerData.Style.TempCanvas.textWidth(this.FText6.substr(0,this.FCaretOffset)),t.Y=this.FCharH+this.FCharH+10);break;case 4:e=Math.max(this.FW1,this.FW3,this.FW6),t.X=e+5+this.OwnerData.Style.TempCanvas.textWidth(this.FText4.substr(0,this.FCaretOffset)),t.Y=this.FCharH+5;break;case 2:case 5:case 7:e=Math.max(this.FW1,this.FW3,this.FW6),2===this.FActiveArea?(t.X=e+this.FW4+10+this.OwnerData.Style.TempCanvas.textWidth(this.FText2.substr(0,this.FCaretOffset)),t.Y=0):5===this.FActiveArea?(t.X=e+this.FW4+10+this.OwnerData.Style.TempCanvas.textWidth(this.FText5.substr(0,this.FCaretOffset)),t.Y=this.FCharH+5):(t.X=e+this.FW4+10+this.OwnerData.Style.TempCanvas.textWidth(this.FText7.substr(0,this.FCaretOffset)),t.Y=this.FCharH+this.FCharH+10)}}else t.Visible=!1}},{key:"GetArea",value:function(t,e){return this.GetAreaRect(1).pointInAt(t,e)?1:this.GetAreaRect(2).pointInAt(t,e)?2:this.GetAreaRect(3).pointInAt(t,e)?3:this.GetAreaRect(4).pointInAt(t,e)?4:this.GetAreaRect(5).pointInAt(t,e)?5:this.GetAreaRect(6).pointInAt(t,e)?6:this.GetAreaRect(7).pointInAt(t,e)?7:0}},{key:"GetAreaRect",value:function(t){var e=new nt,i=0;switch(t){case 1:case 3:case 6:var n=0;i=Math.max(this.FW1,this.FW3,this.FW6),n=1===t?0:3===t?this.FCharH+5:this.FCharH+this.FCharH+10,e.resetBounds(0,n,i,this.FCharH);break;case 4:i=Math.max(this.FW1,this.FW3,this.FW6),e.resetBounds(i+5,this.FCharH+5,this.FW4,this.FCharH);break;case 2:case 5:case 7:var o=0;i=Math.max(this.FW2,this.FW5,this.FW7),o=2===t?0:5===t?this.FCharH+5:this.FCharH+this.FCharH+10,e.resetBounds(Math.max(this.FW1,this.FW3,this.FW6)+this.FW4+10,o,i,this.FCharH)}return e}},{key:"GetAreaOffset",value:function(t,e){var i=0,n=0;switch(this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo),t){case 1:case 3:case 6:n=Math.max(this.FW1,this.FW3,this.FW6),i=1===t?Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,this.FText1,e-(n-this.FW1)):3===t?Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,this.FText3,e-(n-this.FW3)):Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,this.FText6,e-(n-this.FW6));break;case 4:n=Math.max(this.FW1,this.FW3,this.FW6),i=Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,this.FText4,e-(n+5));break;case 2:case 5:case 7:n=Math.max(this.FW1,this.FW3,this.FW6),i=2===t?Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,this.FText2,e-(n+this.FW4+this.FW2+10)):5===t?Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,this.FText5,e-(n+this.FW4+this.FW5+10)):Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,this.FText7,e-(n+this.FW4+this.FW7+10))}return i}},{key:"SetActive",value:function(t){f()(F()(i.prototype),"SetActive",this).call(this,t),t||(this.FActiveArea=0)}},{key:"MouseLeave",value:function(){f()(F()(i.prototype),"MouseLeave",this).call(this),this.FMouseMoveArea=0}},{key:"MouseDown",value:function(t){if(this.EditProtect)return!1;var e=f()(F()(i.prototype),"MouseDown",this).call(this,t);this.FMouseMoveArea!==this.FActiveArea&&(this.FActiveArea=this.FMouseMoveArea,this.OwnerData.Style.UpdateInfoReCaret());var n=this.GetAreaOffset(this.FActiveArea,t.x);return n!==this.FCaretOffset&&(this.FCaretOffset=n,this.OwnerData.Style.UpdateInfoReCaret()),e}},{key:"MouseMove",value:function(t){if(this.EditProtect)return!1;var e=f()(F()(i.prototype),"MouseMove",this).call(this,t);if(this.FOutSelectInto)this.FMouseMoveArea=0;else{var n=this.GetArea(t.x,t.y);n!==this.FMouseMoveArea&&(this.FMouseMoveArea=n,this.OwnerData.Style.UpdateInfoRePaint())}return e}},{key:"MouseUp",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseUp",this).call(this,t)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FText1=t.Text1,this.FText2=t.Text2,this.FText3=t.Text3,this.FText4=t.Text4,this.FText5=t.Text5,this.FText6=t.Text6,this.FText7=t.Text7,this.DeleteAllow=t.DeleteAllow,this.EditProtect=t.EditProtect,this.AllocValue=t.AllocValue,this.Propertys.assign(t.Propertys)}},{key:"WantKeyDown",value:function(t){return!this.EditProtect}},{key:"FormatToDrawItem",value:function(t,e){var i=t.Style;i.TextStyles[this.TextStyleNo].ApplyStyle(i.TempCanvas),this.FCharH=i.TextStyles[this.TextStyleNo].FontHeight,this.FW1=i.TempCanvas.textWidth(this.FText1),this.FW2=i.TempCanvas.textWidth(this.FText2),this.FW3=i.TempCanvas.textWidth(this.FText3),this.FW4=i.TempCanvas.textWidth(this.FText4),this.FW5=i.TempCanvas.textWidth(this.FText5),this.FW6=i.TempCanvas.textWidth(this.FText6),this.FW7=i.TempCanvas.textWidth(this.FText7),i.ApplyTempStyle(oo.Null),this.Width=Math.max(this.FW1,this.FW3,this.FW6)+this.FW4+Math.max(this.FW2,this.FW5,this.FW7)+10,this.Height=3*this.FCharH+10}},{key:"AcceptAction",value:function(t,e,n){return!(n===rh.DeleteItem&&!this.DeleteAllow)&&f()(F()(i.prototype),"AcceptAction",this).call(this,t,e,n)}},{key:"BackspaceKeyDown",value:function(){var t=null;switch(this.FActiveArea){case 1:t=Yl.HCBackDeleteChar(this.FText1,this.FCaretOffset),this.Text1=t.text,this.FCaretOffset=t.offset;break;case 2:t=Yl.HCBackDeleteChar(this.FText2,this.FCaretOffset),this.Text2=t.text,this.FCaretOffset=t.offset;break;case 3:t=Yl.HCBackDeleteChar(this.FText3,this.FCaretOffset),this.Text3=t.text,this.FCaretOffset=t.offset;break;case 4:t=Yl.HCBackDeleteChar(this.FText4,this.FCaretOffset),this.Text4=t.text,this.FCaretOffset=t.offset;break;case 5:t=Yl.HCBackDeleteChar(this.FText5,this.FCaretOffset),this.Text5=t.text,this.FCaretOffset=t.offset;break;case 6:t=Yl.HCBackDeleteChar(this.FText6,this.FCaretOffset),this.Text6=t.text,this.FCaretOffset=t.offset;break;case 7:t=Yl.HCBackDeleteChar(this.FText7,this.FCaretOffset),this.Text7=t.text,this.FCaretOffset=t.offset}this.FormatDirty()}},{key:"RightKeyDown",value:function(){var t="";switch(this.FActiveArea){case 1:t=this.FText1;break;case 2:t=this.FText2;break;case 3:t=this.FText3;break;case 4:t=this.FText4;break;case 5:t=this.FText5;break;case 6:t=this.FText6;break;case 7:t=this.FText7}this.FCaretOffset<t.length&&this.FCaretOffset++}},{key:"DeleteKeyDown",value:function(){var t=null;switch(this.FActiveArea){case 1:t=Yl.HCDeleteChar(this.FText1,this.FCaretOffset),this.Text1=t.text,this.FCaretOffset=t.offset;break;case 2:t=Yl.HCDeleteChar(this.FText2,this.FCaretOffset),this.Text2=t.text,this.FCaretOffset=t.offset;break;case 3:t=Yl.HCDeleteChar(this.FText3,this.FCaretOffset),this.Text3=t.text,this.FCaretOffset=t.offset;break;case 4:t=Yl.HCDeleteChar(this.FText4,this.FCaretOffset),this.Text4=t.text,this.FCaretOffset=t.offset;break;case 5:t=Yl.HCDeleteChar(this.FText5,this.FCaretOffset),this.Text5=t.text,this.FCaretOffset=t.offset;break;case 6:t=Yl.HCDeleteChar(this.FText6,this.FCaretOffset),this.Text6=t.text,this.FCaretOffset=t.offset;break;case 7:t=Yl.HCDeleteChar(this.FText7,this.FCaretOffset),this.Text7=t.text,this.FCaretOffset=t.offset}this.FormatDirty()}},{key:"EndKeyDown",value:function(){var t="";switch(this.FActiveArea){case 1:t=this.FText1;break;case 2:t=this.FText2;break;case 3:t=this.FText3;break;case 4:t=this.FText4;break;case 5:t=this.FText5;break;case 6:t=this.FText6;break;case 7:t=this.FText7}this.FCaretOffset=t.length}},{key:"KeyDown",value:function(t){if(!this.EditProtect)switch(t.keyCode){case Ee:this.BackspaceKeyDown();break;case Je:this.FCaretOffset>0&&this.FCaretOffset--;break;case Ye:this.RightKeyDown();break;case Xe:this.DeleteKeyDown();break;case Ke:this.FCaretOffset=0;break;case ze:this.EndKeyDown()}}},{key:"KeyPress",value:function(t){EditProtect||(0!==this.FActiveArea?this.InsertText(String.fromCharCode(t.keyCode)):t.keyCode=0)}},{key:"InsertText",value:function(t){if(this.EditProtect)return!1;if(0!==this.FActiveArea){switch(this.FActiveArea){case 1:this.Text1=L.stringInsert(this.FText1,this.FCaretOffset+1-1,t);break;case 2:this.Text2=L.stringInsert(this.FText2,this.FCaretOffset+1-1,t);break;case 3:this.Text3=L.stringInsert(this.FText3,this.FCaretOffset+1-1,t);break;case 4:this.Text4=L.stringInsert(this.FText4,this.FCaretOffset+1-1,t);break;case 5:this.Text5=L.stringInsert(this.FText5,this.FCaretOffset+1-1,t);break;case 6:this.Text6=L.stringInsert(this.FText6,this.FCaretOffset+1-1,t);break;case 7:this.Text7=L.stringInsert(this.FText7,this.FCaretOffset+1-1,t)}return this.FCaretOffset+=t.length,this.FormatDirty(),!0}return!1}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.FText1),Yl.HCSaveTextToStream(t,this.FText2),Yl.HCSaveTextToStream(t,this.FText3),Yl.HCSaveTextToStream(t,this.FText4),Yl.HCSaveTextToStream(t,this.FText5),Yl.HCSaveTextToStream(t,this.FText6),Yl.HCSaveTextToStream(t,this.FText7);var o=0;this.EditProtect&&(o|=128),this.DeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FVersion<1&&(this.FVersion=t.readByte()),this.FText1=Yl.HCLoadTextFromStream(t,n),this.FText2=Yl.HCLoadTextFromStream(t,n),this.FText3=Yl.HCLoadTextFromStream(t,n),this.FText4=Yl.HCLoadTextFromStream(t,n),this.FText5=Yl.HCLoadTextFromStream(t,n),this.FText6=Yl.HCLoadTextFromStream(t,n),this.FText7=Yl.HCLoadTextFromStream(t,n);var o=t.readByte();if(this.EditProtect=L.isOdd(o>>7),this.DeleteAllow=L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4),this.FVersion>1){var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.Propertys)}}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t),null!=t.Version&&(this.FVersion=t.Version),null!=t.Text1&&(this.FText1=t.Text1),null!=t.Text2&&(this.FText2=t.Text2),null!=t.Text3&&(this.FText3=t.Text3),null!=t.Text4&&(this.FText4=t.Text4),null!=t.Text5&&(this.FText5=t.Text5),null!=t.Text6&&(this.FText6=t.Text6),null!=t.Text7&&(this.FText7=t.Text7)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Text1":"'+this.Text1+'","Text2":"'+this.Text2+'","Text3":"'+this.Text3+'","Text4":"'+this.Text4+'","Text5":"'+this.Text5+'","Text6":"'+this.Text6+'","Text7":"'+this.Text7+'"'}},{key:"Text1",get:function(){return this.FText1},set:function(t){this.FText1=t,this.DoChange()}},{key:"Text2",get:function(){return this.FText2},set:function(t){this.FText2=t,this.DoChange()}},{key:"Text3",get:function(){return this.FText3},set:function(t){this.FText3=t,this.DoChange()}},{key:"Text4",get:function(){return this.FText4},set:function(t){this.FText4=t,this.DoChange()}},{key:"Text5",get:function(){return this.FText5},set:function(t){this.FText5=t,this.DoChange()}},{key:"Text6",get:function(){return this.FText6},set:function(t){this.FText6=t,this.DoChange()}},{key:"Text7",get:function(){return this.FText7},set:function(t){this.FText7=t,this.DoChange()}}]),i}(hs);function xu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Ru=function(t){m()(i,t);var e=xu(i);function i(t,n,o,s,a,l,h,c,u,f,d){var m;return r()(this,i),(m=e.call(this,t,n)).StyleNo=mh.EMRSTYLE_LIGHTPERCEPTION,m.FActiveArea=0,m.FMouseMoveArea=0,m.DeleteAllow=!0,m.EditProtect=!1,m.AllocValue=!1,m.Propertys=new rt,m.FText1=o,m.FText2=s,m.FText3=a,m.FText4=l,m.FText5=h,m.FText6=c,m.FText7=u,m.FText8=f,m.FText9=d,m.FW1=0,m.FW2=0,m.FW3=0,m.FW4=0,m.FW5=0,m.FW6=0,m.FW7=0,m.FW8=0,m.FW9=0,m.FCharH=0,m}return l()(i,[{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.AllocValue=!0}},{key:"GetLastVersion",value:function(){return 2}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.Propertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"===t?this.EditProtect=L.parseBooleanDef(e,this.EditProtect):"DeleteAllow"===t?this.DeleteAllow=L.parseBooleanDef(e,this.DeleteAllow):"AllocValue"===t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.Propertys,t,e)}},{key:"GetAreaRect",value:function(t){switch(t){case 1:case 4:case 7:var e=Math.max(this.FW1,this.FW4,this.FW7),i=0;return i=1===t?0:4===t?this.FCharH+5:this.FCharH+this.FCharH+10,nt.CreateByBounds(0,i,e,this.FCharH);case 2:case 5:case 8:var n=Math.max(this.FW2,this.FW5,this.FW8),o=0;return o=2===t?0:5===t?this.FCharH+5:this.FCharH+this.FCharH+10,nt.CreateByBounds(Math.max(this.FW1,this.FW4,this.FW7)+5,o,n,this.FCharH);case 3:case 6:case 9:var s=Math.max(this.FW3,this.FW6,this.FW9),r=0;return r=3===t?0:6===t?this.FCharH+5:this.FCharH+this.FCharH+10,nt.CreateByBounds(Math.max(this.FW1,this.FW4,this.FW7)+Math.max(this.FW2,this.FW5,this.FW8)+10,r,s,this.FCharH)}}},{key:"FormatToDrawItem",value:function(t,e){var i=t.Style;i.TextStyles[this.TextStyleNo].ApplyStyle(i.TempCanvas),this.FCharH=i.TextStyles[this.TextStyleNo].FontHeight,this.FW1=i.TempCanvas.textWidth(this.FText1),this.FW2=i.TempCanvas.textWidth(this.FText2),this.FW3=i.TempCanvas.textWidth(this.FText3),this.FW4=i.TempCanvas.textWidth(this.FText4),this.FW5=i.TempCanvas.textWidth(this.FText5),this.FW6=i.TempCanvas.textWidth(this.FText6),this.FW7=i.TempCanvas.textWidth(this.FText7),this.FW8=i.TempCanvas.textWidth(this.FText8),this.FW9=i.TempCanvas.textWidth(this.FText9),i.ApplyTempStyle(oo.Null),this.Width=Math.max(this.FW1,this.FW4,this.FW7)+Math.max(this.FW2,this.FW5,this.FW8)+Math.max(this.FW3,this.FW6,this.FW9)+10,this.Height=3*this.FCharH+10}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){if(!a.Print){(this.Active||this.FMouseIn)&&(r.brush.color=Yl.clBtnFace,r.fillRect(e));var l=null;if(0!==this.FActiveArea){switch((l=this.GetAreaRect(this.FActiveArea)).offset(e.left,e.top),this.FActiveArea){case 1:case 4:case 7:l.right+=2;break;case 2:case 5:case 8:l.inFlate(2,2);break;case 3:case 6:case 9:l.left-=2}r.pen.color=Ft.Blue,r.pen.Width=1,r.rectangleRect(l)}if(0!==this.FMouseMoveArea&&this.FMouseMoveArea!==this.FActiveArea){switch((l=this.GetAreaRect(this.FMouseMoveArea)).offset(e.left,e.top),this.FMouseMoveArea){case 1:case 4:case 7:l.right+=2;break;case 2:case 5:case 8:l.inFlate(2,2);break;case 3:case 6:case 9:l.left-=2}r.pen.color=Yl.clMedGray,r.pen.Width=1,r.rectangleRect(l)}}t.TextStyles[this.TextStyleNo].ApplyStyle(r,a.ScaleY/a.Zoom);var h=Math.max(this.FW1,this.FW4,this.FW7);r.textOut(e.left+h-this.FW1,e.top,this.FText1),r.textOut(e.left+h-this.FW4,e.top+this.FCharH+5,this.FText4),r.textOut(e.left+h-this.FW7,e.top+this.FCharH+this.FCharH+10,this.FText7);var c=Math.max(this.FW2,this.FW5,this.FW8);r.textOut(e.left+h+5+L.Round((c-this.FW2)/2),e.top,this.FText2),r.textOut(e.left+h+5+L.Round((c-this.FW5)/2),e.top+this.FCharH+5,this.FText5),r.textOut(e.left+h+5+L.Round((c-this.FW8)/2),e.top+this.FCharH+this.FCharH+10,this.FText8),r.textOut(e.left+h+c+10,e.top,this.FText3),r.textOut(e.left+h+c+10,e.top+this.FCharH+5,this.FText6),r.textOut(e.left+h+c+10,e.top+this.FCharH+this.FCharH+10,this.FText9)}},{key:"GetCaretInfo",value:function(t){t.Visible=!1}},{key:"GetArea",value:function(t,e){return this.GetAreaRect(1).pointInAt(t,e)?1:this.GetAreaRect(2).pointInAt(t,e)?2:this.GetAreaRect(3).pointInAt(t,e)?3:this.GetAreaRect(4).pointInAt(t,e)?4:this.GetAreaRect(5).pointInAt(t,e)?5:this.GetAreaRect(6).pointInAt(t,e)?6:this.GetAreaRect(7).pointInAt(t,e)?7:this.GetAreaRect(8).pointInAt(t,e)?8:this.GetAreaRect(9).pointInAt(t,e)?9:0}},{key:"GetAreaOffset",value:function(t,e){return 0}},{key:"SetActive",value:function(t){f()(F()(i.prototype),"SetActive",this).call(this,t),t||(this.FActiveArea=0)}},{key:"MouseDown",value:function(t){if(this.EditProtect)return!1;var e=f()(F()(i.prototype),"MouseDown",this).call(this,t);this.FMouseMoveArea!==this.FActiveArea&&(this.FActiveArea=this.FMouseMoveArea,this.OwnerData.Style.UpdateInfoReCaret());var n=this.GetAreaOffset(this.FActiveArea,t.x);return n!=this.FCaretOffset&&(this.FCaretOffset=n,this.OwnerData.Style.UpdateInfoReCaret()),e}},{key:"MouseMove",value:function(t){if(this.EditProtect)return!1;var e=f()(F()(i.prototype),"MouseMove",this).call(this,t);if(this.FOutSelectInto)this.FMouseMoveArea=0;else{var n=this.GetArea(t.x,t.y);n!==this.FMouseMoveArea&&(this.FMouseMoveArea=n,this.OwnerData.Style.UpdateInfoRePaint())}return e}},{key:"MouseUp",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseUp",this).call(this,t)}},{key:"KeyDown",value:function(t){if(!this.EditProtect){var e=null;switch(t.keyCode){case Ee:switch(this.FActiveArea){case 1:e=Yl.HCBackDeleteChar(this.FText1,this.FCaretOffset),this.Text1=e.text,this.FCaretOffset=e.offset;break;case 2:e=Yl.HCBackDeleteChar(this.FText2,this.FCaretOffset),this.Text2=e.text,this.FCaretOffset=e.offset;break;case 3:e=Yl.HCBackDeleteChar(this.FText3,this.FCaretOffset),this.Text3=e.text,this.FCaretOffset=e.offset;break;case 4:e=Yl.HCBackDeleteChar(this.FText4,this.FCaretOffset),this.Text4=e.text,this.FCaretOffset=e.offset;break;case 5:e=Yl.HCBackDeleteChar(this.FText5,this.FCaretOffset),this.Text5=e.text,this.FCaretOffset=e.offset;break;case 6:e=Yl.HCBackDeleteChar(this.FText6,this.FCaretOffset),this.Text6=e.text,this.FCaretOffset=e.offset;break;case 7:e=Yl.HCBackDeleteChar(this.FText7,this.FCaretOffset),this.Text7=e.text,this.FCaretOffset=e.offset;break;case 8:e=Yl.HCBackDeleteChar(this.FText8,this.FCaretOffset),this.Text8=e.text,this.FCaretOffset=e.offset;break;case 9:e=Yl.HCBackDeleteChar(this.FText9,this.FCaretOffset),this.Text9=e.text,this.FCaretOffset=e.offset}this.FormatDirty();break;case Je:this.FCaretOffset>0&&this.FCaretOffset--;case Ye:var i="";switch(this.FActiveArea){case 1:i=this.FText1;break;case 2:i=this.FText2;break;case 3:i=this.FText3;break;case 4:i=this.FText4;break;case 5:i=this.FText5;break;case 6:i=this.FText6;break;case 7:i=this.FText7;break;case 8:i=this.FText8;break;case 9:i=this.FText9}this.FCaretOffset<i.length&&this.FCaretOffset++;break;case Xe:switch(this.FActiveArea){case 1:e=Yl.HCDeleteChar(this.FText1,this.FCaretOffset),this.Text1=e.text,this.FCaretOffset=e.offset;break;case 2:e=Yl.View.HC.HCDeleteChar(this.FText2,this.FCaretOffset),this.Text2=e.text,this.FCaretOffset=e.offset;break;case 3:e=Yl.View.HC.HCDeleteChar(this.FText3,this.FCaretOffset),this.Text3=e.text,this.FCaretOffset=e.offset;break;case 4:e=Yl.View.HC.HCDeleteChar(this.FText4,this.FCaretOffset),this.Text4=e.text,this.FCaretOffset=e.offset;break;case 5:e=Yl.View.HC.HCDeleteChar(this.FText5,this.FCaretOffset),this.Text5=e.text,this.FCaretOffset=e.offset;break;case 6:e=Yl.View.HC.HCDeleteChar(this.FText6,this.FCaretOffset),this.Text6=e.text,this.FCaretOffset=e.offset;break;case 7:e=Yl.View.HC.HCDeleteChar(this.FText7,this.FCaretOffset),this.Text7=e.text,this.FCaretOffset=e.offset;break;case 8:e=Yl.View.HC.HCDeleteChar(this.FText8,this.FCaretOffset),this.Text8=e.text,this.FCaretOffset=e.offset;break;case 9:e=Yl.View.HC.HCDeleteChar(this.FText9,this.FCaretOffset),this.Text9=e.text,this.FCaretOffset=e.offset}FormatDirty();break;case Ke:this.FCaretOffset=0;break;case ze:var n="";switch(this.FActiveArea){case 1:n=this.FText1;break;case 2:n=this.FText2;break;case 3:n=this.FText3;break;case 4:n=this.FText4;break;case 5:n=this.FText5;break;case 6:n=this.FText6;break;case 7:n=this.FText7;break;case 8:n=this.FText8;break;case 9:n=this.FText9}this.FCaretOffset=n.length}}}},{key:"KeyPress",value:function(t){this.EditProtect||(0!==this.FActiveArea?this.InsertText(String.fromCharCode(t.keyCode)):t.keyCode=0)}},{key:"InsertText",value:function(t){if(this.EditProtect)return!1;if(0!==this.FActiveArea){switch(this.FActiveArea){case 1:this.Text1=L.stringInsert(this.FText1,this.FCaretOffset,t);break;case 2:this.Text2=L.stringInsert(this.FText2,this.FCaretOffset,t);break;case 3:this.Text3=L.stringInsert(this.FText3,this.FCaretOffset,t);break;case 4:this.Text4=L.stringInsert(this.FText4,this.FCaretOffset,t);break;case 5:this.Text5=L.stringInsert(this.FText5,this.FCaretOffset,t);break;case 6:this.Text6=L.stringInsert(this.FText6,this.FCaretOffset,t);break;case 7:this.Text7=L.stringInsert(this.FText7,this.FCaretOffset,t);break;case 8:this.Text8=L.stringInsert(this.FText8,this.FCaretOffset,t);break;case 9:this.Text9=L.stringInsert(this.FText9,this.FCaretOffset,t)}return this.FCaretOffset+=t.length,this.FormatDirty(),!0}return!1}},{key:"AcceptAction",value:function(t,e,n){return!(n===rh.DeleteItem&&!this.DeleteAllow)&&f()(F()(i.prototype),"AcceptAction",this).call(this,t,e,n)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FText1=t.Text1,this.FText2=t.Text2,this.FText3=t.Text3,this.FText4=t.Text4,this.FText5=t.Text5,this.FText6=t.Text6,this.FText7=t.Text7,this.FText8=t.Text8,this.FText9=t.Text9,this.DeleteAllow=t.DeleteAllow,this.EditProtect=t.EditProtect,this.AllocValue=t.AllocValue,this.Propertys.assign(t.Propertys)}},{key:"WantKeyDown",value:function(t){return!this.EditProtect}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.FText1),Yl.HCSaveTextToStream(t,this.FText2),Yl.HCSaveTextToStream(t,this.FText3),Yl.HCSaveTextToStream(t,this.FText4),Yl.HCSaveTextToStream(t,this.FText5),Yl.HCSaveTextToStream(t,this.FText6),Yl.HCSaveTextToStream(t,this.FText7),Yl.HCSaveTextToStream(t,this.FText8),Yl.HCSaveTextToStream(t,this.FText9);var o=0;this.EditProtect&&(o|=128),this.DeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FVersion<1&&(this.FVersion=t.readByte()),this.FText1=Yl.HCLoadTextFromStream(t,n),this.FText2=Yl.HCLoadTextFromStream(t,n),this.FText3=Yl.HCLoadTextFromStream(t,n),this.FText4=Yl.HCLoadTextFromStream(t,n),this.FText5=Yl.HCLoadTextFromStream(t,n),this.FText6=Yl.HCLoadTextFromStream(t,n),this.FText7=Yl.HCLoadTextFromStream(t,n),this.FText8=Yl.HCLoadTextFromStream(t,n),this.FText9=Yl.HCLoadTextFromStream(t,n);var o=t.readByte();if(this.EditProtect=L.isOdd(o>>7),this.DeleteAllow=L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4),this.FVersion>1){var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.Propertys)}}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t),null!=t.Version&&(this.FVersion=t.Version),null!=t.Text1&&(this.FText1=t.Text1),null!=t.Text2&&(this.FText2=t.Text2),null!=t.Text3&&(this.FText3=t.Text3),null!=t.Text4&&(this.FText4=t.Text4),null!=t.Text5&&(this.FText5=t.Text5),null!=t.Text6&&(this.FText6=t.Text6),null!=t.Text7&&(this.FText7=t.Text7),null!=t.Text8&&(this.FText8=t.Text8),null!=t.Text9&&(this.FText9=t.Text9)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Text1":"'+this.Text1+'","Text2":"'+this.Text2+'","Text3":"'+this.Text3+'","Text4":"'+this.Text4+'","Text5":"'+this.Text5+'","Text6":"'+this.Text6+'","Text7":"'+this.Text7+'","Text8":"'+this.Text8+'","Text9":"'+this.Text9+'"'}},{key:"Text1",get:function(){return this.FText1},set:function(t){this.FText1=t,this.DoChange()}},{key:"Text2",get:function(){return this.FText2},set:function(t){this.FText2=t,this.DoChange()}},{key:"Text3",get:function(){return this.FText3},set:function(t){this.FText3=t,this.DoChange()}},{key:"Text4",get:function(){return this.FText4},set:function(t){this.FText4=t,this.DoChange()}},{key:"Text5",get:function(){return this.FText5},set:function(t){this.FText5=t,this.DoChange()}},{key:"Text6",get:function(){return this.FText6},set:function(t){this.FText6=t,this.DoChange()}},{key:"Text7",get:function(){return this.FText7},set:function(t){this.FText7=t,this.DoChange()}},{key:"Text8",get:function(){return this.FText8},set:function(t){this.FText8=t,this.DoChange()}},{key:"Text9",get:function(){return this.FText9},set:function(t){this.FText9=t,this.DoChange()}}]),i}(hs);function Tu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var bu=function(t){m()(i,t);var e=Tu(i);function i(t,n,o,s,a,l,h,c){var u;return r()(this,i),(u=e.call(this,t,n)).StyleNo=mh.EMRSTYLE_FETALHEART,u.Propertys=new rt,u.DeleteAllow=!0,u.EditProtect=!1,u.AllocValue=!1,u.FActiveArea=0,u.FMouseMoveArea=0,u.FText1=o,u.FText2=s,u.FText3=a,u.FText4=l,u.FText5=h,u.FText6=c,u.FW1=0,u.FW2=0,u.FW3=0,u.FW4=0,u.FW5=0,u.FW6=0,u.FCharH=0,u}return l()(i,[{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.AllocValue=!0}},{key:"GetLastVersion",value:function(){return 2}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.Propertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"===t?this.EditProtect=L.parseBooleanDef(e,this.EditProtect):"DeleteAllow"===t?this.DeleteAllow=L.parseBooleanDef(e,this.DeleteAllow):"AllocValue"===t?this.AllocValue=L.parseBooleanDef(e,this.AllocValue):Yl.HCSetProperty(this.Propertys,t,e)}},{key:"FormatToDrawItem",value:function(t,e){var i=t.Style;i.TextStyles[this.TextStyleNo].ApplyStyle(i.TempCanvas),this.FCharH=i.TextStyles[this.TextStyleNo].FontHeight,this.FW1=i.TempCanvas.textWidth(this.FText1),this.FW2=i.TempCanvas.textWidth(this.FText2),this.FW3=i.TempCanvas.textWidth(this.FText3),this.FW4=i.TempCanvas.textWidth(this.FText4),this.FW5=i.TempCanvas.textWidth(this.FText5),this.FW6=i.TempCanvas.textWidth(this.FText6),i.ApplyTempStyle(oo.Null),this.Width=Math.max(this.FW1,this.FW3,this.FW5)+Math.max(this.FW2,this.FW4,this.FW6)+20,this.Height=3*this.FCharH+10}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){if(r.pen.width=1,!a.Print){(this.Active||this.FMouseIn)&&(r.brush.color=Yl.clBtnFace,r.fillRect(e));var l=null;0!==this.FActiveArea&&((l=this.GetAreaRect(this.FActiveArea)).offset(e.left,e.top),l.inFlate(2,2),r.pen.color=Ft.Blue,r.rectangleRect(l)),0!==this.FMouseMoveArea&&this.FMouseMoveArea!==this.FActiveArea&&((l=this.GetAreaRect(this.FMouseMoveArea)).offset(e.left,e.top),l.inFlate(2,2),r.pen.color=Yl.clMedGray,r.rectangleRect(l))}var h=Math.max(this.FW1,this.FW3,this.FW5),c=Math.max(this.FW2,this.FW4,this.FW6);r.pen.color=Ft.Black,r.drawLineDriect(e.left,e.top+Math.trunc(this.Height/2),e.left+5,e.top+Math.trunc(this.Height/2)),r.drawLineDriect(e.left+h+5,e.top+Math.trunc(this.Height/2),e.left+h+15,e.top+Math.trunc(this.Height/2)),r.drawLineDriect(e.left+h+c+15,e.top+Math.trunc(this.Height/2),e.left+this.Width,e.top+Math.trunc(this.Height/2)),r.drawLineDriect(e.left+h+10,e.top,e.left+h+10,e.top+this.Height),t.TextStyles[this.TextStyleNo].ApplyStyle(r,a.ScaleY/a.Zoom),r.textOut(e.left+5+h-this.FW1,e.top,this.FText1),r.textOut(e.left+5+h-this.FW3,e.top+this.FCharH+5,this.FText3),r.textOut(e.left+5+h-this.FW5,e.top+this.FCharH+this.FCharH+10,this.FText5),r.textOut(e.left+h+15,e.top,this.FText2),r.textOut(e.left+h+15,e.top+this.FCharH+5,this.FText4),r.textOut(e.left+h+15,e.top+this.FCharH+this.FCharH+10,this.FText6)}},{key:"GetCaretInfo",value:function(t){0!=this.FActiveArea&&(t.Height=this.FCharH,this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo));var e=0;switch(this.FActiveArea){case 1:case 3:case 5:e=Math.max(this.FW1,this.FW3,this.FW5),1===this.FActiveArea?(t.X=e-this.FW1+this.OwnerData.Style.TempCanvas.textWidth(this.FText1.substr(0,this.FCaretOffset))+5,t.Y=0):3===this.FActiveArea?(t.X=e-this.FW3+this.OwnerData.Style.TempCanvas.textWidth(this.FText3.substr(0,this.FCaretOffset))+5,t.Y=this.FCharH+5):(t.X=e-this.FW5+this.OwnerData.Style.TempCanvas.textWidth(this.FText5.substr(0,this.FCaretOffset))+5,t.Y=this.FCharH+this.FCharH+10);break;case 2:case 4:case 6:e=Math.max(this.FW1,this.FW3,this.FW5),2===this.FActiveArea?(t.X=this.OwnerData.Style.TempCanvas.textWidth(this.FText2.substr(0,this.FCaretOffset))+e+15,t.Y=0):4===this.FActiveArea?(t.X=this.OwnerData.Style.TempCanvas.textWidth(this.FText4.substr(0,this.FCaretOffset))+e+15,t.Y=this.FCharH+5):(t.X=this.OwnerData.Style.TempCanvas.textWidth(this.FText6.substr(0,this.FCaretOffset))+e+15,t.Y=this.FCharH+this.FCharH+10);break;default:t.Visible=!1}}},{key:"GetArea",value:function(t,e){return this.GetAreaRect(1).pointInAt(t,e)?1:this.GetAreaRect(2).pointInAt(t,e)?2:this.GetAreaRect(3).pointInAt(t,e)?3:this.GetAreaRect(4).pointInAt(t,e)?4:this.GetAreaRect(5).pointInAt(t,e)?5:this.GetAreaRect(6).pointInAt(t,e)?6:0}},{key:"GetAreaRect",value:function(t){var e=0,i=0;switch(t){case 1:case 3:case 5:return e=Math.max(this.FW1,this.FW3,this.FW5),i=1===t?0:3===t?this.FCharH+5:this.FCharH+this.FCharH+10,nt.CreateByBounds(5,i,e,this.FCharH);case 2:case 4:case 6:return e=Math.max(this.FW2,this.FW4,this.FW6),i=2===t?0:4===t?this.FCharH+5:this.FCharH+this.FCharH+10,nt.CreateByBounds(5+Math.max(this.FW1,this.FW3,this.FW5)+10,i,e,this.FCharH);default:return new nt.Create(0,0,0,0)}}},{key:"GetAreaOffset",value:function(t,e){this.OwnerData.Style.ApplyTempStyle(this.TextStyleNo);var i=0;switch(t){case 1:case 3:case 5:return i=Math.max(this.FW1,this.FW3,this.FW5),1===t?Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,this.FText1,e-(i-this.FW1)-5):3===t?Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,this.FText3,e-(i-this.FW3)-5):Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,this.FText5,e-(i-this.FW5)-5);case 2:case 4:case 6:return i=Math.max(this.FW1,this.FW3,this.FW5),2===t?Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,this.FText2,e-i-15):5===t?Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,this.FText4,e-i-15):Yl.GetNorAlignCharOffsetAt(this.OwnerData.Style.TempCanvas,this.FText6,e-i-15)}return 0}},{key:"SetActive",value:function(t){f()(F()(i.prototype),"SetActive",this).call(this,t),t||(this.FMouseMoveArea=0)}},{key:"MouseDown",value:function(t){if(this.EditProtect)return!1;var e=f()(F()(i.prototype),"MouseDown",this).call(this,t);this.FMouseMoveArea!==this.FActiveArea&&(this.FActiveArea=this.FMouseMoveArea,this.OwnerData.Style.UpdateInfoReCaret());var n=this.GetAreaOffset(this.FActiveArea,t.x);return n!==this.FCaretOffset&&(this.FCaretOffset=n,this.OwnerData.Style.UpdateInfoReCaret()),e}},{key:"MouseMove",value:function(t){if(this.EditProtect)return!1;var e=f()(F()(i.prototype),"MouseMove",this).call(this,t);if(this.FOutSelectInto)this.FMouseMoveArea=0;else{var n=this.GetArea(t.x,t.y);n!==this.FMouseMoveArea&&(this.FMouseMoveArea=n,this.OwnerData.Style.UpdateInfoRePaint())}return e}},{key:"MouseUp",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseUp",this).call(this,t)}},{key:"MouseLeave",value:function(){f()(F()(i.prototype),"MouseLeave",this).call(this),this.FMouseMoveArea=0}},{key:"KeyDown",value:function(t){if(!this.EditProtect){var e=null;switch(t.keyCode){case Ee:switch(this.FActiveArea){case 1:e=Yl.HCBackDeleteChar(this.FText1,this.FCaretOffset),this.Text1=e.text,this.FCaretOffset=e.offset;break;case 2:e=Yl.HCBackDeleteChar(this.FText2,this.FCaretOffset),this.Text2=e.text,this.FCaretOffset=e.offset;break;case 3:e=Yl.HCBackDeleteChar(this.FText3,this.FCaretOffset),this.Text3=e.text,this.FCaretOffset=e.offset;break;case 4:e=Yl.HCBackDeleteChar(this.FText4,this.FCaretOffset),this.Text4=e.text,this.FCaretOffset=e.offset;break;case 5:e=Yl.HCBackDeleteChar(this.FText5,this.FCaretOffset),this.Text5=e.text,this.FCaretOffset=e.offset;break;case 6:e=Yl.HCBackDeleteChar(this.FText6,this.FCaretOffset),this.Text6=e.text,this.FCaretOffset=e.offset}this.FormatDirty();break;case Je:this.FCaretOffset>0&&this.FCaretOffset--;break;case Ye:var i="";switch(this.FActiveArea){case 1:i=this.FText1;break;case 2:i=this.FText2;break;case 3:i=this.FText3;break;case 4:i=this.FText4;break;case 5:i=this.FText5;break;case 6:i=this.FText6}this.FCaretOffset<i.length&&this.FCaretOffset++;break;case Xe:switch(this.FActiveArea){case 1:e=Yl.HCDeleteChar(this.FText1,this.FCaretOffset),this.Text1=e.text,this.FCaretOffset=e.offset;break;case 2:e=Yl.HCDeleteChar(this.FText2,this.FCaretOffset),this.Text2=e.text,this.FCaretOffset=e.offset;break;case 3:e=Yl.HCDeleteChar(this.FText3,this.FCaretOffset),this.Text3=e.text,this.FCaretOffset=e.offset;break;case 4:e=Yl.HCDeleteChar(this.FText4,this.FCaretOffset),this.Text4=e.text,this.FCaretOffset=e.offset;break;case 5:e=Yl.HCDeleteChar(this.FText5,this.FCaretOffset),this.Text5=e.text,this.FCaretOffset=e.offset;break;case 6:e=Yl.HCDeleteChar(this.FText6,this.FCaretOffset),this.Text6=e.text,this.FCaretOffset=e.offset}this.FormatDirty();break;case Ke:this.FCaretOffset=0;break;case ze:var n="";switch(this.FActiveArea){case 1:n=this.FText1;break;case 2:n=this.FText2;break;case 3:n=this.FText3;break;case 4:n=this.FText4;break;case 5:n=this.FText5;break;case 6:n=this.FText6}this.FCaretOffset=n.length}}}},{key:"KeyPress",value:function(t){this.EditProtect||(0!==this.FActiveArea?this.InsertText(String.fromCharCode(t.keyCode)):t.keyCode=0)}},{key:"AcceptAction",value:function(t,e,n){return!(n===rh.DeleteItem&&!this.DeleteAllow)&&f()(F()(i.prototype),"AcceptAction",this).call(this,t,e,n)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.FText1=t.Text1,this.FText2=t.Text2,this.FText3=t.Text3,this.FText4=t.Text4,this.FText5=t.Text5,this.FText6=t.Text6,this.DeleteAllow=t.DeleteAllow,this.EditProtect=t.EditProtect,this.AllocValue=t.AllocValue,this.Propertys.assign(t.Propertys)}},{key:"WantKeyDown",value:function(t){return!this.EditProtect}},{key:"InsertText",value:function(t){if(this.EditProtect)return!1;if(0!==this.FActiveArea){switch(this.FActiveArea){case 1:this.Text1=L.stringInsert(this.FText1,this.FCaretOffset,t);break;case 2:this.Text2=L.stringInsert(this.FText2,this.FCaretOffset,t);break;case 3:this.Text3=L.stringInsert(this.FText3,this.FCaretOffset,t);break;case 4:this.Text4=L.stringInsert(this.FText4,this.FCaretOffset,t);break;case 5:this.Text5=L.stringInsert(this.FText5,this.FCaretOffset,t);break;case 6:this.Text6=L.stringInsert(this.FText6,this.FCaretOffset,t)}return this.FCaretOffset+=t.length,this.FormatDirty(),!0}return!1}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.FText1),Yl.HCSaveTextToStream(t,this.FText2),Yl.HCSaveTextToStream(t,this.FText3),Yl.HCSaveTextToStream(t,this.FText4),Yl.HCSaveTextToStream(t,this.FText5),Yl.HCSaveTextToStream(t,this.FText6);var o=0;this.EditProtect&&(o|=128),this.DeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FVersion<1&&(this.FVersion=t.readByte()),this.FText1=Yl.HCLoadTextFromStream(t,n),this.FText2=Yl.HCLoadTextFromStream(t,n),this.FText3=Yl.HCLoadTextFromStream(t,n),this.FText4=Yl.HCLoadTextFromStream(t,n),this.FText5=Yl.HCLoadTextFromStream(t,n),this.FText6=Yl.HCLoadTextFromStream(t,n);var o=t.readByte();if(this.EditProtect=L.isOdd(o>>7),this.DeleteAllow=L.isOdd(o>>6),this.AllocValue=L.isOdd(o>>4),this.FVersion>1){var s=Yl.HCLoadTextFromStream(t,n);n>64?Yl.SetPropertyString(s,this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(s,this.Propertys)}}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t),null!=t.Version&&(this.FVersion=t.Version),null!=t.Text1&&(this.FText1=t.Text1),null!=t.Text2&&(this.FText2=t.Text2),null!=t.Text3&&(this.FText3=t.Text3),null!=t.Text4&&(this.FText4=t.Text4),null!=t.Text5&&(this.FText5=t.Text5),null!=t.Text6&&(this.FText6=t.Text6)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"Text1":"'+this.Text1+'","Text2":"'+this.Text2+'","Text3":"'+this.Text3+'","Text4":"'+this.Text4+'","Text5":"'+this.Text5+'","Text6":"'+this.Text6+'"'}},{key:"Text1",get:function(){return this.FText1},set:function(t){this.FText1=t,this.DoChange()}},{key:"Text2",get:function(){return this.FText2},set:function(t){this.FText2=t,this.DoChange()}},{key:"Text3",get:function(){return this.FText3},set:function(t){this.FText3=t,this.DoChange()}},{key:"Text4",get:function(){return this.FText4},set:function(t){this.FText4=t,this.DoChange()}},{key:"Text5",get:function(){return this.FText5},set:function(t){this.FText5=t,this.DoChange()}},{key:"Text6",get:function(){return this.FText6},set:function(t){this.FText6=t,this.DoChange()}}]),i}(hs);function Bu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Nu=l()((function t(e,i){r()(this,t),this.Rect=new nt,this.Text=e,this.Sup=i})),Ou=function(t){m()(i,t);var e=Bu(i);function i(t,n,o,s,a,l){var h;return r()(this,i),(h=e.call(this,t,n)).StyleNo=mh.EMRSTYLE_PAMERTOOTH,h.FActiveArea=-1,h.FCaretOffset=-1,h.FLeftTop=new ot,h.FLeftBottom=new ot,h.FRightTop=new ot,h.FRightBottom=new ot,h.SetLeftTopText(o),h.SetLeftBottomText(a),h.SetRightTopText(s),h.SetRightBottomText(l),h.DeleteAllow=!0,h.EditProtect=!1,h.AllocValue=!1,h.Propertys=new rt,h}return l()(i,[{key:"DoChange",value:function(){f()(F()(i.prototype),"DoChange",this).call(this),this.AllocValue=!0}},{key:"GetLastVersion",value:function(){return 1}},{key:"HasProp",value:function(t){return this.Propertys.hasKey(t)}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.Propertys,t)}},{key:"SetValue",value:function(t,e){"EditProtect"==t?this.EditProtect=L.parseBooleanDef(e,this.EditProtect):"DeleteAllow"==t?this.DeleteAllow=L.parseBooleanDef(e,this.DeleteAllow):Yl.HCSetProperty(this.Propertys,t,e)}},{key:"MouseDown",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseDown",this).call(this,t)}},{key:"MouseMove",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseMove",this).call(this,t)}},{key:"MouseUp",value:function(t){return!this.EditProtect&&f()(F()(i.prototype),"MouseUp",this).call(this,t)}},{key:"KeyDown",value:function(t){this.EditProtect||f()(F()(i.prototype),"KeyDown",this).call(this,t)}},{key:"KeyPress",value:function(t){this.EditProtect?t.keyCode=0:f()(F()(i.prototype),"KeyPress",this).call(this,t)}},{key:"AcceptAction",value:function(t,e,n){return!(n===rh.DeleteItem&&!this.DeleteAllow)&&f()(F()(i.prototype),"AcceptAction",this).call(this,t,e,n)}},{key:"Assign",value:function(t){f()(F()(i.prototype),"Assign",this).call(this,t),this.LeftTopText=t.LeftTopText,this.LeftBottomText=t.LeftBottomText,this.RightTopText=t.RightTopText,this.RightBottomText=t.RightBottomText,this.Propertys.assign(t.Propertys),this.DeleteAllow=t.DeleteAllow,this.EditProtect=t.EditProtect,this.AllocValue=t.AllocValue}},{key:"GetPartText",value:function(t){for(var e="",i=0;i<t.count;i++)t[i].Sup?e+="^"+t[i].Text:e+="|"+t[i].Text;return e}},{key:"SetPartText",value:function(t,e){e.clear();for(var i,n=0,o=0,s=t.length,r=!1;n<s;)if("|"!==(i=t[n]))if("^"!==i)n++;else{if(n>o){i=t.substring(o,n);var a=new Nu(i,r);e.add(a)}r=!0,o=++n}else{if(n>o){i=t.substring(o,n);var l=new Nu(i,r);e.add(l)}r=!1,o=++n}if(n>o){i=t.substring(o,n);var h=new Nu(i,r);e.add(h)}this.DoChange()}},{key:"GetLeftTopText",value:function(){return this.GetPartText(this.FLeftTop)}},{key:"GetLeftBottomText",value:function(){return this.GetPartText(this.FLeftBottom)}},{key:"GetRightTopText",value:function(){return this.GetPartText(this.FRightTop)}},{key:"GetRightBottomText",value:function(){return this.GetPartText(this.FRightBottom)}},{key:"SetLeftTopText",value:function(t){this.SetPartText(t,this.FLeftTop)}},{key:"SetLeftBottomText",value:function(t){this.SetPartText(t,this.FLeftBottom)}},{key:"SetRightTopText",value:function(t){this.SetPartText(t,this.FRightTop)}},{key:"SetRightBottomText",value:function(t){this.SetPartText(t,this.FRightBottom)}},{key:"PaintPamerPart",value:function(t,e,i,n,o,s){for(var r=new nt,a=0;a<i.count;a++)r.resetRect(i[a].Rect),r.offset(t,e),i[a].Sup?n.TextStyles[this.TextStyleNo].ApplySupSubStyle(o):n.TextStyles[this.TextStyleNo].ApplyStyle(o),o.textOut(r.left,r.top,i[a].Text)}},{key:"FormatPamerPart",value:function(t,e){for(var i=0,n=null,o=0;o<t.count;o++)t[o].Sup?e.TextStyles[this.TextStyleNo].ApplySupSubStyle(e.TempCanvas):e.TextStyles[this.TextStyleNo].ApplyStyle(e.TempCanvas),n=e.TempCanvas.textExtent(t[o].Text),t[o].Rect.resetBounds(i,0,n.width,n.height),i+=n.width}},{key:"FormatToDrawItem",value:function(t,e){var i=t.Style;i.TextStyles[this.TextStyleNo].ApplyStyle(i.TempCanvas);var n=i.TextStyles[this.TextStyleNo].FontHeight,o=0;this.Height=n+n+3,this.FormatPamerPart(this.FLeftTop,i),this.FormatPamerPart(this.FRightTop,i),this.FormatPamerPart(this.FLeftBottom,i),this.FormatPamerPart(this.FRightBottom,i),n=this.FLeftTop.count>0?this.FLeftTop.last.Rect.right:10,this.FLeftBottom.count>0&&(n=Math.max(n,this.FLeftBottom.last.Rect.right)),o=this.FRightTop.count>0?this.FRightTop.last.Rect.right:10,this.FRightBottom.count>0&&(o=Math.max(o,this.FRightBottom.last.Rect.right)),this.Width=n+3+o+1,this.Width<20&&(this.Width=20)}},{key:"DoPaint",value:function(t,e,i,n,o,s,r,a){!this.Active&&!this.FMouseIn||a.Print||(r.brush.color=Yl.clBtnFace,r.fillRect(e));var l=e.left,h=e.top;this.PaintPamerPart(l,h,this.FLeftTop,t,r,a),l=e.left,h=e.top+Math.trunc(this.Height/2)+2,this.PaintPamerPart(l,h,this.FLeftBottom,t,r,a),l=0,l=this.FLeftTop.count>0?this.FLeftTop.last.Rect.right:10,h=0,this.FLeftBottom.count>0&&(h=this.FLeftBottom.last.Rect.right),l=l>h?e.left+l+2:e.left+h+2,h=e.top,this.PaintPamerPart(l+2,h,this.FRightTop,t,r,a),h=e.top+Math.trunc(this.Height/2)+2,this.PaintPamerPart(l+2,h,this.FRightBottom,t,r,a),r.pen.color=Ft.Black,r.pen.width=1,r.drawLineDriect(e.left,e.top+Math.trunc(this.Height/2),e.right-1,e.top+Math.trunc(this.Height/2)),r.drawLineDriect(l,e.top,l,e.bottom)}},{key:"SaveToStreamRange",value:function(t,e,n){f()(F()(i.prototype),"SaveToStreamRange",this).call(this,t,e,n),Yl.HCSaveTextToStream(t,this.GetLeftTopText()),Yl.HCSaveTextToStream(t,this.GetLeftBottomText()),Yl.HCSaveTextToStream(t,this.GetRightTopText()),Yl.HCSaveTextToStream(t,this.GetRightBottomText()),Yl.HCSaveTextToStream(t,Yl.GetPropertyString(this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator));var o=0;this.EditProtect&&(o|=128),this.DeleteAllow&&(o|=64),this.AllocValue&&(o|=16),t.writeByte(o)}},{key:"LoadFromStream",value:function(t,e,n){f()(F()(i.prototype),"LoadFromStream",this).call(this,t,e,n),this.FVersion<1&&(this.FVersion=t.readByte());var o=Yl.HCLoadTextFromStream(t,n);this.SetLeftTopText(o),o=Yl.HCLoadTextFromStream(t,n),this.SetLeftBottomText(o),o=Yl.HCLoadTextFromStream(t,n),this.SetRightTopText(o),o=Yl.HCLoadTextFromStream(t,n),this.SetRightBottomText(o),this.FVersion>0&&(o=Yl.HCLoadTextFromStream(t,n),n>64?Yl.SetPropertyString(o,this.Propertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(o,this.Propertys));var s=t.readByte();this.EditProtect=L.isOdd(s>>7),this.DeleteAllow=L.isOdd(s>>6),this.AllocValue=L.isOdd(s>>4)}},{key:"ParseJSONObject",value:function(t){f()(F()(i.prototype),"ParseJSONObject",this).call(this,t),sc(this,t),null!=t.Version&&(this.FVersion=t.Version),null!=t.LeftTopText&&this.SetLeftTopText(t.LeftTopText),null!=t.LeftBottomText&&this.SetLeftBottomText(t.LeftBottomText),null!=t.RightTopText&&this.SetRightTopText(t.RightTopText),null!=t.RightBottomText&&this.SetRightBottomText(t.RightBottomText)}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return f()(F()(i.prototype),"ToJSONString",this).call(this,t)+',"LeftTopText":"'+this.LeftTopText+'","LeftBottomText":"'+this.LeftBottomText+'","RightTopText":"'+this.RightTopText+'","RightBottomText":"'+this.RightBottomText+'"'}},{key:"LeftTopText",get:function(){return this.GetLeftTopText()},set:function(t){this.SetLeftTopText(t)}},{key:"LeftBottomText",get:function(){return this.GetLeftBottomText()},set:function(t){this.SetLeftBottomText(t)}},{key:"RightTopText",get:function(){return this.GetRightTopText()},set:function(t){this.SetRightTopText(t)}},{key:"RightBottomText",get:function(){return this.GetRightBottomText()},set:function(t){this.SetRightBottomText(t)}}]),i}(hs);function _u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Eu=function(t){m()(i,t);var e=_u(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).FStyle=new oo(t,!0,!0),n.FSections=new ot,n.FSections.add(n.NewDefaultSection()),n.FActiveSectionIndex=0,n.BKImage=null,n.FBKImageVisible=!1,n.BKImagePrintVisible=!1,n.FBKImageLayout=nh.LeftTop,n.FNextAnnotateID=0,n}return l()(i,[{key:"NewDefaultSection",value:function(){var t=this,e=this.DoCreateSection();return e.OnPaintFooterAfter=function(e,i,n,o,s){t.DoSectionPaintFooterAfter(e,i,n,o,s)},e.OnCreateItemByStyle=function(e,i){return t.DoSectionCreateStyleItem(e,i)},e}},{key:"DoLoadFromStream",value:function(t,e,i,n){e.position=0;var o=Yl._LoadFileFormatAndVersion(e),s=o.fileExt,r=o.fileVersion;if(s!=Yl.HC_EXT&&this.hcl.exception("加载失败，仅支持"+Yl.HC_EXT+"文件！实际为"+s+"文件"),r>Yl.HC_FileVersionInt&&this.hcl.exception("加载失败，当前编辑器最高支持版本为"+Yl.HC_FileVersionInt.toString()+"的文件，无法打开版本为"+r.toString()+"的文件！"),r>59&&e.readByte()!=Yl.HC_STREAM_VIEW)this.hcl.exception("调用DoLoadFromStream时传递的数据不是VIEW类型！");else{if(this.DoLoadStreamBefor(e,r),i.LoadFromStream(e,r),this.DoLoadMutMargin(e,i,r),r>55){var a=e.readByte();this.FBKImageVisible=L.isOdd(a>>7),this.BKImagePrintVisible=L.isOdd(a>>6),this.FBKImageLayout=e.readByte(),this.BKImage=Yl.HCLoadImageFromStream(this.hcl,e)}else this.BKImage=null;this.FNextAnnotateID=r>66?e.readUInt32():100,t&&(this.FStyle.MergeStyle=!0);try{n(r)}finally{t&&(this.FStyle.MergeStyle=!1)}this.DoLoadStreamAfter(e,r)}}},{key:"GetActiveSection",value:function(){return this.FSections[this.FActiveSectionIndex]}},{key:"DoSectionPaintFooterAfter",value:function(t,e,i,n,o){var s=t;if(s.PageNoVisible){for(var r=this.FSections.indexOf(s),a=0,l=0,h=0;h<=this.FSections.count-1;h++)h==r&&(a=l),l+=this.FSections[h].PageCount;var c=L.stringFormat(s.PageNoFormat,a+s.PageNoFrom+e,l);n.font.size=10,n.font.name=L.DefaultFont,n.textOut(i.left+Math.trunc((i.width-n.textWidth(c))/2),i.top+s.Footer.height,c)}}},{key:"DoSectionCreateStyleItem",value:function(t,e){return null}},{key:"DoCreateSection",value:function(){return new iu(this.hcl,this.FStyle)}},{key:"DoSaveMutMargin",value:function(t){t.writeByte(0)}},{key:"DoLoadMutMargin",value:function(t,e,i){i>61&&t.readByte()}},{key:"DoSaveStreamBefor",value:function(t){}},{key:"DoSaveStreamAfter",value:function(t){}},{key:"DoLoadStreamBefor",value:function(t,e){}},{key:"DoLoadStreamAfter",value:function(t,e){}},{key:"DataSaveLiteStream",value:function(t,e){Yl._SaveFileFormatAndVersion(t),t.writeByte(Yl.HC_STREAM_LITE),this.FStyle.SaveToStream(t),e()}},{key:"DataLoadLiteStream",value:function(t,e,i){var n=Yl._LoadFileFormatAndVersion(e);if(n.fileVersion>59&&e.readByte()!=Yl.HC_STREAM_LITE)console.error("调用DataLoadLiteStream时传递的数据不是LITE类型！");else{var o=new oo(this.hcl);o.LoadFromStream(e,n.fileVersion),t&&(this.FStyle.MergeStyle=!0);try{i(n.fileVersion,o)}finally{t&&(this.FStyle.MergeStyle=!1)}}}},{key:"DeleteUnUsedStyle",value:function(t,e,i){t.TextStyles[0].CheckSaveUsed=!0,t.TextStyles[0].TempNo=0;for(var n=1;n<t.TextStyles.count;n++)t.TextStyles[n].CheckSaveUsed=!1,t.TextStyles[n].TempNo=oo.Null;for(var o=0;o<t.ParaStyles.count;o++)t.ParaStyles[o].CheckSaveUsed=!1,t.ParaStyles[o].TempNo=oo.Null;for(var s=0;s<e.count;s++)e[s].MarkStyleUsed(!0,i);for(var r=0,a=1;a<t.TextStyles.count;a++)t.TextStyles[a].CheckSaveUsed?t.TextStyles[a].TempNo=a-r:r++;r=0;for(var l=0;l<t.ParaStyles.count;l++)t.ParaStyles[l].CheckSaveUsed?t.ParaStyles[l].TempNo=l-r:r++;for(var h=null,c=0;c<=e.count-1;c++)e[c].MarkStyleUsed(!1,i),(h=e[c].ActiveData.GetTopLevelData()).CurStyleNo>oo.Null&&(h.CurStyleNo=t.TextStyles[h.CurStyleNo].TempNo),h.CurParaNo=t.ParaStyles[h.CurParaNo].TempNo;for(var u=t.TextStyles.count-1;u>=1;u--)t.TextStyles[u].CheckSaveUsed||t.TextStyles.delete(u);for(var f=t.ParaStyles.count-1;f>=0;f--)t.ParaStyles[f].CheckSaveUsed||t.ParaStyles.delete(f)}},{key:"Clear",value:function(){this.FStyle.Initialize(),this.FSections.removeRange(1,this.FSections.count-1),this.FActiveSectionIndex=0,this.FNextAnnotateID=0,this.FSections[0].Clear()}},{key:"GetPageCount",value:function(){for(var t=0,e=0;e<=this.FSections.count-1;e++)t+=this.FSections[e].PageCount;return t}},{key:"GetSectionPageIndexByPageIndex",value:function(t,e){for(var i=-1,n=0,o=0;o<this.FSections.count;o++){if(n+this.FSections[o].PageCount>t){i=o,e=t-n;break}n+=this.FSections[o].PageCount}return{pageIndex:e,result:i}}},{key:"ActiveSectionTopLevelData",value:function(){return this.ActiveSection.ActiveData.GetTopLevelData()}},{key:"SaveToFile",value:function(t){}},{key:"LoadFromFile",value:function(t){var e=this,i=!1;return ht.loadFromFile(t,(function(t){i=e.LoadFromStream(t)})),i}},{key:"SaveToText",value:function(){this.FStyle.States.Include(oh.Saving);try{for(var t=this.FSections[0].SaveToText(),e=1;e<=this.FSections.count-1;e++)t=t+Yl.sLineBreak+this.FSections[e].SaveToText();return t}finally{this.FStyle.States.Exclude(oh.Saving)}}},{key:"LoadFromText",value:function(t){if(this.clear(),this.FStyle.Initialize(),""==t)return!1;this.FStyle.States.Include(oh.Saving);try{return this.ActiveSection.InsertText(t)}finally{this.FStyle.States.Exclude(oh.Saving)}}},{key:"SaveToStream",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.FStyle.States.Include(oh.Saving);try{Yl._SaveFileFormatAndVersion(t),t.writeByte(Yl.HC_STREAM_VIEW),this.DoSaveStreamBefor(t);var n=i;null==n&&((n=new Set([])).add(ql.Header),n.add(ql.Footer),n.add(ql.Page)),e||this.DeleteUnUsedStyle(this.FStyle,this.FSections,n),this.FStyle.SaveToStream(t),this.DoSaveMutMargin(t);var o=0;this.FBKImageVisible&&(o|=128),this.BKImagePrintVisible&&(o|=64),t.writeByte(o),t.writeByte(this.FBKImageLayout),Yl.HCSaveImageToStream(t,this.BKImage),t.writeUInt32(this.FNextAnnotateID),t.writeByte(this.FSections.count);for(var s=0;s<=this.FSections.count-1;s++)this.FSections[s].SaveToStream(t,n);this.DoSaveStreamAfter(t)}finally{this.FStyle.States.Exclude(oh.Saving)}}},{key:"LoadFromStream",value:function(t){var e=this;this.FStyle.States.Include(oh.Loading);try{t.position=0;this.DoLoadFromStream(!1,t,this.FStyle,(function(i){var n=t.readByte();e.FSections[0].LoadFromStream(t,e.FStyle,i);for(var o=1;o<=n-1;o++){var s=e.NewDefaultSection();s.LoadFromStream(t,e.FStyle,i),e.FSections.add(s)}}))}finally{this.FStyle.States.Exclude(oh.Loading)}return!0}},{key:"InsertLiteStream",value:function(t){var e=this,i=!1;return this.DataLoadLiteStream(!0,t,(function(n,o){i=e.ActiveSection.InsertStream(t,o,n)})),i}},{key:"SaveToLiteStream",value:function(t){var e=this;this.DataSaveLiteStream(t,(function(){var i=e.ActiveSection.Page;e.Style.States.Include(oh.Copying);try{i.SaveItemToStream(t,0,0,i.Items.count-1,i.GetItemOffsetAfter(i.Items.count-1))}finally{e.Style.States.Exclude(oh.Copying)}}))}},{key:"PageCount",get:function(){return this.GetPageCount()}},{key:"ActiveSection",get:function(){return this.GetActiveSection()}},{key:"Sections",get:function(){return this.FSections}},{key:"Style",get:function(){return this.FStyle}}]),i}(tt);function Mu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Lu=function(){function t(e,i){r()(this,t),this.FVersion=this.GetLastVersion(),this.Header=new Zc(e,i),this.Footer=new qc(e,i),this.Paper=new Jc,this.StartPageIndex=-1,this.HeaderOffset=20,this.PageNoVisible=!0,this.PageNoFormat="{0}/{1}",this.PageNoFrom=0,this.PageNoOffset=0,this.PageNoHorAlign=as.Center,this.HeaderVerAlign=ls.Center}return l()(t,[{key:"GetLastVersion",value:function(){return 0}},{key:"SaveToStream",value:function(t){this.FVersion=this.GetLastVersion(),t.writeByte(this.FVersion),t.writeInt32(this.HeaderOffset),t.writeInt32(this.StartPageIndex),t.writeByte(this.HeaderVerAlign),t.writeBoolean(this.PageNoVisible),Yl.HCSaveTextToStream(t,this.PageNoFormat),t.writeInt32(this.PageNoFrom),t.writeInt32(this.PageNoOffset),t.writeByte(this.PageNoHorAlign),this.Paper.SaveToStream(t),this.Header.SaveToStream(t),this.Footer.SaveToStream(t)}},{key:"LoadFromStream",value:function(t,e,i){this.FVersion=t.readByte(),this.HeaderOffset=t.readInt32(),this.StartPageIndex=t.readInt32(),i>65?(this.HeaderVerAlign=t.readByte(),this.PageNoVisible=t.readBoolean(),this.PageNoFormat=Yl.HCLoadTextFromStream(t,i),this.PageNoFormat=this.PageNoFormat.replace("%d","{0}"),this.PageNoFormat=this.PageNoFormat.replace("%d","{1}"),this.PageNoFrom=t.readInt32(),this.PageNoOffset=t.readInt32(),this.PageNoHorAlign=t.readByte()):(this.PageNoVisible=!0,this.PageNoFormat="{0}/{1}",this.PageNoFrom=0,this.PageNoOffset=0,this.PageNoHorAlign=as.Center,this.HeaderVerAlign=ls.Center),this.Paper.LoadFromStream(t,i),this.Header.Width=this.Paper.GetPageWidthPix(),this.Header.LoadFromStream(t,e,i),this.Footer.Width=this.Header.Width,this.Footer.LoadFromStream(t,e,i)}}]),t}(),Gu=function(t){m()(i,t);var e=Mu(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).FFirstPageIndex=-1,n.FOddPageIndex=-1,n.FEvenPageIndex=-1,n.FMargins=new ot,n}return l()(i,[{key:"DoSectionMarkStyleUsed",value:function(t,e){var i=e;null==i&&((i=new Set([])).add(ql.Header),i.add(ql.Footer),i.add(ql.Page));for(var n=0;n<this.FMargins.count;n++)i.has(ql.Header)&&this.FMargins[n].Header.MarkStyleUsed(t),i.has(ql.Footer)&&this.FMargins[n].Footer.MarkStyleUsed(t)}},{key:"GetMargin",value:function(t,e){var i=this.GetPageIndexBySectionPageIndex(t,e);if(i<0)return null;if(0===i){if(this.FFirstPageIndex>=0)return this.FMargins[this.FFirstPageIndex];if(this.FOddPageIndex>=0)return this.FMargins[this.FOddPageIndex]}else{if(this.FOddPageIndex>=0&&!L.isOdd(i))return this.FMargins[this.FOddPageIndex];if(this.FEvenPageIndex>=0&&L.isOdd(i))return this.FMargins[this.FEvenPageIndex]}for(var n=this.FMargins.count-1;n>=0;n--)if(n!==this.FFirstPageIndex&&n!==this.FOddPageIndex&&n!==this.FEvenPageIndex&&i>=this.FMargins[n].StartPageIndex)return this.FMargins[n];return null}},{key:"GetMarginBySection",value:function(t,e){return this.GetMargin(this.FSections.indexOf(t),e)}},{key:"NewMutMargin",value:function(){var t=new Lu(this.hcl,this.Style);return this.ActiveSection.SetDataEvent(t.Header),this.ActiveSection.SetDataEvent(t.Footer),this.FMargins.add(t),t}},{key:"GetFirstPageDifferent",value:function(){return this.FFirstPageIndex>=0}},{key:"SetFirstPageDifferent",value:function(t){if(t){if(this.FFirstPageIndex<0){var e=this.NewMutMargin();e.StartPageIndex=0,e.Paper.Assign(this.ActiveSection.Paper),e.Header.Width=e.Paper.GetPageWidthPix(),e.Footer.Width=e.Paper.GetPageWidthPix(),this.FFirstPageIndex=this.FMargins.count-1}}else this.FFirstPageIndex>=0&&(this.FOddPageIndex>this.FFirstPageIndex&&this.FOddPageIndex--,this.FEvenPageIndex>this.FFirstPageIndex&&this.FEvenPageIndex--,this.FMargins.delete(this.FFirstPageIndex),this.FFirstPageIndex=-1);this.FormatData()}},{key:"GetOddPageDifferent",value:function(){return this.FOddPageIndex>=0}},{key:"SetOddPageDifferent",value:function(t){if(t){if(this.FOddPageIndex<0){var e=this.NewMutMargin();e.StartPageIndex=0,e.Paper.Assign(this.ActiveSection.Paper),e.Header.Width=e.Paper.GetPageWidthPix(),e.Footer.Width=e.Paper.GetPageWidthPix(),this.FOddPageIndex=this.FMargins.count-1}}else this.FOddPageIndex>=0&&(this.FFirstPageIndex>this.FOddPageIndex&&this.FFirstPageIndex--,this.FEvenPageIndex>this.FOddPageIndex&&this.FEvenPageIndex--,this.FMargins.delete(this.FOddPageIndex),this.FOddPageIndex=-1);this.FormatData()}},{key:"GetEvenPageDifferent",value:function(){return this.FEvenPageIndex>=0}},{key:"SetEvenPageDifferent",value:function(t){if(t){if(this.FEvenPageIndex<0){var e=this.NewMutMargin();e.StartPageIndex=0,e.Paper.Assign(this.ActiveSection.Paper),e.Header.Width=e.Paper.GetPageWidthPix(),e.Footer.Width=e.Paper.GetPageWidthPix(),this.FEvenPageIndex=this.FMargins.count-1}}else this.FEvenPageIndex>=0&&(this.FFirstPageIndex>this.FEvenPageIndex&&this.FFirstPageIndex--,this.FOddPageIndex>this.FEvenPageIndex&&this.FOddPageIndex--,this.FMargins.delete(this.FEvenPageIndex),this.FEvenPageIndex=-1);this.FormatData()}},{key:"DoFormatData",value:function(){for(var t=0;t<this.FMargins.count;t++)this.FMargins[t].Header.ReFormat(),this.FMargins[t].Footer.ReFormat();f()(F()(i.prototype),"DoFormatData",this).call(this)}},{key:"DoCreateSection",value:function(){var t=this,e=new Hu(this.hcl,this.Style);return e.OnGetMargin=function(e,i){return t.GetMarginBySection(e,i)},e.OnMarkStyleUsed=function(e,i){t.DoSectionMarkStyleUsed(e,i)},e}},{key:"DoSaveMutMargin",value:function(t){t.writeInt32(this.FFirstPageIndex),t.writeInt32(this.FOddPageIndex),t.writeInt32(this.FEvenPageIndex);var e=this.FMargins.count;t.writeByte(e);for(var i=0;i<e;i++)this.FMargins[i].SaveToStream(t)}},{key:"DoLoadMutMargin",value:function(t,e,i){if(i>61){this.FFirstPageIndex=t.readInt32(),this.FOddPageIndex=t.readInt32(),this.FEvenPageIndex=t.readInt32();for(var n=t.readByte(),o=0;o<n;o++)this.NewMutMargin().LoadFromStream(t,e,i)}}},{key:"Clear",value:function(){this.FMargins.clear(),f()(F()(i.prototype),"Clear",this).call(this)}},{key:"InsertStreamMutMargin",value:function(t){var e=this;this.DoLoadProceDelegate((function(){var i=new oo(e.hcl);e.DoLoadFromStream(!0,t,i,(function(n){for(var o=t.readByte(),s=null,r=0,a=0;a<o;a++)(s=e.NewMutMargin()).StartPageIndex=e.PageCount,r=t.position,e.ActiveSection.ActiveData.IsEmptyData()?(e.ActiveSection.SeekStreamToArea(t,i,n,ql.Header,!0),s.Paper.Assign(e.ActiveSection.Paper)):(e.ActiveSection.SeekStreamToArea(t,i,n,ql.Header,!1),s.Paper.Width=e.ActiveSection.Paper.Width,s.Paper.Height=e.ActiveSection.Paper.Height,s.Paper.MarginLeft=e.ActiveSection.Paper.MarginLeft,s.Paper.MarginRight=e.ActiveSection.Paper.MarginRight),s.Header.Width=s.Paper.GetPageWidthPix(),s.Footer.Width=s.Paper.GetPageWidthPix(),s.Header.LoadFromStream(t,i,n),t.position=r,e.ActiveSection.SeekStreamToArea(t,i,n,ql.Footer,!1),s.Footer.LoadFromStream(t,i,n),t.position=r,e.ActiveSection.SeekStreamToArea(t,i,n,ql.Page,!1),e.ActiveSection.Page.IsEmptyData()||e.ActiveSection.Page.InsertBreak(),e.ActiveSection.InsertStream(t,i,n)}))}))}},{key:"CloneMutMargin",value:function(t,e){var i=this.NewMutMargin();return i.StartPageIndex=e,t<0?(i.Paper.Assign(this.ActiveSection.Paper),i.Header.Width=i.Paper.GetPageWidthPix(),i.Footer.Width=i.Paper.GetPageWidthPix(),i.Header.Clone(this.ActiveSection.Header),i.Footer.Clone(this.ActiveSection.Footer),i.HeaderOffset=this.ActiveSection.HeaderOffset,i.PageNoVisible=this.ActiveSection.PageNoVisible,i.PageNoFormat=this.ActiveSection.PageNoFormat,i.PageNoOffset=this.ActiveSection.PageNoOffset,i.PageNoHorAlign=this.ActiveSection.PageNoHorAlign,i.HeaderVerAlign=this.ActiveSection.HeaderVerAlign):(i.Paper.Assign(this.FMargins[t].Paper),i.Header.Width=i.Paper.GetPageWidthPix(),i.Footer.Width=i.Paper.GetPageWidthPix(),i.Header.Clone(this.FMargins[t].Header),i.Header.Clone(this.FMargins[t].Footer)),i.Header.ReFormat(),i.Footer.ReFormat(),i}},{key:"GetMarginByPageIndex",value:function(t){var e=this.GetSectionPageIndexByPageIndex(t,-1);return e.result>=0?this.GetMargin(e.result,e.pageIndex):null}},{key:"FirstPageDifferent",get:function(){return this.GetFirstPageDifferent()},set:function(t){this.SetFirstPageDifferent(t)}},{key:"OddPageDifferent",get:function(){return this.GetOddPageDifferent()},set:function(t){this.SetOddPageDifferent(t)}},{key:"EvenPageDifferent",get:function(){return this.GetEvenPageDifferent()},set:function(t){this.SetEvenPageDifferent(t)}}]),i}(pu),Hu=function(t){m()(i,t);var e=Mu(i);function i(t,n){var o;return r()(this,i),(o=e.call(this,t,n)).OnMarkStyleUsed=null,o.OnGetMargin=null,o}return l()(i,[{key:"GetHeaderOffset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(null!=this.OnGetMargin){var e=this.OnGetMargin(this,t);if(null!=e)return e.HeaderOffset}return f()(F()(i.prototype),"GetHeaderOffset",this).call(this,t)}},{key:"GetHeader",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(null!=this.OnGetMargin){var e=this.OnGetMargin(this,t);if(null!=e)return e.Header}return f()(F()(i.prototype),"GetHeader",this).call(this,t)}},{key:"GetFooter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(null!=this.OnGetMargin){var e=this.OnGetMargin(this,t);if(null!=e)return e.Footer}return f()(F()(i.prototype),"GetFooter",this).call(this,t)}},{key:"DoMarkStyleUsed",value:function(t,e){null!=this.OnMarkStyleUsed&&this.OnMarkStyleUsed(t,e)}},{key:"GetHeaderAreaHeight",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(null!=this.OnGetMargin){var e=this.OnGetMargin(this,t);if(null!=e){var n=e.HeaderOffset+e.Header.Height;return n<e.Paper.MarginTopPix&&(n=e.Paper.MarginTopPix),n}}return f()(F()(i.prototype),"GetHeaderAreaHeight",this).call(this,t)}},{key:"GetFooterAreaHeight",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(null!=this.OnGetMargin){var e=this.OnGetMargin(this,t);if(null!=e)return e.Paper.MarginBottomPix}return f()(F()(i.prototype),"GetFooterAreaHeight",this).call(this,t)}},{key:"GetHeaderPageDrawTop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(null!=this.OnGetMargin){var e=this.OnGetMargin(this,t);if(null!=e){var n=e.HeaderOffset,o=e.Header.Height;if(o<e.Paper.MarginTopPix-e.HeaderOffset)switch(e.HeaderVerAlign){case ls.Top:break;case ls.Center:n+=Math.trunc((e.Paper.MarginTopPix-e.HeaderOffset-o)/2);break;case ls.Bottom:n+=e.Paper.MarginTopPix-e.HeaderOffset-o}return n}}return f()(F()(i.prototype),"GetHeaderPageDrawTop",this).call(this,t)}},{key:"GetPageNoOffset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(null!=this.OnGetMargin){var e=this.OnGetMargin(this,t);if(null!=e)return e.PageNoOffset}return f()(F()(i.prototype),"GetPageNoOffset",this).call(this,t)}},{key:"MarkStyleUsed",value:function(t,e){f()(F()(i.prototype),"MarkStyleUsed",this).call(this,t,e),this.DoMarkStyleUsed(t,e)}}]),i}(iu);function Vu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}function Uu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Wu=function(t){m()(i,t);var e=Uu(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).FPropertys=new rt,n}return l()(i,[{key:"createBefor",value:function(){f()(F()(i.prototype),"createBefor",this).call(this),Vs.HCDefaultTextItemClass=rc,rs.HCDefaultDomainItemClass=Nc}},{key:"DoSectionCreateStyleItem",value:function(t,e){return i.CreateEmrStyleItem(this.hcl,t,e)}},{key:"DoLoadStreamBefor",value:function(t,e){var n=0;if(e>43&&(n=t.readByte()),n>0){var o=Yl.HCLoadTextFromStream(t,e);this.Style.States.Contain(oh.Loading)&&(e>64?Yl.SetPropertyString(o,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(o,this.FPropertys))}else this.Style.States.Contain(oh.Loading)&&this.FPropertys.clear();f()(F()(i.prototype),"DoLoadStreamBefor",this).call(this,t,e)}},{key:"DoSaveStreamBefor",value:function(t){t.writeByte(i.EmrViewVersion);var e=Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator);Yl.HCSaveTextToStream(t,e),f()(F()(i.prototype),"DoSaveStreamBefor",this).call(this,t)}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){e=e.toString(),Yl.HCSetProperty(this.FPropertys,t,e)}},{key:"TraverseItem",value:function(t){if(0!=t.Areas.values)for(var e=0;e<this.Sections.count;e++)t.Stop||(t.Areas.has(ql.Header)&&this.Sections[e].Header.TraverseItem(t),!t.Stop&&t.Areas.has(ql.Page)&&this.Sections[e].Page.TraverseItem(t),!t.Stop&&t.Areas.has(ql.Footer)&&this.Sections[e].Footer.TraverseItem(t))}},{key:"TraverseElement",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(null!=t){var s=e;if(null==s){var r=new Set([]);r.add(ql.Header),r.add(ql.Footer),r.add(ql.Page)}else if(0==s.size)return;var a=new Ks;a.Tag=i,a.Areas=s,a.Process=t,a.ReverseOrder=n,a.Invisible=o,this.TraverseItem(a)}}},{key:"Structure",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.ActiveSection.DisSelect();var e=null,i=new Ks;i.ReverseOrder=!0,i.Invisible=!0,i.Areas.add(ql.Page),i.Areas.add(ql.Header),i.Areas.add(ql.Footer);var n=!0;i.Process=function(i,o,s,r,a){if(n=!0,null!==t&&(n=t(i,o,i.Items[o])),n&&i.Items[o].StyleNo>oo.Null){if((e=i.Items[o]).TraceStyles.has(jh.Del)){if(1!==i.Items.count||0!==o)return e.ParaFirst&&o<i.Items.count-1&&(i.Items[o+1].ParaFirst||(i.Items[o+1].ParaFirst=!0)),void i.Items.delete(o);e.DeleteProperty(Yh.TraceDel),e.DeleteProperty(Yh.TraceDelLevel),e.DeleteProperty(Yh.Trace),e.TraceStyles.value=0,e.ParaFirst=!0,e.Text=""}e.IsElement&&e.Reset(),e.DeleteProperty(Yh.TraceAdd),e.DeleteProperty(Yh.TraceAddLevel),e.DeleteProperty(Yh.Trace),e.TraceStyles.value=0}},this.TraverseItem(i)}},{key:"SaveToStreamStructure",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.Structure(n),this.SaveToStream(t,e,i)}},{key:"SaveToBytes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=new ht;return this.SaveToStream(i,t,e),i.buffer}},{key:"LoadFromBytes",value:function(t){var e=new ht;e.writeBuffer(t),e.position=0,this.LoadFromStream(e),e=null}},{key:"InsertLiteBytes",value:function(t){var e=new ht;e.writeBuffer(t),e.position=0,this.InsertLiteStream(e),e=null}},{key:"SaveToLiteBytes",value:function(){var t=new ht;return this.SaveToLiteStream(t),t.buffer}},{key:"SetActiveSectionPaperInfo",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t.size)if("object"==o()(t.size))this.ActiveSection.PaperWidth=t.size.width,this.ActiveSection.PaperHeight=t.size.height;else{var i=Yl.GetPaperSizeByName(t.size),n=Yl.GetPaperSizeInfo(i);this.ActiveSection.PaperSize=i,this.ActiveSection.PaperOrientation===Ql.Portrait?(this.ActiveSection.PaperWidth=n.Width,this.ActiveSection.PaperHeight=n.Height):(this.ActiveSection.PaperWidth=n.Height,this.ActiveSection.PaperHeight=n.Width)}if(t.margin&&(t.margin.left&&t.margin.left>=0&&(this.ActiveSection.PaperMarginLeft=t.margin.left),t.margin.top&&t.margin.top>=0&&(this.ActiveSection.PaperMarginTop=t.margin.top),t.margin.right&&t.margin.right>=0&&(this.ActiveSection.PaperMarginRight=t.margin.right),t.margin.bottom&&t.margin.bottom>=0&&(this.ActiveSection.PaperMarginBottom=t.margin.bottom)),t.orientation&&this.ActiveSection.PaperOrientation!=t.orientation){this.ActiveSection.PaperOrientation=t.orientation;var s=this.ActiveSection.PaperWidth;this.ActiveSection.PaperWidth=this.ActiveSection.PaperHeight,this.ActiveSection.PaperHeight=s}e&&this.ResetActiveSectionMargin()}},{key:"ResetActiveSectionMargin",value:function(){this.ActiveSection.ResetMargin()}},{key:"InnerView",get:function(){return this}}],[{key:"CreateEmrStyleItem",value:function(t,e,i){switch(i){case oo.Table:return new uc(t,e,1,1,1);case oo.CheckBox:return new fc(t,e,"勾选框",!1);case oo.Edit:return new mc(t,e,"");case oo.Combobox:return new Sc(t,e,"");case oo.DateTimePicker:return new pc(t,e,lt.Now());case oo.Button:return new dc(t,e,"");case oo.RadioGroup:return new yc(t,e);case mh.EMRSTYLE_YUEJING:return new gu(t,e,"","","","");case mh.EMRSTYLE_TOOTH:return new Vc(t,e,"","","","");case mh.EMRSTYLE_FANGJIAO:return new Rc(t,e,"","","","");case mh.EMRSTYLE_CHINESEMED:return new wu(t,e,"","","");case mh.EMRSTYLE_GESTATIONWEEK:return new Du(t,e,"","");case mh.EMRSTYLE_PUPIL:return new ku(t,e,"","","","","","","");case mh.EMRSTYLE_LIGHTPERCEPTION:return new Ru(t,e,"","","","","","","","","");case mh.EMRSTYLE_FETALHEART:return new bu(t,e,"","","","","","");case mh.EMRSTYLE_PAMERTOOTH:return new Ou(t,e,"","","","");case oo.BarCode:return new Fc(t,e,"");case oo.QRCode:return new vc(t,e,"");case oo.FloatBarCode:return new Ic(t,e);case oo.FloatQRCode:return new gc(t,e);case oo.Image:return new wc(t,e);case oo.FloatImage:return new Cc(t,e);case oo.Fraction:return new Ac(t,e,"","");case oo.Fraction2:return new Dc(t,e,"","");default:return null}}}]),i}(function(t){m()(i,t);var e=Vu(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).FFirstPageIndex=-1,n.FOddPageIndex=-1,n.FEvenPageIndex=-1,n.FMargins=new ot,n}return l()(i,[{key:"DoSectionMarkStyleUsed",value:function(t,e){var i=e;null==i&&((i=new Set([])).add(ql.Header),i.add(ql.Footer),i.add(ql.Page));for(var n=0;n<this.FMargins.count;n++)i.has(ql.Header)&&this.FMargins[n].Header.MarkStyleUsed(t),i.has(ql.Footer)&&this.FMargins[n].Footer.MarkStyleUsed(t)}},{key:"GetMarginBySection",value:function(t,e){if(e<0)return null;if(this.FFirstPageIndex>=0&&0===e)return this.FMargins[this.FFirstPageIndex];if(this.FOddPageIndex>=0&&!L.isOdd(e))return this.FMargins[this.FOddPageIndex];if(this.FEvenPageIndex>=0&&L.isOdd(e))return this.FMargins[this.FEvenPageIndex];if(0===e&&this.FMargins.count>0&&this.FEvenPageIndex>=0)return this.FMargins[0];for(var i=this.FMargins.count-1;i>=0;i--)if(i!==this.FFirstPageIndex&&i!==this.FOddPageIndex&&i!==this.FEvenPageIndex&&e>=this.FMargins[i].StartPageIndex)return this.FMargins[i]}},{key:"NewMutMargin",value:function(){var t=new Lu(this.hcl,this.Style);return this.ActiveSection.SetDataEvent(t.Header),this.ActiveSection.SetDataEvent(t.Footer),this.FMargins.add(t),t}},{key:"GetFirstPageDifferent",value:function(){return this.FFirstPageIndex>=0}},{key:"GetOddPageDifferent",value:function(){return this.FOddPageIndex>=0}},{key:"GetEvenPageDifferent",value:function(){return this.FEvenPageIndex>=0}},{key:"DoCreateSection",value:function(){var t=this,e=new Hu(this.hcl,this.Style);return e.OnGetMargin=function(e,i){return t.GetMarginBySection(e,i)},e.OnMarkStyleUsed=function(e,i){t.DoSectionMarkStyleUsed(e,i)},e}},{key:"DoSaveMutMargin",value:function(t){t.writeInt32(this.FFirstPageIndex),t.writeInt32(this.FOddPageIndex),t.writeInt32(this.FEvenPageIndex);var e=this.FMargins.count;t.writeByte(e);for(var i=0;i<e;i++)this.FMargins[i].SaveToStream(t)}},{key:"DoLoadMutMargin",value:function(t,e,i){if(i>61){this.FFirstPageIndex=t.readInt32(),this.FOddPageIndex=t.readInt32(),this.FEvenPageIndex=t.readInt32();for(var n=t.readByte(),o=0;o<n;o++)this.NewMutMargin().LoadFromStream(t,e,i)}}},{key:"Clear",value:function(){this.FMargins.clear(),f()(F()(i.prototype),"Clear",this).call(this)}},{key:"InsertStreamMutMargin",value:function(t){var e=this;this.DoLoadProceDelegate((function(){var i=new oo(e.hcl);e.DoLoadFromStream(!0,t,i,(function(n){for(var o=t.readByte(),s=null,r=0,a=0;a<o;a++)(s=e.NewMutMargin()).StartPageIndex=e.PageCount,r=t.position,e.ActiveSection.ActiveData.IsEmptyData()?(e.ActiveSection.SeekStreamToArea(t,i,n,ql.Header,!0),s.Paper.Assign(e.ActiveSection.Paper)):(e.ActiveSection.SeekStreamToArea(t,i,n,ql.Header,!1),s.Paper.Width=e.ActiveSection.Paper.Width,s.Paper.Height=e.ActiveSection.Paper.Height,s.Paper.MarginLeft=e.ActiveSection.Paper.MarginLeft,s.Paper.MarginRight=e.ActiveSection.Paper.MarginRight),s.Header.Width=s.Paper.GetPageWidthPix(),s.Footer.Width=s.Paper.GetPageWidthPix(),s.Header.LoadFromStream(t,i,n),t.position=r,e.ActiveSection.SeekStreamToArea(t,i,n,ql.Footer,!1),s.Footer.LoadFromStream(t,i,n),t.position=r,e.ActiveSection.SeekStreamToArea(t,i,n,ql.Page,!1),e.ActiveSection.Page.IsEmptyData()||e.ActiveSection.Page.InsertBreak(),e.ActiveSection.InsertStream(t,i,n)}))}))}},{key:"FirstPageDifferent",get:function(){return this.GetFirstPageDifferent()}},{key:"OddPageDifferent",get:function(){return this.GetOddPageDifferent()}},{key:"EvenPageDifferent",get:function(){return this.GetEvenPageDifferent()}}]),i}(Eu));function zu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}Wu.EmrViewVersion=1;var Ku={None:0,RadioGroupSetItemChecked:1,TableCellChange:2,CheckBoxCheckChanged:3,ButtonClick:4,ItemChange:5,DomainChange:6},Ju=function(t){m()(i,t);var e=zu(i);function i(){var t;return r()(this,i),(t=e.call(this)).ItemNo=-1,t.Offset=-1,t.DrawItemNo=-1,t.Item=null,t}return l()(i)}(function(t){m()(i,t);var e=zu(i);function i(){var t;return r()(this,i),(t=e.call(this)).Data=null,t.ScriptData=null,t}return l()(i)}(function(t){m()(i,t);var e=zu(i);function i(){var t;return r()(this,i),(t=e.call(this)).Section=null,t}return l()(i)}(function(t){m()(i,t);var e=zu(i);function i(){var t;return r()(this,i),(t=e.call(this)).EmrView=null,t}return l()(i)}(function(){function t(){r()(this,t),this.Action=Ku.None,this.THCStyle=oo,this.THCAction=rh,this.THCScriptAction=Ku}return l()(t,[{key:"GetEnvironment",value:function(){return""}}]),t}())))),ju=function(t){m()(i,t);var e=zu(i);function i(){var t;return r()(this,i),(t=e.call(this)).Action=Ku.RadioGroupSetItemChecked,t.ItemIndex=-1,t}return l()(i)}(Ju),Yu=function(t){m()(i,t);var e=zu(i);function i(){var t;return r()(this,i),(t=e.call(this)).Action=Ku.TableCellChange,t.OrgRow=-1,t.OrgCol=-1,t.DestRow=-1,t.DestCol=-1,t}return l()(i)}(Ju),Qu=function(t){m()(i,t);var e=zu(i);function i(){var t;return r()(this,i),(t=e.call(this)).Action=Ku.CheckBoxCheckChanged,t}return l()(i)}(Ju),Xu=function(t){m()(i,t);var e=zu(i);function i(){var t;return r()(this,i),(t=e.call(this)).Action=Ku.ButtonClick,t}return l()(i)}(Ju),Zu=function(t){m()(i,t);var e=zu(i);function i(){var t;return r()(this,i),(t=e.call(this)).Action=Ku.ItemChange,t.ChangeAction=0,t}return l()(i)}(Ju),qu=function(t){m()(i,t);var e=zu(i);function i(){var t;return r()(this,i),(t=e.call(this)).Action=Ku.DomainChange,t.DomainItemNo=-1,t.ChangeAction=0,t}return l()(i)}(Ju);function $u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var tf=function(){function t(){r()(this,t),this.clear()}return l()(t,[{key:"getHint",value:function(){if(null===this.Data||this.Data.MouseMoveRestrain)return"";if(this.ItemNo<0||this.ItemNo>this.Data.Items.count-1)return"";var t="";if(this.Data.Items[this.ItemNo].StyleNo>oo.Null&&0!==this.Data.Items[this.ItemNo].TraceStyles.value&&""!==(t=this.Data.Items[this.ItemNo].GetHint()))return t;var e="";this.Data.HotDomain.BeginNo>=0&&!this.Data.Items[this.Data.HotDomain.BeginNo].IsProc&&this.Data.HotDomain.BeginNo!==this.ItemNo&&this.Data.HotDomain.EndNo!==this.ItemNo&&(e=this.Data.Items[this.Data.HotDomain.BeginNo].Name);var i=this.Data.Items[this.ItemNo].Name;return null==i&&(i=""),""!==e?e+(i?">"+i:""):i}},{key:"clear",value:function(){this.Section=null,this.Data=null,this.DataMouseMoveRestrain=!1,this.ItemNo=-1,this.DrawItemNo=-1}}]),t}(),ef=0,nf=1,of=2,sf=function(){function t(){r()(this,t),this.range=0,this.step=0,this._intervalAdd=0,this.forth=!0,this.stoped=!1,this.object=null,this.property=null,this.startValue=0,this.endValue=255,this.loop=!1,this.loopCount=-1,this.time=1e3,this.backForth=!1}return l()(t,[{key:"start",value:function(){this.stoped=!1,this.backForth?this.forth?(this.range=this.endValue-this.startValue,this.object[this.property]=this.startValue):(this.range=this.startValue-this.endValue,this.object[this.property]=this.endValue):(this.range=this.endValue-this.startValue,this.object[this.property]=this.startValue)}},{key:"execute",value:function(t){if(this._intervalAdd+=t,this.step=Math.trunc(this.range/this.time*this._intervalAdd),0!=this.step){if(this._intervalAdd=0,this.startValue<this.endValue)if(this.forth){if(this.object[this.property]+this.step<this.endValue)return void(this.object[this.property]+=this.step);this.object[this.property]=this.endValue,this.stoped=!0}else{if(this.object[this.property]+this.step>this.startValue)return void(this.object[this.property]+=this.step);this.object[this.property]=this.startValue,this.stoped=!0}else if(this.forth){if(this.object[this.property]+this.step>this.endValue)return void(this.object[this.property]+=this.step);this.object[this.property]=this.endValue,this.stoped=!0}else{if(this.object[this.property]+this.step<this.startValue)return void(this.object[this.property]+=this.step);this.object[this.property]=this.startValue,this.stoped=!0}this.loop&&(this.backForth&&(this.forth=!this.forth),this.loopCount<0?this.start():this.loopCount>0&&(this.loopCount--,this.loopCount>0&&this.start()))}}},{key:"value",get:function(){return this.object[this.property]}}]),t}(),rf=function(t){m()(i,t);var e=$u(i);function i(){var t;return r()(this,i),(t=e.call(this)).loop=!0,t.items=new ot,t.items.onAdded=function(e){e.start(),t._stoped&&t.start()},t.items.onRemoved=function(e){0==t.items.count&&t.stop()},t}return l()(i,[{key:"doExecute_",value:function(t){var e=this;this.items.forEach((function(i,n){i.stoped?e.items.removeAt(n):i.execute(t)})),f()(F()(i.prototype),"doExecute_",this).call(this,t)}},{key:"start",value:function(){this.items.count>0&&f()(F()(i.prototype),"start",this).call(this)}},{key:"new",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1e3;if(null!=t&&""!=e){var l=new sf;l.object=t,l.property=e,l.startValue=i,l.endValue=n,l.loop=o,l.loopCount=s,l.backForth=r,l.time=a,this.items.add(l)}}}]),i}(ft),af=l()((function t(){r()(this,t),this.DelBrushStyle=Mt.Clear,this.DelBrushColor="#FFB6C1",this.DelPenStyle=_t.Solid,this.DelPenColor=Ft.Red,this.DelPenWidth=1,this.AddBrushStyle=Mt.Clear,this.AddBrushColor="#E0FFFF",this.AddPenStyle=_t.Solid,this.AddPenColor=Ft.Blue,this.AddPenWidth=1})),lf={Wave:1,BK:2},hf=function(t){m()(i,t);var e=$u(i);function i(t){var n;return r()(this,i),(n=e.call(this,t))._width=100,n._height=100,n.FHideTrace=!1,n.Secret=!1,n.FTraceInfoAnnotate=!1,n.FTrace=!1,n.FTraceCount=0,n.FTraceCountDel=0,n.FTraceOption=ef,n.FDesignMode=!1,n.FIgnoreAcceptAction=!1,n.FDeDoneColor=Yl.clBtnFace,n.FDeUnDoneColor="#FFDD80",n.FDeHotColor="#cce0f4",n.UseDeChangedColor=!1,n.FDeChangedColor="#c6e2c6",n.FPageBlankTip="",n.FPropertys=new rt,n.HintInfo=new tf,n.TraceDrawStyle=new af,n.MergeFile=!1,n.DeItemMark=!1,n.ResetIteming=!1,n.SupportDrop=!0,n.UnAllocWarningStyle={Style:lf.Wave,BkColor:"#ffb6c1",WvColor:"#ff0000"},n.OutOfRangStyle={Style:lf.Wave,BkColor:"#ffb6c1",WvColor:"#ff0000"},n.SyntaxStyle={ContradictionColor:"#ff0000",WrongColor:"#ffa500"},n.OnCanNotEdit=null,n.OnSyncDeItem=null,n.OnCopyRequest=null,n.OnPasteRequest=null,n.OnCopyAsStream=null,n.OnPasteFromStream=null,n.OnSyntaxCheck=null,n.OnSyntaxPaint=null,n.OnDrawTrace=null,n.OnSaveItem=null,n.OnInsertHtml=null,n.Style.DefaultTextStyle.Size=Nt.fontSizeToPt("小四"),n.Style.DefaultTextStyle.Family=L.DefaultFont,n.HScrollBar.addStatus(200),Yl.PROCSERIES&&(n.FUnEditProcBKColor=Yl.clBtnFace,n.FShowProcSplit=!0,n.CanEditCheckInEditProc=!0,n.FProcCount=0,n.FCaretProcInfo=new Oc,n.FEditProcInfo=new Oc,n.FEditProcIndex=""),n.PrintHideUnAllocValue=!1,n.PrintUnAlloc=!1,n.UnAllocWarning=!0,n.EditProtectKeepPara=!1,n.PrintSave=!1,n.ReadOnlyViewPrint=!1,n.fileVersion="160172",n.copyRight="编辑器由 HCView 提供 未授权",n.customVersion=0,n.DefaultCheckText="勾选框",n.DefaultEditText="文本框",n.DefaultComboboxText="请选择",n.Animates=new rf,n.Animates.onExecute=function(){n.UpdateView(!0)},n.FormMode=!1,n.GlobalScriptObj=null,n.OnGetHint=null,n.OnClear=null,n}return l()(i,[{key:"createBefor",value:function(){Vs.HCDefaultTextItemClass=rc,rs.HCDefaultDomainItemClass=Nc}},{key:"getHint_",value:function(){if(null!==this.OnGetHint){if(null===this.HintInfo.Data||this.HintInfo.DataMouseMoveRestrain)return"";if(this.HintInfo.ItemNo<0||this.HintInfo.ItemNo>this.HintInfo.Data.Items.count-1)return"";if(!this.OnGetHint(this.HintInfo.Data,this.HintInfo.ItemNo))return""}return this.HintInfo.getHint()}},{key:"getHintRect",value:function(){return null}},{key:"doMouseMove_",value:function(t){this.HintInfo.clear(),f()(F()(i.prototype),"doMouseMove_",this).call(this,t)}},{key:"doDrop_",value:function(t){this.SupportDrop&&f()(F()(i.prototype),"doDrop_",this).call(this,t)}},{key:"DoSectionDrawItemMouseMove",value:function(t,e,n,o,s,r){f()(F()(i.prototype),"DoSectionDrawItemMouseMove",this).call(this,t,e,n,o,s,r),this.HintInfo.Section=t,this.HintInfo.Data=e,this.HintInfo.DataMouseMoveRestrain=e.MouseMoveRestrain,this.HintInfo.ItemNo=n,this.HintInfo.DrawItemNo=s}},{key:"TraverseTableTraceItem",value:function(t,e){for(var i=null,n=null,o=0,s=t.RowCount;o<s;o++)for(var r=0,a=t.ColCount;r<a;r++)if(null!==t.Rows[o][r].CellData){i=t.Rows[o][r].CellData;for(var l=0;l<i.Items.count;l++)i.Items[l].StyleNo>oo.Null?0!=(n=i.Items[l]).TraceStyles.value&&e(i,n):i.Items[l].StyleNo===oo.Table&&(this.TraverseTableTraceItem(i.Items[l],e),i.Items[l].FormatDirty())}}},{key:"SetHideTrace",value:function(t){var e=this;if(this.FHideTrace!=t){var i;this.FHideTrace=t,this.DisSelect();var n=new Ks;n.Invisible=!0,n.Areas.add(ql.Header),n.Areas.add(ql.Footer),n.Areas.add(ql.Page),n.Process=function(t,n,o,s,r){t.Items[n].StyleNo>oo.Null?((i=t.Items[n]).TraceStyles.has(jh.Del)&&(i.Visible=!e.FHideTrace),e.FTraceInfoAnnotate&&0!==i.TraceStyles.value&&(e.FHideTrace?e.AnnotatePre.RemoveDataAnnotate(null):e.AnnotatePre.InsertDataAnnotate(null))):t.Items[n].StyleNo===oo.Table?(e.TraverseTableTraceItem(t.Items[n],(function(t,i){e.FTraceInfoAnnotate&&(e.FHideTrace?e.AnnotatePre.RemoveDataAnnotate(null):e.AnnotatePre.InsertDataAnnotate(null))})),t.Items[n].FormatDirty()):t.Items[n].isClass(Cs)&&t.Items[n].FormatDirty()},this.TraverseItem(n),this.FormatData()}}},{key:"SetPageBlankTip",value:function(t){this.FPageBlankTip!=t&&(this.FPageBlankTip=t,this.UpdateView())}},{key:"DoSyntaxCheck",value:function(t,e,i,n){t.Items[e].StyleNo>oo.Null&&this.OnSyntaxCheck(t,n,e)}},{key:"DoSyncDeItem",value:function(t,e,i){this.MergeFile||null!=this.OnSyncDeItem&&this.OnSyncDeItem(t,e,i)}},{key:"DoSectionInsertTextBefor",value:function(t,e,n,o){return this.FStyle.States.Contain(oh.Pasting)&&(t.FActiveDomain.BeginNo>=0?this.FStyle.WillStyleNo=t.FItems[t.FActiveDomain.BeginNo].GetTextStyleNo():this.FStyle.WillStyleNo=this.FStyle.GetDefaultStyleNo()),f()(F()(i.prototype),"DoSectionInsertTextBefor",this).call(this,t,e,n,o)}},{key:"InsertEmrTraceText",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=this.ActiveSectionTopLevelData();if(!o.DoInsertTextBefor(o.SelectInfo.StartItemNo,o.SelectInfo.StartItemOffset,t))return!1;this.FStyle.States.Contain(oh.Pasting)&&(o.CurStyleNo=this.FStyle.WillStyleNo);for(var s,r=Yl.ReplaceUnPreChar(t).split(Yl.sLineBreak),a=!1,l=0;l<r.length;l++){if(s=r[l],a||""!==s){var h=new rc(this.hcl,s);if(this.CurStyleNo<oo.Null)h.StyleNo=this.FStyle.GetDefaultStyleNo();else{h.StyleNo=this.CurStyleNo;var c=o.GetActiveItem();e&&c.Active&&c.StyleNo>oo.Null&&c.CanInputFree()&&c.TraceStyles.value===jh.Add&&""===c.GetValue(Yh.TraceAdd)&&(h.SetValue(Yh.Index,c.Index),h.EditProtect=c.EditProtect,h.DeleteAllow=c.DeleteAllow,h.CopyProtect=c.CopyProtect)}h.ParaFirst=a,h.ParaNo=this.CurParaNo,h.AllocValue=!0,e?h.TraceStyles.value=jh.Add:(h.TraceStyles.value=jh.Del,null!==n&&n.TraceStyles.has(jh.Add)&&(h.TraceStyles.add(jh.Add),h.SetValue(Yh.TraceAdd,n.GetValue(Yh.TraceAdd)))),""!==i&&h.SetValue(Yh.TraceLink,i),this.InsertItem(h)}a=!0}return!0}},{key:"MakeSelectTraceIf",value:function(){var t=this.ActiveSectionTopLevelData();if(!(t.SelectInfo.StartItemNo<0)&&t.SelectExists()){var e=t.GetActiveItem();if(e&&e.isClass(hs))return;this.UndoGroupBegin();try{var i=t.GetSelectText();this.DeleteSelected(),this.InsertEmrTraceText(i,!1)}finally{this.UndoGroupEnd()}}}},{key:"CanNotEdit",value:function(){var t=!this.ActiveSectionTopLevelData().CanEdit();return t&&null!=this.OnCanNotEdit&&this.OnCanNotEdit(this),t}},{key:"DeItemIndexMatch",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return t.StyleNo>oo.Null||t.StyleNo===oo.Image||t.StyleNo===oo.Domain&&i||t.StyleNo===oo.Table||t.StyleNo===oo.CheckBox||t.StyleNo===oo.Edit||t.StyleNo===oo.Combobox||t.StyleNo===oo.DateTimePicker||t.StyleNo===oo.Button||t.StyleNo===oo.RadioGroup||t.StyleNo===oo.BarCode||t.StyleNo===oo.QRCode||t.StyleNo===oo.FloatBarCode||t.StyleNo===oo.FloatQRCode||t.StyleNo===oo.FloatImage?t.GetValue(Yh.Index)==e:void 0}},{key:"GetValue",value:function(t){return Yl.HCGetProperty(this.FPropertys,t)}},{key:"SetValue",value:function(t,e){e=e.toString(),Yl.HCSetProperty(this.FPropertys,t,e)}},{key:"DoSectionCreateStyleItem",value:function(t,e){return Wu.CreateEmrStyleItem(this.hcl,t,e)}},{key:"DoSectionCaretItemChanged",value:function(t,e,n){var o,s="",r=this.GetTopLevelItem();if(null!==r){Yl.PROCSERIES&&this.FProcCount>0&&e===this.ActiveSection.Page&&(this.CheckCaretProcInfo(),this.FCaretProcInfo.EndNo>0&&(s=(o=this.ActiveSection.ActiveData.Items[this.FCaretProcInfo.BeginNo]).GetValue(Yh.Name),e.SelectInfo.StartItemNo===this.FCaretProcInfo.BeginNo&&(s+="("+o.GetValue(Yh.Index)+")")));var a=this.ActiveSectionTopLevelData();a.ActiveDomain.EndNo>0&&(o=a.Items[a.ActiveDomain.BeginNo],(Yl.PROCSERIES&&!o.IsProc||!Yl.PROCSERIES)&&(s=""!==s?s+">"+o.GetValue(Yh.Name)+"("+o.GetValue(Yh.Index)+")":o.GetValue(Yh.Name)+"("+o.GetValue(Yh.Index)+")")),r.StyleNo>oo.Null?0!==r.TraceStyles.value?s=s+"-"+r.GetHint():r.IsElement&&(s=""!=s?s+" > "+r.GetValue(Yh.Name)+"("+r.GetValue(Yh.Index)+")":r.GetValue(Yh.Name)+"("+r.GetValue(Yh.Index)+")"):r.StyleNo===oo.Edit||r.StyleNo===oo.Combobox||r.StyleNo===oo.DateTimePicker?s=""!=s?s+" > "+r.GetValue(Yh.Name)+"("+r.GetValue(Yh.Index)+")":r.GetValue(Yh.Name)+"("+r.GetValue(Yh.Index)+")":r.StyleNo===oo.Image&&(s=""!=s?s+" > "+r.GetValue(Yh.Name)+"("+r[Yh.Index]+")":r.GetValue(Yh.Name)+"("+r[Yh.Index]+")")}this.HScrollBar.Statuses[1].text=s,f()(F()(i.prototype),"DoSectionCaretItemChanged",this).call(this,t,e,n)}},{key:"SectionDataItemChangeScript",value:function(t,e,i,n,o){if(this.hcl.hc.USESCRIPT)for(var s=e;;){var r=Yl.HCGetProperty(s.Scripts,Yl.JAVASCRIPT);if(""!==r){var a=e.Items[i];if(o===rh.ContentChange){var l=new Zu;l.EmrView=this,l.Section=t,l.Data=e,l.ScriptData=s,l.Item=a,l.ItemNo=i,l.DrawItemNo=s.Items[i].FirstDItemNo,l.ChangeAction=o;try{new Function("scriptObj, globalObj",l.GetEnvironment()+r)(l,this.GlobalScriptObj)}catch(t){this.hcl.errorLog("HC执行外部脚本错误SectionDataDomainChangeScript:"+t.message)}}}if(null===(s=s.ParentData))break}}},{key:"SectionDataDomainChangeScript",value:function(t,e,i,n,o){if(this.hcl.hc.USESCRIPT)for(var s=e;;){var r=Yl.HCGetProperty(s.Scripts,Yl.JAVASCRIPT);if(""!==r){var a=e.Items[n];if(o===rh.ContentChange){var l=new qu;l.EmrView=this,l.Section=t,l.Data=e,l.ScriptData=s,n<0?(l.Item=null,l.ItemNo=-1,l.DrawItemNo=-1):(l.Item=a,l.ItemNo=n,l.DrawItemNo=s.Items[n].FirstDItemNo),l.DomainItemNo=i,l.ChangeAction=o;try{new Function("scriptObj, globalObj",l.GetEnvironment()+r)(l,this.GlobalScriptObj)}catch(t){this.hcl.errorLog("HC执行外部脚本错误SectionDataDomainChangeScript:"+t.message)}}}if(null===(s=s.ParentData))break}}},{key:"DoSectionInsertItem",value:function(t,e,n){var o=this;if(!this.Style.States.Contain(oh.Clearing)&&(e!==t.Page||this.MergeFile||this.CheckEditProcInfo(),!this.Style.States.Contain(oh.MoveItem))){if(n.isClass(cs)&&""===n.Index&&null!=n.SetValue&&n.SetValue(Yh.Index,L.crc32(this.hcl.system.Timestamp.toString()).toString(16)),n.StyleNo===oo.RadioGroup?n.OnScript_SetItemChecked=function(t,e,i){if(o.hcl.hc.USESCRIPT){var n=Yl.HCGetProperty(t.Scripts,Yl.JAVASCRIPT);if(""!==n){var s=new ju;s.EmrView=o,s.Section=o.ActiveSection,s.Data=t.OwnerData,s.Item=t,s.ItemNo=t.OwnerData.GetActiveItemNo(),s.DrawItemNo=t.OwnerData.GetActiveDrawItemNo(),s.ItemIndex=e;try{new Function("scriptObj, globalObj",s.GetEnvironment()+n)(s,o.GlobalScriptObj)}catch(t){o.hcl.errorLog("HC执行外部脚本错误OnScript_SetItemChecked:"+t.message)}}}}:n.StyleNo===oo.Table?(n.OnScript_SelectCellChange=function(t,e,i,n,s){if(o.hcl.hc.USESCRIPT){var r=Yl.HCGetProperty(t.Scripts,Yl.JAVASCRIPT);if(""!==r){var a=new Yu;a.EmrView=o,a.Section=o.ActiveSection,a.Data=t.OwnerData,a.Item=t,a.ItemNo=t.OwnerData.GetActiveItemNo(),a.DrawItemNo=t.OwnerData.GetActiveDrawItemNo(),a.OrgRow=e,a.OrgCol=i,a.DestRow=n,a.DestCol=s;try{new Function("scriptObj, globalObj",a.GetEnvironment()+r)(a,o.GlobalScriptObj)}catch(t){o.hcl.errorLog("HC执行外部脚本错误OnScript_SelectCellChange:"+t.message)}}}},n.OnScript_CellItemChange=function(t,e,i,n,s,r,a){if(o.hcl.hc.USESCRIPT){var l=Yl.HCGetProperty(t.Scripts,Yl.JAVASCRIPT);if(""!==l){var h=new Zu;h.EmrView=o,h.Section=o.ActiveSection,h.Data=n,h.Table=t,h.Row=e,h.Col=i,h.ItemNo=s,h.Offset=r,h.DrawItemNo=n.Items[s].FirstDItemNo,h.ChangeAction=a;try{new Function("scriptObj, globalObj",h.GetEnvironment()+l)(h,o.GlobalScriptObj)}catch(t){o.hcl.errorLog("HC执行外部脚本错误OnScript_CellItemChange:"+t.message)}}}}):n.StyleNo===oo.CheckBox?n.OnScript_CheckChanged=function(t){if(o.hcl.hc.USESCRIPT){var e=Yl.HCGetProperty(t.Scripts,Yl.JAVASCRIPT);if(""!==e){var i=new Qu;i.EmrView=o,i.Section=o.ActiveSection,i.Data=t.OwnerData,i.Item=t,i.ItemNo=t.OwnerData.GetActiveItemNo(),i.DrawItemNo=t.OwnerData.GetActiveDrawItemNo();try{new Function("scriptObj, globalObj",i.GetEnvironment()+e)(i,o.GlobalScriptObj)}catch(t){o.hcl.errorLog("HC执行外部脚本错误OnScript_CheckChanged:"+t.message)}}}}:n.StyleNo===oo.Button&&(n.OnScript_Click=function(t){if(o.hcl.hc.USESCRIPT){var e=Yl.HCGetProperty(t.Scripts,Yl.JAVASCRIPT);if(""!==e){var i=new Xu;i.EmrView=o,i.Section=o.ActiveSection,i.Data=t.OwnerData,i.Item=t,i.ItemNo=t.OwnerData.GetActiveItemNo(),i.DrawItemNo=t.OwnerData.GetActiveDrawItemNo();try{new Function("scriptObj, globalObj",i.GetEnvironment()+e)(i,o.GlobalScriptObj)}catch(t){o.hcl.errorLog("HC执行外部脚本错误TButtonClickScript:"+t.message)}}}}),n.StyleNo>oo.Null){if(!this.FTrace||this.Style.States.UndoRedo()||this.Style.States.Contain(oh.InsertBreakItem)||this.Style.States.Contain(oh.Loading)||e.Loading||(this.FTraceOption===of?n.TraceStyles.add(jh.Del):n.TraceStyles.has(jh.Del)||this.FTraceOption===nf||(n.TraceStyles.value=jh.Add)),0!==n.TraceStyles.value&&(this.FTraceCount++,n.TraceStyles.has(jh.Del)?(this.FTraceCountDel++,n.Visible=!this.FHideTrace):n.Visible=!0,this.FTraceInfoAnnotate&&!this.FHideTrace&&this.AnnotatePre.InsertDataAnnotate(null)),this.Style.States.UndoRedo())return;n.TraceStyles.has(jh.Del)||this.Style.States.Contain(oh.InsertBreakItem)||this.DoSyncDeItem(t,e,n)}else if(n.StyleNo===oo.Domain)Yl.PROCSERIES&&n.IsProcBegin&&this.FProcCount++,n.MarkType!==ch.End||this.Style.States.UndoRedo()||this.DoSyncDeItem(t,e,n);else if(n.StyleNo!==oo.Line){if(this.Style.States.UndoRedo())return;this.DoSyncDeItem(t,e,n)}this.MergeFile?this.DoMergeFileInsertItem(t,e,n):f()(F()(i.prototype),"DoSectionInsertItem",this).call(this,t,e,n)}}},{key:"DoSectionRemoveItem",value:function(t,e,n){var o=this;e!==t.Page||this.FStyle.States.Contain(oh.Clearing)||this.MergeFile||this.CheckEditProcInfo(),n.StyleNo>oo.Null?0!==n.TraceStyles.value&&this.FTraceCount>0&&(this.FTraceCount--,n.TraceStyles.has(jh.Del)&&this.FTraceCountDel--,this.FTraceInfoAnnotate&&this.AnnotatePre.RemoveDataAnnotate(null)):n.StyleNo===oo.Domain?Yl.PROCSERIES&&n.IsProcBegin&&this.FProcCount--:n.StyleNo===oo.Table&&this.TraverseTableTraceItem(n,(function(t,e){o.FTraceCount>0&&(o.FTraceCount--,e.TraceStyles.has(jh.Del)&&o.FTraceCountDel--,o.FTraceInfoAnnotate&&o.AnnotatePre.RemoveDataAnnotate(null))})),f()(F()(i.prototype),"DoSectionRemoveItem",this).call(this,t,e,n)}},{key:"DoSectionSaveItem",value:function(t,e,n){var o=f()(F()(i.prototype),"DoSectionSaveItem",this).call(this,t,e,n);return o&&!this.hcl.emrCommon.G_SaveTrace&&e.Items[n].StyleNo>oo.Null&&e.Items[n].TraceStyles.has(jh.Del)&&(o=!1),o&&this.FTraceOption!==of&&this.Style.States.Contain(oh.Copying)&&(e.Items[n].StyleNo>oo.Null?o=!e.Items[n].TraceStyles.has(jh.Del)&&!e.Items[n].CopyProtect:e.Items[n].StyleNo===oo.Image&&(o=!e.Items[n].CopyProtect)),this.hcl.hc.USESAVEITEMEVENT&&!this.PrintSave&&this.Style.States.Contain(oh.Saving)&&o&&null!=this.OnSaveItem&&this.OnSaveItem(t,e,e.Items[n]),o}},{key:"DoSectionPaintDomainRegion",value:function(t,e,i){return e.Items[i].GetValue(bc.SubType)!=Bc.Proc}},{key:"DoSectionMatchTextStyleNoAt",value:function(t,e,n){return t.Items[e].StyleNo===oo.Domain&&(n===Yl.OffsetAfter&&t.Items[e].BeginMark()||n===Yl.OffsetBefor&&t.Items[e].EndMark())?t.Items[e].TextStyleNo:f()(F()(i.prototype),"DoSectionMatchTextStyleNoAt",this).call(this,t,e,n)}},{key:"DoSectionItemMouseDown",value:function(t,e,n,o,s){if(f()(F()(i.prototype),"DoSectionItemMouseDown",this).call(this,t,e,n,o,s),!t.SelectExists()){var r=e.Items[n];r.StyleNo>oo.Null&&e.SelectInfo.StartRestrain&&r.Length>0&&(r.Active=!1)}}},{key:"FormModeCanEditDataItem",value:function(t,e){if(!this.FStyle.States.Contain(oh.UserInteraction))return!0;if(t.isClass(Jl)){var i=t.ParentData.GetActiveItem(),n=i.GetRowColByCellData(t);if(n.col>=0){var o=i.GetColumn(n.col);if(o)switch(o.inputStyle){case Tn.Edit:case Tn.Combobox:case Tn.DateTime:case Tn.CheckBox:case Tn.Number:return!0}}}if(e&&e.Active){if(e.StyleNo>oo.Null)return e.IsElement;if(e.StyleNo===oo.Edit||e.StyleNo===oo.Combobox||e.StyleNo===oo.Table||e.StyleNo===oo.DateTimePicker)return!0}return!1}},{key:"DoSectionCanEditDataItem",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.FIgnoreAcceptAction)return!0;if(Yl.PROCSERIES&&this.CanEditCheckInEditProc&&this.FEditProcIndex!==this.FCaretProcInfo.Index)return this.DoSectionCanNotEditNotify("不可编辑：光标处病程("+this.FCaretProcInfo.Index+")不允许编辑！"),!1;var o=f()(F()(i.prototype),"DoSectionCanEditDataItem",this).call(this,t,e,n);if(o){var s=t.Items.indexOf(e);if(s<0&&t.isClass(Xc)&&(s=t.FloatItems.indexOf(e))>=0)return!this.FormMode;if(e.StyleNo===oo.Table&&e.EditProtect)return!1;if(e.StyleNo===oo.Domain&&(e.ReadOnly||e.EditProtect)){if(e.BeginMark()&&t.SelectInfo.StartItemOffset===Yl.OffsetAfter||e.EndMark()&&t.SelectInfo.StartItemOffset===Yl.OffsetBefor)return this.DoSectionCanNotEditNotify("不可编辑：光标处数据组不允许编辑！"),!1}else{var r=t.GetItemBelongDomain(s);if(r>=0&&(t.Items[r].ReadOnly||t.Items[r].EditProtect)){var a=t.GetDomainAnother(r);if(s>r&&s<a)return this.DoSectionCanNotEditNotify("不可编辑：光标处数据组不允许编辑！"),!1}}if(o&&this.FormMode&&!this.Style.States.Contain(oh.Loading))if(t.ActiveDomain.BeginNo>=0){if(!t.Items[t.ActiveDomain.BeginNo].IsProc)return!0;o=this.FormModeCanEditDataItem(t,e)}else o=this.FormModeCanEditDataItem(t,e)}return o}},{key:"ActionDeleteTextKeepPara_",value:function(t,e,i,n){switch(n){case rh.BackDeleteText:case rh.InsertText:case rh.InsertItem:if(t.Items[e].StyleNo>oo.Null&&0===i&&t.Items[e].EditProtect&&t.Items[e].ParaFirst)return!0;break;case rh.DeleteText:if(i===t.GetItemOffsetAfter(e)&&e<t.Items.count-1&&t.Items[e+1].StyleNo>oo.Null&&t.Items[e+1].EditProtect&&t.Items[e+1].ParaFirst)return!0}return!1}},{key:"DoSectionAcceptActionBefor",value:function(t,e,i,n,o){if(this.FIgnoreAcceptAction)return!1;switch(o){case rh.BackDeleteText:if(e.Items[i].StyleNo>oo.Null){var s=e.Items[i];if(s.IsElement&&n>0){if(!s.AllocValue)return e.SelectItem(i),this.FTrace&&(this.Style.TraceAction=!1),!0;if(1===s.Length)if(this.FTrace);else{var r=s.GetDefaultText();if(""!==r){this.ResetIteming=!0;try{s.Reset({Text:r}),this.SetActiveItemText(r)}finally{this.ResetIteming=!1}return e.SelectItem(i),!0}}else if(s.AllocOnly&&s.DeleteAllow)return e.SelectItem(i),this.FTrace&&(this.Style.TraceAction=!1),!0}}break;case rh.DeleteText:if(e.Items[i].StyleNo>oo.Null){var a=e.Items[i];if(a.IsElement&&n<a.Length){if(!a.AllocValue)return e.SelectItem(i),this.FTrace&&(this.Style.TraceAction=!1),!0;if(1===a.Length)if(this.FTrace);else{var l=a.GetDefaultText();if(""!=l){this.ResetIteming=!0;try{a.Reset({Text:l}),this.SetActiveItemText(l)}finally{this.ResetIteming=!1}return e.SelectItem(i),!0}}else if(a.AllocOnly&&a.DeleteAllow)return e.SelectItem(i),this.FTrace&&(this.Style.TraceAction=!1),!0}}break;case rh.DeleteItem:if(e.Items[i].StyleNo===oo.Domain&&!e.Items[i].IsProc)if(e.Items[i].Empty)return e.SelectDomain(i),!0}return!1}},{key:"DoSectionAcceptAction",value:function(t,e,n,o,s){if(this.FIgnoreAcceptAction)return!0;if(Yl.PROCSERIES){if(s===rh.DeleteSelected&&e===this.ActiveSection.Page&&this.FEditProcInfo.EndNo>0&&!(e.SelectInfo.StartItemNo>this.FEditProcInfo.BeginNo&&e.SelectInfo.EndItemNo<this.FEditProcInfo.EndNo))return!1;this.FCaretProcInfo.EndNo>0&&(this.Sections[this.FCaretProcInfo.SectionIndex].Page.Items[this.FCaretProcInfo.BeginNo].Changed=!0)}var r=f()(F()(i.prototype),"DoSectionAcceptAction",this).call(this,t,e,n,o,s);if(r){var a=e.Items[n];switch(s){case rh.BackDeleteText:case rh.DeleteText:case rh.InsertText:if(this.EditProtectKeepPara&&this.ActionDeleteTextKeepPara_(e,n,o,s))return!1;if(a.StyleNo>oo.Null){if(!a.AllocValue&&""!==a.GetValue(Yh.Prompt)&&0!==o&&o!==a.Length)return!1;a.Changed=!0}break;case rh.SetItemText:a.StyleNo>oo.Null&&(a.AllocValue=!this.ResetIteming,a.Changed=!0);break;case rh.ReturnItem:a.StyleNo>oo.Null&&o>0&&o<a.Length&&a.IsElement&&(r=!1);break;case rh.InsertItem:if(this.EditProtectKeepPara&&this.ActionDeleteTextKeepPara_(e,n,o,s))return!1;if(a.StyleNo>oo.Null&&a.IsElement&&!this.FTrace&&o>0&&o<a.Length)return!1;break;case rh.DeleteItem:(a.StyleNo>oo.Null||a.StyleNo===oo.Domain||a.StyleNo===oo.Table||a.StyleNo===oo.CheckBox||a.StyleNo===oo.Edit||a.StyleNo===oo.Combobox||a.StyleNo===oo.DateTimePicker||a.StyleNo===oo.RadioGroup||a.StyleNo===oo.FloatBarCode||a.StyleNo===oo.Image||a.StyleNo===oo.BarCode||a.StyleNo===oo.QRCode||a.StyleNo===oo.FloatBarCode||a.StyleNo===oo.FloatQRCode||a.StyleNo===oo.FloatImage)&&(r=a.DeleteAllow);break;case rh.DeleteSelected:e.SelectInfo.StartItemNo===e.SelectInfo.EndItemNo&&a.StyleNo>oo.Null&&(a.IsSelectComplate&&a.DeleteAllow?(a.Changed=!0,r=!0):(a.EditProtect||a.AllocOnly)&&(r=!1))}}return r}},{key:"DoSectionDataChange",value:function(t){f()(F()(i.prototype),"DoSectionDataChange",this).call(this,t)}},{key:"DoSectionDataItemChange",value:function(t,e,n,o,s){return this.SectionDataItemChangeScript(t,e,n,o,s),f()(F()(i.prototype),"DoSectionDataItemChange",this).call(this,t,e,n,o,s)}},{key:"DoSectionDataDomainChange",value:function(t,e,n,o,s){return this.SectionDataDomainChangeScript(t,e,n,o,s),f()(F()(i.prototype),"DoSectionDataDomainChange",this).call(this,t,e,n,o,s)}},{key:"Clear",value:function(){null!==this.OnClear&&this.OnClear(),Yl.PROCSERIES&&(this.FCaretProcInfo.Clear(),this.FEditProcInfo.Clear(),this.FEditProcIndex=""),this.Style.ClearResWaite(),this.FPropertys.clear(),f()(F()(i.prototype),"Clear",this).call(this)}},{key:"doKeyDown_",value:function(t){if(this.FTrace)if(Yl.IsKeyDownEdit(t.keyCode)){if(this.CanNotEdit())return;var e=-1,n=-1,o="",s="",r="",a="",l="",h=oo.Null,c=oo.Null,u=new q,d=this.ActiveSectionTopLevelData();if(d.SelectExists()){if(d.FSelectInfo.StartItemNo>=0&&d.FSelectInfo.EndItemNo===d.FSelectInfo.StartItemNo+1&&d.FItems[d.FSelectInfo.StartItemNo].StyleNo===oo.Domain&&d.FItems[d.FSelectInfo.StartItemNo].Empty)return void f()(F()(i.prototype),"doKeyDown_",this).call(this,t);if(d.SelectedHasRectItem())return;var m=new ht;this.BeginUpdate();try{try{t.keyCode===Ee&&(e=d.SelectInfo.StartItemNo,n=d.SelectInfo.StartItemOffset),this.FTraceOption=of,this.SaveSelectToStream(m),this.Style.TraceAction=!0,f()(F()(i.prototype),"doKeyDown_",this).call(this,t),this.Style.TraceAction&&(m.position=0,this.InsertLiteStream(m)),t.keyCode===Ee&&d.ItemSetCaretRequest(e,n)}finally{this.FTraceOption=ef,m=null}}finally{this.EndUpdate()}return}if(d.SelectInfo.StartItemNo<0)return;if(d.Items[d.SelectInfo.StartItemNo].StyleNo<oo.Null){if(d.SelectInfo.StartItemOffset===Yl.OffsetBefor)if(t.keyCode===Ee){if(0===d.SelectInfo.StartItemNo)return;d.Items[d.SelectInfo.StartItemNo].ParaFirst?f()(F()(i.prototype),"doKeyDown_",this).call(this,t):(d.SelectInfo.StartItemNo=d.SelectInfo.StartItemNo-1,d.SelectInfo.StartItemOffset=d.Items[d.SelectInfo.StartItemNo].Length,this.doKeyDown_(t))}else t.keyCode,f()(F()(i.prototype),"doKeyDown_",this).call(this,t);else if(d.SelectInfo.StartItemOffset===Yl.OffsetAfter)if(t.keyCode===Ee)f()(F()(i.prototype),"doKeyDown_",this).call(this,t);else if(t.keyCode===Xe){if(d.SelectInfo.StartItemNo===d.Items.count-1)return;d.Items[d.SelectInfo.StartItemNo].ParaFirst?f()(F()(i.prototype),"doKeyDown_",this).call(this,t):(d.SelectInfo.StartItemNo=d.SelectInfo.StartItemNo+1,d.SelectInfo.StartItemOffset=0,this.doKeyDown_(t))}else f()(F()(i.prototype),"doKeyDown_",this).call(this,t);else f()(F()(i.prototype),"doKeyDown_",this).call(this,t);return}var S=null,p=!0;if(t.keyCode===Ee){if(0===d.SelectInfo.StartItemNo&&0===d.SelectInfo.StartItemOffset)return;if(0===d.SelectInfo.StartItemOffset)return void(d.Items[d.SelectInfo.StartItemNo].ParaFirst?f()(F()(i.prototype),"doKeyDown_",this).call(this,t):(d.SelectInfo.StartItemNo=d.SelectInfo.StartItemNo-1,d.SelectInfo.StartItemOffset=d.Items[d.SelectInfo.StartItemNo].Length,this.doKeyDown_(t)));if(d.Items[d.SelectInfo.StartItemNo].StyleNo>oo.Null)if((S=d.Items[d.SelectInfo.StartItemNo]).Visible){if(!S.AcceptAction(d.SelectInfo.StartItemOffset,!1,rh.BackDeleteText))return void f()(F()(i.prototype),"doKeyDown_",this).call(this,t);if(o=S.SubString(d.SelectInfo.StartItemOffset,1),h=S.StyleNo,c=S.ParaNo,u.value=S.TraceStyles.value,s=S.GetValue(Yh.TraceAdd),r=S.GetValue(Yh.TraceAddLevel),a=S.GetValue(Yh.TraceDel),l=S.GetValue(Yh.TraceDelLevel),!S.DeleteAllow&&1===S.Length){p=!1;var y=S.GetDefaultText();if(""!==y){this.ResetIteming=!0;try{S.Reset({Text:y}),this.SetActiveItemText(y)}finally{this.ResetIteming=!1}}}}else if(d.SelectInfo.StartItemOffset>0)return d.SelectInfo.StartItemOffset=0,void this.doKeyDown_(t)}else if(t.keyCode===Xe){if(d.SelectInfo.StartItemNo===d.Items.count-1&&d.SelectInfo.StartItemOffset===d.Items[d.Items.count-1].Length)return;if(d.SelectInfo.StartItemOffset===d.Items[d.SelectInfo.StartItemNo].Length)return void(d.Items[d.SelectInfo.StartItemNo+1].ParaFirst?f()(F()(i.prototype),"doKeyDown_",this).call(this,t):(d.SelectInfo.StartItemNo=d.SelectInfo.StartItemNo+1,d.SelectInfo.StartItemOffset=0,this.doKeyDown_(t)));if(d.Items[d.SelectInfo.StartItemNo].StyleNo>oo.Null&&(S=d.Items[d.SelectInfo.StartItemNo]).Visible){if(!S.AcceptAction(d.SelectInfo.StartItemOffset,!1,rh.DeleteText))return void f()(F()(i.prototype),"doKeyDown_",this).call(this,t);if(o=S.SubString(d.SelectInfo.StartItemOffset+1,1),h=S.StyleNo,c=S.ParaNo,u.value=S.TraceStyles.value,s=S.GetValue(Yh.TraceAdd),r=S.GetValue(Yh.TraceAddLevel),a=S.GetValue(Yh.TraceDel),l=S.GetValue(Yh.TraceDelLevel),!S.DeleteAllow&&1===S.Length){p=!1;var v=S.GetDefaultText();if(""!==v){this.ResetIteming=!0;try{S.Reset({Text:v}),this.SetActiveItemText(v)}finally{this.ResetIteming=!1}}}}}this.BeginUpdate();try{if(p&&(this.Style.TraceAction=!0,f()(F()(i.prototype),"doKeyDown_",this).call(this,t),!this.Style.TraceAction))return;if(""!==o){if(u.has(jh.Add)&&""===s)return;var I=new rc(this.hcl);I.Text=o,I.StyleNo=h,I.ParaNo=c,I.Visible=!this.FHideTrace,I.TraceStyles.value=u.value,I.SetValue(Yh.TraceAddLevel,r),I.SetValue(Yh.TraceAdd,s),u.has(jh.Del)&&""===a?(I.TraceStyles.remove(jh.Del),this.FTraceOption=nf):(I.TraceStyles.add(jh.Del),I.SetValue(Yh.TraceDelLevel,l),I.SetValue(Yh.TraceDel,a)),S=d.Items[d.SelectInfo.StartItemNo],0===d.SelectInfo.StartItemOffset?I.CanConcatItems(S)?(S.Text=I.Text+S.Text,t.keyCode===Xe&&(d.SelectInfo.StartItemOffset=d.SelectInfo.StartItemOffset+1),this.ActiveSection.ReFormatActiveItem()):(d.IsEmptyLine(d.SelectInfo.StartItemNo)?I.ParaFirst=!1:(I.ParaFirst=S.ParaFirst,S.ParaFirst=!1),this.InsertItem(I),t.keyCode===Ee&&(d.SelectInfo.StartItemOffset=d.SelectInfo.StartItemOffset-1)):d.SelectInfo.StartItemOffset===S.Length?S.CanConcatItems(I)?(S.Text=S.Text+I.Text,d.ItemChangeBy(d.SelectInfo.StartItemNo,0,rh.ContentChange),t.keyCode===Xe&&(d.SelectInfo.StartItemOffset=d.SelectInfo.StartItemOffset+1),this.ActiveSection.ReFormatActiveItem()):(this.InsertItem(I),t.keyCode===Ee&&(d.SelectInfo.StartItemOffset=d.SelectInfo.StartItemOffset-1)):(this.InsertItem(I),t.keyCode===Ee?I.CanConcatItems(S)?d.SelectInfo.StartItemOffset=0:d.SelectInfo.StartItemOffset=d.SelectInfo.StartItemOffset-1:t.keyCode===Xe&&I.CanConcatItems(S)&&(d.SelectInfo.StartItemOffset=S.Length))}}finally{this.EndUpdate()}}else f()(F()(i.prototype),"doKeyDown_",this).call(this,t);else f()(F()(i.prototype),"doKeyDown_",this).call(this,t)}},{key:"doKeyPress_",value:function(t){if(!this.ActiveItemSelectComplateInput(t.key)&&Yl.IsKeyPressWant(t)){if(this.CanNotEdit())return;if(this.FTrace){var e=this.ActiveSectionTopLevelData().GetActiveItem();return e&&e.isClass(hs)?void f()(F()(i.prototype),"doKeyPress_",this).call(this,t):(this.MakeSelectTraceIf(),void this.InsertEmrTraceText(t.key))}f()(F()(i.prototype),"doKeyPress_",this).call(this,t)}}},{key:"imeInput",value:function(t){this.ActiveItemSelectComplateInput(t)||f()(F()(i.prototype),"imeInput",this).call(this,t)}},{key:"ActiveItemSelectComplateInput",value:function(t){if(""!=t){var e=this.ActiveSectionTopLevelData();if(e.SelectExists(!1)&&e.SelectInSameItem()){var i=e.Items[e.SelectInfo.StartItemNo];if(i.StyleNo>oo.Null&&!i.EditProtect&&!i.AllocOnly){if(i.TraceStyles.has(jh.Del)&&""!==i.GetValue(Yh.TraceDel))return this.hcl.warnLog("痕迹内容不支持选中一部分操作！",!1),!0;if(i.TraceStyles.has(jh.Add)&&""!==i.GetValue(Yh.TraceAdd)){if(i.CanInputFree())return i.IsSelectComplate?this.SetActiveItemText(t):this.hcl.warnLog("痕迹内容不支持选中一部分操作！",!1),!0}else if(i.IsSelectComplate)return this.SetActiveItemText(t),!0}}}return!1}},{key:"SetActiveAnnotateByID",value:function(t){var e=this,i=null;return this.TraverseData(this.ActiveSection.Page,(function(n,o,s,r,a){if(n.Items[o].StyleNo===oo.Annotate&&n.Items[o].ID===t)return i=n.Items[o],e.Style.UpdateInfoReScroll(),n.SetActiveAnnotateByID(t),e.CheckUpdateInfo(),!0}),!0),i}},{key:"SetActiveItemText",value:function(t){if(""!==t){if(this.FTrace){var e=this.ActiveSectionTopLevelData(),n=e.GetActiveItem();if(n.AllocValue&&(0===n.TraceStyles.value||""!==n.GetTraceHint())){var o=e.SelectInfo.StartItemNo,s=e.SelectInfo.StartItemOffset;e.SelectInfo.StartItemOffset=e.GetItemOffsetAfter(o),this.InsertEmrTraceText(n.Text,!1,n.Index,n),e.SelectInfo.StartItemNo=o,e.SelectInfo.StartItemOffset=s,e.Items[o].Active=!0}n.TraceStyles.add(jh.Add),n.SetValue(Yh.TraceAdd,"")}f()(F()(i.prototype),"SetActiveItemText",this).call(this,t)}}},{key:"ClearActiveItemTrace",value:function(){var t=this.ActiveSectionTopLevelData().GetActiveItem();null!==t&&t.StyleNo>oo.Null&&(t.ClearTrace(),this.UpdateView())}},{key:"ClearItemTrace",value:function(t){var e=this.GetItemByIndex(t);null!==e&&e.StyleNo>oo.Null&&(e.ClearTrace(),this.UpdateView())}},{key:"DoSectionDomainDrawItemPaintBefor",value:function(t,e,n,o,s,r,a,l){f()(F()(i.prototype),"DoSectionDomainDrawItemPaintBefor",this).call(this,t,e,n,o,s,r,a,l),e.Items[n].OutOfRang&&(this.OutOfRangStyle.Style&lf.BK)===lf.BK&&(a.brush.color=this.OutOfRangStyle.BkColor,a.fillRect(s))}},{key:"DoSectionDomainDrawItemPaintAfter",value:function(t,e,n,o,s,r,a,l){f()(F()(i.prototype),"DoSectionDomainDrawItemPaintAfter",this).call(this,t,e,n,o,s,r,a,l),e.Items[n].OutOfRang&&(this.OutOfRangStyle.Style&lf.Wave)===lf.Wave&&(a.pen.width=1,a.pen.color=this.OutOfRangStyle.WvColor,a.pen.style=_t.Solid,Yl.HCDrawWave(a,r))}},{key:"DoInsertText",value:function(t){if(this.CanNotEdit())return!1;if(this.FTrace){var e=this.ActiveSectionTopLevelData().GetActiveItem();return e&&e.isClass(hs)?f()(F()(i.prototype),"DoInsertText",this).call(this,t):(this.MakeSelectTraceIf(),this.InsertEmrTraceText(t),!0)}return f()(F()(i.prototype),"DoInsertText",this).call(this,t)}},{key:"DoCopyRequest",value:function(t){var e=f()(F()(i.prototype),"DoCopyRequest",this).call(this,t);return e&&null!==this.OnCopyRequest&&(e=this.OnCopyRequest(t)),e}},{key:"DoPasteRequest",value:function(t,e,n){var o=this.ActiveSectionTopLevelData(),s=o.GetActiveItem();if(s.StyleNo>oo.Null&&s.IsElement&&t!==ru.UnicodeText&&!o.SelectStartItemBoundary())return!1;var r=f()(F()(i.prototype),"DoPasteRequest",this).call(this,t,e,n);return r&&null!==this.OnPasteRequest&&(r=this.OnPasteRequest(t,e,n)),r}},{key:"DoCopyAsStream",value:function(t){null!=this.OnCopyAsStream?this.OnCopyAsStream(t):f()(F()(i.prototype),"DoCopyAsStream",this).call(this,t)}},{key:"DoPasteFormatStream",value:function(t){return null!=this.OnPasteFromStream?this.OnPasteFromStream(t):f()(F()(i.prototype),"DoPasteFormatStream",this).call(this,t)}},{key:"DoSaveStreamBefor",value:function(t){t.writeByte(Wu.EmrViewVersion),""!=this.fileVersion?this.FPropertys.setValue("_vr",this.fileVersion):this.FPropertys.remove("_vr"),""!=this.copyRight?this.FPropertys.setValue("_cp",this.copyRight):this.FPropertys.remove("_cp"),this.FPropertys.hasKey("_cv")||this.FPropertys.setValue("_cv",this.customVersion),this.FPropertys.setValue("_cvl",this.customVersion);var e=Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator);Yl.HCSaveTextToStream(t,e),f()(F()(i.prototype),"DoSaveStreamBefor",this).call(this,t)}},{key:"DoLoadStreamAfter",value:function(t,e){f()(F()(i.prototype),"DoLoadStreamAfter",this).call(this,t,e),null!=this.OnLoadStreamAfter&&this.OnLoadStreamAfter()}},{key:"DoSaveXmlDocument",value:function(t){f()(F()(i.prototype),"DoSaveXmlDocument",this).call(this,t),this.FPropertys.count>0&&t.SetAttribute("property",Yl.GetPropertyString(this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator))}},{key:"DoLoadXmlDocument",value:function(t){f()(F()(i.prototype),"DoLoadXmlDocument",this).call(this,t),t.HasAttribute("property")&&Yl.SetPropertyString(t.GetAttribute("property"),this.FPropertys)}},{key:"DoLoadStreamBefor",value:function(t,e){var n=0;if(e>43&&(n=t.readByte()),n>0){var o=Yl.HCLoadTextFromStream(t,e);this.Style.States.Contain(oh.Loading)&&(e>64?Yl.SetPropertyString(o,this.FPropertys,Yl.RecordSeparator,Yl.UnitSeparator):Yl.SetPropertyString(o,this.FPropertys))}else this.Style.States.Contain(oh.Loading)&&this.FPropertys.clear();f()(F()(i.prototype),"DoLoadStreamBefor",this).call(this,t,e)}},{key:"DoSectionPaintPaperBefor",value:function(t,e,n,o,s){this.FPrintView&&(o.brush.color=this.FStyle.BackgroundColor,o.fillRect(n)),f()(F()(i.prototype),"DoSectionPaintPaperBefor",this).call(this,t,e,n,o,s)}},{key:"DoSectionPaintPageBefor",value:function(t,e,n,o,s){if(f()(F()(i.prototype),"DoSectionPaintPageBefor",this).call(this,t,e,n,o,s),Yl.PROCSERIES&&!s.Print)if(this.FEditProcInfo.EndNo>0){var r=this.FEditProcInfo.Data,a=r.DrawItems[r.Items[this.FEditProcInfo.BeginNo].FirstDItemNo].rect.leftTop;(a=this.GetFormatPointToViewCoord(a)).y>n.top&&(o.brush.color=this.FUnEditProcBKColor,o.fillRect(nt.Create(n.left,n.top,n.right,this.ZoomOut(a.y)))),this.FEditProcInfo.EndNo<r.Items.count-1&&(a=r.DrawItems[r.Items[this.FEditProcInfo.EndNo].FirstDItemNo].rect.rightBottom,(a=this.GetFormatPointToViewCoord(a)).y<n.bottom&&(o.brush.color=this.FUnEditProcBKColor,a.x=n.top+t.GetPageDataHeight(e),a.x<n.bottom?o.fillRect(nt.Create(n.left,this.ZoomOut(a.y),n.right,a.x)):o.fillRect(nt.Create(n.left,this.ZoomOut(a.y),n.right,n.bottom))))}else this.FProcCount>0&&(o.brush.color=this.FUnEditProcBKColor,o.fillRect(n))}},{key:"DoSectionDrawItemPaintBefor",value:function(t,e,n,o,s,r,a,l,h,c,u,d,m){if(!(m.Print||m.ReadOnly&&m.ReadOnlyViewPrint)){var S=e.Items[n],p=n<e.Items.count-1?e.Items[n+1]:null,y=n>0?e.Items[n-1]:null;if(Yl.PROCSERIES&&this.FShowProcSplit&&this.FProcCount>0&&e.isClass($c)&&S.StyleNo===oo.Domain&&S.IsProcBegin){d.pen.style=_t.DashDotDot,d.pen.color=Ft.Blue,d.beginPath();try{d.moveTo(a,s.top-1),d.lineTo(l,s.top-1)}finally{d.paintPath()}}if(S.StyleNo===oo.Domain){var v=this.UnAllocWarning&&S.Empty;if(v||S.OutOfRang){var I=v?this.UnAllocWarningStyle:this.OutOfRangStyle,g=!1;S.MarkType===ch.Beg?p&&!p.ParaFirst&&p.StyleNo===oo.Domain&&p.MarkType===ch.End?((I.Style&lf.BK)===lf.BK&&(d.brush.color=I.BkColor,d.fillBounds(r.left+S.TitleWidth,r.top,S.Width-S.TitleWidth+p.Width,r.height)),(I.Style&lf.Wave)===lf.Wave&&(d.pen.color=I.WvColor,d.pen.width=1,d.pen.style=_t.Solid,g=!0,Yl.HCDrawWaveBy(d,r.left+S.TitleWidth,r.bottom,r.right+p.Width))):((I.Style&lf.BK)===lf.BK&&(d.brush.color=I.BkColor,d.fillBounds(r.left+S.TitleWidth,r.top,S.Width-S.TitleWidth,r.height)),(I.Style&lf.Wave)===lf.Wave&&(g||(d.pen.color=I.WvColor,d.pen.width=1,d.pen.style=_t.Solid,g=!0),Yl.HCDrawWaveBy(d,r.left+S.TitleWidth,r.bottom,r.right))):!S.ParaFirst&&y&&y.StyleNo===oo.Domain&&y.MarkType===ch.Beg||((I.Style&lf.BK)===lf.BK&&(d.brush.color=I.BkColor,d.fillRect(r)),(I.Style&lf.Wave)===lf.Wave&&(g||(d.pen.color=I.WvColor,d.pen.width=1,d.pen.style=_t.Solid,g=!0),Yl.HCDrawWave(d,r)))}}if(S.StyleNo<oo.Null)f()(F()(i.prototype),"DoSectionDrawItemPaintBefor",this).call(this,t,e,n,o,s,r,a,l,h,c,u,d,m);else{if(!S.Selected())if(S.IsElement){var C=e.SelectInfo.StartItemNo===n&&e.SelectInfo.StartRestrain,w=S.OutOfRang&&(this.OutOfRangStyle.Style&lf.BK)===lf.BK;S.MouseIn||S.Active&&!C?d.brush.color=this.FDeHotColor:this.FDesignMode?w?d.brush.color=this.OutOfRangStyle.BkColor:S.AllocValue?d.brush.color=this.FDeDoneColor:d.brush.color=this.FDeUnDoneColor:w?d.brush.color=this.OutOfRangStyle.BkColor:this.UseDeChangedColor&&S.Changed?d.brush.color=this.FDeChangedColor:S.AllocValue?d.brush.color=this.FDeDoneColor:d.brush.color=this.FDeUnDoneColor,d.fillRect(s),f()(F()(i.prototype),"DoSectionDrawItemPaintBefor",this).call(this,t,e,n,o,s,r,a,l,h,c,u,d,m),((C=S.AllocMust&&!S.AllocValue)||p&&!p.ParaFirst&&p.StyleNo>oo.Null&&p.IsElement)&&(d.brush.color=C?this.Style.AllocMustColor:this.Style.BackgroundColor,d.fillRegion([{x:s.right,y:s.bottom-5},{x:s.right,y:s.bottom},{x:s.right-5,y:s.bottom}])),y&&!S.ParaFirst&&y.StyleNo>oo.Null&&y.IsElement&&(d.brush.color=this.Style.BackgroundColor,d.fillRegion([{x:s.left,y:s.bottom-5},{x:s.left,y:s.bottom},{x:s.left+5,y:s.bottom}]))}else(this.FDesignMode||S.MouseIn||S.Active)&&(S.EditProtect||S.CopyProtect)&&(d.brush.color=this.FStyle.EditProtectColor,d.fillRect(s));if(!this.FHideTrace&&0!=S.TraceStyles.value)if(null!=this.OnDrawTrace)this.OnDrawTrace(S,r,d);else{if(S.TraceStyles.has(jh.Del)){var A,D=this.Style.TextStyles[S.StyleNo].FontHeight;switch(this.Style.ParaStyles[S.ParaNo].AlignVert){case Gn.Top:A=s.top+Math.trunc(D/2);break;case Gn.Center:A=s.top+Math.trunc((s.bottom-s.top)/2);break;default:A=s.bottom-Math.trunc(D/2)}this.TraceDrawStyle.DelBrushStyle===Mt.Solid&&(d.brush.style=Mt.Solid,d.brush.color=this.TraceDrawStyle.DelBrushColor,d.fillRect(s)),this.TraceDrawStyle.DelPenStyle!==_t.Clear&&(d.pen.style=this.TraceDrawStyle.DelPenStyle,d.pen.color=this.TraceDrawStyle.DelPenColor,d.pen.width=this.TraceDrawStyle.DelPenWidth,d.drawLineDriect(s.left,A-1,s.right,A-1),d.drawLineDriect(s.left,A+2,s.right,A+2))}if(S.TraceStyles.has(jh.Add)){var P=this.Style.TextStyles[S.StyleNo].FontHeight,k=s.bottom;switch(this.Style.ParaStyles[S.ParaNo].AlignVert){case Gn.Top:k=s.top+P;break;case Gn.Center:k=s.top+Math.trunc((s.height+P)/2)}this.TraceDrawStyle.AddBrushStyle===Mt.Solid&&(d.brush.style=Mt.Solid,d.brush.color=this.TraceDrawStyle.AddBrushColor,d.fillRect(s)),this.TraceDrawStyle.AddPenStyle!==_t.Clear&&(d.pen.style=this.TraceDrawStyle.AddPenStyle,d.pen.color=this.TraceDrawStyle.AddPenColor,d.pen.width=this.TraceDrawStyle.AddPenWidth,d.drawLineDriect(s.left,k,s.right,k))}}}}}},{key:"DoSectionDrawItemPaintContent",value:function(t,e,i,n,o,s,r,a,l,h,c,u,f){if(!(f.Print||t.Items[e].StyleNo<oo.Null)){var d=t.Items[e];if(d.SyntaxCount()>0&&!d.IsSelectComplate)for(var m,S=t.DrawItems[i].CharOffs,p=t.DrawItems[i].CharOffsetEnd(),y=0,F=0,v=0,I=new nt,g=!1,C=0;C<d.Syntaxs.count;C++)if(!((y=d.Syntaxs[C].Offset)>p)&&!((F=y+d.Syntaxs[C].Length-1)<S)&&(g=!1,y<=S&&F>=p?(g=!0,I.left=o.left,I.right=o.right):y>=S?(g=!0,F<=p?(v=y-S,m=d.Syntaxs[C].Length,I.left=o.left+t.GetDrawItemOffsetWidth(i,v,u),I.right=o.left+t.GetDrawItemOffsetWidth(i,v+m,u)):(I.left=o.left+t.GetDrawItemOffsetWidth(i,y-S,u),I.right=o.right)):F<=p&&(g=!0,I.left=o.left,I.right=o.left+t.GetDrawItemOffsetWidth(i,F-S+1,u)),g))if(I.top=o.top,I.bottom=o.bottom,null!=this.OnSyntaxPaint)this.OnSyntaxPaint(t,e,s,d.Syntaxs[C],I,u);else{switch(d.Syntaxs[C].Problem){case ic:u.pen.color=this.SyntaxStyle.ContradictionColor;break;case nc:u.pen.color=this.SyntaxStyle.WrongColor}Yl.HCDrawWave(u,I)}}}},{key:"DoSectionDrawItemPaintAfter",value:function(t,e,n,o,s,r,a,l,h,c,u,d,m){var S=e.Items[n];if(S.StyleNo>oo.Null&&S.IsElement){if(m.Print){if(!this.PrintUnAlloc&&!S.AllocValue)return d.brush.color=Ft.White,void d.fillRect(s)}else if(!m.ReadOnly||!m.ReadOnlyViewPrint){if(S.MouseIn||this.DeItemMark){var p=!1;o===S.FirstDItemNo&&(d.pen.width=1,d.pen.style=_t.Solid,d.pen.color=e.Style.ItemMarkColor,d.beginPath(),p=!0,d.moveTo(r.left+3,r.top-1),d.lineTo(r.left,r.top-1),d.moveTo(r.left+3,r.top),d.lineTo(r.left,r.top),d.moveTo(r.left,r.top),d.lineTo(r.left,r.bottom),d.moveTo(r.left,r.bottom),d.lineTo(r.left+3,r.bottom)),e.GetItemLastDrawItemNo(n)===o&&(p||(d.pen.width=1,d.pen.style=_t.Solid,d.pen.color=e.Style.ItemMarkColor,d.beginPath(),p=!0),d.moveTo(r.right-3,r.top-1),d.lineTo(r.right,r.top-1),d.moveTo(r.right-3,r.top),d.lineTo(r.right-1,r.top),d.moveTo(r.right-1,r.top),d.lineTo(r.right-1,r.bottom),d.moveTo(r.right,r.bottom),d.lineTo(r.right-3,r.bottom)),p&&d.paintPath()}S.OutOfRang&&(this.OutOfRangStyle.Style&lf.Wave)===lf.Wave&&(d.pen.width=1,d.pen.color=this.OutOfRangStyle.WvColor,d.pen.style=_t.Solid,Yl.HCDrawWave(d,r))}}else if(m.Print&&!this.PrintUnAlloc&&S.StyleNo===oo.Domain&&S.Empty&&S.MarkType===ch.Beg&&!S.IsProc)return d.brush.color=Ft.White,void(S.BlankPrintHideTitle?d.fillRect(s):d.fillBounds(s.left+S.TitleWidth,s.top,s.width,s.height));if(!this.FHideTrace&&this.FTraceCount>0&&S.StyleNo>oo.Null&&0!==S.TraceStyles.value&&this.FTraceInfoAnnotate){var y=new du;y.Data=e,y.AnnotateItem=null,y.DrawRect.resetRect(r),y.Title=S.GetHint(),y.Text=e.GetDrawItemText(o),this.AnnotatePre.AddDrawAnnotate(y)}if(this.Secret){var v=e.Items[n];if(v.StyleNo>oo.Null&&""!==v.GetValue(Yh.Secret)){var I=rc.GetSecretRange(v.GetValue(Yh.Secret));if(I.low>0){I.hi<0&&(I.hi=v.Length);var g=e.DrawItems[o];if(I.low<=g.CharOffsetEnd()&&(I.low<g.CharOffs&&(I.low=g.CharOffs),I.hi>g.CharOffsetEnd()&&(I.hi=g.CharOffsetEnd()),I.low=I.low-g.CharOffs+1,I.low>0&&I.low--,I.hi=I.hi-g.CharOffs+1,I.hi>=0)){d.brush.style=Mt.Solid;var C=d.brush.color;d.brush.color=Ft.DarkGray,d.fillRect(nt.Create(r.left+e.GetDrawItemOffsetWidth(o,I.low),r.top,r.left+e.GetDrawItemOffsetWidth(o,I.hi),r.bottom)),d.brush.style=Mt.Solid,d.brush.color=C}}}}if(Yl.PROCSERIES&&!m.Print&&e.Items[n].StyleNo===oo.Domain){var w=e.Items[n];w.MarkType===ch.Beg?w.GetValue(bc.SubType)===Bc.Proc&&(n>0&&e.Items[n-1].StyleNo===oo.Domain&&e.Items[n-1].GetValue(bc.SubType)===Bc.Proc&&Yl.HCDrawArrow(d,Yl.clMedGray,r.left-10,r.top,0),this.FEditProcInfo.BeginNo===n?Yl.HCDrawArrow(d,Ft.Blue,r.left-10,r.top+12,1):Yl.HCDrawArrow(d,Yl.clMedGray,r.left-10,r.top+12,1)):w.GetValue(bc.SubType)===Bc.Proc&&(n<e.Items.count-1&&e.Items[n+1].StyleNo===oo.Domain&&e.Items[n+1].GetValue(bc.SubType)===Bc.Proc&&Yl.HCDrawArrow(d,Yl.clMedGray,r.right+10,r.top+12,1),this.FEditProcInfo.EndNo===n?Yl.HCDrawArrow(d,Ft.Blue,r.right+10,r.top,0):Yl.HCDrawArrow(d,Yl.clMedGray,r.right+10,r.top,0))}""!==this.FPageBlankTip&&e.isClass($c)&&(o<e.DrawItems.count-1?e.Items[e.DrawItems[o+1].ItemNo].PageBreak&&this.DrawBlankTip_(a,r.top+r.height+e.GetLineBlankSpace(o),l,h,d):this.DrawBlankTip_(a,r.top+r.height+e.GetLineBlankSpace(o),l,h,d)),f()(F()(i.prototype),"DoSectionDrawItemPaintAfter",this).call(this,t,e,n,o,s,r,a,l,h,c,u,d,m)}},{key:"DrawBlankTip_",value:function(t,e,i,n,o){e+14<=n&&(o.font.size=12,o.font.styles.clear(),o.font.color=Ft.Black,o.textOut(t+Math.trunc((i-t-o.textWidth(this.FPageBlankTip))/2),e,this.FPageBlankTip))}},{key:"Search",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=f()(F()(i.prototype),"Search",this).call(this,t,e,n);return Yl.PROCSERIES&&this.CheckCaretProcInfo(),o}},{key:"Replace",value:function(t){var e=f()(F()(i.prototype),"Replace",this).call(this,t);return Yl.PROCSERIES&&this.CheckProcInfo(),e}},{key:"TraverseItem",value:function(t){if(0!=t.Areas.size)for(var e=0;e<=this.Sections.count-1;e++)t.Stop||(t.SectionIndex=e,t.Areas.has(ql.Header)&&this.Sections[e].Header.TraverseItem(t),!t.Stop&&t.Areas.has(ql.Page)&&this.Sections[e].Page.TraverseItem(t),!t.Stop&&t.Areas.has(ql.Footer)&&this.Sections[e].Footer.TraverseItem(t))}},{key:"TraverseData",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=new Ks;n.Tag=0,n.Process=e,n.ReverseOrder=i,t.TraverseItem(n),n=null}},{key:"TraverseProcItem",value:function(t,e){var i=this.GetProcItemNo(t);if(i.result){e.SectionIndex=i.sectionIndex;var n=this.Sections[i.sectionIndex].Page;if(e.ReverseOrder)for(var o=i.endNo;o>=i.startNo&&!e.Stop;o--)n.TraverseItemExecute(o,e);else for(var s=i.startNo;s<=i.endNo&&!e.Stop;s++)n.TraverseItemExecute(s,e)}}},{key:"TraverseDeGroup",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this.GetDeGroupItemNo(t);if(n.result){i&&null!=i.mark&&i.mark||(n.endNo--,n.startNo++),e.SectionIndex=n.sectionIndex;var o=n.data;if(e.ReverseOrder)for(var s=n.endNo;s>=n.startNo&&!e.Stop;s--)o.TraverseItemExecute(s,e);else for(var r=n.startNo;r<=n.endNo&&!e.Stop;r++)o.TraverseItemExecute(r,e)}}},{key:"TraverseProcDeGroup",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=this.GetProcDeGroupItemNo(t,e);if(o.result){n&&null!=n.mark&&!n.mark&&(o.endNo--,o.startNo++),i.SectionIndex=o.sectionIndex;var s=o.data;if(i.ReverseOrder)for(var r=o.endNo;r>=o.startNo&&!i.Stop;r--)s.TraverseItemExecute(r,i);else for(var a=o.startNo;a<=o.endNo&&!i.Stop;a++)s.TraverseItemExecute(a,i)}}},{key:"SelectToDeGroup",value:function(t){if(this.CanNotEdit())return!1;var e=!1;this.FIgnoreAcceptAction=!0;try{e=this.SelectToDomain(t)}finally{this.FIgnoreAcceptAction=!1}return Yl.PROCSERIES&&this.CheckCaretProcInfo(),e}},{key:"InsertDeGroup",value:function(t){if(this.CanNotEdit())return!1;var e=!1;this.FIgnoreAcceptAction=!0;try{e=this.InsertDomain(t)}finally{this.FIgnoreAcceptAction=!1}return Yl.PROCSERIES&&this.CheckProcInfo(),e}},{key:"DeleteDeGroup",value:function(t){var e=this;if(""==t)return!1;var i=!1,n=this.GetDataDeGroupItemNo(this.ActiveSection.Page,t,!1,0,-1);if(n.endNo>0){this.FIgnoreAcceptAction=!0;try{i=this.ActiveSection.DataAction(this.ActiveSection.Page,(function(){return e.ActiveSection.Page.DeleteDomainByItemNo(n.startNo,n.endNo)}))}finally{this.FIgnoreAcceptAction=!1}Yl.PROCSERIES&&this.CheckProcInfo()}return i}},{key:"GetDeGroupItemNo",value:function(t){for(var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ql.Page,n=new zs,o=0;o<this.Sections.count;o++){switch(i){case ql.Header:e=this.Sections[o].Header;break;case ql.Footer:e=this.Sections[o].Footer;break;default:e=this.Sections[o].Page}if(this.GetDataDeGroupTree(t,e,0,e.Items.count-1,n),n.Childs.count>0)return{result:!0,sectionIndex:o,data:n.Childs[0].Data,startNo:n.Childs[0].BeginNo,endNo:n.Childs[0].EndNo}}return{result:!1,sectionIndex:-1,data:null,startNo:-1,endNo:-1}}},{key:"GetActiveDeGroupPropertyObj",value:function(){return this.GetCaretDeGroupProperty("object")}},{key:"GetActiveDeGroupProperty",value:function(t,e){return this.GetCaretDeGroupProperty(t,e)}},{key:"GetCaretDeGroupProperty",value:function(t,e){var i=this.ActiveSectionTopLevelData(),n=i.ActiveDomain;return n.BeginNo<0?null:"object"===t?i.Items[n.BeginNo].ToJSONObject():"objstr"===t?i.Items[n.BeginNo].ToJSONString():t==bc.Propertys?"json"==e?Yl.GetPropertyJSON(i.Items[n.BeginNo].Propertys):Yl.GetPropertyString(i.Items[n.BeginNo].Propertys,Yl.RecordSeparator,Yl.UnitSeparator):i.Items[n.BeginNo].GetValue(t)}},{key:"SetActiveDeGroupPropertyByObj",value:function(t){this.SetCaretDeGroupProperty("object",t)}},{key:"SetActiveDeGroupProperty",value:function(t,e){this.SetCaretDeGroupProperty(t,e)}},{key:"SetCaretDeGroupProperty",value:function(t,e){var i=this.ActiveSectionTopLevelData(),n=i.ActiveDomain;return n.EndNo>0&&("object"===t&&"object"==o()(e)?(i.Items[n.BeginNo].ParseJSONObject(e),i.Items[n.EndNo].ParseJSONObject(e)):t==bc.Propertys?"object"==o()(e)?(Yl.SetPropertyJSON(i.Items[n.BeginNo].Propertys,e),Yl.SetPropertyJSON(i.Items[n.EndNo].Propertys,e)):(Yl.SetPropertyString(i.Items[n.BeginNo].Propertys,e),Yl.SetPropertyString(i.Items[n.EndNo].Propertys,e)):(i.Items[n.BeginNo].SetValue(t,e),i.Items[n.EndNo].SetValue(t,e)),i.isClass(Jl)&&i.FormatDirty(),!0)}},{key:"GetActiveDeGroupText",value:function(){return this.GetCaretDeGroupText()}},{key:"GetCaretDeGroupText",value:function(){var t=this.ActiveSectionTopLevelData(),e=t.ActiveDomain;return e.BeginNo<0?"":this.GetDataDeGroupText(t,e.BeginNo,e.EndNo)}},{key:"SetActiveDeGroupByText",value:function(t){this.SetCaretDeGroupByText(t)}},{key:"SetCaretDeGroupByText",value:function(t){var e=this.ActiveSectionTopLevelData().ActiveDomain;e.EndNo>0&&(this.SetDataDeGroupText(e.Data,e.BeginNo,e.EndNo,t),this.FormatSection(this.ActiveSectionIndex))}},{key:"GetCaretDeGroupStream",value:function(){var t=this.ActiveSectionTopLevelData(),e=t.ActiveDomain;if(e.BeginNo<0)return null;this.GetDataDeGroupToStream(t,e.BeginNo,e.EndNo)}},{key:"SetCaretDeGroupByStream",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.ActiveSectionTopLevelData(),n=i.ActiveDomain;n.EndNo>0&&this.SetDataDeGroupFromStream(n.Data,n.BeginNo,n.EndNo,t,e)}},{key:"SetDeGroupPropertyByObj",value:function(t,e){return this.SetDeGroupProperty(t,"object",e)}},{key:"SetDeGroupProperty",value:function(t,e,i){var n=this.GetDeGroupItemNo(t);return!!n.result&&("object"===e&&"object"==o()(i)?(n.data.Items[n.startNo].ParseJSONObject(i),n.data.Items[n.endNo].ParseJSONObject(i)):e==bc.OutOfRang?(n.data.Items[n.startNo].OutOfRang="1"==i,n.data.Items[n.endNo].OutOfRang="1"==i):"DeleteAllow"==e?(n.data.Items[n.startNo].DeleteAllow="1"==i,n.data.Items[n.endNo].DeleteAllow="1"==i):"ReadOnly"==e?(n.data.Items[n.startNo].ReadOnly="1"==i,n.data.Items[n.endNo].ReadOnly="1"==i):"Propertys"==e&&("object"==o()(i)?(Yl.SetItemPropertyJSON(i,n.data.Items[n.startNo]),Yl.SetItemPropertyJSON(i,n.data.Items[n.endNo])):(Yl.SetItemPropertyString(i,n.data.Items[n.startNo]),Yl.SetItemPropertyString(i,n.data.Items[n.endNo]))),!0)}},{key:"GetDeGroupPropertyObj",value:function(t){return this.GetDeGroupProperty(t,"object").text}},{key:"GetDeGroupProperty",value:function(t,e){var i=this.GetDeGroupItemNo(t);return i.result?{result:!0,text:i.data.Items[i.startNo].GetProperty(e)}:{result:!1,text:null}}},{key:"GetProcDeGroupProperty",value:function(t,e,i){var n=this.GetProcDeGroupItemNo(t,e);return n.result?{result:!0,text:n.data.Items[n.startNo].GetProperty(i)}:{result:!1,text:null}}},{key:"SetActiveDeGroupByFileStream",value:function(t,e){var i=this.ActiveSectionTopLevelData().ActiveDomain;if(i.EndNo>0){var n=new Wu(this.hcl);n.LoadFromStream(t);var o=new ht;Yl._SaveFileFormatAndVersion(o),o.writeByte(Yl.HC_STREAM_LITE),n.Style.SaveToStream(o),n.ActiveSection.Page.SaveItemToStream(o,0,0,n.ActiveSection.Page.Items.count-1,n.ActiveSection.Page.GetItemOffsetAfter(n.ActiveSection.Page.Items.count-1)),o.position=0,this.SetDataDeGroupFromStream(i.Data,i.BeginNo,i.EndNo,o,e)}}},{key:"SetActiveDeGroupBySteam",value:function(t,e){var i=this.ActiveSectionTopLevelData(),n=i.ActiveDomain;if(n.EndNo>0){var o=n.BeginNo;this.SetDataDeGroupFromStream(n.Data,n.BeginNo,n.EndNo,t,e),i.ItemSetCaretRequest(o,Yl.OffsetAfter),this.UpdateView()}}},{key:"InsertDeItem",value:function(t){return this.InsertItem(t)}},{key:"InsertHtml",value:function(t){return null!==this.OnInsertHtml?this.OnInsertHtml(t):f()(F()(i.prototype),"InsertHtml",this).call(this,t)}},{key:"NewDeItem",value:function(t){var e=new rc(this.hcl,t);return e.StyleNo=this.Style.GetStyleNo(this.Style.DefaultTextStyle,!0),e.ParaNo=this.CurParaNo,e}},{key:"GetDeItemText",value:function(t){return this.GetDeItemProperty(t,"Text")}},{key:"SetDeItemPropertyByObj",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.SetDeObjectProperty(t,"object",e,i)}},{key:"SetDeItemProperty",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.SetDeObjectProperty(t,e,i,n)}},{key:"GetDeItemPropertyObj",value:function(t){return this.GetDeItemProperty(t,"object").text}},{key:"GetDeItemProperty",value:function(t,e,i){var n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,a=!1,l=new Ks;l.Areas.add(ql.Header),l.Areas.add(ql.Page),l.Areas.add(ql.Footer);var h,c=null,u=function(o,s,r,l,u){if((h=o.Items[s]).StyleNo>oo.Null&&h.GetValue(Yh.Index)==t){if("object"===e)c=h.ToJSONObject();else if("objstr"===e)c=h.ToJSONString();else if("Text"===e)c=h.Text;else if("AllocValue"===e)c=!!h.AllocValue;else{if(e===bc.Propertys)return"json"===i?Yl.GetPropertyJSON(h.Propertys):Yl.GetPropertyString(h.Propertys,Yl.RecordSeparator,Yl.UnitSeparator);c=h.GetValue(e)}return a=!0,!0}if((h.StyleNo===oo.Image||h.StyleNo===oo.FloatImage)&&h.GetValue(Yh.Index)===t){if("Base64"===e||"Graphic"===e)c=h.Image.src;else{if(e==bc.Propertys)return"json"===i?Yl.GetPropertyJSON(h.Propertys):Yl.GetPropertyString(h.Propertys,Yl.RecordSeparator,Yl.UnitSeparator);c=h.GetValue(e)}return a=!0,!0}if(h.StyleNo===oo.Combobox&&h.GetValue(Yh.Index)===t){if("Text"==e)c=h.Text;else if("TextEffective"==e)c=h.TextEffective();else if("ItemValue"===e||"Value"===e)c=h.Items[h.ItemIndex].Value;else{if(e===bc.Propertys)return"json"===i?Yl.GetPropertyJSON(h.Propertys):Yl.GetPropertyString(h.Propertys,Yl.RecordSeparator,Yl.UnitSeparator);c=h.GetValue(e)}return a=!0,!0}if(h.StyleNo===oo.Edit&&h.GetValue(Yh.Index)===t){if("Text"===e)c=h.Text;else if("TextEffective"==e)c=h.TextEffective();else{if(e===bc.Propertys)return"json"===i?Yl.GetPropertyJSON(h.Propertys):Yl.GetPropertyString(h.Propertys,Yl.RecordSeparator,Yl.UnitSeparator);c=h.GetValue(e)}return a=!0,!0}if(h.StyleNo===oo.DateTimePicker&&h.GetValue(Yh.Index)===t){if("Text"===e)c=h.Text;else if("TextEffective"==e)c=h.TextEffective();else{if(e===bc.Propertys)return"json"===i?Yl.GetPropertyJSON(h.Propertys):Yl.GetPropertyString(h.Propertys,Yl.RecordSeparator,Yl.UnitSeparator);c=h.GetValue(e)}return a=!0,!0}if(h.StyleNo===oo.CheckBox&&h.GetValue(Yh.Index)===t){if("Text"===e)c=h.Text;else if("TextEffective"==e)c=h.TextEffective();else if("Checked"===e)c=!!h.Checked;else{if(e===bc.Propertys)return"json"===i?Yl.GetPropertyJSON(h.Propertys):Yl.GetPropertyString(h.Propertys,Yl.RecordSeparator,Yl.UnitSeparator);c=h.GetValue(e)}return a=!0,!0}if(h.StyleNo===oo.RadioGroup&&h.GetValue(Yh.Index)===t){if("Text"==e)c=h.Text;else if("TextEffective"==e)c=h.TextEffective();else{if(e===bc.Propertys)return"json"===i?Yl.GetPropertyJSON(h.Propertys):Yl.GetPropertyString(h.Propertys,Yl.RecordSeparator,Yl.UnitSeparator);c=h.GetValue(e)}return a=!0,!0}if(h.StyleNo===oo.Domain&&h.GetValue(Yh.Index)===t){if("Text"==e){var f=o.GetDomainAnotherRange(s);c=n.GetDataDeGroupText(o,f.startNo,f.endNo)}else{if(e===bc.Propertys)return"json"==i?Yl.GetPropertyJSON(h.Propertys):Yl.GetPropertyString(h.Propertys,Yl.RecordSeparator,Yl.UnitSeparator);c=h.GetValue(e)}return a=!0,!0}if((h.StyleNo===oo.BarCode||h.StyleNo===oo.QRCode||h.StyleNo===oo.FloatBarCode||h.StyleNo===oo.FloatQRCode)&&h.GetValue(Yh.Index)===t){if("Text"==e)c=h.Text;else{if(e===bc.Propertys)return"json"===i?Yl.GetPropertyJSON(h.Propertys):Yl.GetPropertyString(h.Propertys,Yl.RecordSeparator,Yl.UnitSeparator);c=h.GetValue(e)}return a=!0,!0}};if(l.Process=u,null===o)this.TraverseItem(l);else for(var f=s;f<=r;f++)if(o.Items[f].Visible||l.Invisible){if(l.Stop=l.Process(o,f,l.Tag,l.DomainStack,l.Stop),l.Stop)break;o.Items[f].StyleNo<oo.Null&&o.Items[f].TraverseItem(l)}return{result:a,text:c}}},{key:"GetDeGroupDeItemText",value:function(t,e){return this.GetDeGroupItemNo(t).result?this.GetDeItemProperty(e,"Text"):{result:!1,text:""}}},{key:"GetDeGroupDeItemProperty",value:function(t,e,i){return this.GetDeGroupItemNo(t).result?this.GetDeItemProperty(e,i):{result:!1,text:""}}},{key:"GetDeObject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=new Ks;r.Tag=0,r.ReverseOrder=o,r.Invisible=s;var a=function(e,i,n,o,s){if(e.Items[i].StyleNo>oo.Null){if(t(e,i,r.SectionIndex))return!0}else switch(e.Items[i].StyleNo){case oo.Domain:case oo.Table:case oo.Image:case oo.Edit:case oo.Combobox:case oo.Button:case oo.CheckBox:case oo.RadioGroup:case oo.DateTimePicker:if(t(e,i,r.SectionIndex))return!0}};if(r.Process=a,null===e)r.Areas.add(ql.Page),this.TraverseItem(r);else if(i<0&&(i=0),n<0&&(n=e.Items.count-1),o){for(var l=n;l>=i;l--)if(e.Items[l].Visible||r.Invisible){if(r.Stop=r.Process(e,l,r.Tag,r.DomainStack,r.Stop),r.Stop)break;e.Items[l].StyleNo<oo.Null&&e.Items[l].TraverseItem(r)}}else for(var h=i;h<=n;h++)if(e.Items[h].Visible||r.Invisible){if(r.Stop=r.Process(e,h,r.Tag,r.DomainStack,r.Stop),r.Stop)break;e.Items[h].StyleNo<oo.Null&&e.Items[h].TraverseItem(r)}}},{key:"GetItemDataAndNoByIndex",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=-1,a=-1,l=null,h=null;return this.GetDeObject((function(i,n,o){return h=i.Items[n],!!e.DeItemIndexMatch(h,t)&&(a=o,r=n,l=i,!0)}),i,n,o,!1,s),{sectionIndex:a,data:l,itemNo:r}}},{key:"GetItemByIndex",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=this.GetItemDataAndNoByIndex(t,e,i,n,o);return s.itemNo>=0?s.data.Items[s.itemNo]:null}},{key:"GetDeItemByIndex",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.GetItemByIndex(t,e,i,n,o)}},{key:"GetItemCoordByIndex",value:function(t){var e=this.GetItemDataAndNoByIndex(t),i={pageIndex:-1,sectionIndex:e.sectionIndex,data:e.data,itemNo:e.itemNo,left:-1,top:-1,width:0,height:0};if(e.itemNo<0)return i;var n=e.data.DrawItems[e.data.Items[e.itemNo].FirstDItemNo].rect,o=e.data.GetDrawItemFormatCoord(e.data.Items[e.itemNo].FirstDItemNo),s=this.Sections[e.sectionIndex],r=s.GetPageIndexByFormat(o.y),a=s.GetPageDataFmtTop(r),l=s.GetHeaderAreaHeight(r);return i.top=o.y-a+l,i.left=s.GetPageMarginLeft(r)+o.x,i.width=n.width,i.height=n.height,i.pageIndex=this.GetPageIndexBySectionPageIndex(e.sectionIndex,r),i}},{key:"SetDeImage",value:function(t,e){var i=0;return null!=e.which&&(i=e.which),this.SetDeObjectProperty(t,"Propertys",e,i)}},{key:"ReplaceDataItemByLiteStream",value:function(t,e,i){this.DataLoadLiteStream(!0,t,(function(n,o){e.ReplaceItemByStream(i,t,o,n)}))}},{key:"ReplaceDataItemByObj",value:function(t,e,i){var n=null;return(n=null!=i.StyleNo&&i.StyleNo!==oo.Null&&L.isNumberStrict(i.StyleNo)?t.CreateItemByStyle(i.StyleNo):t.CreateItemByStyle(t.Items[e].StyleNo)).ParseJSONObject(i),t.ReplaceItemByItem(e,n)||(n=null),!0}},{key:"ReplaceItemByObj",value:function(t,e){var i=this;if(this.FProcCount>0)return this.ReplaceProcItemByObj(this.EditProcIndex,t,e);var n=!1;return this.GetDeObject((function(o,s){return!!i.DeItemIndexMatch(o.Items[s],t)&&(i.ReplaceDataItemByObj(o,s,e),n=!0,!0)}),null,-1,-1,!0),n&&this.FormatData(),n}},{key:"ReplaceActiveItemByObj",value:function(t){if(this.FProcCount>0&&this.EditProcIndex!==this.FCaretProcInfo.Index)return!1;var e=this.ActiveSectionTopLevelData();if(!e.CanEdit())return!1;var i=e.GetActiveItemNo();if(i<0)return!1;var n=this.ReplaceDataItemByObj(e,i,t);return this.FormatData(),e.ReSetSelectAndCaret(i),n}},{key:"ReplaceProcItemByObj",value:function(t,e,i){var n=this,o=this.GetProcItemNo(t),s=!1;return o.result&&this.GetDeObject((function(t,o){return!!n.DeItemIndexMatch(t.Items[o],e)&&(n.ReplaceDataItemByObj(t,o,i),s=!0,!0)}),this.Sections[o.sectionIndex].Page,o.startNo,o.endNo,!0),s&&this.FormatData(),s}},{key:"ObjToLiteStream",value:function(t,e){var i=e.Items?e.Items:e;i.length||(i=[i]);var n=new ht;this.ActiveSection.Page.DataJSONToStream(i,this.Style,n),this.DataSaveLiteStream(t,(function(){t.writeBuffer(n.buffer)})),n=null}},{key:"DataDeGroupAppendByObj",value:function(t,e,i,n){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=new ht;return this.ObjToLiteStream(r,n.Items?n.Items:n),r.position=0,this.AppendDataDeGroupFromStream(t,e,i,r,o,s),r=null,!0}},{key:"DeGroupAppendByObj",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];return this.DeGroupAppendByObjEx(this.ActiveSectionIndex,ql.Page,t,e,i,n,o,s)}},{key:"DeGroupAppendByObjEx",value:function(t,e,i,n){var o=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],h=null;switch(e){case ql.Header:h=this.Sections[t].Header;break;case ql.Footer:h=this.Sections[t].Footer;break;default:h=this.Sections[t].Page}var c=0,u=h.Items.count-1;if(Yl.PROCSERIES&&this.FProcCount>0&&e===ql.Page){if(""===this.FEditProcIndex)return!1;if(this.FEditProcInfo.SectionIndex!==t)return!1;c=this.FEditProcInfo.BeginNo,u=this.FEditProcInfo.EndNo,this.SetProcChangedBy(this.FEditProcInfo.SectionIndex,c,u,!0)}var f=new zs;if(this.GetDataDeGroupTree(i,h,c,u,f),0===f.Childs.count)return!1;this.DisableUndo();try{var d=new ht;this.ObjToLiteStream(d,n.Items?n.Items:n),d.position=0,this.DataLoadLiteStream(!0,d,(function(t,e){o.DeGroupTreeAppendByStream(f,d,e,t,s,r,a,l)})),d=null,this.ClearUndo()}finally{this.EnableUndo()}return f=null,this.FormatSection(t),Yl.PROCSERIES&&this.CheckProcInfo(),!0}},{key:"ActiveDeGroupAppendByObj",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.FProcCount>0&&this.EditProcIndex!=this.FCaretProcInfo.Index)return!1;var n=this.ActiveSectionTopLevelData();return n.ActiveDomain.EndNo>0&&this.DataDeGroupAppendByObj(n,n.ActiveDomain.BeginNo,n.ActiveDomain.EndNo,t.Items?t.Items:t,e,i)}},{key:"SetDataDeGroupByObj",value:function(t,e,i,n){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=new ht;return this.ObjToLiteStream(s,n.Items?n.Items:n),s.position=0,this.SetDataDeGroupFromStream(t,e,i,s,o),s=null,!0}},{key:"SetDeGroupByObj",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return this.SetDeGroupByObjEx(this.ActiveSectionIndex,ql.Page,t,e,i,n,o)}},{key:"SetDeGroupByObjEx",value:function(t,e,i,n){var o=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=null;switch(e){case ql.Header:l=this.Sections[t].Header;break;case ql.Footer:l=this.Sections[t].Footer;break;default:l=this.Sections[t].Page}var h=0,c=l.Items.count-1,u="";if(Yl.PROCSERIES&&this.FProcCount>0&&e===ql.Page){if(""===this.FEditProcIndex)return!1;if(this.FEditProcInfo.SectionIndex!==t)return!1;u=this.FEditProcInfo.Index,h=this.FEditProcInfo.BeginNo,c=this.FEditProcInfo.EndNo,this.SetProcChangedBy(this.FEditProcInfo.SectionIndex,h,c,!0)}var f=new zs;if(this.GetDataDeGroupTree(i,l,h,c,f),0===f.Childs.count)return!1;this.DisableUndo();try{var d=new ht;this.ObjToLiteStream(d,n.Items?n.Items:n),d.position=0,this.DataLoadLiteStream(!0,d,(function(t,e){o.SetDeGroupTreeByStream(f,d,e,t,s,r,a)})),d=null,this.ClearUndo()}finally{this.EnableUndo()}return f=null,this.FormatSection(t),""!==u&&(this.EditProcIndex=u),Yl.PROCSERIES&&this.CheckProcInfo(),!0}},{key:"SetActiveDeGroupByObj",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.FProcCount>0&&this.EditProcIndex!=this.FCaretProcInfo.Index)return!1;var i=this.ActiveSectionTopLevelData();return i.ActiveDomain.EndNo>0&&this.SetDataDeGroupByObj(i,i.ActiveDomain.BeginNo,i.ActiveDomain.EndNo,t.Items?t.Items:t,e)}},{key:"SyncDeItemAfterRef",value:function(t,e){var i,n=!1,o=!1,s=new Ks;s.Tag=0,s.Areas.add(ql.Page),s.Process=function(t,s,r,a,l){i=t.Items[s],n?i.StyleNo>oo.Null&&i.GetValue(Yh.Index)==e.GetValue(Yh.Index)&&(i.SetValueDomain(e.Text,e.GetValue(Yh.CMVVCode),e.GetValue(Yh.Unit),!0),o=!0):i===e&&(n=!0)},this.TraverseItem(s),o&&this.FormatData()}},{key:"FindSameDeItem",value:function(t){var e=null,i=new Ks;return i.Tag=0,i.Areas.add(ql.Page),i.Process=function(i,n,o,s,r){if(i.Items[n].StyleNo>oo.Null){var a=i.Items[n];if(a.GetValue(Yh.Index)==t.GetValue(Yh.Index)&&a.AllocValue)return e=a,!0}return!1},this.TraverseItem(i),e}},{key:"SetDeItemText",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return"string"==typeof e&&this.SetDeObjectProperty(t,"Text",e,i,n)}},{key:"SetDataDeItemValueDomain",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(null===t&&(t=this.ActiveSection.Page),!t.CanEdit())return!1;var a=null,l=!1,h=null;return this.GetDeObject((function(t,c){if(t.Items[c].StyleNo>oo.Null&&t.Items[c].Index===e){if(1!==r){if(t.Items[c].SetValueDomain(i,n,o,s),t.ItemChangeBy(c,0,rh.ContentChange),l=!0,t.isClass(Jl)&&t.OnFormatDirty(),0===r)return!0}else 1===r&&(a=t.Items[c],h=t);return!1}}),t),1===r&&null!==a&&null!==h&&(a.SetValueDomain(i,n,o,s),h.Change(),l=!0,h.isClass(Jl)&&h.OnFormatDirty()),l&&this.FormatData(),l}},{key:"SetDeItemValueDomain",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this.SetDataDeItemValueDomain(null,t,e,i,n,o,s)}},{key:"SetDataDeObjectProperty",value:function(t,e,i,n){var s=!1,r=t.Items[e];if(r.StyleNo>oo.Null)if("object"===i){var a=r.Text;r.ParseJSONObject(n),""===r.Text&&r.Reset(),a!==r.Text&&(t.ItemChangeBy(e,0,rh.ContentChange),t.isClass(Jl)&&t.OnFormatDirty(),s=!0)}else if("Text"==i)""!=n?(r.Text=n,r.AllocValue=!0):r.Reset(),t.ItemChangeBy(e,0,rh.ContentChange),t.isClass(Jl)&&t.OnFormatDirty(),s=!0;else if("DateTime"===i){var l=r.GetValue(Yh.DTFormat);l||(l="yyyy-MM-dd hh:mm"),"object"===o()(n)?r.Text=lt.CreateWithDateTime(n).format(l):r.Text=lt.CreateByString(n).format(l),r.AllocValue=!0,t.ItemChangeBy(e,0,rh.ContentChange),t.isClass(Jl)&&t.OnFormatDirty(),s=!0}else if("Propertys"==i)if("object"===o()(n))for(var h in n)"Text"===h?(""!==n[h]&&(r.Text=n[h],r.AllocValue=!0,t.ItemChangeBy(e,0,rh.ContentChange),t.isClass(Jl)&&t.OnFormatDirty()),s=!0):r.SetValue(h,n[h]);else{var c=new rt;Yl.SetPropertyString(n,c);for(var u=0;u<c.count;u++)"Text"===c[u].key?(""!==c[u].val&&(r.Text=c[u].val,r.AllocValue=!0,t.isClass(Jl)&&t.OnFormatDirty(),t.ItemChangeBy(e,0,rh.ContentChange)),s=!0):r.SetValue(c[u].key,c[u].val)}else r.SetValue(i,n);else if(r.StyleNo===oo.Table||r.StyleNo===oo.CheckBox||r.StyleNo===oo.Edit||r.StyleNo===oo.Combobox||r.StyleNo===oo.DateTimePicker||r.StyleNo===oo.RadioGroup||r.StyleNo===oo.BarCode||r.StyleNo===oo.QRCode||r.StyleNo===oo.FloatBarCode||r.StyleNo===oo.FloatQRCode||r.StyleNo===oo.FloatImage)if("object"===i)r.ParseJSONObject(n);else if("Text"===i)r.StyleNo!==oo.CheckBox&&r.StyleNo!==oo.Edit&&r.StyleNo!==oo.Combobox||(r.Text=n,t.ItemChangeBy(e,0,rh.ContentChange),t.isClass(Jl)&&t.OnFormatDirty(),s=!0);else if("Checked"===i)r.StyleNo===oo.CheckBox&&(r.Checked="1"===n||"true"===n,t.ItemChangeBy(e,0,rh.ContentChange),t.isClass(Jl)&&t.OnFormatDirty(),s=!0);else if("DateTime"===i)r.StyleNo===oo.DateTimePicker&&("object"===o()(n)?r.DateTime=lt.CreateWithDateTime(n):r.DateTime=lt.CreateByString(n),t.ItemChangeBy(e,0,rh.ContentChange),t.isClass(Jl)&&t.OnFormatDirty(),s=!0);else if("Propertys"===i)if("object"===o()(n))for(var f in n)r.SetValue(f,n[f]);else{var d=new rt;Yl.SetPropertyString(n,d);for(var m=0;m<d.count;m++)"Text"===d[m].key?r.StyleNo!==oo.CheckBox&&r.StyleNo!==oo.Edit&&r.StyleNo!==oo.Combobox||(r.Text=d[m].val,t.ItemChangeBy(e,0,rh.ContentChange),t.isClass(Jl)&&t.OnFormatDirty(),s=!0):r.SetValue(d[m].key,d[m].val)}else r.SetValue(i,n);else if(r.StyleNo===oo.Image)if("object"===i)r.ParseJSONObject(n);else if("Text"===i);else if("Base64"===i||"Graphic"===i)n.Base64?r.LoadFromBase64(n.Base64,"png",(function(e,i){n.LoadedEvent&&n.LoadedEvent(e,i),r.RestrainSize(t.Width,r.Height),r.ReFormatRequest()})):r.LoadFromBase64(n,"png",(function(e,i){n.LoadedEvent&&n.LoadedEvent(e,i),r.RestrainSize(t.Width,r.Height),r.ReFormatRequest()})),s=!0;else if("Propertys"===i){var S=r.Width,p=r.Height,y=!1;for(var F in n)"Text"===F||("Width"===F?(S=n[F],r.Width=S):"Height"===F?(p=n[F],r.Height=p):"AutoSize"===F?y=n[F]:"CanResize"===F?r.CanResize=n[F]:"Base64"===F?r.LoadFromBase64(n[F],"png",(function(e,i){y||(r.Width=S,r.Height=p),n.LoadedEvent&&n.LoadedEvent(e,i),r.RestrainSize(t.Width,r.Height),r.ReFormatRequest()})):r.SetValue(F,n[F]))}else r.SetValue(i,n);return s}},{key:"GetActiveDeItemPropertyObj",value:function(){return this.ActiveSectionTopLevelData().GetActiveItem().ToJSONObject()}},{key:"SetActiveDeItemPropertyByObj",value:function(t){return this.SetActiveDeObjectProperty("object",t)}},{key:"SetActiveDeItemProperty",value:function(t,e){this.SetActiveDeObjectProperty(t,e)}},{key:"SetActiveDeObjectProperty",value:function(t,e){var i=this.ActiveSectionTopLevelData();return this.SetDataDeObjectProperty(i,i.GetActiveItemNo(),t,e)&&this.ActiveSection.ReFormatActiveItem(),!0}},{key:"SetDeObjectProperty",value:function(t,e,i){var n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,r=!1,a=!1,l=null,h=new Ks;(s&ql.Header)===ql.Header&&h.Areas.add(ql.Header),(s&ql.Footer)===ql.Footer&&h.Areas.add(ql.Footer),(s&ql.Page)===ql.Page&&h.Areas.add(ql.Page);var c=function(s,h,c,u,f){if(l=s.Items[h],n.DeItemIndexMatch(l,t)&&(r=!0,n.SetDataDeObjectProperty(s,h,e,i)&&(a=!0),0===o))return!0};if(h.Process=c,Yl.PROCSERIES&&this.FProcCount>0&&h.Areas.has(ql.Page)){if(""==this.FEditProcIndex)return!1;this.SetProcChangedBy(this.FEditProcInfo.SectionIndex,this.FEditProcInfo.BeginNo,this.FEditProcInfo.EndNo,!0),h.SectionIndex=this.FEditProcInfo.SectionIndex;for(var u,f=this.Sections[this.FEditProcInfo.SectionIndex].Page,d=this.FEditProcInfo.BeginNo;d<=this.FEditProcInfo.EndNo&&!h.Stop;d++)(f.Items[d].Visible||h.Invisible)&&(f.Items[d].StyleNo===oo.Domain&&(f.Items[d].BeginMark()?(u=new zs,f.GetDomainFrom(d,Yl.OffsetAfter,u),h.DomainStack.push(u)):h.DomainStack.pop()),h.Stop=h.Process(f,d,h.Tag,h.domainStack,h.Stop),h.Stop||f.Items[d].StyleNo<oo.Null&&f.Items[d].TraverseItem(h))}else this.TraverseItem(h);return r&&a&&this.FormatData(),r}},{key:"SetDataDeObjectPropertyByIndex",value:function(t,e,i,n){var o=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=!1,a=!1,l=new Ks;l.Tag=0,l.ReverseOrder=0!==s;var h=function(t,l,h,c,u){if(o.DeItemIndexMatch(t.Items[l],e)&&(r=!0,o.SetDataDeObjectProperty(t,l,i,n)&&(a=!0),0===s||1===s))return!0};return l.Process=h,t.TraverseItem(l),r&&a&&t.ReFormat(),r}},{key:"SetSectionHeaderDeObjectProperty",value:function(t,e,i,n){var o=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(this.Sections[t].Header.ReadOnly)return!1;var r=!1,a=!1,l=null,h=new Ks;h.Areas.add(ql.Header),0!==s&&(h.ReverseOrder=!0);var c=function(t,h,c,u,f){if(l=t.Items[h],(r=o.DeItemIndexMatch(l,e))&&(o.SetDataDeObjectProperty(t,h,i,n)&&(a=!0),0==s||1==s))return!0};return h.Process=c,this.Sections[t].Header.TraverseItem(h),r&&a&&this.FormatData(),r}},{key:"SetSectionHeaderDeItemValueDomain",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return this.SetDataDeItemValueDomain(this.FSections[t].Header,e,i,n,o,s,r)}},{key:"SetHeaderDeItemValueDomain",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this.SetSectionHeaderDeItemValueDomain(this.FActiveSectionIndex,t,e,i,n,o,s)}},{key:"SetSectionFooterDeObjectProperty",value:function(t,e,i,n){var o=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(this.Sections[t].Footer.ReadOnly)return!1;var r=!1,a=!1,l=null,h=new Ks;h.Areas.add(ql.Footer),0!=s&&(h.ReverseOrder=!0);var c=function(t,h,c,u,f){if(l=t.Items[h],(r=o.DeItemIndexMatch(l,e))&&(o.SetDataDeObjectProperty(t,h,i,n)&&(a=!0),0==s||1==s))return!0};return h.Process=c,this.Sections[t].Footer.TraverseItem(h),r&&a&&this.FormatData(),r}},{key:"SetSectionFooterDeItemValueDomain",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return this.SetDataDeItemValueDomain(this.FSections[t].Footer,e,i,n,o,s,r)}},{key:"SetFooterDeItemValueDomain",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this.SetSectionFooterDeItemValueDomain(this.FActiveSectionIndex,t,e,i,n,o,s)}},{key:"DeleteDeObject",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,o=!1,s=null,r=null,a=!0,l=new Ks;l.Invisible=!0,(n&ql.Header)===ql.Header&&l.Areas.add(ql.Header),(n&ql.Footer)===ql.Footer&&l.Areas.add(ql.Footer),(n&ql.Page)===ql.Page&&l.Areas.add(ql.Page),0!=i&&(l.ReverseOrder=!0);var h=function(n,l,h,c,u){return s!==n&&(s=n,n.DisSelect(),a=n.CanEdit()),!!a&&(r=n.Items[l],!(!e.DeItemIndexMatch(r,t,!1)||(n.DeleteItemDirect(l),o=!0,0!=i&&1!=i))||void 0)};if(l.Process=h,Yl.PROCSERIES&&this.FProcCount>0&&l.Areas.has(ql.Page)){if(""==this.FEditProcIndex)return;this.SetProcChangedBy(this.FEditProcInfo.SectionIndex,this.FEditProcInfo.BeginNo,this.FEditProcInfo.EndNo,!0),l.SectionIndex=this.FEditProcInfo.SectionIndex;var c,u=this.Sections[this.FEditProcInfo.SectionIndex].Page;if(l.ReverseOrder)for(var f=this.FEditProcInfo.EndNo;f>=this.FEditProcInfo.BeginNo&&!l.Stop;f--)(u.Items[f].Visible||l.Invisible)&&(u.Items[f].StyleNo===oo.Domain&&(u.Items[f].EndMark()?(c=new zs,u.GetDomainFrom(f,Yl.OffsetBefor,c),l.DomainStack.push(c)):l.DomainStack.pop()),l.Stop=l.Process(u,f,l.Tag,l.domainStack,l.Stop),l.Stop||u.Items[f].StyleNo<oo.Null&&u.Items[f].TraverseItem(l));else for(var d=this.FEditProcInfo.BeginNo;d<=this.FEditProcInfo.EndNo&&!l.Stop;d++)(u.Items[d].Visible||l.Invisible)&&(u.Items[d].StyleNo===oo.Domain&&(u.Items[d].BeginMark()?(c=new zs,u.GetDomainFrom(d,Yl.OffsetAfter,c),l.DomainStack.push(c)):l.DomainStack.pop()),l.Stop=l.Process(u,d,l.Tag,l.domainStack,l.Stop),l.Stop||u.Items[d].StyleNo<oo.Null&&u.Items[d].TraverseItem(l))}else this.TraverseItem(l);o&&(this.FormatData(),this.ClearUndo())}},{key:"GetDataDeGroupTree",value:function(t,e,i,n,o){var s=new st;s.push(o);var r,a=new Ks;a.Process=function(e,i,n,o,a){e.Items[i].StyleNo===oo.Domain&&e.Items[i].Index==t&&(rs.IsBeginMark(e.Items[i])?((r=(r=s.peek()).AppendChild()).Data=e,r.BeginNo=i,s.push(r)):(r=s.pop()).EndNo=i)};for(var l=i;l<=n;l++)a.Process(e,l,a.Tag,a.DomainStack,a.Stop),a.Stop||e.Items[l].StyleNo<oo.Null&&e.Items[l].TraverseItem(a)}},{key:"ActiveTableInsertRowAfterWith",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.GetTopLevelTable();null!==i&&i.StyleNo===oo.Table&&i.InsertRowWith(i.SelectCellRang.StartRow+1,t,e)&&(this.ActiveSection.ReFormatActiveItem(),this.ClearUndo())}},{key:"ActiveTableInsertRowContentAfter",value:function(t){if(!t.Rows)return!1;if(0==t.Rows.length)return!1;var e=this.GetTopLevelTable();if(!e||e.StyleNo!=oo.Table)return!1;var i=!1,n=e.SelectCellRang.StartRow+1;this.FIgnoreAcceptAction=!0;try{i=this.ActiveTableInsertRowAfter(t.Rows.length);for(var o=0,s=0;s<t.Rows.length;s++)if(t.Rows[s].Cells){o=Math.min(e.ColCount,t.Rows[s].Cells.length);for(var r=0;r<o;r++)t.Rows[s].Cells[r].Text&&e.Rows[n+s][r].CellData&&(e.Rows[n+s][r].CellData.Items[0].Text=t.Rows[s].Cells[r].Text)}this.ActiveSection.ReFormatActiveItem()}finally{this.FIgnoreAcceptAction=!1}return i}},{key:"EffectiveItem",value:function(t,e,i){if(t.Visible||i){if(!(t.StyleNo>oo.Null))return!0;if(t.TraceStyles.has(jh.Del)&&!e);else if(""!==t.Text)return!0}else;return!1}},{key:"IsEmptyPage",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1,o=new Ks;return o.Tag=0,o.Invisible=!0,o.Areas.add(ql.Page),o.Process=function(o,s,r,a,l){return!!t.EffectiveItem(o.Items[s],e,i)&&(n=!0,!0)},this.TraverseItem(o),!n}},{key:"GetSectionPageDataLast",value:function(t,e){var i=new nt,n=this.Sections[t].Page,o=this.Sections[t].GetPageInfo(e).EndDrawItemNo,s=n.GetDrawItemFormatCoord(o),r=this.Sections[t].GetPageIndexByFormat(s.y);i.top=r!==e?0:s.y-this.Sections[t].GetPageDataFmtTop(e),n.GetDrawItemStyle(o)===oo.Table?i.bottom=n.Items[n.DrawItems[o].ItemNo].GetPageBreakHeight(e):i.bottom=n.DrawItems[o].rect.height;var a=this.Sections[t].GetPageMarginLeftAndRight(e);return i.left=a.left,i.right=a.left+s.x+n.DrawItems[o].rect.width,{left:i.right,top:i.top,height:i.bottom}}},{key:"GetProcDeItemText",value:function(t,e){return this.GetProcDeItemProperty(t,e,"Text")}},{key:"GetProcDeItemProperty",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=this.GetProcItemNo(t);return o.result?this.GetDeItemProperty(e,i,n,this.Sections[o.sectionIndex].Page,o.startNo,o.endNo):{result:!0,value:""}}},{key:"SetProcDeItemText",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.SetProcDeObjectProperty(t,e,"Text",i,n)}},{key:"SetProcDeItemPropertyByObj",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.SetProcDeObjectProperty(t,e,"object",i,n)}},{key:"SetProcDeObjectProperty",value:function(t,e,i,n){var o=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(""===t||0===this.FProcCount)return!1;var r=this.GetProcItemNo(t);if(!r.result)return!1;var a=!1,l=!1,h=-1,c=null;return this.GetDeObject((function(t,r){if(o.DeItemIndexMatch(t.Items[r],e))if(a=!0,1!==s){if(o.SetDataDeObjectProperty(t,r,i,n)&&(l=!0),0===s)return!0}else 1===s&&(h=r,c=t);return!1}),this.Sections[r.sectionIndex].Page,r.startNo,r.endNo),1===s&&h>=0&&null!==c&&this.SetDataDeObjectProperty(c,h,i,n)&&(l=!0),a&&l&&this.FormatData(),a}},{key:"SetProcDeItemValueDomain",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(""===t||0===this.FProcCount)return!1;var a=this.GetProcItemNo(t);if(!a.result)return!1;var l=!1,h=null,c=null;return this.GetDeObject((function(t,a){if(t.Items[a].StyleNo>oo.Null&&t.Items[a].Index==e){if(1!==r){if(t.Items[a].SetValueDomain(i,n,o,s),t.ItemChangeBy(a,0,rh.ContentChange),l=!0,t.isClass(Jl)&&t.OnFormatDirty(),0===r)return!0}else 1===r&&(h=t.Items[a],c=t);return!1}}),this.Sections[a.sectionIndex].Page,a.startNo,a.endNo),1===r&&null!==h&&null!==c&&(h.SetValueDomain(i,n,o,s),c.Change(),l=!0,c.isClass(Jl)&&c.OnFormatDirty()),l&&this.FormatData(),l}},{key:"GetProcDeGroupItemNo",value:function(t,e){var i=this.GetProcItemNo(t);if(!i.result)return{result:!1,sectionIndex:-1,data:null,startNo:-1,endNo:-1};var n=new zs,o=this.Sections[i.sectionIndex].Page;return this.GetDataDeGroupTree(e,o,i.startNo,i.endNo,n),0==n.Childs.count?{result:!1,sectionIndex:-1,data:null,startNo:-1,endNo:-1}:{result:!0,sectionIndex:i.sectionIndex,data:n.Childs[0].Data,startNo:n.Childs[0].BeginNo,endNo:n.Childs[0].EndNo}}},{key:"GetProcDeGroupAsText",value:function(t,e){var i=this.GetProcDeGroupItemNo(t,e);return i.result?this.GetDataDeGroupText(i.data,i.startNo,i.endNo):""}},{key:"GetProcDeGroupAsStream",value:function(t,e){var i=this.GetProcDeGroupItemNo(t,e);return i.result?this.GetDataDeGroupToStream(i.data,i.startNo,i.endNo):null}},{key:"GetAllProcIndex",value:function(){for(var t,e=new Array,i=0;i<this.Sections.count;i++){t=this.Sections[i].Page;for(var n=0;n<t.Items.count;n++)t.Items[n].StyleNo===oo.Domain&&t.Items[n].IsProcBegin&&e.push(t.Items[n].Index)}return e}},{key:"GetItemRangeProcInfo",value:function(t,e,i,n,o,s){var r=new Oc,a=null,l=new Array;if(this.GetProcInfoAt(this.Sections[t].Page,e,i,r),r.BeginNo<0)this.hcl.errorLog("GetItemRangeProcInfo获取起始病程失败！",!0);else{l.push({Index:r.Data.Items[r.BeginNo].Index,Changed:r.Data.Items[r.BeginNo].Changed?"1":"0",Propertys:Yl.GetPropertyJSON(r.Data.Items[r.BeginNo].Propertys)});for(var h=t+1;h<n;h++)for(var c=0,u=(a=this.Sections[h].Page).Items.count;c<u;c++)a.Items[c].StyleNo===oo.Domain&&a.Items[c].IsProcBegin&&l.push({Index:a.Items[c].Index,Changed:a.Items[c].Changed?"1":"0",Propertys:Yl.GetPropertyJSON(a.Items[c].Propertys)});this.GetProcInfoAt(this.Sections[n].Page,o,s,r),r.BeginNo<0?this.hcl.errorLog("GetItemRangeProcInfo获取结束病程失败！",!0):l.push({Index:r.Data.Items[r.BeginNo].Index,Changed:r.Data.Items[r.BeginNo].Changed?"1":"0",Propertys:Yl.GetPropertyJSON(r.Data.Items[r.BeginNo].Propertys)})}return r=null,l}},{key:"GetAllProcInfo",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=null,i="",n=new Array,o=0;o<this.Sections.count;o++)for(var s=0,r=(e=this.Sections[o].Page).Items.count;s<r;s++)if(e.Items[s].StyleNo===oo.Domain&&e.Items[s].IsProcBegin){if(i=e.Items[s].Changed?"1":"0",t&&"0"===i)continue;n.push({Index:e.Items[s].Index,Changed:i,Propertys:Yl.GetPropertyJSON(e.Items[s].Propertys)})}return n}},{key:"BatchUpdate",value:function(t){this.BeginUpdate();try{this.DisableUndo();try{this.BeginFormat();try{this.FStyle.States.Include(oh.BatchInsert);try{t()}finally{this.FStyle.States.Exclude(oh.BatchInsert)}}finally{this.EndFormat()}}finally{this.EnableUndo()}}finally{this.EndUpdate()}this.ClearUndo()}},{key:"InsertProc",value:function(t,e,i){var n,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(""==t)return console.log("InsertProc方法的procIndex参数为空"),!1;if(""!=i){var s=this.GetProcItemNo(i);if(!s.result)return console.log("InsertProc方法的未找到Index为"+i+"的病程！"),!1;s.sectionIndex!=this.ActiveSectionIndex&&(this.ActiveSectionIndex=s.sectionIndex),(n=this.ActiveSection.Page).SetSelectBound(s.startNo,0,s.startNo,0)}else(n=this.ActiveSectionTopLevelData().GetRootData()).SelectLastItemAfterWithCaret();var r=!1;if(this.ActiveSection.Page.equal(n)){var a=new Nc(this.hcl,n);if(a.SetValue(Yh.Index,t),a.SetValue(bc.SubType,Bc.Proc),""!=e)for(var l,h=e.split(Yl.sLineBreak),c=0;c<h.length;c++)""!=h[c].trim()&&""!=(l=h[c].split("="))[0]&&a.SetValue(l[0],l[1]);this.FIgnoreAcceptAction=!0;try{n.IsEmptyData()||(o?this.InsertPageBreak():this.InsertBreak()),""!=i&&n.SetSelectBound(n.SelectInfo.StartItemNo-1,0,n.SelectInfo.StartItemNo-1,0),this.ApplyParaAlignHorz(Ln.Left),r=this.InsertDeGroup(a);var u=n.SelectInfo.StartItemNo;n.SetSelectBound(u,0,u,0)}finally{this.FIgnoreAcceptAction=!1}this.FEditProcIndex=t,this.CheckProcInfo(),this.UpdateView()}else console.log("只能在正文中插入病程！");return r}},{key:"SetProcChanged",value:function(t,e){var i=this.GetProcItemNo(t);return i.result?(this.SetProcChangedBy(i.sectionIndex,i.startNo,i.endNo,e),!0):(this.DoSectionCanNotEditNotify("未找到ID为"+t+"的病程！"),!1)}},{key:"SetProcChangedBy",value:function(t,e,i,n){this.FSections[t].Page.Items[e].Changed=n,this.FSections[t].Page.Items[i].Changed=n}},{key:"DeleteProc",value:function(t){var e=this;if(""==t)return!1;var i=this.GetProcItemNo(t);if(i.result){this.BeginUpdate();try{var n=!1;this.DisableUndo();try{this.FIgnoreAcceptAction=!0;try{var o=this.Sections[i.sectionIndex].Page;n=this.Sections[i.sectionIndex].DataAction(o,(function(){return 0===i.startNo&&i.endNo===o.Items.count-1?o.Clear():(o.InitializeField(),o.DeleteItems(i.startNo,i.endNo,!1),e.FormatData()),!0}))}finally{this.FIgnoreAcceptAction=!1}this.ClearUndo()}finally{this.EnableUndo()}return this.CheckProcInfo(),n}finally{this.EndUpdate()}}return!1}},{key:"SetProcPageBreak",value:function(t,e){var i=this.GetProcItemNo(t);return i.result?(this.FSections[i.sectionIndex].Page.Items[i.startNo].PageBreak!==e&&(this.FSections[i.sectionIndex].Page.Items[i.startNo].PageBreak=e,this.SetProcChangedBy(i.sectionIndex,i.startNo,i.endNo,!0),this.IsChanged=!0,this.FormatData()),!0):(this.DoSectionCanNotEditNotify("未找到ID为"+t+"的病程！"),!1)}},{key:"MoveProc",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=null,o=-1,s=-1,r=-1,a=-1,l=-1,h=-1;if(""!=e){if(!(n=this.GetProcItemNo(e)).result)return this.DoSectionCanNotEditNotify("未找到ID为"+e+"的病程！"),!1;o=n.sectionIndex,s=n.startNo,r=n.endNo}if(!(n=this.GetProcItemNo(t)).result)return this.DoSectionCanNotEditNotify("未找到ID为"+t+"的病程！"),!1;a=n.sectionIndex,l=n.startNo,h=n.endNo,o<0?(o=a,s=this.Sections[a].Page.Items.count):i||(s=r+1);var c=this.Sections[o],u=this.Sections[a];u.Page.InitializeField();for(var f=new Array(h-l+1),d=h;d>=l;d--)f[h-d]=u.Page.Items[d];this.Style.States.Include(oh.MoveItem);try{for(var m=null,S=null,p=0;p<f.length;p++)m=f[p],(S=c.Page.CreateItemByStyle(m.StyleNo)).Assign(m),c.Page.Items.insert(s,S)}finally{this.Style.States.Exclude(oh.MoveItem)}return f.length=0,l>s?u.Page.Items.removeRange(l+(h-l+1),h-l+1):u.Page.Items.removeRange(l,h-l+1),this.FormatData(),!0}},{key:"ReFormatProc",value:function(t){if(""==t)return!1;var e=this.GetProcItemNo(t);return!!e.result&&(this.Sections[e.sectionIndex].Page.ReFormatItemRange(e.startNo,e.endNo),this.UpdateView(),!0)}},{key:"GetProcInfoAt",value:function(t,e,i,n){t.GetDomainFrom(e,i,n,(function(t){return t.IsProc})),n.EndNo>0&&(n.Index=t.Items[n.BeginNo].GetValue(bc.Index))}},{key:"SetProcDeGroupByStream",value:function(t,e,i){var n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=this.GetProcItemNo(t);if(a.result){var l=new zs;if(this.GetDataDeGroupTree(e,this.Sections[a.sectionIndex].Page,a.startNo,a.endNo,l),0==l.Childs.count)return!1;this.DisableUndo();try{this.DataLoadLiteStream(!0,i,(function(t,e){n.SetDeGroupTreeByStream(l,i,e,t,o,s,r)})),this.ClearUndo()}finally{this.EnableUndo()}return this.FormatSection(a.sectionIndex),Yl.PROCSERIES&&this.CheckProcInfo(),vRe}return a.result}},{key:"SetProcDeGroupByText",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=this.GetProcItemNo(t);if(s.result){var r=new zs;if(this.GetDataDeGroupTree(e,this.Sections[s.sectionIndex].Page,s.startNo,s.endNo,r),0==r.Childs.count)return!1;this.SetProcChangedBy(s.sectionIndex,s.startNo,s.endNo,!0),this.DisableUndo();try{this.SetDeGroupTreeByText(r,i,n,o),this.ClearUndo()}finally{this.EnableUndo()}this.FormatSection(s.sectionIndex),Yl.PROCSERIES&&this.CheckProcInfo()}return s.result}},{key:"SetProcDeGroupByObj",value:function(t,e,i){var n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=this.GetProcItemNo(t);if(a.result){var l=new zs;if(this.GetDataDeGroupTree(e,this.Sections[a.sectionIndex].Page,a.startNo,a.endNo,l),0==l.Childs.count)return!1;this.SetProcChangedBy(a.sectionIndex,a.startNo,a.endNo,!0);var h=!1;this.DisableUndo();try{var c=new ht;this.ObjToLiteStream(c,i.Items?i.Items:i),c.position=0,this.DataLoadLiteStream(!0,c,(function(t,e){h=n.SetDeGroupTreeByStream(l,c,e,t,o,s,r)})),c=null,this.ClearUndo()}finally{this.EnableUndo()}return this.FormatSection(a.sectionIndex),Yl.PROCSERIES&&this.CheckProcInfo(),h}return a.result}},{key:"ProcDeGroupAppendByObj",value:function(t,e,i){var n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=this.GetProcItemNo(t);if(l.result){if(this.EditProcIndex!==t)return this.hcl.falseReason("ProcDeGroupAppendByObj时病程不可编辑："+t);var h=new zs;if(this.GetDataDeGroupTree(e,this.Sections[l.sectionIndex].Page,l.startNo,l.endNo,h),0==h.Childs.count)return!1;this.SetProcChangedBy(l.sectionIndex,l.startNo,l.endNo,!0);var c=!1;this.DisableUndo();try{var u=new ht;this.ObjToLiteStream(u,i.Items?i.Items:i),u.position=0,this.DataLoadLiteStream(!0,u,(function(t,e){c=n.DeGroupTreeAppendByStream(h,u,e,t,o,s,r,a)})),u=null,this.ClearUndo()}finally{this.EnableUndo()}return this.FormatSection(l.sectionIndex),Yl.PROCSERIES&&this.CheckProcInfo(),c}return l.result}},{key:"GetProcItemByIndex",value:function(t,e){var i=this.GetProcItemNo(t);return i.result?this.GetItemByIndex(e,this.Sections[i.sectionIndex].Page,i.startNo,i.endNo):null}},{key:"GetProcSectionPageIndex",value:function(t){var e=this.GetProcItemNo(t);if(e.result){var i=this.FSections[e.sectionIndex];return{sectionIndex:e.sectionIndex,pageIndex:i.GetPageIndexByPageDataDrawItem(i.Page.Items[e.startNo].FirstDItemNo)}}return{sectionIndex:-1,pageIndex:-1}}},{key:"GetProcPageIndex",value:function(t){var e=this.GetProcSectionPageIndex(t);return e.pageIndex>=0?this.GetPageIndexBySectionPageIndex(e.sectionIndex,e.pageIndex):-1}},{key:"IsEmptyProc",value:function(t,e,i){var n=this,o=this.GetProcItemNo(t);if(!o.result)return!1;var s=!1,r=new Ks;r.Invisible=!0,r.SectionIndex=o.sectionIndex;var a=this.Sections[o.sectionIndex].Page;r.Process=function(t,o,r,a,l){if(n.EffectiveItem(t.Items[o],e,i))return s=!0,!0};for(var l=o.startNo+1;l<o.endNo;l++)r.Stop=r.Process(a,l,r.Tag,r.domainStack,r.Stop),r.Stop||a.Items[l].StyleNo<oo.Null&&a.Items[l].TraverseItem(r);return!s}},{key:"DoMergeFileInsertItem",value:function(t,e,i){this.MergeBatch2&&(i.ParaNo=this.FMergeStyle.ParaStyles[i.ParaNo].TempNo,i.StyleNo>oo.Null?i.StyleNo=this.FMergeStyle.TextStyles[i.StyleNo].TempNo:i.isClass(hs)?i.TextStyleNo=this.FMergeStyle.TextStyles[i.TextStyleNo].TempNo:i.StyleNo===oo.Domain&&(i.TextStyleNo=this.FMergeStyle.TextStyles[i.TextStyleNo].TempNo,i.TitleStyleNo=this.FMergeStyle.TextStyles[i.TitleStyleNo].TempNo))}},{key:"MergeProc2",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.MergeBatch2=!0,this.BatchUpdate((function(){var n=e.ActiveSection,s=e.ActiveSection.Page;e.FMergeStyle=new oo(e.hcl);var r=null,a=null,l=-1;e.MergeFile=!0;try{s.Items.clear();for(var h=function(h){if(t[h].ST!==Yl.HC_STREAM_VIEW)return console.error("hcl错误：合并病程文件，暂时只支持文件流！"),"break";h>0&&t[h].SectionBreak&&(n=new e.NewDefaultSection,s=n.Page,e.FSections.add(n),e.ActiveSectionIndex=e.FSections.count-1);var c=new ht(t[h].Bytes);e.DoLoadFromStream(!1,c,e.FMergeStyle,(function(i){for(var u=0;u<e.FMergeStyle.TextStyles.count;u++)l=e.FStyle.GetStyleNo(e.FMergeStyle.TextStyles[u],!0),e.FMergeStyle.TextStyles[u].TempNo=l;for(var f=0;f<e.FMergeStyle.ParaStyles.count;f++)l=e.FStyle.GetParaNo(e.FMergeStyle.ParaStyles[f],!0),e.FMergeStyle.ParaStyles[f].TempNo=l;var d=c.readByte();if(0===e.FProcCount||t[h].SectionBreak){var m=c.position;if(n.SeekStreamToArea(c,e.FMergeStyle,i,ql.Header,!0),c.readInt64(),i>63&&c.readByte(),n.Header.Items.clear(),n.Header.ParseDataStream(c,e.FMergeStyle,i,(function(t,e,i){return n.Header.Items.add(i),{result:!0,stop:!1}})),0===n.Header.Items.count){var S=n.Header.CreateDefaultTextItem();S.ParaFirst=!0,n.Header.Items.add(S)}if(c.position=m,n.SeekStreamToArea(c,e.FMergeStyle,i,ql.Footer,!1),c.readInt64(),i>63&&c.readByte(),n.Footer.Items.clear(),n.Footer.ParseDataStream(c,e.FMergeStyle,i,(function(t,e,i){return n.Footer.Items.add(i),{result:!0,stop:!1}})),0===n.Footer.Items.count){var p=n.Footer.CreateDefaultTextItem();p.ParaFirst=!0,n.Footer.Items.add(p)}n.CalcDataFormatSize(),c.position=m}(r=new Nc(e.hcl,s)).TitleStyleNo=0,r.TextStyleNo=0,r.MarkType=ch.Beg,t[h].Propertys&&("object"===o()(t[h].Propertys)?Yl.SetPropertyJSON(r.Propertys,t[h].Propertys):""!==t[h].Propertys&&Yl.SetPropertyString(t[h].Propertys,r.Propertys)),r.SetValue(Yh.Index,t[h].Index),r.SetValue(bc.SubType,Bc.Proc),(a=new Nc(e.hcl,s)).Assign(r),a.MarkType=ch.End,s.Items.add(r);for(var y=function(o){o>0&&(c.position+=16),n.SeekStreamToArea(c,e.FMergeStyle,i,ql.Page)&&s.ParseDataStream(c,e.FMergeStyle,i,(function(e,i,n){if(s.Items.add(n),0===e)if(0===o){if(r.ParaFirst=n.ParaFirst,r.PageBreak=n.PageBreak||t[h].PageBreak,r.ParaNo=n.ParaNo,n.StyleNo>oo.Null&&(r.TitleStyleNo=n.StyleNo,r.TextStyleNo=n.StyleNo),n.ParaFirst&&n.StyleNo>oo.Null&&""===n.Text)return{result:!1,stop:!1};n.ParaFirst=!1,n.PageBreak=!1}else n.PageBreak=!0;else e===i-1&&(a.ParaNo=n.ParaNo,n.StyleNo>oo.Null&&(a.TitleStyleNo=n.StyleNo,a.TextStyleNo=n.StyleNo));return{result:!0,stop:!1}}))},F=0;F<d;F++)y(F);s.Items.add(a)})),null!==i&&i(t[h].Index,h)},c=0;c<t.length;c++){if("break"===h(c))break}e.FMergeStyle.dispose(),e.FMergeStyle=null}finally{e.MergeFile=!1}}))}},{key:"MergeProc",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.MergeBatch2=!1,this.BatchUpdate((function(){var n=e.ActiveSection,s=e.ActiveSection.Page,r=new oo(e.hcl),a=null,l=null;e.MergeFile=!0;try{e.FStyle.States.Include(oh.Loading),s.Items.clear();for(var h=function(h){if(t[h].ST!==Yl.HC_STREAM_VIEW)return console.error("hcl错误：合并病程文件，暂时只支持文件流！"),"break";h>0&&t[h].SectionBreak&&(n=new e.NewDefaultSection,s=n.Page,e.FSections.add(n),e.ActiveSectionIndex=e.FSections.count-1);var c=new ht(t[h].Bytes);e.DoLoadFromStream(!0,c,r,(function(i){var u=c.readByte();if(0===e.FProcCount||t[h].SectionBreak){var f=c.position;if(n.SeekStreamToArea(c,r,i,ql.Header,!0),c.readInt64(),i>63&&c.readByte(),n.Header.Items.clear(),n.Header.ParseDataStream(c,r,i,(function(t,e,i){return n.Header.Items.add(i),{result:!0,stop:!1}})),0===n.Header.Items.count){var d=n.Header.CreateDefaultTextItem();d.ParaFirst=!0,n.Header.Items.add(d)}if(c.position=f,n.SeekStreamToArea(c,r,i,ql.Footer,!1),c.readInt64(),i>63&&c.readByte(),n.Footer.Items.clear(),n.Footer.ParseDataStream(c,r,i,(function(t,e,i){return n.Footer.Items.add(i),{result:!0,stop:!1}})),0===n.Footer.Items.count){var m=n.Footer.CreateDefaultTextItem();m.ParaFirst=!0,n.Footer.Items.add(m)}n.CalcDataFormatSize(),c.position=f}(a=new Nc(e.hcl,s)).MarkType=ch.Beg,t[h].Propertys&&("object"===o()(t[h].Propertys)?Yl.SetPropertyJSON(a.Propertys,t[h].Propertys):""!==t[h].Propertys&&Yl.SetPropertyString(t[h].Propertys,a.Propertys)),a.SetValue(Yh.Index,t[h].Index),a.SetValue(bc.SubType,Bc.Proc),(l=new Nc(e.hcl,s)).Assign(a),l.MarkType=ch.End,s.Items.add(a);for(var S=function(e){e>0&&(c.position+=16),n.SeekStreamToArea(c,r,i,ql.Page)&&s.ParseDataStream(c,r,i,(function(i,n,o){if(0===i)if(0===e){if(a.ParaFirst=o.ParaFirst,a.PageBreak=o.PageBreak||t[h].PageBreak,a.ParaNo=o.ParaNo,o.StyleNo>oo.Null&&(a.TitleStyleNo=o.StyleNo,a.TextStyleNo=o.StyleNo),o.ParaFirst&&o.StyleNo>oo.Null&&""===o.Text)return{result:!1,stop:!1};o.ParaFirst=!1,o.PageBreak=!1}else o.PageBreak=!0;else i===n-1&&(l.ParaNo=o.ParaNo,o.StyleNo>oo.Null&&(l.TitleStyleNo=o.StyleNo,l.TextStyleNo=o.StyleNo));return s.Items.add(o),{result:!0,stop:!1}}))},p=0;p<u;p++)S(p);s.Items.add(l)})),null!==i&&i(t[h].Index,h)},c=0;c<t.length;c++){if("break"===h(c))break}}finally{e.FStyle.States.Exclude(oh.Loading),r.dispose(),r=null,e.MergeFile=!1}}))}},{key:"GetCaretProcProperty",value:function(t,e){if(this.FCaretProcInfo.EndNo>0){if(t==bc.Index)return this.FCaretProcInfo.Index;var i=this.ActiveSection.Page.Items[this.FCaretProcInfo.BeginNo];return t==bc.Propertys?"json"==e?Yl.GetPropertyJSON(i.Propertys):Yl.GetPropertyString(i.Propertys,Yl.RecordSeparator,Yl.UnitSeparator):i.GetValue(t)}return""}},{key:"GetProcProperty",value:function(t,e,i){var n=this.GetProcItemNo(t);if(n.result){var o=this.Sections[n.sectionIndex].Page.Items[n.startNo];if(e===bc.Propertys){if("json"===i){var s=Yl.GetPropertyJSON(o.Propertys);return s.Changed=o.Changed?"1":"0",s.PageBreak=o.PageBreak?"1":"0",s}var r=Yl.GetPropertyString(o.Propertys,Yl.RecordSeparator,Yl.UnitSeparator);return o.Changed?r+="Changed"+Yl.RecordSeparator+'"1"'+Yl.UnitSeparator:r+="Changed"+Yl.RecordSeparator+'"0"'+Yl.UnitSeparator,o.PageBreak?r+="PageBreak"+Yl.RecordSeparator+'"1"'+Yl.UnitSeparator:r+="PageBreak"+Yl.RecordSeparator+'"0"'+Yl.UnitSeparator,r}return"Changed"===e?o.Changed?"1":"0":"PageBreak"===e?o.PageBreak?"1":"0":o.GetValue(e)}return""}},{key:"SetProcProperty",value:function(t,e,i){var n=this.GetProcItemNo(t);if(n.result){var o=this.Sections[n.sectionIndex].Page.Items[n.startNo],s=this.Sections[n.sectionIndex].Page.Items[n.endNo];if(""!=e)"Changed"==e?(o.Changed="1"==i,s.Changed=o.Changed):"AllocValue"==e?(o.AllocValue="1"==i,s.AllocValue=o.AllocValue):"ReadOnly"==e?(o.ReadOnly="1"==i,s.ReadOnly=o.ReadOnly):(o.SetValue(e,i),s.SetValue(e,i),e===Yh.Index&&(this.FEditProcIndex===t&&(this.FEditProcIndex=i),this.FCaretProcInfo.Index===t&&(this.FCaretProcInfo.Index=i)));else if(e==bc.Propertys){var r,a=new rt;Yl.SetPropertyString(i,a);for(var l=0;l<a.count;l++)""!=(r=a[l]).key&&""!=r.val&&(o.SetValue(r.key,r.val),s.SetValue(r.key,r.val),r.key===Yh.Index&&(this.FEditProcIndex===t&&(this.FEditProcIndex=r.val),this.FCaretProcInfo.Index===t&&(this.FCaretProcInfo.Index=r.val)))}return!0}return!1}},{key:"GetProcAsText",value:function(t){var e=this.GetProcItemNo(t);return e.result?e.endNo==e.startNo+1?{result:!0,text:""}:{result:!0,text:this.GetDataDeGroupText(this.Sections[e.sectionIndex].Page,e.startNo,e.endNo)}:{result:!1,text:""}}},{key:"SetProcByText",value:function(t,e){if(this.CanNotEdit())return!1;var i=this.GetProcItemNo(t);if(i.result){this.BeginUpdate();try{this.UndoGroupBegin();try{var n=this.Sections[i.sectionIndex];n.Page.SetSelectBound(i.startNo,Yl.OffsetAfter,i.endNo,Yl.OffsetBefor),this.FIgnoreAcceptAction=!0;try{n.InsertText(e)}finally{this.FIgnoreAcceptAction=!1}return this.CheckProcInfo(),!0}finally{this.UndoGroupEnd()}}finally{this.EndUpdate()}}return!1}},{key:"GetProcAsStream",value:function(t,e){var i=this,n=this.GetProcItemNo(t);return!!n.result&&(this.DataSaveLiteStream(e,(function(){var t=i.Sections[n.sectionIndex],o=t.Page.Items[n.startNo].PageBreak,s=t.Page.Items[n.startNo].ParaFirst;s||(t.Page.Items[n.startNo].ParaFirst=!0),o&&(t.Page.Items[n.startNo].PageBreak=!1);try{t.Page.SaveItemToStream(e,n.startNo+1,0,n.endNo-1,t.Page.GetItemOffsetAfter(n.endNo-1))}finally{s||(t.Page.Items[n.startNo].ParaFirst=!1),o&&(t.Page.Items[n.startNo].PageBreak=!0)}})),!0)}},{key:"SetProcByStream",value:function(t,e){var i=this;if(this.CanNotEdit())return!1;var n=this.GetProcItemNo(t);return!!n.result&&(this.DataLoadLiteStream(!0,e,(function(t,o){i.BeginUpdate();try{i.UndoGroupBegin();try{var s=i.Sections[n.sectionIndex];s.Page.SetSelectBound(n.startNo,Yl.OffsetAfter,n.endNo,Yl.OffsetBefor),i.FIgnoreAcceptAction=!0;try{i.Style.States.Include(oh.DomainWholeReplace);try{s.InsertStream(e,o,t)}finally{i.Style.States.Exclude(oh.DomainWholeReplace)}}finally{i.FIgnoreAcceptAction=!1}}finally{i.UndoGroupEnd()}}finally{i.EndUpdate()}})),this.CheckProcInfo(),!0)}},{key:"SetProcByFileSteam",value:function(t,e){var i=this.GetProcItemNo(t);if(i.result){this.ActiveSectionIndex!=i.sectionIndex&&(this.ActiveSectionIndex=i.sectionIndex),this.Sections[i.sectionIndex].Page.SetSelectBound(i.startNo,Yl.OffsetAfter,i.endNo,Yl.OffsetBefor),this.FIgnoreAcceptAction=!0;try{this.Style.States.Include(oh.DomainWholeReplace);try{this.InsertStream(e)}finally{this.Style.States.Exclude(oh.DomainWholeReplace)}}finally{this.FIgnoreAcceptAction=!1}return this.CheckProcInfo(),!0}return!1}},{key:"GetProcAsJSONString",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.GetProcItemNo(t);if(!n.result)return"";var o=n.data.Items[n.startNo].ToJSONString(e);return i&&(o+=',"InnerText":'+JSON.stringify(this.GetProcAsText(t).text)),o+=","+n.data.ToJSONStringRange(n.startNo+1,n.endNo-1,e,i)}},{key:"GetProcAsJSONObject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.GetProcAsJSONString(t,e,i);return JSON.parse("{"+n+"}")}},{key:"GetDeGroupAsJSONString",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.GetDeGroupItemNo(t);if(!n.result)return"";var o=n.data.Items[n.startNo].ToJSONString(e);return i&&(o+=',"InnerText":'+JSON.stringify(n.data.GetDomainTextBy(n.startNo))),o+=","+n.data.ToJSONStringRange(n.startNo+1,n.endNo-1,e,i)}},{key:"GetDeGroupAsJSONObject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.GetDeGroupAsJSONString(t,e,i);return JSON.parse("{"+n+"}")}},{key:"ToJSONString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r='"Propertys":{'+Yl.GetPropertyJSONString(this.FPropertys,["_cp","_vr","_cv","_cvl"])+"},"+f()(F()(i.prototype),"ToJSONString",this).call(this,t,e,n,o,s);return r}},{key:"ToJSONObject",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=this.ToJSONString(t,e,i,n,o);return JSON.parse("{"+s+"}")}},{key:"DataItemSetCaretRequest",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.Items[e].isClass(hs)?(t.Items[e].SetSelect(0),t.ItemSetCaretRequest(e,Yl.OffsetInner)):t.ItemSetCaretRequest(e,i)}},{key:"ScrollToProc",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(""==t)return!1;var i=-1,n=-1;if(t===this.FEditProcIndex)i=this.FEditProcInfo.BeginNo,n=this.FEditProcInfo.SectionIndex;else{var o=this.GetProcItemNo(t);i=o.startNo,n=o.sectionIndex}if(i>=0){var s=this.Sections[n].Page,r=s.DrawItems[s.Items[i].FirstDItemNo].rect.top;return r=this.Sections[n].PageDataFormtToFilmCoord(r),r=Math.round((r+this.GetSectionTopFilm(n))*this.FZoom),(this.FVScrollBar.position>r||this.FVScrollBar.position+this.FViewHeight<r)&&(this.FVScrollBar.position=r),e&&s.ItemSetCaretRequest(i,Yl.OffsetAfter),!0}return!1}},{key:"ScrollToProcItemByIndex",value:function(t,e){var i=this,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(""==t)return!1;var r=-1,a=-1,l=-1;if(t==this.FEditProcIndex)r=this.FEditProcInfo.BeginNo,a=this.FEditProcInfo.EndNo,l=this.FEditProcInfo.SectionIndex;else{var h=this.GetProcItemNo(t);r=h.startNo,a=h.endNo,l=h.sectionIndex}if(r>=0){var c=-1;if(this.GetDeObject((function(t,r){return!!i.DeItemIndexMatch(t.Items[r],e)&&(!(null!==s&&!s(t,r))&&(c=t.GetDrawItemFormatCoord(t.Items[r].FirstDItemNo).y,n&&(o<0?i.DataItemSetCaretRequest(t,r,t.GetItemOffsetAfter(r)):i.DataItemSetCaretRequest(t,r,o)),!0))}),this.Sections[l].Page,r,a),c>=0)return c=this.Sections[l].PageDataFormtToFilmCoord(c),c=Math.round((c+this.GetSectionTopFilm(l))*this.FZoom),(this.FVScrollBar.position>c||this.FVScrollBar.position+this.FViewHeight<c)&&(this.FVScrollBar.position=c),!0}return!1}},{key:"ScrollToItem",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=-1,s=-1,r=new Ks;return r.Areas.add(ql.Page),r.Process=function(a,l,h,c,u){if(a.Items[l]===t)return o=a.GetDrawItemFormatCoord(a.Items[l].FirstDItemNo).y,s=r.SectionIndex,i&&e.DataItemSetCaretRequest(a,l,n),!0},this.TraverseItem(r),o>=0&&(o=this.Sections[s].PageDataFormtToFilmCoord(o),o=Math.round((o+this.GetSectionTopFilm(s))*this.FZoom),(this.FVScrollBar.position>o||this.FVScrollBar.position+this.FViewHeight<o)&&(this.FVScrollBar.position=o),!0)}},{key:"ScrollToItemByIndex",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=-1,r=-1,a=new Ks;return a.Areas.add(ql.Page),a.Process=function(l,h,c,u,f){if(e.DeItemIndexMatch(l.Items[h],t))return!(null!==o&&!o(l,h))&&(s=l.GetDrawItemFormatCoord(l.Items[h].FirstDItemNo).y,r=a.SectionIndex,i&&(n<0?e.DataItemSetCaretRequest(l,h,l.GetItemOffsetAfter(h)):e.DataItemSetCaretRequest(l,h,n)),!0)},this.TraverseItem(a),s>=0&&(s=this.Sections[r].PageDataFormtToFilmCoord(s),s=Math.round((s+this.GetSectionTopFilm(r))*this.FZoom),(this.FVScrollBar.position>s||this.FVScrollBar.position+this.FViewHeight<s)&&(this.FVScrollBar.position=s),!0)}},{key:"CaretToDeItemByIndex",value:function(t){return this.ScrollToItemByIndex(t,!0,0,null)}},{key:"ScrollToDeGroupByIndex",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.ScrollToItemByIndex(t,e,Yl.OffsetAfter,i)}},{key:"DeleteAllProcMark",value:function(){var t=this.ActiveSection.Page;this.BeginUpdate();try{t.BeginFormat();try{for(var e,i=t.Items.count-1;i>=0;i--)t.Items[i].StyleNo==oo.Domain&&(e=t.Items[i]).IsProc&&(e.IsProcEnd||i<t.Items.count-1&&(t.Items[i+1].ParaFirst=!0,t.Items[i+1].PageBreak=e.PageBreak),t.Items.delete(i))}finally{t.EndFormat(!1)}this.FormatData()}finally{this.EndUpdate()}}},{key:"SetEditProcIndex",value:function(t){if(this.FEditProcIndex!=t){if(this.FEditProcIndex=t,this.CheckEditProcInfo(),this.FEditProcInfo.BeginNo>=0){var e=this.FEditProcInfo.Data.SelectInfo.StartItemNo;(e<this.FEditProcInfo.BeginNo||e>this.FEditProcInfo.EndNo)&&this.FEditProcInfo.Data.ItemSetCaretRequest(this.FEditProcInfo.BeginNo,Yl.OffsetAfter)}else this.hcl.warnLog("SetEditProcIndex当前病历中没有Index为 "+t+" 的病程！");this.ClearUndo(),this.UpdateView()}}},{key:"GetProcItemNo",value:function(t){for(var e,i=!1,n=-1,o=-1,s=-1,r=0;r<this.Sections.count&&!(n>=0);r++){e=this.Sections[r].Page;for(var a=0;a<e.Items.count;a++)if(e.Items[a].StyleNo===oo.Domain&&e.Items[a].GetValue(Yh.Index)===t){n=r,o=a;break}}return o>=0&&(i=(s=e.GetDomainAnother(o))>=0),{sectionIndex:n,data:e,startNo:o,endNo:s,result:i}}},{key:"CheckCaretProcInfo",value:function(){this.GetSectionCaretProcInfo(this.ActiveSectionIndex,this.FCaretProcInfo)}},{key:"CheckEditProcInfo",value:function(){this.FEditProcInfo.Clear();var t=this.GetProcItemNo(this.FEditProcIndex);t.endNo>0&&(this.ActiveSectionIndex!==t.sectionIndex&&(this.ActiveSectionIndex=t.sectionIndex),this.FEditProcInfo.SectionIndex=t.sectionIndex,this.FEditProcInfo.Data=this.Sections[t.sectionIndex].Page,this.FEditProcInfo.BeginNo=t.startNo,this.FEditProcInfo.EndNo=t.endNo,this.FEditProcInfo.Index=this.FEditProcIndex)}},{key:"CheckProcInfo",value:function(){this.CheckCaretProcInfo(),this.FCaretProcInfo.Index===this.FEditProcIndex?this.FEditProcInfo.Assign(this.FCaretProcInfo):this.CheckEditProcInfo()}},{key:"GetSectionCaretProcInfo",value:function(t,e){var i=this.Sections[t].Page;this.GetProcInfoAt(i,i.SelectInfo.StartItemNo,i.SelectInfo.StartItemOffset,e),e.SectionIndex=t}},{key:"GetSelectCoord",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e={result:!1,x:0,y:0};if(this.ActiveSection.SelectExists()){var i=this.ActiveSectionTopLevelData(),n=0;if(t)n=i.GetSelectStartDrawItemNo();else if((n=i.GetSelectEndDrawItemNo())<0){var o=i.Items[i.SelectInfo.StartItemNo];o.StyleNo<oo.Null&&o.IsSelectComplateTheory&&(n=i.Items[i.SelectInfo.StartItemNo].FirstDItemNo)}if(n<0)return e;var s=i.GetDrawItemFormatCoord(n);if(s=this.GetFormatPointToViewCoord(s),t)e.x=s.x+this.ZoomIn(i.GetDrawItemOffsetWidth(n,i.SelectInfo.StartItemOffset));else{var r=i.Items[i.DrawItems[n].ItemNo];r.StyleNo<oo.Null&&r.IsSelectComplateTheory?e.x=s.x+this.ZoomIn(i.GetDrawItemOffsetWidth(n,Yl.OffsetAfter)):e.x=s.x+this.ZoomIn(i.GetDrawItemOffsetWidth(n,i.SelectInfo.EndItemOffset-i.DrawItems[n].CharOffs+1))}e.y=s.y,e.result=!0}return e}},{key:"GetActiveAnnotateItem",value:function(){var t=this.ActiveSectionTopLevelData(),e=t.ActiveAnnotate;return null!=e?t.Items[e.EndNo]:null}},{key:"SetActiveItemExtra",value:function(t){var e=this;this.DataLoadLiteStream(!0,t,(function(i,n){e.BeginUpdate();try{e.UndoGroupBegin();try{var o=e.ActiveSectionTopLevelData(),s=o.SelectInfo.StartItemNo,r=0;s>0&&(s--,r=o.GetItemOffsetAfter(s)),e.DeleteActiveDataItems(o.SelectInfo.StartItemNo),e.ActiveSection.InsertStream(t,n,i),o.ItemSetCaretRequest(s,r)}finally{e.UndoGroupEnd()}}finally{e.EndUpdate()}}))}},{key:"SetActiveTableRowReadOnly",value:function(t){var e=this.ActiveSection.ActiveData.GetActiveRectItem();if(null!=e&&e.StyleNo==oo.Table){var i=e.GetEditCellWith();i.row>=0&&e.SetRowReadOnly(i.row,t)}}},{key:"SetActiveTableCellReadOnly",value:function(t){var e=this.ActiveSection.ActiveData.GetActiveRectItem();if(null!=e&&e.StyleNo==oo.Table){var i=e.GetEditCellWith();i.row>=0&&e.SetCellReadOnly(i.row,i.col,t)}}},{key:"CheckDeGroupStart",value:function(t,e,i){var n=!1;if(t.Items[e].StyleNo===oo.Domain){var o=t.Items[e];n=o.MarkType===ch.Beg&&o.GetValue(Yh.Index)===i}return n}},{key:"CheckDeGroupEnd",value:function(t,e,i){var n=!1;if(t.Items[e].StyleNo===oo.Domain){var o=t.Items[e];n=o.MarkType===ch.End&&o.GetValue(Yh.Index)===i}return n}},{key:"GetDataDeGroupItemNo",value:function(t,e,i,n,o){o=-1;var s=-1,r=-1,a=!1;if(n<0&&(n=0),i){for(var l=n;l>=0;l--)if(this.CheckDeGroupEnd(t,l,e)){r=l;break}if(r>=0)for(var h=r-1;h>=0;h--)if(this.CheckDeGroupStart(t,h,e)){s=h;break}}else{for(var c=n;c<t.Items.count;c++)if(this.CheckDeGroupStart(t,c,e)){s=c;break}if(s>=0)for(var u=s+1;u<t.Items.count;u++)if(this.CheckDeGroupEnd(t,u,e)){r=u;break}}return s>=0&&r>=0?(n=s,o=r,a=!0):n=-1,{result:a,startNo:n,endNo:o}}},{key:"GetDataDeGroupText",value:function(t,e,i){for(var n="",o=e+1;o<i;o++)if(t.Items[o].Visible&&(null==t.OnSaveItem||t.OnSaveItem(t,o))){if(t.Items[o].StyleNo>oo.Null){if(t.Items[o].TraceStyles.has(jh.Del))continue;if(t.Items[o].IsElement&&!t.Items[o].AllocValue)continue}t.Items[o].ParaFirst?n+=Yl.sLineBreak+t.Items[o].TextEffective():n+=t.Items[o].TextEffective()}return t.Items[i].ParaFirst&&(n+=Yl.sLineBreak),n}},{key:"GetDeGroupAsText",value:function(t){var e=this.GetDeGroupItemNo(t);return e.result?this.GetDataDeGroupText(e.data,e.startNo,e.endNo):""}},{key:"GetDeGroupAsStream",value:function(t){var e=this.GetDeGroupItemNo(t);return e.result?this.GetDataDeGroupToStream(e.data,e.startNo,e.endNo):null}},{key:"GetDataForwardDeGroupText",value:function(t,e){var i="",n=e,o=-1,s=t.Items[e].GetValue(Yh.Index),r=this.GetDataDeGroupItemNo(t,s,!0,n,o);return n=r.startNo,(o=r.endNo)>0&&(i=this.GetDataDeGroupText(t,n,o)),i}},{key:"SetDeGroupTreeByText",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(0==t.Childs.count)return!1;var o=this.ActiveSectionTopLevelData(),s=o.ActiveDomain.BeginNo,r=!1;this.FIgnoreAcceptAction=!0;try{this.Style.States.Include(oh.DomainWholeReplace);try{var a,l=!0;if(0==i)a=t.Childs[0],n&&(l=n(a.Data,a.BeginNo,a.EndNo)),l&&(a.Data.ReplaceDomainByText(a.BeginNo,a.EndNo,e),o.equal(a.Data)&&s===a.BeginNo&&(r=!0));else if(1==i)a=t.Childs.last,n&&(l=n(a.Data,a.BeginNo,a.EndNo)),l&&(a.Data.ReplaceDomainByText(a.BeginNo,a.EndNo,e),o.equal(a.Data)&&s===a.BeginNo&&(r=!0));else for(var h=t.Childs.count-1;h>=0;h--)a=t.Childs[h],n&&(l=n(a.Data,a.BeginNo,a.EndNo)),l&&(a.Data.ReplaceDomainByText(a.BeginNo,a.EndNo,e),o.equal(a.Data)&&s===a.BeginNo&&(r=!0))}finally{this.Style.States.Exclude(oh.DomainWholeReplace)}}finally{this.FIgnoreAcceptAction=!1}return r&&o.ReSetSelectAndCaretByOffset(s,Yl.OffsetAfter),!0}},{key:"DeGroupTreeAppendByStream",value:function(t,e,i,n,o){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(0==t.Childs.count)return!1;this.FIgnoreAcceptAction=!0;try{this.Style.States.Include(oh.DomainWholeReplace);try{var a,l=!0;if(0==o)a=t.Childs[0],null!==s&&(l=s(a.Data,a.BeginNo,a.EndNo)),l&&(r?a.Data.ItemSetCaretRequest(a.EndNo,Yl.OffsetBefor):a.Data.ItemSetCaretRequest(a.BeginNo,Yl.OffsetAfter),a.Data.InsertStream(e,i,n));else if(1==o)a=t.Childs.last,null!==s&&(l=s(a.Data,a.BeginNo,a.EndNo)),l&&(r?a.Data.ItemSetCaretRequest(a.EndNo,Yl.OffsetBefor):a.Data.ItemSetCaretRequest(a.BeginNo,Yl.OffsetAfter),a.Data.InsertStream(e,i,n));else for(var h=e.position,c=t.Childs.count-1;c>=0;c--)e.position=h,a=t.Childs[c],null!==s&&(l=s(a.Data,a.BeginNo,a.EndNo)),l&&(r?a.Data.ItemSetCaretRequest(a.EndNo,Yl.OffsetBefor):a.Data.ItemSetCaretRequest(a.BeginNo,Yl.OffsetAfter),a.Data.InsertStream(e,i,n))}finally{this.Style.States.Exclude(oh.DomainWholeReplace)}}finally{this.FIgnoreAcceptAction=!1}return!0}},{key:"SetDeGroupTreeByStream",value:function(t,e,i,n,o){var s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(0==t.Childs.count)return!1;this.FIgnoreAcceptAction=!0;try{this.Style.States.Include(oh.DomainWholeReplace);try{var a,l=!0;if(0==o)a=t.Childs[0],null!==r&&(l=r(a.Data,a.BeginNo,a.EndNo)),l&&a.Data.ReplaceDomainByStream(e,i,n,a.BeginNo,a.EndNo,s);else if(1==o)a=t.Childs.last,null!==r&&(l=r(a.Data,a.BeginNo,a.EndNo)),l&&a.Data.ReplaceDomainByStream(e,i,n,a.BeginNo,a.EndNo,s);else for(var h=e.position,c=t.Childs.count-1;c>=0;c--)e.position=h,a=t.Childs[c],null!==r&&(l=r(a.Data,a.BeginNo,a.EndNo)),l&&a.Data.ReplaceDomainByStream(e,i,n,a.BeginNo,a.EndNo,s)}finally{this.Style.States.Exclude(oh.DomainWholeReplace)}}finally{this.FIgnoreAcceptAction=!1}return!0}},{key:"SetDeGroupVisible",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ql.Page,n=null,o=this.ActiveSectionIndex;switch(i){case ql.Header:n=this.Sections[o].Header;break;case ql.Page:n=this.Sections[o].Page;break;case ql.Footer:n=this.Sections[o].Footer}var s=-1,r=-1,a=this.GetDataDeGroupItemNo(n,t,!1,s,r);return!!a.result&&(n.SetDomainRangeVisible(a.startNo,a.endNo,e),this.ClearUndo(),this.FormatData(),!0)}},{key:"SetProcDeGroupVisible",value:function(t,e,i){var n=this.GetProcDeGroupItemNo(t,e);return!!n.result&&(n.data.SetDomainRangeVisible(n.startNo,n.endNo,i),this.ClearUndo(),this.FormatData(),!0)}},{key:"SetDataDeGroupInnerBytes",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=t.Items.indexOf(e),s=t.GetDomainAnother(o);this.DataLoadLiteStream(!0,i,(function(e,r){t.ReplaceDomainByStream(i,r,e,s,o,n)}))}},{key:"SetDataDeGroupText",value:function(t,e,i,n){var o=-1,s=i;i<0&&(s=t.GetDomainAnother(e)),s>e?o=e:(o=s,s=e),this.FIgnoreAcceptAction=!0;try{t.ReplaceDomainByText(o,s,n)}finally{this.FIgnoreAcceptAction=!1}Yl.PROCSERIES&&this.CheckProcInfo()}},{key:"SetDataDeGroupByText",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=new zs;if(this.GetDataDeGroupTree(e,t,0,t.Items.count-1,s),0!==s.Childs.count){this.DisableUndo();try{this.SetDeGroupTreeByText(s,i,n,o)&&t.ReFormat(),this.ClearUndo()}finally{this.EnableUndo()}s=null}else s=null}},{key:"SetDeGroupByTextEx",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ql.Page,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=i<0?this.ActiveSectionIndex:i;this.SetDeGroupByText(r,n,t,e,o,s)}},{key:"SetDeGroupByText",value:function(t,e,i,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if("string"==typeof n){var r=null;switch(e){case ql.Header:r=this.Sections[t].Header;break;case ql.Page:r=this.Sections[t].Page;break;case ql.Footer:r=this.Sections[t].Footer}var a=0,l=r.Items.count-1;if(Yl.PROCSERIES&&this.FProcCount>0&&e===ql.Page){if(""==this.FEditProcIndex)return;if(this.FEditProcInfo.SectionIndex!=t)return;a=this.FEditProcInfo.BeginNo,l=this.FEditProcInfo.EndNo,this.SetProcChangedBy(this.FEditProcInfo.SectionIndex,a,l,!0)}var h=new zs;if(this.GetDataDeGroupTree(i,r,a,l,h),0!=h.Childs.count){this.DisableUndo();try{this.SetDeGroupTreeByText(h,n,o,s),this.ClearUndo()}finally{this.EnableUndo()}h=null,this.FormatSection(t),Yl.PROCSERIES&&this.CheckProcInfo()}else h=null}}},{key:"SetActiveSectionDeGroupByStream",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.SetDeGroupByStream(this.ActiveSectionIndex,ql.Page,t,e,i,n,o)}},{key:"SetDeGroupByStream",value:function(t,e,i,n){var o=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=null;switch(e){case ql.Header:l=this.Sections[t].Header;break;case ql.Page:l=this.Sections[t].Page;break;case ql.Footer:l=this.Sections[t].Footer}var h=0,c=l.Items.count-1;if(Yl.PROCSERIES&&this.FProcCount>0&&e===ql.Page){if(""===this.FEditProcIndex)return;if(this.FEditProcInfo.SectionIndex!==t)return;h=this.FEditProcInfo.BeginNo,c=this.FEditProcInfo.EndNo,this.SetProcChangedBy(this.FEditProcInfo.SectionIndex,h,c,!0)}var u=new zs;if(this.GetDataDeGroupTree(i,l,h,c,u),0!=u.Childs.count){this.DisableUndo();try{this.DataLoadLiteStream(!0,n,(function(t,e){o.SetDeGroupTreeByStream(u,n,e,t,s,r,a)})),this.ClearUndo()}finally{this.EnableUndo()}this.FormatSection(t),Yl.PROCSERIES&&this.CheckProcInfo()}}},{key:"SetCaretToPageDeGroupStart",value:function(t){return this.SetCaretToDeGroupStart(t)}},{key:"SetCaretToDeGroupStart",value:function(t){var e=this.GetDeGroupItemNo(t);return e.result&&(e.data.ItemSetCaretRequest(e.startNo,Yl.OffsetAfter),Yl.PROCSERIES&&this.CheckCaretProcInfo()),e.result}},{key:"SaveTableCellDataToLiteStream",value:function(t,e,i,n){var o=!1;return this.DataSaveLiteStream(n,(function(){null!==t.Rows[e][i].CellData&&(t.Rows[e][i].CellData.SaveToStreamRangeAll(n),o=!0)})),o}},{key:"LoadTableCellDataFromLiteStream",value:function(t,e,i,n){var o=!1;if(null!==t.Rows[e][i].CellData){this.DisableUndo();try{this.DataLoadLiteStream(!0,n,(function(s,r){t.Rows[e][i].CellData.Clear(),t.Rows[e][i].CellData.InsertStream(n,r,s),t.Rows[e][i].CellData.FormatDirty(),o=!0})),this.ClearUndo()}finally{this.EnableUndo()}}return o}},{key:"SetDeGroupByFileStream",value:function(t,e,i,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=new Wu(this.hcl);r.LoadFromStream(n);var a=new ht;Yl._SaveFileFormatAndVersion(a),a.writeByte(Yl.HC_STREAM_LITE),r.Style.SaveToStream(a),r.ActiveSection.Page.SaveItemToStream(a,0,0,r.ActiveSection.Page.Items.count-1,r.ActiveSection.Page.GetItemOffsetAfter(r.ActiveSection.Page.Items.count-1)),a.position=0,this.SetDeGroupByStream(t,e,i,a,o,s)}},{key:"GetDataDeGroupToStream",value:function(t,e,i){var n=this,o=new ht;return this.DataSaveLiteStream(o,(function(){n.hcl.emrCommon.G_SaveTrace=!1;try{t.SaveItemToStream(o,e+1,0,i,Yl.OffsetBefor)}finally{n.hcl.emrCommon.G_SaveTrace=!0}})),o}},{key:"AppendDataDeGroupFromStream",value:function(t,e,i,n){var o=this,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];this.DataLoadLiteStream(!0,n,(function(r,a){o.FIgnoreAcceptAction=!0;try{o.BeginUpdate();try{o.DisableUndo();try{s?t.ItemSetCaretRequest(i,Yl.OffsetBefor):t.ItemSetCaretRequest(e,Yl.OffsetAfter),t.InsertStream(n,a,r),t.isClass(Jl)&&t.OnFormatDirty(),o.ClearUndo()}finally{o.EnableUndo()}o.FormatData()}finally{o.EndUpdate()}}finally{o.FIgnoreAcceptAction=!1}})),Yl.PROCSERIES&&this.CheckProcInfo()}},{key:"SetDataDeGroupFromStream",value:function(t,e,i,n){var o=this,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.DataLoadLiteStream(!0,n,(function(r,a){o.FIgnoreAcceptAction=!0;try{o.BeginUpdate();try{o.DisableUndo();try{t.ReplaceDomainByStream(n,a,r,e,i,s),o.ClearUndo()}finally{o.EnableUndo()}o.FormatData()}finally{o.EndUpdate()}}finally{o.FIgnoreAcceptAction=!1}})),Yl.PROCSERIES&&this.CheckProcInfo()}},{key:"SaveSelectToText",value:function(){return this.ActiveSectionTopLevelData().SaveSelectToText()}},{key:"SaveSelectToStream",value:function(t){var e=this;this.DataSaveLiteStream(t,(function(){e.Style.States.Include(oh.Copying);try{e.ActiveSectionTopLevelData().SaveSelectToStream(t)}finally{e.Style.States.Exclude(oh.Copying)}}))}},{key:"SaveSelectToFileStream",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=new Wu(this.hcl),n=new ht;if(e){i.Style.MergeStyle=!0;try{this.ActiveSection.Header.SaveToStream(n),n.position=0,i.ActiveSection.Header.LoadFromStream(n,this.Style,Yl.HC_FileVersionInt),n.clear(),this.ActiveSection.Footer.SaveToStream(n),n.position=0,i.ActiveSection.Footer.LoadFromStream(n,this.Style,Yl.HC_FileVersionInt)}finally{i.Style.MergeStyle=!1}}i.ActiveSection.AssignPaper(this.ActiveSection),this.ActiveSectionTopLevelData().SelectExists()&&(n.clear(),this.SaveSelectToStream(n),n.position=0,i.InsertLiteStream(n)),n=null,i.SaveToStream(t,!1),i=null}},{key:"SaveToLiteStream",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ql.Page,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.DataSaveLiteStream(t,(function(){var o=null;switch(i){case ql.Header:o=e.Sections[n].Header;break;case ql.Footer:o=e.Sections[n].Footer;break;default:o=e.Sections[n].Page}o.SaveToStreamRangeAll(t)}))}},{key:"LoadFromLiteStream",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ql.Page,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.DataLoadLiteStream(!0,t,(function(o,s){var r=null;switch(i){case ql.Header:r=e.Sections[n].Header;break;case ql.Footer:r=e.Sections[n].Footer;break;default:r=e.Sections[n].Page}e.ClearUndo(),e.DisableUndo(),e.BeginUpdate();try{try{r.BeginFormat();try{r.Clear(),r.InsertStream(t,s,o)}finally{r.EndFormat(!1)}}finally{e.EnableUndo()}e.FormatData()}finally{e.EndUpdate()}}))}},{key:"SaveToStreamNoTrace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.hcl.emrCommon.G_SaveTrace=!1;try{this.SaveToStream(t,e,i)}finally{this.hcl.emrCommon.G_SaveTrace=!0}}},{key:"RemoveTrace",value:function(){this.AcceptTrace(!0,!0)}},{key:"AcceptTrace",value:function(t,e){var i=this,n=null,o=!1,s=new Ks;if(s.Invisible=!0,s.ReverseOrder=!0,s.Areas.add(ql.Page),s.Areas.add(ql.Header),s.Areas.add(ql.Footer),s.Process=function(s,r,a,l,h){s.Items[r].StyleNo>oo.Null?0!==(n=s.Items[r]).TraceStyles.value&&(o=!0,e&&n.TraceStyles.has(jh.Del)?1===s.Items.count&&0===r?(n.DeleteProperty(Yh.TraceDel),n.DeleteProperty(Yh.TraceDelLevel),n.DeleteProperty(Yh.Trace),n.TraceStyles.value=0,n.ParaFirst=!0,n.Text="",i.FTraceCount>0&&(i.FTraceCount--,i.FTraceCountDel--,i.FTraceInfoAnnotate&&i.AnnotatePre.RemoveDataAnnotate(null))):(n.ParaFirst&&r<s.Items.count-1&&(s.Items[r+1].ParaFirst||(s.Items[r+1].ParaFirst=!0)),s.Items.delete(r)):t&&n.TraceStyles.has(jh.Add)&&(n.DeleteProperty(Yh.TraceAdd),n.DeleteProperty(Yh.TraceAddLevel),n.DeleteProperty(Yh.Trace),n.TraceStyles.value=0,i.FTraceCount>0&&(i.FTraceCount--,i.FTraceInfoAnnotate&&i.AnnotatePre.RemoveDataAnnotate(null)))):s.Items[r].isClass(Cs)&&s.Items[r].FormatDirty()},Yl.PROCSERIES&&this.FProcCount>0){if(""===this.FEditProcIndex)return;this.SetProcChangedBy(this.FEditProcInfo.SectionIndex,this.FEditProcInfo.BeginNo,this.FEditProcInfo.EndNo,!0),s.SectionIndex=this.FEditProcInfo.SectionIndex;for(var r=this.Sections[this.FEditProcInfo.SectionIndex].Page,a=this.FEditProcInfo.EndNo;a>=this.FEditProcInfo.BeginNo;a--)(r.Items[a].Visible||s.Invisible)&&(s.Stop=s.Process(r,a,s.Tag,s.domainStack,s.Stop),s.Stop||r.Items[a].StyleNo<oo.Null&&r.Items[a].TraverseItem(s))}else this.TraverseItem(s);o&&(this.ClearUndo(),this.FormatData())}},{key:"RemoveDisvisible",value:function(){var t=!1,e=new Ks;if(e.Invisible=!0,e.ReverseOrder=!0,e.Areas.add(ql.Page),e.Areas.add(ql.Header),e.Areas.add(ql.Footer),e.Process=function(e,i,n,o,s){e.Items[i].Visible||(t=!0,1===e.Items.count&&0===i?e.Items[i].StyleNo>oo.Null?e.Items[i].Text="":e.Clear():(e.Items[i].ParaFirst&&i<e.Items.count-1&&(e.Items[i+1].ParaFirst=!0),e.Items.delete(i)),e.isClass(Jl)&&e.FormatDirty())},Yl.PROCSERIES&&this.FProcCount>0){if(""===this.FEditProcIndex)return;this.SetProcChangedBy(this.FEditProcInfo.SectionIndex,this.FEditProcInfo.BeginNo,this.FEditProcInfo.EndNo,!0),e.SectionIndex=this.FEditProcInfo.SectionIndex;for(var i=this.Sections[this.FEditProcInfo.SectionIndex].Page,n=this.FEditProcInfo.EndNo;n>=this.FEditProcInfo.BeginNo;n--)(i.Items[n].Visible||e.Invisible)&&(e.Stop=e.Process(i,n,e.Tag,e.domainStack,e.Stop),e.Stop||i.Items[n].StyleNo<oo.Null&&i.Items[n].TraverseItem(e))}else this.TraverseItem(e);t&&(this.ClearUndo(),this.FormatData())}},{key:"SetAllItemVisible",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=null,s=new Ks;s.Invisible=!0,s.ReverseOrder=!0;var r=i;if(null==r)(r=new Set([])).add(ql.Header),r.add(ql.Footer),r.add(ql.Page);else if(0==r.size)return;s.Areas=r,s.Process=function(i,s,r,a,l){if((o=i.Items[s]).StyleNo>oo.Null&&o.Visible!==e&&0!==o.TraceStyles.value&&(e?(t.FTraceCount++,o.TraceStyles.has(jh.Del)&&t.FTraceCountDel++,t.FTraceInfoAnnotate&&t.AnnotatePre.InsertDataAnnotate(null)):t.FTraceCount>0&&(t.FTraceCount--,o.TraceStyles.has(jh.Del)&&t.FTraceCountDel--,t.FTraceInfoAnnotate&&t.AnnotatePre.RemoveDataAnnotate(null))),n&&n(i,s,o,a,e))return!0;o.Visible=e},this.TraverseItem(s),this.ClearUndo(),this.FormatData()}},{key:"HideActiveDeItem",value:function(){var t=this.ActiveSectionTopLevelData();t.GetActiveItem().Visible=!1,t.isClass(Jl)&&t.OnFormatDirty(),this.ClearUndo(),this.ActiveSection.ReFormatActiveItem()}},{key:"SetDeItemVisible",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;if(this.FProcCount>0)return this.SetProcDeItemVisible(this.EditProcIndex,t,e,n);var s=null;(o&ql.Header)===ql.Header&&(s=this.ActiveSection.Header),(o&ql.Footer)===ql.Footer&&(s=this.ActiveSection.Footer),(o&ql.Page)===ql.Page&&(s=this.ActiveSection.Page);var r=!1,a=null,l=null;return this.GetDeObject((function(o,s){if(i.DeItemIndexMatch(o.Items[s],t,!1)){if(1!==n){if(o.Items[s].Visible=e,o.Change(),r=!0,o.isClass(Jl)&&o.OnFormatDirty(),0===n)return!0}else 1===n&&(a=o.Items[s],l=o);return!1}}),s,-1,-1,!0,!0),1===n&&null!==a&&null!==l&&(a.Visible=e,l.Change(),r=!0,l.isClass(Jl)&&l.OnFormatDirty()),r&&(this.ClearUndo(),this.FormatData()),r}},{key:"SetProcDeItemVisible",value:function(t,e,i){var n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(""===t||0===this.FProcCount)return!1;var s=this.GetProcItemNo(t);if(!s.result)return!1;var r=!1,a=null,l=null;return this.GetDeObject((function(t,s){if(n.DeItemIndexMatch(t.Items[s],e)){if(1!==o){if(t.Items[s].Visible=i,t.Change(),r=!0,t.isClass(Jl)&&t.OnFormatDirty(),0===o)return!0}else 1===o&&(a=t.Items[s],l=t);return!1}}),this.Sections[s.sectionIndex].Page,s.startNo,s.endNo),1===o&&null!==a&&null!==l&&(a.Visible=i,l.Change(),r=!0,l.isClass(Jl)&&l.OnFormatDirty()),r&&(this.ClearUndo(),this.FormatData()),r}},{key:"HideActiveDeGroup",value:function(){var t=this.ActiveSectionTopLevelData(),e=t.ActiveDomain;return!(e.BeginNo<0)&&(t.SetDomainRangeVisible(e.BeginNo,e.EndNo,!1),this.ClearUndo(),this.FormatData(),!0)}},{key:"SyntaxCheck",value:function(){var t=this;if(null!=this.OnSyntaxCheck){var e=new Ks;e.Tag=0,e.Areas.add(ql.Page),e.Process=function(e,i,n,o,s){t.DoSyntaxCheck(e,i,n,o)},this.TraverseItem(e),e=null,this.UpdateView()}}},{key:"AdjustPageWidth",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=new Ks;n.Tag=0,0===arguments.length?(n.Areas.add(ql.Page),n.Areas.add(ql.Header),n.Areas.add(ql.Footer)):(t&&n.Areas.add(ql.Header),e&&n.Areas.add(ql.Footer),i&&n.Areas.add(ql.Page)),n.Process=function(t,e,i,n,o){switch(t.Items[e].StyleNo){case oo.Table:t.Items[e].AdjustWidth(!0);break;case oo.Line:t.Items[e].FirstDItemNo&&(t.Items[e].Width=t.Width)}},this.TraverseItem(n),this.FormatData()}},{key:"LoadFromStream",value:function(t){try{f()(F()(i.prototype),"LoadFromStream",this).call(this,t)}catch(t){throw alert("HCEmrView加载错误："+decodeURI(t.message)),t}}},{key:"DesignModeEx",get:function(){return this.FDesignMode},set:function(t){this.FDesignMode=t}},{key:"HideTrace",get:function(){return this.FHideTrace},set:function(t){this.SetHideTrace(t)}},{key:"Trace",get:function(){return this.FTrace},set:function(t){this.FTrace=t}},{key:"TraceInfoAnnotate",get:function(){return this.FTraceInfoAnnotate},set:function(t){if(this.FTraceInfoAnnotate!==t){if(this.FTraceInfoAnnotate=t,t){if(!this.FHideTrace)for(var e=0;e<this.FTraceCount;e++)this.AnnotatePre.InsertDataAnnotate(null)}else if(!this.FHideTrace)for(var i=0;i<this.FTraceCount;i++)this.AnnotatePre.RemoveDataAnnotate(null);this.Style.UpdateInfoRePaint(),this.MapChange()}}},{key:"TraceCount",get:function(){return this.FTraceCount}},{key:"TraceCountDel",get:function(){return this.FTraceCountDel}},{key:"ProcCount",get:function(){return this.FProcCount}},{key:"EditProcIndex",get:function(){return this.FEditProcIndex},set:function(t){this.SetEditProcIndex(t)}},{key:"ShowProcSplit",get:function(){return this.FShowProcSplit},set:function(t){this.FShowProcSplit=t}},{key:"UnEditProcBKColor",get:function(){return this.FUnEditProcBKColor},set:function(t){this.FUnEditProcBKColor=t}},{key:"PageBlankTip",get:function(){return this.FPageBlankTip},set:function(t){this.SetPageBlankTip(t)}},{key:"DeDoneColor",get:function(){return this.FDeDoneColor},set:function(t){this.FDeDoneColor=t}},{key:"DeUnDoneColor",get:function(){return this.FDeUnDoneColor},set:function(t){this.FDeUnDoneColor=t}},{key:"DeHotColor",get:function(){return this.FDeHotColor},set:function(t){this.FDeHotColor=t}},{key:"DeChangedColor",get:function(){return this.FDeChangedColor},set:function(t){this.FDeChangedColor=t}},{key:"IgnoreAcceptAction",get:function(){return this.FIgnoreAcceptAction},set:function(t){this.FIgnoreAcceptAction=t}}]),i}(Gu);function cf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var uf=function(t){m()(i,t);var e=cf(i);function i(t){var n;r()(this,i),(n=e.call(this,t,410,350)).caption="页面设置";var o=new Ki(t,"纸张");o.left=23,o.top=21,o.width=30,n.cbbPaper=new mn(t,""),n.cbbPaper.left=53,n.cbbPaper.top=16,n.cbbPaper.width=100,n.cbbPaper.static=!0,n.cbbPaper.onSelectedIndexChange=function(){var t=Yl.GetPaperSizeByName(n.cbbPaper.text);if(t==hh.Custom)n.edtWidth.readOnly=!1,n.edtHeight.readOnly=!1;else{var e=Yl.GetPaperSizeInfo(t);n.edtWidth.text=e.Width.toString(),n.edtHeight.text=e.Height.toString(),n.edtWidth.readOnly=!0,n.edtHeight.readOnly=!0}},n.cbbPaper.addItem("自定义"),n.cbbPaper.addItem("A3"),n.cbbPaper.addItem("A4"),n.cbbPaper.addItem("A5"),n.cbbPaper.addItem("B5"),n.cbbPaper.addItem("16K"),n.cbbPaper.itemIndex=-1;var s=new Ki(t,"宽(毫米)");s.left=170,s.top=21,s.width=52,n.edtWidth=new an(t),n.edtWidth.valueMask=sn,n.edtWidth.left=224,n.edtWidth.top=16,n.edtWidth.width=50;var a=new Ki(t,"高(毫米)");a.left=287,a.top=21,a.width=52,n.edtHeight=new an(t),n.edtHeight.valueMask=sn,n.edtHeight.left=340,n.edtHeight.top=16,n.edtHeight.width=50;var l=new Ki(t,"边距(毫米)");l.left=23,l.top=48,l.width=72,n.chkSymmetryMargin=new en(t,"对称边距显示"),n.chkSymmetryMargin.left=100,n.chkSymmetryMargin.top=47,n.chkSymmetryMargin.width=97,n.addControl(n.chkSymmetryMargin);var h=new Ki(t,"上(毫米)");h.left=43,h.top=79,h.width=52,n.edtTop=new an(t),n.edtTop.valueMask=sn,n.edtTop.left=100,n.edtTop.top=76,n.edtTop.width=50;var c=new Ki(t,"下(毫米)");c.left=170,c.top=79,c.width=52,n.edtBottom=new an(t),n.edtBottom.valueMask=sn,n.edtBottom.left=227,n.edtBottom.top=76,n.edtBottom.width=50;var u=new Ki(t,"左(毫米)");u.left=43,u.top=109,u.width=52,n.edtLeft=new an(t),n.edtLeft.valueMask=sn,n.edtLeft.left=100,n.edtLeft.top=106,n.edtLeft.width=50;var f=new Ki(t,"右(毫米)");f.left=170,f.top=109,f.width=52,n.edtRight=new an(t),n.edtRight.valueMask=sn,n.edtRight.left=227,n.edtRight.top=106,n.edtRight.width=50;var d=new Ki(t,"方向");d.left=23,d.top=146,d.width=30,n.cbbPaperOrientation=new mn(t,""),n.cbbPaperOrientation.left=53,n.cbbPaperOrientation.top=143,n.cbbPaperOrientation.width=100,n.cbbPaperOrientation.static=!0,n.cbbPaperOrientation.addItem("纵向"),n.cbbPaperOrientation.addItem("横向"),n.cbbPaperOrientation.itemIndex=0,n.chkPageNoVisible=new en(t,"显示页码"),n.chkPageNoVisible.left=23,n.chkPageNoVisible.top=183;var m=new Ki(t,"页码格式");m.left=125,m.top=186,m.width=52,n.cbbPageNoFmt=new mn(t,""),n.cbbPageNoFmt.left=180,n.cbbPageNoFmt.top=183,n.cbbPageNoFmt.width=125,n.cbbPageNoFmt.dropDownWidth=n.cbbPageNoFmt.width,n.cbbPageNoFmt.addItem("{0}/{1}"),n.cbbPageNoFmt.addItem("{0}"),n.cbbPageNoFmt.addItem("第{0}页/共{1}页"),n.cbbPageNoFmt.addItem("第{0}页"),n.edtPageNoOffset=new hn(t,"页码偏移(像素)","0"),n.edtPageNoOffset.left=80,n.edtPageNoOffset.top=212,n.edtPageNoOffset.width=128;var S=new Ki(t,"页码水平对齐");S.left=230,S.top=215,S.width=92,n.cbbPageNoHorAlign=new mn(t,""),n.cbbPageNoHorAlign.left=310,n.cbbPageNoHorAlign.top=212,n.cbbPageNoHorAlign.width=50,n.cbbPageNoHorAlign.static=!0,n.cbbPageNoHorAlign.addItem("左"),n.cbbPageNoHorAlign.addItem("居中"),n.cbbPageNoHorAlign.addItem("右"),n.cbbPageNoHorAlign.itemIndex=0,n.chkShowLineNo=new en(t,"显示行号"),n.chkShowLineNo.left=23,n.chkShowLineNo.top=240,n.chkShowUnderLine=new en(t,"显示下划线"),n.chkShowUnderLine.left=23,n.chkShowUnderLine.top=268,n.chkParaLastMark=new en(t,"显示换行符"),n.chkParaLastMark.left=125,n.chkParaLastMark.top=240,n.chkPrintTextBlack=new en(t,"打印时文本彩色转黑色"),n.chkPrintTextBlack.left=230,n.chkPrintTextBlack.top=240,n.chkShowLineActiveMark=new en(t,"显示当前编辑行指示符"),n.chkShowLineActiveMark.left=125,n.chkShowLineActiveMark.top=268,n.btnOk=new Ji(t,"确定"),n.btnOk.onClick=function(){n.modalResult=wh,n.close()},n.btnOk.left=Math.trunc((n.width-n.btnOk.width)/2),n.btnOk.top=n.clientArea.height-30,n.beginUpdate();try{n.addControl(o),n.addControl(n.cbbPaper),n.addControl(s),n.addControl(n.edtWidth),n.addControl(a),n.addControl(n.edtHeight),n.addControl(l),n.addControl(h),n.addControl(n.edtTop),n.addControl(c),n.addControl(n.edtBottom),n.addControl(u),n.addControl(n.edtLeft),n.addControl(f),n.addControl(n.edtRight),n.addControl(d),n.addControl(n.cbbPaperOrientation),n.addControl(n.chkPageNoVisible),n.addControl(m),n.addControl(n.cbbPageNoFmt),n.addControl(n.edtPageNoOffset),n.addControl(S),n.addControl(n.cbbPageNoHorAlign),n.addControl(n.chkShowUnderLine),n.addControl(n.chkShowLineNo),n.addControl(n.chkParaLastMark),n.addControl(n.chkShowLineActiveMark),n.addControl(n.chkPrintTextBlack),n.addControl(n.btnOk)}finally{n.endUpdate()}return n}return l()(i,[{key:"SetView",value:function(t){var e=this;this.beginUpdate();try{var i=t.ActiveSection;switch(this.cbbPaper.itemIndex=this.cbbPaper.itemIndexOf(Yl.GetPaperSizeName(i.PaperSize)),this.cbbPaper.itemIndex<0&&(this.cbbPaper.itemIndex=0),i.PaperOrientation==Ql.Portrait?(this.cbbPaperOrientation.itemIndex=0,this.edtWidth.text=L.stringFormatFloat(1,i.PaperWidth),this.edtHeight.text=L.stringFormatFloat(1,i.PaperHeight)):(this.cbbPaperOrientation.itemIndex=1,this.edtWidth.text=L.stringFormatFloat(1,i.PaperHeight),this.edtHeight.text=L.stringFormatFloat(1,i.PaperWidth)),this.edtTop.text=L.stringFormatFloat(1,i.PaperMarginTop),this.edtLeft.text=L.stringFormatFloat(1,i.PaperMarginLeft),this.edtRight.text=L.stringFormatFloat(1,i.PaperMarginRight),this.edtBottom.text=L.stringFormatFloat(1,i.PaperMarginBottom),this.cbbPageNoFmt.text=t.PageNoFormat,this.edtPageNoOffset.text=i.PageNoOffset,i.PageNoHorAlign){case as.Center:this.cbbPageNoHorAlign.itemIndex=1;break;case as.Right:this.cbbPageNoHorAlign.itemIndex=2;break;default:this.cbbPageNoHorAlign.itemIndex=0}this.chkSymmetryMargin.checked=i.SymmetryMargin,this.chkPageNoVisible.checked=i.PageNoVisible,this.chkParaLastMark.checked=t.Style.ShowParaLastMark,this.chkShowLineNo.checked=t.ShowLineNo,this.chkShowLineActiveMark.checked=t.ShowLineActiveMark,this.chkShowUnderLine.checked=t.ShowUnderLine,this.chkPrintTextBlack.checked=t.Style.PrintTextBlack,this.moveCenter()}finally{this.endUpdate()}this.showModal((function(){t.BeginUpdate();try{var i=t.ActiveSection,n=Yl.GetPaperSizeByName(e.cbbPaper.text);if(i.PaperSize=n,0==e.cbbPaperOrientation.itemIndex?i.PaperOrientation=Ql.Portrait:i.PaperOrientation=Ql.Landscape,n==hh.Custom)0==e.cbbPaperOrientation.itemIndex?(i.PaperWidth=parseFloat(e.edtWidth.text),i.PaperHeight=parseFloat(e.edtHeight.text)):(i.PaperWidth=parseFloat(e.edtHeight.text),i.PaperHeight=parseFloat(e.edtWidth.text));else{var o=Yl.GetPaperSizeInfo(n);0==e.cbbPaperOrientation.itemIndex?(i.PaperWidth=o.Width,i.PaperHeight=o.Height):(i.PaperWidth=o.Height,i.PaperHeight=o.Width)}switch(i.PaperMarginTop=parseFloat(e.edtTop.text),i.PaperMarginLeft=parseFloat(e.edtLeft.text),i.PaperMarginRight=parseFloat(e.edtRight.text),i.PaperMarginBottom=parseFloat(e.edtBottom.text),t.PageNoFormat=e.cbbPageNoFmt.text,i.PageNoOffset=L.parseIntDef(e.edtPageNoOffset.text,i.Footer.Height),e.edtPageNoOffset.text=i.PageNoOffset,e.cbbPageNoHorAlign.itemIndex){case 1:i.PageNoHorAlign=as.Center;break;case 2:i.PageNoHorAlign=as.Right;break;default:i.PageNoHorAlign=as.Left}i.SymmetryMargin=e.chkSymmetryMargin.checked,i.PageNoVisible=e.chkPageNoVisible.checked,t.Style.ShowParaLastMark=e.chkParaLastMark.checked,t.ShowLineNo=e.chkShowLineNo.checked,t.ShowLineActiveMark=e.chkShowLineActiveMark.checked,t.ShowUnderLine=e.chkShowUnderLine.checked,t.Style.PrintTextBlack=e.chkPrintTextBlack.checked,t.ResetActiveSectionMargin(),t.AdjustPageWidth()}finally{t.EndUpdate()}}))}}]),i}(Dh);function ff(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var df=function(t){m()(i,t);var e=ff(i);function i(t){var n;r()(this,i),(n=e.call(this,t,320,240)).caption="段落属性设置",n.FLineSapceMinChanged=!1;var o=new Ki(t,"行间距");o.left=28,o.top=16,o.width=40,n.cbbSpaceMode=new mn(t,""),n.cbbSpaceMode.static=!0,n.cbbSpaceMode.left=70,n.cbbSpaceMode.top=13,n.cbbSpaceMode.width=77,n.cbbSpaceMode.addItem("单倍"),n.cbbSpaceMode.addItem("1.15倍"),n.cbbSpaceMode.addItem("1.5倍"),n.cbbSpaceMode.addItem("2倍"),n.cbbSpaceMode.addItem("最小值"),n.cbbSpaceMode.addItem("固定值"),n.cbbSpaceMode.addItem("多倍"),n.cbbSpaceMode.onSelectedIndexChange=function(){n._spaceModeChange()},n.edtLineSpace=new on(t,"10"),n.edtLineSpace.left=168,n.edtLineSpace.top=13,n.edtLineSpace.width=88,n.lblUnit=new Ki(t,"磅"),n.lblUnit.left=262,n.lblUnit.top=16,n.lblUnit.width=12;var s=new Ki(t,"水平对齐");s.left=16,s.top=43,s.width=52,n.cbbAlignHorz=new mn(t,""),n.cbbAlignHorz.static=!0,n.cbbAlignHorz.left=70,n.cbbAlignHorz.top=40,n.cbbAlignHorz.width=77,n.cbbAlignHorz.addItem("左"),n.cbbAlignHorz.addItem("居中"),n.cbbAlignHorz.addItem("右"),n.cbbAlignHorz.addItem("两端"),n.cbbAlignHorz.addItem("分散");var a=new Ki(t,"垂直对齐");a.left=165,a.top=43,a.width=52,n.cbbAlignVert=new mn(t,""),n.cbbAlignVert.static=!0,n.cbbAlignVert.left=219,n.cbbAlignVert.top=40,n.cbbAlignVert.width=67,n.cbbAlignVert.addItem("上"),n.cbbAlignVert.addItem("居中"),n.cbbAlignVert.addItem("下");var l=new Ki(t,"首行缩进");l.left=16,l.top=70,l.width=52,n.edtFirstIndent=new an(t,"8"),n.edtFirstIndent.valueMask=rn,n.edtFirstIndent.left=70,n.edtFirstIndent.top=67,n.edtFirstIndent.width=40;var h=new Ki(t,"毫米");h.left=116,h.top=70,h.width=24;var c=new Ki(t,"左缩进");c.left=28,c.top=97,c.width=40,n.edtLeftIndent=new an(t,"10"),n.edtLeftIndent.valueMask=rn,n.edtLeftIndent.left=70,n.edtLeftIndent.top=94,n.edtLeftIndent.width=40;var u=new Ki(t,"毫米");u.left=116,u.top=97,u.width=24;var f=new Ki(t,"右缩进");f.left=165,f.top=97,f.width=40,n.edtRightIndent=new an(t,"10"),n.edtRightIndent.valueMask=rn,n.edtRightIndent.left=207,n.edtRightIndent.top=94,n.edtRightIndent.width=40;var d=new Ki(t,"毫米");d.left=253,d.top=97,d.width=24;var m=new Ki(t,"全文非文本对象最小行间距(pix)");m.left=16,m.top=124,m.width=195,n.edtLineSpaceMin=new an(t,"8"),n.edtLineSpaceMin.valueMask=sn,n.edtLineSpaceMin.left=207,n.edtLineSpaceMin.top=120,n.edtLineSpaceMin.width=40,n.edtLineSpaceMin.onChange=function(){n.FLineSapceMinChanged=!0},n.chkBreakRough=new en(t,"直观换行（换行时不判断相同类型字符同时换行）"),n.chkBreakRough.left=16,n.chkBreakRough.top=150,n.btnOk=new Ji(t,"确定"),n.btnOk.onClick=function(){n.modalResult=wh,n.close()},n.btnOk.left=Math.trunc((n.width-n.btnOk.width)/2),n.btnOk.top=n.clientArea.height-30,n.beginUpdate();try{n.addControl(o),n.addControl(n.cbbSpaceMode),n.addControl(n.edtLineSpace),n.addControl(n.lblUnit),n.addControl(s),n.addControl(n.cbbAlignHorz),n.addControl(a),n.addControl(n.cbbAlignVert),n.addControl(l),n.addControl(n.edtFirstIndent),n.addControl(h),n.addControl(c),n.addControl(n.edtLeftIndent),n.addControl(u),n.addControl(f),n.addControl(n.edtRightIndent),n.addControl(d),n.addControl(n.chkBreakRough),n.addControl(m),n.addControl(n.edtLineSpaceMin),n.addControl(n.btnOk)}finally{n.endUpdate()}return n}return l()(i,[{key:"_spaceModeChange",value:function(){5==this.cbbSpaceMode.itemIndex?(this.edtLineSpace.text="12",this.edtLineSpace.visible=!0,this.lblUnit.text="磅",this.lblUnit.visible=!0):6==this.cbbSpaceMode.itemIndex?(this.edtLineSpace.text="3",this.edtLineSpace.visible=!0,this.lblUnit.text="倍",this.lblUnit.visible=!0):(this.edtLineSpace.text="",this.edtLineSpace.visible=!1,this.lblUnit.visible=!1)}},{key:"SetView",value:function(t){var e=this;this.beginUpdate();try{switch(this.cbbSpaceMode.itemIndex=parseInt(t.Style.ParaStyles[t.CurParaNo].LineSpaceMode),this._spaceModeChange(),t.Style.ParaStyles[t.CurParaNo].LineSpaceMode){case Hn.PLSFix:case Hn.PLSMult:this.edtLineSpace.text=L.stringFormatFloat(1,t.Style.ParaStyles[t.CurParaNo].LineSpace)}this.cbbAlignHorz.itemIndex=parseInt(t.Style.ParaStyles[t.CurParaNo].AlignHorz),this.cbbAlignVert.itemIndex=parseInt(t.Style.ParaStyles[t.CurParaNo].AlignVert),this.edtFirstIndent.text=L.stringFormatFloat(1,t.Style.ParaStyles[t.CurParaNo].FirstIndent),this.edtLeftIndent.text=L.stringFormatFloat(1,t.Style.ParaStyles[t.CurParaNo].LeftIndent),this.edtRightIndent.text=L.stringFormatFloat(1,t.Style.ParaStyles[t.CurParaNo].RightIndent),this.edtLineSpaceMin.text=t.Style.LineSpaceMin.toString(),this.chkBreakRough.checked=t.Style.ParaStyles[t.CurParaNo].BreakRough,this.moveCenter()}finally{this.endUpdate()}this.showModal((function(){t.BeginUpdate();try{var i=12;e.cbbSpaceMode.itemIndex>4&&(i=L.parseFloatDef(e.edtLineSpace.text,0)),t.ApplyParaLineSpace(e.cbbSpaceMode.itemIndex,i),t.ApplyParaAlignHorz(e.cbbAlignHorz.itemIndex),t.ApplyParaAlignVert(e.cbbAlignVert.itemIndex),t.ApplyParaFirstIndent(L.parseFloatDef(e.edtFirstIndent.text,0)),t.ApplyParaLeftIndent(L.parseFloatDef(e.edtLeftIndent.text,0)),t.ApplyParaRightIndent(L.parseFloatDef(e.edtRightIndent.text,0)),t.ApplyParaBreakRough(e.chkBreakRough.checked),e.FLineSapceMinChanged&&(t.Style.LineSpaceMin=e.edtLineSpaceMin.number,t.FormatData())}finally{t.EndUpdate()}}))}}]),i}(Dh);function mf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Sf=function(t){m()(i,t);var e=mf(i);function i(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:320,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:246,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;r()(this,i),(n=e.call(this,t,o,s)).caption="属性",n.formType=a,n.gridProperty=new Nn(t,1,2),n.gridProperty.marginLeft=5,n.gridProperty.marginRight=5,n.gridProperty.height=180,n.gridProperty.align=qt,n.gridProperty.fixRowCount=1,n.gridProperty.rows[0][0].value="键",n.gridProperty.rows[0][1].value="值",n.gridProperty.setColWidth(0,100),n.gridProperty.setColWidth(1,180),n.gridProperty.addColumn("",bn.String,Tn.Combobox),n.gridProperty.addColumn("",bn.String,Tn.Combobox),n.gridProperty.onCellPopupBefor=function(t,e,i){if(i.onGetIndexHint=null,i.items.clear(),0===e){for(var o in Yh)i.addItem(Yh[o]);i.onGetIndexHint=function(t){return n.getDePropHint(i.items[t].text)}}else if(1===e&&n.gridProperty.rows[t][0].value===Yh.Frmtp){for(var s in Zh)i.addItem(Zh[s]);i.onGetIndexHint=function(t){return n.getFrmtpHint(i.items[t].text)}}},n.pnlButton=new qi(t),n.pnlButton.height=40,n.pnlButton.borderVisible=!1,n.pnlButton.align=qt;var l=new Ki(t,"第一列为空时无效");l.left=2,l.top=10,l.font.color=Ft.OrangeRed,n.pnlButton.addControl(l);var h=new Ji(t,"新增行");h.left=l.right+5,h.top=5,h.width=55,h.onClick=function(){n.gridProperty.rowCount++,n.gridProperty.rows.last[0].value="",n.gridProperty.rows.last[1].value="",n.gridProperty.row=n.gridProperty.rows.count-1},n.pnlButton.addControl(h);var c=new Ji(t,"删除行");c.left=h.right+10,c.top=h.top,c.width=55,c.onClick=function(){n.gridProperty.deleteRow(n.gridProperty.row)},n.pnlButton.addControl(c);var u=new Ji(t,"保存");u.left=c.right+20,u.top=c.top,u.width=55,u.onClick=function(){n.modalResult=wh,n.close()},n.pnlButton.addControl(u),n.beginUpdate();try{n.addControl(n.pnlButton),n.addControl(n.gridProperty),n.moveCenter()}finally{n.endUpdate()}return n}return l()(i,[{key:"getDePropHint",value:function(t){for(var e in Yh)if(Yh[e]===t)return Qh[e];return""}},{key:"getFrmtpHint",value:function(t){for(var e in Zh)if(Zh[e]===t)return qh[e];return""}},{key:"getPropertys",value:function(t){this.gridProperty.rowCount=t.count+1;for(var e=1;e<=t.count;e++)this.gridProperty.rows[e][0].value=t[e-1].key,this.gridProperty.rows[e][1].value=t[e-1].val}},{key:"setPropertys",value:function(t){var e;t.clear();for(var i=1;i<this.gridProperty.rowCount;i++)""!=(e=Yl.HCDeleteBreak(this.gridProperty.rows[i][0].value).trim())&&t.add(e,Yl.HCDeleteBreak(this.gridProperty.rows[i][1].value))}}]),i}(Dh);function pf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var yf=function(t){m()(i,t);var e=pf(i);function i(t){var n;r()(this,i),(n=e.call(this,t,250,180)).caption="通用属性";var o=new Ki(t,"内边距");o.left=5,o.top=5;var s=new Ki(t,"左      上      右      下");s.left=20,s.top=25,n.edtPadLeft=new an(t,0,0,255),n.edtPadLeft.width=30,n.edtPadLeft.left=35,n.edtPadLeft.top=s.top-3,n.edtPadTop=new an(t,0,0,255),n.edtPadTop.width=30,n.edtPadTop.left=90,n.edtPadTop.top=s.top-3,n.edtPadRight=new an(t,0,0,255),n.edtPadRight.width=30,n.edtPadRight.left=145,n.edtPadRight.top=s.top-3,n.edtPadBottom=new an(t,0,0,255),n.edtPadBottom.width=30,n.edtPadBottom.left=200,n.edtPadBottom.top=s.top-3;var a=new Ji(t,"保存");a.left=Math.trunc((n.clientArea.width-a.width)/2),a.top=n.clientArea.height-a.height-10,a.onClick=function(){n.modalResult=wh,n.close()},n.beginUpdate();try{n.addControl(o),n.addControl(s),n.addControl(n.edtPadLeft),n.addControl(n.edtPadTop),n.addControl(n.edtPadRight),n.addControl(n.edtPadBottom),n.addControl(a),n.moveCenter()}finally{n.endUpdate()}return n}return l()(i,[{key:"SetControl",value:function(t){var e=this;this.beginUpdate();try{this.edtPadLeft.text=t.PaddingLeft,this.edtPadTop.text=t.PaddingTop,this.edtPadRight.text=t.PaddingRight,this.edtPadBottom.text=t.PaddingBottom}finally{this.endUpdate()}this.showModal((function(){t.PaddingLeft=e.edtPadLeft.number,t.PaddingTop=e.edtPadTop.number,t.PaddingRight=e.edtPadRight.number,t.PaddingBottom=e.edtPadBottom.number,t.StyleNo===oo.RadioGroup&&t.ReLayout(),t.ReFormatRequest()}))}}]),i}(Dh);function Ff(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var vf=function(t){m()(i,t);var e=Ff(i);function i(t){var n;r()(this,i),(n=e.call(this,t,360,470)).caption="DeRadioGroup属性",n.RadioGroup=null,n.gridProperty.height=100,n.gridProperty.align=Xt,n.pnlButton.align=Xt,n.pnlProp=new qi(t),n.pnlProp.height=120,n.pnlProp.borderVisible=!1,n.pnlProp.align=Xt,n.chkAutoSize=new en(t,"自动计算宽高"),n.chkAutoSize.left=20,n.chkAutoSize.top=11,n.chkAutoSize.onSwitch=function(){n.edtWidth.enabled=!n.chkAutoSize.checked,n.edtHeight.enabled=!n.chkAutoSize.checked},n.pnlProp.addControl(n.chkAutoSize);var o=new Ki(t,"宽(像素)");o.left=131,o.top=13,n.pnlProp.addControl(o),n.edtWidth=new an(t),n.edtWidth.left=o.right+5,n.edtWidth.top=10,n.edtWidth.width=32,n.pnlProp.addControl(n.edtWidth);var s=new Ki(t,"高(像素)");s.left=233,s.top=13,n.pnlProp.addControl(s),n.edtHeight=new an(t),n.edtHeight.left=s.right+5,n.edtHeight.top=10,n.edtHeight.width=32,n.pnlProp.addControl(n.edtHeight);var a=new Ki(t,"RadioItem样式");a.left=20,a.top=44,n.pnlProp.addControl(a),n.cbbStyle=new mn(t,""),n.cbbStyle.static=!0,n.cbbStyle.left=115,n.cbbStyle.top=40,n.cbbStyle.width=88,n.cbbStyle.addItem("RadioButton"),n.cbbStyle.addItem("CheckBox"),n.pnlProp.addControl(n.cbbStyle),n.chkMulSelect=new en(t,"多选"),n.chkMulSelect.left=214,n.chkMulSelect.top=42,n.pnlProp.addControl(n.chkMulSelect),n.chkDeleteAllow=new en(t,"允许删除"),n.chkDeleteAllow.left=n.chkMulSelect.right+10,n.chkDeleteAllow.top=42,n.pnlProp.addControl(n.chkDeleteAllow);var l=new Ki(t,"列数");l.left=20,l.top=71,n.pnlProp.addControl(l),n.edtColumn=new an(t),n.edtColumn.left=l.right+2,n.edtColumn.top=68,n.edtColumn.width=32,n.edtColumn.onChange=function(){n.edtColumnWidth.enabled=n.edtColumn.number>0},n.pnlProp.addControl(n.edtColumn),n.chkColumeAlign=new en(t,"列自动对齐"),n.chkColumeAlign.left=n.cbbStyle.left,n.chkColumeAlign.top=70,n.pnlProp.addControl(n.chkColumeAlign),n.chkItemHit=new en(t,"点击文本切换选中"),n.chkItemHit.left=214,n.chkItemHit.top=70,n.pnlProp.addControl(n.chkItemHit);var h=new Ki(t,"列宽(像素)");h.left=20,h.top=100,n.pnlProp.addControl(h),n.edtColumnWidth=new an(t),n.edtColumnWidth.left=h.right+5,n.edtColumnWidth.top=96,n.edtColumnWidth.width=32,n.edtColumnWidth.hint="值为0时表示不限制列宽",n.pnlProp.addControl(n.edtColumnWidth),n.chkCheckNone=new en(t,"可都不选"),n.chkCheckNone.left=n.edtColumnWidth.right+10,n.chkCheckNone.top=n.edtColumnWidth.top+3,n.pnlProp.addControl(n.chkCheckNone),n.chkAllocValue=new en(t,"已填值"),n.chkAllocValue.left=n.chkItemHit.left,n.chkAllocValue.top=n.edtColumnWidth.top+3,n.pnlProp.addControl(n.chkAllocValue),n.gridItem=new Rn(t,1,5),n.gridItem.marginLeft=5,n.gridItem.marginRight=5,n.gridItem.height=130,n.gridItem.align=$t,n.gridItem.fixRowCount=1,n.gridItem.rows[0][0].value="前缀",n.gridItem.rows[0][1].value="文本",n.gridItem.rows[0][2].value="编码",n.gridItem.rows[0][3].value="ID",n.gridItem.rows[0][4].value="计算值",n.gridItem.setColWidth(0,60),n.gridItem.setColWidth(1,100),n.gridItem.setColWidth(2,40),n.gridItem.setColWidth(3,40),n.gridItem.setColWidth(4,80),n.pnlItemButton=new qi(t),n.pnlItemButton.height=40,n.pnlItemButton.borderVisible=!1,n.pnlItemButton.align=qt;var c=new Ji(t,"新增选项");c.left=5,c.top=5,c.width=60,c.onClick=function(){n.gridItem.rowCount++,n.gridItem.rows.last[0].value="",n.gridItem.rows.last[1].value="",n.gridItem.rows.last[2].value="",n.gridItem.rows.last[3].value="",n.gridItem.rows.last[4].value=""},n.pnlItemButton.addControl(c);var u=new Ji(t,"删除选项");u.left=c.right+10,u.top=c.top,u.width=60,u.onClick=function(){n.gridItem.deleteRow(n.gridItem.row)},n.pnlItemButton.addControl(u);var f=new Ji(t,"保存");f.left=u.right+20,f.top=u.top,f.width=55,f.onClick=function(){n.modalResult=wh,n.close()},n.pnlItemButton.addControl(f),n.beginUpdate();try{var d=[n.clientArea.controls[n.clientArea.controls.length-1],n.clientArea.controls[n.clientArea.controls.length-2]];n.clientArea.controls[n.clientArea.controls.length-2]=d[0],n.clientArea.controls[n.clientArea.controls.length-1]=d[1],n.clientArea.controls.insert(0,n.pnlProp),n.addControl(n.gridItem),n.addControl(n.pnlItemButton)}finally{n.endUpdate()}return n}return l()(i,[{key:"GetDeControl",value:function(){return this.RadioGroup}},{key:"SetView",value:function(t,e){var i=this;this.RadioGroup=e,this.beginUpdate();try{this.chkAutoSize.checked=e.AutoSize,this.edtWidth.enabled=!this.chkAutoSize.checked,this.edtHeight.enabled=!this.chkAutoSize.checked,this.edtWidth.text=e.Width.toString(),this.edtHeight.text=e.Height.toString(),e.RadioStyle==fl?this.cbbStyle.itemIndex=0:this.cbbStyle.itemIndex=1,this.chkMulSelect.checked=e.MultSelect,this.chkDeleteAllow.checked=e.DeleteAllow,this.edtColumn.text=e.Columns.toString(),this.chkColumeAlign.checked=e.ColumnAlign,this.chkItemHit.checked=e.ItemHit,this.edtColumnWidth.text=e.ColumnWidth.toString(),this.edtColumnWidth.enabled=this.edtColumn.number>0,this.chkAllocValue.checked=e.AllocValue,this.chkCheckNone.checked=e.CheckNone,this.getPropertys(e.Propertys),this.gridItem.rowCount=e.Items.count+1;for(var n=1;n<=e.Items.count;n++)this.gridItem.rows[n][0].value=e.Items[n-1].Prefix,this.gridItem.rows[n][1].value=e.Items[n-1].Text,this.gridItem.rows[n][2].value=e.Items[n-1].Code,this.gridItem.rows[n][3].value=e.Items[n-1].ID,this.gridItem.rows[n][4].value=e.Items[n-1].TextValue;this.moveCenter()}finally{this.endUpdate()}this.showModal((function(){e.AutoSize=i.chkAutoSize.checked,i.chkAutoSize.checked||(e.Width=L.parseIntDef(i.edtWidth.text,e.Width),e.Height=L.parseIntDef(i.edtHeight.text,e.Height)),0===i.cbbStyle.itemIndex?e.RadioStyle=fl:e.RadioStyle=dl,e.MultSelect=i.chkMulSelect.checked,e.DeleteAllow=i.chkDeleteAllow.checked,e.ItemHit=i.chkItemHit.checked,e.ColumnWidth=L.parseIntDef(i.edtColumnWidth.text,0),e.AllocValue=i.chkAllocValue.checked,e.CheckNone=i.chkCheckNone.checked,e.BeginAdd();try{e.Items.clear(),e.Columns=L.parseIntDef(i.edtColumn.text,e.Columns),e.ColumnAlign=i.chkColumeAlign.checked;for(var n="",o=1;o<i.gridItem.rowCount;o++)""!=(n=Yl.HCDeleteBreak(i.gridItem.rows[o][1].value).trim())&&e.AddItem(n,Yl.HCDeleteBreak(i.gridItem.rows[o][4].value),!1,Yl.HCDeleteBreak(i.gridItem.rows[o][0].value),Yl.HCDeleteBreak(i.gridItem.rows[o][3].value),Yl.HCDeleteBreak(i.gridItem.rows[o][2].value))}finally{e.EndAdd()}i.setPropertys(e.Propertys),t.BeginUpdate();try{var s=t.ActiveSectionTopLevelData();s.isClass(Jl)&&s.FormatDirty(),t.ActiveSection.ReFormatActiveItem()}finally{t.EndUpdate()}}))}}]),i}(function(t){m()(i,t);var e=pf(i);function i(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:320,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:246,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;r()(this,i),n=e.call(this,t,o,s,a);var l=new Ji(t,"通用属性");return l.marginRight=5,l.onClick=function(){var e=n.GetDeControl();null!==e&&new yf(t).SetControl(e)},n.captionBar.addControl(l),n}return l()(i,[{key:"DoSetControl",value:function(t){}},{key:"GetDeControl",value:function(){return null}}]),i}(Sf));function If(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var gf=l()((function t(){r()(this,t),this.PrinterServer="",this.PrinterName="",this.PrintAsImage=!1,this.RBWatermarking="",this.Watermark="",this.WatermarkFont=L.DefaultFont,this.WatermarkSize=16,this.WatermarkPos=0,this.WatermarkOpacity=0,this.HideUnAllocValue=!1,this.UnAllocValueBlank=!1,this.ZoomSize=-1,this.ZoomWidth=-1,this.MarkText="打印位置",this.MarkSectionIndex=-1,this.MarkPageIndex=-1,this.MarkLeft=-1,this.MarkTop=-1,this.MarkHeight=0,this.MarkEnd=!0,this.StartPageIndex=-1,this.StartLeft=-1,this.StartTop=-1,this.StartHeight=0,this.StartSectionIndex=-1,this.StartData=null,this.StartItemNo=-1,this.StartOffset=-1,this.EndPageIndex=-1,this.EndLeft=-1,this.EndTop=-1,this.EndHeight=0,this.EndSectionIndex=-1,this.EndData=null,this.EndItemNo=-1,this.EndOffset=-1,this.NoWaitInfo=!1})),Cf=function(t){m()(i,t);var e=If(i);function i(t){var n;r()(this,i),(n=e.call(this,t,t.width,t.height)).PrintParam=new gf,n.ProcIndex="",n.SectionIndex=-1,n.beginUpdate();try{n.caption="打印方式：",n.captionBar.captureParent=!1,n.btnClose.visible=!1,n.chkPrintHideUnAlloc=new en(t,"隐藏未填写的数据元"),n.chkPrintHideUnAlloc.onSwitch=function(){n.FEmrView.PrintHideUnAllocValue=n.chkPrintHideUnAlloc.checked,n.DoLoadFromView()},n.chkPrintHideUnAlloc.align=Qt,n.captionBar.addControl(n.chkPrintHideUnAlloc);var o=new Ki(n.hcl,"起始页码:");o.marginLeft=10,o.align=Qt,n.captionBar.addControl(o),n.edtPageNoFrom=new an(n.hcl,1),n.edtPageNoFrom.align=Qt,n.edtPageNoFrom.width=30,n.edtPageNoFrom.min=1,n.edtPageNoFrom.onChange=function(){n.FEmrView.ActiveSection.PageNoFrom=n.edtPageNoFrom.number,n.FEmrView.UpdateView()},n.captionBar.addControl(n.edtPageNoFrom),n.captionBar.addSpliter(),n.captionBar.addButton("打印").onClick=function(){null!=n.OnPrint&&n.OnPrint(n.FEmrView)},n.captionBar.addButton("当前页").onClick=function(){null!=n.OnPrintCurPage&&n.OnPrintCurPage(n.FEmrView)},n.captionBar.addButton("奇数页").onClick=function(){null!=n.OnPrintOdd&&n.OnPrintOdd(n.FEmrView)},n.captionBar.addButton("偶数页").onClick=function(){null!=n.OnPrintEven&&n.OnPrintEven(n.FEmrView)},n.btnLineToCurPage=n.captionBar.addButton("当前行->当前页"),n.btnLineToCurPage.onClick=function(){null!=n.OnPrintCurLine&&n.OnPrintCurLine(n.FEmrView)},n.btnLineToLastPage=n.captionBar.addButton("当前行->最后页"),n.btnLineToLastPage.onClick=function(){null!=n.OnPrintCurLine&&n.OnPrintCurLine(n.FEmrView,n.FEmrView.PageCount)},n.captionBar.addSpliter();var s=n.captionBar.addButton("关闭打印预览");s.image.src=n.hcl.theme.closeImage.src,s.onClick=function(){n.close()},n.FEmrView=new hf(t),n.FEmrView.DesignModeEx=!1,n.FEmrView.OnGetHint=function(){return""},n.FViewEnable=!0,n.ViewMouseMove=null,n.ViewMouseDown=null,n.ViewMouseUp=null,n.FEmrView.OnSectionPaintPageAfter=function(t,e,i,o,s){if(n.PrintParam.MarkPageIndex>=0&&n.PrintParam.MarkPageIndex===e&&n.FEmrView.FSections.indexOf(t)===n.PrintParam.MarkSectionIndex&&(""!==n.PrintParam.MarkText&&(o.brush.color="#d8e8f5",o.fillBounds(i.left-61,i.top+n.PrintParam.MarkTop+n.PrintParam.MarkHeight-20,60,20),o.font.size=10,o.font.name=L.DefaultFont,o.font.styles.clear(),o.font.color="#15428b",o.textOut(i.left-56,i.top+n.PrintParam.MarkTop+n.PrintParam.MarkHeight-17,n.PrintParam.MarkText)),o.pen.color="#ff0000",o.beginPath(),n.PrintParam.MarkEnd?(o.moveTo(i.left-61,i.top+n.PrintParam.MarkTop+n.PrintParam.MarkHeight),o.lineTo(i.right,i.top+n.PrintParam.MarkTop+n.PrintParam.MarkHeight)):(o.moveTo(i.left-61,i.top+n.PrintParam.MarkTop),o.lineTo(i.right,i.top+n.PrintParam.MarkTop)),o.paintPath()),!(n.PrintParam.StartPageIndex<0)){var r=n.EmrView.GetPageIndexBySectionPageIndex(n.FEmrView.FSections.indexOf(t),e);n.PrintParam.StartPageIndex===r&&(o.brush.color="#d8e8f5",o.fillBounds(i.left-61,i.top+n.PrintParam.StartTop,60,20),o.font.size=10,o.font.name=L.DefaultFont,o.font.styles.clear(),o.font.color="#15428b",o.textOut(i.left-56,i.top+n.PrintParam.StartTop+3,"区间起始"),o.pen.color="#008000",o.beginPath(),o.moveTo(i.left-61,i.top+n.PrintParam.StartTop),o.lineTo(i.right,i.top+n.PrintParam.StartTop),o.paintPath()),n.PrintParam.EndPageIndex===r&&(o.brush.color="#d8e8f5",o.fillBounds(i.left-61,i.top+n.PrintParam.EndTop+n.PrintParam.EndHeight-20,60,20),o.font.size=10,o.font.name=L.DefaultFont,o.font.styles.clear(),o.font.color="#15428b",o.textOut(i.left-56,i.top+n.PrintParam.EndTop+n.PrintParam.EndHeight-17,"区间结束"),o.pen.color="#ff0000",o.beginPath(),o.moveTo(i.left-61,i.top+n.PrintParam.EndTop+n.PrintParam.EndHeight),o.lineTo(i.right,i.top+n.PrintParam.EndTop+n.PrintParam.EndHeight),o.paintPath())}},n.FEmrView.OnSectionInsertItem=function(t,e,i){n.DoSectionItemInsert(t,e,i)},n.FEmrView.OnSectionCheckInsertItemCount=function(t,e,i){return n.DoCheckInsertItemCount(t,e,i)},n.FEmrView.OnStyleLoaded=function(t,e){for(var i=null,o=0;o<t.TextStyles.count;o++)(i=t.TextStyles[o]).meaChar=n.hcl.meaChr||Rt.getFontIndex(i.Family)<1},n.FEmrView.align=$t,n.addControl(n.FEmrView)}finally{n.endUpdate()}return n}return l()(i,[{key:"doClose_",value:function(){this.ViewMouseMove=null,this.ViewMouseDown=null,this.ViewMouseUp=null,f()(F()(i.prototype),"doClose_",this).call(this)}},{key:"DoSectionItemInsert",value:function(t,e,i){if(i.StyleNo>oo.Null)this.FEmrView.PrintHideUnAllocValue&&i.IsElement&&!i.AllocValue&&(i.Visible=!1),i.TraceStyles.has(jh.Del)&&(i.Visible=!1);else if(i.StyleNo===oo.Domain&&i.Empty&&this.FEmrView.PrintHideUnAllocValue)i.Visible=!1;else if(i.StyleNo===oo.Table&&"1"===i.GetValue(Yh.UnPrintEmptyRow)){for(var n=i.RowCount-1;n>0;n--)i.EmptyContentRow(n,!0)&&i.DeleteRow(n);i.EmptyContentRow(0,!0)&&i.Rows.delete(0)}}},{key:"DoCheckInsertItemCount",value:function(t,e,i){for(var n=0,o=i;o>=e;o--)t.Items[o].StyleNo===oo.Table&&0===t.Items[o].RowCount&&(t.Items[o].ParaFirst&&o<i-n&&(t.Items[o+1].ParaFirst=!0),t.Items.delete(o),n++);return n}},{key:"DoLoadFromView",value:function(){this.FEmrView.BeginUpdate();try{this.FEmrView.ReadOnly=!1,this.FEmrView.Clear();var t=new ht;if(this.SectionIndex>=0&&""!=this.ProcIndex){this.FEmrView.PrintProcIndex=this.ProcIndex,this.FEmrView.Style.MergeStyle=!0;try{this.FFromView.ActiveSection.Header.SaveToStream(t),t.position=0,this.FEmrView.ActiveSection.Header.LoadFromStream(t,this.FFromView.Style,Yl.HC_FileVersionInt),t.clear(),this.FFromView.ActiveSection.Footer.SaveToStream(t),t.position=0,this.FEmrView.ActiveSection.Footer.LoadFromStream(t,this.FFromView.Style,Yl.HC_FileVersionInt)}finally{this.FEmrView.Style.MergeStyle=!1}this.FEmrView.ActiveSection.AssignPaper(this.FFromView.Sections[this.SectionIndex]),t.clear(),this.FFromView.GetProcAsStream(this.ProcIndex,t),t.position=0,this.FEmrView.InsertLiteStream(t)}else this.FEmrView.PrintProcIndex="",this.FFromView.SaveToStream(t),t.position=0,this.FEmrView.LoadFromStream(t);t=null,this.FEmrView.PrintView=!0,this.FEmrView.HideTrace=!0,this.FEmrView.ReadOnly=!0,this.FEmrView.Zoom=this.FFromView.Zoom}finally{this.FEmrView.EndUpdate()}}},{key:"SetView",value:function(t,e,i){this.SectionIndex=null!=i&&null!=i.sectionIndex?i.sectionIndex:-1,this.ProcIndex=null!=i&&null!=i.procIndex?i.procIndex:-1,this.edtPageNoFrom.text="1",this.PrintParam.MarkText=null!=e.MarkText?e.MarkText:"打印位置",this.PrintParam.MarkSectionIndex=null!=e.MarkSectionIndex?e.MarkSectionIndex:-1,this.PrintParam.MarkPageIndex=null!=e.MarkPageIndex?e.MarkPageIndex:-1,this.PrintParam.MarkLeft=null!=e.MarkLeft?e.MarkLeft:-1,this.PrintParam.MarkTop=null!=e.MarkTop?e.MarkTop:-1,this.PrintParam.MarkHeight=null!=e.MarkHeight?e.MarkHeight:-1,this.chkPrintHideUnAlloc.checked=e.HideUnAllocValue,this.FEmrView.PrintHideUnAllocValue=this.chkPrintHideUnAlloc.checked,this.FEmrView.PrintUnAlloc=!e.UnAllocValueBlank,this.FFromView=t,this.DoLoadFromView(),this.showModal((function(){}))}},{key:"ViewEnable",get:function(){return this.FViewEnable},set:function(t){this.FViewEnable!=t&&(this.FViewEnable=t,t?(this.FEmrView.canFocus=!0,this.FEmrView.cursor=Ce,this.btnLineToCurPage.visible=!0,this.btnLineToLastPage.visible=!0,null!==this.ViewMouseMove&&(this.FEmrView.doMouseMove_=this.ViewMouseMove,this.FEmrView.doMouseDown_=this.ViewMouseDown,this.FEmrView.doMouseUp_=this.ViewMouseUp)):(this.FEmrView.canFocus=!1,this.FEmrView.cursor=Se,this.btnLineToCurPage.visible=!1,this.btnLineToLastPage.visible=!1,this.ViewMouseMove=this.FEmrView.doMouseMove_,this.FEmrView.doMouseMove_=function(t){},this.ViewMouseDown=this.FEmrView.doMouseDown_,this.FEmrView.doMouseDown_=function(t){},this.ViewMouseUp=this.FEmrView.doMouseUp_,this.FEmrView.doMouseUp_=function(t){}))}}]),i}(Dh);function wf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Af=function(t){m()(i,t);var e=wf(i);function i(t){var n;r()(this,i),(n=e.call(this,t,320,310,1)).caption="DeItem数据元属性",n.chkCanEdit=new en(t,"允许修改内容"),n.chkCanEdit.left=5,n.chkCanEdit.top=10,n.chkAllocOnly=new en(t,"修改时整体赋值不允许部分修改"),n.chkAllocOnly.left=n.chkCanEdit.right+5,n.chkAllocOnly.top=10,n.chkCanCopy=new en(t,"允许复制"),n.chkCanCopy.left=5,n.chkCanCopy.top=n.chkCanEdit.bottom+5,n.chkDeleteAllow=new en(t,"允许删除"),n.chkDeleteAllow.left=n.chkAllocOnly.left,n.chkDeleteAllow.top=n.chkCanCopy.top,n.chkAllocValue=new en(t,"已填值"),n.chkAllocValue.left=n.chkDeleteAllow.right+5,n.chkAllocValue.top=n.chkDeleteAllow.top,n.chkAllocMust=new en(t,"必填"),n.chkAllocMust.left=n.chkAllocValue.right+5,n.chkAllocMust.top=n.chkAllocValue.top,n.beginUpdate();try{n.addControl(n.chkCanEdit),n.addControl(n.chkCanCopy),n.addControl(n.chkDeleteAllow),n.addControl(n.chkAllocValue),n.addControl(n.chkAllocOnly),n.addControl(n.chkAllocMust)}finally{n.endUpdate()}return n}return l()(i,[{key:"SetView",value:function(t){var e=this,i=t.ActiveSectionTopLevelData().GetActiveItem();this.beginUpdate();try{this.chkCanEdit.checked=!i.EditProtect,this.chkCanCopy.checked=!i.CopyProtect,this.chkDeleteAllow.checked=i.DeleteAllow,this.chkAllocValue.checked=i.AllocValue,this.chkAllocOnly.checked=i.AllocOnly,this.chkAllocMust.checked=i.AllocMust,this.getPropertys(i.Propertys),this.moveCenter()}finally{this.endUpdate()}this.showModal((function(){t.BeginUpdate();try{i.EditProtect=!e.chkCanEdit.checked,i.CopyProtect=!e.chkCanCopy.checked,i.DeleteAllow=e.chkDeleteAllow.checked,i.AllocValue=e.chkAllocValue.checked,i.AllocOnly=e.chkAllocOnly.checked,i.AllocMust=e.chkAllocMust.checked,e.setPropertys(i.Propertys),i.PropertyChange()}finally{t.EndUpdate()}}))}}]),i}(Sf);function Df(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Pf=function(t){m()(i,t);var e=Df(i);function i(t){var n;r()(this,i),(n=e.call(this,t,260,160)).caption="横线属性";var o=new Ki(t,"宽");o.left=34,o.top=10,n.edtWidth=new an(t),n.edtWidth.left=o.right+5,n.edtWidth.top=o.top-4,n.edtWidth.width=64;var s=new Ki(t,"高");s.left=n.edtWidth.right+30,s.top=o.top,n.edtHeight=new an(t),n.edtHeight.left=s.right+5,n.edtHeight.top=s.top-4,n.edtHeight.width=64;var a=new Ki(t,"线高");a.left=20,a.top=n.edtHeight.bottom+10,n.edtLineHeight=new an(t),n.edtLineHeight.left=n.edtWidth.left,n.edtLineHeight.top=a.top-4,n.edtLineHeight.width=64;var l=new Ki(t,"样式");l.left=134,l.top=a.top,n.cbbLineStyle=new mn(t),n.cbbLineStyle.left=n.edtHeight.left,n.cbbLineStyle.top=l.top-4,n.cbbLineStyle.width=64,n.cbbLineStyle.static=!0,n.cbbLineStyle.addItem("实线"),n.cbbLineStyle.addItem("虚线"),n.cbbLineStyle.addItem("点线");var h=new Ji(t,"确定");h.onClick=function(){n.edtLineHeight.number>n.edtHeight.number?n.hcl.showMessage("线高度必需小于等于高度！"):(n.modalResult=wh,n.close())},h.left=Math.trunc((n.width-h.width)/2),h.top=n.clientArea.height-30,n.beginUpdate();try{n.addControl(o),n.addControl(n.edtWidth),n.addControl(s),n.addControl(n.edtHeight),n.addControl(a),n.addControl(n.edtLineHeight),n.addControl(l),n.addControl(n.cbbLineStyle),n.addControl(h)}finally{n.endUpdate()}return n}return l()(i,[{key:"SetView",value:function(t){var e=this,i=t.ActiveSectionTopLevelData().GetActiveItem();this.beginUpdate();try{switch(this.edtWidth.text=i.Width,this.edtHeight.text=i.Height,this.edtLineHeight.text=i.LineHeight,i.LineStyle){case _t.Solid:this.cbbLineStyle.itemIndex=0;break;case _t.Dash:this.cbbLineStyle.itemIndex=1;break;case _t.Dot:this.cbbLineStyle.itemIndex=2;break;case _t.DashDot:this.cbbLineStyle.itemIndex=3;break;case _t.DashDotDot:this.cbbLineStyle.itemIndex=4;break;default:this.cbbLineStyle.itemIndex=0}this.cbbLineStyle.itemIndex=i.LineStyle,this.moveCenter()}finally{this.endUpdate()}this.showModal((function(){t.BeginUpdate();try{switch(i.Width=L.parseIntDef(e.edtWidth.text,i.Width),i.Height=L.parseIntDef(e.edtHeight.text,i.Height),i.LineHeight=L.parseIntDef(e.edtLineHeight.text,i.LineHeight),e.cbbLineStyle.itemIndex){case 0:i.LineStyle=_t.Solid;break;case 1:i.LineStyle=_t.Dash;break;case 2:i.LineStyle=_t.Dot;break;case 3:i.LineStyle=_t.DashDot;break;case 4:i.LineStyle=_t.DashDotDot;break;default:i.LineStyle=_t.Solid}t.ActiveSection.ReFormatActiveItem()}finally{t.EndUpdate()}}))}}]),i}(Dh);function kf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var xf=function(t){m()(i,t);var e=kf(i);function i(t){var n;r()(this,i),(n=e.call(this,t,360,350)).caption="DeEdit属性",n.chkAutoSize=new en(t,"自动计算宽高"),n.chkAutoSize.left=23,n.chkAutoSize.top=11,n.chkAutoSize.onSwitch=function(){n.edtWidth.enabled=!n.chkAutoSize.checked,n.edtHeight.enabled=!n.chkAutoSize.checked};var o=new Ki(t,"宽(像素)");o.left=131,o.top=13,n.edtWidth=new an(t),n.edtWidth.left=o.right+5,n.edtWidth.top=10,n.edtWidth.width=32;var s=new Ki(t,"高(像素)");s.left=233,s.top=13,n.edtHeight=new an(t),n.edtHeight.left=s.right+5,n.edtHeight.top=10,n.edtHeight.width=32;var a=new Ki(t,"边框");a.left=n.chkAutoSize.left,a.top=n.edtWidth.bottom+6,n.chkBorderTop=new en(t,"上"),n.chkBorderTop.left=a.right+10,n.chkBorderTop.top=n.edtWidth.bottom+5,n.chkBorderBottom=new en(t,"下"),n.chkBorderBottom.left=n.chkBorderTop.right+10,n.chkBorderBottom.top=n.chkBorderTop.top,n.chkBorderLeft=new en(t,"左"),n.chkBorderLeft.left=n.chkBorderBottom.right+10,n.chkBorderLeft.top=n.chkBorderBottom.top,n.chkBorderRight=new en(t,"右"),n.chkBorderRight.left=n.chkBorderLeft.right+10,n.chkBorderRight.top=n.chkBorderLeft.top,n.edtText=new hn(t,"文本",""),n.edtText.left=a.left-5,n.edtText.top=n.chkBorderRight.bottom+5,n.edtText.width=200;var l=new Ki(t,"水平对齐");l.left=n.edtText.right+5,l.top=n.edtText.top+5,n.cbbAlign=new mn(t,""),n.cbbAlign.width=35,n.cbbAlign.left=l.right+5,n.cbbAlign.top=l.top-5,n.cbbAlign.static=!0,n.cbbAlign.addItem("左"),n.cbbAlign.addItem("中"),n.cbbAlign.addItem("右"),n.chkDeleteAllow=new en(t,"允许删除"),n.chkDeleteAllow.left=n.chkAutoSize.left,n.chkDeleteAllow.top=n.edtText.bottom+5,n.chkPrintOnlyText=new en(t,"打印时仅打印文本不打印边框"),n.chkPrintOnlyText.left=n.chkDeleteAllow.right+10,n.chkPrintOnlyText.top=n.chkDeleteAllow.top,n.beginUpdate();try{n.addControl(n.chkAutoSize),n.addControl(o),n.addControl(n.edtWidth),n.addControl(s),n.addControl(n.edtHeight),n.addControl(a),n.addControl(n.chkBorderTop),n.addControl(n.chkBorderBottom),n.addControl(n.chkBorderLeft),n.addControl(n.chkBorderRight),n.addControl(n.edtText),n.addControl(l),n.addControl(n.cbbAlign),n.addControl(n.chkDeleteAllow),n.addControl(n.chkPrintOnlyText)}finally{n.endUpdate()}return n}return l()(i,[{key:"SetView",value:function(t,e){var i=this;this.beginUpdate();try{switch(""!=e.GetValue(Yh.Name)&&(this.caption+="["+e.GetValue(Yh.Name)+"]"),this.chkAutoSize.checked=e.AutoSize,this.edtWidth.enabled=!this.chkAutoSize.checked,this.edtHeight.enabled=!this.chkAutoSize.checked,this.edtWidth.text=e.Width.toString(),this.edtHeight.text=e.Height.toString(),this.edtText.text=e.Text,e.TextAlignHorz){case as.Center:this.cbbAlign.itemIndex=1;break;case as.Right:this.cbbAlign.itemIndex=2;break;default:this.cbbAlign.itemIndex=0}this.chkPrintOnlyText.checked=e.PrintOnlyText,this.chkDeleteAllow.checked=e.DeleteAllow,this.chkBorderLeft.checked=e.BorderSides.has(Zl.Left),this.chkBorderTop.checked=e.BorderSides.has(Zl.Top),this.chkBorderRight.checked=e.BorderSides.has(Zl.Right),this.chkBorderBottom.checked=e.BorderSides.has(Zl.Bottom),this.getPropertys(e.Propertys),this.moveCenter()}finally{this.endUpdate()}this.showModal((function(){switch(e.AutoSize=i.chkAutoSize.checked,i.chkAutoSize.checked||(e.Width=L.parseIntDef(i.edtWidth.text,e.width),e.Height=L.parseIntDef(i.edtHeight.text,e.Height)),i.cbbAlign.itemIndex){case 1:e.TextAlignHorz=as.Center;break;case 2:e.TextAlignHorz=as.Right;break;default:e.TextAlignHorz=as.Left}e.Text=i.edtText.text,i.chkBorderLeft.checked?e.BorderSides.add(Zl.Left):e.BorderSides.remove(Zl.Left),i.chkBorderTop.checked?e.BorderSides.add(Zl.Top):e.BorderSides.remove(Zl.Top),i.chkBorderRight.checked?e.BorderSides.add(Zl.Right):e.BorderSides.remove(Zl.Right),i.chkBorderBottom.checked?e.BorderSides.add(Zl.Bottom):e.BorderSides.remove(Zl.Bottom),e.PrintOnlyText=i.chkPrintOnlyText.checked,e.DeleteAllow=i.chkDeleteAllow.checked,i.setPropertys(e.Propertys),t.BeginUpdate();try{var n=t.ActiveSectionTopLevelData();n.isClass(Jl)&&n.FormatDirty(),t.ActiveSection.ReFormatActiveItem()}finally{t.EndUpdate()}}))}}]),i}(Sf);function Rf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Tf=function(t){m()(i,t);var e=Rf(i);function i(t){var n;r()(this,i),(n=e.call(this,t,250,270)).caption="边框及背景",n.FTableItem=null;var o=new Ki(t,"应用于");o.left=10,o.top=10,n.cbbRang=new mn(t,""),n.cbbRang.addItem("当前单元格"),n.cbbRang.addItem("当前行"),n.cbbRang.addItem("当前列"),n.cbbRang.addItem("整个表格"),n.cbbRang.itemIndex=0,n.cbbRang.static=!0,n.cbbRang.left=o.right+5,n.cbbRang.top=8,n.cbbRang.width=100;var s=new Ki(t,"边框显示");s.left=10,s.top=n.cbbRang.bottom+8,n.chkLeft=new en(t,"左"),n.chkLeft.left=s.right-25,n.chkLeft.top=s.top+16,n.chkTop=new en(t,"上"),n.chkTop.left=n.chkLeft.right+10,n.chkTop.top=n.chkLeft.top,n.chkRight=new en(t,"右"),n.chkRight.left=n.chkTop.right+10,n.chkRight.top=n.chkLeft.top,n.chkBottom=new en(t,"下"),n.chkBottom.left=n.chkRight.right+10,n.chkBottom.top=n.chkLeft.top,n.chkLTRB=new en(t,"左上-右下斜线"),n.chkLTRB.left=n.chkLeft.left,n.chkLTRB.top=n.chkLeft.bottom+5,n.chkRTLB=new en(t,"右上-左下斜线"),n.chkRTLB.left=n.chkLTRB.left,n.chkRTLB.top=n.chkLTRB.bottom+5;var a=new Ki(t,"边框样式");a.left=10,a.top=n.chkRTLB.bottom+8;var l=new Ki(t,"上");l.left=a.right-25,l.top=n.chkRTLB.bottom+30,n.cbbBdT=new mn(t,""),n.cbbBdT.addItem("实线"),n.cbbBdT.addItem("虚线"),n.cbbBdT.itemIndex=0,n.cbbBdT.static=!0,n.cbbBdT.left=l.left+15,n.cbbBdT.top=l.top-3,n.cbbBdT.width=48;var h=new Ki(t,"下");h.left=l.left,h.top=l.bottom+10,n.cbbBdB=new mn(t,""),n.cbbBdB.addItem("实线"),n.cbbBdB.addItem("虚线"),n.cbbBdB.itemIndex=0,n.cbbBdB.static=!0,n.cbbBdB.left=h.left+15,n.cbbBdB.top=h.top-3,n.cbbBdB.width=48;var c=new Ki(t,"左");c.left=n.cbbBdT.right+5,c.top=n.chkRTLB.bottom+30,n.cbbBdL=new mn(t,""),n.cbbBdL.addItem("实线"),n.cbbBdL.addItem("虚线"),n.cbbBdL.itemIndex=0,n.cbbBdL.static=!0,n.cbbBdL.left=c.left+15,n.cbbBdL.top=c.top-3,n.cbbBdL.width=48;var u=new Ki(t,"右");u.left=n.cbbBdB.right+5,u.top=l.bottom+10,n.cbbBdR=new mn(t,""),n.cbbBdR.addItem("实线"),n.cbbBdR.addItem("虚线"),n.cbbBdR.itemIndex=0,n.cbbBdR.static=!0,n.cbbBdR.left=u.left+15,n.cbbBdR.top=u.top-3,n.cbbBdR.width=48;var f=new Ki(t,"背景色");f.left=10,f.top=n.chkRTLB.bottom+80,n.cbbBackColor=new In(t),n.cbbBackColor.left=f.right+5,n.cbbBackColor.top=f.top-3,n.cbbBackColor.width=n.chkRTLB.width;var d=new Ji(t,"保存");d.left=Math.trunc((n.clientArea.width-d.width)/2),d.top=n.clientArea.height-d.height-5,d.onClick=function(){n.modalResult=wh,n.close()},n.beginUpdate();try{n.addControl(o),n.addControl(n.cbbRang),n.addControl(s),n.addControl(n.chkLeft),n.addControl(n.chkTop),n.addControl(n.chkRight),n.addControl(n.chkBottom),n.addControl(n.chkLTRB),n.addControl(n.chkRTLB),n.addControl(a),n.addControl(l),n.addControl(n.cbbBdT),n.addControl(h),n.addControl(n.cbbBdB),n.addControl(c),n.addControl(n.cbbBdL),n.addControl(u),n.addControl(n.cbbBdR),n.addControl(f),n.addControl(n.cbbBackColor),n.addControl(d),n.moveCenter()}finally{n.endUpdate()}return n}return l()(i,[{key:"SetCellBorderBack",value:function(t,e){var i=this.FTableItem.Rows[t][e];this.cbbBackColor.color==Yl.HCTransparentColor?i.BackgroundColor=Yl.HCTransparentColor:i.BackgroundColor=this.cbbBackColor.color;var n=i.BorderSides;this.chkLeft.checked?n.add(Zl.Left):n.remove(Zl.Left),this.chkTop.checked?n.add(Zl.Top):n.remove(Zl.Top),this.chkRight.checked?n.add(Zl.Right):n.remove(Zl.Right),this.chkBottom.checked?n.add(Zl.Bottom):n.remove(Zl.Bottom),this.chkLTRB.checked?n.add(Zl.LTRB):n.remove(Zl.LTRB),this.chkRTLB.checked?n.add(Zl.RTLB):n.remove(Zl.RTLB),i.LeftBorderStyle=0===this.cbbBdL.itemIndex?_t.Solid:_t.Dash,i.TopBorderStyle=0===this.cbbBdT.itemIndex?_t.Solid:_t.Dash,i.RightBorderStyle=0===this.cbbBdR.itemIndex?_t.Solid:_t.Dash,i.BottomBorderStyle=0===this.cbbBdB.itemIndex?_t.Solid:_t.Dash}},{key:"ApplyAllTable",value:function(){for(var t=0;t<this.FTableItem.RowCount;t++)for(var e=0;e<this.FTableItem.ColCount;e++)this.SetCellBorderBack(t,e)}},{key:"SetView",value:function(t){var e,i=this;this.FTableItem=t.GetTopLevelTable(),e=this.FTableItem.SelectCellRang.StartRow>=0?this.FTableItem.Rows[this.FTableItem.SelectCellRang.StartRow][this.FTableItem.SelectCellRang.StartCol]:this.FTableItem.Rows[0][0],this.beginUpdate();try{this.cbbBackColor.color=e.BackgroundColor,this.chkLeft.checked=e.BorderSides.has(Zl.Left),this.chkTop.checked=e.BorderSides.has(Zl.Top),this.chkRight.checked=e.BorderSides.has(Zl.Right),this.chkBottom.checked=e.BorderSides.has(Zl.Bottom),this.chkLTRB.checked=e.BorderSides.has(Zl.LTRB),this.chkRTLB.checked=e.BorderSides.has(Zl.RTLB),e.LeftBorderStyle===_t.Dash?this.cbbBdL.itemIndex=1:this.cbbBdL.itemIndex=0,e.TopBorderStyle===_t.Dash?this.cbbBdT.itemIndex=1:this.cbbBdT.itemIndex=0,e.RightBorderStyle===_t.Dash?this.cbbBdR.itemIndex=1:this.cbbBdR.itemIndex=0,e.BottomBorderStyle===_t.Dash?this.cbbBdB.itemIndex=1:this.cbbBdB.itemIndex=0}finally{this.endUpdate()}this.showModal((function(){t.BeginUpdate();try{if(0===i.cbbRang.itemIndex)if(i.FTableItem.SelectCellRang.EditCell())i.SetCellBorderBack(i.FTableItem.SelectCellRang.StartRow,i.FTableItem.SelectCellRang.StartCol);else if(i.FTableItem.SelectCellRang.StartRow>=0)for(var e=i.FTableItem.SelectCellRang.StartRow;e<=i.FTableItem.SelectCellRang.EndRow;e++)for(var n=i.FTableItem.SelectCellRang.StartCol;n<=i.FTableItem.SelectCellRang.EndCol;n++)i.SetCellBorderBack(e,n);else i.ApplyAllTable();else if(1===i.cbbRang.itemIndex)if(i.FTableItem.SelectCellRang.StartRow>=0)for(var o=i.FTableItem.SelectCellRang.StartRow,s=0;s<i.FTableItem.ColCount;s++)i.SetCellBorderBack(o,s);else i.ApplyAllTable();else if(2===i.cbbRang.itemIndex)if(i.FTableItem.SelectCellRang.StartCol>=0)for(var r=i.FTableItem.SelectCellRang.StartCol,a=0;a<i.FTableItem.RowCount;a++)i.SetCellBorderBack(a,r);else i.ApplyAllTable();else i.ApplyAllTable();t.Style.UpdateInfoRePaint()}finally{t.EndUpdate()}}))}}]),i}(Dh);function bf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Bf=function(t){m()(i,t);var e=bf(i);function i(t){var n;r()(this,i),(n=e.call(this,t)).width_=140,n.height_=135,n.init_=!1;var o=new Ki(n.hcl,"字体：");o.left=13,o.top=5,n.cbbFont=new Fn(n.hcl,""),n.cbbFont.static=!0,n.cbbFont.autoDropDownWidth=!0,n.cbbFont.left=o.right,n.cbbFont.top=2,n.cbbFont.onSelectedIndexChange=function(){n.DoFontChange()};var s=new Ki(n.hcl,"字号：");s.left=o.left,s.top=30,n.cbbFontSize=new mn(n.hcl,""),n.cbbFontSize.static=!0,n.cbbFontSize.left=s.right,n.cbbFontSize.top=s.top-2,n.cbbFontSize.dropDownWidth=64,n.cbbFontSize.state=!0,n.cbbFontSize.addItem("初号"),n.cbbFontSize.addItem("小初"),n.cbbFontSize.addItem("一号"),n.cbbFontSize.addItem("小一"),n.cbbFontSize.addItem("二号"),n.cbbFontSize.addItem("小二"),n.cbbFontSize.addItem("三号"),n.cbbFontSize.addItem("小三"),n.cbbFontSize.addItem("四号"),n.cbbFontSize.addItem("小四"),n.cbbFontSize.addItem("五号"),n.cbbFontSize.addItem("小五"),n.cbbFontSize.addItem("10"),n.cbbFontSize.addItem("10.5"),n.cbbFontSize.addItem("11"),n.cbbFontSize.addItem("12"),n.cbbFontSize.addItem("14"),n.cbbFontSize.addItem("16"),n.cbbFontSize.addItem("18"),n.cbbFontSize.addItem("20"),n.cbbFontSize.addItem("22"),n.cbbFontSize.addItem("24"),n.cbbFontSize.addItem("26"),n.cbbFontSize.addItem("28"),n.cbbFontSize.addItem("36"),n.cbbFontSize.addItem("48"),n.cbbFontSize.addItem("72"),n.cbbFontSize.itemIndex=10,n.cbbFontSize.onSelectedIndexChange=function(){n.DoFontSizeChange()};var a=new Ki(n.hcl,"颜色：");a.left=o.left,a.top=55,n.cbbTextColor=new In(n.hcl,Ft.Black),n.cbbTextColor.left=a.right,n.cbbTextColor.top=a.top-2,n.cbbTextColor.width=n.cbbFontSize.width,n.cbbTextColor.onSelectedIndexChange=function(){n.DoFontColorChange()};var l=new Ki(n.hcl,"背景色：");l.left=o.left-13,l.top=82,n.cbbBKColor=new In(n.hcl,Ft.Transparent,!0),n.cbbBKColor.left=l.right,n.cbbBKColor.top=l.top-2,n.cbbBKColor.width=n.cbbFontSize.width,n.cbbBKColor.onSelectedIndexChange=function(){n.DoBKColorChange()};var h=new Ki(n.hcl,"样式：");h.left=o.left,h.top=109,n.incResWait(),n.btnBold=new Qi(n.hcl,""),n.btnBold.align=Yt,n.btnBold.image.onImageLoaded=function(t,e){t&&n.decResWait()},n.btnBold.image.src=n.hcl.emrCommon.ResBold,n.btnBold.left=h.right,n.btnBold.top=107,n.btnBold.onClick=function(){n.btnBold.checked=!n.btnBold.checked,n.DoFontStyleChange()},n.incResWait(),n.btnItalic=new Qi(n.hcl,""),n.btnItalic.align=Yt,n.btnItalic.image.onImageLoaded=function(t,e){t&&n.decResWait()},n.btnItalic.image.src=n.hcl.emrCommon.ResItalic,n.btnItalic.left=n.btnBold.right,n.btnItalic.top=n.btnBold.top,n.btnItalic.onClick=function(){n.btnItalic.checked=!n.btnItalic.checked,n.DoFontStyleChange()},n.incResWait(),n.btnUnderline=new Qi(n.hcl,""),n.btnUnderline.align=Yt,n.btnUnderline.image.onImageLoaded=function(t,e){t&&n.decResWait()},n.btnUnderline.image.src=n.hcl.emrCommon.ResUnderline,n.btnUnderline.left=n.btnItalic.right,n.btnUnderline.top=n.btnBold.top,n.btnUnderline.onClick=function(){n.btnUnderline.checked=!n.btnUnderline.checked,n.DoFontStyleChange()},n.incResWait(),n.btnStrikeOut=new Qi(n.hcl,""),n.btnStrikeOut.align=Yt,n.btnStrikeOut.image.onImageLoaded=function(t,e){t&&n.decResWait()},n.btnStrikeOut.image.src=n.hcl.emrCommon.ResStrikeout,n.btnStrikeOut.left=n.btnUnderline.right,n.btnStrikeOut.top=n.btnBold.top,n.btnStrikeOut.onClick=function(){n.btnStrikeOut.checked=!n.btnStrikeOut.checked,n.DoFontStyleChange()},n.beginUpdate();try{n.addControl(o),n.addControl(n.cbbFont),n.addControl(s),n.addControl(n.cbbFontSize),n.addControl(a),n.addControl(n.cbbTextColor),n.addControl(h),n.addControl(l),n.addControl(n.cbbBKColor),n.addControl(n.btnBold),n.addControl(n.btnItalic),n.addControl(n.btnUnderline),n.addControl(n.btnStrikeOut)}finally{n.endUpdate()}return n.OnFontChange=null,n.OnFontSizeChange=null,n.OnFontColorChange=null,n.OnBKColorChange=null,n.OnFontStyleChange=null,n}return l()(i,[{key:"DoFontChange",value:function(){this.init_||null===this.OnFontChange||this.OnFontChange()}},{key:"DoFontSizeChange",value:function(){this.init_||null===this.OnFontSizeChange||this.OnFontSizeChange()}},{key:"DoFontColorChange",value:function(){this.init_||null===this.OnFontColorChange||this.OnFontColorChange()}},{key:"DoBKColorChange",value:function(){this.init_||null===this.OnBKColorChange||this.OnBKColorChange()}},{key:"DoFontStyleChange",value:function(){this.init_||null===this.OnFontStyleChange||this.OnFontStyleChange()}},{key:"InitFont",value:function(t){this.init_=!0;try{this.cbbTextColor.color=t.Color,this.cbbBKColor.color=t.BackColor,this.cbbFont.itemIndex=this.cbbFont.items.indexOf(t.Name||t.Family),this.cbbFontSize.itemIndex=this.cbbFontSize.items.indexOf(Nt.fontPtToSize(t.Size)),t.FontStyles?(this.btnBold.checked=t.FontStyles.has(Wn.Bold),this.btnItalic.checked=t.FontStyles.has(Wn.Italic),this.btnUnderline.checked=t.FontStyles.has(Wn.Underline),this.btnStrikeOut.checked=t.FontStyles.has(Wn.Strikeout)):(this.btnBold.checked=t.Style.has(Wn.Bold),this.btnItalic.checked=t.Style.has(Wn.Italic),this.btnUnderline.checked=t.Style.has(Wn.Underline),this.btnStrikeOut.checked=t.Style.has(Wn.Strikeout))}finally{this.init_=!1}}}]),i}(Bi);function Nf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Of=function(t){m()(i,t);var e=Nf(i);function i(t){var n;r()(this,i),(n=e.call(this,t,150,190)).caption="样式设置",n.pad=new Bf(t),n.pad.left=8,n.pad.top=0,n.btnOk=new Ji(t,"保存"),n.btnOk.top=n.pad.height+5,n.btnOk.left=33,n.btnOk.onClick=function(){n.modalResult=wh,n.close()},n.beginUpdate();try{n.addControl(n.pad),n.addControl(n.btnOk)}finally{n.endUpdate()}return n}return l()(i)}(Dh);function _f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Ef=function(t){m()(i,t);var e=_f(i);function i(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:320,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:290;r()(this,i),(n=e.call(this,t,o,s,2)).caption="数据组",n.chkDeleteAllow=new en(t,"允许删除"),n.chkDeleteAllow.hint="是否允许删除该数据组",n.chkDeleteAllow.left=5,n.chkDeleteAllow.top=3,n.chkCanEdit=new en(t,"允许修改内容"),n.chkCanEdit.hint="是否允许修改数据组中的内容",n.chkCanEdit.left=n.chkDeleteAllow.right+10,n.chkCanEdit.top=3,n.chkAllocMust=new en(t,"必填"),n.chkAllocMust.hint="该数据组是否必填",n.chkAllocMust.left=n.chkCanEdit.right+10,n.chkAllocMust.top=3,n.chkKeepParaFirst=new en(t,"保持段首"),n.chkKeepParaFirst.hint="起始标识是保持段首",n.chkKeepParaFirst.left=n.chkAllocMust.right+10,n.chkKeepParaFirst.top=3,n.btnTitleStyle=new Ji(t,"修改标题样式"),n.btnTitleStyle.hint="设置Ttile属性(标题文本)样式",n.btnTitleStyle.left=5,n.btnTitleStyle.top=n.chkCanEdit.bottom+5,n.btnTitleStyle.width=90,n.btnTitleStyle.onClick=function(){n.SetTitleStyle()},n.btnTextStyle=new Ji(t,"修改默认文本样式"),n.btnTextStyle.hint="在空数据组中输入文本时使用的样式",n.btnTextStyle.left=n.btnTitleStyle.right+10,n.btnTextStyle.top=n.chkCanEdit.bottom+5,n.btnTextStyle.width=115,n.btnTextStyle.onClick=function(){n.SetTextStyle()},n.beginUpdate();try{n.addControl(n.chkDeleteAllow),n.addControl(n.chkAllocMust),n.addControl(n.chkKeepParaFirst),n.addControl(n.chkCanEdit),n.addControl(n.btnTitleStyle),n.addControl(n.btnTextStyle)}finally{n.endUpdate()}return n.DeGroup=null,n.Data=null,n.TitleStyleNo=-1,n.TextStyleNo=-1,n}return l()(i,[{key:"SetTitleStyle",value:function(){var t=this,e=new Of(this.hcl);e.caption="标题样式",e.pad.InitFont(this.Data.Style.TextStyles[this.TitleStyleNo]),e.moveCenter(),e.showModal((function(){var i=new zn(t.hcl);i.AssignEx(t.Data.Style.TextStyles[t.TitleStyleNo]),i.Family=e.pad.cbbFont.text,i.Color=e.pad.cbbTextColor.color,i.BackColor=e.pad.cbbBKColor.color,i.Size=Nt.fontSizeToPt(e.pad.cbbFontSize.text),e.pad.btnBold.checked?i.FontStyles.add(Wn.Bold):i.FontStyles.remove(Wn.Bold),e.pad.btnItalic.checked?i.FontStyles.add(Wn.Italic):i.FontStyles.remove(Wn.Italic),e.pad.btnUnderline.checked?i.FontStyles.add(Wn.Underline):i.FontStyles.remove(Wn.Underline),e.pad.btnStrikeOut.checked?i.FontStyles.add(Wn.Strikeout):i.FontStyles.remove(Wn.Strikeout),t.TitleStyleNo=t.Data.Style.GetStyleNo(i,!0),i=null}))}},{key:"SetTextStyle",value:function(){var t=this,e=new Of(this.hcl);e.caption="文本样式",e.pad.InitFont(this.Data.Style.TextStyles[this.TextStyleNo]),e.moveCenter(),e.showModal((function(){var i=new zn(t.hcl);i.AssignEx(t.Data.Style.TextStyles[t.TextStyleNo]),i.Family=e.pad.cbbFont.text,i.Color=e.pad.cbbTextColor.color,i.BackColor=e.pad.cbbBKColor.color,i.Size=Nt.fontSizeToPt(e.pad.cbbFontSize.text),e.pad.btnBold.checked?i.FontStyles.add(Wn.Bold):i.FontStyles.remove(Wn.Bold),e.pad.btnItalic.checked?i.FontStyles.add(Wn.Italic):i.FontStyles.remove(Wn.Italic),e.pad.btnUnderline.checked?i.FontStyles.add(Wn.Underline):i.FontStyles.remove(Wn.Underline),e.pad.btnStrikeOut.checked?i.FontStyles.add(Wn.Strikeout):i.FontStyles.remove(Wn.Strikeout),t.TextStyleNo=t.Data.Style.GetStyleNo(i,!0),i=null}))}},{key:"SetView",value:function(t){var e=this;this.Data=t.ActiveSectionTopLevelData();var i=this.Data.ActiveDomain;if(!(i.BeginNo<0)){this.DeGroup=this.Data.Items[i.BeginNo],this.TitleStyleNo=this.DeGroup.TitleStyleNo,this.TextStyleNo=this.DeGroup.TextStyleNo,this.beginUpdate();try{""!=this.DeGroup.GetValue(bc.Name)&&(this.caption+="-"+this.DeGroup.GetValue(bc.Name)),this.chkDeleteAllow.checked=this.DeGroup.DeleteAllow,this.chkCanEdit.checked=!this.DeGroup.EditProtect,this.chkAllocMust.checked=this.DeGroup.AllocMust,this.chkKeepParaFirst.checked=this.DeGroup.KeepParaFirst,this.getPropertys(this.DeGroup.Propertys),this.moveCenter()}finally{this.endUpdate()}this.showModal((function(){e.TitleStyleNo!==e.DeGroup.TitleStyleNo&&(e.DeGroup.TitleStyleNo=e.TitleStyleNo),e.TextStyleNo!==e.DeGroup.TextStyleNo&&(e.DeGroup.TextStyleNo=e.TextStyleNo),e.DeGroup.DeleteAllow=e.chkDeleteAllow.checked,e.DeGroup.EditProtect=!e.chkCanEdit.checked,e.DeGroup.AllocMust=e.chkAllocMust.checked,e.DeGroup.KeepParaFirst=e.chkKeepParaFirst.checked,e.setPropertys(e.DeGroup.Propertys),e.DeGroup.PropertyChange(),e.DeGroup=e.Data.Items[i.EndNo],e.TitleStyleNo!==e.DeGroup.TitleStyleNo&&(e.DeGroup.TitleStyleNo=e.TitleStyleNo),e.TextStyleNo!==e.DeGroup.TextStyleNo&&(e.DeGroup.TextStyleNo=e.TextStyleNo),e.DeGroup.DeleteAllow=e.chkDeleteAllow.checked,e.DeGroup.EditProtect=!e.chkCanEdit.checked,e.DeGroup.AllocMust=e.chkAllocMust.checked,e.setPropertys(e.DeGroup.Propertys),e.DeGroup.PropertyChange(),e.Data.isClass(Jl)&&e.Data.FormatDirty(),t.ActiveSection.ReFormatActiveParagraph()}))}}}]),i}(Sf);function Mf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Lf=function(t){m()(i,t);var e=Mf(i);function i(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:225,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:160;r()(this,i),n=e.call(this,t,o,s);var a=new Ki(t,"标题：");a.left=10,a.top=10,n.edtTitle=new on(t,""),n.edtTitle.left=a.left,n.edtTitle.top=a.bottom+5,n.edtTitle.width=200;var l=new Ki(t,"批注：");l.left=a.left,l.top=n.edtTitle.bottom+10,n.edtText=new on(t,""),n.edtText.left=l.left,n.edtText.top=l.bottom+5,n.edtText.width=200,n.btnOK=new Ji(t,"确定"),n.btnOK.left=Math.trunc((n.width-n.btnOK.width)/2),n.btnOK.top=n.edtText.bottom+10,n.btnOK.onClick=function(){n.modalResult=wh,n.close()},n.beginUpdate();try{n.addControl(a),n.addControl(n.edtTitle),n.addControl(l),n.addControl(n.edtText),n.addControl(n.btnOK),n.moveCenter()}finally{n.endUpdate()}return n}return l()(i,[{key:"SetAnnotate",value:function(t){null!=t?(this.btnOK.text="修改",this.edtTitle.text=t.Content.Title,this.edtText.text=t.Content.Text,this.caption="批注序号-"+t.ID.toString()):(this.btnOK.text="确定",this.caption="新建批注",this.edtTitle.clear(),this.edtText.clear())}}]),i}(Dh);function Gf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Hf=function(t){m()(i,t);var e=Gf(i);function i(t){var n;r()(this,i),(n=e.call(this,t,335,320)).caption="DeImage属性",n.imageItem=null;var o=new Ki(t,"宽(像素)");o.left=5,o.top=13,n.edtWidth=new an(t),n.edtWidth.left=o.right+5,n.edtWidth.top=10,n.edtWidth.width=32;var s=new Ki(t,"高(像素)");s.left=108,s.top=13,n.edtHeight=new an(t),n.edtHeight.left=s.right+5,n.edtHeight.top=10,n.edtHeight.width=32,n.btnResize=new Ji(t,"恢复为原始尺寸"),n.btnResize.left=n.edtHeight.right+5,n.btnResize.top=10,n.btnResize.width=105,n.btnResize.onClick=function(){n.edtWidth.text=n.imageItem.Image.width.toString(),n.edtHeight.text=n.imageItem.Image.height.toString()},n.chkCanEdit=new en(t,"允许修改"),n.chkCanEdit.left=5,n.chkCanEdit.top=n.edtHeight.bottom+5,n.chkDeleteAllow=new en(t,"允许删除"),n.chkDeleteAllow.left=n.chkCanEdit.right+13,n.chkDeleteAllow.top=n.chkCanEdit.top,n.chkCanResize=new en(t,"允许调整大小"),n.chkCanResize.left=n.chkDeleteAllow.right+10,n.chkCanResize.top=n.chkDeleteAllow.top,n.chkCanCopy=new en(t,"允许复制"),n.chkCanCopy.left=5,n.chkCanCopy.top=n.chkCanResize.bottom+5,n.beginUpdate();try{n.addControl(n.btnResize),n.addControl(o),n.addControl(n.edtWidth),n.addControl(s),n.addControl(n.edtHeight),n.addControl(n.chkCanEdit),n.addControl(n.chkDeleteAllow),n.addControl(n.chkCanResize),n.addControl(n.chkCanCopy)}finally{n.endUpdate()}return n}return l()(i,[{key:"SetView",value:function(t,e){var i=this;this.imageItem=e,this.beginUpdate();try{""!=e.GetValue(Yh.Name)&&(this.caption+="["+e.GetValue(Yh.Name)+"]"),this.edtWidth.text=e.Width.toString(),this.edtHeight.text=e.Height.toString(),this.chkCanEdit.checked=!e.EditProtect,this.chkDeleteAllow.checked=e.DeleteAllow,this.chkCanResize.checked=e.CanResize,this.chkCanCopy.checked=!e.CopyProtect,this.getPropertys(e.Propertys),this.moveCenter()}finally{this.endUpdate()}this.showModal((function(){e.Width=Math.max(5,L.parseIntDef(i.edtWidth.text,e.Width)),e.Height=Math.max(5,L.parseIntDef(i.edtHeight.text,e.Height)),e.EditProtect=!i.chkCanEdit.checked,e.DeleteAllow=i.chkDeleteAllow.checked,e.CanResize=i.chkCanResize.checked,e.CopyProtect=!i.chkCanCopy.checked,i.setPropertys(e.Propertys),t.BeginUpdate();try{var n=t.ActiveSectionTopLevelData();n.isClass(Jl)&&n.FormatDirty(),t.ActiveSection.ReFormatActiveItem()}finally{t.EndUpdate()}}))}}]),i}(Sf);function Vf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Uf=function(t){m()(i,t);var e=Vf(i);function i(t){var n;r()(this,i),(n=e.call(this,t,360,350)).caption="DeCheckbox属性",n.chkAutoSize=new en(t,"自动计算宽高"),n.chkAutoSize.left=23,n.chkAutoSize.top=11,n.chkAutoSize.onSwitch=function(){n.edtWidth.enabled=!n.chkAutoSize.checked,n.edtHeight.enabled=!n.chkAutoSize.checked};var o=new Ki(t,"宽(像素)");o.left=131,o.top=13,n.edtWidth=new an(t),n.edtWidth.left=o.right+5,n.edtWidth.top=10,n.edtWidth.width=32;var s=new Ki(t,"高(像素)");s.left=233,s.top=13,n.edtHeight=new an(t),n.edtHeight.left=s.right+5,n.edtHeight.top=10,n.edtHeight.width=32,n.edtText=new hn(t,"文本",""),n.edtText.left=n.chkAutoSize.left-5,n.edtText.top=n.chkAutoSize.bottom+5,n.edtText.width=200,n.chkDeleteAllow=new en(t,"允许删除"),n.chkDeleteAllow.left=n.chkAutoSize.left,n.chkDeleteAllow.top=n.edtText.bottom+5,n.chkItemHit=new en(t,"点击文本切换选中"),n.chkItemHit.left=n.chkDeleteAllow.right+5,n.chkItemHit.top=n.chkDeleteAllow.top,n.chkAutoWrap=new en(t,"自动换行"),n.chkAutoWrap.left=n.chkItemHit.right+5,n.chkAutoWrap.top=n.chkItemHit.top,n.chkAllocValue=new en(t,"已填值"),n.chkAllocValue.left=n.chkAutoSize.left,n.chkAllocValue.top=n.chkDeleteAllow.bottom+5,n.chkEditProtect=new en(t,"允许修改"),n.chkEditProtect.left=n.chkItemHit.left,n.chkEditProtect.top=n.chkAllocValue.top,n.beginUpdate();try{n.addControl(n.chkAutoSize),n.addControl(o),n.addControl(n.edtWidth),n.addControl(s),n.addControl(n.edtHeight),n.addControl(n.edtText),n.addControl(n.chkDeleteAllow),n.addControl(n.chkItemHit),n.addControl(n.chkAutoWrap),n.addControl(n.chkAllocValue),n.addControl(n.chkEditProtect)}finally{n.endUpdate()}return n}return l()(i,[{key:"SetView",value:function(t,e){var i=this;this.beginUpdate();try{""!=e.GetValue(Yh.Name)&&(this.caption+="["+e.GetValue(Yh.Name)+"]"),this.chkAutoSize.checked=e.AutoSize,this.edtWidth.enabled=!this.chkAutoSize.checked,this.edtHeight.enabled=!this.chkAutoSize.checked,this.edtWidth.text=e.Width.toString(),this.edtHeight.text=e.Height.toString(),this.edtText.text=e.Text,this.chkDeleteAllow.checked=e.DeleteAllow,this.chkItemHit.checked=e.ItemHit,this.chkAutoWrap.checked=e.AutoWrap,this.chkAllocValue.checked=e.AllocValue,this.chkEditProtect.checked=!e.EditProtect,this.getPropertys(e.Propertys),this.moveCenter()}finally{this.endUpdate()}this.showModal((function(){e.AutoSize=i.chkAutoSize.checked,i.chkAutoSize.checked||(e.Width=L.parseIntDef(i.edtWidth.text,e.width),e.Height=L.parseIntDef(i.edtHeight.text,e.Height)),e.Text=i.edtText.text,e.DeleteAllow=i.chkDeleteAllow.checked,e.ItemHit=i.chkItemHit.checked,e.AutoWrap=i.chkAutoWrap.checked,e.AllocValue=i.chkAllocValue.checked,e.EditProtect=!i.chkEditProtect.checked,i.setPropertys(e.Propertys),t.BeginUpdate();try{var n=t.ActiveSectionTopLevelData();n.isClass(Jl)&&n.FormatDirty(),t.ActiveSection.ReFormatActiveItem()}finally{t.EndUpdate()}}))}}]),i}(Sf);function Wf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var zf=function(t){m()(i,t);var e=Wf(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).color=t.rgbaToColor(82,89,107),n.canFocus=!0,n.cursor=Ce,n._canvas=document.createElement("canvas"),n._context=n._canvas.getContext("2d"),n.FDataBmpCanvas=new zt(t,n._context),En.Initialization(t),0===Yl.HCExtFormat&&(Yl.HCExtFormat=t.clipboard.registerFormat()),n.FUndoList=new ns,n.FUndoList.OnUndo=function(t){n.DoUndo(t)},n.FUndoList.OnRedo=function(t){n.DoRedo(t)},n.FUndoList.OnUndoNew=function(){return n.DoUndoNew()},n.FUndoList.OnUndoGroupStart=function(t,e){return n.DoUndoGroupBegin(t,e)},n.FUndoList.OnUndoGroupEnd=function(t,e){return n.DoUndoGroupEnd(t,e)},n.FUpdateCount=0,n.FViewWidth=0,n.FViewHeight=0,n.FStyle=new oo(t,!0,!0),n.FStyle.OnInvalidateRect=function(t){n.DoStyleInvalidateRect(t)},n.FData=new zl(t,n.FStyle),n.FData.Width=200,n.FData.OnGetUndoList=function(){return n.DoGetUndoList()},n.FData.OnCreateItemByStyle=function(t,e){return n.DoDataCreateStyleItem(t,e)},n.FData.OnInsertItem=function(t,e){n.DoDataInsertItem(t,e)},n.FData.OnRemoveItem=function(t,e){n.DoDataRemoveItem(t,e)},n.FData.OnItemReFormatRequest=function(t,e){n.DoDataItemReFormatRequest(t,e)},n.FData.OnGetScreenCoord=function(t,e){return n.DoDataGetScreenCoord(t,e)},n.FVScrollBar=new Di(t),n.FVScrollBar.orientation=ee,n.FVScrollBar.align=Yt,n.FVScrollBar.onScroll=function(t,e,i){n.DoVerScroll(t,e,i)},n.FHScrollBar=new su(t),n.FHScrollBar.orientation=te,n.FHScrollBar.addStatus(100),n.FHScrollBar.align=Yt,n.FHScrollBar.onScroll=function(t,e,i){n.DoVerScroll(t,e,i)},n.controls.add(n.FHScrollBar),n.controls.add(n.FVScrollBar),n.handle_=t.handleAllocate(),n.FCaret=new dh(t),n.FCaret.control=Jt()(n),n.imeMode=_i,n.FChanged=!1,n.OnChange=null,n}return l()(i,[{key:"DoVerScroll",value:function(t,e,i){this.FStyle.UpdateInfoRePaint(),this.FStyle.UpdateInfoReCaret(!1),this.CheckUpdateInfo()}},{key:"GetViewWidth",value:function(){this.FVScrollBar.visible?this.FViewWidth=this.width-this.FVScrollBar.width:this.FViewWidth=this.width}},{key:"GetViewHeight",value:function(){this.FHScrollBar.visible?this.FViewHeight=this.height-this.FHScrollBar.height:this.FViewHeight=this.height}},{key:"GetCurStyleNo",value:function(){return this.FData.GetTopLevelData().CurParaNo}},{key:"GetCurParaNo",value:function(){return this.FData.GetTopLevelData().CurStyleNo}},{key:"ReBuildCaret",value:function(){if(null!=this.FCaret)if(!this.focused||!this.FStyle.UpdateInfo.DragingSelected&&this.FData.SelectExists())this.FCaret.Hide();else{var t=new fh;if(t.X=0,t.Y=0,t.Height=0,t.Visible=!0,this.FData.GetCaretInfoCur(t),t.Visible){if(this.FCaret.X=t.X-this.FHScrollBar.position+this.paddingLeft,this.FCaret.Y=t.Y-this.FVScrollBar.position+this.paddingTop,this.FCaret.Height=t.Height,this.FStyle.UpdateInfo.ReScroll){if(this.FCaret.X<0||this.FCaret.X>this.FViewWidth)return void this.FCaret.Hide();if(this.FCaret.Y+this.FCaret.Height<0||this.FCaret.Y>this.FViewHeight)return void this.FCaret.Height}else if(this.FCaret.Height<this.FViewHeight){if(!this.FCaret.VScroll){this.FCaret.VScroll=!0;try{this.FCaret.Y<0?this.FVScrollBar.position+=this.FCaret.Y-this.paddingTop:this.FCaret.Y+this.FCaret.Height+this.paddingTop>this.FViewHeight&&(this.FVScrollBar.position+=this.FCaret.Y+this.FCaret.Height+this.paddingTop-this.FViewHeight)}finally{this.FCaret.VScroll=!1}}if(!this.FCaret.HScroll){this.FCaret.HScroll=!0;try{this.FCaret.X?this.FHScrollBar.position+=this.FCaret.X-this.paddingLeft:this.FCaret.X+this.paddingLeft>this.FViewWidth&&(this.FHScrollBar.position+=this.FCaret.X+this.paddingLeft-this.FViewWidth)}finally{this.FCaret.HScroll=!1}}}this.FCaret.VScroll||this.FCaret.HScroll||(this.FCaret.Y+this.FCaret.Height>this.FViewHeight&&(this.FCaret.Height=this.FViewHeight-this.FCaret.Y),this.FCaret.Show(),this.DoCaretChange())}else this.FCaret.Hide()}}},{key:"CheckUpdateInfo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.FUpdateCount>0||(null!==this.FCaret&&this.FStyle.UpdateInfo.ReCaret&&(this.ReBuildCaret(t),this.FStyle.UpdateInfo.ReCaret=!1,this.FStyle.UpdateInfo.ReStyle=!1,this.FStyle.UpdateInfo.ReScroll=!1),this.FStyle.UpdateInfo.RePaint&&(this.FStyle.UpdateInfo.RePaint=!1,this.UpdateView()))}},{key:"DoMapChanged",value:function(){0===this.FUpdateCount&&(this.CalcScrollRang(),this.CheckUpdateInfo())}},{key:"DoCaretChange",value:function(){null!=this.OnCaretChange&&this.OnCaretChange(this,null)}},{key:"DoDataCheckUpdateInfo",value:function(){0===this.FUpdateCount&&this.CheckUpdateInfo()}},{key:"DoChange",value:function(){this.FChanged=!0,this.DoMapChanged(),null!==this.OnChange&&this.OnChange(this,null)}},{key:"CalcScrollRang",value:function(){this.FHScrollBar.max=this.paddingLeft+this.paddingRight,this.FVScrollBar.max=this.FData.height+this.paddingTop+this.paddingBottom}},{key:"_DeleteUnUsedStyle",value:function(){this.FStyle.TextStyles[0].CheckSaveUsed=!0,this.FStyle.TextStyles[0].TempNo=0;for(var t=1;t<this.FStyle.TextStyles.count;t++)this.FStyle.TextStyles[t].CheckSaveUsed=!1,this.FStyle.TextStyles[t].TempNo=oo.Null;for(var e=0;e<this.FStyle.ParaStyles.count;e++)this.FStyle.ParaStyles[e].CheckSaveUsed=!1,this.FStyle.ParaStyles[e].TempNo=oo.Null;this.FData.MarkStyleUsed(!0);for(var i=0,n=1;n<this.FStyle.TextStyles.count;n++)this.FStyle.TextStyles[n].CheckSaveUsed?this.FStyle.TextStyles[n].TempNo=n-i:i++;i=0;for(var o=0;o<this.FStyle.ParaStyles.count;o++)this.FStyle.ParaStyles[o].CheckSaveUsed?this.FStyle.ParaStyles[o].TempNo=o-i:i++;this.FData.MarkStyleUsed(!1);for(var s=this.FStyle.TextStyles.count-1;s>=1;s--)this.FStyle.TextStyles[s].CheckSaveUsed||this.FStyle.TextStyles.removeAt(s);for(var r=this.FStyle.ParaStyles.count-1;r>=0;r--)this.FStyle.ParaStyles[r].CheckSaveUsed||this.FStyle.ParaStyles.removeAt(r)}},{key:"doPaint_",value:function(t){t.bitBlt(0,0,this.FViewWidth,this.FViewHeight,this.FDataBmpCanvas,0,0,this.FViewWidth,this.FViewHeight),t.brush.color=this.color,t.fillBounds(this.FVScrollBar.left,this.FHScrollBar.top,this.FVScrollBar.width,this.FHScrollBar.height),f()(F()(i.prototype),"doPaint_",this).call(this,t)}},{key:"doResize_",value:function(){f()(F()(i.prototype),"doResize_",this).call(this),this.GetViewWidth(),this.GetViewHeight(),this.FViewWidth>0&&this.FViewHeight>0&&(this._canvas.width=this.FViewWidth,this._canvas.height=this.FViewHeight,this._context=this._canvas.getContext("2d"),this.FDataBmpCanvas=new zt(this.hcl,this._context),this.FDataBmpCanvas.prepareConext(this.hcl._scale)),this.FData.Width=this.FViewWidth-this.paddingLeft-this.paddingRight,this.FData.ReFormat(),this.FStyle.UpdateInfoRePaint(),null!==this.FCaret&&this.FStyle.UpdateInfoReCaret(!1),this.DoMapChanged()}},{key:"doSetBounds_",value:function(){this.FVScrollBar.left=this.width-this.FVScrollBar.width,this.FVScrollBar.height=this.height-this.FHScrollBar.height,this.FVScrollBar.pageSize=this.FVScrollBar.height,this.FHScrollBar.top=this.height-this.FHScrollBar.height,this.FHScrollBar.width=this.width-this.FVScrollBar.width,this.FHScrollBar.pageSize=this.FHScrollBar.width,f()(F()(i.prototype),"doSetBounds_",this).call(this)}},{key:"doSetFocus_",value:function(t){f()(F()(i.prototype),"doSetFocus_",this).call(this,t),this.focused&&this.imeMode===_i&&this.hcl.ime.setControl(this)}},{key:"imeActive",value:function(){this.FCaret.Show()}},{key:"doMouseDown_",value:function(t){var e=new fi;e.assign(t),e.x=t.x-this.paddingLeft-this.FHScrollBar.position,e.y=t.y-this.paddingTop+this.FVScrollBar.position,this.FData.MouseDown(e),this.CheckUpdateInfo(),f()(F()(i.prototype),"doMouseDown_",this).call(this,t)}},{key:"doMouseMove_",value:function(t){f()(F()(i.prototype),"doMouseMove_",this).call(this,t),this.FStyle.Cursor=Ce;var e=new fi;e.assign(t),e.x=t.x-this.paddingLeft-this.FHScrollBar.position,e.y=t.y-this.paddingTop+this.FVScrollBar.position,this.FData.MouseMove(e),this.cursor=this.FStyle.Cursor,this.CheckUpdateInfo()}},{key:"doMouseUp_",value:function(t){if(f()(F()(i.prototype),"doMouseUp_",this).call(this,t),this.imeMode===_i&&this.hcl.ime.setControl(this),t.button!==le){var e=new fi;e.assign(t),e.x=t.x-this.paddingLeft-this.FHScrollBar.position,e.y=t.y-this.paddingTop+this.FVScrollBar.position,this.FData.MouseUp(e),this.FStyle.UpdateInfo.DragingSelected&&(this.FStyle.Cursor=Se),this.cursor=this.FStyle.Cursor,this.CheckUpdateInfo(),this.FStyle.UpdateInfo.Selecting=!1,this.FStyle.UpdateInfo.DragingSelected=!1}}},{key:"doMouseWheel_",value:function(t){this.hcl.keyDownStates[He]?this.FHScrollBar.position-=t.delta:this.FVScrollBar.position-=t.delta}},{key:"doKeyDown_",value:function(t){f()(F()(i.prototype),"doKeyDown_",this).call(this,t),this.hcl.keyDownStates[He]&&t.keyCode===Ze?this.SelectAll():this.hcl.keyDownStates[He]&&t.keyCode===ei?this.Undo():this.hcl.keyDownStates[He]&&t.keyCode===ti?this.Redo():(this.FData.KeyDown(t),Yl.IsKeyDownEdit(t.keyCode)?this.DoChange():Yl.IsDirectionKey(t.keyCode)&&this.DoDataCheckUpdateInfo()),this.CheckUpdateInfo()}},{key:"doKeyUp_",value:function(t){f()(F()(i.prototype),"doKeyUp_",this).call(this,t),this.FData.KeyUp(t)}},{key:"doKeyPress_",value:function(t){f()(F()(i.prototype),"onKeyPress",this).call(this,t),Yl.IsKeyPressWant(t)&&(this.FData.KeyPress(t),this.DoChange(),this.CheckUpdateInfo())}},{key:"imeInput",value:function(t){""!==t&&this.InsertText(t)}},{key:"DoDrawItemPaintBefor",value:function(t,e,i,n,o,s,r,a,l,h,c,u){}},{key:"DoDataCreateStyleItem",value:function(t,e){return null!=this.FOnCreateStyleItem?this.FOnCreateStyleItem(t,e):null}},{key:"DoDataInsertItem",value:function(t,e){null!=this.OnInsertItem&&this.OnInsertItem(t,e)}},{key:"DoDataRemoveItem",value:function(t,e){null!=this.OnRemoveItem&&this.OnRemoveItem(t,e)}},{key:"DoDataItemReFormatRequest",value:function(t,e){t.CanEdit()&&(t.ReFormatActiveItem(),this.DoChange())}},{key:"DoDataGetScreenCoord",value:function(t,e){return this.clientToScreenAt(t,e)}},{key:"DataSaveLiteStream",value:function(t,e){Yl._SaveFileFormatAndVersion(t),t.writeByte(Yl.HC_STREAM_LITE),this.FStyle.SaveToStream(t),e()}},{key:"DataLoadLiteStream",value:function(t,e,i){var n=Yl._LoadFileFormatAndVersion(e);if(n.fileVersion>59&&e.readByte()!==Yl.HC_STREAM_LITE)console.error("调用DataLoadLiteStream时传递的数据不是LITE类型！");else{var o=new oo(this.hcl);o.LoadFromStream(e,n.fileVersion),t&&(this.FStyle.MergeStyle=!0);try{i(n.fileVersion,o)}finally{t&&(this.FStyle.MergeStyle=!1)}}}},{key:"InsertLiteStream",value:function(t){var e=this,i=!1;return this.DataLoadLiteStream(!0,t,(function(n,o){e.BeginUpdate();try{i=e.FData.GetTopLevelData().InsertStream(t,o,n)}finally{e.EndUpdate()}})),i}},{key:"DoCopyRequest",value:function(t){var e=this.FData.GetTopLevelItem();return e.StyleNo!==oo.Edit||!e.SelectTextExists()||t===ru.UnicodeText}},{key:"DoPasteRequest",value:function(t){return this.FData.GetTopLevelItem().StyleNo!==oo.Edit||t===ru.UnicodeText}},{key:"DoPasteFormatStream",value:function(t){return!0}},{key:"DoCopyAsStream",value:function(t){}},{key:"doCut_",value:function(t){this.doCopy_(t),this.FData.DeleteSelected(),this.CheckUpdateInfo()}},{key:"doCopy_",value:function(t){var e=this;if(this.FData.SelectExists()){this.FStyle.States.Include(oh.Copying);try{if(this.DoCopyRequest(ru.UnicodeText)){var i=this.FData.SaveSelectToText();t.clipboardData.setData(_.TXT,i)}if(this.DoCopyRequest(Yl.HCExtFormat)){var n=new ht;this.DoCopyAsStream(n),this.DataSaveLiteStream(n,(function(){e.FData.GetTopLevelData().SaveSelectToStream(n)})),t.clipboardData.setData(Yl.HC_EXT,n.toJSONString())}}finally{this.FStyle.States.Exclude(oh.Copying)}}}},{key:"doPaste_",value:function(t){this.FStyle.States.Include(oh.Pasting);try{if(t.clipboardData.types.indexOf(Yl.HC_EXT)>-1&&this.DoPasteRequest(Yl.HCExtFormat)){var e=new ht;if(e.fromJSONString(t.clipboardData.getData(Yl.HC_EXT)),!this.DoPasteFormatStream(e))return;this.InsertLiteStream(e)}else t.clipboardData.types.indexOf(_.TXT)>-1&&this.DoPasteRequest(ru.UnicodeText)&&(this.InsertText(t.clipboardData.getData(_.TXT)),this.DoMapChanged())}finally{this.FStyle.States.Exclude(oh.Pasting)}}},{key:"DataChangeByAction",value:function(t){var e=t();return this.DoChange(),e}},{key:"DoGetUndoList",value:function(){return this.FUndoList}},{key:"DoUndoNew",value:function(){var t=new Qo;return t.HScrollPos=this.FHScrollBar.position,t.VScrollPos=this.FVScrollBar.position,t.Data=this.FData,t}},{key:"DoUndoGroupBegin",value:function(t,e){var i=new qo;return i.HScrollPos=this.FHScrollBar.position,i.VScrollPos=this.FVScrollBar.position,i.Data=this.FData,i.CaretDrawItemNo=this.FData.CaretDrawItemNo,i}},{key:"DoUndoGroupEnd",value:function(t,e){var i=new es;return i.HScrollPos=this.FHScrollBar.position,i.VScrollPos=this.FVScrollBar.position,i.Data=this.FData,i.CaretDrawItemNo=this.FData.CaretDrawItemNo,i}},{key:"DoUndo",value:function(t){var e=this;(t instanceof Qo||t instanceof qo)&&(this.FHScrollBar.position=t.HScrollPos,this.FVScrollBar.position=t.VScrollPos),this.DoGetUndoList().GroupWorking?this.FData.Undo(t):this.DataChangeByAction((function(){return e.FData.Undo(t),!0}))}},{key:"DoRedo",value:function(t){var e=this;(t instanceof Qo||t instanceof qo)&&(this.FHScrollBar.position=t.HScrollPos,this.FVScrollBar.position=t.VScrollPos),this.DoGetUndoList().GroupWorking?this.FData.Redo(t):this.DataChangeByAction((function(){return e.FData.Redo(t),!0}))}},{key:"ApplyParaAlignHorz",value:function(t){this.FData.ApplyParaAlignHorz(t),this.CheckUpdateInfo()}},{key:"ApplyParaAlignVert",value:function(t){this.FData.ApplyParaAlignVert(t),this.CheckUpdateInfo()}},{key:"ApplyParaBackColor",value:function(t){this.FData.ApplyParaBackColor(t),this.CheckUpdateInfo()}},{key:"ApplyParaLineSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.FData.ApplyParaLineSpace(t,e),this.CheckUpdateInfo()}},{key:"ApplyTextStyle",value:function(t){this.FData.ApplyTextStyle(t),this.CheckUpdateInfo()}},{key:"ApplyTextFontName",value:function(t){this.FData.ApplyTextFontName(t),this.CheckUpdateInfo()}},{key:"ApplyTextFontSize",value:function(t){this.FData.ApplyTextFontSize(t),this.CheckUpdateInfo()}},{key:"ApplyTextColor",value:function(t){this.FData.ApplyTextColor(t),this.CheckUpdateInfo()}},{key:"ApplyTextBackColor",value:function(t){this.FData.ApplyTextBackColor(t),this.CheckUpdateInfo()}},{key:"InsertText",value:function(t){var e=this;return this.DataChangeByAction((function(){return e.FData.InsertText(t)}))}},{key:"InsertItem",value:function(t){var e=this;return this.DataChangeByAction((function(){return e.FData.InsertItem(t)}))}},{key:"InsertItemEx",value:function(t,e){var i=this;return this.DataChangeByAction((function(){return i.FData.InsertItemEx(t,e)}))}},{key:"InsertDomain",value:function(t){var e=this;return this.DataChangeByAction((function(){return e.FData.InsertDomain(t)}))}},{key:"InsertTable",value:function(t,e){var i=this;return this.DataChangeByAction((function(){return i.FData.GetTopLevelData().InsertTable(t,e)}))}},{key:"TopLevelData",value:function(){return this.FData.GetTopLevelData()}},{key:"SetActiveItemText",value:function(t){this.FData.SetActiveItemText(t),this.CheckUpdateInfo()}},{key:"SelectAll",value:function(){this.FData.SelectAll(),this.FStyle.UpdateInfoRePaint(),this.CheckUpdateInfo()}},{key:"SaveToFile",value:function(t){}},{key:"LoadFromFile",value:function(t){}},{key:"SaveToStream",value:function(t){Yl._SaveFileFormatAndVersion(t),t.writeByte(Yl.HC_STREAM_LITE),this._DeleteUnUsedStyle(),this.FStyle.SaveToStream(t),this.FData.SaveToStream(t)}},{key:"SaveToLiteStream",value:function(t){Yl._SaveFileFormatAndVersion(t),t.writeByte(Yl.HC_STREAM_LITE),this._DeleteUnUsedStyle(),this.FData.SaveToStreamRangeAll(t)}},{key:"LoadFromStream",value:function(t){this.BeginUpdate();try{this.FUndoList.clear(),this.FUndoList.SaveState();try{this.FUndoList.Enable=!1,this.FData.Clear(),this.FStyle.Initialize(),t.position=0;var e=Yl._LoadFileFormatAndVersion(t);if(e.fileExt!==Yl.HC_EXT&&this.hcl.exception("加载失败，仅支持"+Yl.HC_EXT+"文件！实际为"+e.fileExt+"文件"),e.fileVersion>59&&t.readByte()!==Yl.HC_STREAM_LITE)return void console.error("调用LoadFromStream时传递的数据不是LITE类型！");this.FStyle.LoadFromStream(t,e.fileVersion),this.FData.LoadFromStream(t,this.FStyle,e.fileVersion),this.DoMapChanged()}finally{this.FUndoList.RestoreState()}}finally{this.EndUpdate()}}},{key:"Clear",value:function(){this.FData.Clear()}},{key:"Undo",value:function(){this.FStyle.States.Include(oh.Undoing);try{if(this.FUndoList.Enable)try{this.FUndoList.Enable=!1,this.BeginUpdate();try{this.FUndoList.Undo()}finally{this.EndUpdate()}}finally{this.FUndoList.Enable=!0}}finally{this.FStyle.States.Exclude(oh.Undoing)}}},{key:"Redo",value:function(){this.FStyle.States.Include(oh.Redoing);try{if(this.FUndoList.Enable)try{this.FUndoList.Enable=!1,this.BeginUpdate();try{this.FUndoList.Redo()}finally{this.EndUpdate()}}finally{this.FUndoList.Enable=!0}}finally{this.FStyle.States.Exclude(oh.Redoing)}}},{key:"UndoGroupBegin",value:function(){this.FUndoList.Enable&&this.FUndoList.UndoGroupBegin(this.FData.SelectInfo.StartItemNo,this.FData.SelectInfo.StartItemOffset)}},{key:"UndoGroupEnd",value:function(){this.FUndoList.Enable&&this.FUndoList.UndoGroupEnd(this.FData.SelectInfo.StartItemNo,this.FData.SelectInfo.StartItemOffset)}},{key:"GetViewRect",value:function(){return nt.CreateByBounds(this.paddingLeft,this.paddingTop,this.FViewWidth,this.FViewHeight)}},{key:"UpdateView",value:function(){this.UpdateViewRect(this.GetViewRect())}},{key:"UpdateViewRect",value:function(t){if(!this.FStyle.States.Contain(oh.Destroying)&&0==this.FUpdateCount){this.FDataBmpCanvas.save();try{this.FDataBmpCanvas.clipRect(t),this.FDataBmpCanvas.brush.color=this.FStyle.BackgroundColor,this.FDataBmpCanvas.fillRect(nt.CreateByBounds(0,0,this.FViewWidth,this.FViewHeight));var e=new go;this.FData.PaintData(this.paddingLeft-this.FHScrollBar.position,this.paddingTop,this.width-this.FHScrollBar.position-this.paddingRight,this.paddingTop+this.FData.height,this.paddingTop,this.height-this.FHScrollBar.height,this.FVScrollBar.position,this.FDataBmpCanvas,e),e.PaintTopItems(this.FDataBmpCanvas),this.FDataBmpCanvas.pen.width=1,this.FDataBmpCanvas.pen.color=Yl.clActiveBorder,this.FDataBmpCanvas.rectangle(0,0,this.width,this.height)}finally{this.FDataBmpCanvas.restore()}this.updateRect(t)}}},{key:"BeginUpdate",value:function(){this.FUpdateCount++}},{key:"EndUpdate",value:function(){this.FUpdateCount--,this.DoMapChanged()}},{key:"CurStyleNo",get:function(){return this.GetCurStyleNo()}},{key:"CurParaNo",get:function(){return this.GetCurParaNo()}},{key:"Data",get:function(){return this.FData}},{key:"Style",get:function(){return this.FStyle}},{key:"Changed",get:function(){return this.FChanged},set:function(t){this.FChanged=t}}]),i}(Bi);function Kf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Jf=function(t){m()(i,t);var e=Kf(i);function i(t){var n;r()(this,i),(n=e.call(this,t,400,400)).caption="表格属性(行、列序号均以0开始)",n.pgTable=new Dn(t),n.pgTable.showCloseButton=!1,n.pgTable.borderVisible=!1,n.pgTable.align=$t;var o=n.pgTable.addPage();o.text="表格";var s=new Ki(t,"单元格边距");s.left=14,s.top=10,o.addControl(s),n.edtCellHPadding=new hn(t,"左右",""),n.edtCellHPadding.left=33,n.edtCellHPadding.top=28,n.edtCellHPadding.width=90,o.addControl(n.edtCellHPadding),(s=new Ki(t,"毫米")).left=n.edtCellHPadding.right,s.top=n.edtCellHPadding.top+5,o.addControl(s),n.edtCellVPadding=new hn(t,"上下",""),n.edtCellVPadding.left=189,n.edtCellVPadding.top=n.edtCellHPadding.top,n.edtCellVPadding.width=90,o.addControl(n.edtCellVPadding),(s=new Ki(t,"毫米")).left=n.edtCellVPadding.right,s.top=n.edtCellVPadding.top+5,o.addControl(s),n.chkBorderVisible=new en(t,"显示边框"),n.chkBorderVisible.left=14,n.chkBorderVisible.top=64,o.addControl(n.chkBorderVisible),n.edtBorderWidth=new hn(t,"边框宽度(磅)",""),n.edtBorderWidth.left=n.chkBorderVisible.right+10,n.edtBorderWidth.top=64,n.edtBorderWidth.width=120,o.addControl(n.edtBorderWidth);var a=new Ji(t,"边框及背景");a.left=n.edtBorderWidth.right+15,a.top=64,a.width=90,a.onClick=function(){new Tf(t).SetView(n.FView)},o.addControl(a),(s=new Ki(t,"固定行(第1行值为0)")).left=14,s.top=98,o.addControl(s),n.edtFixRowFirst=new hn(t,"从第",""),n.edtFixRowFirst.left=33,n.edtFixRowFirst.top=118,n.edtFixRowFirst.width=60,o.addControl(n.edtFixRowFirst),n.edtFixRowLast=new hn(t,"行到第",""),n.edtFixRowLast.left=n.edtFixRowFirst.right+1,n.edtFixRowLast.top=n.edtFixRowFirst.top,n.edtFixRowLast.width=74,o.addControl(n.edtFixRowLast),(s=new Ki(t,"固定列(第1列值为0)")).left=14,s.top=146,o.addControl(s),n.edtFixColFirst=new hn(t,"从第",""),n.edtFixColFirst.left=33,n.edtFixColFirst.top=166,n.edtFixColFirst.width=60,o.addControl(n.edtFixColFirst),n.edtFixColLast=new hn(t,"列到第",""),n.edtFixColLast.left=n.edtFixColFirst.right+1,n.edtFixColLast.top=n.edtFixColFirst.top,n.edtFixColLast.width=74,o.addControl(n.edtFixColLast),n.chkDeleteAllow=new en(t,"允许删除此表格"),n.chkDeleteAllow.left=180,n.chkDeleteAllow.top=98,o.addControl(n.chkDeleteAllow),n.chkCanResize=new en(t,"允许拖动改变大小"),n.chkCanResize.left=180,n.chkCanResize.top=118,o.addControl(n.chkCanResize),n.chkResizeKeepWidth=new en(t,"拖动、插入列时保持宽度"),n.chkResizeKeepWidth.left=180,n.chkResizeKeepWidth.top=138,o.addControl(n.chkResizeKeepWidth),n.chkCanPageBreak=new en(t,"允许分页"),n.chkCanPageBreak.left=180,n.chkCanPageBreak.top=158,o.addControl(n.chkCanPageBreak),n.chkCanEdit=new en(t,"允许编辑"),n.chkCanEdit.left=180,n.chkCanEdit.top=178,o.addControl(n.chkCanEdit),n.initTableProperty(o),n.pageColumn=n.pgTable.addPage("数据列"),n.initColumnProperty(n.pageColumn),n.pageRow=n.pgTable.addPage(""),n.initRowProperty(n.pageRow),n.pageCell=n.pgTable.addPage("单元格"),n.mmoScript=new zf(t),n.mmoScript.hint="单元格脚本",n.mmoScript.left=10,n.mmoScript.top=10,n.mmoScript.width=n.width-20,n.mmoScript.height=180,n.mmoScript.Style.TextStyles[0].Family="Courier New",n.mmoScript.Style.ParaStyles[0].AlignHorz=Ln.Left,n.mmoScript.Style.ParaStyles[0].LineSpaceMode=Hn.PLS100,n.pageCell.addControl(n.mmoScript),n.initCellProperty(n.pageCell),n.pnlButton=new qi(t),n.pnlButton.height=40,n.pnlButton.borderVisible=!1,n.pnlButton.align=qt;var l=new Ki(t,"第一列为空时无效");l.left=2,l.top=10,l.font.color=Ft.OrangeRed,n.pnlButton.addControl(l);var h=new Ji(t,"新增行");h.left=l.right+5,h.top=5,h.width=55,h.onClick=function(){0===n.pgTable.pageIndex?(n.gridTableProperty.rowCount++,n.gridTableProperty.rows.last[0].value="",n.gridTableProperty.rows.last[1].value=""):1===n.pgTable.pageIndex?(n.gridColumnProperty.rowCount++,n.gridColumnProperty.rows.last[0].value="",n.gridColumnProperty.rows.last[1].value="",n.gridColumnProperty.rows.last[2].value=Object.keys(bn)[0],n.gridColumnProperty.rows.last[3].value=Object.keys(Tn)[0]):2===n.pgTable.pageIndex?(n.gridRowProperty.rowCount++,n.gridRowProperty.rows.last[0].value="",n.gridRowProperty.rows.last[1].value=""):(n.gridCellProperty.rowCount++,n.gridCellProperty.rows.last[0].value="",n.gridCellProperty.rows.last[1].value="")},n.pnlButton.addControl(h);var c=new Ji(t,"删除选中行");c.left=h.right+10,c.top=h.top,c.width=75,c.onClick=function(){0===n.pgTable.pageIndex?n.gridTableProperty.deleteRow(n.gridTableProperty.row):1===n.pgTable.pageIndex?n.gridColumnProperty.deleteRow(n.gridColumnProperty.row):2===n.pgTable.pageIndex?n.gridRowProperty.deleteRow(n.gridRowProperty.row):n.gridCellProperty.deleteRow(n.gridCellProperty.row)},n.pnlButton.addControl(c);var u=new Ji(t,"保存");u.left=c.right+20,u.top=c.top,u.width=55,u.onClick=function(){n.modalResult=wh,n.close()},n.pnlButton.addControl(u),n.beginUpdate();try{n.pgTable.pageIndex=0,n.addControl(n.pgTable),n.addControl(n.pnlButton)}finally{n.endUpdate()}return n}return l()(i,[{key:"initTableProperty",value:function(t){this.gridTableProperty=new Rn(this.hcl,1,2),this.gridTableProperty.marginLeft=5,this.gridTableProperty.marginRight=5,this.gridTableProperty.height=120,this.gridTableProperty.align=qt,this.gridTableProperty.fixRowCount=1,this.gridTableProperty.rows[0][0].value="表格键",this.gridTableProperty.rows[0][1].value="表格值",this.gridTableProperty.setColWidth(0,100),this.gridTableProperty.setColWidth(1,180),t.addControl(this.gridTableProperty)}},{key:"initRowProperty",value:function(t){var e=new Ki(this.hcl,"行高(像素)");e.left=14,e.top=10,t.addControl(e),this.edtRowHeight=new an(this.hcl),this.edtRowHeight.left=e.right,this.edtRowHeight.top=e.top-3,t.addControl(this.edtRowHeight),this.gridRowProperty=new Rn(this.hcl,1,2),this.gridRowProperty.marginLeft=5,this.gridRowProperty.marginRight=5,this.gridRowProperty.height=120,this.gridRowProperty.align=qt,this.gridRowProperty.fixRowCount=1,this.gridRowProperty.rows[0][0].value="行键",this.gridRowProperty.rows[0][1].value="行值",this.gridRowProperty.setColWidth(0,100),this.gridRowProperty.setColWidth(1,180),t.addControl(this.gridRowProperty)}},{key:"initCellProperty",value:function(t){this.gridCellProperty=new Rn(this.hcl,1,2),this.gridCellProperty.marginLeft=5,this.gridCellProperty.marginRight=5,this.gridCellProperty.height=120,this.gridCellProperty.align=qt,this.gridCellProperty.fixRowCount=1,this.gridCellProperty.rows[0][0].value="单元格键",this.gridCellProperty.rows[0][1].value="单元格值",this.gridCellProperty.setColWidth(0,100),this.gridCellProperty.setColWidth(1,180),t.addControl(this.gridCellProperty)}},{key:"initColumnProperty",value:function(t){var e=new Ki(this.hcl,"设置列的属性(注意第1列的列号是0)");e.marginLeft=5,e.marginTop=5,e.align=Xt,t.addControl(e),this.gridColumnProperty=new Nn(this.hcl,1,6),this.gridColumnProperty.marginLeft=5,this.gridColumnProperty.marginTop=5,this.gridColumnProperty.marginRight=5,this.gridColumnProperty.height=295,this.gridColumnProperty.align=Xt,this.gridColumnProperty.fixRowCount=1,this.gridColumnProperty.rows[0][0].value="列号",this.gridColumnProperty.rows[0][1].value="字段名",this.gridColumnProperty.rows[0][2].value="字段类型",this.gridColumnProperty.rows[0][3].value="输入样式",this.gridColumnProperty.rows[0][4].value="标题",this.gridColumnProperty.rows[0][5].value="自定义属性",this.gridColumnProperty.setColWidth(0,30),this.gridColumnProperty.setColWidth(1,80),this.gridColumnProperty.setColWidth(2,60),this.gridColumnProperty.setColWidth(3,60),this.gridColumnProperty.setColWidth(4,80),this.gridColumnProperty.setColWidth(5,100),this.gridColumnProperty.addColumn("",bn.Number),this.gridColumnProperty.addColumn(""),this.gridColumnProperty.addColumn("",bn.String,Tn.Combobox,!0),this.gridColumnProperty.addColumn("",bn.String,Tn.Combobox,!0),this.gridColumnProperty.addColumn(""),this.gridColumnProperty.addColumn(""),this.gridColumnProperty.onCellPopupBefor=function(t,e,i){if(2===e){i.items.clear();for(var n=Object.keys(bn),o=0;o<n.length;o++)i.addItem(n[o])}else if(3===e){i.items.clear();for(var s=Object.keys(Tn),r=0;r<s.length;r++)i.addItem(s[r])}},this.gridColumnProperty.onCellPopupAfter=function(t,e,i){(2===e||3===e)&&i.items.clear()},t.addControl(this.gridColumnProperty)}},{key:"getPropertys",value:function(t){this.gridTableProperty.rowCount=t.Propertys.count+1;for(var e=1;e<=t.Propertys.count;e++)this.gridTableProperty.rows[e][0].value=t.Propertys[e-1].key,this.gridTableProperty.rows[e][1].value=t.Propertys[e-1].val;this.gridColumnProperty.rowCount=t.Columns.count+1;for(var i=1;i<=t.Columns.count;i++)this.gridColumnProperty.rows[i][0].value=t.Columns[i-1].colIndex.toString(),this.gridColumnProperty.rows[i][1].value=t.Columns[i-1].fieldName,this.gridColumnProperty.rows[i][2].value=t.Columns[i-1].fieldTypeName(),this.gridColumnProperty.rows[i][3].value=t.Columns[i-1].inputStyleName(),this.gridColumnProperty.rows[i][4].value=t.Columns[i-1].fieldTitle,this.gridColumnProperty.rows[i][5].value=t.Columns[i-1].fieldProp;if(t.SelectCellRang.StartRow>=0){var n=t.Rows[t.SelectCellRang.StartRow];this.gridRowProperty.rowCount=n.Propertys.count+1;for(var o=1;o<=n.Propertys.count;o++)this.gridRowProperty.rows[o][0].value=n.Propertys[o-1].key,this.gridRowProperty.rows[o][1].value=n.Propertys[o-1].val;var s=t.Rows[t.SelectCellRang.StartRow][t.SelectCellRang.StartCol];this.gridCellProperty.rowCount=s.Propertys.count+1;for(var r=1;r<=s.Propertys.count;r++)this.gridCellProperty.rows[r][0].value=s.Propertys[r-1].key,this.gridCellProperty.rows[r][1].value=s.Propertys[r-1].val}}},{key:"setPropertys",value:function(t){var e;t.Propertys.clear();for(var i=1;i<this.gridTableProperty.rowCount;i++)""!=(e=Yl.HCDeleteBreak(this.gridTableProperty.rows[i][0].value).trim())&&t.Propertys.add(e,Yl.HCDeleteBreak(this.gridTableProperty.rows[i][1].value));t.Columns.clear();for(var n=0,o=1;o<this.gridColumnProperty.rowCount;o++)""!==(e=Yl.HCDeleteBreak(this.gridColumnProperty.rows[o][0].value).trim())&&(n=L.parseIntDef(e,-1))>-1&&t.Columns.addColumn(n,Yl.HCDeleteBreak(this.gridColumnProperty.rows[o][1].value),Yl.HCDeleteBreak(this.gridColumnProperty.rows[o][2].value),Yl.HCDeleteBreak(this.gridColumnProperty.rows[o][3].value),Yl.HCDeleteBreak(this.gridColumnProperty.rows[o][4].value),Yl.HCDeleteBreak(this.gridColumnProperty.rows[o][5].value));if(t.SelectCellRang.StartRow>=0){var s=t.Rows[t.SelectCellRang.StartRow];s.Propertys.clear();for(var r=1;r<this.gridRowProperty.rowCount;r++)""!=(e=Yl.HCDeleteBreak(this.gridRowProperty.rows[r][0].value).trim())&&s.Propertys.add(e,Yl.HCDeleteBreak(this.gridRowProperty.rows[r][1].value));var a=t.Rows[t.SelectCellRang.StartRow][t.SelectCellRang.StartCol];a.Propertys.clear();for(var l=1;l<this.gridCellProperty.rowCount;l++)""!=(e=Yl.HCDeleteBreak(this.gridCellProperty.rows[l][0].value).trim())&&a.Propertys.add(e,Yl.HCDeleteBreak(this.gridCellProperty.rows[l][1].value))}}},{key:"SetView",value:function(t){var e=this;this.FView=t;var i=t.GetTopLevelTable();this.beginUpdate();try{this.edtCellHPadding.text=L.stringFormatFloat(1,i.CellHPaddingMM),this.edtCellVPadding.text=L.stringFormatFloat(1,i.CellVPaddingMM),this.chkBorderVisible.checked=i.BorderVisible,this.edtBorderWidth.text=L.stringFormatFloat(1,i.BorderWidthPt),this.edtFixRowFirst.text=i.FixRow.toString(),i.FixRowCount>0?this.edtFixRowLast.text=(i.FixRow+i.FixRowCount-1).toString():this.edtFixRowLast.text=this.edtFixRowFirst.text,this.edtFixColFirst.text=i.FixCol.toString(),i.FixColCount>0?this.edtFixColLast.text=(i.FixCol+i.FixColCount-1).toString():this.edtFixColLast.text=this.edtFixColFirst.text,this.chkDeleteAllow.checked=i.DeleteAllow,this.chkCanResize.checked=i.CanResize,this.chkResizeKeepWidth.checked=i.ResizeKeepWidth,this.chkCanPageBreak.checked=i.CanPageBreak,this.chkCanEdit.checked=!i.EditProtect,i.SelectCellRang.StartRow>=0&&(this.pageRow.text="行("+i.SelectCellRang.StartRow.toString()+")",i.SelectCellRang.EndRow>0&&(this.pageRow.text+="-("+i.SelectCellRang.EndRow.toString()+")"),this.edtRowHeight.text=i.Rows[i.SelectCellRang.StartRow].Height.toString());i.SelectCellRang.StartRow>=0&&i.SelectCellRang.StartCol>=0?i.SelectCellRang.EndRow>=0?(i.Rows[i.SelectCellRang.StartRow][i.SelectCellRang.StartCol].AlignVert,this.pageCell.text="单元格("+i.SelectCellRang.StartRow.toString()+","+i.SelectCellRang.StartCol.toString()+")-("+i.SelectCellRang.EndRow.toString()+","+i.SelectCellRang.EndCol.toString()+")"):(i.GetEditCell().AlignVert,this.pageCell.text="单元格("+i.SelectCellRang.StartRow.toString()+","+i.SelectCellRang.StartCol.toString()+")",this.mmoScript.InsertText(i.GetEditCell().CellData.Script)):this.pageCell.visible=!1,this.getPropertys(i),this.moveCenter()}finally{this.endUpdate()}this.showModal((function(){t.BeginUpdate();try{if(i.CellHPaddingMM=L.parseFloatDef(e.edtCellHPadding.text,.2),i.CellVPaddingMM=L.parseFloatDef(e.edtCellVPadding.text,0),i.BorderWidthPt=L.parseFloatDef(e.edtBorderWidth.text,.5),i.borderVisible=e.chkBorderVisible.checked,i.CanPageBreak=e.chkCanPageBreak.checked,i.SetFixRowAndCount(L.parseIntDef(e.edtFixRowFirst.text,-1),L.parseIntDef(e.edtFixRowLast.text,-1)-L.parseIntDef(e.edtFixRowFirst.text,-1)+1),i.SetFixColAndCount(L.parseIntDef(e.edtFixColFirst.text,-1),L.parseIntDef(e.edtFixColLast.text,-1)-L.parseIntDef(e.edtFixColFirst.text,-1)+1),i.DeleteAllow=e.chkDeleteAllow.checked,i.CanResize=e.chkCanResize.checked,i.ResizeKeepWidth=e.chkResizeKeepWidth.checked,i.EditProtect=!e.chkCanEdit.checked,i.SelectCellRang.StartRow>=0){var n=e.edtRowHeight.number;if(i.SelectCellRang.EndRow>0)for(var o=i.SelectCellRang.StartRow;o<=i.SelectCellRang.EndRow;o++)i.Rows[o].Height=n,i.Rows[o].AutoHeight=i.Rows[o].Height!=n;else i.Rows[i.SelectCellRang.StartRow].Height=n,i.Rows[i.SelectCellRang.StartRow].AutoHeight=i.Rows[i.SelectCellRang.StartRow].Height!=n}i.SelectCellRang.StartRow>=0&&i.SelectCellRang.StartCol>=0&&(i.SelectCellRang.EndCol>0||(i.GetEditCell().CellData.Script=e.mmoScript.Data.SaveToText())),e.setPropertys(i),i.PropertyChange(),i.Change(),t.ActiveSection.ReFormatActiveItem()}finally{t.EndUpdate()}}))}}]),i}(Dh);function jf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Yf=function(t){m()(i,t);var e=jf(i);function i(t){var n;r()(this,i),(n=e.call(this,t,360,480)).caption="DeCombobox属性",n.gridProperty.height=100,n.gridProperty.align=Xt,n.pnlButton.align=Xt,n.pnlProp=new qi(t),n.pnlProp.height=130,n.pnlProp.borderVisible=!1,n.pnlProp.align=Xt,n.chkAutoSize=new en(t,"自动计算宽高"),n.chkAutoSize.left=23,n.chkAutoSize.top=11,n.chkAutoSize.onSwitch=function(){n.edtWidth.enabled=!n.chkAutoSize.checked,n.edtHeight.enabled=!n.chkAutoSize.checked},n.pnlProp.addControl(n.chkAutoSize);var o=new Ki(t,"宽(像素)");o.left=131,o.top=13,n.pnlProp.addControl(o),n.edtWidth=new an(t),n.edtWidth.left=o.right+5,n.edtWidth.top=10,n.edtWidth.width=32,n.pnlProp.addControl(n.edtWidth);var s=new Ki(t,"高(像素)");s.left=233,s.top=13,n.pnlProp.addControl(s),n.edtHeight=new an(t),n.edtHeight.left=s.right+5,n.edtHeight.top=10,n.edtHeight.width=32,n.pnlProp.addControl(n.edtHeight);var a=new Ki(t,"边框");a.left=n.chkAutoSize.left,a.top=n.edtWidth.bottom+6,n.pnlProp.addControl(a),n.chkBorderTop=new en(t,"上"),n.chkBorderTop.left=a.right+10,n.chkBorderTop.top=n.edtWidth.bottom+5,n.pnlProp.addControl(n.chkBorderTop),n.chkBorderBottom=new en(t,"下"),n.chkBorderBottom.left=n.chkBorderTop.right+10,n.chkBorderBottom.top=n.chkBorderTop.top,n.pnlProp.addControl(n.chkBorderBottom),n.chkBorderLeft=new en(t,"左"),n.chkBorderLeft.left=n.chkBorderBottom.right+10,n.chkBorderLeft.top=n.chkBorderBottom.top,n.pnlProp.addControl(n.chkBorderLeft),n.chkBorderRight=new en(t,"右"),n.chkBorderRight.left=n.chkBorderLeft.right+10,n.chkBorderRight.top=n.chkBorderLeft.top,n.pnlProp.addControl(n.chkBorderRight),n.edtText=new hn(t,"文本",""),n.edtText.left=a.left-5,n.edtText.top=n.chkBorderRight.bottom+5,n.edtText.width=200,n.pnlProp.addControl(n.edtText),n.chkReadOnly=new en(t,"只读"),n.chkReadOnly.left=n.chkAutoSize.left,n.chkReadOnly.top=n.edtText.bottom+5,n.pnlProp.addControl(n.chkReadOnly),n.chkStatic=new en(t,"只能通过选项赋值"),n.chkStatic.left=105,n.chkStatic.top=n.chkReadOnly.top,n.pnlProp.addControl(n.chkStatic),n.chkAllocValue=new en(t,"已填值"),n.chkAllocValue.left=n.chkStatic.right+8,n.chkAllocValue.top=n.chkStatic.top,n.pnlProp.addControl(n.chkAllocValue),n.chkDeleteAllow=new en(t,"允许删除"),n.chkDeleteAllow.left=n.chkReadOnly.left,n.chkDeleteAllow.top=n.chkReadOnly.bottom+5,n.pnlProp.addControl(n.chkDeleteAllow),n.chkPrintOnlyText=new en(t,"打印时仅打印文本不打印边框"),n.chkPrintOnlyText.left=105,n.chkPrintOnlyText.top=n.chkDeleteAllow.top,n.pnlProp.addControl(n.chkPrintOnlyText),n.chkSaveItem=new en(t,"保存选项(第一列为空的选项无效)"),n.chkSaveItem.left=5,n.chkSaveItem.top=30,n.chkSaveItem.onSwitch=function(){n.gridItem.enabled=n.chkSaveItem.checked},n.pnlButton.height+=15,n.pnlButton.addControl(n.chkSaveItem),n.gridItem=new Rn(t,1,4),n.gridItem.marginLeft=5,n.gridItem.marginRight=5,n.gridItem.height=130,n.gridItem.align=$t,n.gridItem.fixRowCount=1,n.gridItem.rows[0][0].value="文本",n.gridItem.rows[0][1].value="编码",n.gridItem.rows[0][2].value="ID",n.gridItem.rows[0][3].value="计算值",n.gridItem.setColWidth(0,100),n.gridItem.setColWidth(1,80),n.gridItem.setColWidth(2,60),n.gridItem.setColWidth(3,80),n.pnlItemButton=new qi(t),n.pnlItemButton.height=40,n.pnlItemButton.borderVisible=!1,n.pnlItemButton.align=qt;var l=new Ji(t,"新增选项");l.left=5,l.top=5,l.width=60,l.onClick=function(){n.gridItem.rowCount++,n.gridItem.rows.last[0].value="",n.gridItem.rows.last[1].value=""},n.pnlItemButton.addControl(l);var h=new Ji(t,"删除选项");h.left=l.right+10,h.top=l.top,h.width=60,h.onClick=function(){n.gridItem.deleteRow(n.gridItem.row)},n.pnlItemButton.addControl(h);var c=new Ji(t,"保存");c.left=h.right+20,c.top=h.top,c.width=55,c.onClick=function(){n.modalResult=wh,n.close()},n.pnlItemButton.addControl(c),n.beginUpdate();try{var u=[n.clientArea.controls[n.clientArea.controls.length-1],n.clientArea.controls[n.clientArea.controls.length-2]];n.clientArea.controls[n.clientArea.controls.length-2]=u[0],n.clientArea.controls[n.clientArea.controls.length-1]=u[1],n.clientArea.controls.insert(0,n.pnlProp),n.addControl(n.gridItem),n.addControl(n.pnlItemButton)}finally{n.endUpdate()}return n}return l()(i,[{key:"SetView",value:function(t,e){var i=this;this.beginUpdate();try{""!=e.GetValue(Yh.Name)&&(this.caption+="["+e.GetValue(Yh.Name)+"]"),this.chkAutoSize.checked=e.AutoSize,this.edtWidth.enabled=!this.chkAutoSize.checked,this.edtHeight.enabled=!this.chkAutoSize.checked,this.edtWidth.text=e.Width.toString(),this.edtHeight.text=e.Height.toString(),this.edtText.text=e.Text,this.chkPrintOnlyText.checked=e.PrintOnlyText,this.chkReadOnly.checked=e.ReadOnly,this.chkStatic.checked=e.Static,this.chkAllocValue.checked=e.AllocValue,this.chkDeleteAllow.checked=e.DeleteAllow,this.chkBorderLeft.checked=e.BorderSides.has(Zl.Left),this.chkBorderTop.checked=e.BorderSides.has(Zl.Top),this.chkBorderRight.checked=e.BorderSides.has(Zl.Right),this.chkBorderBottom.checked=e.BorderSides.has(Zl.Bottom),this.getPropertys(e.Propertys),this.chkSaveItem.checked=e.SaveItem,this.gridItem.rowCount=e.Items.count+1;for(var n=1;n<=e.Items.count;n++)this.gridItem.rows[n][0].value=e.Items[n-1].Text,this.gridItem.rows[n][1].value=e.Items[n-1].Code,this.gridItem.rows[n][2].value=e.Items[n-1].ID,this.gridItem.rows[n][3].value=e.Items[n-1].Value;this.gridItem.enabled=this.chkSaveItem.checked,this.moveCenter()}finally{this.endUpdate()}this.showModal((function(){if(e.AutoSize=i.chkAutoSize.checked,i.chkAutoSize.checked||(e.Width=L.parseIntDef(i.edtWidth.text,e.width),e.Height=L.parseIntDef(i.edtHeight.text,e.Height)),e.Text=i.edtText.text,i.chkBorderLeft.checked?e.BorderSides.add(Zl.Left):e.BorderSides.remove(Zl.Left),i.chkBorderTop.checked?e.BorderSides.add(Zl.Top):e.BorderSides.remove(Zl.Top),i.chkBorderRight.checked?e.BorderSides.add(Zl.Right):e.BorderSides.remove(Zl.Right),i.chkBorderBottom.checked?e.BorderSides.add(Zl.Bottom):e.BorderSides.remove(Zl.Bottom),e.PrintOnlyText=i.chkPrintOnlyText.checked,e.DeleteAllow=i.chkDeleteAllow.checked,e.AllocValue=i.chkAllocValue.checked,e.ReadOnly=i.chkReadOnly.checked,e.Static=i.chkStatic.checked,i.setPropertys(e.Propertys),e.Clear(),e.SaveItem=i.chkSaveItem.checked,i.chkSaveItem.checked)for(var n,o=1;o<i.gridItem.rowCount;o++)""!=(n=Yl.HCDeleteBreak(i.gridItem.rows[o][0].value).trim())&&e.AddItemEx(n,i.gridItem.rows[o][1].value,i.gridItem.rows[o][2].value,i.gridItem.rows[o][3].value);t.BeginUpdate();try{var s=t.ActiveSectionTopLevelData();s.isClass(Jl)&&s.FormatDirty(),t.ActiveSection.ReFormatActiveItem()}finally{t.EndUpdate()}}))}}]),i}(Sf);function Qf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Xf=function(t){m()(i,t);var e=Qf(i);function i(t){var n;r()(this,i),(n=e.call(this,t,360,320)).caption="DeDateTime属性",n.chkAutoSize=new en(t,"自动计算宽高"),n.chkAutoSize.left=5,n.chkAutoSize.top=11,n.chkAutoSize.onSwitch=function(){n.edtWidth.enabled=!n.chkAutoSize.checked,n.edtHeight.enabled=!n.chkAutoSize.checked};var o=new Ki(t,"宽(像素)");o.left=113,o.top=13,n.edtWidth=new an(t),n.edtWidth.left=o.right+5,n.edtWidth.top=10,n.edtWidth.width=32;var s=new Ki(t,"高(像素)");s.left=213,s.top=13,n.edtHeight=new an(t),n.edtHeight.left=s.right+5,n.edtHeight.top=10,n.edtHeight.width=32;var a=new Ki(t,"边框");a.left=n.chkAutoSize.left,a.top=n.edtWidth.bottom+7,n.chkBorderTop=new en(t,"上"),n.chkBorderTop.left=a.right+5,n.chkBorderTop.top=n.edtWidth.bottom+5,n.chkBorderBottom=new en(t,"下"),n.chkBorderBottom.left=n.chkBorderTop.right+5,n.chkBorderBottom.top=n.chkBorderTop.top,n.chkBorderLeft=new en(t,"左"),n.chkBorderLeft.left=n.chkBorderBottom.right+5,n.chkBorderLeft.top=n.chkBorderBottom.top,n.chkBorderRight=new en(t,"右"),n.chkBorderRight.left=n.chkBorderLeft.right+5,n.chkBorderRight.top=n.chkBorderLeft.top;var l=new Ki(n.hcl,"格式：");l.left=n.chkBorderRight.right+10,l.top=a.top,n.cbbDTFmt=new mn(n.hcl,"yyyy-MM-dd hh:mm"),n.cbbDTFmt.left=l.right,n.cbbDTFmt.top=l.top-3,n.cbbDTFmt.width=130,n.cbbDTFmt.autoDropDownWidth=!0,n.cbbDTFmt.addItem("yyyy-MM-dd hh:mm"),n.cbbDTFmt.addItem("yyyy-MM-dd hh:mm:ss"),n.cbbDTFmt.addItem("yyyy年MM月dd日 hh时mm分"),n.cbbDTFmt.addItem("yyyy-MM-dd"),n.cbbDTFmt.addItem("yyyy年MM月dd日"),n.chkDeleteAllow=new en(t,"允许删除"),n.chkDeleteAllow.left=n.chkAutoSize.left,n.chkDeleteAllow.top=n.chkBorderRight.bottom+5,n.chkPrintOnlyText=new en(t,"打印时仅打印文本不打印边框"),n.chkPrintOnlyText.left=n.chkDeleteAllow.right+10,n.chkPrintOnlyText.top=n.chkDeleteAllow.top,n.beginUpdate();try{n.addControl(n.chkAutoSize),n.addControl(o),n.addControl(n.edtWidth),n.addControl(s),n.addControl(n.edtHeight),n.addControl(a),n.addControl(n.chkBorderTop),n.addControl(n.chkBorderBottom),n.addControl(n.chkBorderLeft),n.addControl(n.chkBorderRight),n.addControl(l),n.addControl(n.cbbDTFmt),n.addControl(n.chkDeleteAllow),n.addControl(n.chkPrintOnlyText)}finally{n.endUpdate()}return n}return l()(i,[{key:"SetView",value:function(t,e){var i=this;this.beginUpdate();try{""!=e.GetValue(Yh.Name)&&(this.caption+="["+e.GetValue(Yh.Name)+"]"),this.chkAutoSize.checked=e.AutoSize,this.edtWidth.enabled=!this.chkAutoSize.checked,this.edtHeight.enabled=!this.chkAutoSize.checked,this.edtWidth.text=e.Width.toString(),this.edtHeight.text=e.Height.toString(),this.chkPrintOnlyText.checked=e.PrintOnlyText,this.chkDeleteAllow.checked=e.DeleteAllow,this.chkBorderLeft.checked=e.BorderSides.has(Zl.Left),this.chkBorderTop.checked=e.BorderSides.has(Zl.Top),this.chkBorderRight.checked=e.BorderSides.has(Zl.Right),this.chkBorderBottom.checked=e.BorderSides.has(Zl.Bottom),this.cbbDTFmt.text=e.Format,this.getPropertys(e.Propertys),this.moveCenter()}finally{this.endUpdate()}this.showModal((function(){e.AutoSize=i.chkAutoSize.checked,i.chkAutoSize.checked||(e.Width=L.parseIntDef(i.edtWidth.text,e.width),e.Height=L.parseIntDef(i.edtHeight.text,e.Height)),i.chkBorderLeft.checked?e.BorderSides.add(Zl.Left):e.BorderSides.remove(Zl.Left),i.chkBorderTop.checked?e.BorderSides.add(Zl.Top):e.BorderSides.remove(Zl.Top),i.chkBorderRight.checked?e.BorderSides.add(Zl.Right):e.BorderSides.remove(Zl.Right),i.chkBorderBottom.checked?e.BorderSides.add(Zl.Bottom):e.BorderSides.remove(Zl.Bottom),e.PrintOnlyText=i.chkPrintOnlyText.checked,e.DeleteAllow=i.chkDeleteAllow.checked,e.Format=i.cbbDTFmt.text,i.setPropertys(e.Propertys),t.BeginUpdate();try{var n=t.ActiveSectionTopLevelData();n.isClass(Jl)&&n.FormatDirty(),t.ActiveSection.ReFormatActiveItem()}finally{t.EndUpdate()}}))}}]),i}(Sf);function Zf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var qf=function(t){m()(i,t);var e=Zf(i);function i(t){var n;r()(this,i),(n=e.call(this,t,300,400)).caption="文档结构",n.captionBar.transparent=!1,n.captionBar.color=Ft.LightGray,n.onPaintBackground=function(t){n.hcl.theme.drawShadow(t,nt.CreateByBounds(0,0,n.width,n.height),!1)},n.btnRefresh=n.captionBar.addButton("刷新"),n.btnRefresh.align_=Zt,n.btnRefresh.autoWidth=!0,n.btnRefresh._marginRight=5,n.btnRefresh.onClick=function(){n.RebuildDocTree()},n.FEmrView=null,n.FTree=new _n(t),n.FTree.borderVisible_=!1,n.FTree.align=$t,n.beginUpdate();try{n.addControl(n.FTree)}finally{n.endUpdate()}return n}return l()(i,[{key:"SetView",value:function(t){var e=this;this.FEmrView=t,this.RebuildDocTree(),this.FTree.onDblClick=function(t){e.FTree.selectNode&&e.FTree.selectNode.object&&e.FEmrView.ScrollToItem(e.FTree.selectNode.object)},this.moveCenter(),this.show()}},{key:"RebuildDocTree",value:function(){var t=this;this.FTree.nodes.clear();var e=new Ks;e.Areas.add(ql.Page);var i=null,n=-1,o=null,s=new st;e.Process=function(r,a,l,h,c){if(e.SectionIndex!=n&&(n=e.SectionIndex,o=t.FTree.addNode("第"+(n+1).toString()+"节"),s.push(o)),(i=r.Items[a]).StyleNo>oo.Null)i.Index&&s.peek().addNode(i.Name+"("+i.Text+")",i);else if(i.StyleNo==oo.Domain)if(rs.IsBeginMark(i)){var u=null;u=i.IsProcBegin?s.peek().addNode("[病程]"+i.Name,i):s.peek().addNode("[数据组]"+i.Name,i),s.push(u)}else s.pop();else i.StyleNo!=oo.Image&&i.StyleNo!=oo.Table&&i.StyleNo!=oo.CheckBox&&i.StyleNo!=oo.Edit&&i.StyleNo!=oo.Combobox&&i.StyleNo!=oo.DateTimePicker&&i.StyleNo!=oo.RadioGroup||i.Index&&(i.Name?s.peek().addNode(i.Name+"("+i.Text+")",i):s.peek().addNode("非文本("+i.Text+")",i))},this.FEmrView.TraverseItem(e),o.expand=!0}}]),i}(Dh);function $f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var td=function(t){m()(i,t);var e=$f(i);function i(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:640,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:480;r()(this,i),(n=e.call(this,t,o,s)).caption="编辑脚本",n.scriptEdit=new ed(t),n.scriptEdit.Style.TextStyles[0].Family="Courier New",n.scriptEdit.Style.ParaStyles[0].LineSpaceMode=Hn.PLS100,n.scriptEdit.Style.ParaStyles[0].AlignHorz=Ln.Left,n.scriptEdit.marginLeft=5,n.scriptEdit.align=Xt,n.scriptEdit.height=415,n.scriptEdit.onKeyDown=function(){};var a=new ji(t,"确定");return a.left=Math.trunc((n.width-a.width)/2),a.top=n.scriptEdit.bottom+10,a.width=70,a.image.src=n.hcl.theme.okImage.src,a.onClick=function(){n.modalResult=wh,n.close()},n.addControl(a),n.addControl(n.scriptEdit),n}return l()(i)}(Dh),ed=function(t){m()(i,t);var e=$f(i);function i(t){return r()(this,i),e.call(this,t)}return l()(i,[{key:"doKeyDown_",value:function(t){t.keyCode!==Me&&f()(F()(i.prototype),"doKeyDown_",this).call(this,t)}}]),i}(zf);function id(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var nd=function(t){m()(i,t);var e=id(i);function i(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:320,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:246;r()(this,i),(n=e.call(this,t,o,s)).caption="脚本",n.gridProperty=new Rn(t,1,2),n.gridProperty.marginLeft=5,n.gridProperty.marginRight=5,n.gridProperty.height=180,n.gridProperty.align=qt,n.gridProperty.fixRowCount=1,n.gridProperty.rows[0][0].value="名称",n.gridProperty.rows[0][1].value="内容",n.gridProperty.setColWidth(0,100),n.gridProperty.setColWidth(1,180),n._btnEdit=new Ji(t,"编辑"),n._btnEdit.width=35,n._btnEdit.height=n.gridProperty.defaultRowHeight-1,n._btnEdit.visible=!1,n._btnEdit.onClick=function(){var e=n.gridProperty.rows[n.gridProperty.row][1].value,i=new td(t);i.scriptEdit.InsertText(e),i.moveCenter(),i.showModal((function(){n.gridProperty.rows[n.gridProperty.row][1].value=i.scriptEdit.Data.SaveToText()}))},n.gridProperty.onRowChanged=function(t){n.gridRowChanged()},n.gridProperty.addControl(n._btnEdit),n.pnlButton=new qi(t),n.pnlButton.height=40,n.pnlButton.borderVisible=!1,n.pnlButton.align=qt;var a=new Ki(t,"名称为空时无效");a.left=2,a.top=10,a.font.color=Ft.OrangeRed,n.pnlButton.addControl(a);var l=new Ji(t,"新增行");l.left=a.right+5,l.top=5,l.width=55,l.onClick=function(){n.gridProperty.rowCount++,n.gridProperty.rows.last[0].value=Yl.JAVASCRIPT,n.gridProperty.rows.last[1].value="",n.gridProperty.row=n.gridProperty.rows.count-1},n.pnlButton.addControl(l);var h=new Ji(t,"删除行");h.left=l.right+10,h.top=l.top,h.width=55,h.onClick=function(){n.gridProperty.deleteRow(n.gridProperty.row)},n.pnlButton.addControl(h);var c=new Ji(t,"保存");c.left=h.right+20,c.top=h.top,c.width=55,c.onClick=function(){n.modalResult=wh,n.close()},n.pnlButton.addControl(c),n.beginUpdate();try{n.addControl(n.pnlButton),n.addControl(n.gridProperty),n.moveCenter()}finally{n.endUpdate()}return n}return l()(i,[{key:"gridRowChanged",value:function(){var t=this.gridProperty.row;t>this.gridProperty.fixRowCount-1?(this._btnEdit.left=this.gridProperty.contentWidth-this._btnEdit.width-1,this._btnEdit.top=this.gridProperty.defaultRowHeight*t,this._btnEdit.visible=!0):this._btnEdit.visible=!1}},{key:"getScripts",value:function(t){this.gridProperty.rowCount=t.count+1;for(var e=1;e<=t.count;e++)this.gridProperty.rows[e][0].value=t[e-1].key,this.gridProperty.rows[e][1].value=t[e-1].val}},{key:"setScripts",value:function(t){var e,i;t.clear();for(var n=1;n<this.gridProperty.rowCount;n++)e=Yl.HCDeleteBreak(this.gridProperty.rows[n][0].value).trim(),i=this.gridProperty.rows[n][1].value,""!==e&&""!==i&&t.add(e,i)}},{key:"SetView",value:function(t){var e=this,i=t.ActiveSectionTopLevelData().GetActiveItem();this.beginUpdate();try{this.getScripts(i.Scripts),this.moveCenter()}finally{this.endUpdate()}this.showModal((function(){t.BeginUpdate();try{e.setScripts(i.Scripts)}finally{t.EndUpdate()}}))}}]),i}(Dh);function od(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var sd=function(t){m()(i,t);var e=od(i);function i(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:320,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:246;return r()(this,i),e.call(this,t,n,o)}return l()(i,[{key:"SetItem",value:function(t,e){var i=this;this.beginUpdate();try{this.getScripts(e.Scripts),this.moveCenter()}finally{this.endUpdate()}this.showModal((function(){t.BeginUpdate();try{i.setScripts(e.Scripts)}finally{t.EndUpdate()}}))}},{key:"SetData",value:function(t){var e=this,i=t.ActiveSectionTopLevelData();this.beginUpdate();try{this.getScripts(i.Scripts),this.moveCenter()}finally{this.endUpdate()}this.showModal((function(){t.BeginUpdate();try{e.setScripts(i.Scripts)}finally{t.EndUpdate()}}))}}]),i}(nd);function rd(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var ad=function(t){m()(i,t);var e=rd(i);function i(t){var n;r()(this,i),(n=e.call(this,t,640,480)).state_.add(Ri.Creating),n.FImageItem=null,n.FDrawRect=null,n.FPaintInfo=null,n.caption="图片标注-绘制  ",n.captionBar.onPaint=function(t){(n.resWait_>0||n.captionBar.resWait_>0)&&(t.font.assign(n.hcl.defaultFont),t.textOut(n.lblCaption.width,5,"正在加载图标..."))},n.btnNone=n.captionBar.addButton("",!1,n.hcl.emrCommon.ResNonetool),n.btnNone.hint="选择标注对象",n.btnNone.group=1,n.btnNone.onClick=function(){n.FImageItem.ShapeManager.OperStyle=Dr,n.operStyleChange_()},n.btnLine=n.captionBar.addButton("直线",!1,n.hcl.emrCommon.ResLine),n.btnLine.hint="直线（左键点击2次确定2个端点）",n.btnLine.group=1,n.btnLine.onClick=function(){n.FImageItem.ShapeManager.OperStyle=Pr,n.operStyleChange_()},n.btnRectangle=n.captionBar.addButton("矩形",!1,n.hcl.emrCommon.ResRectangle),n.btnRectangle.hint="矩形（左键点击2次确定矩形范围）",n.btnRectangle.group=1,n.btnRectangle.onClick=function(){n.FImageItem.ShapeManager.OperStyle=kr,n.operStyleChange_()},n.btnEllipse=n.captionBar.addButton("椭圆",!1,n.hcl.emrCommon.ResEllipse),n.btnEllipse.hint="椭圆（左键点击2次确定椭圆所在的矩形）",n.btnEllipse.group=1,n.btnEllipse.onClick=function(){n.FImageItem.ShapeManager.OperStyle=xr,n.operStyleChange_()},n.btnRegion=n.captionBar.addButton("区域",!1,n.hcl.emrCommon.ResRegion),n.btnRegion.hint="区域（左键确定点位，右键完成区域）",n.btnRegion.group=1,n.btnRegion.onClick=function(){n.FImageItem.ShapeManager.OperStyle=Rr,n.operStyleChange_()},n.btnText=n.captionBar.addButton("文本",!1,n.hcl.emrCommon.ResText),n.btnText.hint="文本（左键点击确定文本位置）",n.btnText.group=1,n.btnText.onClick=function(){n.FImageItem.ShapeManager.OperStyle=Tr,n.operStyleChange_()},n.paintBox=new mi(t),n.paintBox.canFocus=!0,n.paintBox.onPaint=function(t){t.drawImage(0,0,n.FImageItem.Image.image),n.FImageItem.ShapeManager.PaintTo(t,n.FDrawRect,n.FPaintInfo)},n.paintBox.onMouseDown=function(t){n.FImageItem.ShapeManager.MouseDown(t)&&n.update(),t.button!==ae&&n.btnNone.onClick()},n.paintBox.onMouseMove=function(t){t.x>0&&t.x<n.paintBox.width&&t.y>0&&t.y<n.paintBox.height&&n.FImageItem.ShapeManager.MouseMove(t)&&n.update(),n.FImageItem.ShapeManager.HotIndex>=0?n.paintBox.cursor=n.FImageItem.ShapeManager[n.FImageItem.ShapeManager.HotIndex].Cursor:n.paintBox.cursor=Se},n.paintBox.onMouseUp=function(t){n.FImageItem.ShapeManager.MouseUp(t)&&n.update()},n.paintBox.onKeyDown=function(t){n.FImageItem.ShapeManager.KeyDown(t)&&n.update()},n.beginUpdate();try{n.addControl(n.paintBox),n.propPage=new Dn(t),n.propPage.align=Zt,n.propPage.width=140,n.propPage.borders.remove(fe),n.propPage.borders.remove(de);var o=n.propPage.addPage("说明");n.initPageExplain_(o),o=n.propPage.addPage("直线"),n.initPageLine_(o),o=n.propPage.addPage("矩形"),n.initRectangle_(o),o=n.propPage.addPage("椭圆"),n.initEllipse_(o),o=n.propPage.addPage("区域"),n.initRegion_(o),o=n.propPage.addPage("文本"),n.initText_(o),n.propPage.headerVisible=!1,n.propPage.pageIndex=0,n.addControl(n.propPage),n.state_.delete(Ri.Creating)}finally{n.endUpdate()}return n}return l()(i,[{key:"initPageExplain_",value:function(t){var e=new Ki(this.hcl,"1.鼠标在按钮上停留可");e.left=5,e.top=10;var i=new Ki(this.hcl,"查看操作方式。");i.left=20,i.top=30;var n=new Ki(this.hcl,"2.选择对象后此处将显");n.left=5,n.top=50;var o=new Ki(this.hcl,"示对象属性。");o.left=20,o.top=70;var s=new Ki(this.hcl,"3.选择对象后按删除键");s.left=5,s.top=90;var r=new Ki(this.hcl,"删除对象。");r.left=20,r.top=110,t.addControl(e),t.addControl(i),t.addControl(n),t.addControl(o),t.addControl(s),t.addControl(r)}},{key:"initPageLine_",value:function(t){var e=this,i=new Ki(this.hcl,"线宽：");i.left=10,i.top=10,this.edtLineWidth=new an(this.hcl,1),this.edtLineWidth.left=i.right,this.edtLineWidth.top=i.top-2,this.edtLineWidth.onChange=function(){e.shapePropChange_()};var n=new Ki(this.hcl,"颜色：");n.left=10,n.top=35,this.cbbLineColor=new In(this.hcl,Ft.Black),this.cbbLineColor.left=n.right,this.cbbLineColor.top=n.top-2,this.cbbLineColor.width=this.edtLineWidth.width,this.cbbLineColor.onSelectedIndexChange=function(){e.shapePropChange_()};var o=new Ki(this.hcl,"样式：");o.left=10,o.top=65,this.cbbLineStyle=new mn(this.hcl,"实线"),this.cbbLineStyle.static=!0,this.cbbLineStyle.addItem("实线"),this.cbbLineStyle.addItem("虚线"),this.cbbLineStyle.itemIndex=0,this.cbbLineStyle.left=o.right,this.cbbLineStyle.top=o.top-2,this.cbbLineStyle.onSelectedIndexChange=function(){e.shapePropChange_()},t.addControl(i),t.addControl(this.edtLineWidth),t.addControl(n),t.addControl(this.cbbLineColor),t.addControl(o),t.addControl(this.cbbLineStyle)}},{key:"initRectangle_",value:function(t){var e=this,i=new Ki(this.hcl,"线宽：");i.left=10,i.top=10,this.edtRectWidth=new an(this.hcl,1),this.edtRectWidth.left=i.right,this.edtRectWidth.top=i.top-2,this.edtRectWidth.onChange=function(){e.shapePropChange_()};var n=new Ki(this.hcl,"颜色：");n.left=10,n.top=35,this.cbbRectColor=new In(this.hcl,Ft.Black),this.cbbRectColor.left=n.right,this.cbbRectColor.top=n.top-2,this.cbbRectColor.width=this.edtRectWidth.width,this.cbbRectColor.onSelectedIndexChange=function(){e.shapePropChange_()};var o=new Ki(this.hcl,"样式：");o.left=10,o.top=65,this.cbbRectStyle=new mn(this.hcl,"实线"),this.cbbRectStyle.static=!0,this.cbbRectStyle.addItem("实线"),this.cbbRectStyle.addItem("虚线"),this.cbbRectStyle.itemIndex=0,this.cbbRectStyle.left=o.right,this.cbbRectStyle.top=o.top-2,this.cbbRectStyle.onSelectedIndexChange=function(){e.shapePropChange_()},t.addControl(i),t.addControl(this.edtRectWidth),t.addControl(n),t.addControl(this.cbbRectColor),t.addControl(o),t.addControl(this.cbbRectStyle)}},{key:"initEllipse_",value:function(t){var e=this,i=new Ki(this.hcl,"线宽：");i.left=10,i.top=10,this.edtEllWidth=new an(this.hcl,1),this.edtEllWidth.left=i.right,this.edtEllWidth.top=i.top-2,this.edtEllWidth.onChange=function(){e.shapePropChange_()};var n=new Ki(this.hcl,"颜色：");n.left=10,n.top=35,this.cbbEllColor=new In(this.hcl,Ft.Black),this.cbbEllColor.left=n.right,this.cbbEllColor.top=n.top-2,this.cbbEllColor.width=this.edtEllWidth.width,this.cbbEllColor.onSelectedIndexChange=function(){e.shapePropChange_()};var o=new Ki(this.hcl,"样式：");o.left=10,o.top=65,this.cbbEllStyle=new mn(this.hcl,"实线"),this.cbbEllStyle.static=!0,this.cbbEllStyle.addItem("实线"),this.cbbEllStyle.addItem("虚线"),this.cbbEllStyle.itemIndex=0,this.cbbEllStyle.left=o.right,this.cbbEllStyle.top=o.top-2,this.cbbEllStyle.onSelectedIndexChange=function(){e.shapePropChange_()},t.addControl(i),t.addControl(this.edtEllWidth),t.addControl(n),t.addControl(this.cbbEllColor),t.addControl(o),t.addControl(this.cbbEllStyle)}},{key:"initRegion_",value:function(t){var e=this,i=new Ki(this.hcl,"线宽：");i.left=10,i.top=10,this.edtRegionLineWidth=new an(this.hcl,1),this.edtRegionLineWidth.left=i.right,this.edtRegionLineWidth.top=i.top-2,this.edtRegionLineWidth.onChange=function(){e.shapePropChange_()};var n=new Ki(this.hcl,"样式：");n.left=10,n.top=35,this.cbbRegionLineStyle=new mn(this.hcl,"实线"),this.cbbRegionLineStyle.static=!0,this.cbbRegionLineStyle.addItem("实线"),this.cbbRegionLineStyle.addItem("虚线"),this.cbbRegionLineStyle.itemIndex=0,this.cbbRegionLineStyle.left=n.right,this.cbbRegionLineStyle.top=n.top-3,this.cbbRegionLineStyle.onSelectedIndexChange=function(){e.shapePropChange_()};var o=new Ki(this.hcl,"颜色：");o.left=10,o.top=60,this.cbbRegColor=new In(this.hcl,Ft.Black),this.cbbRegColor.left=o.right,this.cbbRegColor.top=o.top-3,this.cbbRegColor.width=this.cbbRegionLineStyle.width,this.cbbRegColor.onSelectedIndexChange=function(){e.shapePropChange_()};var s=new Ki(this.hcl,"填充：");s.left=10,s.top=85,this.cbbRegionBrushStyle=new mn(this.hcl,"无"),this.cbbRegionBrushStyle.static=!0,this.cbbRegionBrushStyle.addItem("纯色"),this.cbbRegionBrushStyle.addItem("无"),this.cbbRegionBrushStyle.addItem("横线"),this.cbbRegionBrushStyle.addItem("竖线"),this.cbbRegionBrushStyle.addItem("右斜线"),this.cbbRegionBrushStyle.addItem("左斜线"),this.cbbRegionBrushStyle.addItem("方块"),this.cbbRegionBrushStyle.addItem("斜方块"),this.cbbRegionBrushStyle.left=s.right,this.cbbRegionBrushStyle.top=s.top-3,this.cbbRegionBrushStyle.itemIndex=1,this.cbbRegionBrushStyle.onSelectedIndexChange=function(){e.shapePropChange_()};var r=new Ki(this.hcl,"提示：右键结束绘制");r.left=10,r.top=this.cbbRegionBrushStyle.bottom+5,r.font.color=Ft.Blue,t.addControl(i),t.addControl(this.edtRegionLineWidth),t.addControl(n),t.addControl(this.cbbRegionLineStyle),t.addControl(s),t.addControl(this.cbbRegionBrushStyle),t.addControl(o),t.addControl(this.cbbRegColor),t.addControl(r)}},{key:"initText_",value:function(t){var e=this,i=new Ki(this.hcl,"内容：");i.left=10,i.top=10,this.cbbText=new mn(this.hcl,"文本标注"),this.cbbText.left=i.right,this.cbbText.top=i.top-2,this.cbbText.addItem("√"),this.cbbText.addItem("×"),this.cbbText.onChange=function(){e.shapePropChange_()},this.pnlFontStyle=new Bf(this.hcl),this.pnlFontStyle.left=8,this.pnlFontStyle.top=32,this.pnlFontStyle.OnFontChange=function(){e.shapePropChange_()},this.pnlFontStyle.OnFontSizeChange=function(){e.shapePropChange_()},this.pnlFontStyle.OnFontColorChange=function(){e.shapePropChange_()},this.pnlFontStyle.OnFontStyleChange=function(){e.shapePropChange_()},this.beginUpdate();try{t.addControl(i),t.addControl(this.cbbText),t.addControl(this.pnlFontStyle)}finally{this.endUpdate()}}},{key:"setShapeProp",value:function(t){switch(t.Style){case Pr:1===this.propPage.pageIndex&&(t.Width=L.parseIntDef(this.edtLineWidth.text,1),t.LineStyle=L.parseIntDef(this.cbbLineStyle.itemIndex,0),t.Color=this.cbbLineColor.color);break;case kr:2===this.propPage.pageIndex&&(t.Width=L.parseIntDef(this.edtRectWidth.text,1),t.LineStyle=L.parseIntDef(this.cbbRectStyle.itemIndex,0),t.Color=this.cbbRectColor.color);break;case xr:3===this.propPage.pageIndex&&(t.Width=L.parseIntDef(this.edtEllWidth.text,1),t.LineStyle=L.parseIntDef(this.cbbEllStyle.itemIndex,0),t.Color=this.cbbEllColor.color);break;case Rr:4===this.propPage.pageIndex&&(t.Width=L.parseIntDef(this.edtRegionLineWidth.text,1),t.LineStyle=L.parseIntDef(this.cbbRegionLineStyle.itemIndex,0),t.Color=this.cbbRegColor.color,t.BrushStyle=L.parseIntDef(this.cbbRegionBrushStyle.itemIndex,1));break;case Tr:5===this.propPage.pageIndex&&(t.Text=this.cbbText.text,t.Color=this.pnlFontStyle.cbbTextColor.color,t.FFont.Name=this.pnlFontStyle.cbbFont.text,t.FFont.Size=Nt.fontSizeToPt(this.pnlFontStyle.cbbFontSize.text),this.pnlFontStyle.btnBold.checked?t.FFont.Style.add(Wn.Bold):t.FFont.Style.remove(Wn.Bold),this.pnlFontStyle.btnItalic.checked?t.FFont.Style.add(Wn.Italic):t.FFont.Style.remove(Wn.Italic),this.pnlFontStyle.btnUnderline.checked?t.FFont.Style.add(Wn.Underline):t.FFont.Style.remove(Wn.Underline),this.pnlFontStyle.btnStrikeOut.checked?t.FFont.Style.add(Wn.Strikeout):t.FFont.Style.remove(Wn.Strikeout))}}},{key:"shapePropChange_",value:function(){if(this.FImageItem.ShapeManager.ActiveIndex>=0){var t=this.FImageItem.ShapeManager[this.FImageItem.ShapeManager.ActiveIndex];null!==t&&(this.setShapeProp(t),this.update())}}},{key:"setShapePropPage_",value:function(t){if(null!=t)switch(t.Style){case Pr:this.edtLineWidth.text=t.Width.toString(),this.cbbLineStyle.itemIndex=t.LineStyle,this.cbbLineColor.color=t.Color,this.propPage.pageIndex=1;break;case kr:this.edtRectWidth.text=t.Width.toString(),this.cbbRectStyle.itemIndex=t.LineStyle,this.cbbRectColor.color=t.Color,this.propPage.pageIndex=2;break;case xr:this.edtEllWidth.text=t.Width.toString(),this.cbbEllStyle.itemIndex=t.LineStyle,this.cbbEllColor.color=t.Color,this.propPage.pageIndex=3;break;case Rr:this.edtRegionLineWidth.text=t.Width.toString(),this.cbbRegionLineStyle.itemIndex=t.LineStyle,this.cbbRegionBrushStyle.itemIndex=t.BrushStyle,this.cbbRegColor.color=t.Color,this.propPage.pageIndex=4;break;case Tr:this.cbbText.text=t.Text,this.pnlFontStyle.InitFont(t.FFont),this.propPage.pageIndex=5;break;default:this.propPage.pageIndex=0}else this.propPage.pageIndex=0}},{key:"operStyleChange_",value:function(){switch(this.FImageItem.ShapeManager.OperStyle){case Pr:this.btnLine.checked=!0,this.propPage.pageIndex=1;break;case kr:this.btnRectangle.checked=!0,this.propPage.pageIndex=2;break;case xr:this.btnEllipse.checked=!0,this.propPage.pageIndex=3;break;case Rr:this.btnRegion.checked=!0,this.propPage.pageIndex=4;break;case Tr:this.btnText.checked=!0,this.propPage.pageIndex=5;break;default:this.btnNone.checked=!0,this.FImageItem.ShapeManager.ActiveIndex<0&&(this.propPage.pageIndex=0)}}},{key:"SetView",value:function(t,e){var i=this;this.FImageItem=e,this.FImageItem.ShapeManager.OperStyle=Dr,this.FImageItem.ShapeManager.OnStructStart=function(t){i.setShapeProp(t)},this.FImageItem.ShapeManager.OnStructOver=function(t){i.FImageItem.ShapeManager.OperStyle=Dr,i.operStyleChange_()},this.FImageItem.ShapeManager.OnActiveChange=function(){var t=null;i.FImageItem.ShapeManager.ActiveIndex>=0&&(t=i.FImageItem.ShapeManager[i.FImageItem.ShapeManager.ActiveIndex]),i.setShapePropPage_(t)},this.FDrawRect=nt.Create(0,0,this.FImageItem.Width,this.FImageItem.Height),this.FPaintInfo=new go,this.beginUpdate();try{this.paintBox.width=e.Image.width,this.paintBox.height=e.Image.height,this.moveCenter()}finally{this.endUpdate()}this.onClose=function(){i.FImageItem.ShapeManager.ActiveIndex>=0&&(i.FImageItem.ShapeManager.ActiveIndex=-1,t.UpdateView())},this.showModal((function(){}))}}]),i}(Dh);function ld(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var hd=function(t){m()(i,t);var e=ld(i);function i(t){var n;r()(this,i),(n=e.call(this,t,360,300)).caption="DeFloatItem属性",n.chkCanEdit=new en(t,"允许修改内容"),n.chkCanEdit.left=5,n.chkCanEdit.top=11,n.chkDeleteAllow=new en(t,"允许删除"),n.chkDeleteAllow.left=n.chkCanEdit.right+5,n.chkDeleteAllow.top=n.chkCanEdit.top,n.edtText=new hn(t,"文本：",""),n.edtText.left=5,n.edtText.top=35,n.edtText.width=160,n.beginUpdate();try{n.addControl(n.chkCanEdit),n.addControl(n.chkDeleteAllow),n.addControl(n.edtText)}finally{n.endUpdate()}return n}return l()(i,[{key:"SetView",value:function(t,e){var i=this;this.beginUpdate();try{if(!e.isClass(gc)&&!e.isClass(Ic))return;this.chkCanEdit.checked=!e.EditProtect,this.chkDeleteAllow.checked=e.DeleteAllow,this.edtText.text=e.Text,this.getPropertys(e.Propertys),this.moveCenter()}finally{this.endUpdate()}this.showModal((function(){e.EditProtect=!i.chkCanEdit.checked,e.DeleteAllow=i.chkDeleteAllow.checked,e.Text=i.edtText.text,i.setPropertys(e.Propertys),t.UpdateView()}))}}]),i}(Sf);function cd(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var ud=function(t){m()(i,t);var e=cd(i);function i(t){var n;r()(this,i),(n=e.call(this,t)).visible_=!1,n.borderVisible_=!0,n.Table=null,n.Row=-1,n.FmtPt=new et;var o=new gn(t);o.dropDownStyle=!0,o.autoClose=!0;var s=new ln(t,1,1);s.width=32,s.align=Zt;var a=o.addItem("空行");a.control=s,a.onClick=function(){n.DoInsertRow(s.number,!1)};var l=new ln(t,1,1);l.width=32,l.align=Zt;var h=o.addItem("克隆当前行");return h.control=l,h.onClick=function(){n.DoInsertRow(l.number,!0)},n.btnAdd=new Xi(t),n.btnAdd.image.src=t.emrCommon.ResRowbottom,n.btnAdd.textVisible=!1,n.btnAdd.hint="当前行下面插入新行",n.btnAdd.dropDownMenu=o,n.addControl(n.btnAdd),n.btnDel=new Qi(t),n.btnDel.image.src=t.emrCommon.ResDeleterow,n.btnDel.textVisible=!1,n.btnDel.hint="删除当前行",n.btnDel.onClick=function(){n.DoDeleteRow()},n.addControl(n.btnDel),n.width=n.btnAdd.width+16+n.btnDel.width,n.OnInsertRow=null,n.OnDeleteRow=null,n}return l()(i,[{key:"DoInsertRow",value:function(t,e){null!==this.OnInsertRow&&this.OnInsertRow(t,e)}},{key:"DoDeleteRow",value:function(){null!==this.OnDeleteRow&&this.OnDeleteRow()}},{key:"CheckVisible",value:function(){this.visible=null!==this.Table&&this.Row>=0}}]),i}($i),fd=function(t){m()(i,t);var e=cd(i);function i(t){var n;r()(this,i),(n=e.call(this,t)).visible_=!1,n.borderVisible_=!0,n.DomainInfo=new Ws;var o=new gn(t);return o.dropDownStyle=!0,o.autoClose=!0,o.addItem("重新选择").onClick=function(){n.DoPopup()},n.btn=new Xi(t),n.btn.image.src=t.emrCommon.ResDegroup,n.btn.textVisible=!1,n.btn.hint="当前行下面插入新行",n.btn.dropDownMenu=o,n.addControl(n.btn),n.width=n.btn.width+16,n.OnPopup=null,n}return l()(i,[{key:"DoPopup",value:function(){null!==this.OnPopup&&this.OnPopup()}}]),i}($i),dd=function(t){m()(i,t);var e=cd(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).visible_=!1,n.productID=0,n.productVer=0,n.Composition_="",n.canFocus=!1,n.drawShadow=!0,n.toolBar=new $i(t),n.btnPud=n.toolBar.addButton("",!1,t.emrCommon.ResDegroup),n.toolBar.align=Xt,n.lblComp=new Ki(t,""),n.lblComp.align=Qt,n.toolBar.addControl(n.lblComp),n.listBox=new dn(t),n.listBox.borderVisible_=!1,n.listBox.align=$t,n.height_=n.CalcHeight(),n.width_=n.listBox.width,n.addControl(n.toolBar),n.addControl(n.listBox),n.OnDone=null,n.OnCandidateList=null,n.OnCompositionUpdate=null,n}return l()(i,[{key:"mouseUp",value:function(t){f()(F()(i.prototype),"mouseUp",this).call(this,t),this._mouseMoveControl===this.listBox&&this.doDone(this.Text)}},{key:"doVisibleChange_",value:function(t){f()(F()(i.prototype),"doVisibleChange_",this).call(this,t),this.visible||(this.Composition="")}},{key:"doCompositionUpdate",value:function(){null!==this.OnCompositionUpdate&&this.OnCompositionUpdate({productID:this.productID,productVer:this.productVer,data:this.Composition_})}},{key:"doDone",value:function(t){this.visible=!1,null!==this.OnDone&&this.OnDone(t)}},{key:"CalcHeight",value:function(){return(this.listBox.items.count>0?this.listBox.items.count:5)*(this.listBox.font.height+this.hcl.theme.marginSpaceDouble)+this.listBox.paddingTop+this.toolBar.height}},{key:"KeyDownComp",value:function(t){}},{key:"KeyUpComp",value:function(t){switch(t.keyCode){case Qe:this.listBox.itemIndex<this.listBox.items.count-1?this.listBox.itemIndex++:this.listBox.itemIndex===this.listBox.items.count-1&&(this.listBox.itemIndex=0);break;case je:this.listBox.itemIndex>0?this.listBox.itemIndex--:this.listBox.items.count>0&&(this.listBox.itemIndex=this.listBox.items.count-1);break;case Ee:this.Composition_.length>1?(this.Composition=this.Composition_.substring(0,this.Composition_.length-1),this.doCompositionUpdate()):(this.Composition_="",this.visible=!1);break;case Le:this.doDone(this.Composition_);break;case We:this.doDone(this.Text);break;case Ue:this.visible=!1}}},{key:"KeyPressComp",value:function(t){return t.keyCode>=97&&t.keyCode<=122?(this.Composition+=String.fromCharCode(t.keyCode),this.doCompositionUpdate(),!0):32===t.keyCode?this.visible:(this.visible=!1,!1)}},{key:"Show",value:function(t,e,i,n){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.listBox.clear(),1===this.productID){if(t.ErrorCode<0)return void(this.visible=!1);for(var s=t.Body,r=0;r<s.length;r++)this.listBox.addItem(s[r].Text);null!==this.OnCandidateList&&this.OnCandidateList(this.Composition_,this.listBox),0===this.listBox.items.count?this.listBox.itemIndex=-1:this.listBox.itemIndex=0,this.width=Math.max(Math.max(50,this.listBox.getContentWidth()+this.listBox.paddingLeft+this.listBox.paddingRight+this.hcl.theme.marginSpace+(this.listBox.borderVisible?this.listBox.borderWidth_:0)),this.lblComp.width+this.btnPud.width+this.hcl.theme.marginSpace),this.height=this.CalcHeight(),this.left=e,this.top=o?i-this.height:i+n}this.visible_||(this.visible=!0)}},{key:"Text",get:function(){return this.listBox.text}},{key:"Composition",get:function(){return this.Composition_},set:function(t){this.Composition_!==t&&(this.Composition_=t,this.lblComp.text=this.Composition_)}}]),i}(Bi),md=function(t){m()(i,t);var e=cd(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).TableTool=null,n.DomainTool=null,n.InputTool=null,n.OnActiveDeGroupPopup=null,n}return l()(i,[{key:"CloseInputTool",value:function(){this.UseInputTool&&(this.InputTool.visible=!1)}},{key:"Clear",value:function(){f()(F()(i.prototype),"Clear",this).call(this),this.UseTableTool&&(this.TableTool.visible=!1),this.UseDomainTool&&(this.DomainTool.visible=!1),this.CloseInputTool()}},{key:"CalcDomainToolPosition",value:function(){if(null!==this.DomainTool.DomainInfo.Data){var t=this.DomainTool.DomainInfo,e=t.Data.GetDrawItemFormatCoord(t.Data.Items[t.EndNo].FirstDItemNo);e=this.GetSectionFormatPointToViewCoord(e,this.FActiveSectionIndex,this.ActiveSection.ActivePageIndex),this.DomainTool.left_=e.x,this.DomainTool.top_=e.y}else this.DomainTool.visible=!1}},{key:"CalcTableToolPosition",value:function(){var t=this.GetSectionFormatPointToViewCoord(this.TableTool.FmtPt,this.FActiveSectionIndex,this.ActiveSection.FMousePageIndex);this.TableTool.left_=t.x,this.TableTool.top_=t.y-this.TableTool.height}},{key:"GetHotTable",value:function(t,e){return e<0?null:t.Items[e].StyleNo===oo.Table?t.Items[e]:null!==t.ParentData?this.GetHotTable(t.ParentData,t.ParentData.MouseMoveItemNo):null}},{key:"DoVerScroll",value:function(t,e,n){f()(F()(i.prototype),"DoVerScroll",this).call(this,t,e,n),this.UseTableTool&&this.CalcTableToolPosition(),this.UseDomainTool&&this.CalcDomainToolPosition()}},{key:"DoSectionDataDomainSwitch",value:function(t,e,n,o){f()(F()(i.prototype),"DoSectionDataDomainSwitch",this).call(this,t,e,n,o),this.UseDomainTool&&(this.DomainTool.DomainInfo.Assign(e.ActiveDomain),this.CalcDomainToolPosition(),this.DomainTool.visible=null!==this.DomainTool.DomainInfo.Data)}},{key:"DoSectionItemMouseDown",value:function(t,e,n,o,s){f()(F()(i.prototype),"DoSectionItemMouseDown",this).call(this,t,e,n,o,s)}},{key:"DoSectionDrawItemMouseMove",value:function(t,e,n,o,s,r){if(f()(F()(i.prototype),"DoSectionDrawItemMouseMove",this).call(this,t,e,n,o,s,r),this.UseTableTool){var a=this.GetHotTable(e,n);if(this.TableTool.Table!==a&&(a&&a.UseToolButton?this.TableTool.Table=a:this.TableTool.Table=null,this.TableTool.Row=-1,this.Style.UpdateInfoRePaint()),e.Items[n]===this.TableTool.Table){var l=this.TableTool.Table.GetRowAt(r.y);if(this.TableTool.Row!==l){if(this.TableTool.Row=l,l>=0){var h=e.GetDrawItemFormatCoord(e.Items[n].FirstDItemNo);h.x+=e.Items[n].Width,h.y+=this.FStyle.LineSpaceMin/2+this.TableTool.Table.GetRowBottom(l),this.TableTool.FmtPt.resetByPoint(h),this.CalcTableToolPosition(),h=null}this.Style.UpdateInfoRePaint()}}this.TableTool.CheckVisible()}}},{key:"DoDeGroupPopup",value:function(){null!==this.OnActiveDeGroupPopup&&this.OnActiveDeGroupPopup()}},{key:"ShowInputTool",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.ShowInputToolAt(t,this.Caret.X,this.Caret.Y,this.Caret.Height,e)}},{key:"ShowInputToolAt",value:function(t,e,i,n){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.UseInputTool&&this.InputTool.Show(t,e,i,n,o)}},{key:"doMouseDown_",value:function(t){this.UseInputTool&&this.getControlAt(t.x,t.y)!==this.InputTool&&this.CloseInputTool(),f()(F()(i.prototype),"doMouseDown_",this).call(this,t)}},{key:"doKeyDown_",value:function(t){this.UseInputTool&&this.InputTool.visible?this.InputTool.KeyDownComp(t):f()(F()(i.prototype),"doKeyDown_",this).call(this,t)}},{key:"doKeyUp_",value:function(t){this.UseInputTool&&this.InputTool.visible?this.InputTool.KeyUpComp(t):f()(F()(i.prototype),"doKeyUp_",this).call(this,t)}},{key:"doKeyPress_",value:function(t){this.UseInputTool&&this.InputTool.KeyPressComp(t)||f()(F()(i.prototype),"doKeyPress_",this).call(this,t)}},{key:"setFocus",value:function(){f()(F()(i.prototype),"setFocus",this).call(this),this.focused&&this.imeMode!==Oi&&(this.hcl.ime.readOnly=this.UseInputTool)}},{key:"UseTableTool",get:function(){return null!==this.TableTool},set:function(t){var e=this;t?null===this.TableTool&&(this.TableTool=new ud(this.hcl),this.addControl(this.TableTool),this.TableTool.OnInsertRow=function(t,i){e.TableTool.Table.InsertRowWith(e.TableTool.Row+1,t,i),e.TableTool.Table.ReFormatRequest(),e.TableTool.CheckVisible(),e.ClearUndo()},this.TableTool.OnDeleteRow=function(){e.TableTool.Table.DeleteRow(e.TableTool.Row),e.TableTool.Row>e.TableTool.Table.RowCount-1&&(e.TableTool.Row=-1),e.TableTool.Table.ReFormatRequest(),e.TableTool.CheckVisible(),e.ClearUndo()}):null!==this.TableTool&&(this.removeControl(this.TableTool),this.TableTool=null)}},{key:"UseDomainTool",get:function(){return null!==this.DomainTool},set:function(t){var e=this;t?null===this.DomainTool&&(this.DomainTool=new fd(this.hcl),this.addControl(this.DomainTool),this.DomainTool.OnPopup=function(){e.DoDeGroupPopup()}):null!==this.DomainTool&&(this.removeControl(this.DomainTool),this.DomainTool=null)}},{key:"UseInputTool",get:function(){return null!==this.InputTool},set:function(t){var e=this;t?null===this.InputTool&&(this.InputTool=new dd(this.hcl),this.addControl(this.InputTool),this.InputTool.OnDone=function(t){e.InsertText(t)}):null!==this.InputTool&&(this.removeControl(this.InputTool),this.InputTool=null)}}]),i}(hf);function Sd(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var pd=function(){function t(){r()(this,t)}return l()(t,[{key:"Contains",value:function(t,e){return(t&e)==e}}]),t}();pd.WriteTraceInfo=1,pd.HideTrace=2;var yd=function(t){m()(i,t);var e=Sd(i);function i(t,n,o){var s,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return r()(this,i),(s=e.call(this,t,n,o)).state_.add(Ri.Creating),s.captionBar.captureParent=!1,s.captionBar.controls.clear(),s.UseAnnotate=!1,s.ReadOnlyHint=s.langText(0),s.keyPreview=!0,s.FMouseInElementFire=!1,s.frmRecordPop=null,s.frmPrintView=null,s.FEmrView=null,s.symbolPopupControl=null,s.symbolArray=[{s:"①"},{s:"②"},{s:"③"},{s:"④"},{s:"⑤"},{s:"⑥"},{s:"⑦"},{s:"⑧"},{s:"⑨"},{s:"⑩"},{s:"Ⅰ"},{s:"Ⅱ"},{s:"Ⅲ"},{s:"Ⅳ"},{s:"Ⅴ"},{s:"Ⅵ"},{s:"Ⅶ"},{s:"Ⅷ"},{s:"Ⅸ"},{s:"Ⅹ"},{s:"Ⅺ"},{s:"Ⅻ"},{s:"№"},{s:"≤"},{s:"≥"},{s:"≈"},{s:"≠"},{s:"±"},{s:"∑"},{s:"∏"},{s:"∅"},{s:"＋"},{s:"－"},{s:"×"},{s:"÷"},{s:"‰"},{s:"∂"},{s:"∆"},{s:"¥"},{s:"$"},{s:"€"},{s:"α"},{s:"β"},{s:"γ"},{s:"μ"},{s:"Ω"},{s:"℃,"},{s:"℉"},{s:"cmH2O",r:{Items:[{Text:"cmH"},{Text:"2",TextStyle:{FontStyles:{Subscript:!0}}},{Text:"O"}]}},{s:"10^9/L",r:{Items:[{Text:"10"},{Text:"9",TextStyle:{FontStyles:{Superscript:!0}}},{Text:"/L"}]}},{s:"10^12/L",r:{Items:[{Text:"10"},{Text:"12",TextStyle:{FontStyles:{Superscript:!0}}},{Text:"/L"}]}},{s:"39^+6",r:{Items:[{Text:"39"},{Text:"+6",TextStyle:{FontStyles:{Superscript:!0}}}]}},{s:"mol/L"},{s:"mmol/L"},{s:"nmol/L"},{s:"g/L"},{s:"mmHg"},{s:"kPa"},{s:"mg/L"},{s:"mol/24h"}],s.PrintParam=null,s.FLastAutoComplateItem=null,s.FOldTopData=null,s.FOldDomainNo=-1,s.pnlCmd=null,s.cbxCmd=null,s.cbbFont=null,s.cbbFontSize=null,s.cbbFontColor=null,s.btnBold=null,s.btnItalic=null,s.btnUnderline=null,s.btnStrikeOut=null,s.btnSuperscript=null,s.btnSubscript=null,s.btnAlignLeft=null,s.btnAlignRight=null,s.btnAlignCenter=null,s.btnAlignJustify=null,s.btnAlignScatter=null,s.ObjectData=null,s.OnDeItemPopup=null,s.OnCaretChange=null,s.OnChangedSwitch=null,s.OnReadOnlySwitch=null,s.OnSetDeItemText=null,s.OnSave=null,s.OnPrint=null,s.OnPrintCurPage=null,s.OnPrintOdd=null,s.OnPrintEven=null,s.OnPrintCurLine=null,s.OnPrintSelect=null,s.OnSetPrintStartLine=null,s.OnSetPrintEndLine=null,s.OnPrintLineRange=null,s.OnLoadDocxFile=null,s.OnDeItemGetSyncValue=null,s.OnSaveStructure=null,s.OnInsertDeItem=null,s.OnDeComboboxPopup=null,s.OnTableCellPopup=null,s.OnEmrViewKeyDown=null,s.OnMouseUpLib=null,s.OnViewMenuPopup=null,s.OnAnnotateMenuPopup=null,s.OnBtnMenuPopup=null,s.OnPopupFormClose=null,s.OnExternalDeItemPopupLib=null,s.OnScrollBarResize=null,s.OnDataItemAutoComplate=null,s.OnEmrViewZoomChanged=null,s.OnUnRedoSeek=null,s.OnShowActiveAnnotateForm=null,s.OnDeleteActiveAnnotate=null,s.OnDeleteAnnotateAfter=null,s.OnActiveAnnotateAddReply=null,s.OnActiveAnnotateSolve=null,a?s._initToolBar():s.captionBar.visible=!1,l&&s._initContextMenu(),s._initAnnotateMenu(),s._initEmrView(),s.state_.delete(Ri.Creating),s}return l()(i,[{key:"OpenFileWithDialog",value:function(){this._openFileDialog()}},{key:"_openFileDialog",value:function(){var t=this;kh.execute(this.hcl,L.stringFormat("{0},{1},{2}",_.XML,_.DOCX,".hcf"),(function(e){var i=e.firstFile.name.lastIndexOf(".");switch(e.firstFile.name.substring(i)){case".hcf":t.FEmrView.LoadFromFile(e.firstFile);break;case".docx":t.DoLoadDocxFile(e.firstFile)}}))}},{key:"_symbolPopup",value:function(t,e,i){var n=this;null===this.symbolPopupControl&&(this.symbolPopupControl=new Fd(this.hcl),this.symbolPopupControl.setSize(200,200),this.symbolPopupControl.onClose=function(){},this.symbolPopupControl.onDone=function(){n.symbolPopupControl.index>=0&&(n.symbolPopupControl.syarr[n.symbolPopupControl.index].r?n.FEmrView.InsertJSONObject(n.symbolPopupControl.syarr[n.symbolPopupControl.index].r):n.FEmrView.InsertText(n.symbolPopupControl.syarr[n.symbolPopupControl.index].s)),n.symbolPopupControl=null},this.symbolPopupControl.syarr=this.symbolArray),this.symbolPopupControl.popup(t,e,!1)}},{key:"doBtnMenuPopup",value:function(t,e){null!==this.OnBtnMenuPopup&&this.OnBtnMenuPopup(t,e)}},{key:"_initToolBar",value:function(){var t=this;if(0===this.captionBar.controls.count){var e=new gn(this.hcl);e.dropDownStyle=!0,e.onPopup=function(){t.doBtnMenuPopup(t.btnInsert,e.subItems)};var i=e.addItem(this.langText(24),null,null,"table");i.image.src=this.hcl.emrCommon.ResTable,i.onClick=function(){t.InsertTableWithDialog()},e.addItem(this.langText(51),this.hcl.emrCommon.ResImage,null,"image").onClick=function(){t.InsertImageWithDialog()};var n=e.addItem(this.langText(52),this.hcl.emrCommon.ResFormula,null,"medFormula");n.hint="插入各类医学公式",n.addItem("月经史",this.hcl.emrCommon.ResFormula).onClick=function(){t.InsertDeYueJingItem("12","5-6",lt.Now().format("yyyy-MM-dd"),"28-30")},n.addItem("牙位(普通)",this.hcl.emrCommon.ResTooth).onClick=function(){t.InsertDeToothItem("XX","XX","XX","XX")},n.addItem("牙位(帕尔默)",this.hcl.emrCommon.ResPamer).onClick=function(){t.InsertPamerToothItem("|8^PL|7^D","|76","|87^PLDBOM","|85")},n.addItem("房角",this.hcl.emrCommon.ResFangJiao).onClick=function(){t.InsertDeFangJiaoItem("","","","")},n.addItem("中药",this.hcl.emrCommon.ResMedicine).onClick=function(){t.InsertChineseMedicineItem("当归","20g","先煎")},n.addItem("孕周",this.hcl.emrCommon.ResGestational).onClick=function(){t.InsertGestationalWeekItem("43","+5")},n.addItem("瞳孔",this.hcl.emrCommon.ResPupil).onClick=function(){t.InsertPupilItem("1","2","3","4","5","6","7")},n.addItem("光定位",this.hcl.emrCommon.ResLightperception).onClick=function(){t.InsertLightPerceptionItem("1","2","3","4","5","6","7","8","9")},n.addItem("胎心位",this.hcl.emrCommon.ResFetalheart).onClick=function(){t.InsertFetalHeartItem("1","2","3","4","5","6")};var o=n.addItem("分数1");o.image.src=this.hcl.emrCommon.ResFraction1,o.onClick=function(){t.InsertFraction1Item("1","2")};var s=n.addItem("分数2");s.image.src=this.hcl.emrCommon.ResFraction2,s.onClick=function(){t.InsertFraction2Item("1","2")},e.addItem("横线",this.hcl.emrCommon.ResLine).onClick=function(){t.FEmrView.InsertLine(1)};var r=e.addItem("控件",this.hcl.emrCommon.ResEdit,null,"ctr");r.hint="插入各类控件",r.addItem("CheckBox",this.hcl.emrCommon.ResCheckBox).onClick=function(){var e=new fc(t.hcl,t.FEmrView.ActiveSectionTopLevelData(),t.FEmrView.DefaultCheckText,!1);t.FEmrView.InsertItem(e)},r.addItem("Combobox",this.hcl.emrCommon.ResCombobox).onClick=function(){var e=new Sc(t.hcl,t.FEmrView.ActiveSectionTopLevelData(),t.FEmrView.DefaultComboboxText);e.AddItem("item1","1"),e.AddItem("item2","2"),e.AddItem("item3","3"),e.AddItem("item4","4"),e.AddItem("item5","5"),e.AddItem("item6","6"),e.PopupAutoWidth=!0,t.FEmrView.InsertItem(e)},r.addItem("DateTimePicker",this.hcl.emrCommon.ResDateTime).onClick=function(){var e=new pc(t.hcl,t.FEmrView.ActiveSectionTopLevelData(),lt.Now());t.FEmrView.InsertItem(e)},r.addItem("RadioGroup",this.hcl.emrCommon.ResRadio).onClick=function(){var e=new yc(t.hcl,t.FEmrView.ActiveSectionTopLevelData());e.AddItem("item1","1",!1),e.AddItem("item2","2",!1),e.AddItem("item3","3",!1),t.FEmrView.InsertItem(e)},r.addItem("Edit",this.hcl.emrCommon.ResEdit).onClick=function(){var e=new mc(t.hcl,t.FEmrView.ActiveSectionTopLevelData(),t.FEmrView.DefaultEditText);t.FEmrView.InsertItem(e)},r.addItem("Button",this.hcl.emrCommon.ResButton).onClick=function(){var e=new dc(t.hcl,t.FEmrView.ActiveSectionTopLevelData(),"按钮");t.FEmrView.InsertItem(e)},e.addItem("分页",this.hcl.emrCommon.ResPageBreak,null,"pageBreak").onClick=function(){t.FEmrView.InsertPageBreak()},e.addItem("分节",this.hcl.emrCommon.ResSecBreak,null,"secBreak").onClick=function(){t.FEmrView.InsertSectionBreak()},e.addItem("文档",null,null,"doc").onClick=function(){t.InsertFileWithDialog()};var a=e.addItem("条码",this.hcl.emrCommon.ResBarCode,null,"code");a.addItem("一维码",this.hcl.emrCommon.ResBarCode).onClick=function(){t.InsertBarCodeWidthDialog()},a.addItem("二维码",this.hcl.emrCommon.ResQRCode).onClick=function(){t.InsertQRCodeWidthDialog()};var l=e.addItem("浮动对象",this.hcl.emrCommon.ResFloat,null,"float");l.addItem("直线",this.hcl.emrCommon.ResLine).onClick=function(){t.InsertFloatLine({})},l.addItem("图片",this.hcl.emrCommon.ResImage).onClick=function(){t.InsertFloatImageWidthDialog()},l.addItem("一维码",this.hcl.emrCommon.ResBarCode).onClick=function(){t.InsertFloatBarCodeWidthDialog()},l.addItem("二维码",this.hcl.emrCommon.ResQRCode).onClick=function(){t.InsertFloatQRCodeWidthDialog()};var h=e.addItem("符号",this.hcl.emrCommon.ResSymbol,"symbol");h.hasSubItem=!0,h.onPopupClose=function(){t.symbolPopupControl&&t.symbolPopupControl.close()},h.onPopup=function(e,i,n){t._symbolPopup(e,i,n)};var c=new gn(this.hcl);c.dropDownStyle=!0,c.onPopup=function(){t.menuDeleteSection.visible=t.FEmrView.Sections.count>1,t.doBtnMenuPopup(t.btnFile,c.subItems)};var u=c.addItem(this.langText(74),null,null,"open");u.hint="打开本地文件",u.onClick=function(){t.PopupFormClose(),t._openFileDialog()},c.addItem(this.langText(75),null,null,"new").onClick=function(){t.FEmrView.Clear()},c.addItem(this.langText(76)).onClick=function(){t.SaveAs()},this.menuExportFile=c.addItem(this.langText(77),null,null,"export"),this.menuExportFile.addItem("XML",null,null,"xml").onClick=function(){t.DoExportXML()},this.menuExportFile.addItem(this.langText(79),null,null,"text").onClick=function(){t.DoExportTXT()},this.menuExportFile.addItem("HTML",null,null,"html").onClick=function(){t.DoExportHTML()},this.menuExportFile.addItem("PDF",null,null,"pdf").onClick=function(){t.DoExportPDF()},this.menuExportFile.visible=!1,this.menuImplortFile=c.addItem(this.langText(78),null,null,"implort"),this.menuImplortFile.addItem("XML",null,null,"xml").onClick=function(){t.DoImportXML()},this.menuImplortFile.addItem(this.langText(79),null,null,"text").onClick=function(){t.DoImportTXT()},this.menuImplortFile.visible=!1,c.addItem(this.langText(80),null,null,"pageSet").onClick=function(){t.PageSetDialog()},this.menuDeleteSection=c.addItem(this.langText(81),null,null,"delActiveSection"),this.menuDeleteSection.onClick=function(){t.FEmrView.DeleteActiveSection()},this.btnFile=new Xi(this.hcl,this.langText(82)),this.btnFile.id="file",this.btnFile.image.src=this.hcl.emrCommon.ResFile,this.btnFile.textVisible=!0,this.btnFile.hint=this.langText(83),this.btnFile.dropDownMenu=c,this.captionBar.addControl(this.btnFile),this.btnSave=this.captionBar.addButton(this.langText(84),!0,this.hcl.emrCommon.ResSave),this.btnSave.onClick=function(){t.DoSave()};var f=new gn(this.hcl);f.id="print",f.dropDownStyle=!0,f.addItem(this.langText(86),null,null,"allPage").onClick=function(){t.PrintAll()},f.addItem(this.langText(87),null,null,"curPage").onClick=function(){t.PrintCurPage()},f.addItem(this.langText(88),null,null,"pageRange").onClick=function(){t.PrintPageRange()},f.addSpliter(),f.addItem(this.langText(89),null,null,"odd").onClick=function(){t.PrintOdd(!1)},f.addItem(this.langText(90),null,null,"oddRev").onClick=function(){t.PrintOdd(!0)},f.addSpliter(),f.addItem(this.langText(91),null,null,"even").onClick=function(){t.PrintEven(!1)},f.addItem(this.langText(92),null,null,"evenRev").onClick=function(){t.PrintEven(!0)},f.addSpliter();var d=f.addItem(this.langText(93),null,null,"curToPage");d.onClick=function(){t.PrintCurLine()};var m=f.addItem(this.langText(94),null,null,"curToLast");m.onClick=function(){t.PrintCurLine(t.FEmrView.PageCount)};var S=f.addItem(this.langText(95),null,null,"sel");S.onClick=function(){t.PrintSelect()};var p=f.addItem(this.langText(96),null,null,"custom");p.addItem(this.langText(97)).onClick=function(){null!=t.OnSetPrintStartLine&&t.OnSetPrintStartLine(t.FEmrView,!1),t.FEmrView.UpdateView()};var y=new en(this.hcl,this.langText(98),!0);y.align=Zt;var F=p.addItem(this.langText(125));F.onClick=function(){null!==t.OnSetPrintEndLine&&t.OnSetPrintEndLine(t.FEmrView,!1),y.checked&&null!==t.OnPrintLineRange&&t.OnPrintLineRange(t.FEmrView,!0),t.FEmrView.UpdateView()},F.control=y,p.addItem(this.langText(126)).onClick=function(){null!==t.OnSetPrintStartLine&&t.OnSetPrintStartLine(t.FEmrView,!0),null!==t.OnSetPrintEndLine&&t.OnSetPrintEndLine(t.FEmrView,!0),t.FEmrView.UpdateView()},p.addItem(this.langText(98)).onClick=function(){null!==t.OnPrintLineRange&&t.OnPrintLineRange(t.FEmrView,!0),t.FEmrView.UpdateView()},f.addSpliter();var v=f.addItem(this.langText(99),null,null,"preView");v.addItem(this.langText(86)).onClick=function(){t.PrintView({})};var I=v.addItem("当前病程");I.onClick=function(){t.PrintView({sectionIndex:t.FEmrView.FCaretProcInfo.SectionIndex,procIndex:t.FEmrView.FCaretProcInfo.Index})},f.onPopup=function(){var e=t.ContinuePrintGaps(),i=t.FEmrView.ActiveSectionTopLevelData();d.enabled=i.SelectInfo.StartItemNo>=0&&!e,d.enabled?d.hint="打印当前行到当前页结束":d.hint="没有当前行或当前行前面有隐藏内容但未隐藏",m.enabled=i.SelectInfo.StartItemNo>=0&&!e,m.enabled?m.hint="打印当前行到最后页结束":m.hint="没有当前行或当前行前面有隐藏内容但未隐藏",S.enabled=i.SelectInfo.StartItemNo>=0&&i.SelectInfo.EndItemNo>=0&&!e,S.enabled?S.hint="打印当前选中内容":S.hint="没有选中内容或当前行前面有隐藏内容但未隐藏",I.visible=""!=t.FEmrView.FCaretProcInfo.Index&&!e,t.doBtnMenuPopup(t.btnPrint,f.subItems)},this.btnPrint=new Xi(this.hcl,this.langText(85)),this.btnPrint.image.src=this.hcl.emrCommon.ResPrint,this.btnPrint.textVisible=!0,this.btnPrint.hint="文档打印",this.btnPrint.dropDownMenu=f,this.captionBar.addControl(this.btnPrint),this.btnInsert=new Xi(this.hcl,"插入"),this.btnInsert.id="insert",this.btnInsert.textVisible=!0,this.btnInsert.hint="插入功能",this.btnInsert.dropDownMenu=e,this.captionBar.addControl(this.btnInsert),this.captionBar.addSpliter(),this.btnUndo=this.captionBar.addButton("撤销",!1,this.hcl.emrCommon.ResUndoDis),this.btnUndo.enabled=!1,this.btnUndo.onClick=function(){t.FEmrView.Undo()},this.btnRedo=this.captionBar.addButton("恢复",!1,this.hcl.emrCommon.ResRedoDis),this.btnRedo.enabled=!1,this.btnRedo.onClick=function(){t.FEmrView.Redo()},this.captionBar.addSpliter(),this.cbbZoom=new mn(this.hcl,"100%"),this.cbbZoom.align=Qt,this.cbbZoom.static=!0,this.cbbZoom.width=48,this.cbbZoom.dropDownWidth=this.cbbZoom.width+5,this.cbbZoom.addItem("25%"),this.cbbZoom.addItem("50%"),this.cbbZoom.addItem("75%"),this.cbbZoom.addItem("100%"),this.cbbZoom.addItem("125%"),this.cbbZoom.addItem("150%"),this.cbbZoom.addItem("200%"),this.cbbZoom.addItem("300%"),this.cbbZoom.addItem("500%"),this.cbbZoom.onSelectedIndexChange=function(){var e=t.cbbZoom.text.replace("%","");t.FEmrView.Zoom=e/100},this.captionBar.addControl(this.cbbZoom),this.cbbFont=new Fn(this.hcl,""),this.cbbFont.static=!0,this.cbbFont.autoDropDownWidth=!0,this.cbbFont.width=56,this.cbbFont.align=Qt,this.hcl.hasFont("Microsoft Himalaya")&&this.cbbFont.addItem("Microsoft Himalaya"),this.cbbFont.onSelectedIndexChange=function(){t.FEmrView.ApplyTextFontName(t.cbbFont.text),t.SetCaretStyleIf()},this.captionBar.addControl(this.cbbFont),this.cbbFontSize=new mn(this.hcl,""),this.cbbFontSize.static=!0,this.cbbFontSize.width=48,this.cbbFontSize.dropDownWidth=64,this.cbbFontSize.state=!0,this.cbbFontSize.align=Qt,this.cbbFontSize.addItem("初号"),this.cbbFontSize.addItem("小初"),this.cbbFontSize.addItem("一号"),this.cbbFontSize.addItem("小一"),this.cbbFontSize.addItem("二号"),this.cbbFontSize.addItem("小二"),this.cbbFontSize.addItem("三号"),this.cbbFontSize.addItem("小三"),this.cbbFontSize.addItem("四号"),this.cbbFontSize.addItem("小四"),this.cbbFontSize.addItem("五号"),this.cbbFontSize.addItem("小五"),this.cbbFontSize.addItem("六号"),this.cbbFontSize.addItem("小六"),this.cbbFontSize.addItem("七号"),this.cbbFontSize.addItem("八号"),this.cbbFontSize.addItem("5"),this.cbbFontSize.addItem("5.5"),this.cbbFontSize.addItem("6.5"),this.cbbFontSize.addItem("7.5"),this.cbbFontSize.addItem("8"),this.cbbFontSize.addItem("9"),this.cbbFontSize.addItem("10"),this.cbbFontSize.addItem("10.5"),this.cbbFontSize.addItem("11"),this.cbbFontSize.addItem("12"),this.cbbFontSize.addItem("14"),this.cbbFontSize.addItem("16"),this.cbbFontSize.addItem("18"),this.cbbFontSize.addItem("20"),this.cbbFontSize.addItem("22"),this.cbbFontSize.addItem("24"),this.cbbFontSize.addItem("26"),this.cbbFontSize.addItem("28"),this.cbbFontSize.addItem("36"),this.cbbFontSize.addItem("48"),this.cbbFontSize.addItem("72"),this.cbbFontSize.itemIndex=10,this.cbbFontSize.onSelectedIndexChange=function(){t.FEmrView.ApplyTextFontSize(Nt.fontSizeToPt(t.cbbFontSize.text)),t.SetCaretStyleIf()},this.captionBar.addControl(this.cbbFontSize),this.cbbFontColor=new In(this.hcl),this.cbbFontColor.align=Qt,this.cbbFontColor.onSelectedIndexChange=function(){t.FEmrView.ApplyTextColor(t.cbbFontColor.color),t.SetCaretStyleIf()},this.captionBar.addControl(this.cbbFontColor),this.splitStyle=this.captionBar.addSpliter(),this.btnBold=this.captionBar.addButton("加粗",!1,this.hcl.emrCommon.ResBold),this.btnBold.hint="加粗",this.btnBold.onClick=function(){t.ApplyTextStyle(Wn.Bold)},this.btnItalic=this.captionBar.addButton("倾斜",!1,this.hcl.emrCommon.ResItalic),this.btnItalic.hint="倾斜",this.btnItalic.onClick=function(){t.ApplyTextStyle(Wn.Italic)},this.btnUnderline=this.captionBar.addButton("下划线",!1,this.hcl.emrCommon.ResUnderline),this.btnUnderline.hint="下划线",this.btnUnderline.onClick=function(){t.ApplyTextStyle(Wn.Underline)},this.btnStrikeOut=this.captionBar.addButton("中划线",!1,this.hcl.emrCommon.ResStrikeout),this.btnStrikeOut.hint="中划线",this.btnStrikeOut.onClick=function(){t.ApplyTextStyle(Wn.Strikeout)},this.btnSuperscript=this.captionBar.addButton("上标",!1,this.hcl.emrCommon.ResSuperscript),this.btnSuperscript.hint="上标",this.btnSuperscript.onClick=function(){t.ApplyTextStyle(Wn.Superscript)},this.btnSubscript=this.captionBar.addButton("下标",!1,this.hcl.emrCommon.ResSubscript),this.btnSubscript.hint="下标",this.btnSubscript.onClick=function(){t.ApplyTextStyle(Wn.Subscript)},this.btnFormatBrush=this.captionBar.addButton("格式刷",!1,this.hcl.emrCommon.ResFormatbrush),this.btnFormatBrush.visible=!1,this.btnFormatBrush.hint="格式刷",this.btnFormatBrush.onClick=function(){var e=t.FEmrView.ActiveSectionTopLevelData().CurStyleNo;e>oo.Null&&(t.FEmrView.Style.FormatBrushStyleNo=e,t.FEmrView.Style.States.Include(oh.FormatBrushing))},this.splitAlign=this.captionBar.addSpliter(),this.btnLeftIdent=this.captionBar.addButton("左缩进",!1,this.hcl.emrCommon.ResRightindent),this.btnLeftIdent.hint="增加左缩进",this.btnLeftIdent.onClick=function(){t.FEmrView.ApplyParaLeftIndentAdd()},this.btnRightIdent=this.captionBar.addButton("右缩进",!1,this.hcl.emrCommon.ResLeftindent),this.btnRightIdent.hint="减少左缩进",this.btnRightIdent.onClick=function(){t.FEmrView.ApplyParaLeftIndentAdd(!1)},this.btnAlignLeft=this.captionBar.addButton("居左",!1,this.hcl.emrCommon.ResLeft),this.btnAlignLeft.hint="左对齐",this.btnAlignLeft.onClick=function(){t.FEmrView.ApplyParaAlignHorz(Ln.Left)},this.btnAlignCenter=this.captionBar.addButton("居中",!1,this.hcl.emrCommon.ResCenter),this.btnAlignCenter.hint="居中对齐",this.btnAlignCenter.onClick=function(){t.FEmrView.ApplyParaAlignHorz(Ln.Center)},this.btnAlignRight=this.captionBar.addButton("居右",!1,this.hcl.emrCommon.ResRight),this.btnAlignRight.hint="右对齐",this.btnAlignRight.onClick=function(){t.FEmrView.ApplyParaAlignHorz(Ln.Right)},this.btnAlignJustify=this.captionBar.addButton("两端",!1,this.hcl.emrCommon.ResJustify),this.btnAlignJustify.hint="两端对齐",this.btnAlignJustify.onClick=function(){t.FEmrView.ApplyParaAlignHorz(Ln.Justify)},this.btnAlignScatter=this.captionBar.addButton("分散",!1,this.hcl.emrCommon.ResScatter),this.btnAlignScatter.hint="分散对齐",this.btnAlignScatter.onClick=function(){t.FEmrView.ApplyParaAlignHorz(Ln.Scatter)};var g=new gn(this.hcl);this.menuSpace100=g.addItem("单倍"),this.menuSpace100.groupIndex=1,this.menuSpace100.onClick=function(){t.FEmrView.ApplyParaLineSpace(Hn.PLS100)},this.menuSpace115=g.addItem("1.15倍"),this.menuSpace115.groupIndex=1,this.menuSpace115.onClick=function(){t.FEmrView.ApplyParaLineSpace(Hn.PLS115)},this.menuSpace150=g.addItem("1.5倍"),this.menuSpace150.groupIndex=1,this.menuSpace150.onClick=function(){t.FEmrView.ApplyParaLineSpace(Hn.PLS150)},this.menuSpace200=g.addItem("2倍"),this.menuSpace200.groupIndex=1,this.menuSpace200.onClick=function(){t.FEmrView.ApplyParaLineSpace(Hn.PLS200)},this.btnLineSpace=new Xi(this.hcl,"行间距"),this.btnLineSpace.id="lineSpace",this.btnLineSpace.hint="行间距选项",this.btnLineSpace.image.src=this.hcl.emrCommon.ResLinespace,this.btnLineSpace.dropDownMenu=g,this.captionBar.addControl(this.btnLineSpace)}}},{key:"_initAnnotateMenu",value:function(){var t=this;this.FAnnotateMenu=new gn(this.hcl),this.FActiveAnnotate=null,this.FAnnotateMenu.onPopup=function(){var s=t.FEmrView.ActiveSectionTopLevelData();t.FActiveAnnotate=s.ActiveAnnotate,n.visible=t.FActiveAnnotate.EndNo>0,o.visible=n.visible,e.visible=n.visible,i.visible=n.visible,i.visible&&s.Items[t.FActiveAnnotate.EndNo].Content.Solve?i.text="设为未解决":i.text="设为解决",null!==t.OnAnnotateMenuPopup&&t.OnAnnotateMenuPopup(t.FAnnotateMenu.subItems,s,s.Items[t.FActiveAnnotate.EndNo])};var e=this.FAnnotateMenu.addItem("新建答复",null,null,"annoReply");e.onClick=function(){if(!(t.FActiveAnnotate.BeginNo<0)){var e=t.FActiveAnnotate.Data.Items[t.FActiveAnnotate.EndNo];null!==t.OnActiveAnnotateAddReply?t.OnActiveAnnotateAddReply(e.OwnerData,e):(e.AddReply("答复标题","答复内容",""),t.FEmrView.UpdateView())}};var i=this.FAnnotateMenu.addItem("设为解决",null,null,"annoSolve");i.onClick=function(){if(!(t.FActiveAnnotate.BeginNo<0)){var e=t.FActiveAnnotate.Data.Items[t.FActiveAnnotate.EndNo],i=e.Content.Solve;null===t.OnActiveAnnotateSolve?Gh.execute(t.hcl,"确认","将此条批注设置为"+(i?"未":"")+"解决？",[Rh,Th],xh,(function(n){n.dlgBtn===Rh&&(i?(t.FActiveAnnotate.Data.Items[t.FActiveAnnotate.BeginNo].Content.Solve=!1,e.Content.Solve=!1):(t.FActiveAnnotate.Data.Items[t.FActiveAnnotate.BeginNo].Content.Solve=!0,e.Content.Solve=!0),t.FEmrView.UpdateView())})):t.OnActiveAnnotateSolve(e.OwnerData,e,i,!i)&&(i?(t.FActiveAnnotate.Data.Items[t.FActiveAnnotate.BeginNo].Content.Solve=!1,e.Content.Solve=!1):(t.FActiveAnnotate.Data.Items[t.FActiveAnnotate.BeginNo].Content.Solve=!0,e.Content.Solve=!0))}},this.FAnnotateMenu.addSpliter();var n=this.FAnnotateMenu.addItem("修改",null,null,"annoEdit");n.onClick=function(){t.ShowActiveAnnotateForm()};var o=this.FAnnotateMenu.addItem("删除",null,null,"annoDel");o.onClick=function(){t.DeleteActiveAnnotate()}}},{key:"_initContextMenu",value:function(){var t=this;this.FContextMenu=new gn(this.hcl),this.FContextMenu.onPopup=function(){null!=t.FEmrView.ActiveSectionTopLevelData().ActiveAnnotate?(t.mniModAnnotate.enabled=!0,t.mniDelAnnotate.enabled=!0):(t.mniModAnnotate.enabled=!1,t.mniDelAnnotate.enabled=!1);var u=t.FEmrView.ActiveSection.ActiveData,d=u.GetActiveFloatItem(),v=u.ReadOnly;if(null==d){j.visible=!1;for(var P=null,R=u.GetActiveItem();R.StyleNo<oo.Null&&R.Active&&null!==(P=R).GetActiveData();)R=(u=P.GetActiveData()).GetActiveItem(),v|=u.ReadOnly;if(v){for(var T=0;T<t.FContextMenu.subItems.count;T++)t.FContextMenu.subItems[T].visible=!1;return i.visible=u.SelectExists(),i.enabled=i.visible,n.visible=i.visible,n.enabled=i.enabled,void(t.OnViewMenuPopup&&t.OnViewMenuPopup(t.FContextMenu.subItems,u,R))}var M=u.SelectExists();if(a.visible=null!==P&&P.StyleNo===oo.Table,a.visible){c.text=1,f.text=1,S.text=1,y.text=1;var $=P,tt=$.GetEditCell();if(null!==tt)switch(l.enabled=!0,tt.ContentAlign){case ih.TopLeft:t.cellAlignTopLeft.checked=!0;break;case ih.TopCenter:t.cellAlignTopCenter.checked=!0;break;case ih.TopRight:t.cellAlignTopRight.checked=!0;break;case ih.CenterLeft:t.cellAlignCenterLeft.checked=!0;break;case ih.CenterCenter:t.cellAlignCenterCenter.checked=!0;break;case ih.CenterRight:t.cellAlignCenterRight.checked=!0;break;case ih.BottomLeft:t.cellAlignBottomLeft.checked=!0;break;case ih.BottomCenter:t.cellAlignBottomCenter.checked=!0;break;case ih.BottomRight:t.cellAlignBottomRight.checked=!0}else l.enabled=!1;if(h.enabled=l.enabled,m.enabled=l.enabled,p.enabled=l.enabled,I.enabled=l.enabled,g.enabled=l.enabled,$.SelectCellRang.EndRow>0){C.enabled=!0;for(var et=$.SelectCellRang.StartRow;et<=$.SelectCellRang.EndRow;et++)if(!$.RowCanDelete(et)){C.enabled=!1;break}}else C.enabled=$.CurRowCanDelete();w.enabled=$.CurColCanDelete(),F.enabled=$.SelectedCellCanMerge(),$.BorderVisible?A.text=t.langText(47):A.text=t.langText(48)}if(r.enabled=!0,r.visible=r.enabled,i.enabled=M,i.visible=i.enabled,n.visible=i.visible,n.enabled=i.enabled,e.enabled=i.enabled&&!v,e.visible=e.enabled,o.enabled=t.hcl.localStorage.hasKey(Yl.HC_EXT)||t.hcl.localStorage.hasKey(E.Text),o.visible=o.enabled,!o.visible&&navigator.clipboard&&(o.visible=!0,navigator.clipboard.read().then((function(e){e.length>0?o.enabled=!0:r.visible=!1,t.update()}))),s.enabled=t.hcl.localStorage.hasKey(E.Text),s.visible=s.enabled,W.visible=!1,K.visible=t.FEmrView.DesignModeEx,z.visible=!1,x.visible=!1,B.visible=!1,N.visible=!1,O.visible=!1,D.visible=t.FEmrView.DesignModeEx,Y.visible=!1,Q.visible=!1,_.visible=!1,H.visible=!1,V.visible=!1,U.visible=!1,k.visible=!1,J.visible=!1,R.StyleNo===oo.Image)W.visible=!u.ReadOnly&&R.Active,W.text="图片属性",z.visible=!R.EditProtect;else if(W.visible=!u.ReadOnly&&!M&&R.isClass(cs)&&R.Active,W.visible)switch(R.StyleNo){case oo.RadioGroup:W.text="RadioGroup";break;case oo.Edit:W.text="Edit";break;case oo.DateTimePicker:W.text="DateTimePicker";break;case oo.Combobox:W.text="Combobox";break;case oo.Button:W.text="Button";break;case oo.CheckBox:W.text="CheckBox";break;default:W.text="属性("+R.className+")"}R.StyleNo>oo.Null&&(R.IsElement&&!M&&(x.visible=!0,x.text=R.GetValue(Yh.Name),x.hint="数据元 "+x.text),t.FEmrView.DesignModeEx?(b.visible=!0,B.visible=!0,N.visible=!0,O.visible=!0,M?(Y.text=t.langText(16),Y.visible=!0,Q.text=t.langText(17),Q.visible=!0,X.visible=!1):(R.EditProtect?Y.text=t.langText(21):Y.text=t.langText(16),Y.visible=!0,R.CopyProtect?Q.text=t.langText(22):Q.text=t.langText(17),Q.visible=!0)):(X.visible=!1,b.visible=!1,R.DeleteAllow&&(B.visible=!0))),X.visible=t.FEmrView.DesignModeEx,X.visible&&(R.KeepParaFirst?X.text=t.langText(23):X.text=t.langText(18)),u.ActiveDomain.BeginNo>=0&&!u.Items[u.ActiveDomain.BeginNo].IsProc&&(_.visible=!0,_.text="["+u.Items[u.ActiveDomain.BeginNo].GetValue(Yh.Name)+"]",_.hint="数据组 "+_.text,t.FEmrView.DesignModeEx?(L.visible=!0,G.visible=!0,H.visible=!0,V.visible=!0,U.visible=!0):(G.visible=!1,u.Items[u.ActiveDomain.BeginNo].DeleteAllow?(L.visible=!0,H.visible=!0):L.visible=!1)),R.StyleNo<oo.Null&&(a.visible||W.visible||R.StyleNo===oo.Line&&(J.visible=!0,J.text="横线属性")),k.visible=W.visible||x.visible||_.visible||J.visible,Z.enabled=M,t.mniAnnotate.visible=t.UseAnnotate&&!v&&(u.ActiveAnnotate.EndNo>0||M)&&(Z.enabled||t.mniDelAnnotate.enabled||t.mniModAnnotate.enabled),q.visible=t.FEmrView.DesignModeEx,t.OnViewMenuPopup&&t.OnViewMenuPopup(t.FContextMenu.subItems,u,R)}else{for(var it=0;it<t.FContextMenu.subItems.count;it++)t.FContextMenu.subItems[it].visible=!1;v||(j.visible=t.FEmrView.DesignModeEx,d.StyleNo===oo.FloatBarCode?j.text="浮动一维码":d.StyleNo===oo.FloatQRCode?j.text="浮动二维码":d.StyleNo===oo.FloatLine?j.text="浮动直接":d.StyleNo===oo.FloatImage&&(j.text="浮动图片"))}};var e=this.FContextMenu.addItem(this.langText(3)+" Ctrl+X",null,null,"cut");e.onClick=function(){window.document.execCommand("cut")};var i=this.FContextMenu.addItem(this.langText(1)+" Ctrl+C",this.hcl.emrCommon.ResCopy,null,"copy");i.onClick=function(){window.document.execCommand("copy")};var n=this.FContextMenu.addItem(this.langText(4),this.hcl.emrCommon.ResCopyAdd,null,"copyAdd");n.onClick=function(){t.FEmrView.CopyAdd=!0;try{window.document.execCommand("copy")}finally{t.FEmrView.CopyAdd=!1}};var o=this.FContextMenu.addItem(this.langText(2)+" Ctrl+V",this.hcl.emrCommon.ResPaste,null,"paste");o.hint="粘贴本应用内复制的数据",o.onClick=function(){window.document.execCommand("paste")||t.FEmrView.Paste()};var s=this.FContextMenu.addItem(this.langText(5),null,null,"pasteAsText");s.onClick=function(){t.FEmrView.PasteAsText()};var r=this.FContextMenu.addItem(this.langText(6),null,null,"para");r.hint="设置段落属性",r.image.src=this.hcl.emrCommon.ResParagraph,r.onClick=function(){t.ShowActiveParagraphForm()};var a=this.FContextMenu.addItem(this.langText(24),this.hcl.emrCommon.ResTable,null,"tableMenu"),l=a.addItem(this.langText(25),this.hcl.emrCommon.ResRowtop,null,"insertRowTop");l.onClick=function(){t.FEmrView.ActiveTableInsertRowBefor(1)};var h=a.addItem(this.langText(26),this.hcl.emrCommon.ResRowbottom,null,"insertRowBottom"),c=new ln(this.hcl,1,1);c.width=32,c.align=Zt;var u=h.addItem(this.langText(27),null,null,"insertEmptyRow");u.control=c,u.onClick=function(){t.FEmrView.ActiveTableInsertRowAfterWith(c.number)};var f=new ln(this.hcl,1,1);f.width=32,f.align=Zt;var d=h.addItem(this.langText(28),null,null,"insertCloneRow");d.control=f,d.onClick=function(){t.FEmrView.ActiveTableInsertRowAfterWith(f.number,!0)},a.addSpliter();var m=a.addItem(this.langText(29),this.hcl.emrCommon.ResColleft,null,"insertColLeft"),S=new ln(this.hcl,1,1);S.width=32,S.align=Zt,m.control=S,m.onClick=function(){t.FEmrView.ActiveTableInsertColBefor(S.number)};var p=a.addItem(this.langText(30),this.hcl.emrCommon.ResColright,null,"insertColRight"),y=new ln(this.hcl,1,1);y.width=32,y.align=Zt,p.control=y,p.onClick=function(){t.FEmrView.ActiveTableInsertColAfter(y.number)},a.addSpliter();var F=a.addItem(this.langText(31)+" Ctrl+M",this.hcl.emrCommon.ResMerge,null,"merge");F.onClick=function(){t.FEmrView.MergeTableSelectCells()};var v=a.addItem(this.langText(32),null,null,"cellAlign");this.cellAlignTopLeft=v.addItem(this.langText(33),this.hcl.emrCommon.ResTopleft,1,"cellAlignTopLeft"),this.cellAlignTopLeft.onClick=function(){t.FEmrView.ApplyTableCellAlign(ih.TopLeft)},this.cellAlignTopCenter=v.addItem(this.langText(34),this.hcl.emrCommon.ResTopcenter,1,"cellAlignTopCenter"),this.cellAlignTopCenter.onClick=function(){t.FEmrView.ApplyTableCellAlign(ih.TopCenter)},this.cellAlignTopRight=v.addItem(this.langText(35),this.hcl.emrCommon.ResTopright,1,"cellAlignTopRight"),this.cellAlignTopRight.onClick=function(){t.FEmrView.ApplyTableCellAlign(ih.TopRight)},this.cellAlignCenterLeft=v.addItem(this.langText(36),this.hcl.emrCommon.ResCenterleft,1,"cellAlignCenterLeft"),this.cellAlignCenterLeft.onClick=function(){t.FEmrView.ApplyTableCellAlign(ih.CenterLeft)},this.cellAlignCenterCenter=v.addItem(this.langText(37),this.hcl.emrCommon.ResCentercenter,1,"cellAlignCenterCenter"),this.cellAlignCenterCenter.onClick=function(){t.FEmrView.ApplyTableCellAlign(ih.CenterCenter)},this.cellAlignCenterRight=v.addItem(this.langText(38),this.hcl.emrCommon.ResCenterright,1,"cellAlignCenterRight"),this.cellAlignCenterRight.onClick=function(){t.FEmrView.ApplyTableCellAlign(ih.CenterRight)},this.cellAlignBottomLeft=v.addItem(this.langText(39),this.hcl.emrCommon.ResBottomleft,1,"cellAlignBottomLeft"),this.cellAlignBottomLeft.onClick=function(){t.FEmrView.ApplyTableCellAlign(ih.BottomLeft)},this.cellAlignBottomCenter=v.addItem(this.langText(40),this.hcl.emrCommon.ResBottomcenter,1,"cellAlignBottomCenter"),this.cellAlignBottomCenter.onClick=function(){t.FEmrView.ApplyTableCellAlign(ih.BottomCenter)},this.cellAlignBottomRight=v.addItem(this.langText(41),this.hcl.emrCommon.ResBottomright,1,"cellAlignBottomRight"),this.cellAlignBottomRight.onClick=function(){t.FEmrView.ApplyTableCellAlign(ih.BottomRight)},a.addSpliter();var I=a.addItem(this.langText(42),null,null,"splitRow");I.onClick=function(){t.FEmrView.ActiveTableSplitCurRow()};var g=a.addItem(this.langText(43),null,null,"splitCol");g.onClick=function(){t.FEmrView.ActiveTableSplitCurCol()},a.addSpliter();var C=a.addItem(this.langText(44),this.hcl.emrCommon.ResDeleterow,null,"deleteSelRow");C.onClick=function(){t.ActiveTableDeleteSelectedRow()};var w=a.addItem(this.langText(45),this.hcl.emrCommon.ResDeletecol,null,"deleteCurCol");w.onClick=function(){t.FEmrView.ActiveTableDeleteCurCol()},a.addSpliter(),a.addItem(this.langText(46),null,null,"mniBorderBack").onClick=function(){t.ShowActiveTableBorderForm()};var A=a.addItem(this.langText(47),this.hcl.emrCommon.ResHideborder,null,"disBorder");A.onClick=function(){t.ActiveTableBorderVisibleSwitch()},a.addItem(this.langText(49),null,null,"adjustWidth").onClick=function(){t.ActiveTableAdjustWidth()},a.addItem(this.langText(14),this.hcl.emrCommon.ResTableProp,null,"prop").onClick=function(){t.DoTablePropertyClick()};var D=a.addItem(this.langText(15),null,null,"script");D.image.src=this.hcl.emrCommon.ResScript,D.onClick=function(){var e=t.FEmrView.GetTopLevelTable();t.ShowItemScriptForm(e)};var P=this.FContextMenu.addItem(this.langText(7),null,null,"construct");P.hint="生成文档结构树",P.image.src=this.hcl.emrCommon.ResConstruct,P.onClick=function(){t.ShowDocTree()};var k=this.FContextMenu.addSpliter(),x=this.FContextMenu.addItem(this.langText(50),null,null,"de");x.image.src=this.hcl.emrCommon.ResDeitem,x.onPaintText=function(e,i,n,o){t.PaintHightlightMenu(e,i,n,o)},x.onGetTextWidth=function(e,i){return t.GetHightlightMenuWidth(e,i)},x.addItem(this.langText(8),null,null,"deResel").onClick=function(){t.ActiveDeItemPopup()};var R=x.addItem(this.langText(9),null,null,"deRef");R.image.src=this.hcl.emrCommon.ResReference,R.onClick=function(){var e=t.EmrView.ActiveSectionTopLevelData().GetActiveItem();t.ActiveDeItemSync(e)};var T=x.addItem(this.langText(19),null,null,"deReref");T.image.src=this.hcl.emrCommon.ResRereference,T.onClick=function(){if(null!=t.OnDeItemGetSyncValue){var e=t.EmrView.ActiveSectionTopLevelData().GetActiveItem(),i=t.OnDeItemGetSyncValue(e);i&&""!=i&&t.DoSetActiveDeItemText(e,i,null)}},x.addSpliter();var b=x.addItem(this.langText(12),null,null,"deHide");b.image.src=this.hcl.emrCommon.ResInVisible,b.onClick=function(){t.FEmrView.HideActiveDeItem()},x.addItem(this.langText(20),null,null,"deReset").onClick=function(){t.FEmrView.ActiveSectionTopLevelData().GetActiveItem().Reset(),t.FEmrView.ActiveSection.ReFormatActiveItem()};var B=x.addItem(this.langText(13),null,null,"deDel");B.image.src=this.hcl.emrCommon.ResDel,B.onClick=function(){var e=t.FEmrView.ActiveSectionTopLevelData(),i=e.GetActiveItem();Gh.execute(t.hcl,"确认","删除数据元 "+i.Name+"？",[Rh,Th],xh,(function(i){i.dlgBtn===Rh&&t.FEmrView.DeleteActiveDataItems(e.SelectInfo.StartItemNo)}))};var N=x.addItem(this.langText(14),null,null,"deProp");N.onClick=function(){t.ShowActiveDeItemForm()};var O=x.addItem(this.langText(15),null,null,"deScript");O.image.src=D.image.src,O.onClick=function(){t.ShowActiveItemScriptForm()};var _=this.FContextMenu.addItem("数据组",null,null,"grp");_.image.src=this.hcl.emrCommon.ResDegroup,_.onPaintText=function(e,i,n,o){t.PaintHightlightMenu(e,i,n,o)},_.onGetTextWidth=function(e,i){return t.GetHightlightMenuWidth(e,i)},_.addItem(this.langText(8),null,null,"grpResel").onClick=function(){t.ActiveDeGroupPopup()};var M=_.addItem(this.langText(9),null,null,"grpRef");M.image.src=R.image.src,M.addItem(this.langText(10),null,null,"grpRefText").onClick=function(){var e=t.FEmrView.ActiveSectionTopLevelData(),i=e.ActiveDomain,n=t.FEmrView.GetDeGroupAsStream(e.Items[i.BeginNo].Index);null!==n&&(n.position=0,t.FEmrView.SetDataDeGroupFromStream(e,i.BeginNo,i.EndNo,n,!0))},M.addItem(this.langText(11),null,null,"grpRefStc").onClick=function(){var e=t.FEmrView.ActiveSectionTopLevelData(),i=e.ActiveDomain,n=t.FEmrView.GetDeGroupAsStream(e.Items[i.BeginNo].Index);n&&(n.position=0,t.FEmrView.SetDataDeGroupFromStream(e,i.BeginNo,i.EndNo,n))};var L=_.addSpliter(),G=_.addItem(this.langText(12),null,null,"grpHide");G.image.src=this.hcl.emrCommon.ResInVisible,G.onClick=function(){var e=t.FEmrView.ActiveSectionTopLevelData(),i=e.Items[e.ActiveDomain.BeginNo];Gh.execute(t.hcl,"确认","隐藏数据组 "+i.Name+"？",[Rh,Th],xh,(function(e){e.dlgBtn===Rh&&t.FEmrView.HideActiveDeGroup()}))};var H=_.addItem(this.langText(13),null,null,"grpDel");H.image.src=this.hcl.emrCommon.ResDel,H.onClick=function(){var e=t.FEmrView.ActiveSectionTopLevelData(),i=e.Items[e.ActiveDomain.BeginNo];Gh.execute(t.hcl,"确认","删除数据组 "+i.Name+"？",[Rh,Th],xh,(function(i){i.dlgBtn===Rh&&t.FEmrView.DeleteActiveDataItems(e.ActiveDomain.BeginNo,e.ActiveDomain.EndNo)}))};var V=_.addItem(this.langText(14),null,null,"grpProp");V.onClick=function(){t.ShowActiveDeGroupPropertyForm()};var U=_.addItem(this.langText(15),null,null,"grpScript");U.image.src=D.image.src,U.onClick=function(){var e=t.FEmrView.ActiveSectionTopLevelData(),i=e.ActiveDomain;if(!(i.BeginNo<0)){var n=e.Items[i.BeginNo];new sd(t.hcl).SetItem(t.FEmrView,n)}};var W=this.FContextMenu.addItem(this.langText(14),null,null,"ctr");W.onPaintText=function(e,i,n,o){t.PaintHightlightMenu(e,i,n,o)},W.onGetTextWidth=function(e,i){return t.GetHightlightMenuWidth(e,i)},W.addItem(this.langText(14),null,null,"ctrProp").onClick=function(){var e=t.FEmrView.ActiveSectionTopLevelData().GetActiveItem();e.StyleNo==oo.RadioGroup?t.ShowDeRadioGroupForm(e):e.StyleNo==oo.Edit?t.ShowDeEditForm(e):e.StyleNo==oo.DateTimePicker?t.ShowDeDateTimeForm(e):e.StyleNo==oo.Combobox?t.ShowDeComboboxForm(e):e.StyleNo==oo.CheckBox?t.ShowDeCheckboxForm(e):e.StyleNo==oo.Image&&t.ShowDeImageForm(e)};var z=W.addItem("标注",null,null,"imgPaint");z.onClick=function(){var e=t.FEmrView.ActiveSectionTopLevelData().GetActiveItem();t.ShowDeImagePainterForm(e)};var K=W.addItem(this.langText(15),null,null,"ctrScript");K.image.src=D.image.src,K.onClick=function(){t.ShowActiveItemScriptForm()};var J=this.FContextMenu.addItem("RectItem属性",null,null,"rectProp");J.onPaintText=function(e,i,n,o){t.PaintHightlightMenu(e,i,n,o)},J.onGetTextWidth=function(e,i){return t.GetHightlightMenuWidth(e,i)},J.onClick=function(){t.ShowActiveLineForm()};var j=this.FContextMenu.addItem("浮动对象属性",null,null,"floatProp");j.onPaintText=function(e,i,n,o){t.PaintHightlightMenu(e,i,n,o)},j.onGetTextWidth=function(e,i){return t.GetHightlightMenuWidth(e,i)},j.onClick=function(){var e=t.FEmrView.ActiveSectionTopLevelData().GetActiveFloatItem();t.ShowDeFloatItemForm(e)};var Y=this.FContextMenu.addItem(this.langText(16),null,null,"disEdit");Y.onClick=function(){var e=t.FEmrView.ActiveSectionTopLevelData();if(e.SelectExists()){for(var i=e.SelectInfo.StartItemNo;i<=e.SelectInfo.EndItemNo;i++)if(e.Items[i].StyleNo<oo.Null)return void t.hcl.showMessage("禁止编辑只能应用于文本内容，选中内容中存在非文本对象！");if(e.SelectInfo.StartItemNo===e.SelectInfo.EndItemNo&&0===e.SelectInfo.StartItemOffset&&e.SelectInfo.EndItemOffset===e.GetItemOffsetAfter(e.SelectInfo.StartItemNo))return e.Items[e.SelectInfo.StartItemNo].EditProtect=!0,void t.FEmrView.UpdateView();for(var n=e.SelectInfo.StartItemNo;n<=e.SelectInfo.EndItemNo;n++)e.Items[n].EditProtect=!1;var o=e.GetSelectText();o=o.replace(/\r\n/g,"");var s=t.FEmrView.NewDeItem(o);s.EditProtect=!0,s.StyleNo=e.Items[e.SelectInfo.StartItemNo].StyleNo,t.FEmrView.InsertDeItem(s)}else{var r=e.GetActiveItem();r.EditProtect=!r.EditProtect,t.FEmrView.ActiveItemReAdaptEnvironment()}};var Q=this.FContextMenu.addItem(this.langText(17),null,null,"disCopy");Q.onClick=function(){var e=t.FEmrView.ActiveSectionTopLevelData();if(e.SelectExists()){for(var i=e.SelectInfo.StartItemNo;i<=e.SelectInfo.EndItemNo;i++)if(e.Items[i].StyleNo<oo.Null)return void t.hcl.showMessage("禁止复制只能应用于文本内容，选中内容中存在非文本对象！");if(e.SelectInfo.StartItemNo==e.SelectInfo.EndItemNo&&0==e.SelectInfo.StartItemOffset&&e.SelectInfo.EndItemOffset==e.GetItemOffsetAfter(e.SelectInfo.StartItemNo))return void(e.Items[e.SelectInfo.StartItemNo].CopyProtect=!0);for(var n=e.SelectInfo.StartItemNo;n<=e.SelectInfo.EndItemNo;n++)e.Items[n].CopyProtect=!1;var o=e.GetSelectText();o=o.replace(/\r\n/g,"");var s=t.FEmrView.NewDeItem(o);s.CopyProtect=!0,t.FEmrView.InsertDeItem(s)}else{var r=e.GetActiveItem();r.CopyProtect=!r.CopyProtect,t.FEmrView.ActiveItemReAdaptEnvironment()}};var X=this.FContextMenu.addItem(this.langText(18),null,null,"keepPara");X.onClick=function(){var e=t.FEmrView.ActiveSectionTopLevelData().GetActiveItem();e.KeepParaFirst=!e.KeepParaFirst},this.mniAnnotate=this.FContextMenu.addItem("批注",null,null,"anno");var Z=this.mniAnnotate.addItem("添加",null,null,"annoAdd");Z.onClick=function(){t.FEmrView.ActiveSection.SelectExists()&&t.ShowAnnotateForm()},this.mniModAnnotate=this.mniAnnotate.addItem("修改",null,null,"annoEdit"),this.mniModAnnotate.onClick=function(){t.ShowActiveAnnotateForm()},this.mniDelAnnotate=this.mniAnnotate.addItem("删除",null,null,"annoDel"),this.mniDelAnnotate.image.src=this.hcl.emrCommon.ResDel,this.mniDelAnnotate.onClick=function(){t.DeleteActiveAnnotate()};var q=this.FContextMenu.addItem(this.langText(15)+"(Data)",null,null,"dataScript");q.image.src=D.image.src,q.onClick=function(){t.ShowActiveDataScriptForm()}}},{key:"DeleteActiveAnnotate",value:function(){var t=this,e=this.FEmrView.GetActiveAnnotateItem();(null===this.OnDeleteActiveAnnotate||this.OnDeleteActiveAnnotate(e.OwnerData,e))&&Gh.execute(this.hcl,"确认","删除批注？",[Rh,Th],xh,(function(i){i.dlgBtn===Rh&&(t.FEmrView.DeleteActiveAnnotate(),null!==t.OnDeleteAnnotateAfter&&t.OnDeleteAnnotateAfter(e.OwnerData,e))}))}},{key:"_initEmrView",value:function(){var t=this;this.FEmrView=new md(this.hcl),this.FEmrView.align=$t,this.FEmrView.popupMenu=this.FContextMenu,this.FEmrView.OnSectionInsertItem=function(e,i,n){t.DoInsertItem(e,i,n)},this.FEmrView.onMouseDown=function(e){t.DoEmrViewMouseDown()},this.FEmrView.OnMouseUp=function(e){t.DoEmrViewMouseUp(e)},this.FEmrView.onKeyDown=function(e){t.DoEmrViewKeyDown(e)},this.FEmrView.OnSectionDrawItemMouseMove=function(e,i,n,o,s,r){t.DoSectionDrawItemMouseMove(i,n,s,r)},this.FEmrView.OnCaretChange=function(){t.DoCaretChange()},this.FEmrView.OnVerScroll=function(){t.DoVerScroll()},this.FEmrView.OnHorScroll=function(){t.DoVerScroll()},this.FEmrView.OnChangedSwitch=function(){t.DoChangedSwitch()},this.FEmrView.OnActiveDeGroupPopup=function(){t.ActiveDeGroupPopup()},this.FEmrView.OnZoomChanged=function(){null!=t.cbbZoom&&(t.cbbZoom.text=Math.trunc(100*t.FEmrView.Zoom)+"%"),t.DoEmrViewZoomChanged(t.FEmrView.Zoom)},this.FEmrView.OnGetHint=function(e,i){return null===t.frmRecordPop||!t.frmRecordPop.visible||t.frmRecordPop.FDeItem!==e.Items[i]},this.FEmrView.OnSectionPaintPaperBefor=function(e,i,n,o,s){t.DoPaintPaperBefor(e,i,n,o,s)},this.FEmrView.VScrollBar.onResize=function(){if(null!==t.OnScrollBarResize){var e=new et;e=t.FEmrView.VScrollBar.clientToScreen(e);var i=new et;i=t.FEmrView.HScrollBar.clientToScreen(i),t.OnScrollBarResize(e.x,e.y,t.FEmrView.VScrollBar.width,t.FEmrView.VScrollBar.height,i.x,i.y,t.FEmrView.HScrollBar.width,t.FEmrView.HScrollBar.height)}},this.FEmrView.OnUnRedoSeek=function(e,i){var n;t.btnUndo&&(n=e>=0)!==t.btnUndo.enabled&&(t.btnUndo.enabled=n,t.btnUndo.image.src=n?t.hcl.emrCommon.ResUndo:t.hcl.emrCommon.ResUndoDis),t.btnRedo&&(n=e<i-1)!==t.btnRedo.enabled&&(t.btnRedo.enabled=n,t.btnRedo.image.src=n?t.hcl.emrCommon.ResRedo:t.hcl.emrCommon.ResRedoDis),null!==t.OnUnRedoSeek&&t.OnUnRedoSeek(e,i)},this.FEmrView.OnAnnotateButtonClick=function(e,i,n){t.FAnnotateMenu.popup(n.x,n.y,!0)},this.addControl(this.FEmrView)}},{key:"doKeyDown_",value:function(t){if(f()(F()(i.prototype),"doKeyDown_",this).call(this,t),t.keyCode===Ue)this.PopupFormClose(!1);else if(this.hcl.keyDownStates[He]&&t.keyCode===qe){var e=this.FEmrView.GetTopLevelTable();null!==e&&e.SelectedCellCanMerge()&&(this.FEmrView.MergeTableSelectCells(),t.keyCode=0)}}},{key:"doResize_",value:function(){f()(F()(i.prototype),"doResize_",this).call(this),null!==this.frmPrintView&&(this.frmPrintView.width=this.width,this.frmPrintView.height=this.height)}},{key:"ApplyTextStyle",value:function(t){this.FEmrView.ApplyTextStyle(t),this.SetCaretStyleIf()}},{key:"SetCaretStyleIf",value:function(){this.FEmrView.ActiveSection.SelectExists()||this.SetFocusInEmrView()}},{key:"SetFocusInEmrView",value:function(){this.hcl._hclH5Canvas.focus(),this.FEmrView.setFocus(),this.FEmrView.focused&&(this.FEmrView.Style.UpdateInfoReCaret(!1),this.FEmrView.CheckUpdateInfo())}},{key:"ActiveTableAdjustWidth",value:function(){var t=this.FEmrView.GetTopLevelTable();null!==t&&t.AdjustWidth(!0)}},{key:"ActiveTableBorderVisibleSwitch",value:function(){var t=this.FEmrView.GetTopLevelTable();t.StyleNo===oo.Table&&(t.BorderVisible=!t.BorderVisible,this.FEmrView.UpdateView())}},{key:"ActiveTableDeleteSelectedRow",value:function(){var t=this.FEmrView.ActiveSection.ActiveData.GetActiveRectItem();t&&t.StyleNo===oo.Table&&t.SelectCellRang.EndRow>0?this.FEmrView.ActiveTableDeleteRowFrom(t.SelectCellRang.StartRow,t.SelectCellRang.EndRow):this.FEmrView.ActiveTableDeleteCurRow()}},{key:"TableMenuAutoPopup",value:function(t){if(this.captionBar.visible)if(t){var e=this.FContextMenu.subItemByText("表格");null!=e&&(this.FContextMenu.autoPopupMenuItem=e)}else this.FContextMenu.autoPopupMenuItem=null}},{key:"ShowActiveParagraphForm",value:function(){new df(this.hcl).SetView(this.FEmrView)}},{key:"ShowActiveTableBorderForm",value:function(){new Tf(this.hcl).SetView(this.FEmrView)}},{key:"ShowItemScriptForm",value:function(t){new sd(this.hcl).SetItem(this.FEmrView,t)}},{key:"ShowActiveDeItemForm",value:function(){new Af(this.hcl).SetView(this.FEmrView)}},{key:"ShowActiveItemScriptForm",value:function(){new nd(this.hcl).SetView(this.FEmrView)}},{key:"ShowActiveDeGroupPropertyForm",value:function(){new Ef(this.hcl).SetView(this.FEmrView)}},{key:"ShowActiveDataScriptForm",value:function(){new sd(this.hcl).SetData(this.FEmrView)}},{key:"ShowDeRadioGroupForm",value:function(t){new vf(this.hcl).SetView(this.FEmrView,t)}},{key:"ShowDeEditForm",value:function(t){new xf(this.hcl).SetView(this.FEmrView,t)}},{key:"ShowDeDateTimeForm",value:function(t){new Xf(this.hcl).SetView(this.FEmrView,t)}},{key:"ShowDeComboboxForm",value:function(t){new Yf(this.hcl).SetView(this.FEmrView,t)}},{key:"ShowDeCheckboxForm",value:function(t){new Uf(this.hcl).SetView(this.FEmrView,t)}},{key:"ShowDeImageForm",value:function(t){new Hf(this.hcl).SetView(this.FEmrView,t)}},{key:"ShowDeImagePainterForm",value:function(t){new ad(this.hcl).SetView(this.FEmrView,t)}},{key:"ShowDeFloatItemForm",value:function(t){(t.isClass(Ic)||t.isClass(gc))&&new hd(this.hcl).SetView(this.FEmrView,t)}},{key:"ShowActiveLineForm",value:function(){new Pf(this.hcl).SetView(this.FEmrView)}},{key:"ShowAnnotateForm",value:function(){var t=this,e=new Lf(this.hcl);e.SetAnnotate(null),e.showModal((function(){t.FEmrView.InsertAnnotate(e.edtTitle.text,e.edtText.text)}))}},{key:"ShowActiveAnnotateForm",value:function(){var t=this,e=this.FEmrView.GetActiveAnnotateItem();if(null!=e){if(null!==this.OnShowActiveAnnotateForm&&this.OnShowActiveAnnotateForm(e.OwnerData,e))return;var i=new Lf(this.hcl);i.SetAnnotate(e),i.showModal((function(){e.Content.Title=i.edtTitle.text,e.Content.Text=i.edtText.text,t.FEmrView.UpdateView()}))}}},{key:"ShowCommand",value:function(t){var e=this;if(null===this.pnlCmd){this.pnlCmd=new qi(this.hcl),this.pnlCmd.height=25,this.pnlCmd.borderVisible=!1,this.pnlCmd.align=qt;var i=new ji(this.hcl);i.width=20,i.image.src=this.hcl.theme.closeImage.src,i.align=Zt,i.onClick=function(){e.pnlCmd.visible=!1},this.pnlCmd.addControl(i),this.cbxCmd=new mn(this.hcl),this.cbxCmd.textPrompt="输入或选择命令后回车执行...",this.cbxCmd.align=$t,this.cbxCmd.autoDropDownWidth=!0,this.cbxCmd.popupAlign_=Zt,this.cbxCmd.addItem("let data = emrView.InnerView.ActiveSectionTopLevelData();"),this.cbxCmd.addItem("let activeItem = data.GetActiveItem();"),this.cbxCmd.addItem("console.log('');"),this.cbxCmd.addItem("window.debugView = emrView;"),this.cbxCmd.addItem("emrView.DesignMode = true;"),this.cbxCmd.onKeyDown=function(i){if(i.keyCode===Le){try{new Function("emrView",e.cbxCmd.text)(t)}catch(i){return void e.hcl.warnLog("HC执行命令错误:"+i.message,!1)}e.cbxCmd.itemIndexOf(e.cbxCmd.text.trim())<0&&e.cbxCmd.addItem(e.cbxCmd.text),e.cbxCmd.clear()}},this.pnlCmd.addControl(this.cbxCmd),this.addControl(this.pnlCmd)}this.pnlCmd.visible=!0,this.cbxCmd.setFocus()}},{key:"ActiveDeItemPopup",value:function(){var t=this.FEmrView.ActiveSectionTopLevelData();this.DoDeItemAutoComplate(t,t.GetActiveItemNo())}},{key:"ActiveDeGroupPopup",value:function(){var t=this.FEmrView.ActiveSectionTopLevelData(),e=t.ActiveDomain;this.DoDeGroupAutoComplate(t,e.BeginNo,e.EndNo)}},{key:"PageSetDialog",value:function(){new uf(this.hcl).SetView(this.FEmrView)}},{key:"InsertTableWithDialog",value:function(){var t=this,e=new Uh(this.hcl);e.showModal((function(){var i=t.FEmrView.ActiveSectionTopLevelData(),n=new uc(t.hcl,i,e.edtRowCount.number,e.edtColCount.number,i.Width);t.FEmrView.InsertItem(n)}))}},{key:"InsertImageWithDialog",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;kh.execute(this.hcl,L.stringFormat("{0}",_.IMAGE),(function(n){if(null===e||e(n))var o=t.hcl.waitMessage("正在插入图片，请稍候...",(function(){t.enabled=!1;var e=t.FEmrView.ActiveSectionTopLevelData(),s=new wc(t.hcl,e);s.LoadGraphicFile(n.firstFile,(function(n,r){n?(s.RestrainSize(e.Width,s.Height),t.FEmrView.InsertItem(s)):console.log("HCL错误：加载图片失败，请检查图片数据！"),t.enabled=!0,t.hcl.endWaitMessage(o),null!==i&&i(n,r)}))}))}))}},{key:"InsertFileWithDialog",value:function(){var t=this;kh.execute(this.hcl,L.stringFormat("{0}",".hcf"),(function(e){ht.loadFromFile(e.firstFile,(function(e){t.FEmrView.InsertStream(e)}))}))}},{key:"InsertBarCodeWidthDialog",value:function(){var t=this;Hh.Query(this.hcl,"条码值(不支持汉字)","",(function(e){var i=e.inputText();if(""!=i){var n=new Fc(t.hcl,t.FEmrView.ActiveSectionTopLevelData(),i);t.FEmrView.InsertItem(n)}else t.hcl.showMessage("请输入有效的条码值！")}))}},{key:"InsertQRCodeWidthDialog",value:function(){var t=this;Hh.Query(this.hcl,"二维码内容","",(function(e){var i=e.inputText();if(""!=i){var n=new vc(t.hcl,t.FEmrView.ActiveSectionTopLevelData(),i);t.FEmrView.InsertItem(n)}else t.hcl.showMessage("请输入有效的二维码内容！")}))}},{key:"InsertFloatBarCodeWidthDialog",value:function(){var t=this;Hh.Query(this.hcl,"条码值(不支持汉字)","",(function(e){var i=e.inputText();if(""!=i){var n=new Ic(t.hcl,t.FEmrView.ActiveSection.ActiveData,i);t.FEmrView.InsertFloatItem(n)}else t.hcl.showMessage("请输入有效的条码值！")}))}},{key:"InsertFloatQRCodeWidthDialog",value:function(){var t=this;Hh.Query(this.hcl,"二维码内容","",(function(e){var i=e.inputText();if(""!=i){var n=new gc(t.hcl,t.FEmrView.ActiveSection.ActiveData,i);t.FEmrView.InsertFloatItem(n)}else t.hcl.showMessage("请输入有效的二维码内容！")}))}},{key:"InsertFloatImageWidthDialog",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;kh.execute(this.hcl,L.stringFormat("{0}",_.IMAGE),(function(i){if(null===e||e(i))var n=t.hcl.waitMessage("正在插入图片，请稍候...",(function(){t.enabled=!1;var e=t.FEmrView.ActiveSectionTopLevelData(),o=new Cc(t.hcl,e);o.LoadGraphicFile(i.firstFile,(function(i){i&&(o.Image.RestrainSize(e.Width,o.Height),t.FEmrView.InsertFloatItem(o)),t.enabled=!0,t.hcl.endWaitMessage(n)}))}))}))}},{key:"PaintHightlightMenu",value:function(t,e,i,n){var o=t.font.color;t.font.styles.add(gt);try{t.font.color="#0000ff",t.textOut(e,i,n)}finally{t.font.color=o,t.font.styles.remove(gt)}}},{key:"GetHightlightMenuWidth",value:function(t,e){t.styles.add(gt);try{return this.hcl.textWidth(t,e.text)}finally{t.styles.remove(gt)}}},{key:"DoHideTraceTraverse",value:function(t,e,i){if(t.Items[e].isClass(rc)){var n=t.Items[e];n.TraceStyles.has(jh.Del)&&(n.Visible=i!==pd.HideTrace)}}},{key:"SetHideTrace",value:function(t){this.FEmrView.HideTrace!=t&&(this.FEmrView.HideTrace=t)}},{key:"DoCaretChange",value:function(){this.CurTextStyleChange(this.FEmrView.CurStyleNo),this.CurParaStyleChange(this.FEmrView.CurParaNo),this.OnCaretChange&&this.OnCaretChange()}},{key:"DoChangedSwitch",value:function(){this.captionBar.visible&&(this.btnSave.enabled=this.FEmrView.IsChanged,this.btnSave.enabled?this.btnSave.image.src=this.hcl.emrCommon.ResSave:this.btnSave.image.src=this.hcl.emrCommon.ResSavedis,null!=this.OnChangedSwitch&&this.OnChangedSwitch(this))}},{key:"DoCanNotEdit",value:function(){this.hcl.showMessage("当前位置只读、不可编辑！")}},{key:"DoReadOnlySwitch",value:function(t){null!=this.OnReadOnlySwitch&&this.OnReadOnlySwitch(t)}},{key:"DoVerScroll",value:function(){this.FEmrView.HintInfo.clear(),this.PopupFormClose()}},{key:"DoPaintPaperBefor",value:function(t,e,i,n,o){t.ReadOnly&&""!==this.ReadOnlyHint&&(n.font.size=24,n.font.color=Ft.Gray,n.font.name="隶书",n.textOut(i.left+10,i.top+10,this.ReadOnlyHint))}},{key:"SetDeItemText_",value:function(t,e,i,n,o){this.FEmrView.UndoGroupBegin();try{this.FEmrView.SetActiveItemText(o),t.UndoItemMirror(e,i),n.HasProp(Yh.CMVVCode)&&n.SetValue(Yh.CMVVCode,""),n.AllocValue=!0}finally{this.FEmrView.UndoGroupEnd()}}},{key:"DoInsertTextBefor",value:function(t,e,i,n){var o=t.Items[e];return!(o.isClass(rc)&&o.IsElement&&!o.AllocValue&&o.IsSelectComplate)||(this.SetDeItemText_(t,e,i,o,n),!1)}},{key:"DoSetActiveDeItemText",value:function(t,e,i){if(null!=this.OnSetDeItemText){var n=this.OnSetDeItemText(t,e,i);return n||this.FEmrView.SetActiveItemText(e),n}return this.FEmrView.SetActiveItemText(e),!1}},{key:"DoSetActiveDeItemExtra",value:function(t){this.FEmrView.SetActiveItemExtra(t)}},{key:"ActiveDeItemSync",value:function(t){var e=!1,i=this.FEmrView.FindSameDeItem(t);return null!=i&&(t.SetValue(Yh.CMVVCode,i.GetValue(Yh.CMVVCode)),this.FEmrView.SetActiveItemText(i.Text),e=!0),e}},{key:"RecordPop",value:function(){var t=this;return null==this.frmRecordPop&&(this.frmRecordPop=new kc(this.hcl),this.frmRecordPop.OnSetPopupItemText=function(e,i,n){return e.StyleNo<oo.Null?(t.FEmrView.InsertText(i),!1):t.DoSetActiveDeItemText(e,i,n)},this.frmRecordPop.OnSetActiveItemExtra=function(e,i){t.DoSetActiveDeItemExtra(i)},this.addControl(this.frmRecordPop)),this.frmRecordPop}},{key:"DoDeComboboxPopupItem",value:function(t){if(null!=this.OnDeComboboxPopup)return this.OnDeComboboxPopup(t)}},{key:"DoTableCellPopup",value:function(t,e,i,n,o,s,r){return null!=this.OnTableCellPopup?this.OnTableCellPopup(t,e,i,n,o,s,r):null}},{key:"SetDefaultTextSize",value:function(t){if(this.FEmrView.Style.DefaultTextStyle.Size=Nt.fontSizeToPt(t),this.captionBar.visible){var e=this.cbbFontSize.itemIndexOf(t);e>=0&&(this.cbbFontSize.itemIndex=e)}}},{key:"SetDefaultFontFamily",value:function(t){if(this.FEmrView.Style.DefaultTextStyle.Family=t,this.captionBar.visible){var e=this.cbbFont.itemIndexOf(t);e>=0&&(this.cbbFont.itemIndex=e)}}},{key:"CurTextStyleChange",value:function(t){if(this.captionBar.visible)if(t>=0){var e=this.FEmrView.Style.TextStyles[t];this.cbbFont.itemIndex=this.cbbFont.items.indexOf(e.Family),this.cbbFont.itemIndex<0?(this.cbbFont.text=e.Family,this.cbbFont.font.color=this.hcl.theme.textDisableColor,this.cbbFont.font.styles.value=At):(this.cbbFont.font.color=this.hcl.defaultFont.color,this.cbbFont.font.styles.value=It),this.cbbFontSize.itemIndex=this.cbbFontSize.items.indexOf(Nt.fontPtToSize(e.Size)),this.cbbFontColor.color=e.Color,this.btnBold.checked=e.FontStyles.has(Wn.Bold),this.btnItalic.checked=e.FontStyles.has(Wn.Italic),this.btnUnderline.checked=e.FontStyles.has(Wn.Underline),this.btnStrikeOut.checked=e.FontStyles.has(Wn.Strikeout),this.btnSuperscript.checked=e.FontStyles.has(Wn.Superscript),this.btnSubscript.checked=e.FontStyles.has(Wn.Subscript)}else this.btnBold.checked=!1,this.btnItalic.checked=!1,this.btnUnderline.checked=!1,this.btnStrikeOut.checked=!1,this.btnSuperscript.checked=!1,this.btnSubscript.checked=!1}},{key:"CurParaStyleChange",value:function(t){if(this.captionBar.visible&&t>=0){var e=this.FEmrView.Style.ParaStyles[t].AlignHorz;switch(this.btnAlignLeft.checked=e==Ln.Left,this.btnAlignRight.checked=e==Ln.Right,this.btnAlignCenter.checked=e==Ln.Center,this.btnAlignJustify.checked=e==Ln.Justify,this.btnAlignScatter.checked=e==Ln.Scatter,this.FEmrView.Style.ParaStyles[t].LineSpaceMode){case Hn.PLS100:this.menuSpace100.checked=!0;break;case Hn.PLS115:this.menuSpace115.checked=!0;break;case Hn.PLS150:this.menuSpace150.checked=!0;break;case Hn.PLS200:this.menuSpace200.checked=!0;break;default:this.menuSpace100.checked=!1,this.menuSpace115.checked=!1,this.menuSpace150.checked=!1,this.menuSpace200.checked=!1}}}},{key:"DoTablePropertyClick",value:function(){new Jf(this.hcl).SetView(this.FEmrView)}},{key:"ReturnFocusToEmrView",value:function(){this.FEmrView.setFocus(),this.FEmrView.Style.UpdateInfoReCaret(),this.FEmrView.Style.UpdateInfoRePaint(),this.FEmrView.MapChange()}},{key:"PopupFormClose",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null!==this.frmRecordPop&&this.frmRecordPop.visible?(this.frmRecordPop.visible=!1,t&&this.ReturnFocusToEmrView()):null!=this.OnPopupFormClose&&this.OnPopupFormClose()&&this.ReturnFocusToEmrView()}},{key:"DoDeItemPopup",value:function(t){return null==this.OnDeItemPopup||this.OnDeItemPopup(t)}},{key:"DoSectionDrawItemMouseMove",value:function(t,e,i,n){if(this.FMouseInElementFire=!1,!(t.Items[e].StyleNo<oo.Null)){var o=t.Items[e];o.EditProtect||(o.HasFrmtp?o.IsElement&&(t.MouseMoveRestrain||(this.FEmrView.Style.Cursor=pe,this.FMouseInElementFire=!0)):this.FMouseInElementFire=!0)}}},{key:"DoEmrViewZoomChanged",value:function(t){this.OnEmrViewZoomChanged&&this.OnEmrViewZoomChanged(t)}},{key:"DoEmrViewMouseDown",value:function(){this.PopupFormClose()}},{key:"DoEmrViewMouseUp",value:function(t){if(this.FLastAutoComplateItem=null,t.button!==le){var e=this.FEmrView.ActiveSectionTopLevelData(),i=e.GetActiveItem();if(null!==i){if(this.OnMouseUpLib&&e.SelectInfo.EndItemNo<0){var n={data:e,itemNo:e.SelectInfo.StartItemNo,restrain:e.SelectInfo.StartRestrain,offset:e.SelectInfo.StartItemOffset};n.restrain?this.OnMouseUpLib(t,null,n):this.OnMouseUpLib(t,i,n)}if(!i.EditProtect)if(i.StyleNo>oo.Null){if(i.TraceStyles.has(jh.Del));else if(i.Active&&""!=i.Index&&!i.IsSelectComplate&&!i.IsSelectPart&&this.FMouseInElementFire){if(this.hcl.keyDownStates[He]&&this.ActiveDeItemSync(i))return;var o=this.FEmrView.GetTopLevelDrawItemViewCoord(),s=this.FEmrView.GetTopLevelDrawItem(),r=nt.CreateByBounds(o.x,o.y,this.FEmrView.ZoomIn(s.rect.width),this.FEmrView.ZoomIn(s.rect.height));if(e.CanEdit()&&r.pointInAt(t.x,t.y)&&this.DoDeItemPopup(i)){if(o.x+=this.FEmrView.left,o.y=o.y+this.FEmrView.top+this.FEmrView.ZoomIn(s.height),null!=this.OnExternalDeItemPopupLib&&this.OnExternalDeItemPopupLib(i,o.x,o.y+(this.captionBar.visible?this.captionBar.height:0),e.SelectInfo.StartItemOffset))return;if(!this.RecordPop().PopupDeItem(i,o,this.FEmrView.ZoomIn(s.height),e.SelectInfo.StartItemOffset,e)){if(e.SelectExists())return;i.AllocValue||(e.SelectItem(e.SelectInfo.StartItemNo,!1),this.FEmrView.Style.UpdateInfoRePaint(),this.FEmrView.Style.UpdateInfoReCaret(),this.FEmrView.CheckUpdateInfo())}}}}else if(i.StyleNo===oo.Image&&i.Active&&""!=i.Index&&""!=i.GetValue(Yh.Frmtp)&&!i.IsSelectComplate&&!i.IsSelectPart){var a=this.FEmrView.GetTopLevelDrawItemViewCoord(),l=this.FEmrView.GetTopLevelDrawItem(),h=nt.CreateByBounds(a.x,a.y,this.FEmrView.ZoomIn(l.rect.width),this.FEmrView.ZoomIn(l.rect.height));if(e.CanEdit()&&h.pointInAt(t.x,t.y)&&this.DoDeItemPopup(i)&&(a.x+=this.FEmrView.left,a.y=a.y+this.FEmrView.top+this.FEmrView.ZoomIn(l.height),null!=this.OnExternalDeItemPopupLib&&this.OnExternalDeItemPopupLib(i,a.x,a.y+(this.captionBar.visible?this.captionBar.height:0),e.SelectInfo.StartItemOffset)))return}}}}},{key:"DoEmrViewKeyDown",value:function(t){this.OnEmrViewKeyDown&&this.OnEmrViewKeyDown(t)}},{key:"DoDataItemAutoComplate",value:function(t,e,i){return null===this.OnDataItemAutoComplate||this.OnDataItemAutoComplate(t,e,i)}},{key:"DoDeGroupAutoComplate",value:function(t,e,i){var n=t.Items[e];if(t.CanEditItem(t,n))if(this.DoDeItemPopup(n)){this.FEmrView.focused||this.FEmrView.setFocus(),this.FEmrView.Style.UpdateInfoReCaret(!1),this.FEmrView.Style.UpdateInfoReScroll(),this.FEmrView.CheckUpdateInfo(),t.SetSelectBound(e,Yl.OffsetAfter,i,Yl.OffsetBefor,!1),this.FEmrView.UpdateView();var o=this.FEmrView.GetTopLevelDrawItem(),s=this.FEmrView.GetTopLevelDrawItemViewCoord();if(s.x+=this.FEmrView.left,s.y+=this.FEmrView.top+this.FEmrView.ZoomIn(o.height),null!==this.OnExternalDeItemPopupLib&&this.OnExternalDeItemPopupLib(n,s.x,s.y+(this.captionBar.visible?this.captionBar.height:0)))return!0;this.RecordPop().PopupDeItem(n,s,this.FEmrView.ZoomIn(o.height),t.SelectInfo.StartItemOffset,t)||this.PopupFormClose()}else this.PopupFormClose()}},{key:"DoDeItemAutoComplate",value:function(t,e){this.PopupFormClose(!0);var i=t.Items[e];if(!t.CanEditItem(t,i))return!1;if(i===this.FLastAutoComplateItem)return!1;if(this.FLastAutoComplateItem=i,!i.IsElement)return!1;if(i.EditProtect)return this.FEmrView.Style.UpdateInfoReScroll(),t.ItemSetCaretRequest(e,0),this.FEmrView.Style.UpdateInfoRePaint(),this.FEmrView.CheckUpdateInfo(),!1;if(this.DoDeItemPopup(i)){this.FEmrView.focused||this.FEmrView.setFocus(),this.FEmrView.Style.UpdateInfoReScroll(),t.ItemSetCaretRequest(e,0),this.FEmrView.Style.UpdateInfoRePaint(),this.FEmrView.CheckUpdateInfo();var n=this.FEmrView.GetTopLevelDrawItem(),o=this.FEmrView.GetTopLevelDrawItemViewCoord();if(o.x+=this.FEmrView.left,o.y=o.y+this.FEmrView.top+this.FEmrView.ZoomIn(n.height),null!==this.OnExternalDeItemPopupLib&&this.OnExternalDeItemPopupLib(i,o.x,o.y+(this.captionBar.visible?this.captionBar.height:0)))return!0;if(this.RecordPop().PopupDeItem(i,o,this.FEmrView.ZoomIn(n.height),t.SelectInfo.StartItemOffset,t))return!0;if(this.PopupFormClose(),!i.AllocValue)return t.SelectItem(e),this.ReturnFocusToEmrView(),!0}else this.PopupFormClose();return!1}},{key:"ActiveDeItemAutoComplate",value:function(){var t=this.FEmrView.ActiveSectionTopLevelData(),e=t.GetActiveItemNo();return!!(t.Items[e].StyleNo>oo.Null&&t.Items[e].IsElement&&this.DoDataItemAutoComplate(t,e,t.Items[e]))&&(this.FLastAutoComplateItem=null,this.DoDeItemAutoComplate(t,e))}},{key:"_FindDataAutoComplateNext",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=e;o<t.Items.count;o++)if(t.Items[o].Visible)if(t.Items[o].StyleNo>oo.Null&&t.Items[o].IsElement){if(this.DoDataItemAutoComplate(t,o,t.Items[o]))if(t.Items[o].EditProtect&&n);else if(this.DoDeItemAutoComplate(t,o)){var s=t.ActiveDomain;return this.FOldTopData===t&&this.FOldDomainNo===s.BeginNo||(null!==this.FOldTopData&&this.FOldDomainNo>=0&&null!==this.FOldTopData.OnDomainSwitch&&this.FOldTopData.OnDomainSwitch(this.FOldTopData,this.FOldDomainNo,!1),s.BeginNo>=0&&null!==t.OnDomainSwitch&&t.OnDomainSwitch(t,s.BeginNo,!0)),!0}}else if(i&&t.Items[o].StyleNo===oo.Domain&&t.Items[o].MarkType===ch.Beg){if(this.DoDataItemAutoComplate(t,o,t.Items[o])){this.FEmrView.Style.UpdateInfoReScroll(),t.ItemSetCaretRequest(o,Yl.OffsetAfter);var r=t.ActiveDomain;return this.FOldTopData===t&&this.FOldDomainNo===r.BeginNo||(null!==this.FOldTopData&&this.FOldDomainNo>=0&&null!==this.FOldTopData.OnDomainSwitch&&this.FOldTopData.OnDomainSwitch(this.FOldTopData,this.FOldDomainNo,!1),r.BeginNo>=0&&null!==t.OnDomainSwitch&&t.OnDomainSwitch(t,r.BeginNo,!0)),this.DoDeGroupAutoComplate(t,r.BeginNo,r.EndNo),!0}}else if(t.Items[o].StyleNo===oo.Table&&this._FindTableAutoComplateNext(t.Items[o],0,0,i,n))return!0;return!1}},{key:"_FindTableAutoComplateNext",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null!==t.Rows[e][i].CellData){var s=t.Rows[e][i].CellData;if(this._FindAutoComplateNext(s,s.SelectInfo.StartItemNo,s.SelectInfo.StartItemOffset,n,o))return!0}for(var r=i+1;r<t.ColCount;r++)if(null!==t.Rows[e][r].CellData&&this._FindDataAutoComplateNext(t.Rows[e][r].CellData,0,n,o))return!0;for(var a=e+1;a<t.RowCount;a++)for(var l=0;l<t.ColCount;l++)if(null!==t.Rows[a][l].CellData&&this._FindDataAutoComplateNext(t.Rows[a][l].CellData,0,n,o))return!0;return!1}},{key:"_FindAutoComplateNext",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e<0&&(e=0),i<0&&(i=0);var s=t.Items[e];return!(s.StyleNo!==oo.Table||i!==Yl.OffsetInner||!this._FindTableAutoComplateNext(s,s.SelectCellRang.StartRow,s.SelectCellRang.StartCol,n,o))||(i>0&&e++,!!this._FindDataAutoComplateNext(t,e,n,o)||void 0)}},{key:"NextDeItemAutoComplate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.FOldTopData=this.FEmrView.ActiveSectionTopLevelData(),this.FOldDomainNo=this.FOldTopData.ActiveDomain.BeginNo;var i=this.FEmrView.ActiveSection.ActiveData;return!!this._FindAutoComplateNext(i,i.SelectInfo.StartItemNo,i.SelectInfo.StartItemOffset,t,e)||(this.PopupFormClose(),!1)}},{key:"_FindDataAutoComplatePrev",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=e;o>=0;o--)if(t.Items[o].Visible)if(t.Items[o].StyleNo>oo.Null&&t.Items[o].IsElement){if(this.DoDataItemAutoComplate(t,o,t.Items[o]))if(t.Items[o].EditProtect&&n);else if(this.DoDeItemAutoComplate(t,o)){var s=t.ActiveDomain;return this.FOldTopData===t&&this.FOldDomainNo===s.BeginNo||(null!==this.FOldTopData&&this.FOldDomainNo>=0&&null!==this.FOldTopData.OnDomainSwitch&&this.FOldTopData.OnDomainSwitch(this.FOldTopData,this.FOldDomainNo,!1),s.BeginNo>=0&&null!==t.OnDomainSwitch&&t.OnDomainSwitch(t,s.BeginNo,!0)),!0}}else if(i&&t.Items[o].StyleNo===oo.Domain&&t.Items[o].MarkType===ch.End){if(this.DoDataItemAutoComplate(t,o,t.Items[o])){this.FEmrView.Style.UpdateInfoReScroll(),t.ItemSetCaretRequest(o,Yl.OffsetBefor);var r=t.ActiveDomain;return this.FOldTopData===t&&this.FOldDomainNo===r.BeginNo||(null!==this.FOldTopData&&this.FOldDomainNo>=0&&null!==this.FOldTopData.OnDomainSwitch&&this.FOldTopData.OnDomainSwitch(this.FOldTopData,this.FOldDomainNo,!1),r.BeginNo>=0&&null!==t.OnDomainSwitch&&t.OnDomainSwitch(t,r.BeginNo,!0)),this.DoDeGroupAutoComplate(t,r.BeginNo,r.EndNo),!0}}else if(t.Items[o].StyleNo===oo.Table&&this._FindTableAutoComplatePrev(t.Items[o],t.Items[o].RowCount-1,t.Items[o].ColCount-1,i,n))return!0;return!1}},{key:"_FindTableAutoComplatePrev",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null!==t.Rows[e][i].CellData){var s=t.Rows[e][i].CellData;if(this._FindAutoComplatePrev(s,s.SelectInfo.StartItemNo,s.SelectInfo.StartItemOffset,n,o))return!0}for(var r=i-1;r>=0;r--)if(null!==t.Rows[e][r].CellData&&this._FindDataAutoComplatePrev(t.Rows[e][r].CellData,t.Rows[e][r].CellData.Items.count-1,n,o))return!0;for(var a=e-1;a>=0;a--)for(var l=t.ColCount-1;l>=0;l--)if(null!==t.Rows[a][l].CellData&&this._FindDataAutoComplatePrev(t.Rows[a][l].CellData,t.Rows[a][l].CellData.Items.count-1,n,o))return!0;return!1}},{key:"_FindAutoComplatePrev",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e<0&&(e=t.Items.count),i<0&&(i=t.GetItemOffsetAfter(e));var s=t.Items[e];return!(s.StyleNo!==oo.Table||i!==Yl.OffsetInner||!this._FindTableAutoComplatePrev(s,s.SelectCellRang.StartRow,s.SelectCellRang.StartCol,n,o))||(i<t.GetItemOffsetAfter(e)&&e--,!!this._FindDataAutoComplatePrev(t,e,n,o)||void 0)}},{key:"PrevDeItemAutoComplate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.FOldTopData=this.FEmrView.ActiveSectionTopLevelData(),this.FOldDomainNo=this.FOldTopData.ActiveDomain.BeginNo;var i=this.FEmrView.ActiveSection.ActiveData;return!!this._FindAutoComplatePrev(i,i.SelectInfo.StartItemNo,i.SelectInfo.StartItemOffset,t,e)||(this.PopupFormClose(),!1)}},{key:"SaveAs",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=new ht;this.FEmrView.SaveToStream(e,!1);var i=new Uint8Array(e.buffer),n=new Blob([i],{type:"application/octet-stream"}),o=window.URL.createObjectURL(n),s=document.createElement("a");document.body.appendChild(s),s.href=o,s.download=""!==t?t:"HCView H5.hcf",s.click(),window.URL.revokeObjectURL(n),document.body.removeChild(s),e=null}},{key:"DoInsertItem",value:function(t,e,i){var n=this;i.StyleNo===oo.Combobox&&(i.OnPopupItem=function(t){return n.DoDeComboboxPopupItem(t)}),i.StyleNo===oo.Table&&(i.OnCellPopup=function(t,e,i,o,s,r,a){return n.DoTableCellPopup(t,e,i,o,s,r,a)}),null!=this.OnInsertDeItem&&this.OnInsertDeItem(t,e,i)}},{key:"DoSave",value:function(){null!==this.OnSave&&this.OnSave(this)}},{key:"DoImportXML",value:function(){null!=this.OnImportXML&&this.OnImportXML(this.FEmrView)}},{key:"DoImportTXT",value:function(){null!=this.OnImportTXT&&this.OnImportTXT(this.FEmrView)}},{key:"DoExportXML",value:function(){null!=this.OnExportXML&&this.OnExportXML(this.FEmrView)}},{key:"DoExportTXT",value:function(){null!=this.OnExportTXT&&this.OnExportTXT(this.FEmrView)}},{key:"DoExportHTML",value:function(){null!=this.OnExportHTML&&this.OnExportHTML(this.FEmrView)}},{key:"DoExportPDF",value:function(){null!=this.OnExportPDF&&this.OnExportPDF(this.FEmrView)}},{key:"ContinuePrintGaps",value:function(){for(var t=null,e=this.FEmrView.ActiveSection.Page,i=e.GetActiveItemNo(),n=0;n<=i;n++)if((t=e.Items[n]).StyleNo>oo.Null&&t.Visible){if(this.FEmrView.PrintHideUnAllocValue&&t.IsElement&&!t.AllocValue)return!0;if(t.TraceStyles.has(jh.Del))return!0}else{if(t.StyleNo===oo.Domain&&t.Empty&&this.FEmrView.PrintHideUnAllocValue)return!0;if(t.StyleNo===oo.Table&&"1"===t.GetValue(Yh.UnPrintEmptyRow)){var o=t.RowCount;if(n===i){var s=t.GetEditCellWith();s.result&&(o=s.row+1)}for(var r=0;r<o;r++)if(t.EmptyContentRow(r,!0))return!0}}return!1}},{key:"DoPrint",value:function(t){null!=this.OnPrint&&this.OnPrint(t)}},{key:"DoPrintCurPage",value:function(t){null!=this.OnPrintCurPage&&this.OnPrintCurPage(t)}},{key:"DoPrintPageRange",value:function(t){null!=this.OnPrintPageRange&&this.OnPrintPageRange(t)}},{key:"DoPrintOdd",value:function(t,e){null!=this.OnPrintOdd&&this.OnPrintOdd(t,e)}},{key:"DoPrintEven",value:function(t,e){null!=this.OnPrintEven&&this.OnPrintEven(t,e)}},{key:"DoPrintCurLine",value:function(t,e){null!=this.OnPrintCurLine&&this.OnPrintCurLine(t,e)}},{key:"DoPrintSelect",value:function(t){null!=this.OnPrintSelect&&this.OnPrintSelect(t)}},{key:"DoSaveStructure",value:function(){null!=this.OnSaveStructure&&this.OnSaveStructure(this)}},{key:"PrintView",value:function(t){var e=this;null===this.frmPrintView&&(this.frmPrintView=new Cf(this.hcl),this.frmPrintView.align=$t,this.frmPrintView.closeFree=!1,this.frmPrintView.OnPrint=function(t){e.DoPrint(t)},this.frmPrintView.OnPrintCurPage=function(t){e.DoPrintCurPage(t)},this.frmPrintView.OnPrintOdd=function(t){e.DoPrintOdd(t,!1)},this.frmPrintView.OnPrintEven=function(t){e.DoPrintEven(t,!1)},this.frmPrintView.OnPrintCurLine=function(t,i){e.DoPrintCurLine(t,i)},this.frmPrintView.OnPrintSelect=function(t){e.DoPrintSelect(t)},this.frmPrintView.onClose=function(){e.update()});var i=function(){e.frmPrintView.SetView(e.FEmrView,e.PrintParam,t),null!==n&&e.hcl.endWaitMessage(n)},n=null;return null!=t&&t.NoWaitInfo?i():n=this.hcl.waitMessage("正在生成预览，请稍候...",i),this.frmPrintView}},{key:"ClosePrintView",value:function(){null!==this.frmPrintView&&this.frmPrintView.close()}},{key:"DoLoadDocxFile",value:function(t){null!==this.OnLoadDocxFile&&this.OnLoadDocxFile(t)}},{key:"InsertDeItem",value:function(t,e,i){if(null==t||""==t||null==e||""==e)return this.hcl.showMessage("要插入的数据元索引和名称不能为空！"),null;var n="";i.Prompt&&(n=i.Prompt),""==n&&(n=e);var o=this.FEmrView.NewDeItem(n);return o.ParseJSONObject(i),this.FEmrView.InsertDeItem(o),o}},{key:"InsertHyperLink",value:function(t){if(!t.Text||""==t.Text)return null;if(!t.HyperLink||""==t.HyperLink)return null;var e=this.FEmrView.ActiveSectionTopLevelData().CreateDefaultTextItem();return e.Text=t.Text,e.HyperLink=t.HyperLink,this.FEmrView.InsertItem(e),e}},{key:"InsertDeGroup",value:function(t,e,i){if(""!=t&&""!=e){var n=new Nc(this.hcl,this.FEmrView.ActiveSectionTopLevelData());n.ParseJSONObject(i),i&&i.InnerText&&""!=i.InnerText&&(n.InnerTextTmp=i.InnerText),this.FEmrView.InsertDeGroup(n),n=null}else this.hcl.showMessage("要插入的数据组索引和名称不能为空！")}},{key:"InsertDeEdit",value:function(t,e,i){if(""==t)return this.hcl.showMessage("要插入的Edit索引不能为空！"),null;var n="";i.Text?n=i.Text:e&&(n=e);var o=new mc(this.hcl,this.FEmrView.ActiveSectionTopLevelData(),n);return o.ParseJSONObject(i),this.FEmrView.InsertItem(o),o}},{key:"InsertDeCombobox",value:function(t,e,i){var n=e;if(i.Text&&(n=i.Text),""==t)return this.hcl.showMessage("要插入的Combobox索引和名称不能为空！"),null;var o=new Sc(this.hcl,this.FEmrView.ActiveSectionTopLevelData(),n);return o.ParseJSONObject(i),this.FEmrView.InsertItem(o),o}},{key:"InsertDeDateTime",value:function(t,e,i){if(""==t)return this.hcl.showMessage("要插入的DateTiem索引和名称不能为空！"),null;var n=new pc(this.hcl,this.FEmrView.ActiveSectionTopLevelData(),lt.Now());return n.ParseJSONObject(i),this.FEmrView.InsertItem(n),n}},{key:"InsertDeRadioGroup",value:function(t,e,i){if(""==t)return this.hcl.showMessage("要插入的RadioGroup索引不能为空！"),null;var n=new yc(this.hcl,this.FEmrView.ActiveSectionTopLevelData());return n.ParseJSONObject(i),this.FEmrView.InsertItem(n),n}},{key:"InsertDeBarCode",value:function(t,e,i){if(""==t)return this.hcl.showMessage("要插入的DeBarCode索引不能为空！！"),null;var n=new Fc(this.hcl,this.FEmrView.ActiveSection.ActiveData,"HCView");return n.ParseJSONObject(i),this.FEmrView.InsertItem(n),n}},{key:"InsertDeQRCode",value:function(t,e,i){if(""==t)return this.hcl.showMessage("要插入的DeQRCode索引不能为空！！"),null;var n=new vc(this.hcl,this.FEmrView.ActiveSection.ActiveData,"HCView");return n.ParseJSONObject(i),this.FEmrView.InsertItem(n),n}},{key:"InsertFloatLine",value:function(t){var e=new kl(this.hcl,this.FEmrView.ActiveSection.ActiveData);return e.ParseJSONObject(t),this.FEmrView.InsertFloatItem(e),e}},{key:"InsertDeFloatBarCode",value:function(t,e,i){if(""==t)return this.hcl.showMessage("要插入的FloatBarCode索引不能为空！！"),null;var n=new Ic(this.hcl,this.FEmrView.ActiveSection.ActiveData);return n.ParseJSONObject(i),this.FEmrView.InsertFloatItem(n),n}},{key:"InsertDeFloatQRCode",value:function(t,e,i){if(""==t)return this.hcl.showMessage("要插入的FloatBarCode索引不能为空！！"),null;var n=new gc(this.hcl,this.FEmrView.ActiveSection.ActiveData);return n.ParseJSONObject(i),this.FEmrView.InsertFloatItem(n),n}},{key:"InsertDeImage",value:function(t,e,i){if(""==t)return this.hcl.showMessage("要插入的DeImage索引不能为空！！"),null;var n=new wc(this.hcl,this.FEmrView.ActiveSectionTopLevelData());return n.ParseJSONObject(i),this.FEmrView.InsertItem(n),n}},{key:"InsertDeCheckBox",value:function(t,e,i){var n=e;if(i.Text&&(n=i.Text),""==t)return this.hcl.showMessage("要插入的CheckBox索引不能为空！"),null;var o=new fc(this.hcl,this.FEmrView.ActiveSectionTopLevelData(),n,!1);return o.ParseJSONObject(i),this.FEmrView.InsertItem(o),o}},{key:"InsertDeTable",value:function(t,e){if(!e.RowCount||e.RowCount<1)return this.hcl.showMessage("插入表格时行数(RowCount)需要大于0！"),null;if(!e.ColCount||e.ColCount<1)return this.hcl.showMessage("插入表格时列数(ColCount)需要大于0！"),null;var i=this.FEmrView.ActiveSectionTopLevelData(),n=new uc(this.hcl,i,e.RowCount,e.ColCount,i.Width);return n.ParseJSONObject(e),this.FEmrView.InsertItem(n),n}},{key:"InsertDeYueJingItem",value:function(t,e,i,n){var o=new gu(this.hcl,this.FEmrView.ActiveSectionTopLevelData(),t,e,i,n);return this.FEmrView.InsertItem(o),o}},{key:"InsertDeToothItem",value:function(t,e,i,n){var o=new Vc(this.hcl,this.FEmrView.ActiveSectionTopLevelData(),t,e,i,n);return this.FEmrView.InsertItem(o),o}},{key:"InsertDeFangJiaoItem",value:function(t,e,i,n){var o=new Rc(this.hcl,this.FEmrView.ActiveSectionTopLevelData(),t,e,i,n);return this.FEmrView.InsertItem(o),o}},{key:"InsertChineseMedicineItem",value:function(t,e,i){var n=new wu(this.hcl,this.FEmrView.ActiveSectionTopLevelData(),t,e,i);return this.FEmrView.InsertItem(n),n}},{key:"InsertGestationalWeekItem",value:function(t,e){var i=new Du(this.hcl,this.FEmrView.ActiveSectionTopLevelData(),t,e);return this.FEmrView.InsertItem(i),i}},{key:"InsertPupilItem",value:function(t,e,i,n,o,s,r){var a=new ku(this.hcl,this.FEmrView.ActiveSectionTopLevelData(),t,e,i,n,o,s,r);return this.FEmrView.InsertItem(a),a}},{key:"InsertLightPerceptionItem",value:function(t,e,i,n,o,s,r,a,l){var h=new Ru(this.hcl,this.FEmrView.ActiveSectionTopLevelData(),t,e,i,n,o,s,r,a,l);return this.FEmrView.InsertItem(h),h}},{key:"InsertFetalHeartItem",value:function(t,e,i,n,o,s){var r=new bu(this.hcl,this.FEmrView.ActiveSectionTopLevelData(),t,e,i,n,o,s);return this.FEmrView.InsertItem(r),r}},{key:"InsertPamerToothItem",value:function(t,e,i,n){var o=new Ou(this.hcl,this.FEmrView.ActiveSectionTopLevelData(),t,e,i,n);return this.FEmrView.InsertItem(o),o}},{key:"InsertFraction1Item",value:function(t,e){var i=new Ac(this.hcl,this.FEmrView.ActiveSectionTopLevelData(),t,e);return this.FEmrView.InsertItem(i),i}},{key:"InsertFraction2Item",value:function(t,e){var i=new Dc(this.hcl,this.FEmrView.ActiveSectionTopLevelData(),t,e);return this.FEmrView.InsertItem(i),i}},{key:"SetActiveDeItemDomain",value:function(t){this.RecordPop().IniDomainUIByJSON(t)}},{key:"SetDeItemDomainAsync",value:function(t,e,i){this.RecordPop().PopupSetDeItemDomain(t,e,i)}},{key:"TraverseElement",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(null!=t){var s=e;if(null===s)(s=new Set([])).add(ql.Header),s.add(ql.Footer),s.add(ql.Page);else if(0==s.size)return;var r=new Ks;r.Tag=i,r.Areas=s,r.Process=t,r.ReverseOrder=n,r.Invisible=o,this.FEmrView.TraverseItem(r)}}},{key:"TraverseProcElement",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(null!=t){var o=new Set([]);o.add(ql.Page);var s=new Ks;s.Tag=i,s.Areas=o,s.Process=t,s.ReverseOrder=n,this.FEmrView.TraverseProcItem(e,s)}}},{key:"TraverseDeGroup",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null!=e){var n=null;if(i&&i.areas&&(n=i.areas),null==n)(n=new Set([])).add(ql.Page);else if(0==n.size)return;var o=new Ks;i&&null!=i.tag&&(o.Tag=i.tag),i&&null!=i.reverse&&(o.ReverseOrder=i.reverse),i&&null!=i.invisible&&(o.Invisible=i.invisible),o.Areas=n,o.Process=e,this.FEmrView.TraverseDeGroup(t,o,i)}}},{key:"TraverseProcDeGroup",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(null!=i){var o=new Set([]);o.add(ql.Page);var s=new Ks;n&&null!=n.tag&&(s.Tag=n.tag),n&&null!=n.reverse&&(s.ReverseOrder=n.reverse),n&&null!=n.invisible&&(s.Invisible=n.invisible),s.Areas=o,s.Process=i,this.FEmrView.TraverseProcDeGroup(t,e,s,n)}}},{key:"SaveToImage",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PNG";this.FEmrView.SaveToImage(t,e,i)}},{key:"ShowDocTree",value:function(){new qf(this.hcl).SetView(this.FEmrView)}},{key:"PrintAll",value:function(){this.DoPrint(this.FEmrView)}},{key:"PrintCurPage",value:function(){this.DoPrintCurPage(this.FEmrView)}},{key:"PrintPageRange",value:function(){this.DoPrintPageRange(this.FEmrView)}},{key:"PrintOdd",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.DoPrintOdd(this.FEmrView,t)}},{key:"PrintEven",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.DoPrintEven(this.FEmrView,t)}},{key:"PrintCurLine",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.DoPrintCurLine(this.FEmrView,t)}},{key:"PrintSelect",value:function(){this.DoPrintSelect(this.FEmrView)}},{key:"GetSelectCoord",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.FEmrView.GetSelectCoord(t);return this.captionBar.visible&&(e.y+=this.captionBar.height),e}},{key:"RecordPopupVisible",get:function(){return!(null===this.frmRecordPop||!this.frmRecordPop.visible)}},{key:"EmrView",get:function(){return this.FEmrView}},{key:"OnCopyRequest",get:function(){return this.FEmrView.OnCopyRequest},set:function(t){this.FEmrView.OnCopyRequest=t}},{key:"OnPasteRequest",get:function(){return this.FEmrView.OnPasteRequest},set:function(t){this.FEmrView.OnPasteRequest=t}},{key:"OnCopyAsStream",get:function(){return this.FEmrView.OnCopyAsStream},set:function(t){this.FEmrView.OnCopyAsStream=t}},{key:"OnPasteFromStream",get:function(){return this.FEmrView.OnPasteFromStream},set:function(t){this.FEmrView.OnPasteFromStream=t}},{key:"OnSyntaxCheck",get:function(){return this.FEmrView.OnSyntaxCheck},set:function(t){this.FEmrView.OnSyntaxCheck=t}},{key:"OnSyntaxPaint",get:function(){return this.FEmrView.OnSyntaxPaint},set:function(t){this.FEmrView.OnSyntaxPaint=t}},{key:"ToolbarVisible",get:function(){return this.captionBar.visible},set:function(t){this.captionBar.visible=t,t&&this._initToolBar()}},{key:"HideTrace",get:function(){return this.FEmrView.HideTrace},set:function(t){this.SetHideTrace(t)}},{key:"ShowExportMenu",get:function(){return!!this.captionBar.visible&&this.menuExportFile.visible},set:function(t){this.captionBar.visible&&(this.menuExportFile.visible=t)}},{key:"ShowImportMenu",get:function(){return!!this.captionBar.visible&&this.menuImplortFile.visible},set:function(t){this.captionBar.visible&&(this.menuImplortFile.visible=t)}},{key:"DeMutexCheckState",get:function(){return this.RecordPop().chkItemMutex.useCheckState},set:function(t){this.RecordPop().chkItemMutex.useCheckState=t}},{key:"OnPopupGetDeItemInfoLib",get:function(){return this.RecordPop().OnPopupGetDeItemInfoLib},set:function(t){this.RecordPop().OnPopupGetDeItemInfoLib=t}},{key:"OnPopupGetDeItemDomainLib",get:function(){return this.RecordPop().OnPopupGetDeItemDomainLib},set:function(t){this.RecordPop().OnPopupGetDeItemDomainLib=t}},{key:"OnPopupGetDeItemDomainLibAsync",get:function(){return this.RecordPop().OnPopupGetDeItemDomainLibAsync},set:function(t){this.RecordPop().OnPopupGetDeItemDomainLibAsync=t}},{key:"OnPopupGetDomainItemExtraLib",get:function(){return this.RecordPop().OnPopupGetDomainItemExtraLib},set:function(t){this.RecordPop().OnPopupGetDomainItemExtraLib=t}},{key:"OnItemPopupSetCloseLib",get:function(){return this.RecordPop().OnItemPopupSetCloseLib},set:function(t){this.RecordPop().OnItemPopupSetCloseLib=t}}]),i}(Dh),Fd=function(t){m()(i,t);var e=Sd(i);function i(t){var n;return r()(this,i),(n=e.call(this,t)).index=-1,n.rh=20,n.syarr=null,n}return l()(i,[{key:"forItem",value:function(t,e){t.font.assign(this.hcl.defaultFont);for(var i=0,n=0,o=0,s=0;s<this.syarr.length&&(o=Math.max(t.textWidth(this.syarr[s].s),16)+4,i>0&&i+o>this.width&&(i=0,n+=this.rh),e(i,n,o,s));s++)i+=o}},{key:"popup",value:function(t,e,n){this.index=-1,f()(F()(i.prototype),"popup",this).call(this,t,e,n)}},{key:"onPaint",value:function(t){var e=this;this.forItem(t,(function(i,n,o,s){return s===e.index&&(t.brush.color=e.hcl.theme.backgroundSelectColor,t.fillBounds(i,n,o,e.rh)),t.textOut(i+2,n+2,e.syarr[s].s),!0}))}},{key:"getIndex",value:function(t,e){var i=this,n=-1;return this.forItem(this.hcl.hclCanvasTemp,(function(o,s,r,a){return!(t>o&&t<o+r&&e>s&&e<s+i.rh)||(n=a,!1)})),n}},{key:"onMouseMove",value:function(t){var e=this.getIndex(t.x,t.y);this.index!=e&&(this.index=e,this.update())}},{key:"onMouseUp",value:function(t){this.donePopup()}}]),i}(Si);function vd(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Id=function(t){m()(i,t);var e=vd(i);function i(t){return r()(this,i),e.call(this,t,"")}return l()(i,[{key:"doInsertText",value:function(t,e){"，"==e||","==e?f()(F()(i.prototype),"doInsertText",this).call(this,t,","):("-"==e||/^-?\d+$/.test(e))&&f()(F()(i.prototype),"doInsertText",this).call(this,t,e)}}]),i}(on),gd=function(t){m()(i,t);var e=vd(i);function i(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:150;r()(this,i),(n=e.call(this,t,o,s)).caption="指定页码";var a=new Ki(t,"单页以英文逗号“,”分隔如：1,4,6,8");a.left=10,a.top=10;var l=new Ki(t,"连续页以英文“-”分隔如：2-5");l.left=a.left,l.top=a.bottom+5;var h=new Ki(t,"以上可同时使用如：1,3,5-7,9");h.left=a.left,h.top=l.bottom+5,n.edtPages=new Id(t,""),n.edtPages.imeMode=Oi,n.edtPages.left=h.left,n.edtPages.top=h.bottom+3,n.edtPages.width=225;var c=new Ji(t,"打印");c.left=Math.trunc((n.width-c.width)/2),c.top=n.edtPages.bottom+10,c.onClick=function(){n.modalResult=wh,n.close()},n.beginUpdate();try{n.addControl(a),n.addControl(l),n.addControl(h),n.addControl(n.edtPages),n.addControl(c)}finally{n.endUpdate()}return n}return l()(i)}(Dh),Cd=function(){function t(e){var i=this;r()(this,t),this.hcl=e,this.onImageLoad=null,this.iconSize=16,this.iconWidth=20,this.itemHeight=20,this.radioButtonWidth=16,this.checkBoxWidth=16,this.shadow=10,this.borderWidth=1,this.marginSpace=5,this.marginSpaceDouble=10,this.popupMenuImagePadding=30,this.dropDownButtonSize=20,this.dropDownButtonColor="#000000",this.borderColor="#848484",this.borderHotColor="green",this.borderActiveColor="blue",this.backgroundStaticColor="#f0f0f0",this.backgroundHintColor="#ffffe1",this.backgroundLightColor="#e2e2e2",this.backgroundHotColor="#d2d2d2",this.backgroundDownColor="#c8c8c8",this.backgroundContentColor="#ffffff",this.backgroundSelectColor="#3390ff",this.ShadowColor="#000000",this.textColor="#000000",this.textDisableColor="gray",this.path="",this.expandImage=new Image,this.expandImage.onload=function(){null!=i.onImageLoad&&i.onImageLoad()},this.foldImage=new Image,this.foldImage.onload=function(){null!=i.onImageLoad&&i.onImageLoad()},this.closeImage=new Image,this.closeImage.onload=function(){null!=i.onImageLoad&&i.onImageLoad()},this.okImage=new Image,this.okImage.onload=function(){null!=i.onImageLoad&&i.onImageLoad()}}return l()(t,[{key:"getCSSCursor",value:function(t){switch(t){case ye:return"crosshair";case Fe:return"grab";case ve:return"pointer";case Ie:return"wait";case ge:return"col-resize";case Ce:return"text";case we:return"not-allowed";case Ae:return"all-scroll";case De:return"nesw-resize";case Pe:return"ns-resize";case ke:return"nwse-resize";case xe:return"w-resize";case Re:return"row-resize";default:return"string"==typeof t?t:"default"}}},{key:"drawDropUp",value:function(t,e){t.pen.width=1,t.pen.style=_t.Solid,t.pen.color=this.dropDownButtonColor,t.beginPath();var i=e.left+Math.trunc((e.width-7)/2),n=e.bottom-Math.trunc((e.height-4)/2);t.drawLine(i,n,i+7,n),t.drawLine(i+1,n-1,i+6,n-1),t.drawLine(i+2,n-2,i+5,n-2),t.drawLine(i+3,n-3,i+4,n-3),t.paintPath()}},{key:"drawDropDown",value:function(t,e){t.pen.width=1,t.pen.style=_t.Solid,t.pen.color=this.dropDownButtonColor,t.beginPath();var i=e.left+Math.trunc((e.width-7)/2),n=e.top+Math.trunc((e.height-4)/2);t.drawLine(i,n,i+7,n),t.drawLine(i+1,n+1,i+6,n+1),t.drawLine(i+2,n+2,i+5,n+2),t.drawLine(i+3,n+3,i+4,n+3),t.paintPath()}},{key:"drawDropRight",value:function(t,e){t.pen.width=1,t.pen.style=_t.Solid,t.pen.color=this.dropDownButtonColor,t.beginPath();var i=e.left+Math.trunc((e.width-4)/2),n=e.top+Math.trunc((e.height-7)/2);t.drawLine(i,n,i,n+7),t.drawLine(i+1,n+1,i+1,n+6),t.drawLine(i+2,n+2,i+2,n+5),t.drawLine(i+3,n+3,i+3,n+4),t.paintPath()}},{key:"drawFrameControl",value:function(t,e,i,n){var o=nt.CreateByBounds(e.left+Math.trunc((e.width-this.checkBoxWidth)/2),e.top+Math.trunc((e.height-this.checkBoxWidth)/2)+1,this.checkBoxWidth-2,this.checkBoxWidth-2);switch(n){case Ti:t.save();try{t.brush.color=Ft.White,t.fillEllipseRect(o),t.pen.color=this.borderColor,t.pen.style=_t.Solid,t.pen.width=1,t.brush.style=Mt.Clear,t.ellipseRectDriect(o),i.has(Pi)&&(t.brush.color=this.textColor,t.brush.style=Mt.Solid,t.pen.style=_t.Clear,o.inFlate(-3,-3),t.ellipseRectDriect(o))}finally{t.restore()}break;case bi:t.save();try{t.brush.color=Ft.White,t.fillRect(o),t.pen.color=this.borderColor,t.pen.style=_t.Solid,t.pen.width=1,t.brush.style=Mt.Clear,t.rectangleRect(o),i.has(Pi)?(t.pen.color=this.textColor,t.beginPath(),t.moveTo(o.left+3,o.top+Math.trunc(this.checkBoxWidth/2)),t.lineTo(o.left-2+Math.trunc(this.checkBoxWidth/2),o.bottom-3),t.lineTo(o.right-3,o.top+3),t.paintPath()):i.has(ki)&&(t.pen.color=this.textColor,t.beginPath(),t.moveTo(o.left+3,o.top+3),t.lineTo(o.right-3,o.bottom-3),t.moveTo(o.left+3,o.bottom-3),t.lineTo(o.right-3,o.top+3),t.paintPath())}finally{t.restore()}}}},{key:"getHoverHintSize",value:function(t){return{width:this.marginSpace+this.hcl.textWidth(this.hcl.defaultFont,t)+this.marginSpace,height:this.marginSpace+this.hcl.defaultFont.height+this.marginSpace}}},{key:"drawHoverHint",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;t.brush.color=this.backgroundHintColor;var n=e.rect.scale(i,!0);t.fillRect(n),t.pen.color=this.borderColor,t.pen.width=1,t.beginPath(),t.moveTo(n.left,n.top),t.lineTo(n.right,n.top),t.lineTo(n.right,n.bottom),t.lineTo(n.left,n.bottom),t.lineTo(n.left,n.top),t.paintPath(),t.pen.color=this.ShadowColor,t.beginPath(),t.moveTo(n.left+2,n.bottom+1),t.lineTo(n.right+1,n.bottom+1),t.lineTo(n.right+1,n.top+2),t.paintPath(),t.font.assign(this.hcl.defaultFont),t.font.size=Math.ceil(t.font.size*i),t.textOut(n.left+this.marginSpace,n.top+this.marginSpace,e.text)}},{key:"drawDesign",value:function(t,e,i,n,o){t.brush.color=this.backgroundSelectColor,t.fillBounds(e-2,i-2,4,4);var s=e+Math.trunc(n/2);t.fillBounds(s-2,i-2,4,4),t.fillBounds(e+n-2,i-2,4,4);var r=i+Math.trunc(o/2);t.fillBounds(e+n-2,r-2,4,4),t.fillBounds(e+n-2,i+o-2,4,4),t.fillBounds(s-2,i+o-2,4,4),t.fillBounds(e-2,i+o-2,4,4),t.fillBounds(e-2,r-2,4,4)}},{key:"drawShadow",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.brush.color=this.ShadowColor,i){t.save();try{t.clip(e.left-this.shadow,e.top,e.width+this.shadow+this.shadow,e.bottom+this.shadow),t.fillRectShadow(e,this.shadow)}finally{t.restore()}}else t.fillRectShadow(e,this.shadow)}},{key:"drawTransparent",value:function(t,e){var i=0,n=e.top,o=!1,s=!0,r=0,a=0;for(t.brush.color=Ft.Gray;n<e.bottom;){for(i=e.left,r=Math.min(4,e.right-i),a=Math.min(4,e.bottom-n),o=!s;i<e.right;)o&&t.fillBounds(i,n,r,a),o=!o,i+=4;s=!s,n+=4}}},{key:"initResources",value:function(){this.hcl.embResources?(this.expandImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAsklEQVR42mNkoBAwUs2ABRsOOACp/WDOD4SCD2j8BSsWOF7YseAANgP+x/vbQzg/GRg+wiR+wAz5CGYHZBQwAA1gxG0AHs0gdgJOA1YADQiwx6sZRCcU4DEgIMAer2YQwGnABKABCSADgAodIhIxQnvBhAkMH4ByBRX4DPCwx2nzByiN14AAD3u8mgkb4GCAVzNIrKABnwEWBng1g+QacBlg4JHgwABLifgB9pRILhh4AwByJ44R63uuUwAAAABJRU5ErkJggg==",this.foldImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA1UlEQVR42sXSIReCMBAA4OMfEW3DRnPR5mxGopFoXDQuEok2+Qn+hEXjaJB0m9twyIZPfc8rcA/uu727JfBlJD8DWN1k8nHWSTf8IEY5q9jycmLNFHDbrNAj6QFa+6GzSKvf8a4ACSRhIFLMhYBiXwaASgIYecXZegs1ow7iXEB5iAAYI68zVsCRujnwawSgEiAKMJ3HwSh9A8jRy8BUod6GPgEHKvMggHPkihVEDCDMGueBLH2aPLjONuaBRapXpYscILxZBIE0J8NNjMf0Tfw0/g/cAWXBpBFJfWumAAAAAElFTkSuQmCC",this.closeImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAOUlEQVR42mNkoBAwDkMD/oMRXJKRkDhWF6ArxqUZrxeQNeHSTDAM8NlMewMo8gJFgUiVaCQFDAMDACg3GBEsaJD3AAAAAElFTkSuQmCC",this.okImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABJklEQVR42mNkAIL///8zkAsYKdFMkgFLliyRsbe3fywvL88E1PN/8eLFYD7cAEZGRrxeAcmD6eWRGnemugYpH0lqQ3EBMQYI74zTVjmYcAXEn7bzbr7x2dRJcAMWLlwoHR8f/xSbrSCArPnD11937zz4o/d3o883FBfgArg0o3ihq72Fqe6q9rLEqSenzRDoPATTLLcnQVdyX9wlmOYlG67rmj4s/I4RCx+9l/W4G0gWg9iqudtslkj2HCWkGcUAS3Mm1mfGm49JCnKZgPjLDj2ojrJTaAWx33z6eX3F5hvG6JoxYuHSBUZWv9nbzojzs+vBFODTjGEACDyY6sXufivvqgA3mzIhzVgNAIHT8v2cjnYKK65YzA5TyN72E08CpWNeoJkBABVWxKc6/gadAAAAAElFTkSuQmCC"):(this.expandImage.src=this.path+"image/minus.png",this.foldImage.src=this.path+"image/plus.png",this.closeImage.src=this.path+"image/close.png",this.okImage.src=this.path+"image/ok.png")}}]),t}();function wd(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var Ad=function(t){m()(i,t);var e=wd(i);function i(t){var n;return r()(this,i),(n=e.call(this,t))._updateCount=0,n._runing=!1,n.icon=new Image(16,16),n.forms=new ot,n.forms.onAdded=function(t){1===n.forms.count&&(n.mainForm=t)},n._activeForm=null,n._captureControl=null,n._mouseMoveForm=null,n.title="HCL Application",n.mainForm=null,n.parent=null,n.hclDesignControl=null,n.hclDesignPt=new et,n.hclDesignDown=!1,n}return l()(i,[{key:"dispose",value:function(){for(var t=this.forms.count-1;t>=0;t--)this.forms[t].dispose();f()(F()(i.prototype),"dispose",this).call(this)}},{key:"_getActiveForm",value:function(){for(var t=this.forms.count-1;t>=0;t--)if(this.forms[t].visible)return this.forms[t];return null}},{key:"_showForm",value:function(t){this.beginUpdate();try{null!==this._activeForm&&this._activeForm.deactivate(),this._mouseMoveForm=t,this._activeForm=t,t.activate()}finally{this.endUpdate()}}},{key:"_hideForm",value:function(t){this.beginUpdate();try{null!==this._activeForm&&this._activeForm.deactivate(),this._activeForm=this._getActiveForm(),null!==this._activeForm&&this._activeForm.activate()}finally{this.endUpdate()}}},{key:"_resize_",value:function(){this.mainForm&&(this.mainForm.width=this.hcl.width,this.mainForm.height=this.hcl.height)}},{key:"setFocusControl_",value:function(t,e){}},{key:"killFocusControl_",value:function(t){this.hcl._killFocusControl_(this,t)}},{key:"hclSelectControl",value:function(t){this.hclDesignControl=t!==this?t:null,this.hcl.update()}},{key:"controlVisible_",value:function(t,e){e?this._showForm(t):this._hideForm(t)}},{key:"doRequestFocus_",value:function(){return this.hcl._setFocus(),!0}},{key:"beginUpdate",value:function(){this._updateCount++}},{key:"endUpdate",value:function(){this._updateCount>0&&(this._updateCount--,0===this._updateCount&&this.update())}},{key:"addControl",value:function(t){this.addForm(t)}},{key:"addForm",value:function(t){t.isClass(Ah)?(this.forms.add(t),t.added_(this)):this.hcl.exception("application只能添加TCustomForm的子类！")}},{key:"removeControl",value:function(t){this.beginUpdate();try{this.forms.remove(t),t.removed_(),this._activeForm=this._getActiveForm(),null!==this._activeForm&&this._activeForm.activate()}finally{this.endUpdate()}}},{key:"getFormAt",value:function(t,e){for(var i=null,n=this.forms.count-1;n>=0;n--)if((i=this.forms[n]).visible&&i.bounds().pointInAt(t,e))return i;return null}},{key:"getControlAtPos",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.getFormAt(t,e);return null!==n?(t-=n.left,e-=n.top,n.getControlAtPos(t,e,i)):null}},{key:"pointAtDesignControl",value:function(t,e){if(null!==this.hclDesignControl){var i=this.hclDesignControl.clientToScreen(et.Create(0,0)),n=this.hclDesignControl.clientRect();if(n.offset(i.x,i.y),n.pointInAt(t,e))return!0}return!1}},{key:"removeForm",value:function(t){this.removeControl(t)}},{key:"setCapture",value:function(t){this._captureControl=t}},{key:"releaseCapture",value:function(){this._captureControl=null}},{key:"clientToScreen",value:function(t){return t}},{key:"screenToClient",value:function(t){return t}},{key:"mouseWheel",value:function(t){this._activeForm=this._mouseMoveForm;var e=new fi;e.assign(t),e.x-=this._mouseMoveForm.left,e.y-=this._mouseMoveForm.top,this._mouseMoveForm.mouseWheel(e)}},{key:"mouseDown",value:function(t){if(this._activeForm=this._mouseMoveForm,this._mouseMoveForm){var e=new fi;e.assign(t),e.x-=this._mouseMoveForm.left,e.y-=this._mouseMoveForm.top,this._mouseMoveForm.mouseDown(e)}if(this.hcl.design&&this.pointAtDesignControl(t.x,t.y))return this.hclDesignPt.reset(t.x,t.y),this.hclDesignDown=t.button===ae,void(null!==this._activeForm&&this._activeForm.deactivate())}},{key:"doMouseMoveFromChange",value:function(t){this._mouseMoveForm!==t&&(null!==this._mouseMoveForm&&this._mouseMoveForm.mouseLeave(),this._mouseMoveForm=t,null!==this._mouseMoveForm&&this._mouseMoveForm.mouseEnter())}},{key:"doFormMouseMove",value:function(t){for(var e=null,i=this.forms.count-1;i>=0;i--)if((e=this.forms[i]).visible){if(e.showState===gh)return this.doMouseMoveFromChange(e),t.x-=e.left,t.y-=e.top,void e.mouseMove(t);if(e.bounds().pointInAt(t.x,t.y))return this.doMouseMoveFromChange(e),t.x-=e.left,t.y-=e.top,void e.mouseMove(t)}}},{key:"doCaptureMouseMove",value:function(t){this.doMouseMoveFromChange(this._captureControl);var e=this._captureControl.clientToScreen(et.Create(0,0));t.x-=e.x,t.y-=e.y,this._captureControl.mouseMove(t)}},{key:"mouseMove",value:function(t){if(this.hcl.design){if(this.hclDesignDown)return this.hclDesignControl.left+=t.x-this.hclDesignPt.x,this.hclDesignControl.top+=t.y-this.hclDesignPt.y,void this.hclDesignPt.reset(t.x,t.y);this.pointAtDesignControl(t.x,t.y)}null!==this._captureControl?this.doCaptureMouseMove(t):this.doFormMouseMove(t)}},{key:"doCaptureMouseUp",value:function(t){var e=this._captureControl.clientToScreen(et.Create(0,0));t.x-=e.x,t.y-=e.y,this._captureControl.mouseUp(t)}},{key:"doMouseUp",value:function(t){if(null!==this._activeForm)return t.x-=this._activeForm.left,t.y-=this._activeForm.top,void this._activeForm.mouseUp(t);this._mouseMoveForm&&(t.x-=this._mouseMoveForm.left,t.y-=this._mouseMoveForm.top,this._mouseMoveForm.mouseUp(t))}},{key:"mouseUp",value:function(t){this.hcl.design&&(this.hclDesignDown=!1,this.pointAtDesignControl(t.x,t.y))||(null!==this._captureControl?this.doCaptureMouseUp(t):this.doMouseUp(t))}},{key:"mouseEnter",value:function(t){null!==this._activeForm&&this._activeForm.mouseEnter()}},{key:"mouseLeave",value:function(t){null!==this._activeForm&&this._activeForm.mouseLeave()}},{key:"dragenter",value:function(t){null!==this._activeForm&&(t.x-=this._activeForm.left,t.y-=this._activeForm.top,this._activeForm.dragenter(t))}},{key:"dragover",value:function(t){null!==this._activeForm&&(t.x-=this._activeForm.left,t.y-=this._activeForm.top,this._activeForm.dragover(t))}},{key:"dragleave",value:function(t){null!==this._activeForm&&(t.x-=this._activeForm.left,t.y-=this._activeForm.top,this._activeForm.dragleave(t))}},{key:"drop",value:function(t){null!==this._activeForm&&(t.x-=this._activeForm.left,t.y-=this._activeForm.top,this._activeForm.drop(t))}},{key:"dblClick",value:function(t){if(null!==this._activeForm){var e=new fi;e.assign(t),e.x-=this._activeForm.left,e.y-=this._activeForm.top,this._activeForm.dblClick(e)}}},{key:"keyDown",value:function(t){if(this.hcl.design&&null!==this.hclDesignControl)switch(t.keyCode){case Je:return void this.hclDesignControl.left--;case je:return void this.hclDesignControl.top--;case Ye:return void this.hclDesignControl.left++;case Qe:return void this.hclDesignControl.top++;case Ue:return void this.hclSelectControl(this.hclDesignControl.parent)}null!==this._activeForm?this._activeForm.keyDown(t):this.mainForm.keyDown(t)}},{key:"keyPress",value:function(t){null!==this._activeForm?this._activeForm.keyPress(t):this.mainForm.keyPress(t)}},{key:"keyUp",value:function(t){null!==this._activeForm?this._activeForm.keyUp(t):this.mainForm.keyUp(t)}},{key:"copy",value:function(t){null!==this._activeForm?this._activeForm.copy(t):this.mainForm.copy(t)}},{key:"cut",value:function(t){null!==this._activeForm?this._activeForm.cut(t):this.mainForm.cut(t)}},{key:"paste",value:function(t){null!==this._activeForm?this._activeForm.paste(t):this.mainForm.paste(t)}},{key:"update",value:function(){this.updateRect(nt.CreateByBounds(0,0,this.hcl.width,this.hcl.height))}},{key:"updateRect",value:function(t){this._updateCount>0||this.hcl.updateRect(t)}},{key:"createCaret",value:function(t,e,i,n){this.hcl.__createCaret(t,e,i,n)}},{key:"setCaretPos",value:function(t,e){this.hcl._setCaretPos_(t,e)}},{key:"setCursorBy",value:function(t){this.hcl._setCursorBy_(t)}},{key:"showCaret",value:function(t){this.hcl._showCaret_(t)}},{key:"hideCaret",value:function(t){this.hcl._hideCaret_(t)}},{key:"destroyCaret",value:function(t){this.hcl._destroyCaret_(t)}},{key:"trackPopupControl",value:function(t,e){this.hcl._trackPopupControl_(t,e)}},{key:"closePopupControl",value:function(t){this.hcl._closePopupControl_(t)}},{key:"paint",value:function(t){if(0!==this.forms.count&&!(this._updateCount>0)){for(var e=null,i=0;i<this.forms.count;i++)if(!((e=this.forms[i]).showState<vh)){t.save();try{e.showState===gh&&(t.alpha=.5,t.brush.color=Ft.Black,t.fillBounds(0,0,this.hcl.width,this.hcl.height),t.alpha=1),t.translate(e.left,e.top),t.clip(-this.hcl.theme.shadow,-this.hcl.theme.shadow,e.width+this.hcl.theme.shadow+this.hcl.theme.shadow,e.height+this.hcl.theme.shadow+this.hcl.theme.shadow),e.paint(t)}finally{t.restore()}}if(this.hcl.design&&null!==this.hclDesignControl){var n=this.hclDesignControl.clientToScreen(et.Create(0,0));this.hcl.theme.drawDesign(t,n.x,n.y,this.hclDesignControl.width,this.hclDesignControl.height)}}}},{key:"broadcast",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.forms.count-1;n>=0;n--)this.forms[n].broadcast(t,e,i)}},{key:"run",value:function(){this.hcl.applicationRun(),this._runing=!0,this.mainForm&&this.mainForm.show()}},{key:"runing",get:function(){return this._runing}}]),i}(tt),Dd=function(){function t(){r()(this,t),this._indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this._indexedDB||console.error("当前浏览器不支持indexedDB！"),this.name="",this.db=null,this.onOpen=null,this.onUpgradeneeded=null}return l()(t,[{key:"open",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=this._indexedDB.open(t,i);o.onerror=function(t){console.error(t.currentTarget.error.message)},o.onsuccess=function(i){e.db=i.target.result,e.name=t,null!=e.onOpen&&e.onOpen()},o.onupgradeneeded=function(t){e.db=t.target.result,null!=e.onUpgradeneeded&&e.onUpgradeneeded(),null!==n&&n(e)}}},{key:"close",value:function(){this.db.close()}},{key:"deleteDB",value:function(t){this._indexedDB.deleteDatabase(t)}},{key:"select",value:function(t,e,i){if(this.db){var n=this.db.transaction([t]).objectStore(t).get(e);n.onerror=function(t){},n.onsuccess=function(t){i(n.result)}}}},{key:"insert",value:function(t,e){if(this.db){var i=this.db.transaction([t],"readwrite");i.onsuccess=function(t){},i.onerror=function(t){},i.objectStore(t).add({data:e})}}},{key:"update",value:function(t,e){if(this.db){var i=this.db.transaction([t],"readwrite").objectStore(t).put({data:e});i.onsuccess=function(t){},i.onerror=function(t){}}}},{key:"delete",value:function(t,e){if(this.db){var i=this.db.transaction([t],"readwrite").objectStore(t).delete({data:e});i.onsuccess=function(t){},i.onerror=function(t){}}}}]),t}();function Pd(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F()(t);if(e){var o=F()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p()(this,i)}}var kd=1,xd=2,Rd=3,Td=4,bd=5,Bd=l()((function t(e){r()(this,t),this.text=e})),Nd=function(t){m()(i,t);var e=Pd(i);function i(){var t,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return r()(this,i),(t=e.call(this,n)).rect=nt.CreateByBounds(0,0,300,20),t}return l()(i)}(ot),Od=function(){function t(){var e=this;r()(this,t),this.instanceID="",this.debug=!1,this.meaChr=!1,this.brower=this.__GetBrowerType(),this.system=new L,this.ime=new Ei,this.clipboard=new au,this.localStorage=new lu,this.indexedDB=new Dd,this.__initBrushStyle(),this.embResources=!1,this.theme=new Cd(this),this.theme.onImageLoad=function(){e.update()},this.langIndex=0,this.langs=[["复制","剪切","粘贴","复制到浏览器"],["Copy","Cut","Paste","Copy to brower"]],this.appLangs=null,this.defaultFont=new Nt(this),this.canvasMinWidth=256,this.canvasTemp_=document.createElement("canvas"),this.contextTemp=this.canvasTemp_.getContext("2d"),this.hclCanvasTemp=new zt(this,this.contextTemp),this._parentElement=null,this._touchTimer=0,this._touchLong=!1,this._touchPt=null,this._lastPt={x:-65535,y:-65535},this._curApplication=null,this._updateCount=0,this._handleSeq=1e3,this._cursorPos=new et,this._cursor=Se,this._cursorControl=null,this._caret=new ui,this._idle=!1,this._idleInterval=new ut(500),this._idleInterval.loop=!0,this._idleInterval.onExecute=function(){e._doIdle()},this._idleInterval.enabled=!0,this.keyDownStates=new Array(255),this.width_=854,this.height_=400,this.left_=this._getAdjustLeft(),this.top_=0,this.design_=!1,this._focus=!1,this._mouseIn=!1,this._horizontalCenter=!0,this._autoWidth=!1,this._autoHeight=!0,this.windowMouseEvent=!0,this._windowCapture=null,this._focusLayer=null,this._captureLayer=null,this._mouseMoveLayer=null,this._capturePopupControl=null,this._mouseMovePopupControl=null,this._waitList=new Nd,this._waitList.onAdded=function(t){e.update()},this._waitList.onRemoved=function(){e.update()},this._applicationLayer=new ot,this._popupLayer=new ot,this._popupLayer.onAdded=function(t){e.update()},this._popupLayer.onRemoved=function(t){t.clear(),e.update()},this.__parentKeyDown=function(t){e.parentKeyDown_(t)},this.__parentKeyPress=function(t){e.parentKeyPress_(t)},this.__parentKeyUp=function(t){e.parentKeyUp_(t)},this.__parentResize=function(t){e.parentResize_(t)},this.__parentFocus=function(t){e.parentFocus_(t)},this.__parentFocuOut=function(t){e.parentFocusOut_(t)},this.__parentMouseMove=function(t){e.parentMouseMove_(t)},this.__parentMouseDown=function(t){e.parentMouseDown_(t)},this.__parentMouseWheel=function(t){t.target===e._hclH5Canvas&&e._mouseWheel(t)},this.__parentLoad=function(t){e.parentLoad_(t)},this.__parentDocVisibilitychange=function(t){e.parentDocVisibilitychange_(t)},this.__parentDocCopy=function(t){e.parentDocCopy_(t)},this.__parentDocCut=function(t){e.parentDocCut_(t)},this.__parentDocPaste=function(t){e.parentDocPaste_(t)},this.__parentDragover=function(t){e.parentDragover(t)},this.__parentDragenter=function(t){e.parentDragenter(t)},this.__parentDragleave=function(t){e.parentDragleave(t)},this.__parentDrop=function(t){e.parentDrop(t)},this.__windowMouseDown=function(t){e._windowCapture=t.target},this.__windowMouseMove=function(t){e.windowMouseEvent&&t.target!==e._hclH5Canvas&&e._windowCapture===e._hclH5Canvas&&e._focus&&e._hclH5Canvas.onmousemove(t)},this.__windowMouseUp=function(t){e.windowMouseEvent&&t.target!==e._hclH5Canvas&&e._windowCapture===e._hclH5Canvas&&e._focus&&e._hclH5Canvas.onmouseup(t),e._windowCapture=null},this.__windowMouseWheel=function(t){e.windowMouseEvent&&e._focus&&t.preventDefault()},this.__windowKeyDown=function(t){!0!==t.ctrlKey&&!0!==t.metaKey||61!==t.which&&107!==t.which&&173!==t.which&&109!==t.which&&187!==t.which&&189!==t.which||e.windowMouseEvent&&e._focus&&t.preventDefault()},this.__updatePixelRatio=function(t){t.target.removeEventListener("change",e.__updatePixelRatio),matchMedia("(resolution: ".concat(window.devicePixelRatio,"dppx)")).addEventListener("change",e.__updatePixelRatio,!1),e.resize()},this._hoverHintInfo=new dt,this._scale=1,this.dprScale=1,this._hclH5Canvas=null,this._hclCanvas=null,this._appH5Canvas=null,this._appCanvas=null,this._popupH5Canvas=null,this._popupCanvas=null,this._resizeObserve=null,this.parentElement=null,this.colorPadData=null,this.textMetrics=new ot}return l()(t,[{key:"textMetricsIndexOf",value:function(t,e,i){for(var n=null,o=0;o<this.textMetrics.count;o++)if((n=this.textMetrics[o]).name==t&&n.size==e&&n.styles==i)return o;return-1}},{key:"___getBrushStyle",value:function(t,e,i){t.clearRect(0,0,10,10),t.beginPath();for(var n=0,o=e.length;n<o;)t.moveTo(e[n].x,e[n].y),n++,t.lineTo(e[n].x,e[n].y),n++;t.closePath(),t.stroke();var s=new Image(10,10);s.onload=function(){i(s)},s.src=t.canvas.toDataURL("image/png")}},{key:"__initBrushStyle",value:function(){if(!Lt.Init){var t=document.createElement("canvas");t.width=10,t.height=10;var e=t.getContext("2d");e.lineCap="square",e.strokeStyle="black",e.lineWidth=2,this.___getBrushStyle(e,[{x:0,y:1},{x:10,y:1},{x:0,y:6},{x:10,y:6}],(function(t){Lt.Horizontal=t})),this.___getBrushStyle(e,[{x:1,y:0},{x:1,y:10},{x:6,y:0},{x:6,y:10}],(function(t){Lt.Vertical=t})),this.___getBrushStyle(e,[{x:0,y:1},{x:10,y:1},{x:0,y:6},{x:10,y:6},{x:1,y:0},{x:1,y:10},{x:6,y:0},{x:6,y:10}],(function(t){Lt.Cross=t})),e.lineWidth=1,this.___getBrushStyle(e,[{x:0,y:5},{x:5,y:10},{x:0,y:0},{x:10,y:10},{x:5,y:0},{x:10,y:5}],(function(t){Lt.FDiagonal=t})),this.___getBrushStyle(e,[{x:5,y:0},{x:0,y:5},{x:10,y:0},{x:0,y:10},{x:10,y:5},{x:5,y:10}],(function(t){Lt.BDiagonal=t})),this.___getBrushStyle(e,[{x:0,y:5},{x:5,y:10},{x:0,y:0},{x:10,y:10},{x:5,y:0},{x:10,y:5},{x:5,y:0},{x:0,y:5},{x:10,y:0},{x:0,y:10},{x:10,y:5},{x:5,y:10}],(function(t){Lt.DiagCross=t})),Lt.Init=!0,this.brower!==bd&&t.remove(),t=null}}},{key:"__GetBrowerType",value:function(){var t=window.navigator.userAgent;return window.ActiveXObject||"ActiveXObject"in window?(null==CanvasRenderingContext2D.prototype.ellipse&&(CanvasRenderingContext2D.prototype.ellipse=function(t,e,i,n,o,s,r,a){this.save(),this.translate(t,e),this.rotate(o||0),this.scale(i,n),this.arc(0,0,1,s||0,r||Math.PI,a||!0),this.restore()}),bd):t.indexOf("Firefox")>=0?xd:t.indexOf("Chrome")>=0?kd:t.indexOf("Opera")>=0?Td:t.indexOf("Safari")>=0?Rd:void 0}},{key:"__createCaret",value:function(t,e,i,n){if(this._resetCaret_(),this._caret.reset(),this._caret.control=t,this._focusLayer=this._applicationLayer,this._popupLayer.count>0)for(var o=this._caret.control.parent;null!=o;){if(o.isClass(Si)||o.isClass(Ni)){this._focusLayer=this._popupLayer;break}o=o.parent}this._caret.image=e,this._caret.width=i>0?i:2,this._caret.height=n}},{key:"_setCaretPos_",value:function(t,e){if(null!==this._caret.control){this._resetCaret_();var i=this._caret.control.clientToScreenAt(0,0);this._caret.left=i.x+t,this._caret.top=i.y+e,this._caret.controlScreenRect.resetBounds(i.x,i.y,this._caret.control.width,this._caret.control.height)}}},{key:"_showCaret_",value:function(t){this._focus&&null!==this._caret.control&&(this._caret.visible=!0)}},{key:"_hideCaret_",value:function(t){this._caret.control==t&&this._caret.visible&&(this._resetCaret_(),this._caret.visible=!1)}},{key:"_destroyCaret_",value:function(t){this._caret.control==t&&(this._hideCaret_(t),this._caret.control=null)}},{key:"_paintCaretShan",value:function(){this._hclCanvas.brush.color=this._caret.color;var t=this._caret.rect.intersection(this._caret.controlScreenRect);t.scale(this.dprScale),this._hclCanvas.fillRect(t),this._popupLayer.count>0&&this._focusLayer!==this._popupLayer&&this._hclCanvas.bitBltRect(t,this._popupCanvas,t)}},{key:"_doCaretShan_",value:function(){this._caret.shan=!1,this._paintCaretShan(),this._hoverHintInfo.visible&&this._hoverHintInfo.rect.isIntersect(this._caret.rect)&&this._paintHintLayer()}},{key:"_paintCaretShuo",value:function(){var t=nt.CreateByBounds(this._caret.left,this._caret.top-1,this._caret.width,this._caret.height+2);t.scale(this.dprScale),this._hclCanvas.bitBltRect(t,this._appCanvas,t),this._popupLayer.count>0&&this._focusLayer!==this._popupLayer&&this._hclCanvas.bitBltRect(t,this._popupCanvas,t)}},{key:"_doCaretShuo_",value:function(){this._caret.shan=!0,this._paintCaretShuo(),this._hoverHintInfo.visible&&this._hoverHintInfo.rect.isIntersect(this._caret.rect)&&this._paintHintLayer()}},{key:"_resetCaret_",value:function(){this._caret.visible&&!this._caret.shan&&this._doCaretShuo_()}},{key:"_doCaretTimer_",value:function(){this._caret.visible&&(this._caret.shan?this._doCaretShan_():this._doCaretShuo_())}},{key:"_closeHoverHint",value:function(){this._hoverHintInfo.visible&&(this._hoverHintInfo.visible=!1,this.updateRect(this._hoverHintInfo.rect))}},{key:"showHoverHint",value:function(t){if(this._hoverHintInfo.visible){if(this._hoverHintInfo.control===t)return;this._hoverHintInfo.visible=!1,this.updateRect(this._hoverHintInfo.rect)}if(this._hoverHintInfo.control=t,this._hoverHintInfo.text=t.hint,""!=this._hoverHintInfo.text){var e=t.clientToScreenAt(0,0);if(this._hoverHintInfo.rect=t.getHintRect(),this._hoverHintInfo.rect)this._hoverHintInfo.rect.bottom+this._hoverHintInfo.rect.height+e.y+this.theme.marginSpace>this.height_?this._hoverHintInfo.rect.offset(e.x,e.y-this._hoverHintInfo.rect.height-this.theme.marginSpace):this._hoverHintInfo.rect.offset(e.x,e.y+this._hoverHintInfo.rect.height+this.theme.marginSpace),this._hoverHintInfo.rect.resetSize(this.theme.getHoverHintSize(this._hoverHintInfo.text));else{var i=this.theme.getHoverHintSize(this._hoverHintInfo.text);this._hoverHintInfo.rect=nt.CreateByBounds(this.cursorPos.x,this.cursorPos.y+this.theme.itemHeight,i.width,i.height)}this._hoverHintInfo.rect.left<0?e.x=this._hoverHintInfo.rect.left:this._hoverHintInfo.rect.right>this.width_?e.x=this._hoverHintInfo.rect.right-this.width_:e.x=0,this._hoverHintInfo.rect.top<0?e.y=this._hoverHintInfo.rect.top:this._hoverHintInfo.rect.bottom>this.height_?e.y=this._hoverHintInfo.rect.bottom-this.height_+this._hoverHintInfo.rect.height+this.theme.marginSpace+this.theme.itemHeight:e.y=0,this._hoverHintInfo.rect.offset(-e.x,-e.y),this._hoverHintInfo.visible=!0,this.updateRect(this._hoverHintInfo.rect)}}},{key:"_doIdle",value:function(){this._doCaretTimer_(),this._idle&&this._mouseIn?null!=this._cursorControl&&this.showHoverHint(this._cursorControl):this._idle=!0}},{key:"_cancelIdle",value:function(){this._idle=!1,this._closeHoverHint()}},{key:"_setCursorBy_",value:function(t){this._getControlAtPos(this._cursorPos.x,this._cursorPos.y)===t&&(this._cursorControl=t,this._cursor!=t.cursor&&(this._cursor=t.cursor,this._hclH5Canvas.style.cursor=this.theme.getCSSCursor(this._cursor)))}},{key:"_isPreventKeyDown",value:function(t){return t==Ee||t==Xe||t==Je||t==Ye||t==je||t==Qe||t==Le||t==Ke||t==ze||t==Me}},{key:"_setFocus",value:function(){this._focus=!0,this._idleInterval.enabled||(this._idleInterval.enabled=!0)}},{key:"_killFocus",value:function(){this._focus=!1,this._caret.visible=!1,null!=this._caret.control&&this._caret.control.killFocus(),this._idleInterval.enabled&&(this._idleInterval.enabled=!1,this._cancelIdle()),this.ime.killFocus()}},{key:"_killFocusControl_",value:function(t,e){this._caret.visible&&this._destroyCaret_(this._caret.control),this.ime.removeControl(e)}},{key:"_closePopupControl_",value:function(t){if(null!=t){t.closePopup(),this._mouseMovePopupControl===t&&(this._mouseMovePopupControl=null);var e=t.popupLinkedList;if(null!=t.forward){for(var i,n=t;null!==n.next;)n=n.next;for(;n!==t;)(i=n.forward).next=null,n.forward=null,n.closePopup(),e.remove(n),n=i;t.forward.next=null,t.forward=null,e.remove(t),this.update(),0==e.count&&(this._popupLayer.remove(e),this._reAdjustMouseMove())}else this._popupLayer.remove(e),this.update(),this._reAdjustMouseMove()}}},{key:"_trackPopupControl_",value:function(t,e){var i=this,n=Math.min(this.width_,this._getViewPortWidth()),o=Math.min(this.height_,this._getViewPortHeight());if(e){t.adjustPosition&&(t.left+t.width+this.theme.shadow>n&&(t.left=n-t.width-this.theme.shadow),t.top+t.height+this.theme.shadow>o&&(t.top=o-t.height-this.theme.shadow));var s=new ot;s.onAdded=function(t){i.update()},s.onRemoved=function(t){t.onClose()},t.popupLinkedList=s,s.add(t),this._popupLayer.add(s)}else this._popupLayer.count>0&&(t.forward=this._popupLayer.last.last,this._popupLayer.last.last.next=t,t.adjustPosition&&(t.left+t.width+this.theme.shadow>n&&(t.left=t.forward.left-t.width),t.top+t.height+this.theme.shadow>o&&(t.top=o-t.height-this.theme.shadow)),t.popupLinkedList=this._popupLayer.last,this._popupLayer.last.add(t));this._reAdjustMouseMove()}},{key:"_getControlAtPos",value:function(t,e){var i=this._getPopupControlAtPos(t,e);return null!==i?i:this.application.getControlAtPos(t,e)}},{key:"_reAdjustMouseMove",value:function(){var t=new fi;t.x=this._cursorPos.x,t.y=this._cursorPos.y,this._mouseMove(t)}},{key:"_getPopupControlAt",value:function(t,e){if(this._popupLayer.count>0)for(var i=null,n=this._popupLayer.count-1;n>=0;n--)for(var o=(i=this._popupLayer[n]).count-1;o>=0;o--)if(i[o].bounds().pointInAt(t,e))return i[o];return null}},{key:"_popupMouseWheel",value:function(t){var e=this._mouseMovePopupControl;if(null!==e){var i=new fi;return i.assign(t),i.x-=e.left,i.y-=e.top,e.mouseWheel(i),!0}return!1}},{key:"_popupMouseDown",value:function(t){if(this._capturePopupControl=this._getPopupControlAt(t.x,t.y),null!==this._capturePopupControl)return t.x-=this._capturePopupControl.left,t.y-=this._capturePopupControl.top,this._capturePopupControl.mouseDown(t),!0;if(this._popupLayer.count>0)for(var e=this._popupLayer.count-1;e>=0;e--)this._closePopupControl_(this._popupLayer[e].first);return!1}},{key:"_waitListResponsive",value:function(t){return this._waitList.count>0&&this._waitList.rect.pointInAt(t.x,t.y)}},{key:"_waitListMouseDown",value:function(t){return this._waitListResponsive(t)}},{key:"_waitListMouseMove",value:function(t){return!!this._waitListResponsive(t)&&(this._cursor=pe,this._hclH5Canvas.style.cursor=this.theme.getCSSCursor(this._cursor),!0)}},{key:"_waitListMouseUp",value:function(t){return!!this._waitListResponsive(t)&&(this._waitList.delete(this._waitList.count-1),this.update(),!0)}},{key:"_popupMouseMove",value:function(t){if(null!==this._capturePopupControl){var e=new fi;return e.assign(t),e.x-=this._capturePopupControl.left,e.y-=this._capturePopupControl.top,this._capturePopupControl.mouseMove(e),!0}var i=this._getPopupControlAt(t.x,t.y);if(i!=this._mouseMovePopupControl&&(null!=this._mouseMovePopupControl&&this._mouseMovePopupControl.mouseLeave(),this._mouseMovePopupControl=i,null!=this._mouseMovePopupControl&&this._mouseMovePopupControl.mouseEnter()),null!==this._mouseMovePopupControl){var n=new fi;return n.assign(t),n.x-=this._mouseMovePopupControl.left,n.y-=this._mouseMovePopupControl.top,this._mouseMovePopupControl.mouseMove(n),!0}return!1}},{key:"_popupMouseUp",value:function(t){if(null!==this._capturePopupControl){var e=new fi;return e.assign(t),e.x=t.x-this._capturePopupControl.left,e.y=t.y-this._capturePopupControl.top,this._capturePopupControl.mouseUp(e),this._capturePopupControl=null,this._mouseMovePopupControl=null,!0}var i=this._mouseMovePopupControl;return null!==i&&(t.x-=i.left,t.y-=i.top,i.mouseUp(t),!0)}},{key:"_popupKeyDown",value:function(t){return this._focusLayer==this._popupLayer&&(null!=this._caret.control&&this._caret.control.keyDown(t),!0)}},{key:"_popupKeyPress",value:function(t){return this._focusLayer==this._popupLayer&&(null!=this._caret.control&&this._caret.control.keyPress(t),!0)}},{key:"_getPopupControlAtPos",value:function(t,e){var i=this._getPopupControlAt(t,e);return null!==i?i.getControlAtPos(t-i.left,e-i.top):null}},{key:"parentKeyDown_",value:function(t){this._focus&&this._keyDown(t)}},{key:"parentKeyPress_",value:function(t){this._focus&&this._keyPress(t)}},{key:"parentKeyUp_",value:function(t){this._focus&&this._keyUp(t)}},{key:"parentResize_",value:function(t){this.resize()}},{key:"parentFocus_",value:function(t){this._clearKeyState()}},{key:"parentFocusOut_",value:function(t){t.relatedTarget!==this.ime._input&&t.relatedTarget!==this._hclH5Canvas&&(this._clearKeyState(),this._killFocus())}},{key:"windowTouchStart_",value:function(t){this._touchStart(t)}},{key:"windowTouchMove_",value:function(t){this._touchMove(t)}},{key:"windowTouchEnd_",value:function(t){this._touchEnd(t)}},{key:"_removeBindEvent",value:function(){this._resizeObserve&&this._resizeObserve.unobserve(this._parentElement),null!==this._parentElement&&(this._parentElement.removeEventListener("keydown",this.__parentKeyDown),this._parentElement.removeEventListener("keypress",this.__parentKeyPress,!1),this._parentElement.removeEventListener("keyup",this.__parentKeyUp),this._parentElement.removeEventListener("resize",this.__parentResize),this._parentElement.removeEventListener("focus",this.__parentFocus),this._parentElement.removeEventListener("focusout",this.__parentFocuOut),this._parentElement.removeEventListener("mousedown",this.__parentMouseDown),this._parentElement.removeEventListener("mousemove",this.__parentMouseMove),this._parentElement.removeEventListener("load",this.__parentLoad),this._parentElement.removeEventListener("dragover",this.__parentDragover),this._parentElement.removeEventListener("dragenter",this.__parentDragenter),this._parentElement.removeEventListener("dragleave",this.__parentDragleave),this._parentElement.removeEventListener("drop",this.__parentDrop),this._parentElement.removeEventListener("visibilitychange",this.__parentDocVisibilitychange),this._parentElement.removeEventListener("copy",this.__parentDocCopy),this._parentElement.removeEventListener("cut",this.__parentDocCut),this._parentElement.removeEventListener("paste",this.__parentDocPaste),this.brower===xd&&this._parentElement.removeEventListener("DOMMouseScroll",this.__parentMouseWheel)),window.removeEventListener("mousedown",this.__windowMouseDown),window.removeEventListener("mousemove",this.__windowMouseMove),window.removeEventListener("mouseup",this.__windowMouseUp),window.removeEventListener("mousewheel",this.__windowMouseWheel)}},{key:"_initBindEvent",value:function(){var t=this;this._removeBindEvent(),null!==this._parentElement&&(this._parentElement.addEventListener("keydown",this.__parentKeyDown,!1),this._parentElement.addEventListener("keypress",this.__parentKeyPress,!1),this._parentElement.addEventListener("keyup",this.__parentKeyUp,!1),this._parentElement.addEventListener("resize",this.__parentResize,!1),this._parentElement.addEventListener("focus",this.__parentFocus,!1),this._parentElement.addEventListener("focusout",this.__parentFocuOut,!1),this._parentElement.addEventListener("mousedown",this.__parentMouseDown,!1),this._parentElement.addEventListener("mousemove",this.__parentMouseMove,!1),this._parentElement.addEventListener("load",this.__parentLoad,!1),this._parentElement.addEventListener("dragover",this.__parentDragover,!1),this._parentElement.addEventListener("dragenter",this.__parentDragenter,!1),this._parentElement.addEventListener("dragleave",this.__parentDragleave,!1),this._parentElement.addEventListener("drop",this.__parentDrop,!1),this._parentElement.addEventListener("visibilitychange",this.__parentDocVisibilitychange,!1),this._parentElement.addEventListener("copy",this.__parentDocCopy,!1),this._parentElement.addEventListener("cut",this.__parentDocCut,!1),this._parentElement.addEventListener("paste",this.__parentDocPaste,!1)),window.addEventListener("mousedown",this.__windowMouseDown,!1),window.addEventListener("mousemove",this.__windowMouseMove,!1),window.addEventListener("mouseup",this.__windowMouseUp,!1),window.addEventListener("keydown",this.__windowKeyDown,!1),this.brower===xd?window.addEventListener("DOMMouseScroll",this.__windowMouseWheel,{passive:!1}):window.addEventListener("mousewheel",this.__windowMouseWheel,{passive:!1}),matchMedia("(resolution: ".concat(window.devicePixelRatio,"dppx)")).addEventListener("change",this.__updatePixelRatio,!1),this._hclH5Canvas.onmousedown=function(e){t._lastPt.x=e.x,t._lastPt.y=e.y,t._focus||t.parentMouseDown_(e),t._mouseDown(t._makeMouseEventArgs(e))},this._hclH5Canvas.onmousemove=function(e){1===e.buttons&&t._lastPt.x===e.x&&t._lastPt.y===e.y||t._mouseMove(t._makeMouseEventArgs(e))},this._hclH5Canvas.onmouseup=function(e){var i=t._makeMouseEventArgs(e);0===e.buttons&&(0===e.button?i.button=ae:1===e.button?i.button=he:2===e.button&&(i.button=le)),t._mouseUp(i)},this._hclH5Canvas.onmouseenter=function(e){t._mouseEnter(t._makeMouseEventArgs(e))},this.brower===xd?this._parentElement.addEventListener("DOMMouseScroll",this.__parentMouseWheel,!1):this._hclH5Canvas.onmousewheel=function(e){t._mouseWheel(e)},this._hclH5Canvas.onmouseleave=function(e){t._mouseLeave(t._makeMouseEventArgs(e))},this._hclH5Canvas.ondblclick=function(e){t._dblClick(t._makeMouseEventArgs(e))},this._hclH5Canvas.ontouchstart=function(e){t.windowTouchStart_(e)},this._hclH5Canvas.ontouchmove=function(e){t.windowTouchMove_(e)},this._hclH5Canvas.ontouchend=function(e){t.windowTouchEnd_(e)},this._parentElement===document.body&&(document.body.parentNode.style.overflowY="hidden"),this._parentElement.oncontextmenu=function(t){t.returnValue=!1},this.ime.__hclLoaded(this),this.brower!==bd&&(this._resizeObserve||(this._resizeObserve=new ResizeObserver((function(e){t.resize()}))),this._resizeObserve.observe(this._parentElement))}},{key:"parentMouseDown_",value:function(t){t.target!==this._hclH5Canvas?this._killFocus():this._setFocus()}},{key:"parentMouseMove_",value:function(t){t.target!==this._hclH5Canvas?(this._mouseIn=!1,this._cancelIdle()):this._mouseIn=!0}},{key:"parentDragover",value:function(t){var e=this._makeMouseEventArgs(t);this.application.dragover(e),e=null,t.preventDefault(),t.stopPropagation()}},{key:"parentDragenter",value:function(t){var e=this._makeMouseEventArgs(t);this.application.dragenter(e),e=null,t.target.classList.contains("dropzone")&&t.target.classList.add("dragover")}},{key:"parentDragleave",value:function(t){var e=this._makeMouseEventArgs(t);this.application.dragleave(e),e=null,t.target.classList.contains("dropzone")&&t.target.classList.remove("dragover")}},{key:"parentDrop",value:function(t){var e=this._makeMouseEventArgs(t);e.dataTransfer=t.dataTransfer,this.application.drop(e),e=null,t.preventDefault(),t.target.classList.contains("dropzone")&&t.target.classList.remove("dragover")}},{key:"parentLoad_",value:function(t){this._loaded=!0,t.preventDefault()}},{key:"parentDocVisibilitychange_",value:function(t){this._parentElement.hidden?this._deactivate():this._activate(),t.preventDefault()}},{key:"parentDocCopy_",value:function(t){this._focus&&(this._copy(t),t.preventDefault())}},{key:"parentDocCut_",value:function(t){this._focus&&(this._cut(t),t.preventDefault())}},{key:"parentDocPaste_",value:function(t){this._focus&&(this._paste(t),t.preventDefault())}},{key:"dispose",value:function(){this._removeBindEvent(),null!=this._parentElement&&(this.ime.__hclUnLoaded(this),this._parentElement.removeChild(this._hclH5Canvas)),this.application.dispose(),this.ime=null,this.system=null,this.clipboard=null,this.localStorage.clear(),this.localStorage=null,this.theme=null}},{key:"_windowToCanvas",value:function(t,e,i){var n=t.getBoundingClientRect();return{x:(e-n.left)*(t.width/n.width)/this._scale,y:(i-n.top)*(t.height/n.height)/this._scale}}},{key:"_getAdjustLeft",value:function(){var t=Math.trunc((this._getViewPortWidth()-this.width_)/2);return this._loaded&&t<this._parentElement.clientLeft&&(t=this._parentElement.clientLeft),0}},{key:"_getViewPortWidth",value:function(){return null!=this._parentElement&&this._parentElement!=document.body?this._parentElement.clientWidth:document.documentElement.clientWidth||document.body.clientWidth}},{key:"_getViewPortHeight",value:function(){return null!=this._parentElement&&this._parentElement!=document.body?this._parentElement.clientHeight:document.documentElement.clientHeight||document.body.clientHeight}},{key:"applicationRun",value:function(){this.theme.initResources(),this._parentElement||(this.parentElement=document.body),this.resize()}},{key:"getDprScale",value:function(){var t=1,e=window.screen,i=navigator.userAgent.toLowerCase();return void 0!==window.devicePixelRatio?t=window.devicePixelRatio:~i.indexOf("msie")?e.deviceXDPI&&e.logicalXDPI&&(t=e.deviceXDPI/e.logicalXDPI):void 0!==window.outerWidth&&void 0!==window.innerWidth&&(t=window.outerWidth/window.innerWidth),t=Math.round(100*t)/100}},{key:"resize",value:function(){if(this._parentElement){this.beginUpdate();try{this._autoWidth?(this.left_=0,this.width_=this._getViewPortWidth()):this._horizontalCenter&&(this.left_=this._getAdjustLeft()),this._autoHeight&&(this.height_=this._getViewPortHeight()),this._hclH5Canvas.style.left!=this.left_+"px"&&(this._hclH5Canvas.style.left=this.left_+"px"),this._waitList.rect.right=this.width_,this.canvasTemp_.width=Math.max(this.width_,this.canvasMinWidth),this.canvasTemp_.height=Math.max(this.height_,this.canvasMinWidth),this.hclCanvasTemp.prepareConext(1,1),this._hclH5Canvas.style.width=this.width_+"px",this._hclH5Canvas.style.height=this.height_+"px";var t=this.getDprScale();this.dprScale!==t&&(this.dprScale=t,this.broadcast(hi,t)),this._hclH5Canvas.width=Math.floor(this.width_*this.dprScale),this._hclH5Canvas.height=Math.floor(this.height_*this.dprScale),this._hclCanvas.prepareConext(this._scale,1),this._appH5Canvas.style.width=this.width_+"px",this._appH5Canvas.style.height=this.height_+"px",this._appH5Canvas.width=Math.floor(this.width_*this.dprScale),this._appH5Canvas.height=Math.floor(this.height_*this.dprScale),this._appCanvas.prepareConext(this._scale,this.dprScale),this._popupH5Canvas.style.width=this.width_+"px",this._popupH5Canvas.style.height=this.height_+"px",this._popupH5Canvas.width=Math.floor(this.width_*this.dprScale),this._popupH5Canvas.height=Math.floor(this.height_*this.dprScale),this._popupCanvas.prepareConext(this._scale,this.dprScale),null!==this.application&&this.application._resize_()}finally{this.endUpdate()}}}},{key:"_paintWaitList",value:function(){if(this._waitList.count>0){this._hclCanvas.font.name=L.DefaultFont,this._hclCanvas.font.size=Math.floor(12*this.dprScale),this._hclCanvas.font.color="white",this._hclCanvas.brush.color="black";var t=this._hclCanvas.alpha;this._hclCanvas.alpha=.6,this._hclCanvas.fillRect(this._waitList.rect.scale(this.dprScale,!0)),this._hclCanvas.alpha=t,this._hclCanvas.textOut(2,2,"["+this._waitList.count.toString()+"] "+this._waitList.last.text)}}},{key:"_paintApplicationLayer",value:function(t){this._appCanvas.save();try{this._appCanvas.clearRect(t),this._appCanvas.clipRect(t),this.application.paint(this._appCanvas)}finally{this._appCanvas.restore()}}},{key:"_paintPopupLayer",value:function(t){if(0!==this._popupLayer.count){this._popupCanvas.clearRect(t);for(var e=null,i=null,n=0;n<this._popupLayer.count;n++){e=this._popupLayer[n];for(var o=0;o<e.count;o++){i=e[o],this._popupCanvas.save();try{this._popupCanvas.translate(i.left,i.top),i.paint(this._popupCanvas)}finally{this._popupCanvas.restore()}}}}}},{key:"_paintHintLayer",value:function(){this._hoverHintInfo.visible&&this.theme.drawHoverHint(this._hclCanvas,this._hoverHintInfo,this.dprScale)}},{key:"_paint",value:function(t){if((!this._parentElement||!this._parentElement.hidden&&"none"!==this._parentElement.style.display)&&0!==this.width&&0!==this.height){var e=t.scale(this.dprScale,!0);if(null!==this.application&&this.application.runing){this._hclCanvas.save();try{this.brower===Rd&&e.reset(0,0,Math.ceil(this.width_*this.dprScale),Math.ceil(this.height_*this.dprScale)),this._hclCanvas.clearRect(e),e.right=Math.ceil(e.right*this._scale),e.bottom=Math.ceil(e.bottom,this._scale),this._hclCanvas.clipRect(e),this._paintApplicationLayer(t),this.design_&&(this._appCanvas.pen.color="blue",this._appCanvas.rectangleRect(t)),this._hclCanvas.bitBltRect(e,this._appCanvas,e),this._popupLayer.count>0&&(this._paintPopupLayer(t),this.design_&&(this._popupCanvas.pen.color="yellow",this._popupCanvas.rectangleRect(t)),this._hclCanvas.bitBltRect(e,this._popupCanvas,e)),this.design_&&(this._hclCanvas.pen.color="red",this._hclCanvas.rectangleRect(e)),this._caret.visible&&this._caret.shan&&t.isIntersect(this._caret.rect)&&this._paintCaretShan(),this._paintHintLayer(),this._paintWaitList()}finally{this._hclCanvas.restore()}}else this._paintWaitList()}}},{key:"_deactivate",value:function(){this._cursorControl=null}},{key:"_activate",value:function(){this.update()}},{key:"_makeMouseEventArgs",value:function(t){var e=this._windowToCanvas(this._hclH5Canvas,t.clientX,t.clientY),i=new fi;return t.ctrlKey&&i.shiftState.add(re),t.altKey&&i.shiftState.add(se),t.shiftKey&&i.shiftState.add(oe),0===t.buttons?1==t.button?i.button=ae:4===t.button?i.button=he:2===t.button&&(i.button=le):1===t.buttons?i.button=ae:4===t.buttons?i.button=he:2===t.buttons&&(i.button=le),i.x=Math.floor(e.x/this.dprScale),i.y=Math.floor(e.y/this.dprScale),t.wheelDelta?i.delta=t.wheelDelta:i.delta=40*-t.detail,i.clicks=t.detail,i}},{key:"_mouseEnter",value:function(t){var e=this._makeMouseEventArgs(t);this.application.mouseEnter(e),e=null}},{key:"_mouseLeave",value:function(t){var e=this._makeMouseEventArgs(t);this.application.mouseLeave(e),e=null}},{key:"_mouseWheel",value:function(t){this._cancelIdle();var e=this._makeMouseEventArgs(t);this._popupMouseWheel(e)||(this.application.mouseWheel(e),this._mouseMove(e)),e=null}},{key:"_mouseDown",value:function(t){this._cancelIdle(),this._waitListMouseDown(t)||(this._popupMouseDown(t)?this._captureLayer=this._popupLayer:(this.application.mouseDown(t),this._captureLayer=this._applicationLayer))}},{key:"_mouseMove",value:function(t){this._cancelIdle(),this._cursorPos.reset(t.x,t.y),this._waitListMouseMove(t)||(this._captureLayer!=this._popupLayer?this._popupMouseMove(t)?this._mouseMoveLayer!=this._popupLayer&&(this._mouseMoveLayer=this._popupLayer,this.application.mouseLeave(t),this._setCursorBy_(this._mouseMovePopupControl)):(this._mouseMoveLayer!=this._applicationLayer&&(this._mouseMoveLayer=this._applicationLayer,this.application.mouseEnter(t)),this.application.mouseMove(t)):this._popupMouseMove(t))}},{key:"_mouseUp",value:function(t){if(!this._waitListMouseUp(t))try{this._captureLayer===this._popupLayer?this._popupMouseUp(t):this.application.mouseUp(t)}finally{this._captureLayer=null}}},{key:"_dblClick",value:function(t){this.application.dblClick(t)}},{key:"_makeKeyEventArgs",value:function(t){var e=new di;return t.ctrlKey&&e.shiftState.add(re),t.altKey&&e.shiftState.add(se),t.shiftKey&&e.shiftState.add(oe),e.keyCode=t.keyCode,e.key=t.key,e}},{key:"_clearKeyState",value:function(){for(var t=0,e=this.keyDownStates.length;t<e;t++)this.keyDownStates[t]=!1}},{key:"_setKeyState",value:function(t,e,i){switch(this.keyDownStates[t]=i,e){case"ControlLeft":this.keyDownStates[oi]=i,this.keyDownStates[He]=i;break;case"ControlRight":this.keyDownStates[si]=i,this.keyDownStates[He]=i;break;case"ShiftLeft":this.keyDownStates[ii]=i,this.keyDownStates[Ge]=i;break;case"ShiftRight":this.keyDownStates[ni]=i,this.keyDownStates[Ge]=i;break;case"AltLeft":this.keyDownStates[ri]=i,this.keyDownStates[Ve]=i;break;case"AltRight":this.keyDownStates[ai]=i,this.keyDownStates[Ve]=i}}},{key:"_keyDown",value:function(t){this._cancelIdle(),this._isPreventKeyDown(t.keyCode)&&t.preventDefault();var e=this._makeKeyEventArgs(t);this._setKeyState(t.keyCode,t.code,!0),this._popupKeyDown(e)||this.application.keyDown(e),0===e.keyCode&&t.preventDefault()}},{key:"_keyPress",value:function(t){this._cancelIdle();var e=this._makeKeyEventArgs(t);(t.target!==this.ime._input||this.ime._input.readOnly||this.ime._input.disabled)&&(this._popupKeyPress(e)||this.application.keyPress(e),0===e.keyCode&&t.preventDefault())}},{key:"_keyUp",value:function(t){var e=this._makeKeyEventArgs(t);this._setKeyState(t.keyCode,t.code,!1),this.application.keyUp(e),0===e.keyCode&&t.preventDefault()}},{key:"_copy",value:function(t){this.application.copy(t)}},{key:"_cut",value:function(t){this.application.cut(t)}},{key:"_paste",value:function(t){this.application.paste(t)}},{key:"_touchStart",value:function(t){var e=this;this._cancelIdle(),this._touchPt=this._windowToCanvas(this._hclH5Canvas,t.touches[0].clientX,t.touches[0].clientY);var i=new fi;1===t.touches.length?i.button=ae:i.button=le,i.x=this._touchPt.x,i.y=this._touchPt.y,i.touches=t.touches,this._waitListMouseDown(i)||(this._popupMouseDown(i)?this._captureLayer=this._popupLayer:(this.application.mouseDown(i),this._captureLayer=this._applicationLayer),this._touchLong=!1,this._touchTimer=0,this._touchTimer=setTimeout((function(){e._touchTimer=0,e._touchLong=!0}),380))}},{key:"_touchMove",value:function(t){clearTimeout(this._touchTimer),this._touchTimer=0,this._touchLong=!1}},{key:"_touchEnd",value:function(t){this._touchTimer&&(clearTimeout(this._touchTimer),this._touchTimer=0);var e=new fi;if(t.touches.length>0&&this._touchLong?e.button=le:e.button=ae,e.x=this._touchPt.x,e.y=this._touchPt.y,e.touches=t.touches,!this._waitListMouseUp(e))try{this._captureLayer==this._popupLayer?this._popupMouseUp(e):this.application.mouseUp(e)}finally{this._captureLayer=null}}},{key:"getLangItem",value:function(t){var e=this.langs[this.langIndex][t];return e||""}},{key:"langText",value:function(t){var e=this.appLangs[this.langIndex][t];return e||""}},{key:"handleAllocate",value:function(){return++this._handleSeq}},{key:"beginUpdate",value:function(){this._updateCount++}},{key:"endUpdate",value:function(){this._updateCount>0&&(this._updateCount--,0==this._updateCount&&this.update())}},{key:"update",value:function(){this._updateCount>0||this._paint(nt.CreateByBounds(0,0,this.width_,this.height_))}},{key:"updateRect",value:function(t){this._updateCount>0||(this.brower===bd?this._paint(t):this._paint(t.inFlate(this.theme.shadow,this.theme.shadow,!0)))}},{key:"showMessage",value:function(t){new Gh(this,"提示",t).showModal()}},{key:"messageDlg",value:function(t,e,i,n){new Gh(this,"提示",t,i,e).showModal(n)}},{key:"waitMessage",value:function(t,e){var i=new Bd(t);return this._waitList.add(i),setTimeout(e,0),i}},{key:"endWaitMessage",value:function(t){this._waitList.remove(t)}},{key:"broadcast",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.application.broadcast(t,e,i)}},{key:"exception",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];throw this.errorLog(t,e),"HCL异常:"+t}},{key:"log",value:function(t){console.log(t)}},{key:"debugLog",value:function(t){this.debug&&console.log("%chcl_debug："+t,"color:#ff6600;")}},{key:"warnLog",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e?console.trace(new Error("HCL警告："+t).stack):console.log("%cHCL警告："+t,"color:#ff6600;")}},{key:"errorLog",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e?console.error(new Error("HCL错误："+t).stack):console.error(t)}},{key:"falseReason",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?console.trace(t):console.log(t),!1}},{key:"textWidth",value:function(t,e){return null!=t?this.hclCanvasTemp.font.assign(t):this.hclCanvasTemp.font.assign(this.defaultFont),L.Round(this.hclCanvasTemp.textWidth(e))}},{key:"getTextExtent",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.hclCanvasTemp.font.assign(t),this.hclCanvasTemp.getTextExtent(e,i)}},{key:"getTextExtentExPoint",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.hclCanvasTemp.font.assign(t),this.hclCanvasTemp.getTextExtentExPoint(e,i)}},{key:"pointInPathAt",value:function(t,e,i){this.contextTemp.beginPath(),this.contextTemp.moveTo(t[0].x,t[0].y);for(var n=1;n<t.length;n++)this.contextTemp.lineTo(t[n].x,t[n].y);return this.contextTemp.closePath(),this.contextTemp.isPointInPath(e,i)}},{key:"pointInPath",value:function(t,e){return this.pointInPathAt(t,e.x,e.y)}},{key:"pointInEllipseBounds",value:function(t,e,i,n,o,s){this.contextTemp.beginPath();var r=Math.trunc(i/2),a=Math.trunc(n/2);return this.contextTemp.ellipse(t+r,e+a,r,a,0,0,2*Math.PI),this.contextTemp.closePath(),this.contextTemp.isPointInPath(o,s)}},{key:"pointInEllipse",value:function(t,e,i,n,o,s){return this.pointInEllipseBounds(t,e,i-t,n-e,o,s)}},{key:"pointInEllipseRect",value:function(t,e,i){return this.pointInEllipseBounds(t.left,t.top,t.width,t.height,e,i)}},{key:"colorToRGBA",value:function(t){0!==this.canvasTemp_.width&&0!==this.canvasTemp_.height||(0===this.canvasTemp_.width&&(this.canvasTemp_.width=this.canvasMinWidth),0===this.canvasTemp_.height&&(this.canvasTemp_.height=this.canvasMinWidth),this.hclCanvasTemp.prepareConext(1,1)),this.contextTemp.clearRect(1,1,1,1),this.hclCanvasTemp.brush.color=t,this.hclCanvasTemp.fillBounds(1,1,1,1);var e=this.contextTemp.getImageData(1,1,1,1);return 0===e.data[3]?{r:255,g:255,b:255,a:0}:{r:e.data[0],g:e.data[1],b:e.data[2],a:e.data[3]}}},{key:"colorToRGB",value:function(t){var e=this.colorToRGBA(t);return e.a=e.a/255,{r:L.Round(255*(1-e.a)+e.r*e.a),g:L.Round(255*(1-e.a)+e.g*e.a),b:L.Round(255*(1-e.a)+e.b*e.a)}}},{key:"rgbaToColor",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return"rgba("+t.toString()+", "+e.toString()+", "+i.toString()+", "+n.toString()+")"}},{key:"getColorPad",value:function(t){if(null!==this.colorPadData)return this.colorPadData;var e=t+t;this.canvasTemp_.width<e&&(this.canvasTemp_.width=e),this.canvasTemp_.height<e&&(this.canvasTemp_.height=e),this.contextTemp.clearRect(0,0,e,e);var i=255,n=0,o=0,s=this.rgbaToColor(i,n,o);this.hclCanvasTemp.brush.color=s;var r,a,l,h,c=e+1,u=t+1,f=nt.Create(e,t,c,u);this.hclCanvasTemp.fillRect(f);for(var d=0;d<=e;d++){a=(r=(e-d)*Math.PI+1)/6,l=1530/r;for(var m=0;m<=r;m++)h=360/r*m,c=Math.cos(h*Math.PI/180)*(e-d+1)/2+t,u=Math.sin(h*Math.PI/180)*(e-d+1)/2+t,h>0&&h<=60&&(i=255,n=0,o=l*m),h>60&&h<=120&&(i=r/3/120*(h-60)>1?255-l*(m-a):255-l*Math.abs(m-a),n=0,o=255),h>120&&h<=180&&(i=0,n=r/3/120*(h-120)>1?l*(m-2*a):l*Math.abs(m-2*a),o=255),h>180&&h<=240&&(i=0,n=255,o=r/3/120*(h-120)>1?255-l*(m-r/2):255-l*Math.abs(m-r/2)),h>240&&h<=300&&(i=r/3/120*(h-240)>1?l*(m-4*a):l*Math.abs(m-4*a),n=255,o=0),h>300&&h<=360&&(i=255,n=r/3/120*(h-300)>1?255-l*(m-5*a):255-l*Math.abs(m-5*a),o=0),s=this.rgbaToColor(L.Round(i+(255-i)/e*d),L.Round(n+(255-n)/e*d),L.Round(o+(255-o)/e*d)),this.hclCanvasTemp.brush.color=s,h>=0&&h<=45&&(f.reset(c,u,c-2,u-1),this.hclCanvasTemp.fillRect(f)),h>45&&h<=135&&(f.reset(c,u,c-1,u-2),this.hclCanvasTemp.fillRect(f)),h>135&&h<=225&&(f.reset(c,u,c+2,u+1),this.hclCanvasTemp.fillRect(f)),h>215&&h<=315&&(f.reset(c,u,c+1,u+2),this.hclCanvasTemp.fillRect(f)),h>315&&h<=360&&(f.reset(c,u,c-2,u-1),this.hclCanvasTemp.fillRect(f))}return this.colorPadData=this.contextTemp.getImageData(0,0,e,e),this.colorPadData}},{key:"sameColor",value:function(t,e){if(t===e)return!0;var i=this.colorToRGBA(t),n=this.colorToRGBA(e);return i.r===n.r&&i.g===n.g&&i.b===n.b&&i.a===n.a}},{key:"hasFont",value:function(t){if("string"!=typeof t)return!1;if(t.toLowerCase()=="Arial".toLowerCase())return!0;(this.canvasTemp_.width<this.canvasMinWidth||this.canvasTemp_.height<this.canvasMinWidth)&&(this.canvasTemp_.width<this.canvasMinWidth&&(this.canvasTemp_.width=this.canvasMinWidth),this.canvasTemp_.height<this.canvasMinWidth&&(this.canvasTemp_.height=this.canvasMinWidth),this.hclCanvasTemp.prepareConext(1,1));var e=function(t,e){t.contextTemp.clearRect(0,0,32,32),t.contextTemp.font="20px "+e+", Arial",t.contextTemp.fillText("a",16,16);var i=t.contextTemp.getImageData(0,0,32,32).data;return[].slice.call(i).filter((function(t){return 0!=t}))};return e(this,"Arial").join("")!==e(this,t).join("")}},{key:"parentElement",get:function(){return this._parentElement},set:function(t){t&&this._parentElement!=t&&(this._parentElement=t,this.instanceID=this.system.Timestamp,this._hclH5Canvas=document.createElement("canvas"),this._hclH5Canvas.setAttribute("id","hclH5canvas_"+this.instanceID),this._hclH5Canvas.width=this.width_,this._hclH5Canvas.height=this.height_,this._hclH5Canvas.style.position="absolute",this._hclH5Canvas.style.left=this.left_+"px",this._hclH5Canvas.style.top="0px",this._hclH5Canvas.style.imeMode="active",this._hclH5Canvas.tabIndex="-1",this._hclH5Canvas.style.outline="none",this._hclCanvas=new zt(this,this._hclH5Canvas.getContext("2d")),this._appH5Canvas=document.createElement("canvas"),this._appCanvas=new zt(this,this._appH5Canvas.getContext("2d")),this._popupH5Canvas=document.createElement("canvas"),this._popupCanvas=new zt(this,this._popupH5Canvas.getContext("2d")),t.appendChild(this._hclH5Canvas),this.resize(),this._initBindEvent())}},{key:"autoWidth",get:function(){return this._autoWidth},set:function(t){this._autoWidth!=t&&(this._autoWidth=t,this.resize())}},{key:"autoHeight",get:function(){return this._autoHeight},set:function(t){this._autoHeight!=t&&(this._autoHeight=t,this.resize())}},{key:"design",get:function(){return this.design_},set:function(t){this.design_!=t&&(this.design_=t,this.broadcast(li,t),this.update())}},{key:"left",get:function(){return this.left_}},{key:"top",get:function(){return this.top_}},{key:"width",get:function(){return this.width_}},{key:"height",get:function(){return this.height_}},{key:"cursorPos",get:function(){return this._cursorPos}},{key:"cursor",get:function(){return this._cursor}},{key:"homePath",get:function(){return this.theme.path},set:function(t){this.theme.path=t}},{key:"application",get:function(){return this._curApplication||(this._curApplication=new Ad(this)),this._curApplication}},{key:"onCatch",value:function(t){}}]),t}(),_d=function(){function t(e){var i=this;r()(this,t),this.VerSub=407,this.VerPatch="",this.Version="1.68."+this.VerSub+this.VerPatch,this.License="",this.Org="",this.Comp="",this.Prgm="",this.RunNo="",this.OnViewMenuPopup=null,this.OnBtnMenuPopup=null,this.OnPrintPdf=null,this.THCStream=ht,this.THCDateTime=lt,this.THCStyle=oo,this.TDeProp=Yh,this.TGroupProp=bc,this.THCContentAlign=ih,this.TSectionArea=ql,this.THCSectionArea=ql,this.THCFontStyle=Wn,this.THCBrushStyle=Mt,this.THCBorderSide=Zl,this.THCPenStyle=_t,this.TParaLineSpaceMode=Hn,this.TParaAlignHorz=Ln,this.THCParaAlignVert=Gn,this.THCLayout=nh,this.THCDomainNode=zs,this.THCTextHorAlign=as,this.TDataFormat=ru,this.THCViewModel=fo,this.TDeTraceStyle=jh,this.THCMarkType=ch,this.TOutOfRangStyle=lf,this.THCDeFrmtp=Zh,this.THCPaperKind=t.THCConst.PaperKind,this.THCInputStyle=Tn,this.THCAction=rh,this.THCViewHorAlign=Su,this.THCTextVerAlign=ls,this.THCUnitConversion=En,this.TEMR=mh,e.hclDefaultFontFamily&&(L.DefaultFont=e.hclDefaultFontFamily),this.hcl=new Od,e.lang>0&&(this.hcl.langIndex=e.lang),this.InitAppLangs(),e.embResources?this.hcl.embResources=e.embResources:this.hcl.embResources=!1,this.hcl.emrCommon=new Sh(this.hcl),this.hcl.emrCommon.Version=this.Version,e.baseUrl?(this.hcl.homePath=e.baseUrl,this.hcl.emrCommon.homePath=e.baseUrl):(this.hcl.homePath="./",this.hcl.emrCommon.homePath="./"),this.hcl.application.icon.src=this.hcl.emrCommon.ResIcon,this.hcl.wasminit=!1,this.hcl.meaChr=this.useMeaChar(),!this.hcl.meaChr&&e.meaChr&&(this.hcl.meaChr=!0),this.hcl.meaChr?this.hcl.localStorage.hasKey("hcf")?this.hcl.localStorage.hcf=JSON.parse(this.hcl.localStorage.getString("hcf")):(this.hcl.localStorage.setString("hcf",JSON.stringify({})),this.hcl.localStorage.hcf={}):(this.hcl.localStorage.hasKey("hcf")||this.hcl.localStorage.setString("hcf",JSON.stringify({})),this.hcl.localStorage.hcf=JSON.parse(this.hcl.localStorage.getString("hcf"))),null!=e.debug&&(this.hcl.debug=e.debug),e.hcLicense&&(this.License=e.hcLicense),e.hcOrg&&(this.Org=e.hcOrg),e.dateFormatDef?this.hcl.emrCommon.dateFormatDef=e.dateFormatDef:this.hcl.emrCommon.dateFormatDef="yyyy-MM-dd",e.timeFormatDef?this.hcl.emrCommon.timeFormatDef=e.timeFormatDef:this.hcl.emrCommon.timeFormatDef="hh:mm",e.disPopupDateTimeFormat&&(this.hcl.emrCommon.disPopupDateTimeFormat=e.disPopupDateTimeFormat),null!=e.toHtmlUseTrace&&(this.hcl.emrCommon.ToHtmlUseTrace=e.toHtmlUseTrace),e.hcServer&&(this.HCServer=e.hcServer),this.PrintParam=new gf,null!=e.printAsImage&&(this.PrintParam.PrintAsImage=e.printAsImage),null!=e.printerServer&&(this.PrintParam.PrinterServer=e.printerServer),null!=e.printerName&&(this.PrintParam.PrinterName=e.printerName),this.hcl.hc=new Yl,null!=e.checkNullItem&&(this.hcl.hc.CHECKNULLITEM=e.checkNullItem),null!=e.useScript&&(this.hcl.hc.USESCRIPT=e.useScript),e.useSaveItemEvent&&(this.hcl.hc.USESAVEITEMEVENT=e.useSaveItemEvent),e.domainPaintEvent&&(this.hcl.hc.DOMAINPAINTEVENT=e.domainPaintEvent),e.paintTextEvent&&(this.hcl.hc.PAINTTEXTEVENT=e.paintTextEvent),this.SetParentElement(e.el);var n=!0;null!=e.useContextMenu&&(n=e.useContextMenu);var o=!0;null!=e.useToolBar&&(o=e.useToolBar),this.FFrmRecord=new yd(this.hcl,this.hcl.width,this.hcl.height,o,n),this.FFrmRecord.PrintParam=this.PrintParam;var s=new gn(this.hcl);this.FFrmRecord.EmrView.btnInfo.popupMenu=s,s.addItem("命令行").onClick=function(){i.ShowCommand()},s.addItem("官方网站").onClick=function(){window.open("http://hcview.cn/")},s.addItem("在线帮助").onClick=function(){window.open("http://hcview.cn:7240/help")},e.toolBar&&this.SetToolBar(e.toolBar),n&&e.contextMenu&&this.AddContextMenu(e.contextMenu),this.FFrmRecord.EmrView.customVersion=this.VerSub,this.FFrmRecord.EmrView.ShowCopyRight=function(){i.hcl.showMessage("hcl标识："+i.hcl.instanceID+"\r\n程序版本："+i.Version+"\r\n文件版本："+Yl.HC_FileVersion+"\r\n授权信息："+i.FrmRecord.EmrView.copyRight+"\r\n技术交流QQ群：649023932")},null!=e.promptFont&&(null!=e.promptFont.color&&(this.FrmRecord.EmrView.Style.PromptFontColor=e.promptFont.color),null!=e.promptFont.styles&&(this.FrmRecord.EmrView.Style.PromptFontStyles.value=e.promptFont.styles)),this.FrmRecord.OnBtnMenuPopup=function(t,e){i.DoBtnMenuPopup(t,e)},this.FrmRecord.OnViewMenuPopup=function(t,e,n){i.doViewMenuPopup(t,e,n)},this.FFrmRecord.OnExportXML=function(t){i.doExportXML(t)},this.FFrmRecord.OnExportHTML=function(t){i.doExportHTML(t)},this.FFrmRecord.OnExportTXT=function(t){i.doExportTXT(t)},this.FFrmRecord.OnExportPDF=function(t){i.doExportPDF(t)},this.FFrmRecord.OnImportXML=function(t){i.doImportXML(t)},this.FFrmRecord.OnImportTXT=function(t){i.doImportTXT(t)},this.FFrmRecord.OnLoadDocxFile=function(t){i.LoadDocxFile({file:t})},this.FFrmRecord.OnPrint=function(t){null!=i.OnPrintProcess?i.OnPrintProcess(0,(function(){i.doPrint(t)}),t.PrintProcIndex):i.doPrint(t)},this.FFrmRecord.OnPrintCurPage=function(t){null!=i.OnPrintProcess?i.OnPrintProcess(0,(function(){i.doPrintCurPage(t)}),t.PrintProcIndex):i.doPrintCurPage(t)},this.FFrmRecord.OnPrintPageRange=function(t){null!=i.OnPrintProcess?i.OnPrintProcess(0,(function(){i.doPrintPageRange(t)}),t.PrintProcIndex):i.doPrintPageRange(t)},this.FFrmRecord.OnPrintOdd=function(t,e){null!=i.OnPrintProcess?i.OnPrintProcess(0,(function(){i.doPrintOdd(t,e)}),t.PrintProcIndex):i.doPrintOdd(t,e)},this.FFrmRecord.OnPrintEven=function(t,e){null!=i.OnPrintProcess?i.OnPrintProcess(0,(function(){i.doPrintEvent(t,e)}),t.PrintProcIndex):i.doPrintEvent(t,e)},this.FFrmRecord.OnPrintCurLine=function(t,e){null!=i.OnPrintProcess?i.OnPrintProcess(1,(function(){i.doPrintCurLine(t,e)}),t.PrintProcIndex):i.doPrintCurLine(t,e)},this.FFrmRecord.OnPrintSelect=function(t){null!=i.OnPrintProcess?i.OnPrintProcess(2,(function(){i.doPrintSelect(t)}),t.PrintProcIndex):i.doPrintSelect(t)},this.FFrmRecord.OnSetPrintStartLine=function(t,e){i.SetPrintStartLine(t,e)},this.FFrmRecord.OnSetPrintEndLine=function(t,e){i.SetPrintEndLine(t,e)},this.FFrmRecord.OnPrintLineRange=function(t,e){i.PrintLineRange(t,e)},this.FFrmRecord.OnEmrViewKeyDown=function(t){i.OnEmrViewKeyDown&&i.OnEmrViewKeyDown(t)},this.FFrmRecord.onKeyDown=function(t){t.keyCode===$e&&i.hcl.keyDownStates[He]&&i.hcl.keyDownStates[Ge]&&i.ShowCommand(),i.FFrmRecord.cbxCmd&&i.FFrmRecord.cbxCmd.focused||i.OnKeyDown&&i.OnKeyDown(t)},this.FFrmRecord.EmrView.OnStyleLoaded=function(t,e){for(var n=null,o=0;o<t.TextStyles.count;o++)(n=t.TextStyles[o]).meaChar=i.hcl.meaChr||Rt.getFontIndex(n.Family)<1,n.meaChar&&null==i.hcl.localStorage.hcf[Nt.getMeasureName(n.Family,n.Size,n.FontStyles.value)]&&i.getMeasure(n.Family,n.Size,n.FontStyles.value),Rt.getFontIndex(n.Family)<1&&(e>56?i.getTextMetrics(n.Family,n.Size,n.FontStyles.value):console.log("无效的字体："+n.Family))},this.FFrmRecord.EmrView.OnSectionPaintPageAfter=function(t,e,n,o,s){if(!(s.Print||(i.PrintParam.MarkPageIndex>=0&&i.PrintParam.MarkPageIndex===e&&i.FFrmRecord.FEmrView.FSections.indexOf(t)===i.PrintParam.MarkSectionIndex&&(""!==i.PrintParam.MarkText&&(o.brush.color="#d8e8f5",o.fillBounds(n.left-61,n.top+i.PrintParam.MarkTop+i.PrintParam.MarkHeight-20,60,20),o.font.size=10,o.font.name=L.DefaultFont,o.font.styles.clear(),o.font.color="#15428b",o.textOut(n.left-56,n.top+i.PrintParam.MarkTop+i.PrintParam.MarkHeight-17,i.PrintParam.MarkText)),o.pen.color="#ff0000",o.beginPath(),i.PrintParam.MarkEnd?(o.moveTo(n.left-61,n.top+i.PrintParam.MarkTop+i.PrintParam.MarkHeight),o.lineTo(n.right,n.top+i.PrintParam.MarkTop+i.PrintParam.MarkHeight)):(o.moveTo(n.left-61,n.top+i.PrintParam.MarkTop),o.lineTo(n.right,n.top+i.PrintParam.MarkTop)),o.paintPath()),i.PrintParam.StartPageIndex<0))){var r=i.FFrmRecord.EmrView.GetPageIndexBySectionPageIndex(i.FFrmRecord.FEmrView.FSections.indexOf(t),e);i.PrintParam.StartPageIndex===r&&(o.brush.color="#d8e8f5",o.fillBounds(n.left-61,n.top+i.PrintParam.StartTop,60,20),o.font.size=10,o.font.name=L.DefaultFont,o.font.styles.clear(),o.font.color="#15428b",o.textOut(n.left-56,n.top+i.PrintParam.StartTop+3,"区间起始"),o.pen.color="#008000",o.beginPath(),o.moveTo(n.left-61,n.top+i.PrintParam.StartTop),o.lineTo(n.right,n.top+i.PrintParam.StartTop),o.paintPath()),i.PrintParam.EndPageIndex===r&&(o.brush.color="#d8e8f5",o.fillBounds(n.left-61,n.top+i.PrintParam.EndTop+i.PrintParam.EndHeight-20,60,20),o.font.size=10,o.font.name=L.DefaultFont,o.font.styles.clear(),o.font.color="#15428b",o.textOut(n.left-56,n.top+i.PrintParam.EndTop+i.PrintParam.EndHeight-17,"区间结束"),o.pen.color="#ff0000",o.beginPath(),o.moveTo(n.left-61,n.top+i.PrintParam.EndTop+i.PrintParam.EndHeight),o.lineTo(n.right,n.top+i.PrintParam.EndTop+i.PrintParam.EndHeight),o.paintPath())}},this.FFrmRecord.EmrView.OnInsertHtml=function(t){mt.post(i.FHCServer,{CMD:"1075",verSub:i.VerSub,data:J.getBytes(t)},(function(t){var e=JSON.parse(t);if(e.data.length>0){var n=new Uint8Array(e.data),o=new ht(n);i.FFrmRecord.EmrView.InsertLiteStream(o),o=null}else console.log("警告，插入的HTML数据大小为0！")}),(function(t){console.log("插入的HTML数据请求失败(status:"+t.status+")，请检查HCServer服务是否运行！")}))},this.FFrmRecord.EmrView.Style.FTextStyles.onAdded=function(t){t.meaChar=i.hcl.meaChr||Rt.getFontIndex(t.Family)<1,t.meaChar&&null==i.hcl.localStorage.hcf[Nt.getMeasureName(t.Family,t.Size,t.FontStyles.value)]&&i.getMeasure(t.Family,t.Size,t.FontStyles.value)},this.FFrmRecord.EmrView.OnClear=function(){i.ClearPrintRange(!0,!0)},e.designMode&&(this.FFrmRecord.EmrView.DesignModeEx=e.designMode),e.deUnDoneColor&&(this.FFrmRecord.EmrView.DeUnDoneColor=e.deUnDoneColor),e.deDoneColor&&(this.FFrmRecord.EmrView.DeDoneColor=e.deDoneColor),e.deHotColor&&(this.FFrmRecord.EmrView.DeHotColor=e.deHotColor),e.defaultFontSize&&this.FFrmRecord.SetDefaultTextSize(e.defaultFontSize),e.defaultFontFamily&&this.FFrmRecord.SetDefaultFontFamily(e.defaultFontFamily),this.FFrmRecord.EmrView.Style.Initialize(),null!=e.paraLastMark&&(this.FFrmRecord.EmrView.Style.ShowParaLastMark=e.paraLastMark),null!=e.multItemSpliter&&(this.hcl.emrCommon.MultItemSpliter=e.multItemSpliter),null!=e.multipleSingleBtn&&(this.hcl.emrCommon.MultipleSingleBtn=e.multipleSingleBtn),null!=e.customBtn&&(this.hcl.emrCommon.CustomBtn=e.customBtn),e.paperInfo?this.SetActiveSectionPaperInfo(e.paperInfo,!1):(e.paperSize&&this.SetPaperSize(e.paperSize),e.paperOrientation&&this.SetPaperOrientation(e.paperOrientation)),null!=e.useAnnotate&&(this.FFrmRecord.UseAnnotate=e.useAnnotate),null!=e.unAllocWarning&&(this.FFrmRecord.EmrView.UnAllocWarning=e.unAllocWarning),null!=e.showExportMenu&&(this.FFrmRecord.ShowExportMenu=e.showExportMenu),null!=e.showImportMenu&&(this.FFrmRecord.ShowImportMenu=e.showImportMenu),this.FFrmRecord.EmrView.ResetActiveSectionMargin(),null!=e.traceInfoAnnotate&&(this.FFrmRecord.EmrView.TraceInfoAnnotate=e.traceInfoAnnotate),null!=e.deMutexCheckState&&(this.FFrmRecord.DeMutexCheckState=e.deMutexCheckState),null!=e.domainPopupGridItemColWidth&&(this.hcl.emrCommon.domainPopupGridItemColWidth=e.domainPopupGridItemColWidth),null!=e.domainDlg&&(this.hcl.emrCommon.domainDlg=e.domainDlg),null!=e.deGroupDeleteAllowDefaultLow59&&(this.hcl.deGroupDeleteAllowDefaultLow59=e.deGroupDeleteAllowDefaultLow59),null!=e.editProtectKeepPara&&(this.EditProtectKeepPara=e.editProtectKeepPara),e.event&&this.SetEvent(e.event),this.hcl.application.addForm(this.FFrmRecord),this.hcl.application.run(),this.hcl.autoWidth=!0,this.hcl.colorToRGBA("black"),e.event&&e.event.onInitialization&&e.event.onInitialization()}return l()(t,[{key:"InitAppLangs",value:function(){this.hcl.appLangs=[["只读","复制","粘贴","剪切","追加复制","粘贴为文本","段落","文档结构","重新选择","引用上文","引用为文本","带结构引用","隐藏","删除","属性","脚本","运行时禁止编辑","运行时禁止复制","保持段首","更新引用","重置","运行时允许编辑","运行时允许复制","取消保持段首","表格","上方插入行","下方插入行","空行","克隆当前行","左侧插入列","右侧插入列","合并","对齐方式","顶部居左","顶部居中","顶部居右","居中居左","居中居中","居中居右","底部居左","底部居中","底部居右","拆分行","拆分列","删除选中行","删除当前列","边框及背景","隐藏边框","显示边框","适应宽度","数据元","图片","医学公式","月经史","牙位(普通)","牙位(帕尔默)","房角","中药","孕周","瞳孔","光定位","胎心位","分数1","分数2","横线","控件","分页","分节","文档","条码","一维码","二维码","浮动对象","符号","打开","新建","另存为","导出","导入","文本","页面设置","删除当前节","文件","文档处理","保存","打印","全部","当前页","指定页码或范围","奇数页(顺序)","奇数页(倒序)","偶数页(顺序)","偶数页(倒序)","当前行->当前页","当前行->最后页","选中内容","自定义行区间","设置区间开始","打印区间","预览","撤销","恢复","加粗","倾斜","下划线","中划线","上标","下标","格式刷","左缩进","右缩进","居左","居中","居右","两端","分散","单倍","行间距","设为未解决","设为解决","新建答复","浮动一维码","浮动二维码","浮动直接","浮动图片","设置区间结束 ","清除区间"],["Read Only","Copy","Paste","Cut","Copy append","Paste as text","Paragraph","Document structure","Re select","Reference with previous","Reference as text","Structured reference","Hide","Delete","Attribute","Script","Prohibit editing at runtime","Prohibit copying at runtime","Maintain paragraph beginning","Update references","Reset","Allow editing at runtime","Allow replication at runtime","Cancel Keep Paragraph Beginning","Table","Insert row above","Insert row below","Empty row","Clone the current row","Left Insert Column","Insert column on the right","Merge","Alignment method","Top Left","Top Centered","Top Right","Center Left","Center Center","Center Right","Bottom Left","Bottom centered","Bottom Right","Dismantling branches","Split Column","Delete Selected Rows","Delete current column","Borders and background","Hide Borders","Show Borders","Adapt to width","Data Element","Picture","Medical formulas","Menstrual history","Teeth position (normal)","Teeth position (Palmer)","House corner","Traditional Chinese medicine","Gestational age","Pupil","Optical positioning","Fetal heart position","Fraction 1","Fraction 2","Horizontal line","Control","Paging","Segmentation","Document","Bar code","One-dimensional code","QR code","Floating object","Symbol","Open","New","Save as","Export","Import","Text","Page Settings","Delete current section","File","Document processing","Save","Print","All","Current page","Specify page number or range","Odd Page (Order)","Odd pages (reverse order)","Even numbered pages (in order)","Even numbered pages (reverse order)","Current row ->Current page","Current row ->Last page","Selected content","Custom range","Set range start","Print range","Preview","Revoke","Recovery","Bold","Italic","Underline","Strikethrough","Superscript","Subscript","Format brush","Left","Right","Be at the left side","Centered","Be at the right","Both ends","Disperse","Single fold","Row spacing","Set as unresolved","Set as a solution","New Reply","Floating one-dimensional code","Floating QR code","Floating Direct","Floating image","Set range end ","Clear range"]]}},{key:"ShowCommand",value:function(){this.FFrmRecord.ShowCommand(this)}},{key:"SetParentElement",value:function(t){var e=null;(e="string"==typeof t?document.getElementById(t):t)?this.hcl.parentElement=e:this.hcl.log("未找到参数的el对应的元素，将使用body为编辑器容器")}},{key:"SetPaperSize",value:function(t){var e=Yl.GetPaperSizeByName(t),i=Yl.GetPaperSizeInfo(e);this.FFrmRecord.EmrView.ActiveSection.PaperSize=e,this.FFrmRecord.EmrView.ActiveSection.PaperOrientation==Ql.Portrait?(this.FFrmRecord.EmrView.ActiveSection.PaperWidth=i.Width,this.FFrmRecord.EmrView.ActiveSection.PaperHeight=i.Height):(this.FFrmRecord.EmrView.ActiveSection.PaperWidth=i.Height,this.FFrmRecord.EmrView.ActiveSection.PaperHeight=i.Width)}},{key:"SetPaperOrientation",value:function(t){if(this.FFrmRecord.EmrView.ActiveSection.PaperOrientation!=t){this.FFrmRecord.EmrView.ActiveSection.PaperOrientation=t;var e=this.FFrmRecord.EmrView.ActiveSection.PaperWidth;this.FFrmRecord.EmrView.ActiveSection.PaperWidth=this.FFrmRecord.EmrView.ActiveSection.PaperHeight,this.FFrmRecord.EmrView.ActiveSection.PaperHeight=e}}},{key:"SetToolBar",value:function(t){return 0!==this.FFrmRecord.captionBar.controls.count&&(null!=t.height&&(this.FFrmRecord.captionBar.height=t.height),null!=t.btnFile&&(null==(e=t.btnFile).visible||e.visible||(this.FFrmRecord.btnFile.visible=!1),null!=t.btnFile.menu&&(e=t.btnFile.menu,this.doSetToolMenu(this.FFrmRecord.btnFile.dropDownMenu,e))),null!=t.btnSave&&(null==(e=t.btnSave).visible||e.visible||(this.FFrmRecord.btnSave.visible=!1)),null!=t.btnPrint&&(null==(e=t.btnPrint).visible||e.visible||(this.FFrmRecord.btnPrint.visible=!1)),null!=t.btnInsert&&(null==(e=t.btnInsert).visible||e.visible||(this.FFrmRecord.btnInsert.visible=!1),null!=t.btnInsert.menu&&(e=t.btnInsert.menu,this.doSetToolMenu(this.FFrmRecord.btnInsert.dropDownMenu,e))),null!=t.btnFormatBrush&&(this.FFrmRecord.btnFormatBrush.visible=t.btnFormatBrush),null!=t.btnCustoms&&this.AddToolButton(t.btnCustoms),null!=t.visible&&(this.FFrmRecord.ToolbarVisible=t.visible),!0);var e}},{key:"SetEvent",value:function(t){t.onCaretItemChanged&&(this.OnCaretItemChanged=t.onCaretItemChanged),t.onDomainSwitch&&(this.OnDomainSwitch=t.onDomainSwitch),t.onChangedSwitch&&(this.OnChangedSwitch=t.onChangedSwitch),t.onSave&&(this.OnSave=t.onSave),t.onExternalDeItemPopup&&(this.OnExternalDeItemPopup=t.onExternalDeItemPopup),t.onPopupGetDeItemInfo&&(this.OnPopupGetDeItemInfo=t.onPopupGetDeItemInfo),t.onPopupGetDeItemDomain&&(this.OnPopupGetDeItemDomain=t.onPopupGetDeItemDomain),t.onPopupGetDomainItemExtraLib&&(this.OnPopupGetDomainItemExtraLib=t.onPopupGetDomainItemExtraLib),t.onItemPopupSetClose&&(this.OnItemPopupSetClose=t.onItemPopupSetClose),t.onSectionInsertItem&&(this.OnSectionInsertItem=t.onSectionInsertItem),t.onInserItemSync&&(this.OnInserItemSync=t.onInserItemSync),t.onDeComboboxPopup&&(this.OnDeComboboxPopup=t.onDeComboboxPopup),t.onCanEdit&&(this.OnCanEdit=t.onCanEdit),t.onCanNotEditNotify&&(this.OnCanNotEditNotify=t.onCanNotEditNotify),t.onDeItemPopup&&(this.OnDeItemPopup=t.onDeItemPopup),t.onDeItemGetSyncValue&&(this.OnDeItemGetSyncValue=t.onDeItemGetSyncValue),t.onDrawTrace&&(this.OnDrawTrace=t.onDrawTrace),t.onEmrViewKeyDown&&(this.OnEmrViewKeyDown=t.onEmrViewKeyDown),t.onKeyDown&&(this.OnKeyDown=t.onKeyDown),t.onPrintProcess&&(this.OnPrintProcess=t.onPrintProcess),t.onPrinted&&(this.OnPrinted=t.onPrinted),t.onPrintPdf&&(this.OnPrintPdf=t.onPrintPdf),t.onMouseUp&&(this.OnMouseUp=t.onMouseUp),t.onPopupFormClose&&(this.OnPopupFormClose=t.onPopupFormClose),t.onChange&&(this.OnChange=t.onChange),t.onDblClick&&(this.OnDblClick=t.onDblClick),t.onViewMenuPopup&&(this.OnViewMenuPopup=t.onViewMenuPopup),t.onSetDeItemText&&(this.OnSetDeItemText=t.onSetDeItemText),t.onSaveItem&&(this.OnSaveItem=t.onSaveItem),t.onCopyBefor&&(this.OnCopyBefor=t.onCopyBefor),t.onCopyRequest&&(this.OnCopyRequest=t.onCopyRequest),t.onCopyAfter&&(this.OnCopyAfter=t.onCopyAfter),t.onCutAfter&&(this.OnCutAfter=t.onCutAfter),t.onPasteBefor&&(this.OnPasteBefor=t.onPasteBefor),t.onSyntaxCheck&&(this.OnSyntaxCheck=t.onSyntaxCheck),t.onSyntaxPaint&&(this.onSyntaxPaint=t.onSyntaxPaint),t.onSelectBound&&(this.OnSelectBound=t.onSelectBound),t.onScrollBarResize&&(this.OnScrollBarResize=t.onScrollBarResize),t.onCalcScrollRange&&(this.OnCalcScrollRange=t.onCalcScrollRange)}},{key:"useMeaChar",value:function(){var t=navigator.userAgent;if("Win32"==navigator.platform||"Windows"==navigator.platform){if(t.indexOf("Windows NT 5.0")>-1||t.indexOf("Windows 2000")>-1)return!1;if(t.indexOf("Windows NT 5.1")>-1||t.indexOf("Windows XP")>-1)return!1;if(t.indexOf("Windows NT 5.2")>-1||t.indexOf("Windows 2003")>-1)return!1;if(t.indexOf("Windows NT 6.0")>-1||t.indexOf("Windows Vista")>-1)return!1;if(t.indexOf("Windows NT 6.1")>-1||t.indexOf("Windows 7")>-1)return!1}return!0}},{key:"getMeasure",value:function(t,e,i){var n=this,o=Nt.getMeasureName(t,e,i);null==this.hcl.localStorage.hcf[o]&&mt.get(this.FHCServer,{CMD:"1070",verSub:this.VerSub,name:t,size:e,style:i},(function(t){var e=JSON.parse(t);e.err?alert(e.err):(n.hcl.localStorage.hcf[o]=e.arr,n.hcl.localStorage.setString("hcf",JSON.stringify(n.hcl.localStorage.hcf)))}),(function(t){console.log("getMeasure请求失败(status:"+t.status+")，请检查HCServer服务是否运行，当前将使用内部的处理，可能并不准确！")}),!1)}},{key:"getTextMetrics",value:function(t,e,i){var n=this;this.hcl.textMetricsIndexOf(t,e,i)>=0||mt.get(this.FHCServer,{CMD:"1071",verSub:this.VerSub,name:t,size:e,styles:i},(function(o){var s=JSON.parse(o);if(s.err)alert(s.err);else{var r={name:t,size:e,styles:i,trueType:s.trueType,CJK:s.CJK,advCharWidth:s.advCharWidth,height:s.height,ascent:s.ascent};n.hcl.textMetrics.add(r)}}),(function(t){console.log("getTextMetrics请求失败(status:"+t.status+")，请检查HCServer服务是否运行！")}),!1)}},{key:"doSetToolMenu",value:function(t,e){for(var i=null,n=0;n<e.length;n++)null!=(i=t.subItemByText(e[n].text))?i.visible=e[n].visible:this.AddMenuItem(e[n],t)}},{key:"doViewMenuPopup",value:function(t,e,i){this.OnViewMenuPopup&&this.OnViewMenuPopup(t,e,i)}},{key:"doImportXML",value:function(t){kh.execute(this.hcl,L.stringFormat("{0}",_.XML,".xml"),(function(e){t.Clear();var i=new FileReader;i.onload=function(e){if(e.target.result){var i=new qn;i.FromString(e.target.result),t.LoadFromXml(i),i=null}},i.readAsText(e.firstFile),i=null}))}},{key:"doImportTXT",value:function(t){kh.execute(this.hcl,L.stringFormat("{0}",_.TXT,".txt"),(function(e){t.Clear();var i=new FileReader;i.onload=function(e){e.target.result&&t.InsertText(e.target.result)},i.readAsText(e.firstFile),i=null}))}},{key:"doExportXML",value:function(t){var e=new Blob([t.SaveToXml()],{type:_.XML}),i=URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.href=i,n.download="HCView H5.xml",n.click(),window.URL.revokeObjectURL(i),document.body.removeChild(n)}},{key:"doExportHTML",value:function(t){var e=new Blob([t.SaveToHtml()],{type:_.HTML}),i=URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.href=i,n.download="HCView H5.html",n.click(),window.URL.revokeObjectURL(i),document.body.removeChild(n)}},{key:"doExportTXT",value:function(t){var e=new Blob([t.SaveToText()],{type:_.TXT}),i=URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.href=i,n.download="HCView H5.txt",n.click(),window.URL.revokeObjectURL(i),document.body.removeChild(n)}},{key:"doExportPDF",value:function(t){var e=this;if(this.FHCServer)var i=this.hcl.waitMessage("正在生成PDF文件...",(function(){var n=new ht;t.SaveToStream(n,!1);var o=new Uint8Array(n.buffer);mt.post(e.FHCServer,{CMD:"1068",verSub:e.VerSub,data:o,first:"-1",last:"-1",isodd:"0",header:"1",footer:"1",pages:"",phuav:e.PrintParam.HideUnAllocValue,uavblank:e.PrintParam.UnAllocValueBlank,dgblanktitle:e.PrintParam.DeGroupPrintBlankTitle},(function(t){var n=JSON.parse(t);if(e.hcl.endWaitMessage(i),n.data.length>0){var o=new Uint8Array(n.data),s=new Blob([o],{type:_.PDF}),r=URL.createObjectURL(s),a=document.createElement("a");document.body.appendChild(a),a.href=r,a.download="HCView H5.pdf",a.click(),window.URL.revokeObjectURL(r),document.body.removeChild(a)}else console.log("警告，服务端生成的PDF文件大小为0！")}),(function(t){e.hcl.endWaitMessage(i),alert("生成PDF请求失败(status:"+t.status+")，请检查HCServer服务是否开启！")}))}));else console.log("打印失败，未设置HC服务端地址！")}},{key:"doPrintExecute",value:function(t,e){var i=this,n=e.PrinterServer||this.PrintParam.PrinterServer||this.FHCServer||"";if(""!==n){var o=function(){var o=new ht;t.PrintSave=!0;try{t.SaveToStream(o,!1)}finally{t.PrintSave=!1}var r=new Uint8Array(o.buffer),a={CMD:"1068",comp:i.Comp||"",prgm:i.Prgm||"",rn:i.RunNo||"",verSub:i.VerSub,data:r,first:null!=e.first?e.first:-1,last:null!=e.last?e.last:-1,firstPage:null!=e.firstPage?e.firstPage:null,lastPage:null!=e.lastPage?e.lastPage:null,isodd:e.isodd||0,header:e.header||1,footer:e.footer||1,secb:null!=e.secb?e.secb:-1,pageb:null!=e.pageb?e.pageb:-1,leftb:null!=e.leftb?e.leftb:-1,topb:null!=e.topb?e.topb:-1,hb:null!=e.hb?e.hb:-1,sece:null!=e.sece?e.sece:-1,pagee:null!=e.pagee?e.pagee:-1,lefte:null!=e.lefte?e.lefte:-1,tope:null!=e.tope?e.tope:-1,he:null!=e.he?e.he:-1,pages:e.pages||"",phuav:e.hideUnAlloc||i.PrintParam.HideUnAllocValue,uavblank:e.uavblank||i.PrintParam.UnAllocValueBlank,dgblanktitle:e.dgblanktitle||i.PrintParam.DeGroupPrintBlankTitle,revord:e.reverseOrder||0,rbwm:e.waterMarking||i.PrintParam.RBWatermarking,watermark:e.watermark||i.PrintParam.Watermark,watermarkFont:e.watermarkFont||i.PrintParam.WatermarkFont,watermarkSize:e.watermarkSize||i.PrintParam.WatermarkSize,watermarkPos:e.watermarkPos||i.PrintParam.WatermarkPos,watermarkOpacity:e.watermarkOpacity||i.PrintParam.WatermarkOpacity,pimage:e.printAsIamge||i.PrintParam.PrintAsImage,printer:e.printer||i.PrintParam.PrinterName,zoomSize:e.zoomSize||i.PrintParam.ZoomSize,zoomWidth:e.zoomWidth||i.PrintParam.ZoomWidth};null!=e.firstSection&&-1!=e.firstSection&&(null!=e.firstIndex&&-1!=e.firstIndex?a.first=t.GetPageIndexBySectionPageIndex(e.firstSection,e.firstIndex)+1:a.first=1),null!=e.lastSection&&-1!=e.lastSection&&(null!=e.lastIndex&&-1!=e.lastIndex?a.last=t.GetPageIndexBySectionPageIndex(e.lastSection,e.lastIndex)+1:a.last=t.Sections[e.lastSection].PageCount),mt.post(n,a,(function(t,e){var n=JSON.parse(t);if(n.err)i.hcl.endWaitMessage(s),alert(n.err);else if(n.fontlose&&alert("生成打印PDF文件时服务器系统中缺少以下字体："+n.fontlose),""!==(a.printer||i.PrintParam.PrinterName)){if(i.hcl.endWaitMessage(s),null!=i.OnPrinted){var o=0;a.he>0?o=2:a.topb>0&&(o=1),i.OnPrinted(o,n.printLast)}}else if(n.data.length>0){var r=new Uint8Array(n.data);if(null!=i.OnPrintPdf)if(!i.OnPrintPdf(r,n.printLast))return void i.hcl.endWaitMessage(s);var l=document.getElementById("hclPrintFrame"+i.hcl.instanceID);null!=l&&(i.hcl.parentElement.removeChild(l),l=null),(l=document.createElement("iframe")).id="hclPrintFrame"+i.hcl.instanceID,l.style.display="none",i.hcl.parentElement.appendChild(l),l.onload=function(){if(l.contentWindow.print(),URL.revokeObjectURL(l.src),i.hcl.endWaitMessage(s),null!=i.OnPrinted){var t=0;a.he>0?t=2:a.topb>0&&(t=1),i.OnPrinted(t,n.printLast)}};var h=new Blob([r],{type:_.PDF});l.src=URL.createObjectURL(h)}else i.hcl.endWaitMessage(s),console.log("警告，服务端生成的打印文件大小为0！")}),(function(t){i.hcl.endWaitMessage(s),alert("打印请求失败(status:"+t.status+")，请检查HCServer服务是否开启！")}))},s=null;this.PrintParam.NoWaitInfo?o():s=this.hcl.waitMessage("正在打印...",o)}else console.log("打印失败，未设置HC服务端地址！")}},{key:"doPrint",value:function(t){this.doPrintExecute(t,{first:-1,last:-1,isodd:0,header:1,footer:1,leftb:-1,topb:-1,hb:-1,lefte:-1,tope:-1,he:-1,reverseOrder:0})}},{key:"doPrintCurPage",value:function(t){var e=t.GetActivePageIndex();this.doPrintExecute(t,{first:e+1,last:e+1,isodd:0,header:1,footer:1,leftb:-1,topb:-1,hb:-1,lefte:-1,tope:-1,he:-1,reverseOrder:0})}},{key:"doPrintPageRange",value:function(t){var e=this,i=new gd(this.hcl);i.moveCenter(),i.showModal((function(){e.doPrintExecute(t,{first:-1,last:-1,isodd:3,header:1,footer:1,leftb:-1,topb:-1,hb:-1,lefte:-1,tope:-1,he:-1,reverseOrder:0,pages:i.edtPages.text})}))}},{key:"doPrintOdd",value:function(t,e){this.doPrintExecute(t,{first:-1,last:-1,isodd:1,header:1,footer:1,leftb:-1,topb:-1,hb:-1,lefte:-1,tope:-1,he:-1,reverseOrder:e?1:0})}},{key:"doPrintEvent",value:function(t,e){this.doPrintExecute(t,{first:-1,last:-1,isodd:2,header:1,footer:1,leftb:-1,topb:-1,hb:-1,lefte:-1,tope:-1,he:-1,reverseOrder:e?1:0})}},{key:"doPrintCurLine",value:function(t,e){if(t.ActiveSection.ActiveArea==ql.Page){var i=t.GetActivePageIndex(),n=i+1,o=0,s=0;e&&(n=e,o=1,s=1);var r=t.ActiveSectionTopLevelData(),a=r.GetDrawItemNoByOffset(r.SelectInfo.StartItemNo,r.SelectInfo.StartItemOffset);a=r.GetLineDrawItemRang(a,-1).a;var l=r.GetDrawItemFormatCoord(a),h=t.ActiveSection.GetPageIndexByFormat(l.y),c=t.ActiveSection.GetPageMarginLeftAndRight(h);this.doPrintExecute(t,{first:i+1,last:n,isodd:0,header:o,footer:s,secb:t.ActiveSectionIndex,pageb:h,leftb:c.left,topb:l.y-t.ActiveSection.GetPageDataFmtTop(h),hb:r.DrawItems[a].rect.height,lefte:-1,tope:-1,he:-1,reverseOrder:0})}else console.log("按当前行打印，只支持在正文中的当前行！")}},{key:"doPrintSelect",value:function(t){if(t.ActiveSection.ActiveArea==ql.Page){var e=t.ActiveSectionTopLevelData(),i=e.GetActiveRectItem();if(null!==i&&i.StyleNo===oo.Table&&i.SelectCellRang.SelectExists()){var n=e.GetDrawItemFormatCoord(i.FirstDItemNo),o=i.GetCellRect(i.SelectCellRang.StartRow,i.SelectCellRang.StartCol).leftTop;o.y+=Math.trunc(e.GetLineBlankSpace(i.FirstDItemNo)/2),o.offsetBy(n);var s=o.y,r=t.ActiveSection.GetPageIndexByFormat(o.y),a=t.GetPageIndexBySectionPageIndex(t.ActiveSectionIndex,r),l=t.ActiveSection.GetPageMarginLeftAndRight(r);o.offset(l.left,-t.ActiveSection.GetPageDataFmtTop(r));var h=i.GetCellRect(i.SelectCellRang.EndRow,i.SelectCellRang.EndCol).rightTop;h.y+=Math.trunc(e.GetLineBlankSpace(i.FirstDItemNo)/2),h.offsetBy(n),r=t.ActiveSection.GetPageIndexByFormat(h.y),h.y=s;var c=t.GetPageIndexBySectionPageIndex(t.ActiveSectionIndex,r);if(l=t.ActiveSection.GetPageMarginLeftAndRight(r),h.offset(l.left,-t.ActiveSection.GetPageDataFmtTop(r)),a!==c)return void alert("表格暂不支持跨页选中行打印，请分别选中各页要打印的行后再后打印！");for(var u=i.BorderWidthPix,f=i.SelectCellRang.StartRow;f<=i.SelectCellRang.EndRow;f++)u+=i.Rows[f].FmtOffset+i.Rows[f].Height+i.BorderWidthPix;this.doPrintExecute(t,{first:a+1,last:c+1,isodd:0,header:0,footer:0,secb:t.ActiveSectionIndex,pageb:a,leftb:o.x,topb:o.y,hb:u,sece:t.ActiveSectionIndex,pagee:c,lefte:h.x,tope:h.y,he:u,reverseOrder:0})}else{if(e.SelectInfo.EndItemNo<0)return void alert("无效的选中结束位置！");var d=e.GetDrawItemNoByOffset(e.SelectInfo.StartItemNo,e.SelectInfo.StartItemOffset),m=e.GetDrawItemFormatCoord(d),S=t.ActiveSection.GetPageIndexByFormat(m.y),p=t.GetPageIndexBySectionPageIndex(t.ActiveSectionIndex,S),y=t.ActiveSection.GetPageMarginLeftAndRight(S);m.x=y.left+m.x+e.GetDrawItemOffsetWidth(d,e.SelectInfo.StartItemOffset-e.DrawItems[d].CharOffs+1),m.y=m.y-t.ActiveSection.GetPageDataFmtTop(S);var F=e.GetDrawItemNoByOffset(e.SelectInfo.EndItemNo,e.SelectInfo.EndItemOffset),v=e.GetDrawItemFormatCoord(F);S=t.ActiveSection.GetPageIndexByFormat(v.y);var I=t.GetPageIndexBySectionPageIndex(t.ActiveSectionIndex,S);y=t.ActiveSection.GetPageMarginLeftAndRight(S),v.x=y.left+v.x+e.GetDrawItemOffsetWidth(F,e.SelectInfo.EndItemOffset-e.DrawItems[F].CharOffs+1),v.y=v.y-t.ActiveSection.GetPageDataFmtTop(S),this.doPrintExecute(t,{first:p+1,last:I+1,isodd:0,header:0,footer:0,secb:t.ActiveSectionIndex,pageb:p,leftb:m.x,topb:m.y,hb:e.DrawItems[d].rect.height,sece:t.ActiveSectionIndex,pagee:I,lefte:v.x,tope:v.y,he:e.DrawItems[F].rect.height,reverseOrder:0})}}else console.log("选中打印，只支持在正文中的当前页！")}},{key:"ClearPrintMark",value:function(){this.PrintParam.MarkSectionIndex=-1,this.PrintParam.MarkPageIndex=-1,this.PrintParam.MarkLeft=-1,this.PrintParam.MarkTop=-1,this.PrintParam.MarkHeight=0,this.PrintParam.MarkEnd=!1}},{key:"_DoSetPrintMark",value:function(t,e,i,n,o){var s=i.GetDrawItemNoByOffset(n,o);s=i.GetLineDrawItemRang(s,-1).a;var r=i.GetDrawItemFormatCoord(s),a=t.Sections[e].GetPageIndexByFormat(r.y);this.PrintParam.MarkSectionIndex=e,this.PrintParam.MarkPageIndex=a;var l=t.Sections[e].GetPageMarginLeftAndRight(a);this.PrintParam.MarkLeft=l.left,this.PrintParam.MarkTop=r.y-t.Sections[e].GetPageDataFmtTop(a),this.PrintParam.MarkHeight=i.DrawItems[s].rect.height}},{key:"SetPrintMarkByProc",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.FFrmRecord.EmrView.GetProcItemNo(t);if(!i.result)return console.log("PrintProc未找到病程："+t),!1;this.FFrmRecord.EmrView.BeginUpdate();try{this.ClearPrintMark(),this.PrintParam.MarkEnd=e,e?this._DoSetPrintMark(this.FFrmRecord.EmrView,i.sectionIndex,i.data,i.endNo,0):this._DoSetPrintMark(this.FFrmRecord.EmrView,i.sectionIndex,i.data,i.startNo,0)}finally{this.FFrmRecord.EmrView.EndUpdate()}return!0}},{key:"SetPrintMark",value:function(t,e,i,n,o){this.FFrmRecord.EmrView.BeginUpdate();try{this.ClearPrintMark(),this.PrintParam.MarkEnd=!0,this.PrintParam.MarkSectionIndex=t,this.PrintParam.MarkPageIndex=e,this.PrintParam.MarkLeft=i,this.PrintParam.MarkTop=n,this.PrintParam.MarkHeight=o}finally{this.FFrmRecord.EmrView.EndUpdate()}}},{key:"ClearPrintRange",value:function(t,e){t&&(this.PrintParam.StartPageIndex=-1,this.PrintParam.StartLeft=-1,this.PrintParam.StartTop=-1,this.PrintParam.StartHeight=0,this.PrintParam.StartSectionIndex=-1,this.PrintParam.StartData=null,this.PrintParam.StartItemNo=-1,this.PrintParam.StartOffset=-1),e&&(this.PrintParam.EndPageIndex=-1,this.PrintParam.EndLeft=-1,this.PrintParam.EndTop=-1,this.PrintParam.EndHeight=0,this.PrintParam.EndSectionIndex=-1,this.PrintParam.EndData=null,this.PrintParam.EndItemNo=-1,this.PrintParam.EndOffset=-1)}},{key:"_DoSetPrintStartLine",value:function(t,e,i,n,o){var s=i.GetDrawItemNoByOffset(n,o);s=i.GetLineDrawItemRang(s,-1).a;var r=i.GetDrawItemFormatCoord(s),a=t.Sections[e].GetPageIndexByFormat(r.y),l=t.GetPageIndexBySectionPageIndex(e,a),h=r.y-t.Sections[e].GetPageDataFmtTop(a);if(this.PrintParam.EndPageIndex>=0&&(l>this.PrintParam.EndPageIndex||l===this.PrintParam.EndPageIndex&&h>this.PrintParam.EndTop)){this.PrintParam.StartPageIndex=this.PrintParam.EndPageIndex;var c=t.Sections[this.PrintParam.EndSectionIndex].GetPageMarginLeftAndRight(this.PrintParam.EndPageIndex);return this.PrintParam.StartLeft=c.left,this.PrintParam.StartTop=this.PrintParam.EndTop,this.PrintParam.StartHeight=this.PrintParam.EndHeight,this.PrintParam.StartSectionIndex=this.PrintParam.EndSectionIndex,this.PrintParam.StartData=this.PrintParam.EndData,this.PrintParam.StartItemNo=this.PrintParam.EndItemNo,this.PrintParam.StartOffset=this.PrintParam.EndOffset,this.PrintParam.EndPageIndex=l,c=t.Sections[e].GetPageMarginLeftAndRight(a),this.PrintParam.EndLeft=c.left+t.Sections[e].GetPageWidth(),this.PrintParam.EndTop=h,this.PrintParam.EndHeight=i.DrawItems[s].rect.height,this.PrintParam.EndSectionIndex=e,this.PrintParam.EndData=i,this.PrintParam.EndItemNo=n,void(this.PrintParam.EndOffset=o)}this.PrintParam.StartPageIndex=l;var u=t.Sections[e].GetPageMarginLeftAndRight(a);this.PrintParam.StartLeft=u.left,this.PrintParam.StartTop=h,this.PrintParam.StartHeight=i.DrawItems[s].rect.height,this.PrintParam.StartSectionIndex=e,this.PrintParam.StartData=i,this.PrintParam.StartItemNo=n,this.PrintParam.StartOffset=o}},{key:"SetPrintStartLine",value:function(t,e){if(e)this.ClearPrintRange(!0,!1);else if(t.ActiveSection.ActiveArea==ql.Page){var i=t.ActiveSectionTopLevelData();this._DoSetPrintStartLine(t,t.ActiveSectionIndex,i,i.SelectInfo.StartItemNo,i.SelectInfo.StartItemOffset)}else console.log("自定义区间打印，只支持在正文中打印！")}},{key:"_DoSetPrintEndLine",value:function(t,e,i,n,o){var s=i.GetDrawItemNoByOffset(n,o);s=i.GetLineDrawItemRang(s,-1).b;var r=i.GetDrawItemFormatCoord(s),a=t.Sections[e].GetPageIndexByFormat(r.y),l=r.y-t.Sections[e].GetPageDataFmtTop(a),h=i.DrawItems[s].rect.height,c=r.y+h,u=t.Sections[e].GetPageIndexByFormat(c);a!==u&&(a=u,h=c-t.Sections[e].GetPageDataFmtTop(a),l=0);var f=t.GetPageIndexBySectionPageIndex(e,a);if(this.PrintParam.StartPageIndex>=0&&(f<this.PrintParam.StartPageIndex||f===this.PrintParam.StartPageIndex&&l+h<=this.PrintParam.StartTop)){this.PrintParam.EndPageIndex=this.PrintParam.StartPageIndex;var d=t.Sections[this.PrintParam.StartSectionIndex].GetPageMarginLeftAndRight(this.PrintParam.StartPageIndex);return this.PrintParam.EndLeft=d.left+t.Sections[this.PrintParam.StartSectionIndex].GetPageWidth(),this.PrintParam.EndTop=this.PrintParam.StartTop,this.PrintParam.EndHeight=this.PrintParam.StartHeight,this.PrintParam.EndSectionIndex=this.PrintParam.StartSectionIndex,this.PrintParam.EndData=this.PrintParam.StartData,this.PrintParam.EndItemNo=this.PrintParam.StartItemNo,this.PrintParam.EndOffset=this.PrintParam.StartOffset,this.PrintParam.StartPageIndex=f,d=t.Sections[e].GetPageMarginLeftAndRight(a),this.PrintParam.StartLeft=d.left,this.PrintParam.StartTop=l,this.PrintParam.StartHeight=h,this.PrintParam.StartSectionIndex=e,this.PrintParam.StartData=i,this.PrintParam.StartItemNo=n,void(this.PrintParam.StartOffset=o)}this.PrintParam.EndPageIndex=f;var m=t.Sections[e].GetPageMarginLeftAndRight(a);this.PrintParam.EndLeft=m.left+t.Sections[e].GetPageWidth(),this.PrintParam.EndTop=l,this.PrintParam.EndHeight=h,this.PrintParam.EndSectionIndex=e,this.PrintParam.EndData=i,this.PrintParam.EndItemNo=n,this.PrintParam.EndOffset=o}},{key:"SetPrintEndLine",value:function(t,e){if(e)this.ClearPrintRange(!1,!0);else if(t.ActiveSection.ActiveArea==ql.Page){var i=t.ActiveSectionTopLevelData();this._DoSetPrintEndLine(t,t.ActiveSectionIndex,i,i.SelectInfo.StartItemNo,i.SelectInfo.StartItemOffset)}else console.log("自定义区间打印，只支持在正文中打印！")}},{key:"PrintLineRange",value:function(t,e){return t.ActiveSection.ActiveArea!=ql.Page?(console.log("自定义区间打印，只支持在正文中打印！"),!1):this.PrintParam.StartPageIndex<0||this.PrintParam.StartLeft<0||this.PrintParam.StartTop<0?(console.log("未设置自定义打印区间起始位置！"),!1):this.PrintParam.EndPageIndex<0||this.PrintParam.EndLeft<0||this.PrintParam.EndTop<0?(console.log("未设置自定义打印区间结束位置！"),!1):(this.doPrintExecute(t,{first:this.PrintParam.StartPageIndex+1,last:this.PrintParam.EndPageIndex+1,isodd:0,header:0,footer:0,secb:this.PrintParam.StartSectionIndex,pageb:this.PrintParam.StartPageIndex,leftb:this.PrintParam.StartLeft,topb:this.PrintParam.StartTop,hb:this.PrintParam.StartHeight,sece:this.PrintParam.EndSectionIndex,pagee:this.PrintParam.EndPageIndex,lefte:this.PrintParam.EndLeft,tope:this.PrintParam.EndTop,he:this.PrintParam.EndHeight,reverseOrder:0}),e&&this.ClearPrintRange(!0,!0),!0)}},{key:"GetPrintRangeProcInfo",value:function(){return this.PrintParam.StartItemNo>=0&&this.PrintParam.EndItemNo>=0?this.FrmRecord.EmrView.GetItemRangeProcInfo(this.PrintParam.StartSectionIndex,this.PrintParam.StartItemNo,this.PrintParam.StartOffset,this.PrintParam.EndSectionIndex,this.PrintParam.EndItemNo,this.PrintParam.EndOffset):null}},{key:"Dispose",value:function(){this.hcl.dispose()}},{key:"DoBtnMenuPopup",value:function(t,e){if(null!==this.OnBtnMenuPopup){var i=this.FFrmRecord.EmrView.ActiveSectionTopLevelData(),n=i.GetActiveItem();this.OnBtnMenuPopup(t,e,i,n)}}},{key:"AddToolButton",value:function(t){var e=this;if(this.FFrmRecord.captionBar.visible)for(var i,n=function(n){if(t[n].menu){(i=new Xi(e.hcl,t[n].text)).tag=1,t[n].id&&(i.id=t[n].id),null!=t[n].visible&&(i.visible=t[n].visible),null!=t[n].enabled&&(i.enabled=t[n].enabled),null!=t[n].textVisible&&(i.textVisible=t[n].textVisible);var o=new gn(e.hcl);o.dropDownStyle=!0,o.onPopup=function(){e.DoBtnMenuPopup(i,o.subItems)},e.AddContextMenu(t[n].menu,o),i.dropDownMenu=o,e.FFrmRecord.captionBar.addControl(i)}else(i=e.FFrmRecord.captionBar.addButton(t[n].text)).tag=1,null!=t[n].visible&&(i.visible=t[n].visible),null!=t[n].enabled&&(i.enabled=t[n].enabled),null!=t[n].textVisible&&(i.textVisible=t[n].textVisible),i.onClick=function(){t[n].exec()};t[n].image&&(i.image.src=t[n].image)},o=0;o<t.length;o++)n(o)}},{key:"AddMenuItem",value:function(t,e){var i;t.isSpliter?(i=e.addSpliter()).tag=1:((i=e.addItem(t.text)).tag=1,t.id&&(i.id=t.id.toString()),t.hint&&(i.hint=t.hint),i.onClick=function(){t.exec&&t.exec()},t.subMenu&&this.AddContextMenu(t.subMenu,i))}},{key:"AddContextMenu",value:function(t,e){if(e||(e=this.FFrmRecord.FContextMenu))for(var i=0;i<t.length;i++)this.AddMenuItem(t[i],e)}},{key:"removeContextMenuItem",value:function(t,e,i){for(var n=t.count-1;n>=0;n--){if(t[n][e]==i)return t.removeAt(n),!0;if(t[n].hasSubItem&&this.removeContextMenuItem(t[n].subItems,e,i))return!0}return!1}},{key:"RemoveContextMenu",value:function(t,e){return null!=this.FFrmRecord.FContextMenu&&this.removeContextMenuItem(this.FFrmRecord.FContextMenu.subItems,t,e)}},{key:"findContextMenuItem",value:function(t,e,i){for(var n=t.count-1;n>=0;n--){if(t[n][e]==i)return t[n];if(t[n].hasSubItem){var o=this.findContextMenuItem(t[n].subItems,e,i);if(null!==o)return o}}return null}},{key:"FindContextMenu",value:function(t,e){return null!=this.FFrmRecord.FContextMenu?this.findContextMenuItem(this.FFrmRecord.FContextMenu.subItems,t,e):null}},{key:"print",value:function(t,e,i,n,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.Print(t,e,i,n,o,s)}},{key:"Print",value:function(t,e,i,n,o,s){var r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.doPrintExecute(this.FFrmRecord.EmrView,{first:t,last:e,isodd:i,header:n,footer:o,leftb:-1,topb:-1,hb:-1,lefte:-1,tope:-1,he:-1,reverseOrder:s,pages:r,uavblank:a})}},{key:"printEx",value:function(t){this.PrintEx(t)}},{key:"PrintEx",value:function(t){this.doPrintExecute(this.FFrmRecord.EmrView,null!=t?t:{})}},{key:"PrintProc",value:function(t){if(!this.HideTrace&&this.FFrmRecord.EmrView.FTraceCountDel>0)return alert("打印时有未隐藏的删除痕迹，请在隐藏痕迹状态下再打印病程！"),!1;var e=this.FFrmRecord.EmrView.GetProcItemNo(t);if(!e.result)return console.log("PrintProc未找到病程："+t),!1;this.FFrmRecord.EmrView.BeginUpdate();try{return this.ClearPrintRange(!0,!0),this._DoSetPrintStartLine(this.FFrmRecord.EmrView,e.sectionIndex,e.data,e.startNo,0),this._DoSetPrintEndLine(this.FFrmRecord.EmrView,e.sectionIndex,e.data,e.endNo,0),this.PrintLineRange(this.FFrmRecord.EmrView,!0)}finally{this.FFrmRecord.EmrView.EndUpdate()}}},{key:"PrintProceRange",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!this.HideTrace&&this.FFrmRecord.EmrView.FTraceCountDel>0)return alert("打印时有未隐藏的删除痕迹，请在隐藏痕迹状态下再打印病程！"),!1;if(""===t)return!1;var i=this.FFrmRecord.EmrView.GetProcItemNo(t);if(!i.result)return console.log("PrintProceRange未找到病程："+t),!1;this.FFrmRecord.EmrView.BeginUpdate();try{if(this.ClearPrintRange(!0,!0),this._DoSetPrintStartLine(this.FFrmRecord.EmrView,i.sectionIndex,i.data,i.startNo,0),""!==e){var n=this.FFrmRecord.EmrView.GetProcItemNo(e);if(!n.result)return console.log("PrintProceRange未找到病程："+e),this.ClearPrintRange(!0,!0),!1;this._DoSetPrintEndLine(this.FFrmRecord.EmrView,n.sectionIndex,n.data,n.endNo,0)}else{var o=this.FFrmRecord.EmrView.Sections.count-1,s=this.FFrmRecord.EmrView.Sections[o].Page,r=s.Items.count-1;this._DoSetPrintEndLine(this.FFrmRecord.EmrView,o,s,r,s.GetItemOffsetAfter(r))}return this.PrintLineRange(this.FFrmRecord.EmrView,!0)}finally{this.FFrmRecord.EmrView.EndUpdate()}}},{key:"PrintView",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.FFrmRecord.PrintView(t)}},{key:"ClosePrintView",value:function(){this.FFrmRecord.ClosePrintView()}},{key:"applyParaAlignHorz",value:function(t){this.ApplyParaAlignHorz(t)}},{key:"ApplyParaAlignHorz",value:function(t){this.FFrmRecord.EmrView.ApplyParaAlignHorz(t)}},{key:"applyTextStyle",value:function(t){this.ApplyTextStyle(t)}},{key:"ApplyTextStyle",value:function(t){this.FFrmRecord.EmrView.ApplyTextStyle(t)}},{key:"applyTextFontName",value:function(t){this.ApplyTextFontName(t)}},{key:"ApplyTextFontName",value:function(t){this.FFrmRecord.EmrView.ApplyTextFontName(t)}},{key:"applyTextFontSize",value:function(t){this.ApplyTextFontSize(t)}},{key:"ApplyTextFontSize",value:function(t){"string"==typeof t?this.FFrmRecord.EmrView.ApplyTextFontSize(Nt.fontSizeToPt(t)):this.FFrmRecord.EmrView.ApplyTextFontSize(t)}},{key:"applyTextColor",value:function(t){this.ApplyTextColor(t)}},{key:"ApplyTextColor",value:function(t){this.FFrmRecord.EmrView.ApplyTextColor(t)}},{key:"applyTextBackColor",value:function(t){this.ApplyTextBackColor(t)}},{key:"ApplyTextBackColor",value:function(t){this.FFrmRecord.EmrView.ApplyTextBackColor(t)}},{key:"AddFont",value:function(t){if(!this.FFrmRecord.captionBar.visible)return!1;if(this.FFrmRecord.cbbFont.itemIndexOf(t)<0&&(new Rt).detect(t))return this.FFrmRecord.cbbFont.addItem(t),!0;return!1}},{key:"FontSizeToPt",value:function(t){return Nt.fontSizeToPt(t)}},{key:"FontPtToSize",value:function(t){return Nt.fontPtToSize(t)}},{key:"beginUpdate",value:function(){this.BeginUpdate()}},{key:"BeginUpdate",value:function(){this.FFrmRecord.EmrView.BeginUpdate()}},{key:"endUpdate",value:function(){this.EndUpdate()}},{key:"EndUpdate",value:function(){this.FFrmRecord.EmrView.EndUpdate()}},{key:"BeginFormat",value:function(){this.FFrmRecord.EmrView.BeginFormat()}},{key:"EndFormat",value:function(){this.FFrmRecord.EmrView.EndFormat()}},{key:"NextDeItemAutoComplate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.FFrmRecord.NextDeItemAutoComplate(t,e)}},{key:"PrevDeItemAutoComplate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.FFrmRecord.PrevDeItemAutoComplate(t)}},{key:"loadHeaderFromBytes",value:function(t,e){this.LoadHeaderFromBytes(t,e)}},{key:"LoadHeaderFromBytes",value:function(t,e){var i=new ht(t);this.LoadHeaderFromStream(i,e),i=null}},{key:"LoadHeaderFromStream",value:function(t,e){if(!this.FrmRecord.EmrView.LoadHeaderFromStream(t,e)){var i=new Wu(this.hcl);i.LoadFromStream(t),t.clear(),i.Sections[0].Header.SaveToStream(t),t.position=0,this.FFrmRecord.EmrView.IgnoreAcceptAction=!0;try{this.FFrmRecord.EmrView.ActiveSection.Header.BeginFormat();try{this.FFrmRecord.EmrView.ActiveSection.Header.LoadFromStream(t,i.Style,Yl.HC_FileVersionInt)}finally{this.FFrmRecord.EmrView.ActiveSection.Header.EndFormat(!1)}e?this.FFrmRecord.EmrView.ActiveSection.AssignPaper(i.Sections[0]):this.FFrmRecord.EmrView.ResetActiveSectionMargin()}finally{this.FFrmRecord.EmrView.IgnoreAcceptAction=!1}this.FFrmRecord.EmrView.IsChanged=!0,this.FFrmRecord.EmrView.UpdateView()}}},{key:"loadFooterFromBytes",value:function(t,e){this.LoadFooterFromBytes(t,e)}},{key:"LoadFooterFromBytes",value:function(t,e){var i=new ht(t);this.LoadFooterFromStream(i,e),i=null}},{key:"LoadFooterFromStream",value:function(t,e){if(!this.FrmRecord.EmrView.LoadFooterFromStream(t,e)){var i=new Wu(this.hcl);i.LoadFromStream(t),t.clear(),i.Sections[0].Footer.SaveToStream(t),t.position=0,this.FFrmRecord.EmrView.IgnoreAcceptAction=!0;try{this.FFrmRecord.EmrView.ActiveSection.Footer.BeginFormat();try{this.FFrmRecord.EmrView.ActiveSection.Footer.LoadFromStream(t,i.Style,Yl.HC_FileVersionInt)}finally{this.FFrmRecord.EmrView.ActiveSection.Footer.EndFormat(!1)}e?this.FFrmRecord.EmrView.ActiveSection.AssignPaper(i.Sections[0]):this.FFrmRecord.EmrView.ResetActiveSectionMargin()}finally{this.FFrmRecord.EmrView.IgnoreAcceptAction=!1}this.FFrmRecord.EmrView.IsChanged=!0,this.FFrmRecord.EmrView.UpdateView()}}},{key:"loadFromFile",value:function(t){this.LoadFromFile(t)}},{key:"LoadFromFile",value:function(t){this.FFrmRecord.PopupFormClose(),this.FFrmRecord.EmrView.LoadFromFile(t)}},{key:"LoadFromBytes",value:function(t){this.loadFromStream(t)}},{key:"loadFromStream",value:function(t){this.LoadFromStream(t)}},{key:"LoadFromStream",value:function(t){this.FFrmRecord.PopupFormClose();var e=new ht(t);this.FFrmRecord.EmrView.LoadFromStream(e),e=null}},{key:"SaveToBytes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.SaveToStream(t,e)}},{key:"saveToStream",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.SaveToStream(t,e)}},{key:"SaveToStream",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=new ht;return this.FFrmRecord.EmrView.SaveToStream(i,t,e),i.buffer}},{key:"SaveToBytesNoTrace",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=new ht;return this.FFrmRecord.EmrView.SaveToStreamNoTrace(i,t,e),i.buffer}},{key:"SaveToBytesStructure",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new ht;this.FFrmRecord.EmrView.SaveToStream(n,t,e);var o=new Wu(this.hcl);return o.LoadFromStream(n),n.clear(),o.SaveToStreamStructure(n,t,e,i),n.buffer}},{key:"InsertBytes",value:function(t){try{var e=new ht(t);this.FFrmRecord.EmrView.InsertStream(e),e=null}catch(t){console.log(t.stack)}}},{key:"AppendBytes",value:function(t){var e=new ht(t);this.FFrmRecord.EmrView.AppendStream(e),e=null}},{key:"SaveToLiteFile",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ql.Page,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=new ht;this.FFrmRecord.EmrView.SaveToLiteStream(i,t,e);var n=new Uint8Array(i.buffer),o=new Blob([n],{type:"application/octet-stream"}),s=window.URL.createObjectURL(o),r=document.createElement("a");document.body.appendChild(r),r.href=s,r.download="HCView H5 Lite.hcf",r.click(),window.URL.revokeObjectURL(s),document.body.removeChild(r),i=null}},{key:"SaveToLiteBytes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ql.Page,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=new ht;return this.FFrmRecord.EmrView.SaveToLiteStream(i,t,e),i.buffer}},{key:"LoadFromLiteBytes",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ql.Page,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=new ht(t);this.FFrmRecord.EmrView.LoadFromLiteStream(n,e,i),n=null}},{key:"InsertLiteBytes",value:function(t){var e=new ht(t);this.FFrmRecord.EmrView.InsertLiteStream(e),e=null}},{key:"ReplaceDataItemByLiteBytes",value:function(t,e,i){this.ReplaceItemByLiteBytes(t,e,i)}},{key:"ReplaceItemByLiteBytes",value:function(t,e,i){var n=new ht(t);this.FFrmRecord.EmrView.ReplaceDataItemByLiteStream(n,e,i),n=null}},{key:"InsertBytesMutMargin",value:function(t){var e=new ht(t);this.FFrmRecord.EmrView.InsertStreamMutMargin(e),e=null}},{key:"InsertSectionFromBytes",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=new ht(t);this.FFrmRecord.EmrView.InsertSectionFromFileStream(i,e),i=null}},{key:"saveToXml",value:function(){return this.SaveToXml()}},{key:"SaveToXml",value:function(){return this.FFrmRecord.EmrView.SaveToXml()}},{key:"saveToHtml",value:function(){return this.SaveToHtml()}},{key:"SaveToHtml",value:function(){return this.FFrmRecord.EmrView.SaveToHtml()}},{key:"SaveToText",value:function(){return this.FFrmRecord.EmrView.SaveToText()}},{key:"SaveSelectToText",value:function(){return this.FFrmRecord.EmrView.SaveSelectToText()}},{key:"SaveSelectToBytes",value:function(){var t=new ht;return this.FFrmRecord.EmrView.SaveSelectToStream(t),t.buffer}},{key:"Resize",value:function(){this.hcl.resize()}},{key:"clear",value:function(){this.Clear()}},{key:"Clear",value:function(){this.FFrmRecord.EmrView.Clear()}},{key:"clearUndo",value:function(){this.ClearUndo()}},{key:"ClearUndo",value:function(){this.FFrmRecord.EmrView.ClearUndo()}},{key:"CanEdit",value:function(){return this.FFrmRecord.EmrView.CanEdit()}},{key:"UndoDisenable",value:function(){this.UndoDisable()}},{key:"UndoDisable",value:function(){this.FFrmRecord.EmrView.FUndoList.Enable=!1}},{key:"UndoEnable",value:function(){this.FFrmRecord.EmrView.FUndoList.Enable=!0}},{key:"Search",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.FFrmRecord.EmrView.Search(t,e,i)}},{key:"SyntaxCheck",value:function(){this.FFrmRecord.EmrView.SyntaxCheck()}},{key:"insertDeItem",value:function(t){return this.InsertDeItem(t)}},{key:"InsertDeItem",value:function(t){return this.FFrmRecord.InsertDeItem(t.Index,t.Name,t)}},{key:"InsertToothItem",value:function(t){var e=new Vc(this.hcl,this.FFrmRecord.EmrView.ActiveSectionTopLevelData(),t.LeftTop,t.RightTop,t.LeftBottom,t.RightBottom);this.FFrmRecord.EmrView.InsertItem(e)}},{key:"InsertHyperLink",value:function(t){return this.FFrmRecord.InsertHyperLink(t)}},{key:"GetSelectCoord",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.FFrmRecord.GetSelectCoord(t)}},{key:"getDeItemText",value:function(t){return this.GetDeItemText(t)}},{key:"GetDeItemText",value:function(t){return this.FFrmRecord.EmrView.GetDeItemText(t)}},{key:"getDeItemProperty",value:function(t,e,i){return this.GetDeItemProperty(t,e,i)}},{key:"GetDeItemProperty",value:function(t,e,i){return this.FFrmRecord.EmrView.GetDeItemProperty(t,e,i)}},{key:"SetDeItemText",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return this.FFrmRecord.EmrView.SetDeItemText(t,e,i,n)}},{key:"SetDeItemProperty",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.FFrmRecord.EmrView.SetDeObjectProperty(t,e,i,n)}},{key:"BatchUpdate",value:function(t,e){var i=this;if(""!=t)var n=this.hcl.waitMessage(t,(function(){try{i.FFrmRecord.EmrView.BatchUpdate(e)}finally{i.hcl.endWaitMessage(n)}}));else this.FFrmRecord.EmrView.BatchUpdate(e)}},{key:"MergeProc",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(""!=t)var o=this.hcl.waitMessage(t,(function(){try{i.FFrmRecord.EmrView.MergeProc(e,n)}finally{i.hcl.endWaitMessage(o)}}));else this.FFrmRecord.EmrView.MergeProc(e,n)}},{key:"InsertProc",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=this.FFrmRecord.EmrView.InsertProc(t.toString(),e,i.toString(),n);return r&&null!==s&&("string"==typeof s?this.SetProcByText(t.toString(),s):"object"===o()(s)&&this.SetProcBytes(t.toString(),s)),r}},{key:"insertProc",value:function(t,e,i){return this.InsertProc(t,e,i)}},{key:"DeleteProc",value:function(t){this.FFrmRecord.EmrView.DeleteProc(t)}},{key:"ScrollToProc",value:function(t){return this.FFrmRecord.EmrView.ScrollToProc(t)}},{key:"GetCaretProcProperty",value:function(t,e){return this.FFrmRecord.EmrView.GetCaretProcProperty(t,e)}},{key:"GetCaretDeGroupProperty",value:function(t,e){return this.FFrmRecord.EmrView.GetCaretDeGroupProperty(t,e)}},{key:"getProcProperty",value:function(t,e,i){return this.GetProcProperty(t,e,i)}},{key:"GetProcProperty",value:function(t,e,i){return this.FFrmRecord.EmrView.GetProcProperty(t,e,i)}},{key:"SetProcProperty",value:function(t,e,i){this.FFrmRecord.EmrView.SetProcProperty(t,e,i)}},{key:"SaveProcToBytes",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=this.FFrmRecord.EmrView.GetProcItemNo(t);if(!o.result)return this.hcl.warnLog("SaveProcToBytes方法未找到病程"+t,!1),null;var s=new Wu(this.hcl),r=new ht;if(e){s.Style.MergeStyle=!0;try{this.FFrmRecord.EmrView.ActiveSection.Header.SaveToStream(r),r.position=0,s.ActiveSection.Header.LoadFromStream(r,this.FFrmRecord.EmrView.Style,Yl.HC_FileVersionInt),r.clear(),this.FFrmRecord.EmrView.ActiveSection.Footer.SaveToStream(r),r.position=0,s.ActiveSection.Footer.LoadFromStream(r,this.FFrmRecord.EmrView.Style,Yl.HC_FileVersionInt)}finally{s.Style.MergeStyle=!1}}return s.ActiveSection.AssignPaper(this.FFrmRecord.EmrView.ActiveSection),r.clear(),this.FFrmRecord.EmrView.GetProcAsStream(t,r)&&(r.position=0,s.InsertLiteStream(r),r.clear(),i?s.SaveToStreamStructure(r,!1,null,n):s.SaveToStream(r,!1)),s=null,r.buffer}},{key:"SaveProcToHtml",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.FFrmRecord.EmrView.GetProcItemNo(t);if(!i.result)return this.hcl.warnLog("SaveProcToHtml方法未找到病程"+t,!1),null;var n=new Wu(this.hcl),o=new ht;if(e.headerAndFooter){n.Style.MergeStyle=!0;try{this.FFrmRecord.EmrView.ActiveSection.Header.SaveToStream(o),o.position=0,n.ActiveSection.Header.LoadFromStream(o,this.FFrmRecord.EmrView.Style,Yl.HC_FileVersionInt),o.clear(),this.FFrmRecord.EmrView.ActiveSection.Footer.SaveToStream(o),o.position=0,n.ActiveSection.Footer.LoadFromStream(o,this.FFrmRecord.EmrView.Style,Yl.HC_FileVersionInt)}finally{n.Style.MergeStyle=!1}}n.ActiveSection.AssignPaper(this.FFrmRecord.EmrView.ActiveSection),o.clear(),this.FFrmRecord.EmrView.GetProcAsStream(t,o)&&(o.position=0,n.InsertLiteStream(o)),o=null;var s=new at;s.append("<!DOCTYPE HTML>"),s.append("<html>"),s.append("<head>"),s.append("<title>"),s.append("</title>"),s.append(n.Style.ToCSS()),s.append("</head>"),s.append('<body bgcolor="'+Yl.HCColorToHtml(this.hcl,this.FFrmRecord.EmrView.color)+'">');for(var r=0;r<n.Sections.count;r++)s.append(n.Sections[r].ToHtml());s.append("</body>"),s.append("</html>"),n=null;var a=new Blob([s.text],{type:_.HTML}),l=URL.createObjectURL(a),h=document.createElement("a");return document.body.appendChild(h),h.href=l,h.download="HCView H5.html",h.click(),window.URL.revokeObjectURL(l),document.body.removeChild(h),s.text}},{key:"SetProcBytes",value:function(t,e){this.SetProcByFileSteam(t,e)}},{key:"SetProcByFileSteam",value:function(t,e){var i=new ht(e);this.FFrmRecord.EmrView.SetProcByFileSteam(t,i),i=null}},{key:"GetProcAsText",value:function(t){var e=this.FFrmRecord.EmrView.GetProcAsText(t);return e.result?e.text:null}},{key:"getProcAsText",value:function(t){return this.GetProcAsText(t)}},{key:"GetProcLiteBytes",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new ht;if(this.FFrmRecord.EmrView.GetProcAsStream(t,n)){if(e){var o=new Wu(this.hcl);n.position=0,o.InsertLiteStream(n),o.Structure(i),n.clear(),o.SaveToLiteStream(n)}return n.buffer}return[]}},{key:"GetProcAsBytes",value:function(t){return this.GetProcLiteBytes(t)}},{key:"getProcAsBytes",value:function(t){return this.GetProcLiteBytes(t)}},{key:"SetProcByLiteBytes",value:function(t,e){this.SetProcByBytes(t,e)}},{key:"SetProcByBytes",value:function(t,e){var i=new ht(e);this.FFrmRecord.EmrView.SetProcByStream(t,i),i=null}},{key:"SetProcByText",value:function(t,e){this.FFrmRecord.EmrView.SetProcByText(t,e)}},{key:"GetProcDeGroupAsText",value:function(t,e){return this.FrmRecord.EmrView.GetProcDeGroupAsText(t,e)}},{key:"GetProcDeGroupAsLiteBytes",value:function(t,e){var i=this.FrmRecord.EmrView.GetProcDeGroupAsStream(t,e);return i?i.buffer:[]}},{key:"SaveSelectToFileBytes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new Wu(this.hcl),o=new ht;if(t){n.Style.MergeStyle=!0;try{this.FFrmRecord.EmrView.ActiveSection.Header.SaveToStream(o),o.position=0,n.ActiveSection.Header.LoadFromStream(o,this.FFrmRecord.EmrView.Style,Yl.HC_FileVersionInt),o.clear(),this.FFrmRecord.EmrView.ActiveSection.Footer.SaveToStream(o),o.position=0,n.ActiveSection.Footer.LoadFromStream(o,this.FFrmRecord.EmrView.Style,Yl.HC_FileVersionInt)}finally{n.Style.MergeStyle=!1}}return n.ActiveSection.AssignPaper(this.FFrmRecord.EmrView.ActiveSection),this.FFrmRecord.EmrView.ActiveSectionTopLevelData().SelectExists()&&(o.clear(),this.FFrmRecord.EmrView.SaveSelectToStream(o),o.position=0,n.InsertLiteStream(o)),o.clear(),e?n.SaveToStreamStructure(o,!1,null,i):n.SaveToStream(o,!1),n=null,o.buffer}},{key:"SetActiveItemExtraByBytes",value:function(t){this.SetPopupItemExtraByBytes(null,t)}},{key:"SetPopupItemExtraByBytes",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=new ht(e);null==t||t.StyleNo>oo.Null?this.FFrmRecord.EmrView.SetActiveItemExtra(n):this.FFrmRecord.EmrView.SetActiveDeGroupBySteam(n,i),n=null}},{key:"SetDeItemDomainAsync",value:function(t,e,i){this.FFrmRecord.SetDeItemDomainAsync(t,e,i)}},{key:"SetActiveDeObjectProperty",value:function(t,e){this.FFrmRecord.EmrView.SetActiveDeObjectProperty(t,e)}},{key:"getProcAsHtml",value:function(t){return this.GetProcAsHtml(t)}},{key:"GetProcAsHtml",value:function(t){var e=this.FFrmRecord.EmrView.GetProcItemNo(t);if(e.result){var i=new at;return i.append("<!DOCTYPE HTML>"),i.append("<html>"),i.append("<head>"),i.append("<title>"),i.append("</title>"),i.append(this.FFrmRecord.EmrView.Style.ToCSS()),i.append("</head>"),i.append("<body>"),i.append(this.FFrmRecord.EmrView.Sections[e.sectionIndex].Page.ToHtml(e.startNo,e.endNo)),i.append("</body>"),i.append("</html>"),i.text}return""}},{key:"insertDeGroup",value:function(t){this.InsertDeGroup(t)}},{key:"InsertDeGroup",value:function(t){this.FFrmRecord.InsertDeGroup(t.Index,t.Name,t)}},{key:"DeleteDeGroup",value:function(t){this.FFrmRecord.EmrView.DeleteDeGroup(t)}},{key:"setDeGroupText",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.SetDeGroupByText(t,e,i)}},{key:"SetDeGroupText",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.SetDeGroupByText(t,e,i)}},{key:"SetDeGroupByText",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.FFrmRecord.EmrView.SetDeGroupByText(this.FFrmRecord.EmrView.ActiveSectionIndex,ql.Page,t,e,i,n)}},{key:"getDeGroupText",value:function(t){return this.GetDeGroupAsText(t)}},{key:"GetDeGroupText",value:function(t){return this.GetDeGroupAsText(t)}},{key:"GetDeGroupAsText",value:function(t){return this.FFrmRecord.EmrView.GetDeGroupAsText(t)}},{key:"GetDeGroupAsLiteBytes",value:function(t){var e=this.FFrmRecord.EmrView.GetDeGroupAsStream(t);return e?e.buffer:[]}},{key:"GetDeGroupAsBytes",value:function(t){return this.GetDeGroupAsLiteBytes(t)}},{key:"SetDeGroupByFileBytes",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=new ht(e);this.FFrmRecord.EmrView.SetDeGroupByFileStream(this.FFrmRecord.EmrView.ActiveSectionIndex,ql.Page,t,o,i,n),o=null}},{key:"SetDeGroupByLiteBytes",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=new ht(e);this.FFrmRecord.EmrView.SetActiveSectionDeGroupByStream(t,s,i,n,o),s=null}},{key:"SetDeGroupByBytes",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.SetDeGroupByLiteBytes(t,e,i,n,o)}},{key:"SetDataDeGroupInnerBytes",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=new ht(i);this.FFrmRecord.EmrView.SetDataDeGroupInnerStream(t,e,o,n),o=null}},{key:"SetProcDeGroupByText",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.FFrmRecord.EmrView.SetProcDeGroupByText(t,e,i,n,o)}},{key:"SetProcDeGroupByLiteBytes",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=new ht(i);this.FFrmRecord.EmrView.SetProcDeGroupByStream(t,e,r,n,o,s),r=null}},{key:"SetProcDeGroupByBytes",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;this.SetProcDeGroupByLiteBytes(t,e,i,n,o,s)}},{key:"SetCaretDeGroupByText",value:function(t){this.FFrmRecord.EmrView.SetCaretDeGroupByText(t)}},{key:"SetCaretDeGroupByBytes",value:function(t){this.SetCaretDeGroupByLiteBytes(t,!1)}},{key:"SetCaretDeGroupByLiteBytes",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=new ht(t);this.FFrmRecord.EmrView.SetCaretDeGroupByStream(i,e),i=null}},{key:"SetActiveDeItemDomain",value:function(t){this.FFrmRecord.SetActiveDeItemDomain(t)}},{key:"InsertJSONObject",value:function(t){this.FFrmRecord.EmrView.InsertJSONObject(t)}},{key:"insertText",value:function(t){this.InsertText(t)}},{key:"InsertText",value:function(t){this.FFrmRecord.EmrView.InsertText(t)}},{key:"insertDeTable",value:function(t){return this.InsertDeTable(t)}},{key:"InsertDeTable",value:function(t){return this.FFrmRecord.InsertDeTable(t.Index,t)}},{key:"insertDeImage",value:function(t){return this.InsertDeImage(t)}},{key:"InsertDeImage",value:function(t){return this.FFrmRecord.InsertDeImage(t.Index,t.Name,t)}},{key:"SetDeImage",value:function(t){this.FFrmRecord.EmrView.SetDeImage(t.Index,t)}},{key:"setDeImage",value:function(t){this.SetDeImage(t)}},{key:"insertDeEdit",value:function(t){return this.InsertDeEdit(t)}},{key:"InsertDeEdit",value:function(t){return this.FFrmRecord.InsertDeEdit(t.Index,t.Name,t)}},{key:"insertDeCombobox",value:function(t){return this.InsertDeCombobox(t)}},{key:"InsertDeCombobox",value:function(t){return this.FFrmRecord.InsertDeCombobox(t.Index,t.Name,t)}},{key:"insertDeDateTime",value:function(t){return this.InsertDeDateTime(t)}},{key:"InsertDeDateTime",value:function(t){return this.FFrmRecord.InsertDeDateTime(t.Index,t.Name,t)}},{key:"insertDeRadioGroup",value:function(t){return this.InsertDeRadioGroup(t)}},{key:"InsertDeRadioGroup",value:function(t){return this.FFrmRecord.InsertDeRadioGroup(t.Index,t.Name,t)}},{key:"insertDeCheckBox",value:function(t){return this.InsertDeCheckBox(t)}},{key:"InsertDeCheckBox",value:function(t){return this.FFrmRecord.InsertDeCheckBox(t.Index,t.Name,t)}},{key:"InsertFloatLine",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.FFrmRecord.InsertFloatLine(t)}},{key:"insertDeFloatBarCode",value:function(t){return this.InsertDeFloatBarCode(t)}},{key:"InsertDeFloatBarCode",value:function(t){return this.FFrmRecord.InsertDeFloatBarCode(t.Index,t.Name,t)}},{key:"InsertDeFloatQRCode",value:function(t){return this.FFrmRecord.InsertDeFloatQRCode(t.Index,t.Name,t)}},{key:"InsertDeBarCode",value:function(t){return this.FFrmRecord.InsertDeBarCode(t.Index,t.Name,t)}},{key:"InsertDeQRCode",value:function(t){return this.FFrmRecord.InsertDeQRCode(t.Index,t.Name,t)}},{key:"InsertDeYueJingItem",value:function(t,e,i,n){return this.FFrmRecord.InsertDeYueJingItem(t,e,i,n)}},{key:"InsertDeToothItem",value:function(t,e,i,n){return this.FFrmRecord.InsertDeToothItem(t,e,i,n)}},{key:"InsertDeFangJiaoItem",value:function(t,e,i,n){return this.FFrmRecord.InsertDeFangJiaoItem(t,e,i,n)}},{key:"InsertDeCnDrugItem",value:function(t,e){this.FFrmRecord.InsertDeCnDrugItem(t,e)}},{key:"InsertChineseMedicineItem",value:function(t,e,i){return this.FFrmRecord.InsertChineseMedicineItem(t,e,i)}},{key:"InsertGestationalWeekItem",value:function(t,e){return this.FFrmRecord.InsertGestationalWeekItem(t,e)}},{key:"InsertPupilItem",value:function(t,e,i,n,o,s,r){return this.FFrmRecord.InsertPupilItem(t,e,i,n,o,s,r)}},{key:"InsertLightPerceptionItem",value:function(t,e,i,n,o,s,r,a,l){return this.FFrmRecord.InsertLightPerceptionItem(t,e,i,n,o,s,r,a,l)}},{key:"InsertFetalHeartItem",value:function(t,e,i,n,o,s){return this.FFrmRecord.InsertFetalHeartItem(t,e,i,n,o,s)}},{key:"InsertPamerToothItem",value:function(t,e,i,n){return this.FFrmRecord.InsertPamerToothItem(t,e,i,n)}},{key:"InsertFraction1Item",value:function(t,e){return this.FFrmRecord.InsertFraction1Item(t,e)}},{key:"InsertFraction2Item",value:function(t,e){return this.FFrmRecord.InsertFraction2Item(t,e)}},{key:"GetActiveDeGroup",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.FFrmRecord.EmrView.ActiveSectionTopLevelData();if(e.ActiveDomain.BeginNo>0){if(t){var i=e.CreateDefaultDomainItem();return i.Assign(e.Items[e.ActiveDomain.BeginNo]),i}return e.Items[e.ActiveDomain.BeginNo]}return null}},{key:"GetActiveItem",value:function(){return this.FFrmRecord.EmrView.ActiveSectionTopLevelData().GetActiveItem()}},{key:"DeleteActiveItem",value:function(){this.FFrmRecord.EmrView.DeleteActiveItem()}},{key:"DeleteTopLevelItem",value:function(){var t=this.FFrmRecord.EmrView.ActiveSectionTopLevelData();this.FFrmRecord.EmrView.DeleteActiveDataItems(t.SelectInfo.StartItemNo)}},{key:"DeleteItem",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=this.FFrmRecord.EmrView.ActiveSection.Page,n=i.Items.count-1;n>=0&&(!(i.Items[n].StyleNo>oo.Null||i.Items[n].StyleNo==oo.Image)||i.Items[n].GetValue(Yh.Index)!=t||(i.Items.delete(n),2!=e));n--);this.FFrmRecord.EmrView.FormatData()}},{key:"ShowSearch",value:function(){this.FFrmRecord.EmrView.ShowSearchForm()}},{key:"TraverseItem",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.TraverseElement(t,e,i,n,o)}},{key:"traverseElement",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.TraverseElement(t,e,i,n,o)}},{key:"TraverseElement",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.FFrmRecord.TraverseElement(t,e,i,n,o)}},{key:"TraverseProcElement",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.FFrmRecord.TraverseProcElement(t,e,i,n)}},{key:"TraverseDeGroup",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.FFrmRecord.TraverseDeGroup(t,e,i)}},{key:"TraverseProcDeGroup",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.FFrmRecord.TraverseProcDeGroup(t,e,i,n)}},{key:"SetTraceInfoByObj",value:function(t,e){if(!t||!e)return this.hcl.warnLog("调用SetTraceInfoByObj方法的2个参数参数不能为null或undefined",!1),!1;var i,n=new Set([]);return n.add(ql.Header),n.add(ql.Footer),n.add(ql.Page),this.FFrmRecord.TraverseElement((function(n,s,r,a,l){(i=n.Items[s]).StyleNo>oo.Null&&0!==i.TraceStyles.value&&(i.TraceStyles.has(jh.Add)&&""===i.GetValue(Yh.TraceAdd)&&t.Propertys&&("object"===o()(t.Propertys)?Yl.SetItemPropertyJSON(t.Propertys,i):Yl.SetItemPropertyString(t.Propertys,i)),i.TraceStyles.has(jh.Del)&&""===i.GetValue(Yh.TraceDel)&&e.Propertys&&("object"===o()(e.Propertys)?Yl.SetItemPropertyJSON(e.Propertys,i):Yl.SetItemPropertyString(e.Propertys,i)))}),n,0,!1,!0),this.FFrmRecord.EmrView.TraceInfoAnnotate&&this.FrmRecord.EmrView.UpdateView(),!0}},{key:"SetTraceInfo",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Xh;return this.SetTraceInfoByObj({Propertys:{TcAdd:t,TcAddL:i}},{Propertys:{TcDel:e,TcDelL:i}})}},{key:"WaitMessage",value:function(t,e){return this.hcl.waitMessage(t,e)}},{key:"EndWaitMessage",value:function(t){this.hcl.endWaitMessage(t)}},{key:"CreateEmrViewLite",value:function(){return new Wu(this.hcl)}},{key:"SetActiveSectionPaperInfo",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t.size)if("object"==o()(t.size))this.FFrmRecord.EmrView.ActiveSection.PaperWidth=t.size.width,this.FFrmRecord.EmrView.ActiveSection.PaperHeight=t.size.height;else{var i=Yl.GetPaperSizeByName(t.size),n=Yl.GetPaperSizeInfo(i);this.FFrmRecord.EmrView.ActiveSection.PaperSize=i,this.FFrmRecord.EmrView.ActiveSection.PaperOrientation==Ql.Portrait?(this.FFrmRecord.EmrView.ActiveSection.PaperWidth=n.Width,this.FFrmRecord.EmrView.ActiveSection.PaperHeight=n.Height):(this.FFrmRecord.EmrView.ActiveSection.PaperWidth=n.Height,this.FFrmRecord.EmrView.ActiveSection.PaperHeight=n.Width)}if(t.margin&&(t.margin.left&&t.margin.left>=0&&(this.FrmRecord.EmrView.ActiveSection.PaperMarginLeft=t.margin.left),t.margin.top&&t.margin.top>=0&&(this.FrmRecord.EmrView.ActiveSection.PaperMarginTop=t.margin.top),t.margin.right&&t.margin.right>=0&&(this.FrmRecord.EmrView.ActiveSection.PaperMarginRight=t.margin.right),t.margin.bottom&&t.margin.bottom>=0&&(this.FrmRecord.EmrView.ActiveSection.PaperMarginBottom=t.margin.bottom)),t.orientation&&this.FFrmRecord.EmrView.ActiveSection.PaperOrientation!=t.orientation){this.FFrmRecord.EmrView.ActiveSection.PaperOrientation=t.orientation;var s=this.FFrmRecord.EmrView.ActiveSection.PaperWidth;this.FFrmRecord.EmrView.ActiveSection.PaperWidth=this.FFrmRecord.EmrView.ActiveSection.PaperHeight,this.FFrmRecord.EmrView.ActiveSection.PaperHeight=s}e&&this.FrmRecord.EmrView.ResetActiveSectionMargin()}},{key:"ExportPDF",value:function(){this.doExportPDF(this.FFrmRecord.EmrView)}},{key:"ExportTXT",value:function(){this.doExportTXT(this.FFrmRecord.EmrView)}},{key:"ImportTXT",value:function(){this.doImportTXT(this.FFrmRecord.EmrView)}},{key:"ImportXML",value:function(){this.doImportXML(this.FFrmRecord.EmrView)}},{key:"ExportXML",value:function(){this.doExportXML(this.FFrmRecord.EmrView)}},{key:"LoadDocxFile",value:function(t){var e=this;if(this.FHCServer)var i=this.hcl.waitMessage("正在打开...",(function(n){ht.loadFromFile(t.file,(function(n,o){var s=new Uint8Array(n.buffer);mt.post(e.FHCServer,{CMD:"1074",verSub:e.VerSub,fname:t.file.name,data:s},(function(t){var n=JSON.parse(t);n.err?alert(n.err):(n.fontlose&&alert("docx文件中缺少以下字体："+n.fontlose),n.data.length>0?e.LoadFromBytes(n.data):(e.Clear(),console.log("警告，docx文件大小为0！"))),e.hcl.endWaitMessage(i)}),(function(t){e.hcl.endWaitMessage(i),alert("打开DOCX请求失败(status:"+t.status+")，请检查HCServer服务是否开启！")}))}))}));else console.log("打开失败，未设置HC服务端地址！")}},{key:"ExportHTML",value:function(){this.doExportHTML(this.FFrmRecord.EmrView)}},{key:"SetFocus",value:function(){this.FrmRecord.SetFocusInEmrView()}},{key:"FormatDate",value:function(t,e){return lt.CreateWithDateTime(t).format(e)}},{key:"SetServer",value:function(){var t=this;this.Comp="",this.Prgm="",this.RunNo="",mt.post(this.FHCServer,{CMD:"1000",verSub:this.VerSub,License:this.License,Org:this.Org},(function(e){var i=JSON.parse(e);t.Comp=i.comp,t.Prgm=i.hosp,t.RunNo=i.rn,t.FrmRecord.EmrView.fileVersion=i.ver,t.FrmRecord.EmrView.copyRight="编辑器由"+i.comp+" 授权 "+i.hosp}))}},{key:"IsEmrExpressItem",value:function(t){return mh.IsEmrExpressItem(t)}},{key:"ObjToLiteBytes",value:function(t){var e=new ht;return this.FFrmRecord.EmrView.ObjToLiteStream(e,t),e.buffer}},{key:"toolBar",get:function(){return this.ToolBar}},{key:"ToolBar",get:function(){return this.FFrmRecord.captionBar}},{key:"isChanged",get:function(){return this.IsChanged},set:function(t){this.IsChanged=t}},{key:"IsChanged",get:function(){return this.FFrmRecord.EmrView.IsChanged},set:function(t){this.FFrmRecord.EmrView.IsChanged=t}},{key:"designMode",get:function(){return this.DesignMode},set:function(t){this.DesignMode=t}},{key:"DesignMode",get:function(){return this.FFrmRecord.EmrView.DesignModeEx},set:function(t){this.FFrmRecord.EmrView.DesignModeEx=t}},{key:"procCount",get:function(){return this.ProcCount}},{key:"ProcCount",get:function(){return this.FFrmRecord.EmrView.ProcCount}},{key:"editProcIndex",get:function(){return this.EditProcIndex},set:function(t){this.EditProcIndex=t}},{key:"EditProcIndex",get:function(){return this.FFrmRecord.EmrView.EditProcIndex},set:function(t){this.FFrmRecord.EmrView.EditProcIndex=t}},{key:"CaretProcInfo",get:function(){return this.FFrmRecord.EmrView.FCaretProcInfo}},{key:"showProcSplit",get:function(){return this.ShowProcSplit},set:function(t){this.ShowProcSplit=t}},{key:"ShowProcSplit",get:function(){return this.FFrmRecord.EmrView.ShowProcSplit},set:function(t){this.FFrmRecord.EmrView.ShowProcSplit=t}},{key:"readOnly",get:function(){return this.ReadOnly},set:function(t){this.ReadOnly=t}},{key:"ReadOnly",get:function(){return this.FFrmRecord.EmrView.ReadOnly},set:function(t){this.FFrmRecord.EmrView.ReadOnly=t}},{key:"trace",get:function(){return this.Trace},set:function(t){this.Trace=t}},{key:"Trace",get:function(){return this.FFrmRecord.EmrView.Trace},set:function(t){this.FFrmRecord.EmrView.Trace=t}},{key:"secret",get:function(){return this.Secret},set:function(t){this.Secret=t}},{key:"Secret",get:function(){return this.FFrmRecord.EmrView.Secret},set:function(t){this.FFrmRecord.EmrView.Secret=t}},{key:"hideTrace",get:function(){return this.HideTrace},set:function(t){this.HideTrace=t}},{key:"HideTrace",get:function(){return this.FFrmRecord.EmrView.HideTrace},set:function(t){this.FFrmRecord.EmrView.HideTrace=t}},{key:"UseScript",get:function(){return this.hcl.hc.USESCRIPT},set:function(t){this.hcl.hc.USESCRIPT=t}},{key:"TraceInfoAnnotate",get:function(){return this.FFrmRecord.EmrView.TraceInfoAnnotate},set:function(t){this.FFrmRecord.EmrView.TraceInfoAnnotate=t}},{key:"UnAllocWarning",get:function(){return this.FFrmRecord.EmrView.UnAllocWarning},set:function(t){this.FFrmRecord.EmrView.UnAllocWarning=t}},{key:"EditProtectKeepPara",get:function(){return this.FFrmRecord.EmrView.EditProtectKeepPara},set:function(t){this.FFrmRecord.EmrView.EditProtectKeepPara=t}},{key:"ReadOnlyProcessAnnotate",get:function(){return this.FFrmRecord.EmrView.Style.ReadOnlyProcessAnnotate},set:function(t){this.FFrmRecord.EmrView.Style.ReadOnlyProcessAnnotate=t}},{key:"FrmRecord",get:function(){return this.FFrmRecord}},{key:"InnerView",get:function(){return this.FFrmRecord.EmrView}},{key:"HCL",get:function(){return this.hcl}},{key:"HC",get:function(){return Yl}},{key:"HCServer",get:function(){return this.FHCServer},set:function(t){this.FHCServer=t,this.SetServer()}},{key:"MultItemSpliter",get:function(){return this.hcl.emrCommon.MultItemSpliter},set:function(t){this.hcl.emrCommon.MultItemSpliter=t}},{key:"MultipleSingleBtn",get:function(){return this.MultipleSingleBtnVisible},set:function(t){this.MultipleSingleBtnVisible=t}},{key:"CustomBtn",get:function(){return this.CustomBtnVisible},set:function(t){this.CustomBtnVisible=t}},{key:"MultipleSingleBtnVisible",get:function(){return this.domainDlg.MultipleSingleBtnVisible},set:function(t){this.domainDlg.MultipleSingleBtnVisible=t}},{key:"CustomBtnVisible",get:function(){return this.domainDlg.CustomBtnVisible},set:function(t){this.domainDlg.CustomBtnVisible=t}},{key:"CheckNullItem",get:function(){return this.hcl.hc.CHECKNULLITEM},set:function(t){this.hcl.hc.CHECKNULLITEM=t}},{key:"OnCaretItemChanged",get:function(){return this.FFrmRecord.EmrView.OnSectionCaretItemChanged},set:function(t){this.FFrmRecord.EmrView.OnSectionCaretItemChanged=null!=t?function(){t()}:null}},{key:"OnDomainSwitch",get:function(){return this.FrmRecord.EmrView.OnSectionDataDomainSwitch},set:function(t){this.FFrmRecord.EmrView.OnSectionDataDomainSwitch=null!=t?function(e,i,n,o){t(e,i,n,o)}:null}},{key:"OnChangedSwitch",get:function(){return this.FFrmRecord.OnChangedSwitch},set:function(t){this.FFrmRecord.OnChangedSwitch=null!=t?function(){t()}:null}},{key:"OnSave",get:function(){return this.FFrmRecord.OnSave},set:function(t){this.FFrmRecord.OnSave=null!=t?function(){t()}:null}},{key:"OnExternalDeItemPopup",get:function(){return this.FFrmRecord.OnExternalDeItemPopupLib},set:function(t){this.FFrmRecord.OnExternalDeItemPopupLib=null!=t?function(e,i,n){return t(e,i,n)}:null}},{key:"OnPopupGetDeItemInfo",get:function(){return this.FFrmRecord.OnPopupGetDeItemInfoLib},set:function(t){this.FFrmRecord.OnPopupGetDeItemInfoLib=null!=t?function(e){return t(e)}:null}},{key:"OnItemPopupSetClose",get:function(){return this.FFrmRecord.OnItemPopupSetCloseLib},set:function(t){this.FFrmRecord.OnItemPopupSetCloseLib=null!=t?function(e){return t(e)}:null}},{key:"OnPopupGetDeItemDomain",get:function(){return this.FFrmRecord.OnPopupGetDeItemDomainLib},set:function(t){this.FFrmRecord.OnPopupGetDeItemDomainLib=null!=t?function(e,i){return t(e,i)}:null}},{key:"OnPopupGetDeItemDomainAsync",get:function(){return this.FFrmRecord.OnPopupGetDeItemDomainLibAsync},set:function(t){this.FFrmRecord.OnPopupGetDeItemDomainLibAsync=null!=t?function(e,i,n,o){return t(e,i,n,o)}:null}},{key:"OnPopupGetDomainItemExtraLib",get:function(){return this.FFrmRecord.OnPopupGetDomainItemExtraLib},set:function(t){this.FFrmRecord.OnPopupGetDomainItemExtraLib=null!=t?function(e,i,n){t(e,i,n)}:null}},{key:"OnSetDeItemText",get:function(){return this.FFrmRecord.OnSetDeItemText},set:function(t){this.FFrmRecord.OnSetDeItemText=null!=t?function(e,i,n){return t(e,i,n)}:null}},{key:"OnSaveItem",get:function(){return this.FFrmRecord.EmrView.OnSaveItem},set:function(t){this.FFrmRecord.EmrView.OnSaveItem=null!=t?function(e,i,n){t(e,i,n)}:null}},{key:"OnCutAfter",get:function(){return this.FrmRecord.EmrView.OnCutAfter},set:function(t){this.FFrmRecord.EmrView.OnCutAfter=null!=t?function(){t()}:null}},{key:"OnCopyBefor",get:function(){return this.FrmRecord.EmrView.OnCopyBefor},set:function(t){this.FFrmRecord.EmrView.OnCopyBefor=null!=t?function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return t(e)}:null}},{key:"OnCopyRequest",get:function(){return this.FrmRecord.OnCopyRequest},set:function(t){this.FFrmRecord.EmrView.OnCopyRequest=null!=t?function(e){return t(e)}:null}},{key:"OnCopyAfter",get:function(){return this.FrmRecord.EmrView.OnCopyAfter},set:function(t){this.FFrmRecord.EmrView.OnCopyAfter=null!=t?function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t(e)}:null}},{key:"OnPasteBefor",get:function(){return this.FrmRecord.EmrView.OnPasteBefor},set:function(t){this.FFrmRecord.EmrView.OnPasteBefor=null!=t?function(e,i){return t(e,i)}:null}},{key:"OnPasteRequest",get:function(){return this.FrmRecord.OnPasteRequest},set:function(t){this.FFrmRecord.EmrView.OnPasteRequest=null!=t?function(e,i,n){return t(e,i,n)}:null}},{key:"OnSectionInsertItem",get:function(){return this.FFrmRecord.OnInsertDeItem},set:function(t){this.FFrmRecord.OnInsertDeItem=null!=t?function(e,i,n){t(e,i,n)}:null}},{key:"OnInserItemSync",get:function(){return this.FFrmRecord.EmrView.OnSyncDeItem},set:function(t){null!=t?this.FFrmRecord.EmrView.OnSyncDeItem=function(e,i,n){t(e,i,n)}:this.FrmRecord.EmrView.OnSyncDeItem=null}},{key:"OnDeComboboxPopup",get:function(){return this.FFrmRecord.OnDeComboboxPopup},set:function(t){this.FFrmRecord.OnDeComboboxPopup=null!=t?function(e){return t(e)}:null}},{key:"OnTableCellPopup",get:function(){return this.FFrmRecord.OnTableCellPopup},set:function(t){this.FFrmRecord.OnTableCellPopup=null!=t?function(e,i,n,o,s,r,a){return t(e,i,n,o,s,r,a)}:null}},{key:"OnCanEdit",get:function(){return this.FFrmRecord.EmrView.OnSectionCanEditDataItem},set:function(t){this.FFrmRecord.EmrView.OnSectionCanEditDataItem=null!=t?function(e,i,n){return t(e,i,n)}:null}},{key:"OnCanNotEditNotify",get:function(){return this.FFrmRecord.EmrView.OnCanNotEditNotify},set:function(t){this.FFrmRecord.EmrView.OnCanNotEditNotify=null!=t?function(e){t(e)}:null}},{key:"OnDeItemPopup",get:function(){return this.FFrmRecord.OnDeItemPopup},set:function(t){this.FrmRecord.OnDeItemPopup=null!=t?function(e){return t(e)}:null}},{key:"OnMouseUp",get:function(){return this.FFrmRecord.OnMouseUpLib},set:function(t){this.FFrmRecord.OnMouseUpLib=null!=t?function(e,i,n){t(e,i,n)}:null}},{key:"OnPopupFormClose",get:function(){return this.FFrmRecord.OnPopupFormClose},set:function(t){this.FFrmRecord.OnPopupFormClose=null!=t?function(){return t()}:null}},{key:"OnAnnotateMenuPopup",get:function(){return this.FFrmRecord.OnAnnotateMenuPopup},set:function(t){this.FFrmRecord.OnAnnotateMenuPopup=null!=t?function(e,i,n){t(e,i,n)}:null}},{key:"OnChange",get:function(){return this.FFrmRecord.EmrView.OnChange},set:function(t){this.FFrmRecord.EmrView.OnChange=null!=t?function(){t()}:null}},{key:"OnDblClick",get:function(){return this.FFrmRecord.EmrView.onDblClick},set:function(t){this.FrmRecord.EmrView.onDblClick=null!=t?function(e){t(e)}:null}},{key:"OnDeItemGetSyncValue",get:function(){return this.FFrmRecord.OnDeItemGetSyncValue},set:function(t){this.FFrmRecord.OnDeItemGetSyncValue=null!=t?function(e){return t(e)}:null}},{key:"OnZoomChange",get:function(){return this.FFrmRecord.OnEmrViewZoomChanged},set:function(t){this.FFrmRecord.OnEmrViewZoomChanged=null!=t?function(e){t(e)}:null}},{key:"OnDrawTrace",get:function(){return this.FFrmRecord.EmrView.OnDrawTrace},set:function(t){this.FFrmRecord.EmrView.OnDrawTrace=null!=t?function(e,i,n){t(e,i,n)}:null}},{key:"OnSyntaxCheck",get:function(){return this.FFrmRecord.OnSyntaxCheck},set:function(t){this.FFrmRecord.EmrView.OnSyntaxCheck=null!=t?function(e,i,n){t(e,i,n)}:null}},{key:"OnSyntaxPaint",get:function(){return this.FFrmRecord.OnSyntaxPaint},set:function(t){this.FFrmRecord.OnSyntaxPaint=null!=t?function(e,i,n,o,s,r){t(e,i,n,o,s,r)}:null}},{key:"OnSelectBound",get:function(){return this.FFrmRecord.EmrView.OnSectionDataSelectBound},set:function(t){this.FFrmRecord.EmrView.OnSectionDataSelectBound=null!=t?function(e,i){t(e,i)}:null}},{key:"OnScrollBarResize",get:function(){return this.FFrmRecord.OnScrollBarResize},set:function(t){this.FFrmRecord.OnScrollBarResize=null!==t?function(e,i,n,o,s,r,a,l){t(e,i,n,o,s,r,a,l)}:null}},{key:"OnCalcScrollRange",get:function(){return this.FFrmRecord.FEmrView.OnCalcScrollRange},set:function(t){this.FFrmRecord.FEmrView.OnCalcScrollRange=null!==t?function(e,i,n,o){t(e,i,n,o)}:null}},{key:"OnSectionSetActiveDataBefor",get:function(){return this.FFrmRecord.FEmrView.OnSectionSetActiveDataBefor},set:function(t){this.FFrmRecord.FEmrView.OnSectionSetActiveDataBefor=function(e,i,n){return t(e,i,n)}}},{key:"OnDataItemAutoComplate",get:function(){return this.FFrmRecord.OnDataItemAutoComplate},set:function(t){this.FFrmRecord.OnDataItemAutoComplate=null!==t?function(e,i,n){return t(e,i,n)}:null}},{key:"OnUnRedoSeek",get:function(){return this.FFrmRecord.OnUnRedoSeek},set:function(t){this.FFrmRecord.OnUnRedoSeek=null!==t?function(e,i){return t(e,i)}:null}}]),t}();_d.NewEmrViewLite=function(){var t=new Od;return t.emrCommon=new Sh(t),t.hc=new Yl,new Wu(t)},_d.DisposeEmrViewLite=function(t){t.hcl.dispose(),t.hcl=null},_d.THCConst={Stream:ht,Style:oo,DeProp:Yh,GroupProp:bc,CContentAlign:ih,SectionArea:ql,FontStyle:Wn,BrushStyle:Mt,PenStyle:_t,ParaLineSpaceMode:Hn,ParaAlignHorz:Ln,ParaAlignVert:Gn,Layout:nh,DomainNode:zs,TextHorAlign:as,DataFormat:ru,HCViewModel:fo,DeTraceStyle:jh,MarkType:ch,OutOfRangStyle:lf,DeFrmtp:Zh,PaperKind:hh,InputStyle:Tn,Action:rh,ViewHorAlign:Su,HCUnitConversion:En};e.default=_d}]).default;