<form nz-form [formGroup]="systemForm" (ngSubmit)="submitForm()">
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>系统名称</nz-form-label>
      <nz-form-control [nzSpan]="16" nzErrorTip="请输入系统名称">
        <input nz-input formControlName="name" placeholder="请输入系统名称" />
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
        <nz-form-label [nzSpan]="6" nzRequired>系统代码</nz-form-label>
        <nz-form-control 
            [nzSpan]="14" 
            nzHasFeedback
            [nzErrorTip]="codeErrorTpl">
            <input nz-input formControlName="code" placeholder="请输入系统代号" />
            <ng-template #codeErrorTpl let-control>
                <ng-container *ngIf="control.hasError('required')">
                    请输入系统代号
                </ng-container>
                <ng-container *ngIf="control.hasError('pattern')">
                系统代号只能包含字母、数字和下划线，且不能以下划线开头
                </ng-container>
            </ng-template>
        </nz-form-control>
      </nz-form-item>
    <nz-form-item>
      <nz-form-label [nzSpan]="6">系统描述</nz-form-label>
      <nz-form-control [nzSpan]="16">
        <textarea nz-input formControlName="description" 
                  placeholder="请输入系统描述" 
                  [nzAutosize]="{ minRows: 3, maxRows: 5 }">
        </textarea>
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>最大并发数</nz-form-label>
      <nz-form-control [nzSpan]="16" nzErrorTip="请输入有效的最大并发数">
        <nz-input-number formControlName="maxConcurrent" 
                        [nzMin]="1" 
                        [nzStep]="1">
        </nz-input-number>
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>授权类型</nz-form-label>
      <nz-form-control [nzSpan]="16">
        <nz-radio-group formControlName="authType">
          <label nz-radio [nzValue]="AuthorizationType.CONCURRENT">按并发</label>
          <label nz-radio [nzValue]="AuthorizationType.TERMINAL">按终端</label>
          <label nz-radio [nzValue]="AuthorizationType.BOTH">均可</label>
        </nz-radio-group>
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
        <nz-form-label [nzSpan]="6">加密密钥</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <nz-select formControlName="encryptionKeyId" nzAllowClear nzPlaceHolder="选择加密密钥（可选）">
            <nz-option
              *ngFor="let key of encryptionKeys"
              [nzValue]="key.id"
              [nzLabel]="key.name + (key.isDefault ? '（默认）' : '')">
            </nz-option>
          </nz-select>
          <div nz-form-extra>不选择则使用默认密钥</div>
        </nz-form-control>
      </nz-form-item>

    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>单独授权</nz-form-label>
      <nz-form-control [nzSpan]="16">
        <nz-switch formControlName="independentAuth"></nz-switch>
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>系统状态</nz-form-label>
      <nz-form-control [nzSpan]="16">
        <nz-switch formControlName="status" 
                  [nzCheckedChildren]="'启用'" 
                  [nzUnCheckedChildren]="'禁用'">
        </nz-switch>
      </nz-form-control>
    </nz-form-item>

    <div class="form-footer">
      <button nz-button nzType="default" (click)="cancel()">取消</button>
      <button nz-button nzType="primary" 
              [nzLoading]="submitting" 
              [disabled]="!systemForm.valid">
        保存
      </button>
    </div>
  </form>