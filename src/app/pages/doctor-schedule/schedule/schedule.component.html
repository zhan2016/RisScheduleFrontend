<!-- schedule.component.html -->
<div class="schedule-board">
    <nz-spin [nzSpinning]="loading">
      <!-- 顶部控制栏 -->
      <div class="schedule-controls">
        <nz-space>
          <!-- 日期导航 -->
          <div *nzSpaceItem class="date-navigation">
            <button nz-button nzType="default" (click)="previousPeriod()">
              <i nz-icon nzType="left"></i>
            </button>
            <nz-date-picker 
              [(ngModel)]="currentDate"
              [nzMode]="'date'"
              (ngModelChange)="onDateChange($event)">
            </nz-date-picker>
            <button nz-button nzType="default" (click)="nextPeriod()">
              <i nz-icon nzType="right"></i>
            </button>
          </div>
  
          <!-- 视图切换 -->
          <nz-radio-group *nzSpaceItem [(ngModel)]="displayMode" (ngModelChange)="onModeChange($event)">
            <label nz-radio-button nzValue="week">周视图</label>
            <label nz-radio-button nzValue="month">月视图</label>
          </nz-radio-group>
  
          <!-- 批量排班按钮 -->
          <button *nzSpaceItem nz-button nzType="primary" (click)="showBatchScheduleModal()">
            批量排班
          </button>
        </nz-space>
      </div>
  
      <!-- 排班表格 -->
      <div class="schedule-grid">
        <!-- 表头 -->
        <div class="grid-header">
          <div class="header-cell" *ngFor="let day of scheduleDays">
            <div class="date">{{ day.dateLocal | date:'MM-dd' }}</div>
            <div class="weekday">{{ day.weekDay }}</div>
          </div>
        </div>
  
        <div class="grid-body">
            <div class="grid-row" *ngFor="let shift of shiftTypes">
              <div class="grid-cell" *ngFor="let day of scheduleDays"
                   [class.today]="isToday(day.dateLocal)"
                   [class.selected]="isSelected(day.dateLocal)"
                   (click)="onCellClick(day.dateLocal, shift)">
                
                <!-- 班次概要 -->
                <ng-container *ngIf="getShiftSummary(day.dateLocal, shift.shiftTypeId) as summary">
                  <div class="shift-summary" *ngIf="summary.doctorCount > 0">
                    <div class="summary-header">
                      <span class="shift-name">{{summary.shiftTypeName}}</span>
                      <span class="shift-time">{{summary.startTime}}-{{summary.endTime}}</span>
                    </div>
                    <div class="summary-info">
                      <span class="doctor-count">排班人数: {{summary.doctorCount}}</span>
                      <span class="work-hours">工作时长: {{summary.workHours}}小时</span>
                    </div>
                    
                    <!-- 医生列表 -->
                    <div class="doctor-list">
                        <app-doctor-schedule-item
                            *ngFor="let doctor of summary.doctors"
                            [doctor]="doctor"
                            (delete)="deleteSchedule(doctor.scheduleId)"
                            (edit)="showEditScheduleModal(doctor)"
                            class="doctor-item">
                        </app-doctor-schedule-item>
                      </div>
                      
                  </div>
                </ng-container>
          
                <!-- 添加排班按钮 -->
                <button *ngIf="getSchedulesByShiftType(day.dateLocal, shift.shiftTypeId).length === 0"
                        nz-button 
                        nzType="dashed"
                        class="add-schedule-btn"
                        (click)="onCellClick(day.dateLocal, shift)">
                  <i nz-icon nzType="plus"></i>
                </button>
              </div>
            </div>
          </div>
      </div>
    </nz-spin>
  </div>