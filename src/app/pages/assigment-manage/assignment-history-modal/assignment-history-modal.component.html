<div class="assignment-history-modal">
  <nz-table
    #basicTable
    [nzData]="historyList"
    [nzLoading]="loading"
    [nzShowPagination]="false"
    [nzBordered]="true"
    [nzSize]="'small'">
    <thead>
      <tr>
        <th nzWidth="150px">变更时间</th>
        <th nzWidth="100px">原状态</th>
        <th nzWidth="100px">新状态</th>
        <th nzWidth="120px">分配类型</th>
        <th nzWidth="150px">分配医生</th>
        <th nzWidth="150px">分配时间</th>
        <th nzWidth="100px">处理状态</th>
        <th>错误信息</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of historyList">
        <td>{{ item.changeTime | date:'yyyy-MM-dd HH:mm:ss' }}</td>
        <td>{{ getStatusText(item.oldStatus) }}</td>
        <td>{{ getStatusText(item.newStatus) }}</td>
        <td>
          <nz-tag [nzColor]="getAssignTypeColor(item.assignType)">
            {{ getAssignTypeText(item.assignType) }}
          </nz-tag>
        </td>
        <td>
          <div *ngIf="item.assignType === 'PRELIMINARY_ONLY' || item.assignType === 'BOTH'">
            <div><nz-tag nzColor="blue">初审</nz-tag> {{ getDoctorName(item.preliminaryDoctorId) }}</div>
          </div>
          <div *ngIf="item.assignType === 'REVIEW_ONLY' || item.assignType === 'BOTH'" 
               [style.margin-top]="item.assignType === 'BOTH' ? '4px' : '0'">
            <div><nz-tag nzColor="orange">复审</nz-tag> {{ getDoctorName(item.reviewDoctorId) }}</div>
          </div>
          <span *ngIf="!item.assignType || (!item.preliminaryDoctorId && !item.reviewDoctorId)">-</span>
        </td>
        <td>
          <div *ngIf="item.assignType === 'PRELIMINARY_ONLY' || item.assignType === 'BOTH'">
            <div class="time-text">{{ item.preliminaryAssignTime | date:'yyyy-MM-dd HH:mm:ss' }}</div>
          </div>
          <div *ngIf="item.assignType === 'REVIEW_ONLY' || item.assignType === 'BOTH'"
               [style.margin-top]="item.assignType === 'BOTH' ? '4px' : '0'">
            <div class="time-text">{{ item.reviewAssignTime | date:'yyyy-MM-dd HH:mm:ss' }}</div>
          </div>
          <span *ngIf="!item.assignType || (!item.preliminaryAssignTime && !item.reviewAssignTime)">-</span>
        </td>
        <td>
          <nz-tag [nzColor]="item.isProcessed === '1' ? 'success' : 'error'">
            {{ item.isProcessed === '1' ? '已处理' : '未处理' }}
          </nz-tag>
        </td>
        <td>
          <span *ngIf="item.errorMsg" nz-typography nzType="danger">
            {{ item.errorMsg }}
          </span>
          <span *ngIf="!item.errorMsg">-</span>
        </td>
      </tr>
    </tbody>
  </nz-table>
</div>