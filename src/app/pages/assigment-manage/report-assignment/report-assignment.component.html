<!-- report-assignment.component.html -->
<div class="report-assignment">
    <!-- 搜索表单 -->
    <form nz-form [formGroup]="searchForm" class="search-form">
        <!-- 第一行放检索条件 -->
        <div nz-row [nzGutter]="42">
            <div nz-col [nzSpan]="6">
                <nz-form-item>
                  <nz-form-label>报道时间</nz-form-label>
                  <nz-form-control>
                    <nz-range-picker 
                      formControlName="examDateRange" 
                      nzPlaceHolder="请选择检查时间"
                      [nzFormat]="'yyyy-MM-dd'">
                    </nz-range-picker>
                  </nz-form-control>
                </nz-form-item>
              </div>
          <div nz-col [nzSpan]="6">
            <nz-form-item>
              <nz-form-label>患者姓名</nz-form-label>
              <nz-form-control>
                <input nz-input formControlName="patientName" placeholder="请输入患者姓名" />
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="6">
            <nz-form-item>
              <nz-form-label>患者ID</nz-form-label>
              <nz-form-control>
                <input nz-input formControlName="patientId" placeholder="请输入患者ID" />
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="6">
            <nz-form-item>
              <nz-form-label>报告状态</nz-form-label>
              <nz-form-control>
                <nz-select 
                  formControlName="reportStatus" 
                  nzMode="multiple"
                  nzAllowClear 
                  nzPlaceHolder="请选择报告状态">
                  <nz-option nzValue="0" nzLabel="取消检查"></nz-option>
                  <nz-option nzValue="3" nzLabel="报告退费"></nz-option>
                  <nz-option nzValue="10" nzLabel="申请预约"></nz-option>
                  <nz-option nzValue="20" nzLabel="预约确认"></nz-option>
                  <nz-option nzValue="25" nzLabel="已叫号"></nz-option>
                  <nz-option nzValue="30" nzLabel="检查确认"></nz-option>
                  <nz-option nzValue="35" nzLabel="检查完成"></nz-option>
                  <nz-option nzValue="38" nzLabel="未写报告"></nz-option>
                  <nz-option nzValue="40" nzLabel="初步报告"></nz-option>
                  <nz-option nzValue="44" nzLabel="审核未通过报告"></nz-option>
                  <nz-option nzValue="45" nzLabel="审核报告"></nz-option>
                  <nz-option nzValue="50" nzLabel="确认报告"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          
          <div nz-col [nzSpan]="6">
            <nz-form-item>
              <nz-form-label>分配来源</nz-form-label>
              <nz-form-control>
                <label nz-checkbox formControlName="onlySystemAssigned">
                  仅显示系统分配
                </label>
                <label nz-checkbox formControlName="onlyFailedAssignments" class="ml-8">
                  仅显示失败分配
                </label>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="6">
            <nz-form-item>
              <nz-form-label>检查类别</nz-form-label>
              <nz-form-control>
                <nz-select formControlName="modality" nzAllowClear nzPlaceHolder="请选择检查类别">
                  <nz-option nzValue="CT" nzLabel="CT"></nz-option>
                  <nz-option nzValue="MRI" nzLabel="MRI"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          
          <div nz-col [nzSpan]="6">
            <nz-form-item>
              <nz-form-label>检查项目</nz-form-label>
              <nz-form-control>
                <input nz-input formControlName="examItemsstr" placeholder="请输入检查项目" />
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="6">
            <nz-form-item>
              <nz-form-label>检查部位</nz-form-label>
              <nz-form-control>
                <input nz-input formControlName="examSubClass" placeholder="请输入检查部位" />
              </nz-form-control>
            </nz-form-item>
          </div>
    
          <!-- 按钮放在最后一列 -->
          <div nz-col [nzSpan]="6">
            <nz-form-item [nzJustify]="'end'">
              <nz-form-control>
                <button nz-button [nzType]="'primary'" (click)="loadData()">
                  <i nz-icon nzType="search"></i>查询
                </button>
                <button nz-button (click)="loadData(true)" class="ml-8">
                  <i nz-icon nzType="redo"></i>重置
                </button>
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
      </form>
  
    <!-- 操作按钮 -->
    <div class="operation-bar">
      <button nz-button [nzType]="'primary'" (click)="onTransfer()" [disabled]="selectedRows.length === 0">
        <i nz-icon nzType="swap"></i>指派
      </button>
      <button nz-button [nzType]="'primary'" (click)="onRecall()" [disabled]="selectedRows.length === 0" class="ml-8">
        <i nz-icon nzType="rollback"></i>召回
      </button>
      <!-- <button nz-button 
          [nzType]="'primary'" 
          (click)="loadErrorAssignments()"
          class="ml-8">
        <i nz-icon nzType="warning"></i>查看异常
        </button> -->
        <button nz-button 
                [nzType]="'primary'" 
                (click)="retryAssignments()" 
                [disabled]="selectedRows.length === 0"
                class="ml-8">
          <i nz-icon nzType="redo"></i>重试分配
        </button>
      <!-- <button nz-button (click)="onExport()" class="ml-8">
        <i nz-icon nzType="download"></i>导出
      </button> -->
    </div>

    <!-- 数据表格 -->
    <div class="grid-container">
      <ag-grid-angular
        [localeText]="localeText"
        class="ag-theme-alpine"
        [gridOptions]="gridOptions"
        [rowData]="assignments"
        [columnDefs]="columnDefs"
        [defaultColDef]="defaultColDef"
        [rowSelection]="'multiple'"
        [suppressRowClickSelection]="true"
        [pagination]="true"
        [paginationPageSize]="pageSize"
        (gridReady)="onGridReady($event)"
        (selectionChanged)="onSelectionChanged($event)"
        [style.height]="'100%'"
      >
      </ag-grid-angular>
      
      <div class="pagination-controls">
        <span>每页显示：</span>
        <nz-select [(ngModel)]="pageSize" (ngModelChange)="onPageSizeChange($event)" style="width: 100px;">
          <nz-option [nzValue]="20" nzLabel="20条"></nz-option>
          <nz-option [nzValue]="50" nzLabel="50条"></nz-option>
          <nz-option [nzValue]="100" nzLabel="100条"></nz-option>
          <nz-option [nzValue]="200" nzLabel="200条"></nz-option>
        </nz-select>
      </div>
    </div>
  </div>

  